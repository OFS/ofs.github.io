
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../reference_manuals/ofs_fim/mnl_fim_ofs/">
      
      
        <link rel="next" href="../../afu_dev/ug_dev_afu_ofs_f2000x/">
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>FPGA Interface Manager Developer Guide - OFS</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intel-fpga-interface-manager-developer-guide-intel-agilex-soc-attach-open-fpga-stack" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="OFS" class="md-header__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OFS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FPGA Interface Manager Developer Guide
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-tabs__link">
        Stratix 10 PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../n6001/user_guides/ug_eval_ofs_n6001/ug_eval_script_ofs_n6001/" class="md-tabs__link">
        Agilex PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-tabs__link md-tabs__link--active">
        Agilex SoC Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../common/user_guides/oneapi_asp/ug_oneapi_asp/" class="md-tabs__link">
        oneAPI
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../sw/fpga_api/quick_start/readme/" class="md-tabs__link">
        OFS Software
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="OFS" class="md-nav__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OFS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Stratix 10 PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Stratix 10 PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/dev_guides/fim_dev/ug_dev_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/dev_guides/afu_dev/ug_dev_afu_d5005/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_sim_ofs_d5005/ug_sim_ofs_d5005/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Agilex PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Agilex PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/user_guides/ug_eval_ofs_n6001/ug_eval_script_ofs_n6001/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/reference_manuals/ofs_fim/mnl_fim_ofs_n6001/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/dev_guides/afu_dev/ug_dev_afu_ofs_n6001/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/dev_guides/hps_dev/hps_developer_ug/" class="md-nav__link">
        HPS Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/user_guides/ug_sim_ofs_n6001/ug_sim_ofs_n6001/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Agilex SoC Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Agilex SoC Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_qs_ofs_f2000x/ug_qs_ofs_f2000x/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference_manuals/ofs_fim/mnl_fim_ofs/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          FPGA Interface Manager Developer Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        FPGA Interface Manager Developer Guide
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    1 Introduction
  </a>
  
    <nav class="md-nav" aria-label="1 Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-about-this-document" class="md-nav__link">
    1.1 About This Document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-release-capabilities" class="md-nav__link">
    1.2 Release Capabilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-knowledge-prerequisites" class="md-nav__link">
    1.3 Knowledge Prerequisites
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-top-level-description" class="md-nav__link">
    2 Top Level Description
  </a>
  
    <nav class="md-nav" aria-label="2 Top Level Description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-top-level-fpga" class="md-nav__link">
    2.1 Top Level FPGA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-fim-fpga-resource-usage" class="md-nav__link">
    2.2 FIM FPGA Resource Usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-description-of-sub-systems" class="md-nav__link">
    3 Description of Sub-Systems
  </a>
  
    <nav class="md-nav" aria-label="3 Description of Sub-Systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-host-control-and-data-flow" class="md-nav__link">
    3.1 Host Control and Data Flow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-high-level-development-flow" class="md-nav__link">
    4 High Level Development Flow
  </a>
  
    <nav class="md-nav" aria-label="4 High Level Development Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-development-pre-requisites" class="md-nav__link">
    4.1 Development Pre-requisites
  </a>
  
    <nav class="md-nav" aria-label="4.1 Development Pre-requisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-tutorial-pre-requisites" class="md-nav__link">
    4.1.1 Tutorial Pre-requisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412-development-environment" class="md-nav__link">
    4.1.2 Development Environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-installation-of-ofs" class="md-nav__link">
    4.2 Installation of OFS
  </a>
  
    <nav class="md-nav" aria-label="4.2 Installation of OFS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-clone-the-ofs-git-repo" class="md-nav__link">
    4.2.1 Clone the OFS Git Repo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-directory-structure-of-ofs" class="md-nav__link">
    4.3 Directory Structure of OFS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-compiling-the-ofs-fim" class="md-nav__link">
    4.4 Compiling the OFS FIM
  </a>
  
    <nav class="md-nav" aria-label="4.4 Compiling the OFS FIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#441-setting-up-required-environment-variables" class="md-nav__link">
    4.4.1. Setting Up Required Environment Variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#442-compiling-the-fim" class="md-nav__link">
    4.4.2 Compiling the FIM
  </a>
  
    <nav class="md-nav" aria-label="4.4.2 Compiling the FIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#443-create-a-relocatable-pr-directory-tree-from-the-base_x16-fim" class="md-nav__link">
    4.4.3 Create a Relocatable PR Directory Tree from the base_x16 FIM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#444-compiling-the-ofs-fim-using-quartus-gui" class="md-nav__link">
    4.4.4 Compiling the OFS FIM Using Quartus GUI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-unit-level-simulation" class="md-nav__link">
    4.5 Unit Level Simulation
  </a>
  
    <nav class="md-nav" aria-label="4.5 Unit Level Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#451-run-comprehensive-unit-tests" class="md-nav__link">
    4.5.1 Run Comprehensive Unit Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#452-run-individual-unit-tests" class="md-nav__link">
    4.5.2 Run Individual Unit Tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-custom-fim-development-flow" class="md-nav__link">
    5 Custom FIM Development Flow
  </a>
  
    <nav class="md-nav" aria-label="5 Custom FIM Development Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-how-to-add-a-new-module-to-the-fim" class="md-nav__link">
    5.1 How to add a new module to the FIM
  </a>
  
    <nav class="md-nav" aria-label="5.1 How to add a new module to the FIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-board-peripheral-fabric-bpf" class="md-nav__link">
    5.1.1 Board Peripheral Fabric (BPF)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-soc-mmio-region" class="md-nav__link">
    5.1.2 SoC MMIO Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-hello-fim-csr" class="md-nav__link">
    5.1.3 Hello FIM CSR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514-files-to-edit-to-support-hello-fim" class="md-nav__link">
    5.1.4 Files to Edit to Support Hello FIM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#515-pre-requisites-for-adding-hello-fim" class="md-nav__link">
    5.1.5 Pre-Requisites for Adding Hello FIM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#516-file-modification" class="md-nav__link">
    5.1.6 File Modification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#517-unit-level-simulation-of-hello-fim-design" class="md-nav__link">
    5.1.7 Unit Level Simulation of Hello FIM Design
  </a>
  
    <nav class="md-nav" aria-label="5.1.7 Unit Level Simulation of Hello FIM Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5171-unit-level-simulation-file-modification" class="md-nav__link">
    5.1.7.1 Unit Level Simulation File Modification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5172-run-dfh-walker-simulation" class="md-nav__link">
    5.1.7.2 Run DFH Walker Simulation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#518-uvm-verfication-of-the-hellofim" class="md-nav__link">
    5.1.8 UVM Verfication of the HelloFIM
  </a>
  
    <nav class="md-nav" aria-label="5.1.8 UVM Verfication of the HelloFIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5181-uvm-simulation-file-modification" class="md-nav__link">
    5.1.8.1 UVM Simulation File Modification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5182-run-uvm-dfh-walker-simulation" class="md-nav__link">
    5.1.8.2 Run UVM DFH Walker Simulation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5183-run-uvm-mmio-simulation" class="md-nav__link">
    5.1.8.3 Run UVM MMIO Simulation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#519-compile-the-f2000x-design-with-hello-fim" class="md-nav__link">
    5.1.9 Compile the f2000x Design with Hello FIM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5110-program-the-f2000x-with-the-hellofim-design" class="md-nav__link">
    5.1.10 Program the f2000x with the HelloFIM Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5111-verify-the-hello-fim-design-on-the-f2000x-using-opae" class="md-nav__link">
    5.1.11 Verify the Hello FIM Design on the f2000x Using OPAE
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-how-to-debug-the-fim-with-signal-tap" class="md-nav__link">
    5.2 How to Debug the FIM with Signal Tap
  </a>
  
    <nav class="md-nav" aria-label="5.2 How to Debug the FIM with Signal Tap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#521-adding-signal-tap-to-the-hello-fim-example" class="md-nav__link">
    5.2.1 Adding Signal Tap to the Hello FIM example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#522-configuring-the-fpga-with-a-sof-image-via-jtag" class="md-nav__link">
    5.2.2 Configuring the FPGA with a SOF Image via JTAG
  </a>
  
    <nav class="md-nav" aria-label="5.2.2 Configuring the FPGA with a SOF Image via JTAG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5221-connecting-to-intel-fpga-download-cable" class="md-nav__link">
    5.2.2.1 Connecting to Intel FPGA Download Cable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5222-programming-the-agilex-fpga-via-jtag" class="md-nav__link">
    5.2.2.2 Programming the Agilex FPGA via JTAG
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#523-signal-tap-trace-acquisition-of-hello-fim-signals" class="md-nav__link">
    5.2.3 Signal Tap trace acquisition of Hello FIM signals
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-how-to-compile-the-fim-in-preparation-for-designing-your-afu" class="md-nav__link">
    5.3 How to compile the FIM in preparation for designing your AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-how-to-resize-the-partial-reconfiguration-region" class="md-nav__link">
    5.4 How to Resize the Partial Reconfiguration Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-how-to-modify-the-memory-subsystem" class="md-nav__link">
    5.5 How to modify the Memory Subsystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56-how-to-compile-the-fim-with-no-hssi" class="md-nav__link">
    5.6 How to compile the FIM with No HSSI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#57-how-to-change-the-pcie-device-id-and-vendor-id" class="md-nav__link">
    5.7 How to change the PCIe device ID and Vendor ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#571-changing-the-pcie-subsystem-device-id-and-vendor-id" class="md-nav__link">
    5.7.1 Changing the PCIe Subsystem Device ID and Vendor ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#58-how-to-migrate-to-a-different-agilex-device-number" class="md-nav__link">
    5.8 How to migrate to a different Agilex device number
  </a>
  
    <nav class="md-nav" aria-label="5.8 How to migrate to a different Agilex device number">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#581-migrating-to-a-larger-device-with-the-same-package" class="md-nav__link">
    5.8.1 Migrating To a Larger Device With the Same Package
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#59-how-to-change-ethernet-interface-from-8x25-gbe-to-8x10-gbe" class="md-nav__link">
    5.9 How to change Ethernet interface from 8x25 GbE to 8x10 GbE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#510-how-to-change-ethernet-interface-from-8-x-25-gbe-to-2-x-100-gbe" class="md-nav__link">
    5.10 How to change Ethernet interface from 8 X 25 GbE to 2 X 100 GbE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#511-how-to-add-more-transceiver-channels-the-ethernet-subsystem" class="md-nav__link">
    5.11 How to add more Transceiver channels the Ethernet Subsystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-how-to-modify-the-pfvf-mux-configuration" class="md-nav__link">
    5.12 How to modify the PF/VF MUX configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-how-to-create-a-minimal-fim" class="md-nav__link">
    5.13 How to Create a Minimal FIM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-single-event-upset-reporting" class="md-nav__link">
    6 Single Event Upset Reporting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../afu_dev/ug_dev_afu_ofs_f2000x/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_sim_ofs/ug_sim_ofs/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          oneAPI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          oneAPI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/oneapi_asp/ug_oneapi_asp/" class="md-nav__link">
        oneAPI ASP Getting Started User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/oneapi_asp/oneapi_asp_ref_mnl/" class="md-nav__link">
        oneAPI Accelerator Support Package(ASP) Reference Manual
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          OFS Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          OFS Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
          OPAE USER GUIDES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          OPAE USER GUIDES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/quick_start/readme/" class="md-nav__link">
        Quick Start Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/install_guide/installation_guide/" class="md-nav__link">
        OPAE Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/prog_guide/readme/" class="md-nav__link">
        OPAE C API Programming Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/pyopae/python_bindings/" class="md-nav__link">
        OPAE Python Bindings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/plug_guide/readme/" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          OPAE LIBRARIES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          OPAE LIBRARIES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/fpga_api/" class="md-nav__link">
        OPAE C API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/fpga_cxx_api/" class="md-nav__link">
        OPAE C++ Core API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/fpga_python_api/" class="md-nav__link">
        OPAE Python API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/plug_guide/readme/" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
          OPAE LINUX KERNEL DRIVERS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          OPAE LINUX KERNEL DRIVERS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/drv_arch/drv_arch/" class="md-nav__link">
        Open Programmable Accelerator Engine (OPAE) Linux Device Driver Architecture
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../sw/fpga_tools/fpgadiag/">OPAE FPGA TOOLS</a>
          
            <label for="__nav_6_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          OPAE FPGA TOOLS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgaconf/fpgaconf/" class="md-nav__link">
        fpgaconf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgainfo/fpgainfo/" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgasupdate/fpgasupdate/" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mmlink/mmlink/" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/packager/packager/" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/userclk/userclk/" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi/hssi/" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/pci_device/pci_device/" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opae.io/opae.io/" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/rsu/rsu/" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/host_exerciser/host_exerciser/" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssistats/" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssiloopback/" class="md-nav__link">
        HSSI ethernet loopback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mem_tg/mem_tg/" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/vabtool/vabtool/" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaevfio/opaevfio/" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/ofs.uio/ofs.uio/" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaeuio/opaeuio/" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgad/fpgad/" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    1 Introduction
  </a>
  
    <nav class="md-nav" aria-label="1 Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-about-this-document" class="md-nav__link">
    1.1 About This Document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-release-capabilities" class="md-nav__link">
    1.2 Release Capabilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-knowledge-prerequisites" class="md-nav__link">
    1.3 Knowledge Prerequisites
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-top-level-description" class="md-nav__link">
    2 Top Level Description
  </a>
  
    <nav class="md-nav" aria-label="2 Top Level Description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-top-level-fpga" class="md-nav__link">
    2.1 Top Level FPGA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-fim-fpga-resource-usage" class="md-nav__link">
    2.2 FIM FPGA Resource Usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-description-of-sub-systems" class="md-nav__link">
    3 Description of Sub-Systems
  </a>
  
    <nav class="md-nav" aria-label="3 Description of Sub-Systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-host-control-and-data-flow" class="md-nav__link">
    3.1 Host Control and Data Flow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-high-level-development-flow" class="md-nav__link">
    4 High Level Development Flow
  </a>
  
    <nav class="md-nav" aria-label="4 High Level Development Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-development-pre-requisites" class="md-nav__link">
    4.1 Development Pre-requisites
  </a>
  
    <nav class="md-nav" aria-label="4.1 Development Pre-requisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-tutorial-pre-requisites" class="md-nav__link">
    4.1.1 Tutorial Pre-requisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412-development-environment" class="md-nav__link">
    4.1.2 Development Environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-installation-of-ofs" class="md-nav__link">
    4.2 Installation of OFS
  </a>
  
    <nav class="md-nav" aria-label="4.2 Installation of OFS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-clone-the-ofs-git-repo" class="md-nav__link">
    4.2.1 Clone the OFS Git Repo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-directory-structure-of-ofs" class="md-nav__link">
    4.3 Directory Structure of OFS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-compiling-the-ofs-fim" class="md-nav__link">
    4.4 Compiling the OFS FIM
  </a>
  
    <nav class="md-nav" aria-label="4.4 Compiling the OFS FIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#441-setting-up-required-environment-variables" class="md-nav__link">
    4.4.1. Setting Up Required Environment Variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#442-compiling-the-fim" class="md-nav__link">
    4.4.2 Compiling the FIM
  </a>
  
    <nav class="md-nav" aria-label="4.4.2 Compiling the FIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#443-create-a-relocatable-pr-directory-tree-from-the-base_x16-fim" class="md-nav__link">
    4.4.3 Create a Relocatable PR Directory Tree from the base_x16 FIM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#444-compiling-the-ofs-fim-using-quartus-gui" class="md-nav__link">
    4.4.4 Compiling the OFS FIM Using Quartus GUI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-unit-level-simulation" class="md-nav__link">
    4.5 Unit Level Simulation
  </a>
  
    <nav class="md-nav" aria-label="4.5 Unit Level Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#451-run-comprehensive-unit-tests" class="md-nav__link">
    4.5.1 Run Comprehensive Unit Tests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#452-run-individual-unit-tests" class="md-nav__link">
    4.5.2 Run Individual Unit Tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-custom-fim-development-flow" class="md-nav__link">
    5 Custom FIM Development Flow
  </a>
  
    <nav class="md-nav" aria-label="5 Custom FIM Development Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-how-to-add-a-new-module-to-the-fim" class="md-nav__link">
    5.1 How to add a new module to the FIM
  </a>
  
    <nav class="md-nav" aria-label="5.1 How to add a new module to the FIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-board-peripheral-fabric-bpf" class="md-nav__link">
    5.1.1 Board Peripheral Fabric (BPF)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-soc-mmio-region" class="md-nav__link">
    5.1.2 SoC MMIO Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-hello-fim-csr" class="md-nav__link">
    5.1.3 Hello FIM CSR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514-files-to-edit-to-support-hello-fim" class="md-nav__link">
    5.1.4 Files to Edit to Support Hello FIM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#515-pre-requisites-for-adding-hello-fim" class="md-nav__link">
    5.1.5 Pre-Requisites for Adding Hello FIM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#516-file-modification" class="md-nav__link">
    5.1.6 File Modification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#517-unit-level-simulation-of-hello-fim-design" class="md-nav__link">
    5.1.7 Unit Level Simulation of Hello FIM Design
  </a>
  
    <nav class="md-nav" aria-label="5.1.7 Unit Level Simulation of Hello FIM Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5171-unit-level-simulation-file-modification" class="md-nav__link">
    5.1.7.1 Unit Level Simulation File Modification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5172-run-dfh-walker-simulation" class="md-nav__link">
    5.1.7.2 Run DFH Walker Simulation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#518-uvm-verfication-of-the-hellofim" class="md-nav__link">
    5.1.8 UVM Verfication of the HelloFIM
  </a>
  
    <nav class="md-nav" aria-label="5.1.8 UVM Verfication of the HelloFIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5181-uvm-simulation-file-modification" class="md-nav__link">
    5.1.8.1 UVM Simulation File Modification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5182-run-uvm-dfh-walker-simulation" class="md-nav__link">
    5.1.8.2 Run UVM DFH Walker Simulation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5183-run-uvm-mmio-simulation" class="md-nav__link">
    5.1.8.3 Run UVM MMIO Simulation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#519-compile-the-f2000x-design-with-hello-fim" class="md-nav__link">
    5.1.9 Compile the f2000x Design with Hello FIM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5110-program-the-f2000x-with-the-hellofim-design" class="md-nav__link">
    5.1.10 Program the f2000x with the HelloFIM Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5111-verify-the-hello-fim-design-on-the-f2000x-using-opae" class="md-nav__link">
    5.1.11 Verify the Hello FIM Design on the f2000x Using OPAE
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-how-to-debug-the-fim-with-signal-tap" class="md-nav__link">
    5.2 How to Debug the FIM with Signal Tap
  </a>
  
    <nav class="md-nav" aria-label="5.2 How to Debug the FIM with Signal Tap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#521-adding-signal-tap-to-the-hello-fim-example" class="md-nav__link">
    5.2.1 Adding Signal Tap to the Hello FIM example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#522-configuring-the-fpga-with-a-sof-image-via-jtag" class="md-nav__link">
    5.2.2 Configuring the FPGA with a SOF Image via JTAG
  </a>
  
    <nav class="md-nav" aria-label="5.2.2 Configuring the FPGA with a SOF Image via JTAG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5221-connecting-to-intel-fpga-download-cable" class="md-nav__link">
    5.2.2.1 Connecting to Intel FPGA Download Cable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5222-programming-the-agilex-fpga-via-jtag" class="md-nav__link">
    5.2.2.2 Programming the Agilex FPGA via JTAG
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#523-signal-tap-trace-acquisition-of-hello-fim-signals" class="md-nav__link">
    5.2.3 Signal Tap trace acquisition of Hello FIM signals
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-how-to-compile-the-fim-in-preparation-for-designing-your-afu" class="md-nav__link">
    5.3 How to compile the FIM in preparation for designing your AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-how-to-resize-the-partial-reconfiguration-region" class="md-nav__link">
    5.4 How to Resize the Partial Reconfiguration Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-how-to-modify-the-memory-subsystem" class="md-nav__link">
    5.5 How to modify the Memory Subsystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56-how-to-compile-the-fim-with-no-hssi" class="md-nav__link">
    5.6 How to compile the FIM with No HSSI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#57-how-to-change-the-pcie-device-id-and-vendor-id" class="md-nav__link">
    5.7 How to change the PCIe device ID and Vendor ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#571-changing-the-pcie-subsystem-device-id-and-vendor-id" class="md-nav__link">
    5.7.1 Changing the PCIe Subsystem Device ID and Vendor ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#58-how-to-migrate-to-a-different-agilex-device-number" class="md-nav__link">
    5.8 How to migrate to a different Agilex device number
  </a>
  
    <nav class="md-nav" aria-label="5.8 How to migrate to a different Agilex device number">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#581-migrating-to-a-larger-device-with-the-same-package" class="md-nav__link">
    5.8.1 Migrating To a Larger Device With the Same Package
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#59-how-to-change-ethernet-interface-from-8x25-gbe-to-8x10-gbe" class="md-nav__link">
    5.9 How to change Ethernet interface from 8x25 GbE to 8x10 GbE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#510-how-to-change-ethernet-interface-from-8-x-25-gbe-to-2-x-100-gbe" class="md-nav__link">
    5.10 How to change Ethernet interface from 8 X 25 GbE to 2 X 100 GbE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#511-how-to-add-more-transceiver-channels-the-ethernet-subsystem" class="md-nav__link">
    5.11 How to add more Transceiver channels the Ethernet Subsystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-how-to-modify-the-pfvf-mux-configuration" class="md-nav__link">
    5.12 How to modify the PF/VF MUX configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-how-to-create-a-minimal-fim" class="md-nav__link">
    5.13 How to Create a Minimal FIM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-single-event-upset-reporting" class="md-nav__link">
    6 Single Event Upset Reporting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="intel-fpga-interface-manager-developer-guide-intel-agilex-soc-attach-open-fpga-stack"><strong>Intel<sup>&reg;</sup> FPGA Interface Manager Developer Guide: Intel Agilex SoC Attach: Open FPGA Stack</strong><a class="headerlink" href="#intel-fpga-interface-manager-developer-guide-intel-agilex-soc-attach-open-fpga-stack" title="Permanent link">&para;</a></h1>
<p>Last updated: <strong>August 01, 2023</strong> </p>
<h2 id="1-introduction"><strong>1 Introduction</strong><a class="headerlink" href="#1-introduction" title="Permanent link">&para;</a></h2>
<h3 id="11-about-this-document"><strong>1.1 About This Document</strong><a class="headerlink" href="#11-about-this-document" title="Permanent link">&para;</a></h3>
<p>This document serves as a design guide for FPGA developers, system architects, and hardware developers using Open FPGA Stack (<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>) as a starting point for the creation of an FPGA Interface Manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>) for a custom FPGA acceleration board.   </p>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> addresses the demand for FPGA acceleration boards and workloads by providing a powerful methodology for the rapid development of FPGA Acceleration systems.  This methodology addresses the challenges and responsibilities of the board, platform, and workload developers by providing a complete FPGA project consisting of RTL and simulation code, build scripts, and software.  This provided FPGA project can be rapidly customized to meet new market requirements.</p>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> separates the FPGA design into two areas: FPGA Interface Manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>) and workload (or Acceleration Function Unit) as shown in the figure below:</p>
<p><a class="glightbox" href="../images/Agilex_Fabric_Features.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/Agilex_Fabric_Features.svg" /></a></p>
<p>As can be seen in this diagram, the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> FPGA structure has a natural separation into two distinct areas: </p>
<ul>
<li>FPGA Interface Manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> or sometimes called the "the shell") containing:<ul>
<li>FPGA external interfaces and IP cores (e.g. Ethernet, DDR-4, PCIe, etc)</li>
<li>PLLs/resets</li>
<li>FPGA - Board management infrastructure</li>
<li>Interface to Acceleration Function Unit (<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>)</li>
</ul>
</li>
<li>Acceleration Function Unit ("the workload")<ul>
<li>Uses the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> interfaces to perform useful work inside the FPGA</li>
<li>Contains logic supporting partial reconfiguration</li>
<li>Remote Signal Tap core for remote debugging of workload</li>
</ul>
</li>
</ul>
<p>This guide is organized as follows: </p>
<ul>
<li>Introduction</li>
<li>Top Level Block Diagram description<ul>
<li>Control and data flow</li>
</ul>
</li>
<li>Description of Sub-systems<ul>
<li>Command/status registers (CSR) and software interface</li>
<li>Clocking, resets, and interfaces</li>
<li>High-Speed Serial Interface Sub-System (HSSI-SS) - also known as the Ethernet Sub-System</li>
<li>External Memory Interface Sub-System (MEM-SS)</li>
</ul>
</li>
<li>High-level development flow description<ul>
<li>Installation of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> RTL and development packages</li>
<li>Compiling <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></li>
<li>Simulation  </li>
</ul>
</li>
<li>Design customization walkthroughs</li>
</ul>
<p>This document uses the  Intel® Infrastructure Processing Unit (Intel® IPU) Platform F2000X-PL as the main example platform to illustrate key points and demonstrate how to extend the capabilities provided in <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>.  The demonstration steps serve as a tutorial for the development of your <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> knowledge.  </p>
<p>This document covers <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> architecture lightly. For more details on the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> architecture, please see <a href="../../../reference_manuals/ofs_fim/mnl_fim_ofs/">Open FPGA Stack Technical Reference Manual</a>.</p>
<h3 id="12-release-capabilities"><strong>1.2 Release Capabilities</strong><a class="headerlink" href="#12-release-capabilities" title="Permanent link">&para;</a></h3>
<p>Agilex SoC Attach <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> supports the following features.</p>
<table>
<thead>
<tr>
<th></th>
<th><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> BASE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Intel IPU Platform F2000X-PL</td>
<td>f2000x</td>
</tr>
<tr>
<td>PCIe Configuration</td>
<td>Host: PCIe Gen4x16<br />SoC: PCIe Gen4x16</td>
</tr>
<tr>
<td><abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr> support</td>
<td>Host: 2 PFs, No VFs<br />SoC:  1 PFs, 3 VFs</td>
</tr>
<tr>
<td>AXI ST datapath</td>
<td>512b @ 470MHz</td>
</tr>
<tr>
<td>Transceiver Subsystem Configuration</td>
<td>2x4x25G</td>
</tr>
</tbody>
</table>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> also integrates:</p>
<ul>
<li>SoC <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and Host <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></li>
<li>Exercisers demonstrating PCIe, external memory, and Ethernet interfaces</li>
<li><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> CSR</li>
<li>Remote Signal Tap</li>
<li>Partial Reconfiguration</li>
</ul>
<p>The Host exercisers are provided for the quick evaluation of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and can be leveraged for the verification of the platform's functionality and capabilities.  The host exercisers can be removed by the designer to release FPGA real estate to accommodate new workload functions. To compile the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> without host exercisers go to <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#53-how-to-compile-the-fim-in-preparation-for-designing-your-afu">How to compile the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> in preparation for designing your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></a>.</p>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> is extensible to meet the needs of a broad set of customer applications.  The general use cases listed below are examples where the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> base design is easily extended to build a custom <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>:</p>
<ol>
<li>Use <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> design example as-is<ul>
<li>Porting the code to another platform that is identical to <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> reference platform changing targeted FPGA device and pinout</li>
<li>Change I/O assignments without changing design</li>
</ul>
</li>
<li>Update the configuration of peripheral IP in <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> design example, not affecting <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> architecture<ul>
<li>External memory settings</li>
<li>Ethernet Subsystem analog settings</li>
</ul>
</li>
<li>Remove/update peripheral feature in <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> design example, not affecting <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> architecture<ul>
<li>External memory speed/width change</li>
<li>Change number of VFs supported</li>
</ul>
</li>
<li>Add new features as an extension to <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> design example, not affecting the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> architecture<ul>
<li>Add/remove external memory interface to the design</li>
<li>Add/remove user clocks for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></li>
<li>Add/remove IP to the design with connection to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></li>
</ul>
</li>
</ol>
<h3 id="13-knowledge-prerequisites"><strong>1.3 Knowledge Prerequisites</strong><a class="headerlink" href="#13-knowledge-prerequisites" title="Permanent link">&para;</a></h3>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> is an advanced application of FPGA technology. This guide assumes you have the following FPGA logic design-related knowledge and skills:</p>
<ul>
<li>FPGA compilation flows using Intel<sup>&reg;</sup> Quartus<sup>&reg;</sup> Prime Pro Edition Version 23.1.</li>
<li>Static Timing closure, including familiarity with the Timing Analyzer tool in Intel<sup>&reg;</sup> Quartus<sup>&reg;</sup> Prime Pro Edition Version 23.1, applying timing constraints, Synopsys* Design Constraints (.sdc) language and Tcl scripting, and design methods to close on timing critical paths.</li>
<li>RTL (System Verilog) and coding practices to create synthesized logic.</li>
<li>RTL simulation tools.</li>
<li>Intel<sup>&reg;</sup> Quartus<sup>&reg;</sup> Prime Pro Edition Signal Tap Logic Analyzer tool software.</li>
</ul>
<h2 id="2-top-level-description"><strong>2 Top Level Description</strong><a class="headerlink" href="#2-top-level-description" title="Permanent link">&para;</a></h2>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> targets operation in the  Intel® Infrastructure Processing Unit (Intel® IPU) Platform F2000X-PL the block diagram is shown below.  </p>
<p><a class="glightbox" href="../images/Agilex_Fabric_Features.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/Agilex_Fabric_Features.svg" /></a></p>
<ul>
<li>Host interface <ul>
<li>PCIe Gen4 x 16</li>
</ul>
</li>
<li>SoC Interface<ul>
<li>PCIe Gen4 x 16</li>
</ul>
</li>
<li>Network interface<ul>
<li>2 - QSFP28/56 cages</li>
<li>Eight Arm® AMBA® 4 AXI4-Stream channels of 25G Ethernet interfacing to an E-tile Ethernet Subsystem.</li>
</ul>
</li>
<li>External Memory - DDR4<ul>
<li>Four Fabric DDR4 banks, 1200 MHz, 4GB, x32 no ECC (optionally can be configured x40 with ECC or x8 no ECC)</li>
</ul>
</li>
<li>Board Management<ul>
<li>SPI interface</li>
<li>FPGA configuration</li>
</ul>
</li>
</ul>
<h3 id="21-top-level-fpga"><strong>2.1 Top Level FPGA</strong><a class="headerlink" href="#21-top-level-fpga" title="Permanent link">&para;</a></h3>
<p>The internal FPGA architecture is shown below:</p>
<p><a class="glightbox" href="../images/IOFS_HW_Arch_Spec_diagrams.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/IOFS_HW_Arch_Spec_diagrams.svg" /></a></p>
<p>The following Platform Designer IP subsystems are used to implement the following:</p>
<ul>
<li>P-tile PCIe Subsystem</li>
<li>E-Tile Ethernet Subsystem</li>
<li>Memory Subsystem</li>
</ul>
<p>Documentation on the above Platform Designer IP subsystems is available by request to your Intel support team.</p>
<h3 id="22-fim-fpga-resource-usage"><strong>2.2 <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> FPGA Resource Usage</strong><a class="headerlink" href="#22-fim-fpga-resource-usage" title="Permanent link">&para;</a></h3>
<p>The provided design includes both required board management and control functions as well as optional interface exerciser logic that both creates transactions and validates operations.  These exerciser modules include:</p>
<ul>
<li>HE_MEM - this module creates external memory transactions to the DDR4 memory and then verifies the responses.</li>
<li>HE_MEM-TG -The memory traffic generator (TG) <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> provides a way for users to characterize local memory channel bandwidth with a variety of traffic configuration features including request burst size, read/write interleave count, address offset, address strobe, and data pattern.</li>
<li>HE_HSSI - this module creates ethernet transactions to the HSSI Subsystem and then verifies the responses.</li>
</ul>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> uses a small portion of the available FPGA resources.  The table below shows resource usage for a base <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> built with 2 channels of external memory, a small <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> instantiated that has host CSR read/write, external memory test and Ethernet test functionality.</p>
<blockquote>
<p><strong>Note:</strong> The host exerciser modules allow you to evaluate the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> in hardware and are removed when you begin development. </p>
</blockquote>
<p>The AGFC023R25A2E2VR0  FPGA has the following resources available for base <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design :</p>
<table>
<thead>
<tr>
<th>Resource</th>
<th>needed / total on device (%)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Logic utilization (ALMs)</td>
<td>229,622 / 782,400 ( 29 % )</td>
</tr>
<tr>
<td>M20K blocks</td>
<td>1,241 / 10,464 (12 %)</td>
</tr>
<tr>
<td>Pins</td>
<td>518 / 742 ( 70 % )</td>
</tr>
<tr>
<td>IOPLLs</td>
<td>10 / 15 ( 67 % )</td>
</tr>
</tbody>
</table>
<p>The resource usage for the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> base:</p>
<table>
<thead>
<tr>
<th>Entity Name</th>
<th>ALMs needed</th>
<th>ALM Utilization %</th>
<th>M20Ks</th>
<th>M20K Utilization %</th>
</tr>
</thead>
<tbody>
<tr>
<td>top</td>
<td>229,646.10</td>
<td>29.35</td>
<td>1241</td>
<td>11.86</td>
</tr>
<tr>
<td>soc_afu</td>
<td>87,364.80</td>
<td>11.17</td>
<td>273</td>
<td>2.61</td>
</tr>
<tr>
<td>soc_pcie_wrapper</td>
<td>37,160.80</td>
<td>4.75</td>
<td>195</td>
<td>1.86</td>
</tr>
<tr>
<td>pcie_wrapper</td>
<td>36,233.40</td>
<td>4.63</td>
<td>187</td>
<td>1.79</td>
</tr>
<tr>
<td>host_afu</td>
<td>26,462.20</td>
<td>3.38</td>
<td>140</td>
<td>1.34</td>
</tr>
<tr>
<td>hssi_wrapper</td>
<td>20,066.30</td>
<td>2.56</td>
<td>173</td>
<td>1.65</td>
</tr>
<tr>
<td>pmci_wrapper</td>
<td>8,449.90</td>
<td>1.08</td>
<td>186</td>
<td>1.78</td>
</tr>
<tr>
<td>mem_ss_top</td>
<td>7,907.10</td>
<td>1.01</td>
<td>60</td>
<td>0.57</td>
</tr>
<tr>
<td>auto_fab_0</td>
<td>2,708.90</td>
<td>0.35</td>
<td>13</td>
<td>0.12</td>
</tr>
<tr>
<td>soc_bpf</td>
<td>1,210.20</td>
<td>0.15</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>qsfp_1</td>
<td>635.50</td>
<td>0.08</td>
<td>4</td>
<td>0.04</td>
</tr>
<tr>
<td>qsfp_0</td>
<td>628.70</td>
<td>0.08</td>
<td>4</td>
<td>0.04</td>
</tr>
<tr>
<td>fme_top</td>
<td>628.60</td>
<td>0.08</td>
<td>6</td>
<td>0.06</td>
</tr>
<tr>
<td>host_soc_rst_bridge</td>
<td>151.40</td>
<td>0.02</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>rst_ctrl</td>
<td>16.80</td>
<td>0.00</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>soc_rst_ctrl</td>
<td>16.50</td>
<td>0.00</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>sys_pll</td>
<td>0.50</td>
<td>0.00</td>
<td>0</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p>The following example without the he_lb,he_hssi,he_mem,he_mem_tg:</p>
<table>
<thead>
<tr>
<th>Entity Name</th>
<th>ALMs needed</th>
<th>ALM Utilization %</th>
<th>M20Ks</th>
<th>M20K Utilization %</th>
</tr>
</thead>
<tbody>
<tr>
<td>top</td>
<td>162,010.20</td>
<td>20.71</td>
<td>992</td>
<td>9.48</td>
</tr>
<tr>
<td>pcie_wrapper</td>
<td>36,771.70</td>
<td>4.70</td>
<td>195</td>
<td>1.86</td>
</tr>
<tr>
<td>soc_afu_top</td>
<td>34,851.30</td>
<td>4.45</td>
<td>85</td>
<td>0.81</td>
</tr>
<tr>
<td>pcie_wrapper</td>
<td>33,358.90</td>
<td>4.26</td>
<td>175</td>
<td>1.67</td>
</tr>
<tr>
<td>hssi_wrapper</td>
<td>20,109.90</td>
<td>2.57</td>
<td>173</td>
<td>1.65</td>
</tr>
<tr>
<td>afu_top</td>
<td>14,084.20</td>
<td>1.80</td>
<td>91</td>
<td>0.87</td>
</tr>
<tr>
<td>pmci_wrapper</td>
<td>8,447.90</td>
<td>1.08</td>
<td>186</td>
<td>1.78</td>
</tr>
<tr>
<td>mem_ss_top</td>
<td>8,379.70</td>
<td>1.07</td>
<td>60</td>
<td>0.57</td>
</tr>
<tr>
<td>alt_sld_fab_0</td>
<td>2,725.10</td>
<td>0.35</td>
<td>13</td>
<td>0.12</td>
</tr>
<tr>
<td>bpf_top</td>
<td>1,213.00</td>
<td>0.16</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>fme_top</td>
<td>638.30</td>
<td>0.08</td>
<td>6</td>
<td>0.06</td>
</tr>
<tr>
<td>qsfp_top</td>
<td>626.70</td>
<td>0.08</td>
<td>4</td>
<td>0.04</td>
</tr>
<tr>
<td>qsfp_top</td>
<td>619.20</td>
<td>0.08</td>
<td>4</td>
<td>0.04</td>
</tr>
<tr>
<td>axi_lite_rst_bridge</td>
<td>147.40</td>
<td>0.02</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>rst_ctrl</td>
<td>17.40</td>
<td>0.00</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>rst_ctrl</td>
<td>15.90</td>
<td>0.00</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>sys_pll</td>
<td>0.50</td>
<td>0.00</td>
<td>0</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p>The following example without the Ethernet Subsystem (no_hssi):</p>
<table>
<thead>
<tr>
<th>Entity Name</th>
<th>ALMs needed</th>
<th>ALM Utilization %</th>
<th>M20Ks</th>
<th>M20K Utilization %</th>
</tr>
</thead>
<tbody>
<tr>
<td>top</td>
<td>189,827.00</td>
<td>24.26</td>
<td>980</td>
<td>9.37</td>
</tr>
<tr>
<td>soc_afu_top</td>
<td>67,751.40</td>
<td>8.66</td>
<td>197</td>
<td>1.88</td>
</tr>
<tr>
<td>pcie_wrapper</td>
<td>36,909.30</td>
<td>4.72</td>
<td>195</td>
<td>1.86</td>
</tr>
<tr>
<td>pcie_wrapper</td>
<td>36,077.70</td>
<td>4.61</td>
<td>187</td>
<td>1.79</td>
</tr>
<tr>
<td>afu_top</td>
<td>26,549.40</td>
<td>3.39</td>
<td>140</td>
<td>1.34</td>
</tr>
<tr>
<td>pmci_wrapper</td>
<td>8,688.10</td>
<td>1.11</td>
<td>186</td>
<td>1.78</td>
</tr>
<tr>
<td>mem_ss_top</td>
<td>8,079.00</td>
<td>1.03</td>
<td>60</td>
<td>0.57</td>
</tr>
<tr>
<td>alt_sld_fab_0</td>
<td>1,751.90</td>
<td>0.22</td>
<td>9</td>
<td>0.09</td>
</tr>
<tr>
<td>bpf_top</td>
<td>1,186.00</td>
<td>0.15</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>dummy_csr</td>
<td>664.70</td>
<td>0.08</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>dummy_csr</td>
<td>662.80</td>
<td>0.08</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>dummy_csr</td>
<td>661.20</td>
<td>0.08</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>fme_top</td>
<td>649.40</td>
<td>0.08</td>
<td>6</td>
<td>0.06</td>
</tr>
<tr>
<td>axi_lite_rst_bridge</td>
<td>161.70</td>
<td>0.02</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>rst_ctrl</td>
<td>16.30</td>
<td>0.00</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>rst_ctrl</td>
<td>16.00</td>
<td>0.00</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>sys_pll</td>
<td>0.50</td>
<td>0.00</td>
<td>0</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<p>The following example without the Ethernet Subsystem (no_hssi) + no host exercisers (he_lb, he_hssi, he_mem, he_mem_tg):</p>
<table>
<thead>
<tr>
<th>Entity Name</th>
<th>ALMs needed</th>
<th>ALM Utilization %</th>
<th>M20Ks</th>
<th>M20K Utilization %</th>
</tr>
</thead>
<tbody>
<tr>
<td>top</td>
<td>139,105.70</td>
<td>17.78</td>
<td>807</td>
<td>7.71</td>
</tr>
<tr>
<td>pcie_wrapper</td>
<td>36,518.80</td>
<td>4.67</td>
<td>195</td>
<td>1.86</td>
</tr>
<tr>
<td>pcie_wrapper</td>
<td>33,234.50</td>
<td>4.25</td>
<td>175</td>
<td>1.67</td>
</tr>
<tr>
<td>soc_afu_top</td>
<td>32,700.00</td>
<td>4.18</td>
<td>85</td>
<td>0.81</td>
</tr>
<tr>
<td>afu_top</td>
<td>14,178.20</td>
<td>1.81</td>
<td>91</td>
<td>0.87</td>
</tr>
<tr>
<td>pmci_wrapper</td>
<td>8,693.20</td>
<td>1.11</td>
<td>186</td>
<td>1.78</td>
</tr>
<tr>
<td>mem_ss_top</td>
<td>7,999.00</td>
<td>1.02</td>
<td>60</td>
<td>0.57</td>
</tr>
<tr>
<td>alt_sld_fab_0</td>
<td>1,758.40</td>
<td>0.22</td>
<td>9</td>
<td>0.09</td>
</tr>
<tr>
<td>bpf_top</td>
<td>1,183.50</td>
<td>0.15</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>dummy_csr</td>
<td>667.20</td>
<td>0.09</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>dummy_csr</td>
<td>666.30</td>
<td>0.09</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>dummy_csr</td>
<td>663.10</td>
<td>0.08</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>fme_top</td>
<td>652.80</td>
<td>0.08</td>
<td>6</td>
<td>0.06</td>
</tr>
<tr>
<td>axi_lite_rst_bridge</td>
<td>153.80</td>
<td>0.02</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>rst_ctrl</td>
<td>18.20</td>
<td>0.00</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>rst_ctrl</td>
<td>16.50</td>
<td>0.00</td>
<td>0</td>
<td>0.00</td>
</tr>
<tr>
<td>sys_pll</td>
<td>0.50</td>
<td>0.00</td>
<td>0</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<h2 id="3-description-of-sub-systems"><strong>3 Description of Sub-Systems</strong><a class="headerlink" href="#3-description-of-sub-systems" title="Permanent link">&para;</a></h2>
<h3 id="31-host-control-and-data-flow"><strong>3.1 Host Control and Data Flow</strong><a class="headerlink" href="#31-host-control-and-data-flow" title="Permanent link">&para;</a></h3>
<p>The host control and data flow is shown in the diagram below:</p>
<p><a class="glightbox" href="../images/OFS-Datapaths.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/OFS-Datapaths.PNG" /></a></p>
<p>The control and data paths are composed of the following:</p>
<ul>
<li>Host Interface Adapter (PCIe)</li>
<li>SoC Interface Adapter (PCIe)</li>
<li>Low Performance Peripherals<ul>
<li>Slow speed peripherals (<abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr>, I2C, Smbus, etc)</li>
<li>Management peripherals (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>)</li>
</ul>
</li>
<li>High Performance Peripherals<ul>
<li>Memory peripherals</li>
<li>Acceleration Function peripherals (eg. AFUs)</li>
<li>HPS Peripheral</li>
</ul>
</li>
<li>Fabrics<ul>
<li>Peripheral Fabric (multi drop)</li>
<li><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Streaming fabric (point to point)</li>
</ul>
</li>
</ul>
<p>Peripherals are connected to one another using AXI, either:</p>
<ul>
<li>Via the peripheral fabric (AXI4-Lite, multi drop)</li>
<li>Via the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> streaming fabric (AXI-S, point to point)</li>
</ul>
<p>Peripherals are presented to software as:</p>
<ul>
<li><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> managed peripherals that implement DFH CSR structure.  </li>
<li>Native driver managed peripherals (i.e. Exposed via an independent PF, VF)</li>
</ul>
<p>The peripherals connected to the peripheral fabric are primarily Intel OPAE managed resources, whereas the peripherals connected to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> are “primarily” managed by native OS drivers. The word “primarily” is used since the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is not mandated to expose all its peripherals to Intel OPAE. </p>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> uses a defined set of CSRs to expose the functionality of the FPGA to the host software.  These registers are described in <a href="../../../reference_manuals/ofs_fim/mnl_fim_ofs/#6-mmio-regions">Open FPGA Stack Reference Manual - <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Regions section</a>.</p>
<p>If you make changes to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> that affect the software operation, then <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> provides a mechanism to communicate that information to the proper software driver that works with your new hardware.  The <a href="../../../reference_manuals/ofs_fim/mnl_fim_ofs/#611-device-feature-header-dfh-structure">Device Feature Header (DFH) structure</a> is followed to provide compatibility with OPAE software.  Please see <a href="https://github.com/OPAE/linux-dfl/blob/fpga-ofs-dev/Documentation/fpga/dfl.rst#fpga-device-feature-list-dfl-framework-overview">FPGA Device Feature List (<abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>) Framework Overview</a> for a description of <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> operation from the driver perspective.</p>
<p>In the default design, the SoC and Host AFUs are isolated from each other. You must develop mechanisms for Host - SoC communication if desired.</p>
<blockquote>
<p><strong>Note:</strong> The default configuration of the Board Peripheral Fabric, there is a connection from the Host Interface to the PMCI-SS, however the PMCI-SS is not in the Host <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>, and is not discovered by Host SW by default. If you want to guarantee that the Host can not access the PMCI-SS, and by extension the Board <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr>, you must implement a filtering mechanism, for example, in the Host ST2MM module to prevent access to the PMCI-SS address space.</p>
</blockquote>
<p>Refer to the following documents for more information on sub-systems:</p>
<ul>
<li><a href="https://github.com/OFS/ofs.github.io/blob/main/docs/hw/common/user_guides/ug_qs_pcie_ss.pdf">Intel FPGA PCI Express Subsystem IP User Guide</a></li>
<li><a href="https://github.com/OFS/ofs.github.io/docs/hw/common/user_guides/ug_qs_mem_ss.pdf">Intel FPGA Memory Subsystem IP User Guide</a></li>
<li><a href="https://www.intel.com/content/www/us/en/docs/programmable/773413/23-1-22-5-0/introduction.html">Intel FPGA Ethernet Subsystem IP User Guide</a></li>
</ul>
<h2 id="4-high-level-development-flow"><strong>4 High Level Development Flow</strong><a class="headerlink" href="#4-high-level-development-flow" title="Permanent link">&para;</a></h2>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> provides a framework of FPGA synthesizable code, simulation environment, and synthesis/simulation scripts.  <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> designers can use the provided code as-is, modify the provided code, or add new code to meet your specific product requirements. The instructions provided after this point are for you to either evaluate the existing design (the current section) or to modify and generate your own design (described in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#5-custom-fim-development-flow">Custom <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Development Flow</a> section). </p>
<h3 id="41-development-pre-requisites"><strong>4.1 Development Pre-requisites</strong><a class="headerlink" href="#41-development-pre-requisites" title="Permanent link">&para;</a></h3>
<p>The following pre-requisites must be satisfied to go through the development flow.</p>
<h4 id="411-tutorial-pre-requisites"><strong>4.1.1 Tutorial Pre-requisites</strong><a class="headerlink" href="#411-tutorial-pre-requisites" title="Permanent link">&para;</a></h4>
<p>To run the FPGA compilation steps covered in this guide, requires the following:</p>
<ol>
<li>Workstation or server with a Intel<sup>&reg;</sup> Quartus<sup>&reg;</sup> Prime Pro Edition Version 23.1 installed on a Intel Quartus Prime Pro-supported Linux distribution.  See <a href="https://www.intel.com/content/www/us/en/support/programmable/support-resources/design-software/os-support.html">Operating System Support</a>.  The Linux distribution known to work with this version of Ubuntu 22.04 . Note, Windows is not supported.</li>
<li>Compilation targeting Agilex devices requires a minimum of 64 GB of RAM.</li>
<li>Simulation of lower level functionality (not chip level) is supported by Synopsys<sup>&reg;</sup> VCS and Mentor Graphics<sup>&reg;</sup> QuestaSim SystemVerilog simulators.</li>
<li>Simulation of chip level requires Synopsys VCS and VIP</li>
</ol>
<h4 id="412-development-environment"><strong>4.1.2 Development Environment</strong><a class="headerlink" href="#412-development-environment" title="Permanent link">&para;</a></h4>
<p>To run the tutorial steps in this guide requires this development environment:</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>Intel Quartus Prime Pro</td>
<td>23.1</td>
</tr>
<tr>
<td><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr></td>
<td><strong>Branch Tag:</strong> release/2.5.0</td>
</tr>
<tr>
<td>Simulator</td>
<td>Synopsys VCS P-2019.06-SP2-5 or newer for <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> simulation of top level <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></td>
</tr>
<tr>
<td>Python</td>
<td>3.7.7</td>
</tr>
<tr>
<td>GCC</td>
<td>7.2.0</td>
</tr>
<tr>
<td>cmake</td>
<td>3.11.4</td>
</tr>
<tr>
<td>git with git-lfs</td>
<td>1.8.3.1</td>
</tr>
<tr>
<td>PERL</td>
<td>5.8.8</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note:</strong> Steps to install Intel Quartus Prime Pro are provided in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#42-installation-of-ofs">Installation of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr></a> section.</p>
</blockquote>
<p>To install the <code>Git Large File Storage (LFS)</code> extension run the following commands:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>curl<span class="w"> </span>-s<span class="w"> </span>https://packagecloud.io/install/repositories/github/git-lfs/script.rpm.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>bash
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>git-lfs
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>git<span class="w"> </span>lfs<span class="w"> </span>install
</code></pre></div>
<p>To test FPGA image files on hardware, this version of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> only targets  Intel IPU Platform F2000X-PL. You may modify the build scripts and pin files to target different boards with Agilex FPGA devices.</p>
<h3 id="42-installation-of-ofs"><strong>4.2 Installation of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr></strong><a class="headerlink" href="#42-installation-of-ofs" title="Permanent link">&para;</a></h3>
<p>In this section you set up a development machine for compiling the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. These steps are separate from the setup for a deployment machine where the FPGA acceleration card is installed.  Typically, FPGA development and deployment work is performed on separate machines, however, both development and deployment can be performed on the same server if desired.  Please see the <a href="https://ofs.github.io/hw/f2000x/user_guides/ug_qs_ofs_f2000x/ug_qs_ofs_f2000x/">Getting Started Guide: Intel® Open FPGA Stack for Intel FPGA</a> for instructions on installing software for deployment of your FPGA <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and software application on a server.  </p>
<p>Building the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> requires the build machine to have at least 64 GB of RAM.  </p>
<p>The following is a summary of the steps to set up for <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> development:</p>
<ol>
<li>Install Intel<sup>&reg;</sup> Quartus<sup>&reg;</sup> Prime Pro Edition Version 23.1 Linux with Agilex device support</li>
<li>Make sure support tools are installed and meet version requirements</li>
<li>Clone the  repository</li>
<li>Install required Intel Quartus Prime Pro patches which are included in the cloned <code>ofs-f2000x</code> repository</li>
<li>Review the files provided in the repo</li>
<li>Test installation by building the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></li>
</ol>
<p><strong>Intel<sup>&reg;</sup> Quartus<sup>&reg;</sup> Prime Pro Edition Version 23.1</strong> is the currently verified version of Intel Quartus Prime Pro used for building the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> images.  Porting to newer versions of Intel Quartus Prime Pro may be performed by developers, however, you will need to verify operation.</p>
<p>The recommended Best Known Configuration (<abbr title="Best Known Configuration, The exact hardware configuration Intel has optimized and validated the solution against.">BKC</abbr>) for development of the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> is Ubuntu 22.04, which is the assumed operating system for this developer guide. </p>
<ol>
<li>
<p>Prior to installing Intel Quartus Prime Pro, perform the following steps to satisfy the required dependencies.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>gcc<span class="w"> </span>gcc-c++<span class="w"> </span>make<span class="w"> </span>cmake<span class="w"> </span>libuuid-devel<span class="w"> </span>rpm-build<span class="w"> </span>autoconf<span class="w"> </span>automake<span class="w"> </span>bison<span class="w"> </span>boost<span class="w"> </span>boost-devel<span class="w"> </span>libxml2<span class="w"> </span>libxml2-devel<span class="w"> </span>make<span class="w"> </span>ncurses<span class="w"> </span>grub2<span class="w"> </span>bc<span class="w"> </span>csh<span class="w"> </span>flex<span class="w"> </span>glibc-locale-source<span class="w"> </span>libnsl<span class="w"> </span>ncurses-compat-libs<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Apply the following configurations.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sudo<span class="w"> </span>localedef<span class="w"> </span>-f<span class="w"> </span>UTF-8<span class="w"> </span>-i<span class="w"> </span>en_US<span class="w"> </span>en_US.UTF-8<span class="w"> </span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/usr/lib64/libncurses.so.6<span class="w"> </span>/usr/lib64/libncurses.so.5<span class="w"> </span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/usr/bin/python3<span class="w"> </span>/usr/bin/python
</code></pre></div>
</li>
<li>
<p>Download <a href="https://www.intel.com/content/www/us/en/software-kit/746666/intel-quartus-prime-pro-edition-design-software-version-23-1-for-linux.html">Intel® Quartus® Prime Pro Edition Linux</a>.</p>
</li>
<li>
<p>After running the Quartus Prime Pro installer, set the PATH environment variable to make utilities <code>quartus</code>, <code>jtagconfig</code>, and <code>quartus_pgm</code> discoverable. Edit your bashrc file <code>~/.bashrc</code> to add the following line:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>&lt;Quartus<span class="w"> </span>install<span class="w"> </span>directory&gt;/quartus/bin:<span class="nv">$PATH</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>&lt;Quartus<span class="w"> </span>install<span class="w"> </span>directory&gt;/qsys/bin:<span class="nv">$PATH</span>
</code></pre></div>
<p>For example, if the Intel Quartus Prime Pro install directory is /home/intelFPGA_pro/23.1 then the new line is:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/home/intelFPGA_pro/23.1/quartus/bin:<span class="nv">$PATH</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/home/intelFPGA_pro/23.1/qsys/bin:<span class="nv">$PATH</span>
</code></pre></div>
</li>
<li>
<p>Verify, Intel Quartus Prime Pro is discoverable by opening a new shell:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>which<span class="w"> </span>quartus
</code></pre></div>
<p>Example output:
  <div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>/home/intelFPGA_pro/23.1/quartus/bin/quartus
</code></pre></div></p>
</li>
</ol>
<h4 id="421-clone-the-ofs-git-repo"><strong>4.2.1 Clone the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Git Repo</strong><a class="headerlink" href="#421-clone-the-ofs-git-repo" title="Permanent link">&para;</a></h4>
<p>Retrieve the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> source code from the <a href="https://github.com/OFS/ofs-f2000x-pl"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> f2000x <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Github Branch</a> repository. Create a new directory to use as a clean starting point to store the retrieved files.  The following is a short description of each repository, followed by the git commands for cloning.  The instructions section uses the HTTPS git method for cloning repositories.</p>
<ol>
<li>
<p>Navigate to the location you want to clone the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> source files, and create the top-level source directory.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>mkdir<span class="w"> </span>IOFS_BUILD_ROOT
</code></pre></div>
</li>
<li>
<p>Clone <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repositories.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nb">cd</span><span class="w"> </span>IOFS_BUILD_ROOT
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>git<span class="w"> </span>clone<span class="w"> </span>--recurse-submodules<span class="w"> </span>https://github.com/OFS/ofs-f2000x-pl
</code></pre></div>
</li>
<li>
<p>Checkout the proper tag</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nb">cd</span><span class="w"> </span>ofs-f2000x-pl
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>git<span class="w"> </span>checkout<span class="w"> </span>--recurse-submodules<span class="w"> </span>tags/ofs-2023.1-1
</code></pre></div>
</li>
<li>
<p>Ensure that <code>ofs-common</code> has been cloned as well</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>git<span class="w"> </span>submodule<span class="w"> </span>status
</code></pre></div>
<p>Example output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>ea585a4f48d50faf3ae7ecfbec82525a8d22c730<span class="w"> </span>ofs-common<span class="w"> </span><span class="o">(</span>ofs-2023.1-1<span class="o">)</span>
</code></pre></div>
</li>
</ol>
<h3 id="43-directory-structure-of-ofs"><strong>4.3 Directory Structure of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr></strong><a class="headerlink" href="#43-directory-structure-of-ofs" title="Permanent link">&para;</a></h3>
<p>List the directory contents of the cloned repo to verify that the following directories and files are present in <code>$IOFS_BUILD_ROOT/ofs-f2000x</code> directory.  </p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>ls<span class="w"> </span>-1
</code></pre></div>
Expected output:
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>external
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>ipss
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>LICENSE.txt
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>ofs-common
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>sim
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>src
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>syn
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>tools
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>verification
</code></pre></div></p>
<p>Use the following command to show how the directories are arranged:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>find<span class="w"> </span>.<span class="w"> </span>-mindepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">2</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-not<span class="w"> </span>-path<span class="w"> </span><span class="s1">&#39;*/\.*&#39;</span><span class="w"> </span>-print<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/[^-][^\/]*\//--/g&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/--/|  /g&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/|-/|   /g&#39;</span>
</code></pre></div>
Expected output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="p">|</span><span class="w">  </span>eval_scripts
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="p">|</span><span class="w">  </span>ipss
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>hssi
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>mem
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>pcie
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>pmci
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>qsfp
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="p">|</span><span class="w">  </span>ofs-common
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>scripts
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>src
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>tools
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>verification
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="p">|</span><span class="w">  </span>sim
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>bfm
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>common
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>scripts
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>unit_test
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="p">|</span><span class="w">  </span>src
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>afu_top
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>includes
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>pd_qsys
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>top
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="p">|</span><span class="w">  </span>syn
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>scripts
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>setup
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>syn_top
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="p">|</span><span class="w">  </span>tools
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>pfvf_config_tool
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="p">|</span><span class="w">  </span>verification
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>scripts
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>testbench
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>tests
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>unit_tb
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="p">|</span><span class="w">  </span><span class="p">|</span><span class="w">  </span>verifplan
</code></pre></div>
<h3 id="44-compiling-the-ofs-fim"><strong>4.4 Compiling the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></strong><a class="headerlink" href="#44-compiling-the-ofs-fim" title="Permanent link">&para;</a></h3>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> provides a build script with the following FPGA image creation options:</p>
<ul>
<li>Flat compile which combines the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> into one FPGA image that is loaded into the entire FPGA device</li>
<li>A <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> compile which creates a FPGA image consisting of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> that is loaded into the static region of the FPGA and a default <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that is loaded into dynamic region. The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> image may be loaded into the dynamic region using partial reconfiguration.  </li>
</ul>
<p>The build scripts included with <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> are verified to run in a bash shell. Other shells have not been tested. The full build script typically takes around 3 hours to complete.</p>
<p>The build script flow is the primary flow described in this user guide. For instructions on compiling using the Intel Quartus Prime Pro GUI, refer to the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#444-compiling-the-ofs-fim-using-quartus-gui">Compiling the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Using Quartus GUI</a> section.</p>
<p>The following sections describe how to set up the environment and build the provided <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. Follow these steps as a tutorial to learn the build flow.  You will use this environment and build scripts for the creation of your specialized <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.</p>
<h4 id="441-setting-up-required-environment-variables"><strong>4.4.1. Setting Up Required Environment Variables</strong><a class="headerlink" href="#441-setting-up-required-environment-variables" title="Permanent link">&para;</a></h4>
<p>Set required environment variables as shown below.  These environment variables must be set prior to simulation or compilation tasks so creating a simple script to set these variables saves time. </p>
<p>Set the following environment variables based on your environment:
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_MAINPATH</span><span class="o">=</span>/&lt;YOUR_QUARTUS_DIRECTORY&gt;/23.1<span class="w"> </span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">TOOLS_LOCATION</span><span class="o">=</span>&lt;YOUR_TOOLS_DIRECTORY&gt;<span class="w"> </span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LM_LICENSE_FILE</span><span class="o">=</span>&lt;YOUR_LM_LICENSE_PATH&gt;
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">DW_LICENSE_FILE</span><span class="o">=</span>&lt;YOUR_DW_LICENSE_PATH&gt;
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">SNPSLMD_LICENSE_FILE</span><span class="o">=</span>&lt;YOUR_SNPSLMD_LICENSE_PATH&gt;
</code></pre></div></p>
<blockquote>
<p><strong>Note:</strong> The TOOLS_LOCATION directory is where the Synopsis tools reside. Refer to the <code>UVM_HOME</code> variable below for an example.</p>
</blockquote>
<p>Then set the remaining environment variables:
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_MAINPATH</span>/quartus<span class="w"> </span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_HOME</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span><span class="w"> </span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_INSTALL_DIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span><span class="w"> </span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_ROOTDIR_OVERRIDE</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span><span class="w"> </span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">IMPORT_IP_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/../ip<span class="w"> </span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="nb">export</span><span class="w"> </span><span class="nv">IP_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/../ip<span class="w"> </span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="nb">export</span><span class="w"> </span><span class="nv">INTELFPGAOCLSDKROOT</span><span class="o">=</span><span class="nv">$QUARTUS_MAINPATH</span>/hld<span class="w"> </span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QSYS_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/../qsys/bin<span class="w"> </span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="nb">export</span><span class="w"> </span><span class="nv">IOFS_BUILD_ROOT</span><span class="o">=</span><span class="nv">$PWD</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_ROOTDIR</span><span class="o">=</span><span class="nv">$IOFS_BUILD_ROOT</span>/ofs-f2000x
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="nb">export</span><span class="w"> </span><span class="nv">WORKDIR</span><span class="o">=</span><span class="nv">$OFS_ROOTDIR</span><span class="w"> </span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="nb">export</span><span class="w"> </span><span class="nv">VERDIR</span><span class="o">=</span><span class="nv">$OFS_ROOTDIR</span>/verification/ofs-f2000x/common:<span class="nv">$OFS_ROOTDIR</span>/verification<span class="w"> </span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_PLATFORM_AFU_BBB</span><span class="o">=</span><span class="nv">$IOFS_BUILD_ROOT</span>/ofs-platform-afu-bbb<span class="w"> </span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_SDK_REPO_BRANCH</span><span class="o">=</span>release/<span class="nv">$OPAE_SDK_VERSION</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_PLATFORM_ROOT</span><span class="o">=</span><span class="nv">$OFS_ROOTDIR</span>/work_dir/build_tree<span class="w">    </span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LIBRARY_PATH</span><span class="o">=</span><span class="nv">$IOFS_BUILD_ROOT</span>/opae-sdk/install-opae-sdk/lib<span class="w"> </span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$IOFS_BUILD_ROOT</span>/opae-sdk/install-opae-sdk/lib64<span class="w"> </span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_LOC</span><span class="o">=</span>/install-opae-sdk<span class="w"> </span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span>/root/.local/lib/python3.7.7/site-packages/<span class="w"> </span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_NUM_PARALLEL_PROCESSORS</span><span class="o">=</span><span class="m">8</span><span class="w"> </span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="nb">export</span><span class="w"> </span><span class="nv">DESIGNWARE_HOME</span><span class="o">=</span><span class="nv">$TOOLS_LOCATION</span>/synopsys/vip_common/vip_Q-2020.03A
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="nb">export</span><span class="w"> </span><span class="nv">UVM_HOME</span><span class="o">=</span><span class="nv">$TOOLS_LOCATION</span>/synopsys/vcsmx/S-2021.09-SP1/linux64/rhel/etc/uvm<span class="w"> </span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="nb">export</span><span class="w"> </span><span class="nv">VCS_HOME</span><span class="o">=</span><span class="nv">$TOOLS_LOCATION</span>/synopsys/vcsmx/S-2021.09-SP1/linux64/rhel<span class="w"> </span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="nb">export</span><span class="w"> </span><span class="nv">MTI_HOME</span><span class="o">=</span><span class="nv">$TOOLS_LOCATION</span>/intelFPGA_pro/questa_fse<span class="w"> </span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$QUARTUS_HOME</span>/bin:<span class="nv">$QUARTUS_HOME</span>/qsys/bin:<span class="nv">$QUARTUS_HOME</span>/sopc_builder/bin/:<span class="nv">$IOFS_BUILD_ROOT</span>/opae-sdk/install-opae-sdk/bin:<span class="nv">$MTI_HOME</span>/linux_x86_64/:<span class="nv">$MTI_HOME</span>/bin/:<span class="nv">$DESIGNWARE_HOME</span>/bin:<span class="nv">$VCS_HOME</span>/bin
</code></pre></div></p>
<h3 id="442-compiling-the-fim"><strong>4.4.2 Compiling the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></strong><a class="headerlink" href="#442-compiling-the-fim" title="Permanent link">&para;</a></h3>
<p>The f2000x  <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> build flow uses the bash script <code>$OFS_ROOTDIR/ofs-common/scripts/common/syn/build_top.sh</code>.  There are several setup files that must be put in place before compilation, which is handled by the build script. If you wish to compile the f2000x <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> using the Intel Quartus Prime Pro GUI, you must at least run the setup portion of the <code>build_top.sh</code> script before compiling with the GUI. For instructions on compiling the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> using the Quartus GUI, refer to the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#444-compiling-the-ofs-fim-using-quartus-gui">Compiling the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Using Quartus GUI</a> section.</p>
<p>The usage of the compile build script is shown below:
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>ofs-common/scripts/common/syn/build_top.sh/build_top.sh<span class="w"> </span><span class="o">[</span>-p<span class="o">]</span><span class="w"> </span>f2000x<span class="o">[</span>:OPTIONS<span class="o">]</span><span class="w">  </span>work_dir<span class="w"> </span>
</code></pre></div></p>
<blockquote>
<p><strong>Note:</strong> Refer to the $OFS_ROOTDIR/ofs-common/scripts/common/syn/README for detailed information on using this script</p>
</blockquote>
<ul>
<li>To build the provided design using a flat, non-<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> build flow use the following commands:<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>./ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>f2000x:flat<span class="w">  </span>work_dir
</code></pre></div>
</li>
</ul>
<ul>
<li>To build the provided design with in-tree <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> enabled use the following commands:<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>./ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>f2000x<span class="w"> </span>work_dir
</code></pre></div>
</li>
</ul>
<ul>
<li>To build the provided design with a relocatable (out-of-tree) <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> directory use the following commands:<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>./ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>-p<span class="w"> </span>f2000x<span class="w"> </span>work_dir
</code></pre></div>
<p>Refer to the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#443-create-a-relocatable-pr-directory-tree-from-the-base_x16-fim">Create a Relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Directory Tree</a> section for more information on out-of-tree <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> builds.</p>
</li>
</ul>
<p>The build takes ~3 hours to complete. A successful build will report the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nv">Compile</span><span class="w"> </span>work<span class="w"> </span>directory:<span class="w">     </span><span class="o">&lt;</span><span class="nv">$IOFS_BUILD_ROOT</span><span class="o">&gt;/</span>ofs-f2000x<span class="o">/</span>work_f2000x<span class="w"> </span><span class="o">/</span>syn<span class="o">/</span>syn_top
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="nv">Compile</span><span class="w"> </span>artifact<span class="w"> </span>directory:<span class="w"> </span><span class="o">&lt;</span><span class="nv">$IOFS_BUILD_ROOT</span><span class="o">&gt;/</span>ofs-f2000x<span class="o">/</span>work_f2000x<span class="w"> </span><span class="o">/</span>syn<span class="o">/</span>syn_top<span class="o">/</span>output_files
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="o">***********************************</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="o">***</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="o">***</span><span class="w">        </span><span class="nv">OFS_PROJECT</span><span class="o">:</span><span class="w"> </span>f2000x<span class="w"> </span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="o">***</span><span class="w">        </span>OFS_FIM:<span class="w"> </span>base
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="o">***</span><span class="w">        </span><span class="nv">OFS_BOARD</span><span class="o">:</span><span class="w"> </span>adp
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="o">***</span><span class="w">        </span><span class="nv">Q_PROJECT</span><span class="o">:</span><span class="w">  </span>ofs_top
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="o">***</span><span class="w">        </span><span class="nv">Q_REVISION</span><span class="o">:</span><span class="w"> </span>ofs_top
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="o">***</span><span class="w">        </span><span class="nv">SEED</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="o">***</span><span class="w">        </span><span class="nv">Build</span><span class="w"> </span>Complete
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="o">***</span><span class="w">        </span><span class="nv">Timing</span><span class="w"> </span>Passed<span class="o">!</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="o">***</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="o">***********************************</span>
</code></pre></div>
<p>The build script copies the <code>ipss</code>, <code>ofs-common</code>, <code>sim</code>, <code>src</code>,<code>syn</code> and <code>tools</code> directories to the specified work directory and then these copied files are used in the Intel Quartus Prime Pro compilation process.</p>
<p>Some key output directories are described in the following table:</p>
<table>
<thead>
<tr>
<th>Directory</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>$OFS_ROOTDIR/&lt;WORK_DIR&gt;/syn/syn_top</code></td>
<td>Intel Quartus Prime Pro project (ofs_top.qpf) and other Intel Quartus Prime Pro specific files</td>
</tr>
<tr>
<td><code>$OFS_ROOTDIR/&lt;WORK_DIR&gt;/syn/syn_top/output_files</code></td>
<td>Directory with build reports and FPGA programming files</td>
</tr>
</tbody>
</table>
<p>The build script will run PACSign (if installed) and create an unsigned FPGA programming files for both user1 and user2 locations of the f2000x  FPGA flash.  Please note, if the f2000x  has the root entry hash key loaded, then PACsign must be run to add the proper key to the FPGA binary file.</p>
<p>The following table provides a detailed description of the generated *.bin files.</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ofs_top.bin</td>
<td>This is an intermediate, raw binary file. This intermediate raw binary file is produced by taking the Intel Quartus Prime Pro generated *.sof file, and converting it to *.pof using quartus_pfg, then converting the *.pof to *.hexout using quartus_cpf, and finally converting the *.hexout to *.bin using objcopy. <br /><br /><code>ofs_top.bin</code> - Raw binary image of the FPGA.</td>
</tr>
<tr>
<td>ofs_top_page0_unsigned_factory.bin</td>
<td>This is the unsigned PACSign output generated for the Factory Image. <strong>Unsigned</strong> means that the image has been signed with an empty header.</td>
</tr>
<tr>
<td>ofs_top_page1_user1.bin</td>
<td>This is an input file to PACSign to generate <code>ofs_top_page1_unsigned_user1.bin</code>. This file is created by taking the ofs_top.bin file and assigning the User1 or appending factory block information. <strong>Unsigned</strong> means that the image has been signed with an empty header.</td>
</tr>
<tr>
<td>ofs_top_page1_unsigned_user1.bin</td>
<td>This is the unsigned FPGA binary image generated by the PACSign utility for the User1 Image. This file is used to load the FPGA flash User1 Image using the fpgasupdate tool. <strong>Unsigned</strong> means that the image has been signed with an empty header.</td>
</tr>
<tr>
<td>ofs_top_page2_user2.bin</td>
<td>This is an input file to PACSign to generate <code>ofs_top_page2_unsigned_user2.bin</code>. This file is created by taking the <code>ofs_top.bin</code> file and assigning the User2 or appending factory block information.</td>
</tr>
<tr>
<td>ofs_top_page2_unsigned_user2.bin</td>
<td>This is the unsigned FPGA binary image generated by the PACSign utility for the User2 Image. This file is used to load the FPGA flash User2 Image using the fpgasupdate tool. <strong>Unsigned</strong> means that the image has been signed with an empty header.</td>
</tr>
<tr>
<td>ofs_top.sof</td>
<td>This image is used to generate <code>ofs_top.bin</code>, and can also be used to program the Agilex device directly through <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr></td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note:</strong> The <code>build/output_files/timing_report</code> directory contains clocks report, failing paths and passing margin reports. </p>
</blockquote>
<h4 id="443-create-a-relocatable-pr-directory-tree-from-the-base_x16-fim"><strong>4.4.3 Create a Relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Directory Tree from the base_x16 <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></strong><a class="headerlink" href="#443-create-a-relocatable-pr-directory-tree-from-the-base_x16-fim" title="Permanent link">&para;</a></h4>
<p>If you are developing a <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> to be used by another team developing <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> workload(s), scripts are provided that create a relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> directory tree. ODM and board developers will make use of this capability to enable a broad set of AFUs to be loaded on a board using <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>.</p>
<p>You can create this relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> directory tree by either:</p>
<ul>
<li>Build <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using ofs-common/scripts/common/syn/build_top.sh followed by running /ofs-common/scripts/common/syn/generate_pr_release.sh</li>
<li>Build <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using ofs-common/scripts/common/syn/build_top.sh with optional -p switch included</li>
</ul>
<p>The generate_pr_release.sh has the following command structure:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>ofs-common/scripts/common/syn/generate_pr_release.sh<span class="w"> </span>-t<span class="w"> </span>&lt;work_directory&gt;/build_tree<span class="w"> </span>&lt;target_board&gt;<span class="w"> </span>&lt;work_directory&gt;
</code></pre></div>
Where:</p>
<ul>
<li><code>&lt;work_directory&gt;/build_tree</code> is the location for your relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> directory tree in the work directory</li>
<li><code>&lt;target_board&gt;</code> is the name of the board target/<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> e.g. f2000x </li>
<li><code>&lt;work_directory&gt;</code> is the work directory</li>
</ul>
<p>Here is an example of running the generate_pr_release.sh script:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>ofs-common/scripts/common/syn/generate_pr_release.sh<span class="w"> </span>-t<span class="w"> </span>work_f2000x/build_tree<span class="w"> </span>f2000x<span class="w">   </span>work_f2000x<span class="w"> </span>
</code></pre></div>
<p>The resulting relocatable build tree has the following structure:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>.
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>├──<span class="w"> </span>bin
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>│<span class="w">   </span>├──<span class="w"> </span>afu_synth
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>│<span class="w">   </span>├──<span class="w"> </span>build_env_config
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>│<span class="w">   </span>├──<span class="w"> </span>run.sh<span class="w"> </span>-&gt;<span class="w"> </span>afu_synth
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>│<span class="w">   </span>└──<span class="w"> </span>update_pim
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>├──<span class="w"> </span>hw
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>│<span class="w">   </span>├──<span class="w"> </span>blue_bits
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_top_page0_unsigned_factory.bin
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_top_page1_unsigned_user1.bin
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_top_page2_unsigned_user2.bin
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>ofs_top.sof<span class="w"> </span>-&gt;<span class="w"> </span>../lib/build/syn/syn_top/output_files/ofs_top.sof
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>│<span class="w">   </span>└──<span class="w"> </span>lib
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>│<span class="w">       </span>├──<span class="w"> </span>build
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>│<span class="w">       </span>├──<span class="w"> </span>fme-ifc-id.txt
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>│<span class="w">       </span>├──<span class="w"> </span>fme-platform-class.txt
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>│<span class="w">       </span>└──<span class="w"> </span>platform
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>└──<span class="w"> </span>README
</code></pre></div>
This build tree can be moved to a different location and used for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development of <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>-able <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to be used with this board.</p>
<h4 id="444-compiling-the-ofs-fim-using-quartus-gui"><strong>4.4.4 Compiling the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Using Quartus GUI</strong><a class="headerlink" href="#444-compiling-the-ofs-fim-using-quartus-gui" title="Permanent link">&para;</a></h4>
<p>Perform the following steps to compile the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> using the Quartus GUI:</p>
<ol>
<li>
<p>Set the environment variables as described in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#441-setting-up-required-environment-variables">Setting Up Required Environment Variables</a> section.</p>
</li>
<li>
<p>Run the setup portion of the build script. This takes a few seconds to complete.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>./ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>--stage<span class="w"> </span>setup<span class="w"> </span>f2000x<span class="w"> </span>work_dir
</code></pre></div>
</li>
<li>
<p>Open the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> project using the Intel Quartus Prime Pro GUI. The project is located at <code>$OFS_ROOTDIR/work_dir/syn/syn_top/ofs_top.qpf</code>.</p>
</li>
<li>
<p>Ensure the checkbox next to <strong>Assembler (Generate programming files)</strong> is marked.</p>
</li>
<li>
<p>Click the arrow next to <strong>Compile Design</strong> in the <strong>Compilation Flow</strong> window to start full compilation.</p>
</li>
<li>
<p>After compilation is complete, check the <code>$OFS_ROOTDIR/work_dir/syn/syn_top/output_files</code> directory. This directory will contain the output SOF image generated by Quartus, named <code>ofs_top.sof</code>.</p>
</li>
<li>
<p>Run the finish portion of the build script. This will generate the images that can be programmed to f2000x FPGA flash. Use the optional <code>-p</code> argument to create an out-of-tree <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> build.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>./ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>--stage<span class="w"> </span>finish<span class="w"> </span>f2000x<span class="w"> </span>work_dir
</code></pre></div>
</li>
<li>
<p>Check the <code>$OFS_ROOTDIR/work_dir/syn/syn_top/output_files</code> directory again to see that all output files have been generated.</p>
</li>
</ol>
<h3 id="45-unit-level-simulation"><strong>4.5 Unit Level Simulation</strong><a class="headerlink" href="#45-unit-level-simulation" title="Permanent link">&para;</a></h3>
<p>Unit level simulation of key components in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> is provided. These simulations provide verification of the following areas:</p>
<ul>
<li>Ethernet</li>
<li>PCIe</li>
<li>External Memory</li>
<li>Core <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></li>
</ul>
<p>The Unit Level simulations work with Synopsys VCS-MX or Mentor Graphics Questasim simulators. Readme files are provided explaining how to run the simulation of each component. </p>
<p>The scripts to run the unit level simulations are located in <code>$OFS_ROOTDIR/sim/unit_test</code>, which contains subdirectories <code>soc_tests</code> and <code>host_tests</code>. The table below lists the tests that are provided.</p>
<table>
<thead>
<tr>
<th>Test Type</th>
<th>Test Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>SoC Tests</td>
<td>csr_test</td>
</tr>
<tr>
<td></td>
<td>dfh_walker</td>
</tr>
<tr>
<td></td>
<td>flr</td>
</tr>
<tr>
<td></td>
<td>he_lb_test</td>
</tr>
<tr>
<td></td>
<td>he_mem_test</td>
</tr>
<tr>
<td></td>
<td>hssi_kpi_test</td>
</tr>
<tr>
<td></td>
<td>hssi_test</td>
</tr>
<tr>
<td></td>
<td>mem_ss_csr_test</td>
</tr>
<tr>
<td></td>
<td>mem_ss_rst_test</td>
</tr>
<tr>
<td></td>
<td>mem_tg_test</td>
</tr>
<tr>
<td></td>
<td>pf_vf_access_test</td>
</tr>
<tr>
<td></td>
<td>qsfp_test</td>
</tr>
<tr>
<td></td>
<td>regress_run.py</td>
</tr>
<tr>
<td>Host Tests</td>
<td>csr_test</td>
</tr>
<tr>
<td></td>
<td>he_lb_test</td>
</tr>
<tr>
<td></td>
<td>pcie_csr_test</td>
</tr>
<tr>
<td></td>
<td>pf_vf_access_test</td>
</tr>
<tr>
<td></td>
<td>pmci_csr_test</td>
</tr>
<tr>
<td></td>
<td>pmci_mailbox_test</td>
</tr>
<tr>
<td></td>
<td>pmci_rd_default_value_test</td>
</tr>
<tr>
<td></td>
<td>pmci_ro_mailbox_test</td>
</tr>
<tr>
<td></td>
<td>pmci_vdm_b2b_drop_err_scenario_test</td>
</tr>
<tr>
<td></td>
<td>pmci_vdm_len_err_scenario_test</td>
</tr>
<tr>
<td></td>
<td>pmci_vdm_mctp_mmio_b2b_test</td>
</tr>
<tr>
<td></td>
<td>pmci_vdm_multipkt_error_scenario_test</td>
</tr>
<tr>
<td></td>
<td>pmci_vdm_multipkt_tlp_err_test</td>
</tr>
<tr>
<td></td>
<td>pmci_vdm_tlp_error_scenario_test</td>
</tr>
<tr>
<td></td>
<td>pmci_vdm_tx_rx_all_random_lpbk_test</td>
</tr>
<tr>
<td></td>
<td>pmci_vdm_tx_rx_all_toggle_test</td>
</tr>
<tr>
<td></td>
<td>pmci_vdm_tx_rx_lpbk_test</td>
</tr>
<tr>
<td></td>
<td>regress_run.py</td>
</tr>
</tbody>
</table>
<h4 id="451-run-comprehensive-unit-tests"><strong>4.5.1 Run Comprehensive Unit Tests</strong><a class="headerlink" href="#451-run-comprehensive-unit-tests" title="Permanent link">&para;</a></h4>
<p>The <code>regress_run.py</code> script is provided to automatically run all unit tests for either the SoC or the Host. Note that running all tests will take around three hours for the SoC tests and around 2.5 hours for the Host tests to complete.</p>
<p>Perform the following steps to run comprehensive tests:</p>
<ol>
<li>Set the environment variables as described in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#441-setting-up-required-environment-variables">Setting Up Required Environment Variables</a> section.</li>
<li>
<p>Navigate to the test directory you wish to run from.</p>
<ul>
<li>SoC Tests<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/sim/unit_test/soc_tests
</code></pre></div>
</li>
</ul>
<ul>
<li>Host Tests<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/sim/unit_test/host_tests
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>Run the tests with the <code>regress_run.py</code>. Use the <code>-h</code> argument to display the help menu.</p>
<p>For example, to run all tests locally, using VCS, with 8 processors:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>python<span class="w"> </span>regress_run.py<span class="w"> </span>-l<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span><span class="w"> </span>-k<span class="w"> </span>all<span class="w"> </span>-s<span class="w"> </span>vcs
</code></pre></div>
</li>
<li>
<p>Once all tests have completed, the comprehensive test summary will be shown. The following is an example test summary after running the SoC tests:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>2023-05-14 19:10:55,404: Passing Unit Tests:12/12 &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>2023-05-14 19:10:55,404:    csr_test:......... PASS -- Time Elapsed:0:03:57.713154
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>2023-05-14 19:10:55,404:    dfh_walker:....... PASS -- Time Elapsed:0:02:46.025067
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>2023-05-14 19:10:55,404:    flr:.............. PASS -- Time Elapsed:0:03:26.289900
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>2023-05-14 19:10:55,404:    he_lb_test:....... PASS -- Time Elapsed:0:06:41.142643
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>2023-05-14 19:10:55,404:    he_mem_test:...... PASS -- Time Elapsed:1:39:01.824096
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>2023-05-14 19:10:55,404:    hssi_kpi_test:.... PASS -- Time Elapsed:2:21:33.007328
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>2023-05-14 19:10:55,404:    hssi_test:........ PASS -- Time Elapsed:2:16:36.821034
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>2023-05-14 19:10:55,404:    mem_ss_csr_test:.. PASS -- Time Elapsed:0:38:45.836540
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>2023-05-14 19:10:55,404:    mem_ss_rst_test:.. PASS -- Time Elapsed:0:40:51.065354
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>2023-05-14 19:10:55,404:    mem_tg_test:...... PASS -- Time Elapsed:0:54:00.210146
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>2023-05-14 19:10:55,404:    pf_vf_access_test: PASS -- Time Elapsed:0:03:25.561919
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>2023-05-14 19:10:55,404:    qsfp_test:........ PASS -- Time Elapsed:0:39:29.192304
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>2023-05-14 19:10:55,404: Failing Unit Tests: 0/12 &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>2023-05-14 19:10:55,404: &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>2023-05-14 19:10:55,404:       Number of Unit test results captured: 12
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>2023-05-14 19:10:55,404:       Number of Unit test results passing.: 12
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>2023-05-14 19:10:55,404:       Number of Unit test results failing.:  0
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>2023-05-14 19:10:55,404:     End Unit regression running at date/time................: 2023-05-14 19:10:55.404641
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>2023-05-14 19:10:55,404:     Elapsed time for Unit regression run....................: 2:22:39.310455
</code></pre></div>
</li>
<li>
<p>Output logs for each individual test are saved in the respective test's directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nv">$OFS_ROOTDIR</span>/sim/unit_test/&lt;TEST_TYPE&gt;/&lt;TEST_NAME&gt;/&lt;SIMULATOR&gt;/transcript
</code></pre></div>
<p>For example, the log for the SoC DFH Walker test using VCS can be found in:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nv">$OFS_ROOTDIR</span>/sim/unit_test/soc_tests/dfh_walker/sim_vcs/transcript
</code></pre></div>
</li>
</ol>
<h4 id="452-run-individual-unit-tests"><strong>4.5.2 Run Individual Unit Tests</strong><a class="headerlink" href="#452-run-individual-unit-tests" title="Permanent link">&para;</a></h4>
<p>The <code>run_sim.sh</code> scripts are provided to run individual unit tests for either the SoC or the Host. Before you can run any unit tests, you must generate the IP simulation files. Note that the <code>regress_run.py</code> script used for comprehensive testing does this step automatically. Perform the following steps to generate the IP simulation files:</p>
<ol>
<li>Set the environment variables as described in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#441-setting-up-required-environment-variables">Setting Up Required Environment Variables</a> section.</li>
<li>Generate the IP simulation files for all unit tests:<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nb">cd</span><span class="w"> </span><span class="sb">`</span><span class="nv">$OFS_ROOTDIR</span>/ofs-common/scripts/common/sim<span class="sb">`</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>sh<span class="w"> </span>gen_sim_files.sh<span class="w"> </span>f2000x<span class="w"> </span>
</code></pre></div>
</li>
</ol>
<p>Next, perform the following steps to run individual tests:</p>
<ol>
<li>
<p>Navigate to the directory of the test you wish to run</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/sim/unit_test/&lt;TEST_TYPE&gt;/&lt;TEST_NAME&gt;
</code></pre></div>
<p>For example, to run the DFH walker test for the SoC:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/sim/unit_test/soc_tests/dfh_walker
</code></pre></div>
</li>
<li>
<p>Run the test with your desired simulator:</p>
<ul>
<li>
<p>Using VCS</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>sh<span class="w"> </span>run_sim.sh
</code></pre></div>
</li>
</ul>
<ul>
<li>
<p>Using Questasim</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>sh<span class="w"> </span>run_sim.sh<span class="w"> </span><span class="nv">MSIM</span><span class="o">=</span><span class="m">1</span>
</code></pre></div>
</li>
</ul>
<ul>
<li>
<p>Using VCS-MX</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>sh<span class="w"> </span>run_sim.sh<span class="w"> </span><span class="nv">VCSMX</span><span class="o">=</span><span class="m">1</span>
</code></pre></div>
</li>
</ul>
</li>
<li>
<p>Once the test has completed, the test summary will be shown. The following is an example test summary after running the SoC DFH Walker Test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>Test<span class="w"> </span>status:<span class="w"> </span>OK
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>********************
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>Test<span class="w"> </span>summary
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>********************
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">   </span>test_dfh_walking<span class="w"> </span><span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">0</span><span class="o">)</span><span class="w"> </span>-<span class="w"> </span>pass
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>Test<span class="w"> </span>passed!
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>Assertion<span class="w"> </span>count:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="nv">$finish</span><span class="w"> </span>called<span class="w"> </span>from<span class="w"> </span>file<span class="w"> </span><span class="s2">&quot;/home/applications.fpga.ofs.fim-f2000x-pl/sim/unit</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="s2">_test/scripts/../../bfm/rp_bfm_simple/tester.sv&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">210</span>.
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="nv">$finish</span><span class="w"> </span>at<span class="w"> </span>simulation<span class="w"> </span><span class="nb">time</span><span class="w">            </span><span class="m">355393750</span>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="w">        </span>V<span class="w"> </span>C<span class="w"> </span>S<span class="w">   </span>S<span class="w"> </span>i<span class="w"> </span>m<span class="w"> </span>u<span class="w"> </span>l<span class="w"> </span>a<span class="w"> </span>t<span class="w"> </span>i<span class="w"> </span>o<span class="w"> </span>n<span class="w">   </span>R<span class="w"> </span>e<span class="w"> </span>p<span class="w"> </span>o<span class="w"> </span>r<span class="w"> </span>t
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>Time:<span class="w"> </span><span class="m">355393750</span><span class="w"> </span>ps
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a>CPU<span class="w"> </span>Time:<span class="w">     </span><span class="m">59</span>.870<span class="w"> </span>seconds<span class="p">;</span><span class="w">       </span>Data<span class="w"> </span>structure<span class="w"> </span>size:<span class="w">  </span><span class="m">91</span>.2Mb
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a>Sun<span class="w"> </span>May<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">16</span>:54:20<span class="w"> </span><span class="m">2023</span>
</code></pre></div>
</li>
<li>
<p>The log for the test is stored in a transcript file in the simulation directory of the test that was run.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nv">$OFS_ROOTDIR</span>/sim/unit_test/&lt;TEST_TYPE&gt;/&lt;TEST_NAME&gt;/&lt;SIMULATOR&gt;/transcript
</code></pre></div>
<p>For example, the log for the SoC DFH Walker test using VCS can be found in:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nv">$OFS_ROOTDIR</span>/sim/unit_test/soc_tests/dfh_walker/sim_vcs/transcript
</code></pre></div>
<p>The simulation waveform database is saved as vcdplus.vpd for post simulation review. You are encouraged to run the additional simulation examples to learn about each key area of the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> shell.</p>
</li>
</ol>
<h2 id="5-custom-fim-development-flow"><strong>5 Custom <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Development Flow</strong><a class="headerlink" href="#5-custom-fim-development-flow" title="Permanent link">&para;</a></h2>
<p><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> development for a new acceleration card consists of the following steps:</p>
<ol>
<li>Installation of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> and familiarization with scripts and source code</li>
<li>Development of high level block diagram with your specific functionality<ol>
<li>Determination of requirements and key performance metrics</li>
<li>Selection of IP cores</li>
<li>Selection of FPGA device</li>
<li>Software memory map</li>
</ol>
</li>
<li>Selection and implementation of <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Physical interfaces including:<ol>
<li>External clock sources and creation of internal PLL clocks</li>
<li>General I/O</li>
<li>Ethernet modules</li>
<li>External memories</li>
<li>FPGA programming methodology</li>
</ol>
</li>
<li>Device physical implementation<ol>
<li>FPGA device pin assignment</li>
<li>Inclusion of logic lock regions</li>
<li>Creation of timing constraints</li>
<li>Create Intel Quartus Prime Pro <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> test project and validate:<ol>
<li>Placement</li>
<li>Timing constraints</li>
<li>Build script process</li>
<li>Review test <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> FPGA resource usage</li>
</ol>
</li>
</ol>
</li>
<li>Select <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> interfaces and development of <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr></li>
<li><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design implementation<ol>
<li>RTL coding</li>
<li>IP instantiation</li>
<li>Development of test <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to validate <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></li>
<li>Unit and device level simulation</li>
<li>Timing constraints and build scripts</li>
<li>Timing closure and build validation</li>
</ol>
</li>
<li>Creation of <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> documentation to support <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development and synthesis</li>
<li>Software Device Feature discovery</li>
<li>Hardware/software integration, validation and debugging</li>
<li>High volume production preparation</li>
</ol>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> developer works closely with the hardware design of the target board, software development and system validation.</p>
<p>This section describes how to perform specific customizations of areas of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. Each section can be done independently. The following walkthroughs are provided:</p>
<table>
<thead>
<tr>
<th>Section</th>
<th>Walkthrough</th>
</tr>
</thead>
<tbody>
<tr>
<td>5.1</td>
<td>How to add a new module to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></td>
</tr>
<tr>
<td>5.2</td>
<td>How to debug the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> with Signal Tap</td>
</tr>
<tr>
<td>5.3</td>
<td>How to compile the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> in preparation for designing your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></td>
</tr>
<tr>
<td>5.4</td>
<td>How to resize the Partial Reconfiguration Region</td>
</tr>
<tr>
<td>5.5</td>
<td>How to modify the Memory Subsystem</td>
</tr>
<tr>
<td>5.6</td>
<td>How to compile the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> with no HSSI</td>
</tr>
<tr>
<td>5.7</td>
<td>How to change the PCIe Device ID and Vendor ID</td>
</tr>
<tr>
<td>5.8</td>
<td>How to migrate to a different Agilex device number</td>
</tr>
<tr>
<td>5.9</td>
<td>How to change the Ethernet interface from 8x25 GbE to 8x10 GbE</td>
</tr>
<tr>
<td>5.10</td>
<td>How to change the Ethernet interface from 8x25 GbE to 2x100 GbE</td>
</tr>
<tr>
<td>5.11</td>
<td>How to add more transceiver channels to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></td>
</tr>
<tr>
<td>5.12</td>
<td>How to modify the PF/VF MUX configuration</td>
</tr>
<tr>
<td>5.13</td>
<td>How to create a minimal <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></td>
</tr>
</tbody>
</table>
<p>In each section, it is assumed that:</p>
<ol>
<li>You have a clean, unmodified clone of the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repo.  See the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#421-clone-the-ofs-git-repo">Clone the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Git Repo</a> section.</li>
<li>After cloning, you must set various environment variables. See the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#441-setting-up-required-environment-variables">Setting Up Required Environment Variables</a> section.</li>
</ol>
<h3 id="51-how-to-add-a-new-module-to-the-fim"><strong>5.1 How to add a new module to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></strong><a class="headerlink" href="#51-how-to-add-a-new-module-to-the-fim" title="Permanent link">&para;</a></h3>
<p>This section provides a walkthrough for adding a custom module to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, simulating the new design, compiling the new design, implementing and testing the new design on hardware, and debugging the new design on hardware.</p>
<p>If you intend to add a new module to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> area, then you will need to inform the host software of the new module. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> exposes its functionalities to host software through a set of CSR registers that are mapped to an <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region (Memory Mapped IO). This set of CSR registers and their operation is described in <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Regions.</p>
<p>See <a href="https://github.com/OPAE/linux-dfl/blob/fpga-ofs-dev/Documentation/fpga/dfl.rst#fpga-device-feature-list-dfl-framework-overview">FPGA Device Feature List (<abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>) Framework Overview</a> for a description of the software process to read and process the linked list of Device Feature Header (DFH) CSRs within a FPGA.</p>
<p>The Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> example adds a simple DFH register and 64bit scratchpad register connected to the Board Peripheral Fabric (BPF) that can be accessed by the SoC. You can use this example as the basis for adding a new feature to your <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. </p>
<p>The Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design can be verified by Unit Level simulation, Universal Verification Methodology (<abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr>) simulation, and running in hardware on the f2000x  card. The process for these are described in this section. </p>
<h4 id="511-board-peripheral-fabric-bpf"><strong>5.1.1 Board Peripheral Fabric (BPF)</strong><a class="headerlink" href="#511-board-peripheral-fabric-bpf" title="Permanent link">&para;</a></h4>
<p>The Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module will be connected to the Board Peripheral Fabric (BPF), and will be connected such that it can only be mastered by the SoC. The BPF is an interconnect generated by Platform Designer. The figure below shows the APF/BPF Master/Slave interactions, as well as the added Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module.</p>
<p><a class="glightbox" href="../images/apf_bpf_diagram.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/apf_bpf_diagram.svg" /></a></p>
<p>You can create, modify, and/or generate the BPF manually in Platform Designer or more conveniently by executing a provided script.</p>
<h4 id="512-soc-mmio-region"><strong>5.1.2 SoC <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Region</strong><a class="headerlink" href="#512-soc-mmio-region" title="Permanent link">&para;</a></h4>
<p>We will add the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module to an un-used address space in the SoC <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region. The table below shows the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region for the SoC with the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module added at base address <code>0x16000</code>.</p>
<table>
<thead>
<tr>
<th align="left">Offset</th>
<th align="left">Feature CSR set</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0x00000</td>
<td align="left"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></td>
</tr>
<tr>
<td align="left">0x01000</td>
<td align="left">Thermal Management</td>
</tr>
<tr>
<td align="left">0x03000</td>
<td align="left">Global Performance</td>
</tr>
<tr>
<td align="left">0x04000</td>
<td align="left">Global Error</td>
</tr>
<tr>
<td align="left">0x10000</td>
<td align="left">PCIe Interface</td>
</tr>
<tr>
<td align="left">0x12000</td>
<td align="left">QSFP Controller 0</td>
</tr>
<tr>
<td align="left">0x13000</td>
<td align="left">QSFP Controller 1</td>
</tr>
<tr>
<td align="left">0x14000</td>
<td align="left">HSSI Interface</td>
</tr>
<tr>
<td align="left">0x15000</td>
<td align="left">EMIF Interface</td>
</tr>
<tr>
<td align="left"><strong>0x16000</strong></td>
<td align="left"><strong>Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></strong></td>
</tr>
<tr>
<td align="left">0x80000</td>
<td align="left">PMCI Controller</td>
</tr>
<tr>
<td align="left">0x100000</td>
<td align="left">ST2MM (Streaming to Memory-Mapped)</td>
</tr>
<tr>
<td align="left">0x130000</td>
<td align="left"><abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Control &amp; Status (Port Gasket)</td>
</tr>
<tr>
<td align="left">0x131000</td>
<td align="left">Port CSRs (Port Gasket)</td>
</tr>
<tr>
<td align="left">0x132000</td>
<td align="left">User Clock (Port Gasket)</td>
</tr>
<tr>
<td align="left">0x133000</td>
<td align="left">Remote SignalTap (Port Gasket)</td>
</tr>
<tr>
<td align="left">0x140000</td>
<td align="left"><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Errors (<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interface Handler)</td>
</tr>
</tbody>
</table>
<p>Refer to the <a href="https://ofs.github.io/hw/f2000x/reference_manuals/ofs_fim/mnl_fim_ofs/#5-interconnect-fabric"><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Technical Reference Manual: Interconnect Fabric</a> for more information on the default <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region.</p>
<h4 id="513-hello-fim-csr"><strong>5.1.3 Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> CSR</strong><a class="headerlink" href="#513-hello-fim-csr" title="Permanent link">&para;</a></h4>
<p>The Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> CSR will consist of the three registers shown in the table below. The DFH and Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> ID registers are read-only. The Scratchpad register supports read and write accesses.</p>
<table>
<thead>
<tr>
<th align="left">Offset</th>
<th align="left">Attribute</th>
<th align="left">Description</th>
<th align="left">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0x016000</td>
<td align="left">RO</td>
<td align="left">DFH(Device Feature Headers) register</td>
<td align="left">0x30000006a0000100</td>
</tr>
<tr>
<td align="left">0x016030</td>
<td align="left">RW</td>
<td align="left">Scrachpad register</td>
<td align="left">0x0</td>
</tr>
<tr>
<td align="left">0x016038</td>
<td align="left">RO</td>
<td align="left">Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> ID register</td>
<td align="left">0x6626070150000034</td>
</tr>
</tbody>
</table>
<h4 id="514-files-to-edit-to-support-hello-fim"><strong>5.1.4 Files to Edit to Support Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></strong><a class="headerlink" href="#514-files-to-edit-to-support-hello-fim" title="Permanent link">&para;</a></h4>
<p>The table below shows all files in $OFS_ROOTDIR that will be modified or created in order to implement the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module. The build_top.sh script copies files from $OFS_ROOTDIR into the target work directory and then the copied files are used in the Quartus build process. Details on editing these files is given in subsequent sections.</p>
<table>
<thead>
<tr>
<th align="left">Category</th>
<th align="left">Status</th>
<th align="left">Path</th>
<th align="left">File</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Source</td>
<td align="left">Modify</td>
<td align="left">src/top</td>
<td align="left">top.sv</td>
<td align="left">Top RTL</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Modify</td>
<td align="left">src/pd_qsys</td>
<td align="left">bpf_top.sv</td>
<td align="left">BPF top RTL</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">New</td>
<td align="left">src/hello_fim</td>
<td align="left">hello_fim_top.sv</td>
<td align="left">Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> top RTL</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">New</td>
<td align="left">src/hello_fim</td>
<td align="left">hello_fim_com.sv</td>
<td align="left">Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> common RTL</td>
</tr>
<tr>
<td align="left">Design Files</td>
<td align="left">Modify</td>
<td align="left">syn/syn_top</td>
<td align="left">ofs_top.qsf</td>
<td align="left">Quartus setting file</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Modify</td>
<td align="left">syn/syn_top</td>
<td align="left">ofs_top_sources.tcl</td>
<td align="left">Define sources for top level design</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">New</td>
<td align="left">syn/setup</td>
<td align="left">hello_fim_design_files.tcl</td>
<td align="left">Define RTLs of Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Modify</td>
<td align="left">syn/setup</td>
<td align="left">fabric_design_files.tcl</td>
<td align="left">Define IPs for fabric</td>
</tr>
<tr>
<td align="left">Platform Designer</td>
<td align="left">Modify</td>
<td align="left">src/pd_qsys/fabric</td>
<td align="left">bpf.txt</td>
<td align="left">Text definition of BPF interconnect</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Modify</td>
<td align="left">src/pd_qsys/fabric</td>
<td align="left">bpf.qsys</td>
<td align="left">BPF Qsys file</td>
</tr>
<tr>
<td align="left">Simulation</td>
<td align="left">Modify</td>
<td align="left">sim/unit_test/soc_tests/dfh_walker</td>
<td align="left">test_csr_defs.sv</td>
<td align="left">Define CSRs for simulation</td>
</tr>
<tr>
<td align="left">Verification</td>
<td align="left">Modify</td>
<td align="left">/ofs-common/verification/fpga_family/agilex/tests/sequences</td>
<td align="left">mmio_seq.svh</td>
<td align="left"><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> testbench</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Modify</td>
<td align="left">/ofs-common/verification/fpga_family/agilex/tests/sequences</td>
<td align="left">dfh_walking_seq.svh</td>
<td align="left">DFH Walking testbench</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">Modify</td>
<td align="left">ofs-common/verification/fpga_family/agilex/scripts</td>
<td align="left">Makefile_VCS.mk</td>
<td align="left">Makefile for VCS</td>
</tr>
</tbody>
</table>
<h4 id="515-pre-requisites-for-adding-hello-fim"><strong>5.1.5 Pre-Requisites for Adding Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></strong><a class="headerlink" href="#515-pre-requisites-for-adding-hello-fim" title="Permanent link">&para;</a></h4>
<p>The following pre-requisites must be satisfied before adding the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module.</p>
<ol>
<li>Clone the design repositories. See the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#421-clone-the-ofs-git-repo">Clone the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Git Repo</a> section.</li>
<li>Set the environment variables. See the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#441-setting-up-required-environment-variables">Setting Up Required Environment Variables</a> section.</li>
</ol>
<h4 id="516-file-modification"><strong>5.1.6 File Modification</strong><a class="headerlink" href="#516-file-modification" title="Permanent link">&para;</a></h4>
<p>This section describes the steps to add the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.  The steps in this simple example are the basis for modifying the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> for more complex functions.</p>
<ol>
<li>
<p>Modify <code>syn/syn_top/ofs_top.qsf</code></p>
<ol>
<li>
<p>Define the <code>INCLUDE_HELLO_FIM</code> Verilog macro to the <code>Verilog Macros</code> section. This will enable instantiation of the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module. If this is not set, a dummy register will be instantiated instead.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1">######################################################</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="c1"># Verilog Macros</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="c1">######################################################</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>.....
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>set_global_assignment<span class="w"> </span>-name<span class="w"> </span>VERILOG_MACRO<span class="w"> </span><span class="s2">&quot;INCLUDE_HELLO_FIM&quot;</span><span class="w">     </span><span class="c1"># Includes Hello FIM</span>
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Modify <code>syn/syn_top/ofs_top_sources.tcl</code></p>
<ol>
<li>
<p>Add <code>hello_fim_design_files.tcl</code> to the list of subsystems in the Design Files section.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c">############################################</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="c"># Design Files</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="c">############################################</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="nv">...</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="c"># Subsystems</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="nv">...</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>SOURCE_TCL_SCRIPT_FILE<span class="w"> </span>..<span class="o">/</span>setup<span class="o">/</span>hello_fim_design_files.tcl
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Create <code>syn/setup/hello_fim_design_files.tcl</code></p>
<ol>
<li>
<p>Create <code>hello_fim_design_files.tcl</code> with the following contents:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c"># Copyright 2023 Intel Corporation.</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="c">#</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="c"># THIS SOFTWARE MAY CONTAIN PREPRODUCTION CODE AND IS PROVIDED BY THE</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="c"># COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="c"># WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="c"># MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="c"># DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE # LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR # CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="c"># SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="c"># BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="c"># WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE</span>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="c"># OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,</span>
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="c"># EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="c">#</span>
<a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="c"># Hello FIM Files</span>
<a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="c">#--------------------</span>
<a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>SYSTEMVERILOG_FILE<span class="w"> </span><span class="nv">$::env</span><span class="k">(</span><span class="nv">BUILD_ROOT_REL</span><span class="k">)</span><span class="o">/</span>src<span class="o">/</span>hello_fim<span class="o">/</span>hello_fim_com.sv
<a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>SYSTEMVERILOG_FILE<span class="w"> </span><span class="nv">$::env</span><span class="k">(</span><span class="nv">BUILD_ROOT_REL</span><span class="k">)</span><span class="o">/</span>src<span class="o">/</span>hello_fim<span class="o">/</span>hello_fim_top.sv
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Modify <code>/src/pd_qsys/fabric/fabric_design_files.tcl</code></p>
<ol>
<li>
<p>Add <code>bpf_hello_fim_slv.ip</code> to the list of files in the BPF section.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c">#--------------------</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="c"># BPF</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="c">#--------------------</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="nv">...</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>IP_FILE<span class="w"> </span>..<span class="o">/</span>ip_lib<span class="o">/</span>src<span class="o">/</span>pd_qsys<span class="o">/</span>fabric<span class="o">/</span>ip<span class="o">/</span>bpf<span class="o">/</span>bpf_hello_fim_slv.ip
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Modify <code>src/top/top.sv</code></p>
<ol>
<li>
<p>Add <code>bpf_hello_fim_slv_if</code> to AXI4-Lite Interfaces:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>//<span class="w"> </span>AXI4-lite<span class="w"> </span>interfaces
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>ofs_fim_axi_lite_if<span class="w"> </span><span class="c1">#(.AWADDR_WIDTH(12), .ARADDR_WIDTH(12)) bpf_hello_fim_slv_if();</span>
</code></pre></div>
</li>
<li>
<p>Modify the value of <code>NEXT_DFH_OFFSET</code> of <code>mem_ss_top</code> from <code>24'h6B000</code> to <code>24'h1000</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1">//*******************************</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="c1">// Memory Subsystem</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="c1">//*******************************</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="no">`ifdef</span><span class="w"> </span><span class="n">INCLUDE_DDR4</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">   </span><span class="n">mem_ss_top</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">      </span><span class="p">.</span><span class="n">FEAT_ID</span><span class="w">          </span><span class="p">(</span><span class="mh">12&#39;h009</span><span class="p">),</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="w">      </span><span class="p">.</span><span class="n">FEAT_VER</span><span class="w">         </span><span class="p">(</span><span class="mh">4&#39;h1</span><span class="p">),</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="w">      </span><span class="p">.</span><span class="n">NEXT_DFH_OFFSET</span><span class="w">  </span><span class="p">(</span><span class="mh">24&#39;h1000</span><span class="p">),</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">      </span><span class="p">.</span><span class="n">END_OF_LIST</span><span class="w">      </span><span class="p">(</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">)</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="w">   </span><span class="p">)</span><span class="w"> </span><span class="n">mem_ss_top</span><span class="w"> </span><span class="p">(</span>
</code></pre></div>
</li>
<li>
<p>Modify the value of <code>NEXT_DFH_OFFSET</code> of the Memory Subsystem <code>dummy_csr</code> from <code>24'h6B000</code> to <code>24'h1000</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1">// Placeholder logic if no mem_ss</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="n">dummy_csr</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="w">   </span><span class="p">.</span><span class="n">FEAT_ID</span><span class="w">          </span><span class="p">(</span><span class="mh">12&#39;h009</span><span class="p">),</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">   </span><span class="p">.</span><span class="n">FEAT_VER</span><span class="w">         </span><span class="p">(</span><span class="mh">4&#39;h1</span><span class="p">),</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="w">   </span><span class="p">.</span><span class="n">NEXT_DFH_OFFSET</span><span class="w">  </span><span class="p">(</span><span class="mh">24&#39;h1000</span><span class="p">),</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">   </span><span class="p">.</span><span class="n">END_OF_LIST</span><span class="w">      </span><span class="p">(</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">)</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="p">)</span><span class="w"> </span><span class="n">emif_dummy_csr</span><span class="w"> </span><span class="p">(</span>
</code></pre></div>
</li>
<li>
<p>Add Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> instance and dummy CSR after the Memory Subsystem. Set the <code>NEXT_DFH_OFFSET</code> to <code>24'h6A000</code> for both</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1">//*******************************</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="c1">// Hello FIM Subsystem</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="c1">//*******************************</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="no">`ifdef</span><span class="w"> </span><span class="n">INCLUDE_HELLO_FIM</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="n">hello_fim_top</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="w">   </span><span class="p">.</span><span class="n">ADDR_WIDTH</span><span class="w">       </span><span class="p">(</span><span class="mh">12</span><span class="p">),</span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="w">   </span><span class="p">.</span><span class="n">DATA_WIDTH</span><span class="w">       </span><span class="p">(</span><span class="mh">64</span><span class="p">),</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">   </span><span class="p">.</span><span class="n">FEAT_ID</span><span class="w">          </span><span class="p">(</span><span class="mh">12&#39;h100</span><span class="p">),</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w">   </span><span class="p">.</span><span class="n">FEAT_VER</span><span class="w">         </span><span class="p">(</span><span class="mh">4&#39;h0</span><span class="p">),</span>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">   </span><span class="p">.</span><span class="n">NEXT_DFH_OFFSET</span><span class="w">  </span><span class="p">(</span><span class="mh">24&#39;h6A000</span><span class="p">),</span>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="w">   </span><span class="p">.</span><span class="n">END_OF_LIST</span><span class="w">      </span><span class="p">(</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">)</span>
<a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="p">)</span><span class="w"> </span><span class="n">hello_fim_top_inst</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="w">    </span><span class="p">.</span><span class="n">clk</span><span class="w"> </span><span class="p">(</span><span class="n">clk_csr</span><span class="p">),</span>
<a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="w">    </span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="o">~</span><span class="n">rst_n_csr</span><span class="p">),</span>
<a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="w">    </span><span class="p">.</span><span class="n">csr_lite_if</span><span class="w">    </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">)</span><span class="w">         </span>
<a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="p">);</span>
<a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a><span class="no">`else</span>
<a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="n">dummy_csr</span><span class="w"> </span><span class="p">#(</span><span class="w">   </span>
<a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a><span class="w">   </span><span class="p">.</span><span class="n">FEAT_ID</span><span class="w">          </span><span class="p">(</span><span class="mh">12&#39;h100</span><span class="p">),</span>
<a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a><span class="w">   </span><span class="p">.</span><span class="n">FEAT_VER</span><span class="w">         </span><span class="p">(</span><span class="mh">4&#39;h0</span><span class="p">),</span>
<a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="w">   </span><span class="p">.</span><span class="n">NEXT_DFH_OFFSET</span><span class="w">  </span><span class="p">(</span><span class="mh">24&#39;h6A000</span><span class="p">),</span>
<a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a><span class="w">   </span><span class="p">.</span><span class="n">END_OF_LIST</span><span class="w">      </span><span class="p">(</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">)</span>
<a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a><span class="p">)</span><span class="w"> </span><span class="n">hello_fim_dummy</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a><span class="w">   </span><span class="p">.</span><span class="n">clk</span><span class="w">         </span><span class="p">(</span><span class="n">clk_csr</span><span class="p">),</span>
<a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a><span class="w">   </span><span class="p">.</span><span class="n">rst_n</span><span class="w">       </span><span class="p">(</span><span class="n">rst_n_csr</span><span class="p">),</span>
<a id="__codelineno-50-27" name="__codelineno-50-27" href="#__codelineno-50-27"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_lite_if</span><span class="w"> </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">)</span>
<a id="__codelineno-50-28" name="__codelineno-50-28" href="#__codelineno-50-28"></a><span class="p">);</span>
<a id="__codelineno-50-29" name="__codelineno-50-29" href="#__codelineno-50-29"></a>
<a id="__codelineno-50-30" name="__codelineno-50-30" href="#__codelineno-50-30"></a><span class="no">`endif</span><span class="w"> </span>
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Modify <code>/src/pd_qsys/bpf_top.sv</code></p>
<ol>
<li>
<p>Add <code>bpf_hello_fim_slv_if</code> to the interface descriptions</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="p">...</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="k">module</span><span class="w"> </span><span class="n">bpf_top</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="p">...</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="c1">//BPF funtions</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="p">...</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="n">ofs_fim_axi_lite_if</span><span class="p">.</span><span class="n">master</span><span class="w"> </span><span class="n">bpf_hello_fim_slv_if</span>
</code></pre></div>
</li>
<li>
<p>Add <code>bpf_hello_fim_slv_if</code> to the module</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="k">module</span><span class="w"> </span><span class="n">bpf_top</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="p">...</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="p">);</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="p">...</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_awaddr</span><span class="w">    </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">awaddr</span><span class="w">     </span><span class="p">),</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_awprot</span><span class="w">    </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">awprot</span><span class="w">     </span><span class="p">),</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_awvalid</span><span class="w">   </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">awvalid</span><span class="w">    </span><span class="p">),</span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_awready</span><span class="w">   </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">awready</span><span class="w">    </span><span class="p">),</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_wdata</span><span class="w">     </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">wdata</span><span class="w">      </span><span class="p">),</span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_wstrb</span><span class="w">     </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">wstrb</span><span class="w">      </span><span class="p">),</span>
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_wvalid</span><span class="w">    </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">wvalid</span><span class="w">     </span><span class="p">),</span>
<a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_wready</span><span class="w">    </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">wready</span><span class="w">     </span><span class="p">),</span>
<a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_bresp</span><span class="w">     </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">bresp</span><span class="w">      </span><span class="p">),</span>
<a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_bvalid</span><span class="w">    </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">bvalid</span><span class="w">     </span><span class="p">),</span>
<a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_bready</span><span class="w">    </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">bready</span><span class="w">     </span><span class="p">),</span>
<a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_araddr</span><span class="w">    </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">araddr</span><span class="w">     </span><span class="p">),</span>
<a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_arprot</span><span class="w">    </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">arprot</span><span class="w">     </span><span class="p">),</span>
<a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_arvalid</span><span class="w">   </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">arvalid</span><span class="w">    </span><span class="p">),</span>
<a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_arready</span><span class="w">   </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">arready</span><span class="w">    </span><span class="p">),</span>
<a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_rdata</span><span class="w">     </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">rdata</span><span class="w">      </span><span class="p">),</span>
<a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_rresp</span><span class="w">     </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">rresp</span><span class="w">      </span><span class="p">),</span>
<a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_rvalid</span><span class="w">    </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">rvalid</span><span class="w">     </span><span class="p">),</span>
<a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a><span class="p">.</span><span class="n">bpf_hello_fim_slv_rready</span><span class="w">    </span><span class="p">(</span><span class="n">bpf_hello_fim_slv_if</span><span class="p">.</span><span class="n">rready</span><span class="w">     </span><span class="p">),</span>
<a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a><span class="p">...</span>
<a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a><span class="k">endmodule</span>
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Create <code>src/hello_fim</code></p>
<ol>
<li>
<p>Create <code>src/hello_fim</code> directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>mkdir<span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/src/hello_fim
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Create <code>src/hello_fim/hello_fim_top.sv</code></p>
<ol>
<li>
<p>Create <code>hello_fim_top.sv</code> with the following contents:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1">// ***************************************************************************</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="c1">//                               INTEL CONFIDENTIAL</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="c1">//</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="c1">//        Copyright (C) 2023 Intel Corporation All Rights Reserved.</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="c1">//</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="c1">// The source code contained or described herein and all  documents related to</span>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="c1">// the  source  code  (&quot;Material&quot;)  are  owned  by  Intel  Corporation  or its</span>
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="c1">// suppliers  or  licensors.    Title  to  the  Material  remains  with  Intel</span>
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="c1">// Corporation or  its suppliers  and licensors.  The Material  contains trade</span>
<a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="c1">// secrets  and  proprietary  and  confidential  information  of  Intel or its</span>
<a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="c1">// suppliers and licensors.  The Material is protected  by worldwide copyright</span>
<a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="c1">// and trade secret laws and treaty provisions. No part of the Material may be</span>
<a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a><span class="c1">// used,   copied,   reproduced,   modified,   published,   uploaded,  posted,</span>
<a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a><span class="c1">// transmitted,  distributed,  or  disclosed  in any way without Intel&#39;s prior</span>
<a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a><span class="c1">// express written permission.</span>
<a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a><span class="c1">//</span>
<a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a><span class="c1">// No license under any patent,  copyright, trade secret or other intellectual</span>
<a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a><span class="c1">// property  right  is  granted  to  or  conferred  upon  you by disclosure or</span>
<a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a><span class="c1">// delivery  of  the  Materials, either expressly, by implication, inducement,</span>
<a id="__codelineno-54-20" name="__codelineno-54-20" href="#__codelineno-54-20"></a><span class="c1">// estoppel or otherwise.  Any license under such intellectual property rights</span>
<a id="__codelineno-54-21" name="__codelineno-54-21" href="#__codelineno-54-21"></a><span class="c1">// must be express and approved by Intel in writing.</span>
<a id="__codelineno-54-22" name="__codelineno-54-22" href="#__codelineno-54-22"></a><span class="c1">//</span>
<a id="__codelineno-54-23" name="__codelineno-54-23" href="#__codelineno-54-23"></a><span class="c1">// You will not, and will not allow any third party to modify, adapt, enhance, </span>
<a id="__codelineno-54-24" name="__codelineno-54-24" href="#__codelineno-54-24"></a><span class="c1">// disassemble, decompile, reverse engineer, change or create derivative works </span>
<a id="__codelineno-54-25" name="__codelineno-54-25" href="#__codelineno-54-25"></a><span class="c1">// from the Software except and only to the extent as specifically required by </span>
<a id="__codelineno-54-26" name="__codelineno-54-26" href="#__codelineno-54-26"></a><span class="c1">// mandatory applicable laws or any applicable third party license terms </span>
<a id="__codelineno-54-27" name="__codelineno-54-27" href="#__codelineno-54-27"></a><span class="c1">// accompanying the Software.</span>
<a id="__codelineno-54-28" name="__codelineno-54-28" href="#__codelineno-54-28"></a><span class="c1">//</span>
<a id="__codelineno-54-29" name="__codelineno-54-29" href="#__codelineno-54-29"></a><span class="c1">// -----------------------------------------------------------------------------</span>
<a id="__codelineno-54-30" name="__codelineno-54-30" href="#__codelineno-54-30"></a><span class="c1">// Engineer     : </span>
<a id="__codelineno-54-31" name="__codelineno-54-31" href="#__codelineno-54-31"></a><span class="c1">// Create Date  : Nov 2021</span>
<a id="__codelineno-54-32" name="__codelineno-54-32" href="#__codelineno-54-32"></a><span class="c1">// Module Name  : hello_fim_top.sv</span>
<a id="__codelineno-54-33" name="__codelineno-54-33" href="#__codelineno-54-33"></a><span class="c1">// Project      : IOFS</span>
<a id="__codelineno-54-34" name="__codelineno-54-34" href="#__codelineno-54-34"></a><span class="c1">// -----------------------------------------------------------------------------</span>
<a id="__codelineno-54-35" name="__codelineno-54-35" href="#__codelineno-54-35"></a><span class="c1">//</span>
<a id="__codelineno-54-36" name="__codelineno-54-36" href="#__codelineno-54-36"></a><span class="c1">// Description: </span>
<a id="__codelineno-54-37" name="__codelineno-54-37" href="#__codelineno-54-37"></a><span class="c1">// This is a simple module that implements DFH registers and </span>
<a id="__codelineno-54-38" name="__codelineno-54-38" href="#__codelineno-54-38"></a><span class="c1">// AVMM address decoding logic.</span>
<a id="__codelineno-54-39" name="__codelineno-54-39" href="#__codelineno-54-39"></a>
<a id="__codelineno-54-40" name="__codelineno-54-40" href="#__codelineno-54-40"></a><span class="k">module</span><span class="w"> </span><span class="n">hello_fim_top</span><span class="w">  </span><span class="p">#(</span>
<a id="__codelineno-54-41" name="__codelineno-54-41" href="#__codelineno-54-41"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="n">ADDR_WIDTH</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mh">12</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-54-42" name="__codelineno-54-42" href="#__codelineno-54-42"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="n">DATA_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-54-43" name="__codelineno-54-43" href="#__codelineno-54-43"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="p">[</span><span class="mh">11</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">FEAT_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">12&#39;h001</span><span class="p">,</span>
<a id="__codelineno-54-44" name="__codelineno-54-44" href="#__codelineno-54-44"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">FEAT_VER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4&#39;h1</span><span class="p">,</span>
<a id="__codelineno-54-45" name="__codelineno-54-45" href="#__codelineno-54-45"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="p">[</span><span class="mh">23</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">NEXT_DFH_OFFSET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">24&#39;h1000</span><span class="p">,</span>
<a id="__codelineno-54-46" name="__codelineno-54-46" href="#__codelineno-54-46"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="n">END_OF_LIST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span>
<a id="__codelineno-54-47" name="__codelineno-54-47" href="#__codelineno-54-47"></a><span class="p">)(</span>
<a id="__codelineno-54-48" name="__codelineno-54-48" href="#__codelineno-54-48"></a><span class="w">   </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">    </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-54-49" name="__codelineno-54-49" href="#__codelineno-54-49"></a><span class="w">   </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">    </span><span class="n">reset</span><span class="p">,</span>
<a id="__codelineno-54-50" name="__codelineno-54-50" href="#__codelineno-54-50"></a><span class="c1">// -----------------------------------------------------------</span>
<a id="__codelineno-54-51" name="__codelineno-54-51" href="#__codelineno-54-51"></a><span class="c1">//  AXI4LITE Interface</span>
<a id="__codelineno-54-52" name="__codelineno-54-52" href="#__codelineno-54-52"></a><span class="c1">// -----------------------------------------------------------</span>
<a id="__codelineno-54-53" name="__codelineno-54-53" href="#__codelineno-54-53"></a><span class="w">   </span><span class="n">ofs_fim_axi_lite_if</span><span class="p">.</span><span class="n">slave</span><span class="w">   </span><span class="n">csr_lite_if</span>
<a id="__codelineno-54-54" name="__codelineno-54-54" href="#__codelineno-54-54"></a><span class="p">);</span>
<a id="__codelineno-54-55" name="__codelineno-54-55" href="#__codelineno-54-55"></a>
<a id="__codelineno-54-56" name="__codelineno-54-56" href="#__codelineno-54-56"></a><span class="kn">import</span> <span class="nn">ofs_fim_cfg_pkg::*</span><span class="p">;</span>
<a id="__codelineno-54-57" name="__codelineno-54-57" href="#__codelineno-54-57"></a><span class="kn">import</span> <span class="nn">ofs_csr_pkg::*</span><span class="p">;</span>
<a id="__codelineno-54-58" name="__codelineno-54-58" href="#__codelineno-54-58"></a>
<a id="__codelineno-54-59" name="__codelineno-54-59" href="#__codelineno-54-59"></a><span class="c1">//-------------------------------------</span>
<a id="__codelineno-54-60" name="__codelineno-54-60" href="#__codelineno-54-60"></a><span class="c1">// Signals</span>
<a id="__codelineno-54-61" name="__codelineno-54-61" href="#__codelineno-54-61"></a><span class="c1">//-------------------------------------</span>
<a id="__codelineno-54-62" name="__codelineno-54-62" href="#__codelineno-54-62"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">csr_waddr</span><span class="p">;</span>
<a id="__codelineno-54-63" name="__codelineno-54-63" href="#__codelineno-54-63"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DATA_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">csr_wdata</span><span class="p">;</span>
<a id="__codelineno-54-64" name="__codelineno-54-64" href="#__codelineno-54-64"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DATA_WIDTH</span><span class="o">/</span><span class="mh">8</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">            </span><span class="n">csr_wstrb</span><span class="p">;</span>
<a id="__codelineno-54-65" name="__codelineno-54-65" href="#__codelineno-54-65"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">csr_write</span><span class="p">;</span>
<a id="__codelineno-54-66" name="__codelineno-54-66" href="#__codelineno-54-66"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">csr_slv_wready</span><span class="p">;</span>
<a id="__codelineno-54-67" name="__codelineno-54-67" href="#__codelineno-54-67"></a><span class="w">   </span><span class="n">csr_access_type_t</span><span class="w">                   </span><span class="n">csr_write_type</span><span class="p">;</span>
<a id="__codelineno-54-68" name="__codelineno-54-68" href="#__codelineno-54-68"></a>
<a id="__codelineno-54-69" name="__codelineno-54-69" href="#__codelineno-54-69"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">csr_raddr</span><span class="p">;</span>
<a id="__codelineno-54-70" name="__codelineno-54-70" href="#__codelineno-54-70"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">csr_read</span><span class="p">;</span>
<a id="__codelineno-54-71" name="__codelineno-54-71" href="#__codelineno-54-71"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">csr_read_32b</span><span class="p">;</span>
<a id="__codelineno-54-72" name="__codelineno-54-72" href="#__codelineno-54-72"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DATA_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">csr_readdata</span><span class="p">;</span>
<a id="__codelineno-54-73" name="__codelineno-54-73" href="#__codelineno-54-73"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">csr_readdata_valid</span><span class="p">;</span>
<a id="__codelineno-54-74" name="__codelineno-54-74" href="#__codelineno-54-74"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">csr_addr</span><span class="p">;</span>
<a id="__codelineno-54-75" name="__codelineno-54-75" href="#__codelineno-54-75"></a>
<a id="__codelineno-54-76" name="__codelineno-54-76" href="#__codelineno-54-76"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">                        </span><span class="n">com_csr_writedata</span><span class="p">;</span>
<a id="__codelineno-54-77" name="__codelineno-54-77" href="#__codelineno-54-77"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">com_csr_read</span><span class="p">;</span>
<a id="__codelineno-54-78" name="__codelineno-54-78" href="#__codelineno-54-78"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">com_csr_write</span><span class="p">;</span>
<a id="__codelineno-54-79" name="__codelineno-54-79" href="#__codelineno-54-79"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">                        </span><span class="n">com_csr_readdata</span><span class="p">;</span>
<a id="__codelineno-54-80" name="__codelineno-54-80" href="#__codelineno-54-80"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">com_csr_readdatavalid</span><span class="p">;</span>
<a id="__codelineno-54-81" name="__codelineno-54-81" href="#__codelineno-54-81"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">                         </span><span class="n">com_csr_address</span><span class="p">;</span>
<a id="__codelineno-54-82" name="__codelineno-54-82" href="#__codelineno-54-82"></a>
<a id="__codelineno-54-83" name="__codelineno-54-83" href="#__codelineno-54-83"></a><span class="c1">// AXI-M CSR interfaces</span>
<a id="__codelineno-54-84" name="__codelineno-54-84" href="#__codelineno-54-84"></a><span class="n">ofs_fim_axi_mmio_if</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-54-85" name="__codelineno-54-85" href="#__codelineno-54-85"></a><span class="w">   </span><span class="p">.</span><span class="n">AWID_WIDTH</span><span class="w">   </span><span class="p">(</span><span class="n">ofs_fim_cfg_pkg</span><span class="o">::</span><span class="n">MMIO_TID_WIDTH</span><span class="p">),</span>
<a id="__codelineno-54-86" name="__codelineno-54-86" href="#__codelineno-54-86"></a><span class="w">   </span><span class="p">.</span><span class="n">AWADDR_WIDTH</span><span class="w"> </span><span class="p">(</span><span class="n">ADDR_WIDTH</span><span class="p">),</span>
<a id="__codelineno-54-87" name="__codelineno-54-87" href="#__codelineno-54-87"></a><span class="w">   </span><span class="p">.</span><span class="n">WDATA_WIDTH</span><span class="w">  </span><span class="p">(</span><span class="n">ofs_fim_cfg_pkg</span><span class="o">::</span><span class="n">MMIO_DATA_WIDTH</span><span class="p">),</span>
<a id="__codelineno-54-88" name="__codelineno-54-88" href="#__codelineno-54-88"></a><span class="w">   </span><span class="p">.</span><span class="n">ARID_WIDTH</span><span class="w">   </span><span class="p">(</span><span class="n">ofs_fim_cfg_pkg</span><span class="o">::</span><span class="n">MMIO_TID_WIDTH</span><span class="p">),</span>
<a id="__codelineno-54-89" name="__codelineno-54-89" href="#__codelineno-54-89"></a><span class="w">   </span><span class="p">.</span><span class="n">ARADDR_WIDTH</span><span class="w"> </span><span class="p">(</span><span class="n">ADDR_WIDTH</span><span class="p">),</span>
<a id="__codelineno-54-90" name="__codelineno-54-90" href="#__codelineno-54-90"></a><span class="w">   </span><span class="p">.</span><span class="n">RDATA_WIDTH</span><span class="w">  </span><span class="p">(</span><span class="n">ofs_fim_cfg_pkg</span><span class="o">::</span><span class="n">MMIO_DATA_WIDTH</span><span class="p">)</span>
<a id="__codelineno-54-91" name="__codelineno-54-91" href="#__codelineno-54-91"></a><span class="p">)</span><span class="w"> </span><span class="n">csr_if</span><span class="p">();</span>
<a id="__codelineno-54-92" name="__codelineno-54-92" href="#__codelineno-54-92"></a>
<a id="__codelineno-54-93" name="__codelineno-54-93" href="#__codelineno-54-93"></a><span class="c1">// AXI4-lite to AXI-M adapter</span>
<a id="__codelineno-54-94" name="__codelineno-54-94" href="#__codelineno-54-94"></a><span class="n">axi_lite2mmio</span><span class="w"> </span><span class="n">axi_lite2mmio</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-54-95" name="__codelineno-54-95" href="#__codelineno-54-95"></a><span class="w">   </span><span class="p">.</span><span class="n">clk</span><span class="w">       </span><span class="p">(</span><span class="n">clk</span><span class="p">),</span>
<a id="__codelineno-54-96" name="__codelineno-54-96" href="#__codelineno-54-96"></a><span class="w">   </span><span class="p">.</span><span class="n">rst_n</span><span class="w">     </span><span class="p">(</span><span class="o">~</span><span class="n">reset</span><span class="p">),</span>
<a id="__codelineno-54-97" name="__codelineno-54-97" href="#__codelineno-54-97"></a><span class="w">   </span><span class="p">.</span><span class="n">lite_if</span><span class="w">   </span><span class="p">(</span><span class="n">csr_lite_if</span><span class="p">),</span>
<a id="__codelineno-54-98" name="__codelineno-54-98" href="#__codelineno-54-98"></a><span class="w">   </span><span class="p">.</span><span class="n">mmio_if</span><span class="w">   </span><span class="p">(</span><span class="n">csr_if</span><span class="p">)</span>
<a id="__codelineno-54-99" name="__codelineno-54-99" href="#__codelineno-54-99"></a><span class="p">);</span>
<a id="__codelineno-54-100" name="__codelineno-54-100" href="#__codelineno-54-100"></a>
<a id="__codelineno-54-101" name="__codelineno-54-101" href="#__codelineno-54-101"></a><span class="c1">//---------------------------------</span>
<a id="__codelineno-54-102" name="__codelineno-54-102" href="#__codelineno-54-102"></a><span class="c1">// Map AXI write/read request to CSR write/read,</span>
<a id="__codelineno-54-103" name="__codelineno-54-103" href="#__codelineno-54-103"></a><span class="c1">// and send the write/read response back</span>
<a id="__codelineno-54-104" name="__codelineno-54-104" href="#__codelineno-54-104"></a><span class="c1">//---------------------------------</span>
<a id="__codelineno-54-105" name="__codelineno-54-105" href="#__codelineno-54-105"></a><span class="n">ofs_fim_axi_csr_slave</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-54-106" name="__codelineno-54-106" href="#__codelineno-54-106"></a><span class="w">   </span><span class="p">.</span><span class="n">ADDR_WIDTH</span><span class="w"> </span><span class="p">(</span><span class="n">ADDR_WIDTH</span><span class="p">),</span>
<a id="__codelineno-54-107" name="__codelineno-54-107" href="#__codelineno-54-107"></a><span class="w">   </span><span class="p">.</span><span class="n">USE_SLV_READY</span><span class="w"> </span><span class="p">(</span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">)</span>
<a id="__codelineno-54-108" name="__codelineno-54-108" href="#__codelineno-54-108"></a>
<a id="__codelineno-54-109" name="__codelineno-54-109" href="#__codelineno-54-109"></a><span class="w">   </span><span class="p">)</span><span class="w"> </span><span class="n">csr_slave</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-54-110" name="__codelineno-54-110" href="#__codelineno-54-110"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_if</span><span class="w">             </span><span class="p">(</span><span class="n">csr_if</span><span class="p">),</span>
<a id="__codelineno-54-111" name="__codelineno-54-111" href="#__codelineno-54-111"></a>
<a id="__codelineno-54-112" name="__codelineno-54-112" href="#__codelineno-54-112"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_write</span><span class="w">          </span><span class="p">(</span><span class="n">csr_write</span><span class="p">),</span>
<a id="__codelineno-54-113" name="__codelineno-54-113" href="#__codelineno-54-113"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_waddr</span><span class="w">          </span><span class="p">(</span><span class="n">csr_waddr</span><span class="p">),</span>
<a id="__codelineno-54-114" name="__codelineno-54-114" href="#__codelineno-54-114"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_write_type</span><span class="w">     </span><span class="p">(</span><span class="n">csr_write_type</span><span class="p">),</span>
<a id="__codelineno-54-115" name="__codelineno-54-115" href="#__codelineno-54-115"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_wdata</span><span class="w">          </span><span class="p">(</span><span class="n">csr_wdata</span><span class="p">),</span>
<a id="__codelineno-54-116" name="__codelineno-54-116" href="#__codelineno-54-116"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_wstrb</span><span class="w">          </span><span class="p">(</span><span class="n">csr_wstrb</span><span class="p">),</span>
<a id="__codelineno-54-117" name="__codelineno-54-117" href="#__codelineno-54-117"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_slv_wready</span><span class="w">     </span><span class="p">(</span><span class="n">csr_slv_wready</span><span class="p">),</span>
<a id="__codelineno-54-118" name="__codelineno-54-118" href="#__codelineno-54-118"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_read</span><span class="w">           </span><span class="p">(</span><span class="n">csr_read</span><span class="p">),</span>
<a id="__codelineno-54-119" name="__codelineno-54-119" href="#__codelineno-54-119"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_raddr</span><span class="w">          </span><span class="p">(</span><span class="n">csr_raddr</span><span class="p">),</span>
<a id="__codelineno-54-120" name="__codelineno-54-120" href="#__codelineno-54-120"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_read_32b</span><span class="w">       </span><span class="p">(</span><span class="n">csr_read_32b</span><span class="p">),</span>
<a id="__codelineno-54-121" name="__codelineno-54-121" href="#__codelineno-54-121"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_readdata</span><span class="w">       </span><span class="p">(</span><span class="n">csr_readdata</span><span class="p">),</span>
<a id="__codelineno-54-122" name="__codelineno-54-122" href="#__codelineno-54-122"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_readdata_valid</span><span class="w"> </span><span class="p">(</span><span class="n">csr_readdata_valid</span><span class="p">)</span>
<a id="__codelineno-54-123" name="__codelineno-54-123" href="#__codelineno-54-123"></a><span class="p">);</span>
<a id="__codelineno-54-124" name="__codelineno-54-124" href="#__codelineno-54-124"></a>
<a id="__codelineno-54-125" name="__codelineno-54-125" href="#__codelineno-54-125"></a><span class="c1">// Address mapping</span>
<a id="__codelineno-54-126" name="__codelineno-54-126" href="#__codelineno-54-126"></a><span class="k">assign</span><span class="w"> </span><span class="n">csr_addr</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">csr_write</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">csr_waddr</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">csr_raddr</span><span class="p">;</span>
<a id="__codelineno-54-127" name="__codelineno-54-127" href="#__codelineno-54-127"></a><span class="k">assign</span><span class="w"> </span><span class="n">com_csr_address</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">csr_addr</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span><span class="w">  </span><span class="c1">// byte address</span>
<a id="__codelineno-54-128" name="__codelineno-54-128" href="#__codelineno-54-128"></a><span class="k">assign</span><span class="w"> </span><span class="n">csr_slv_wready</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-54-129" name="__codelineno-54-129" href="#__codelineno-54-129"></a><span class="c1">// Write data mapping</span>
<a id="__codelineno-54-130" name="__codelineno-54-130" href="#__codelineno-54-130"></a><span class="k">assign</span><span class="w"> </span><span class="n">com_csr_writedata</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">csr_wdata</span><span class="p">;</span>
<a id="__codelineno-54-131" name="__codelineno-54-131" href="#__codelineno-54-131"></a>
<a id="__codelineno-54-132" name="__codelineno-54-132" href="#__codelineno-54-132"></a><span class="c1">// Read-Write mapping</span>
<a id="__codelineno-54-133" name="__codelineno-54-133" href="#__codelineno-54-133"></a><span class="k">always_comb</span>
<a id="__codelineno-54-134" name="__codelineno-54-134" href="#__codelineno-54-134"></a><span class="k">begin</span>
<a id="__codelineno-54-135" name="__codelineno-54-135" href="#__codelineno-54-135"></a><span class="w">   </span><span class="n">com_csr_read</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-54-136" name="__codelineno-54-136" href="#__codelineno-54-136"></a><span class="w">   </span><span class="n">com_csr_write</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-54-137" name="__codelineno-54-137" href="#__codelineno-54-137"></a><span class="w">   </span><span class="k">casez</span><span class="w"> </span><span class="p">(</span><span class="n">csr_addr</span><span class="p">[</span><span class="mh">11</span><span class="o">:</span><span class="mh">6</span><span class="p">])</span>
<a id="__codelineno-54-138" name="__codelineno-54-138" href="#__codelineno-54-138"></a><span class="w">      </span><span class="mh">6&#39;h00</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">begin</span><span class="w"> </span><span class="c1">// Common CSR</span>
<a id="__codelineno-54-139" name="__codelineno-54-139" href="#__codelineno-54-139"></a><span class="w">         </span><span class="n">com_csr_read</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">csr_read</span><span class="p">;</span>
<a id="__codelineno-54-140" name="__codelineno-54-140" href="#__codelineno-54-140"></a><span class="w">         </span><span class="n">com_csr_write</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">csr_write</span><span class="p">;</span>
<a id="__codelineno-54-141" name="__codelineno-54-141" href="#__codelineno-54-141"></a><span class="w">      </span><span class="k">end</span><span class="w">   </span>
<a id="__codelineno-54-142" name="__codelineno-54-142" href="#__codelineno-54-142"></a><span class="w">      </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-54-143" name="__codelineno-54-143" href="#__codelineno-54-143"></a><span class="w">         </span><span class="n">com_csr_read</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-54-144" name="__codelineno-54-144" href="#__codelineno-54-144"></a><span class="w">         </span><span class="n">com_csr_write</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-54-145" name="__codelineno-54-145" href="#__codelineno-54-145"></a><span class="w">      </span><span class="k">end</span>
<a id="__codelineno-54-146" name="__codelineno-54-146" href="#__codelineno-54-146"></a><span class="w">   </span><span class="k">endcase</span>
<a id="__codelineno-54-147" name="__codelineno-54-147" href="#__codelineno-54-147"></a><span class="k">end</span>
<a id="__codelineno-54-148" name="__codelineno-54-148" href="#__codelineno-54-148"></a>
<a id="__codelineno-54-149" name="__codelineno-54-149" href="#__codelineno-54-149"></a><span class="c1">// Read data mapping</span>
<a id="__codelineno-54-150" name="__codelineno-54-150" href="#__codelineno-54-150"></a><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-54-151" name="__codelineno-54-151" href="#__codelineno-54-151"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">com_csr_readdatavalid</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-54-152" name="__codelineno-54-152" href="#__codelineno-54-152"></a><span class="w">      </span><span class="n">csr_readdata</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">com_csr_readdata</span><span class="p">;</span>
<a id="__codelineno-54-153" name="__codelineno-54-153" href="#__codelineno-54-153"></a><span class="w">      </span><span class="n">csr_readdata_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
<a id="__codelineno-54-154" name="__codelineno-54-154" href="#__codelineno-54-154"></a><span class="w">   </span><span class="k">end</span>
<a id="__codelineno-54-155" name="__codelineno-54-155" href="#__codelineno-54-155"></a><span class="w">   </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-54-156" name="__codelineno-54-156" href="#__codelineno-54-156"></a><span class="w">      </span><span class="n">csr_readdata</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="m">&#39;0</span><span class="p">;</span>
<a id="__codelineno-54-157" name="__codelineno-54-157" href="#__codelineno-54-157"></a><span class="w">      </span><span class="n">csr_readdata_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-54-158" name="__codelineno-54-158" href="#__codelineno-54-158"></a><span class="w">   </span><span class="k">end</span>
<a id="__codelineno-54-159" name="__codelineno-54-159" href="#__codelineno-54-159"></a><span class="k">end</span>
<a id="__codelineno-54-160" name="__codelineno-54-160" href="#__codelineno-54-160"></a>
<a id="__codelineno-54-161" name="__codelineno-54-161" href="#__codelineno-54-161"></a><span class="n">hello_fim_com</span><span class="w">  </span><span class="p">#(</span>
<a id="__codelineno-54-162" name="__codelineno-54-162" href="#__codelineno-54-162"></a><span class="w">   </span><span class="p">.</span><span class="n">FEAT_ID</span><span class="w">          </span><span class="p">(</span><span class="n">FEAT_ID</span><span class="p">),</span>
<a id="__codelineno-54-163" name="__codelineno-54-163" href="#__codelineno-54-163"></a><span class="w">   </span><span class="p">.</span><span class="n">FEAT_VER</span><span class="w">         </span><span class="p">(</span><span class="n">FEAT_VER</span><span class="p">),</span>
<a id="__codelineno-54-164" name="__codelineno-54-164" href="#__codelineno-54-164"></a><span class="w">   </span><span class="p">.</span><span class="n">NEXT_DFH_OFFSET</span><span class="w">  </span><span class="p">(</span><span class="n">NEXT_DFH_OFFSET</span><span class="p">),</span>
<a id="__codelineno-54-165" name="__codelineno-54-165" href="#__codelineno-54-165"></a><span class="w">   </span><span class="p">.</span><span class="n">END_OF_LIST</span><span class="w">      </span><span class="p">(</span><span class="n">END_OF_LIST</span><span class="p">)</span>
<a id="__codelineno-54-166" name="__codelineno-54-166" href="#__codelineno-54-166"></a><span class="p">)</span><span class="w"> </span><span class="n">hello_fim_com_inst</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-54-167" name="__codelineno-54-167" href="#__codelineno-54-167"></a><span class="w">   </span><span class="p">.</span><span class="n">clk</span><span class="w">                   </span><span class="p">(</span><span class="n">clk</span><span class="w">                     </span><span class="p">),</span>
<a id="__codelineno-54-168" name="__codelineno-54-168" href="#__codelineno-54-168"></a><span class="w">   </span><span class="p">.</span><span class="n">reset</span><span class="w">                 </span><span class="p">(</span><span class="n">reset</span><span class="w">                   </span><span class="p">),</span>
<a id="__codelineno-54-169" name="__codelineno-54-169" href="#__codelineno-54-169"></a><span class="w">   </span><span class="p">.</span><span class="n">writedata</span><span class="w">             </span><span class="p">(</span><span class="n">com_csr_writedata</span><span class="w">       </span><span class="p">),</span>
<a id="__codelineno-54-170" name="__codelineno-54-170" href="#__codelineno-54-170"></a><span class="w">   </span><span class="p">.</span><span class="n">read</span><span class="w">                  </span><span class="p">(</span><span class="n">com_csr_read</span><span class="w">            </span><span class="p">),</span>
<a id="__codelineno-54-171" name="__codelineno-54-171" href="#__codelineno-54-171"></a><span class="w">   </span><span class="p">.</span><span class="n">write</span><span class="w">                 </span><span class="p">(</span><span class="n">com_csr_write</span><span class="w">           </span><span class="p">),</span>
<a id="__codelineno-54-172" name="__codelineno-54-172" href="#__codelineno-54-172"></a><span class="w">   </span><span class="p">.</span><span class="n">byteenable</span><span class="w">            </span><span class="p">(</span><span class="mh">4&#39;hF</span><span class="w">                    </span><span class="p">),</span>
<a id="__codelineno-54-173" name="__codelineno-54-173" href="#__codelineno-54-173"></a><span class="w">   </span><span class="p">.</span><span class="n">readdata</span><span class="w">              </span><span class="p">(</span><span class="n">com_csr_readdata</span><span class="w">        </span><span class="p">),</span>
<a id="__codelineno-54-174" name="__codelineno-54-174" href="#__codelineno-54-174"></a><span class="w">   </span><span class="p">.</span><span class="n">readdatavalid</span><span class="w">         </span><span class="p">(</span><span class="n">com_csr_readdatavalid</span><span class="w">   </span><span class="p">),</span>
<a id="__codelineno-54-175" name="__codelineno-54-175" href="#__codelineno-54-175"></a><span class="w">   </span><span class="p">.</span><span class="n">address</span><span class="w">               </span><span class="p">(</span><span class="n">com_csr_address</span><span class="w">         </span><span class="p">)</span>
<a id="__codelineno-54-176" name="__codelineno-54-176" href="#__codelineno-54-176"></a><span class="w">   </span><span class="p">);</span>
<a id="__codelineno-54-177" name="__codelineno-54-177" href="#__codelineno-54-177"></a><span class="k">endmodule</span>
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Create <code>src/hello_fim/hello_fim_com.sv</code></p>
<ol>
<li>
<p>Create <code>hello_fim_com.sv</code> with the following contents:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">module</span><span class="w"> </span><span class="n">hello_fim_com</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="p">[</span><span class="mh">11</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">FEAT_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">12&#39;h001</span><span class="p">,</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">FEAT_VER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4&#39;h1</span><span class="p">,</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="p">[</span><span class="mh">23</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">NEXT_DFH_OFFSET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">24&#39;h1000</span><span class="p">,</span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="n">END_OF_LIST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="p">)(</span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="k">input</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="k">input</span><span class="w"> </span><span class="n">reset</span><span class="p">,</span>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">writedata</span><span class="p">,</span>
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="k">input</span><span class="w"> </span><span class="n">read</span><span class="p">,</span>
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="k">input</span><span class="w"> </span><span class="n">write</span><span class="p">,</span>
<a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">byteenable</span><span class="p">,</span>
<a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">readdata</span><span class="p">,</span>
<a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">readdatavalid</span><span class="p">,</span>
<a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">address</span>
<a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="p">);</span>
<a id="__codelineno-55-17" name="__codelineno-55-17" href="#__codelineno-55-17"></a>
<a id="__codelineno-55-18" name="__codelineno-55-18" href="#__codelineno-55-18"></a><span class="kt">wire</span><span class="w"> </span><span class="n">reset_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">reset</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-55-19" name="__codelineno-55-19" href="#__codelineno-55-19"></a><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">rdata_comb</span><span class="p">;</span>
<a id="__codelineno-55-20" name="__codelineno-55-20" href="#__codelineno-55-20"></a><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">scratch_reg</span><span class="p">;</span>
<a id="__codelineno-55-21" name="__codelineno-55-21" href="#__codelineno-55-21"></a>
<a id="__codelineno-55-22" name="__codelineno-55-22" href="#__codelineno-55-22"></a><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">negedge</span><span class="w"> </span><span class="n">reset_n</span><span class="w"> </span><span class="p">,</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span><span class="w">  </span>
<a id="__codelineno-55-23" name="__codelineno-55-23" href="#__codelineno-55-23"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">reset_n</span><span class="p">)</span><span class="w"> </span><span class="n">readdata</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="p">;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">readdata</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">rdata_comb</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<a id="__codelineno-55-24" name="__codelineno-55-24" href="#__codelineno-55-24"></a>
<a id="__codelineno-55-25" name="__codelineno-55-25" href="#__codelineno-55-25"></a><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">negedge</span><span class="w"> </span><span class="n">reset_n</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span>
<a id="__codelineno-55-26" name="__codelineno-55-26" href="#__codelineno-55-26"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">reset_n</span><span class="p">)</span><span class="w"> </span><span class="n">readdatavalid</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">readdatavalid</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">read</span><span class="p">;</span>
<a id="__codelineno-55-27" name="__codelineno-55-27" href="#__codelineno-55-27"></a>
<a id="__codelineno-55-28" name="__codelineno-55-28" href="#__codelineno-55-28"></a><span class="kt">wire</span><span class="w"> </span><span class="n">wr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">write</span><span class="p">;</span>
<a id="__codelineno-55-29" name="__codelineno-55-29" href="#__codelineno-55-29"></a><span class="kt">wire</span><span class="w"> </span><span class="n">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read</span><span class="p">;</span>
<a id="__codelineno-55-30" name="__codelineno-55-30" href="#__codelineno-55-30"></a><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">address</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<a id="__codelineno-55-31" name="__codelineno-55-31" href="#__codelineno-55-31"></a><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">din</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">writedata</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<a id="__codelineno-55-32" name="__codelineno-55-32" href="#__codelineno-55-32"></a><span class="kt">wire</span><span class="w"> </span><span class="n">wr_scratch_reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wr</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="o">==</span><span class="w"> </span><span class="mh">6&#39;h30</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="n">byteenable</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="o">:</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-55-33" name="__codelineno-55-33" href="#__codelineno-55-33"></a>
<a id="__codelineno-55-34" name="__codelineno-55-34" href="#__codelineno-55-34"></a><span class="c1">// 64 bit scratch register</span>
<a id="__codelineno-55-35" name="__codelineno-55-35" href="#__codelineno-55-35"></a><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="w"> </span><span class="k">negedge</span><span class="w">  </span><span class="n">reset_n</span><span class="p">,</span><span class="w">  </span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span>
<a id="__codelineno-55-36" name="__codelineno-55-36" href="#__codelineno-55-36"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">reset_n</span><span class="p">)</span><span class="w">  </span><span class="k">begin</span>
<a id="__codelineno-55-37" name="__codelineno-55-37" href="#__codelineno-55-37"></a><span class="w">      </span><span class="n">scratch_reg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="p">;</span>
<a id="__codelineno-55-38" name="__codelineno-55-38" href="#__codelineno-55-38"></a><span class="w">   </span><span class="k">end</span>
<a id="__codelineno-55-39" name="__codelineno-55-39" href="#__codelineno-55-39"></a><span class="w">   </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-55-40" name="__codelineno-55-40" href="#__codelineno-55-40"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wr_scratch_reg</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"> </span>
<a id="__codelineno-55-41" name="__codelineno-55-41" href="#__codelineno-55-41"></a><span class="w">      </span><span class="n">scratch_reg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w">  </span><span class="n">din</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-55-42" name="__codelineno-55-42" href="#__codelineno-55-42"></a><span class="w">   </span><span class="k">end</span>
<a id="__codelineno-55-43" name="__codelineno-55-43" href="#__codelineno-55-43"></a><span class="k">end</span>
<a id="__codelineno-55-44" name="__codelineno-55-44" href="#__codelineno-55-44"></a>
<a id="__codelineno-55-45" name="__codelineno-55-45" href="#__codelineno-55-45"></a><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<a id="__codelineno-55-46" name="__codelineno-55-46" href="#__codelineno-55-46"></a><span class="k">begin</span>
<a id="__codelineno-55-47" name="__codelineno-55-47" href="#__codelineno-55-47"></a><span class="n">rdata_comb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h0000000000000000</span><span class="p">;</span>
<a id="__codelineno-55-48" name="__codelineno-55-48" href="#__codelineno-55-48"></a><span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">re</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-55-49" name="__codelineno-55-49" href="#__codelineno-55-49"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">addr</span><span class="p">)</span><span class="w">  </span>
<a id="__codelineno-55-50" name="__codelineno-55-50" href="#__codelineno-55-50"></a><span class="w">        </span><span class="mh">6&#39;h00</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-55-51" name="__codelineno-55-51" href="#__codelineno-55-51"></a><span class="w">                </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">11</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">FEAT_ID</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="c1">// dfh_feature_id  is reserved or a constant value, a read access gives the reset value</span>
<a id="__codelineno-55-52" name="__codelineno-55-52" href="#__codelineno-55-52"></a><span class="w">                </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">12</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">FEAT_VER</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="c1">// dfh_feature_rev    is reserved or a constant value, a read access gives the reset value</span>
<a id="__codelineno-55-53" name="__codelineno-55-53" href="#__codelineno-55-53"></a><span class="w">                </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">16</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NEXT_DFH_OFFSET</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="c1">// dfh_dfh_ofst is reserved or a constant value, a read access gives the reset value</span>
<a id="__codelineno-55-54" name="__codelineno-55-54" href="#__codelineno-55-54"></a><span class="w">                </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">40</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">END_OF_LIST</span><span class="w"> </span><span class="p">;</span><span class="w">        </span><span class="c1">//dfh_end_of_list</span>
<a id="__codelineno-55-55" name="__codelineno-55-55" href="#__codelineno-55-55"></a><span class="w">                </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">59</span><span class="o">:</span><span class="mh">40</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mh">20&#39;h00000</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="c1">// dfh_rsvd1     is reserved or a constant value, a read access gives the reset value</span>
<a id="__codelineno-55-56" name="__codelineno-55-56" href="#__codelineno-55-56"></a><span class="w">                </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">60</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mh">4&#39;h3</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="c1">// dfh_feat_type  is reserved or a constant value, a read access gives the reset value</span>
<a id="__codelineno-55-57" name="__codelineno-55-57" href="#__codelineno-55-57"></a><span class="w">        </span><span class="k">end</span>
<a id="__codelineno-55-58" name="__codelineno-55-58" href="#__codelineno-55-58"></a><span class="w">        </span><span class="mh">6&#39;h30</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-55-59" name="__codelineno-55-59" href="#__codelineno-55-59"></a><span class="w">                </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">scratch_reg</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-55-60" name="__codelineno-55-60" href="#__codelineno-55-60"></a><span class="w">        </span><span class="k">end</span>
<a id="__codelineno-55-61" name="__codelineno-55-61" href="#__codelineno-55-61"></a><span class="w">        </span><span class="mh">6&#39;h38</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-55-62" name="__codelineno-55-62" href="#__codelineno-55-62"></a><span class="w">                </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h6626</span><span class="n">_0701_5000_0034</span><span class="p">;</span>
<a id="__codelineno-55-63" name="__codelineno-55-63" href="#__codelineno-55-63"></a><span class="w">        </span><span class="k">end</span>
<a id="__codelineno-55-64" name="__codelineno-55-64" href="#__codelineno-55-64"></a><span class="w">        </span><span class="k">default</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-55-65" name="__codelineno-55-65" href="#__codelineno-55-65"></a><span class="w">                </span><span class="n">rdata_comb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h0000000000000000</span><span class="p">;</span>
<a id="__codelineno-55-66" name="__codelineno-55-66" href="#__codelineno-55-66"></a><span class="w">        </span><span class="k">end</span>
<a id="__codelineno-55-67" name="__codelineno-55-67" href="#__codelineno-55-67"></a><span class="w">      </span><span class="k">endcase</span>
<a id="__codelineno-55-68" name="__codelineno-55-68" href="#__codelineno-55-68"></a><span class="w">   </span><span class="k">end</span>
<a id="__codelineno-55-69" name="__codelineno-55-69" href="#__codelineno-55-69"></a><span class="k">end</span>
<a id="__codelineno-55-70" name="__codelineno-55-70" href="#__codelineno-55-70"></a>
<a id="__codelineno-55-71" name="__codelineno-55-71" href="#__codelineno-55-71"></a><span class="k">endmodule</span>
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Modify <code>src/pd_qsys/fabric/bpf.txt</code></p>
<ol>
<li>
<p>Add <code>hello_fim</code> as a slave in the BPF, and enable the SoC as a master for it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>#### - &#39;#&#39; means comment
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a># NAME   TYPE      BASEADDRESS    ADDRESS_WIDTH    SLAVES
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>apf         mst     n/a             21             fme,soc_pcie,hssi,qsfp0,qsfp1,emif,pmci,hello_fim
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>...
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>hello_fim   slv     0x16000         12             n/a
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Execute the helper script to re-generate the BPF design files</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/src/pd_qsys/fabric/
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>sh<span class="w"> </span>gen_fabrics.sh
</code></pre></div>
</li>
<li>
<p>After the shell script finishes, you can find the generated <code>bpf_hello_fim_slv.ip</code> file in <code>$OFS_ROOTDIR/src/pd_qsys/fabric/ip/bpf/</code>. This is the ip variant of the axi4lite shim that bridges the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module with the BPF. The updated <code>bpf.qsys</code> file is located in <code>$OFS_ROOTDIR/src/pd_qsys/fabric</code>. You can view the updated bpf file in Platform designer as follows.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/src/pd_qsys/fabric
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>qsys-edit<span class="w"> </span>bpf.qsys<span class="w"> </span>--quartus-project<span class="o">=</span><span class="nv">$OFS_ROOTDIR</span>/syn/syn_top/ofs_top.qpf
</code></pre></div>
<p>The image below shows the BPF that integrates the <code>bpf_hello_fim_slv</code> axi4lite shim at address 0x16000, generated through the helper script gen_fabrics.sh.</p>
<p><a class="glightbox" href="../images/hello_fim_auto_bpf.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/hello_fim_auto_bpf.png" /></a></p>
</li>
</ol>
<h4 id="517-unit-level-simulation-of-hello-fim-design"><strong>5.1.7 Unit Level Simulation of Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Design</strong><a class="headerlink" href="#517-unit-level-simulation-of-hello-fim-design" title="Permanent link">&para;</a></h4>
<p>The following section describes the file modifications that need to be made to perform unit level simulations of the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design, followed by instructions for running the unit level simulations.</p>
<h5 id="5171-unit-level-simulation-file-modification"><strong>5.1.7.1 Unit Level Simulation File Modification</strong><a class="headerlink" href="#5171-unit-level-simulation-file-modification" title="Permanent link">&para;</a></h5>
<p>Perform the following steps to modify the Unit Level simulation files to support the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design.</p>
<ol>
<li>
<p>Modify <code>$OFS_ROOTDIR/sim/unit_test/soc_tests/dfh_walker/test_csr_defs.sv</code></p>
<ol>
<li>
<p>Add a <code>HELLO_FIM_IDX</code> entry to the <code>t_dfh_idx</code> enumeration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="w">   </span><span class="n">FME_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="w">   </span><span class="n">THERM_MNGM_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="w">   </span><span class="n">GLBL_PERF_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w">   </span><span class="n">GLBL_ERROR_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="w">   </span><span class="n">QSFP0_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="w">   </span><span class="n">QSFP1_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="w">   </span><span class="n">HSSI_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="w">   </span><span class="n">EMIF_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a><span class="w">   </span><span class="n">HELLO_FIM_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="w">   </span><span class="n">PMCI_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="w">   </span><span class="n">ST2MM_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a><span class="w">   </span><span class="n">PG_PR_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a><span class="w">   </span><span class="n">PG_PORT_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a><span class="w">   </span><span class="n">PG_USER_CLK_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-16" name="__codelineno-59-16" href="#__codelineno-59-16"></a><span class="w">   </span><span class="n">PG_REMOTE_STP_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-17" name="__codelineno-59-17" href="#__codelineno-59-17"></a><span class="w">   </span><span class="n">AFU_ERR_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-59-18" name="__codelineno-59-18" href="#__codelineno-59-18"></a><span class="w">   </span><span class="n">MAX_DFH_IDX</span>
<a id="__codelineno-59-19" name="__codelineno-59-19" href="#__codelineno-59-19"></a><span class="p">}</span><span class="w"> </span><span class="n">t_dfh_idx</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>Add an entry for <code>HELLO_FIM_IDX</code> into the <code>get_dfh_names()</code> function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="k">function</span><span class="w"> </span><span class="k">automatic</span><span class="w"> </span><span class="n">dfh_name</span><span class="p">[</span><span class="n">MAX_DFH_IDX</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">get_dfh_names</span><span class="p">();</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="w">   </span><span class="n">dfh_name</span><span class="p">[</span><span class="n">MAX_DFH_IDX</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">dfh_names</span><span class="p">;</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">FME_DFH_IDX</span><span class="p">]</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;FME_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">THERM_MNGM_DFH_IDX</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;THERM_MNGM_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">GLBL_PERF_DFH_IDX</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;GLBL_PERF_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">GLBL_ERROR_DFH_IDX</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;GLBL_ERROR_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">QSFP0_DFH_IDX</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;QSFP0_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">QSFP1_DFH_IDX</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;QSFP1_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">HSSI_DFH_IDX</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HSSI_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">EMIF_DFH_IDX</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EMIF_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">HELLO_FIM_DFH_IDX</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HELLO_FIM_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">PMCI_DFH_IDX</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PMCI_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">ST2MM_DFH_IDX</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ST2MM_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">PG_PR_DFH_IDX</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PG_PR_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">PG_PORT_DFH_IDX</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PG_PORT_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-17" name="__codelineno-60-17" href="#__codelineno-60-17"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">PG_USER_CLK_DFH_IDX</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PG_USER_CLK_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-18" name="__codelineno-60-18" href="#__codelineno-60-18"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">PG_REMOTE_STP_DFH_IDX</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PG_REMOTE_STP_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-19" name="__codelineno-60-19" href="#__codelineno-60-19"></a><span class="w">   </span><span class="n">dfh_names</span><span class="p">[</span><span class="n">AFU_ERR_DFH_IDX</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;AFU_ERR_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-60-20" name="__codelineno-60-20" href="#__codelineno-60-20"></a>
<a id="__codelineno-60-21" name="__codelineno-60-21" href="#__codelineno-60-21"></a><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">dfh_names</span><span class="p">;</span>
<a id="__codelineno-60-22" name="__codelineno-60-22" href="#__codelineno-60-22"></a><span class="k">endfunction</span>
</code></pre></div>
</li>
<li>
<p>Modify the expected DFH value of the EMIF from <code>64'h3_00000_06B000_1009</code> to <code>64'h3_00000_001000_1009</code> and add the expected value for <code>HELLO_FIM</code> as <code>64'h3_00000_06A000_0100</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="k">function</span><span class="w"> </span><span class="k">automatic</span><span class="w"> </span><span class="p">[</span><span class="n">MAX_DFH_IDX</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">get_dfh_values</span><span class="p">();</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="w">   </span><span class="kt">logic</span><span class="p">[</span><span class="n">MAX_DFH_IDX</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">dfh_values</span><span class="p">;</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">FME_DFH_IDX</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h4000</span><span class="n">_0000_1000_0000</span><span class="p">;</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">THERM_MNGM_DFH_IDX</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_002000_0001</span><span class="p">;</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">GLBL_PERF_DFH_IDX</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_001000_0007</span><span class="p">;</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">GLBL_ERROR_DFH_IDX</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_00e000_1004</span><span class="p">;</span>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">QSFP0_DFH_IDX</span><span class="p">]</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_001000_0013</span><span class="p">;</span>
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">QSFP1_DFH_IDX</span><span class="p">]</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_001000_0013</span><span class="p">;</span>
<a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">HSSI_DFH_IDX</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_001000_100f</span><span class="p">;</span>
<a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">EMIF_DFH_IDX</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_001000_1009</span><span class="p">;</span>
<a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">HELLO_FIM_DFH_IDX</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_06A000_0100</span><span class="p">;</span>
<a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">PMCI_DFH_IDX</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_080000_1012</span><span class="p">;</span>
<a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">ST2MM_DFH_IDX</span><span class="p">]</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_030000_0014</span><span class="p">;</span>
<a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">PG_PR_DFH_IDX</span><span class="p">]</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_001000_1005</span><span class="p">;</span>
<a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">PG_PORT_DFH_IDX</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h4</span><span class="n">_00000_001000_1001</span><span class="p">;</span>
<a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">PG_USER_CLK_DFH_IDX</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_001000_1014</span><span class="p">;</span>
<a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">PG_REMOTE_STP_DFH_IDX</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_00d000_2013</span><span class="p">;</span>
<a id="__codelineno-61-19" name="__codelineno-61-19" href="#__codelineno-61-19"></a><span class="w">   </span><span class="n">dfh_values</span><span class="p">[</span><span class="n">AFU_ERR_DFH_IDX</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00001_000000_2010</span><span class="p">;</span>
<a id="__codelineno-61-20" name="__codelineno-61-20" href="#__codelineno-61-20"></a>
<a id="__codelineno-61-21" name="__codelineno-61-21" href="#__codelineno-61-21"></a><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">dfh_values</span><span class="p">;</span>
<a id="__codelineno-61-22" name="__codelineno-61-22" href="#__codelineno-61-22"></a><span class="k">endfunction</span>
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Regenerate the simulation files</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/ofs-common/scripts/common/sim
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>sh<span class="w"> </span>gen_sim_files.sh<span class="w"> </span>f2000x<span class="w"> </span>
</code></pre></div>
</li>
</ol>
<h5 id="5172-run-dfh-walker-simulation"><strong>5.1.7.2 Run DFH Walker Simulation</strong><a class="headerlink" href="#5172-run-dfh-walker-simulation" title="Permanent link">&para;</a></h5>
<p>After the simulation files have been re-generated, run the DFH Walker test to ensure the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module can be accessed by the SoC through the BPF.</p>
<ol>
<li>
<p>Run the DFH Walker test</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/sim/unit_test/soc_tests/dfh_walker
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>sh<span class="w"> </span>run_sim.sh
</code></pre></div>
</li>
<li>
<p>Check the output for the presence of the <code>HELLO_FiM</code> module at address <code>0x16000</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>********************************************
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>Running<span class="w"> </span>TEST<span class="o">(</span><span class="m">0</span><span class="o">)</span><span class="w"> </span>:<span class="w"> </span>test_dfh_walking
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>********************************************
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>...
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>READ64:<span class="w"> </span><span class="nv">address</span><span class="o">=</span>0x00015000<span class="w"> </span><span class="nv">bar</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">vf_active</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">pfn</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">vfn</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="w">   </span>**<span class="w"> </span>Sending<span class="w"> </span>TLP<span class="w"> </span>packets<span class="w"> </span>**
<a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="w">   </span>**<span class="w"> </span>Waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>ack<span class="w"> </span>**
<a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a><span class="w">   </span>READDATA:<span class="w"> </span>0x3000000010001009
<a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>
<a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a>EMIF_DFH
<a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a><span class="w">   </span>Address<span class="w">   </span><span class="o">(</span>0x15000<span class="o">)</span>
<a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a><span class="w">   </span>DFH<span class="w"> </span>value<span class="w"> </span><span class="o">(</span>0x3000000010001009<span class="o">)</span>
<a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a>
<a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a>READ64:<span class="w"> </span><span class="nv">address</span><span class="o">=</span>0x00016000<span class="w"> </span><span class="nv">bar</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">vf_active</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">pfn</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">vfn</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a>
<a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a><span class="w">   </span>**<span class="w"> </span>Sending<span class="w"> </span>TLP<span class="w"> </span>packets<span class="w"> </span>**
<a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a><span class="w">   </span>**<span class="w"> </span>Waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>ack<span class="w"> </span>**
<a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a><span class="w">   </span>READDATA:<span class="w"> </span>0x30000006a0000100
<a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a>
<a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a>HELLO_FIM_DFH
<a id="__codelineno-64-24" name="__codelineno-64-24" href="#__codelineno-64-24"></a><span class="w">   </span>Address<span class="w">   </span><span class="o">(</span>0x16000<span class="o">)</span>
<a id="__codelineno-64-25" name="__codelineno-64-25" href="#__codelineno-64-25"></a><span class="w">   </span>DFH<span class="w"> </span>value<span class="w"> </span><span class="o">(</span>0x30000006a0000100<span class="o">)</span>
<a id="__codelineno-64-26" name="__codelineno-64-26" href="#__codelineno-64-26"></a>
<a id="__codelineno-64-27" name="__codelineno-64-27" href="#__codelineno-64-27"></a>READ64:<span class="w"> </span><span class="nv">address</span><span class="o">=</span>0x00080000<span class="w"> </span><span class="nv">bar</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">vf_active</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">pfn</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">vfn</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-64-28" name="__codelineno-64-28" href="#__codelineno-64-28"></a>
<a id="__codelineno-64-29" name="__codelineno-64-29" href="#__codelineno-64-29"></a><span class="w">   </span>**<span class="w"> </span>Sending<span class="w"> </span>TLP<span class="w"> </span>packets<span class="w"> </span>**
<a id="__codelineno-64-30" name="__codelineno-64-30" href="#__codelineno-64-30"></a><span class="w">   </span>**<span class="w"> </span>Waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>ack<span class="w"> </span>**
<a id="__codelineno-64-31" name="__codelineno-64-31" href="#__codelineno-64-31"></a><span class="w">   </span>READDATA:<span class="w"> </span>0x3000000800001012
<a id="__codelineno-64-32" name="__codelineno-64-32" href="#__codelineno-64-32"></a>
<a id="__codelineno-64-33" name="__codelineno-64-33" href="#__codelineno-64-33"></a>PMCI_DFH
<a id="__codelineno-64-34" name="__codelineno-64-34" href="#__codelineno-64-34"></a><span class="w">   </span>Address<span class="w">   </span><span class="o">(</span>0x80000<span class="o">)</span>
<a id="__codelineno-64-35" name="__codelineno-64-35" href="#__codelineno-64-35"></a><span class="w">   </span>DFH<span class="w"> </span>value<span class="w"> </span><span class="o">(</span>0x3000000800001012<span class="o">)</span>
<a id="__codelineno-64-36" name="__codelineno-64-36" href="#__codelineno-64-36"></a>
<a id="__codelineno-64-37" name="__codelineno-64-37" href="#__codelineno-64-37"></a>...
<a id="__codelineno-64-38" name="__codelineno-64-38" href="#__codelineno-64-38"></a>
<a id="__codelineno-64-39" name="__codelineno-64-39" href="#__codelineno-64-39"></a>Test<span class="w"> </span>status:<span class="w"> </span>OK
<a id="__codelineno-64-40" name="__codelineno-64-40" href="#__codelineno-64-40"></a>
<a id="__codelineno-64-41" name="__codelineno-64-41" href="#__codelineno-64-41"></a>********************
<a id="__codelineno-64-42" name="__codelineno-64-42" href="#__codelineno-64-42"></a>Test<span class="w"> </span>summary
<a id="__codelineno-64-43" name="__codelineno-64-43" href="#__codelineno-64-43"></a>********************
<a id="__codelineno-64-44" name="__codelineno-64-44" href="#__codelineno-64-44"></a><span class="w">   </span>test_dfh_walking<span class="w"> </span><span class="o">(</span><span class="nv">id</span><span class="o">=</span><span class="m">0</span><span class="o">)</span><span class="w"> </span>-<span class="w"> </span>pass
<a id="__codelineno-64-45" name="__codelineno-64-45" href="#__codelineno-64-45"></a>Test<span class="w"> </span>passed!
<a id="__codelineno-64-46" name="__codelineno-64-46" href="#__codelineno-64-46"></a>Assertion<span class="w"> </span>count:<span class="w"> </span><span class="m">0</span>
</code></pre></div>
</li>
</ol>
<h4 id="518-uvm-verfication-of-the-hellofim"><strong>5.1.8 <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> Verfication of the HelloFIM</strong><a class="headerlink" href="#518-uvm-verfication-of-the-hellofim" title="Permanent link">&para;</a></h4>
<p>The following section describes the file modifications that need to be made to perform <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> verifaction of the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design, followed by instructions for running the <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> simulations.</p>
<h5 id="5181-uvm-simulation-file-modification"><strong>5.1.8.1 <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> Simulation File Modification</strong><a class="headerlink" href="#5181-uvm-simulation-file-modification" title="Permanent link">&para;</a></h5>
<p>Perform the following steps to modify the <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> simulation files to support the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design.</p>
<ol>
<li>
<p>Modify <code>$OFS_ROOTDIR/verification/tests/sequences/dfh_walking_seq.svh</code></p>
<ol>
<li>
<p>Modify the <code>dfh_offset_array</code> to insert the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="n">dfh_offset_array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="p">[</span><span class="mh">16</span><span class="p">];</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb_cfg0</span><span class="p">.</span><span class="n">PF0_BAR0</span><span class="p">;</span><span class="w">                    </span><span class="c1">// FME_DFH                0x8000_0000</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="n">_1000</span><span class="p">;</span><span class="w">   </span><span class="c1">// THERM_MNGM_DFH         0x8000_1000</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="n">_2000</span><span class="p">;</span><span class="w">   </span><span class="c1">// GLBL_PERF_DFH          0x8000_3000</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="n">_1000</span><span class="p">;</span><span class="w">   </span><span class="c1">// GLBL_ERROR_DFH         0x8000_4000</span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="n">_E000</span><span class="p">;</span><span class="w">   </span><span class="c1">// QSFP0_DFH              0x8001_2000</span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">4</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="n">_1000</span><span class="p">;</span><span class="w">   </span><span class="c1">// QSFP1_DFH              0x8001_3000</span>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">6</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">5</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="n">_1000</span><span class="p">;</span><span class="w">   </span><span class="c1">// HSSI_DFH               0x8001_4000</span>
<a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">7</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">6</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="n">_1000</span><span class="p">;</span><span class="w">   </span><span class="c1">// EMIF_DFH               0x8001_5000</span>
<a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">7</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="n">_1000</span><span class="p">;</span><span class="w">   </span><span class="c1">// HELLO_FIM_DFH          0x8001_6000</span>
<a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">9</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">8</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h6</span><span class="n">_a000</span><span class="p">;</span><span class="w">   </span><span class="c1">// PMCI_DFH               0x8008_0000</span>
<a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">10</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">9</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h8</span><span class="n">_0000</span><span class="p">;</span><span class="w">  </span><span class="c1">// ST2MM_DFH              0x8010_0000</span>
<a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">11</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="mh">10</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_0000</span><span class="p">;</span><span class="w">  </span><span class="c1">// PG_PR_DFH_IDX          0x8013_0000</span>
<a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">12</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="mh">11</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="n">_1000</span><span class="p">;</span><span class="w">  </span><span class="c1">// PG_PORT_DFH_IDX        0x8013_1000</span>
<a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">13</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="mh">12</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="n">_1000</span><span class="p">;</span><span class="w">  </span><span class="c1">// PG_USER_CLK_DFH_IDX    0x8013_2000</span>
<a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">14</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="mh">13</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="n">_1000</span><span class="p">;</span><span class="w">  </span><span class="c1">// PG_REMOTE_STP_DFH_IDX  0x8013_3000</span>
<a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a><span class="n">dfh_offset_array</span><span class="p">[</span><span class="w"> </span><span class="mh">15</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfh_offset_array</span><span class="p">[</span><span class="mh">14</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="n">_D000</span><span class="p">;</span><span class="w">  </span><span class="c1">// PG_AFU_ERR_DFH_IDX     0x8014_0000</span>
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Modify <code>$OFS_ROOTDIR/verification/tests/sequences/mmio_seq.svh</code></p>
<ol>
<li>
<p>Add test code related to the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. This code will verify the scratchpad register at 0x16030 and read only the register at 0x16038.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c1">// HELLO_FIM_Scratchpad 64 bit access</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="no">`uvm_info</span><span class="p">(</span><span class="n">get_name</span><span class="p">(),</span><span class="w"> </span><span class="n">$psprintf</span><span class="p">(</span><span class="s">&quot;////Accessing PF0 HELLO_FIM_Scratchpad Register %0h+&#39;h16030////&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">tb_cfg0</span><span class="p">.</span><span class="n">PF0_BAR0</span><span class="p">),</span><span class="w"> </span><span class="n">UVM_LOW</span><span class="p">)</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="n">assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">randomize</span><span class="p">(</span><span class="n">wdata</span><span class="p">));</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb_cfg0</span><span class="p">.</span><span class="n">PF0_BAR0</span><span class="o">+</span><span class="mh">&#39;h1</span><span class="n">_6000</span><span class="o">+</span><span class="mh">&#39;h30</span><span class="p">;</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="n">mmio_write64</span><span class="p">(.</span><span class="n">addr_</span><span class="p">(</span><span class="n">addr</span><span class="p">),</span><span class="w"> </span><span class="p">.</span><span class="n">data_</span><span class="p">(</span><span class="n">wdata</span><span class="p">));</span>
<a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="n">mmio_read64</span><span class="w"> </span><span class="p">(.</span><span class="n">addr_</span><span class="p">(</span><span class="n">addr</span><span class="p">),</span><span class="w"> </span><span class="p">.</span><span class="n">data_</span><span class="p">(</span><span class="n">rdata</span><span class="p">));</span>
<a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a>
<a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="k">if</span><span class="p">(</span><span class="n">wdata</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="n">rdata</span><span class="p">)</span>
<a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="w">    </span><span class="no">`uvm_error</span><span class="p">(</span><span class="n">get_name</span><span class="p">(),</span><span class="w"> </span><span class="n">$psprintf</span><span class="p">(</span><span class="s">&quot;Data mismatch 64! Addr = %0h, Exp = %0h, Act = %0h&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">wdata</span><span class="p">,</span><span class="w"> </span><span class="n">rdata</span><span class="p">))</span>
<a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="k">else</span>
<a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="w">    </span><span class="no">`uvm_info</span><span class="p">(</span><span class="n">get_name</span><span class="p">(),</span><span class="w"> </span><span class="n">$psprintf</span><span class="p">(</span><span class="s">&quot;Data match 64! addr = %0h, data = %0h&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">rdata</span><span class="p">),</span><span class="w"> </span><span class="n">UVM_LOW</span><span class="p">)</span>
<a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a>
<a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tb_cfg0</span><span class="p">.</span><span class="n">PF0_BAR0</span><span class="o">+</span><span class="mh">&#39;h1</span><span class="n">_6000</span><span class="o">+</span><span class="mh">&#39;h38</span><span class="p">;</span>
<a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a><span class="n">wdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h6626</span><span class="n">_0701_5000_0034</span><span class="p">;</span>
<a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a><span class="n">mmio_read64</span><span class="w"> </span><span class="p">(.</span><span class="n">addr_</span><span class="p">(</span><span class="n">addr</span><span class="p">),</span><span class="w"> </span><span class="p">.</span><span class="n">data_</span><span class="p">(</span><span class="n">rdata</span><span class="p">));</span>
<a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a><span class="k">if</span><span class="p">(</span><span class="n">wdata</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="n">rdata</span><span class="p">)</span>
<a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a><span class="w">    </span><span class="no">`uvm_error</span><span class="p">(</span><span class="n">get_name</span><span class="p">(),</span><span class="w"> </span><span class="n">$psprintf</span><span class="p">(</span><span class="s">&quot;Data mismatch 64! Addr = %0h, Exp = %0h, Act = %0h&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">wdata</span><span class="p">,</span><span class="w"> </span><span class="n">rdata</span><span class="p">))</span>
<a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a><span class="k">else</span>
<a id="__codelineno-66-21" name="__codelineno-66-21" href="#__codelineno-66-21"></a><span class="w">    </span><span class="no">`uvm_info</span><span class="p">(</span><span class="n">get_name</span><span class="p">(),</span><span class="w"> </span><span class="n">$psprintf</span><span class="p">(</span><span class="s">&quot;Data match 64! addr = %0h, data = %0h&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">,</span><span class="w"> </span><span class="n">rdata</span><span class="p">),</span><span class="w"> </span><span class="n">UVM_LOW</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p><strong>Note:</strong> uvm_info and uvm_error statements will put a message into log file.</p>
</blockquote>
</li>
</ol>
</li>
<li>
<p>Modify <code>$OFS_ROOTDIR/verification/scripts/Makefile_VCS.mk</code></p>
<ol>
<li>
<p>Add <code>INCLUDE_HELLO_FIM</code> define option to enable Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> on <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="nv">VLOG_OPT</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>+define+INCLUDE_HELLO_FIM
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Re-generate the <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> files</p>
<ol>
<li>
<p>Navigate to the verification scripts directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$VERDIR</span>/scripts
</code></pre></div>
</li>
<li>
<p>Clean the output of previous builds</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>gmake<span class="w"> </span>-f<span class="w"> </span>Makefile_VCS.mk<span class="w"> </span>clean
</code></pre></div>
</li>
<li>
<p>Compile the IP files</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>gmake<span class="w"> </span>-f<span class="w"> </span>Makefile_VCS.mk<span class="w"> </span>cmplib_adp
</code></pre></div>
</li>
<li>
<p>Build the RTL and Test Benches</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>gmake<span class="w"> </span>-f<span class="w"> </span>Makefile_VCS.mk<span class="w"> </span>build_adp<span class="w"> </span><span class="nv">DUMP</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">DEBUG</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>
</code></pre></div>
<blockquote>
<p><strong>Note:</strong> Using the <code>DEBUG</code> option will provide more detail in the log file for the simulation.</p>
</blockquote>
</li>
</ol>
</li>
</ol>
<h5 id="5182-run-uvm-dfh-walker-simulation"><strong>5.1.8.2 Run <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> DFH Walker Simulation</strong><a class="headerlink" href="#5182-run-uvm-dfh-walker-simulation" title="Permanent link">&para;</a></h5>
<p>Perform the following steps to run the <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> DFH Walker Simulation.</p>
<ol>
<li>
<p>Run the DFH Walker simulation</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$VERDIR</span>/scripts
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>gmake<span class="w"> </span>-f<span class="w"> </span>Makefile_VCS.mk<span class="w"> </span>run<span class="w"> </span><span class="nv">TESTNAME</span><span class="o">=</span>dfh_walking_test<span class="w"> </span><span class="nv">DUMP</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">DEBUG</span><span class="o">=</span><span class="m">1</span>
</code></pre></div>
<blockquote>
<p><strong>Note:</strong> Using the <code>DEBUG</code> option will provide more detail in the log file for the simulation.</p>
</blockquote>
</li>
<li>
<p>The output logs are stored in the $VERDIR/sim/dfh_walking_test directory. The main files to note are described in the table below:</p>
<table>
<thead>
<tr>
<th align="left">File Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">runsim.log</td>
<td align="left">A log file of <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr></td>
</tr>
<tr>
<td align="left">trans.log</td>
<td align="left">A log file of transactions on PCIe bus</td>
</tr>
<tr>
<td align="left">inter.vpd</td>
<td align="left">A waveform for VCS</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Run the following command to quickly verify- that the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module was successfully accessed. In the example below, the message <code>DFH offset Match! Exp = 80016000 Act = 80016000</code> shows that the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module was successfully accessed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$VERDIR</span>/sim/dfh_walking_test
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>cat<span class="w"> </span>runsim.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;DFH offset&quot;</span>
</code></pre></div>
<p>Expected output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">111950000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80000000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80000000</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">112586000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80001000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80001000</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">113222000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80003000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80003000</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">113858000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80004000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80004000</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">114494000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80012000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80012000</span>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">115147000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80013000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80013000</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">115801000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80014000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80014000</span>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">116628000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80015000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80015000</span>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">117283000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80016000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80016000</span>
<a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">117928000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80080000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80080000</span>
<a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">118594000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80100000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80100000</span>
<a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">119248000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80130000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80130000</span>
<a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">119854000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80131000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80131000</span>
<a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">120460000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80132000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80132000</span>
<a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">121065000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80133000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80133000</span>
<a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/dfh_walking_seq.svh<span class="o">(</span><span class="m">73</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">121672000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>DFH<span class="w"> </span>offset<span class="w"> </span>Match!<span class="w"> </span><span class="nv">Exp</span><span class="o">=</span><span class="w"> </span><span class="m">80140000</span><span class="w"> </span><span class="nv">Act</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80140000</span>
</code></pre></div>
</li>
</ol>
<h5 id="5183-run-uvm-mmio-simulation"><strong>5.1.8.3 Run <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Simulation</strong><a class="headerlink" href="#5183-run-uvm-mmio-simulation" title="Permanent link">&para;</a></h5>
<p>Perform the following steps to run the <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Simulation.</p>
<ol>
<li>
<p>Run the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> test</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$VERDIR</span>/scripts
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>gmake<span class="w"> </span>-f<span class="w"> </span>Makefile_VCS.mk<span class="w"> </span>run<span class="w"> </span><span class="nv">TESTNAME</span><span class="o">=</span>mmio_test<span class="w"> </span><span class="nv">DUMP</span><span class="o">=</span><span class="m">1</span>
</code></pre></div>
</li>
<li>
<p>Run the following commands to show the result of the scratchpad register and Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> ID register. You can see the "Data match" message indicating that the registers are successfuly verified.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$VERDIR</span>/sim/mmio_test
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>cat<span class="w"> </span>runsim.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Data&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">1603</span>
</code></pre></div>
<p>Expected output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/mmio_seq.svh<span class="o">(</span><span class="m">68</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">115466000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>Data<span class="w"> </span>match<span class="w"> </span><span class="m">64</span>!<span class="w"> </span><span class="nv">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80016030</span>,<span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>880312f9558c00e1
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>UVM_INFO<span class="w"> </span>/home/applications.fpga.ofs.fim-f2000x-pl/verification/tests/sequences/mmio_seq.svh<span class="o">(</span><span class="m">76</span><span class="o">)</span><span class="w"> </span>@<span class="w"> </span><span class="m">116112000000</span>:<span class="w"> </span>uvm_test_top.tb_env0.v_sequencer@@m_seq<span class="w"> </span><span class="o">[</span>m_seq<span class="o">]</span><span class="w"> </span>Data<span class="w"> </span>match<span class="w"> </span><span class="m">64</span>!<span class="w"> </span><span class="nv">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80016038</span>,<span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6626070150000034</span>
</code></pre></div>
</li>
</ol>
<h4 id="519-compile-the-f2000x-design-with-hello-fim"><strong>5.1.9 Compile the f2000x Design with Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></strong><a class="headerlink" href="#519-compile-the-f2000x-design-with-hello-fim" title="Permanent link">&para;</a></h4>
<p>Perform the following to compile the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design.</p>
<ol>
<li>Ensure the pre-requesites described in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#515-pre-requisites-for-adding-hello-fim">Pre-Requisites for Adding Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></a> section are satisfied.</li>
<li>Ensure that Intel Quartus Prime Pro is in your $PATH</li>
<li>
<p>Compile the design</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="nv">$OFS_ROOTDIR</span>/ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>-p<span class="w"> </span>f2000x<span class="w"> </span>work_hello_fim
</code></pre></div>
</li>
<li>
<p>Once compilation is complete, the output files can be found in the <code>$OFS_ROOTDIR/work_hello_fim/syn/syn_top/output_files</code> directory.</p>
</li>
</ol>
<h4 id="5110-program-the-f2000x-with-the-hellofim-design"><strong>5.1.10 Program the f2000x with the HelloFIM Design</strong><a class="headerlink" href="#5110-program-the-f2000x-with-the-hellofim-design" title="Permanent link">&para;</a></h4>
<p>Perform the following steps to program the f2000x with the HelloFIM design generated in the previous section. This flow uses the <abbr title="Remote System Update, A Remote System Update operation sends an instruction to the Intel FPGA PAC D5005 device that triggers a power cycle of the card only, forcing reconfiguration.">RSU</abbr> feature, which requires that an OPAE enabled design is already loaded on the FPGA. All OPAE commands are run from the SoC, and the new image will be updated from the SoC.</p>
<ol>
<li>
<p>Use the <code>fpgainfo fme</code> command to obtain the PCIe <code>s:b:d.f</code> associated with your board. In this example, the PCIe <code>s:b:d.f</code> is <code>0000:15:00.0</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>fpgainfo<span class="w"> </span>fme
</code></pre></div>
<p>Example output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>Intel<span class="w"> </span>IPU<span class="w"> </span>Platform<span class="w"> </span>f2000x
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>Board<span class="w"> </span>Management<span class="w"> </span>Controller<span class="w"> </span>NIOS<span class="w"> </span>FW<span class="w"> </span>version:<span class="w"> </span><span class="m">1</span>.1.9<span class="w"> </span>
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>Board<span class="w"> </span>Management<span class="w"> </span>Controller<span class="w"> </span>Build<span class="w"> </span>version:<span class="w"> </span><span class="m">1</span>.1.9<span class="w"> </span>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>//******<span class="w"> </span>FME<span class="w"> </span>******//
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xF000000
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:15:00.0
<a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x17D4
<a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a>Ports<span class="w"> </span>Num<span class="w">                        </span>:<span class="w"> </span><span class="m">01</span>
<a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a>Bitstream<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x5010302A97C08A3
<a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a>Bitstream<span class="w"> </span>Version<span class="w">                </span>:<span class="w"> </span><span class="m">5</span>.0.1
<a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a>Pr<span class="w"> </span>Interface<span class="w"> </span>Id<span class="w">                  </span>:<span class="w"> </span>fb25ff1d-c31a-55d8-81d8-cbcedcfcea17
<a id="__codelineno-80-16" name="__codelineno-80-16" href="#__codelineno-80-16"></a>Boot<span class="w"> </span>Page<span class="w">                        </span>:<span class="w"> </span>user1
<a id="__codelineno-80-17" name="__codelineno-80-17" href="#__codelineno-80-17"></a>User1<span class="w"> </span>Image<span class="w"> </span>Info<span class="w">                 </span>:<span class="w"> </span>a566ceacaed810d43c60b0b8a7145591
<a id="__codelineno-80-18" name="__codelineno-80-18" href="#__codelineno-80-18"></a>User2<span class="w"> </span>Image<span class="w"> </span>Info<span class="w">                 </span>:<span class="w"> </span>a566ceacaed810d43c60b0b8a7145591
<a id="__codelineno-80-19" name="__codelineno-80-19" href="#__codelineno-80-19"></a>Factory<span class="w"> </span>Image<span class="w"> </span>Info<span class="w">               </span>:<span class="w"> </span>None
</code></pre></div>
</li>
<li>
<p>Navigate to the output directory in the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> work directory that contains the output files from compilation. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_hello_fim/syn/syn_top/output_files
</code></pre></div>
</li>
<li>
<p>Initiate the User Image 1 update by running <code>fpgasupdate</code> from a shell in the SoC. This will update User Image 1 stored in FPGA Flash. Remember to use the PCIe BDF associated with your board.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>sudo<span class="w"> </span>fpgasupdate<span class="w"> </span>ofs_top_page1_unsigned_user1.bin<span class="w"> </span><span class="m">0000</span>:15:00.0
</code></pre></div>
</li>
<li>
<p>Run the <code>rsu</code> command to re-configure the FPGA with User Image 1 from FPGA Flash.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>sudo<span class="w"> </span>rsu<span class="w"> </span>fpga<span class="w"> </span>--page<span class="o">=</span>user1<span class="w"> </span><span class="m">0000</span>:15:00.0
</code></pre></div>
</li>
<li>
<p>Run the <code>fpgainfo fme</code> command again to verify the User1 Image Info has been updated.</p>
<p>Example Output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>Intel<span class="w"> </span>IPU<span class="w"> </span>Platform<span class="w"> </span>f2000x
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>Board<span class="w"> </span>Management<span class="w"> </span>Controller<span class="w"> </span>NIOS<span class="w"> </span>FW<span class="w"> </span>version:<span class="w"> </span><span class="m">1</span>.1.9<span class="w"> </span>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>Board<span class="w"> </span>Management<span class="w"> </span>Controller<span class="w"> </span>Build<span class="w"> </span>version:<span class="w"> </span><span class="m">1</span>.1.9<span class="w"> </span>
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a>//******<span class="w"> </span>FME<span class="w"> </span>******//
<a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xF000000
<a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:15:00.0
<a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x17D4
<a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a>Ports<span class="w"> </span>Num<span class="w">                        </span>:<span class="w"> </span><span class="m">01</span>
<a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a>Bitstream<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x5010302A97C08A3
<a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a>Bitstream<span class="w"> </span>Version<span class="w">                </span>:<span class="w"> </span><span class="m">5</span>.0.1
<a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a>Pr<span class="w"> </span>Interface<span class="w"> </span>Id<span class="w">                  </span>:<span class="w"> </span>fb25ff1d-c31a-55d8-81d8-cbcedcfcea17
<a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a>Boot<span class="w"> </span>Page<span class="w">                        </span>:<span class="w"> </span>user1
<a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a>User1<span class="w"> </span>Image<span class="w"> </span>Info<span class="w">                 </span>:<span class="w"> </span>81d8cbcedcfcea17fb25ff1dc31a55d8
<a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a>User2<span class="w"> </span>Image<span class="w"> </span>Info<span class="w">                 </span>:<span class="w"> </span>a566ceacaed810d43c60b0b8a7145591
<a id="__codelineno-84-19" name="__codelineno-84-19" href="#__codelineno-84-19"></a>Factory<span class="w"> </span>Image<span class="w"> </span>Info<span class="w">               </span>:<span class="w"> </span>None
</code></pre></div>
</li>
</ol>
<h4 id="5111-verify-the-hello-fim-design-on-the-f2000x-using-opae"><strong>5.1.11 Verify the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Design on the f2000x Using OPAE</strong><a class="headerlink" href="#5111-verify-the-hello-fim-design-on-the-f2000x-using-opae" title="Permanent link">&para;</a></h4>
<p>This section will describe how to access the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> registers using the opae.io tool.</p>
<ol>
<li>
<p>Confirm the driver software on 0000:15:00.0</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>opae.io<span class="w"> </span>ls
</code></pre></div>
<p>Example output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="o">[</span><span class="m">0000</span>:15:00.0<span class="o">]</span><span class="w"> </span><span class="o">(</span>0x8086:0xbcce<span class="w"> </span>0x8086:0x17d4<span class="o">)</span><span class="w"> </span>Intel<span class="w"> </span>IPU<span class="w"> </span>Platform<span class="w"> </span>f2000x<span class="w"> </span><span class="o">(</span>Driver:<span class="w"> </span>dfl-pci<span class="o">)</span>
</code></pre></div>
</li>
<li>
<p>Initialize the opae.io tool</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0
</code></pre></div>
</li>
<li>
<p>Confirm the driver software on 0000:15:00.0 has been updated</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>opae.io<span class="w"> </span>ls
</code></pre></div>
<p>Example Output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="o">[</span><span class="m">0000</span>:15:00.0<span class="o">]</span><span class="w"> </span><span class="o">(</span>0x8086:0xbcce<span class="w"> </span>0x8086:0x17d4<span class="o">)</span><span class="w"> </span>Intel<span class="w"> </span>IPU<span class="w"> </span>Platform<span class="w"> </span>f2000x<span class="w"> </span><span class="o">(</span>Driver:<span class="w"> </span>vfio-pci<span class="o">)</span>
</code></pre></div>
</li>
<li>
<p>Run the DFH Walker test to verify there is a module at offset <code>0x16000</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>opae.io<span class="w"> </span>walk<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0
</code></pre></div>
<p>Example output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>offset:<span class="w"> </span>0x0000,<span class="w"> </span>value:<span class="w"> </span>0x4000000010000000
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">   </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x4
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a>offset:<span class="w"> </span>0x1000,<span class="w"> </span>value:<span class="w"> </span>0x3000000020000001
<a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x2000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a>offset:<span class="w"> </span>0x3000,<span class="w"> </span>value:<span class="w"> </span>0x3000000010000007
<a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x7,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a>offset:<span class="w"> </span>0x4000,<span class="w"> </span>value:<span class="w"> </span>0x30000000e0001004
<a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x4,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0xe000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a>offset:<span class="w"> </span>0x12000,<span class="w"> </span>value:<span class="w"> </span>0x3000000010000013
<a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x13,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a>offset:<span class="w"> </span>0x13000,<span class="w"> </span>value:<span class="w"> </span>0x3000000010000013
<a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x13,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-13" name="__codelineno-91-13" href="#__codelineno-91-13"></a>offset:<span class="w"> </span>0x14000,<span class="w"> </span>value:<span class="w"> </span>0x3000000010002015
<a id="__codelineno-91-14" name="__codelineno-91-14" href="#__codelineno-91-14"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x15,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x2,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-15" name="__codelineno-91-15" href="#__codelineno-91-15"></a>offset:<span class="w"> </span>0x15000,<span class="w"> </span>value:<span class="w"> </span>0x3000000010001009
<a id="__codelineno-91-16" name="__codelineno-91-16" href="#__codelineno-91-16"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x9,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-17" name="__codelineno-91-17" href="#__codelineno-91-17"></a>offset:<span class="w"> </span>0x16000,<span class="w"> </span>value:<span class="w"> </span>0x30000006a0000100
<a id="__codelineno-91-18" name="__codelineno-91-18" href="#__codelineno-91-18"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x100,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x6a000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-19" name="__codelineno-91-19" href="#__codelineno-91-19"></a>offset:<span class="w"> </span>0x80000,<span class="w"> </span>value:<span class="w"> </span>0x3000000800002012
<a id="__codelineno-91-20" name="__codelineno-91-20" href="#__codelineno-91-20"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x12,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x2,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x80000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-21" name="__codelineno-91-21" href="#__codelineno-91-21"></a>offset:<span class="w"> </span>0x100000,<span class="w"> </span>value:<span class="w"> </span>0x3000000300000014
<a id="__codelineno-91-22" name="__codelineno-91-22" href="#__codelineno-91-22"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x14,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x30000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-23" name="__codelineno-91-23" href="#__codelineno-91-23"></a>offset:<span class="w"> </span>0x130000,<span class="w"> </span>value:<span class="w"> </span>0x3000000010001005
<a id="__codelineno-91-24" name="__codelineno-91-24" href="#__codelineno-91-24"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x5,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-25" name="__codelineno-91-25" href="#__codelineno-91-25"></a>offset:<span class="w"> </span>0x131000,<span class="w"> </span>value:<span class="w"> </span>0x4000000010001001
<a id="__codelineno-91-26" name="__codelineno-91-26" href="#__codelineno-91-26"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x4
<a id="__codelineno-91-27" name="__codelineno-91-27" href="#__codelineno-91-27"></a>offset:<span class="w"> </span>0x132000,<span class="w"> </span>value:<span class="w"> </span>0x3000000010001014
<a id="__codelineno-91-28" name="__codelineno-91-28" href="#__codelineno-91-28"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x14,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-29" name="__codelineno-91-29" href="#__codelineno-91-29"></a>offset:<span class="w"> </span>0x133000,<span class="w"> </span>value:<span class="w"> </span>0x30000000d0002013
<a id="__codelineno-91-30" name="__codelineno-91-30" href="#__codelineno-91-30"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x13,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x2,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0xd000,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
<a id="__codelineno-91-31" name="__codelineno-91-31" href="#__codelineno-91-31"></a>offset:<span class="w"> </span>0x140000,<span class="w"> </span>value:<span class="w"> </span>0x3000010000002010
<a id="__codelineno-91-32" name="__codelineno-91-32" href="#__codelineno-91-32"></a><span class="w">    </span>dfh:<span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x10,<span class="w"> </span><span class="nv">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x2,<span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">eol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x1,<span class="w"> </span><span class="nv">reserved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x0,<span class="w"> </span><span class="nv">feature_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x3
</code></pre></div>
</li>
<li>
<p>Read all of the registers in the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module</p>
<ol>
<li>
<p>Read the DFH Register</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>opae.io<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0<span class="w"> </span>-r<span class="w"> </span><span class="m">0</span><span class="w"> </span>peek<span class="w"> </span>0x16000
</code></pre></div>
<p>Example Output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>0x30000006a0000100
</code></pre></div>
</li>
<li>
<p>Read the Scratchpad Register</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>opae.io<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0<span class="w"> </span>-r<span class="w"> </span><span class="m">0</span><span class="w"> </span>peek<span class="w"> </span>0x16030
</code></pre></div>
<p>Example Output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>0x0
</code></pre></div>
</li>
<li>
<p>Read the ID Register</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>opae.io<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0<span class="w"> </span>-r<span class="w"> </span><span class="m">0</span><span class="w"> </span>peek<span class="w"> </span>0x16038
</code></pre></div>
<p>Example Output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>0x6626070150000034
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Verify the scratchpad register at 0x16030 by writing and reading back from it.</p>
<ol>
<li>
<p>Write to Scratchpad register</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>opae.io<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:15:00.0<span class="w"> </span>-r<span class="w"> </span><span class="m">0</span><span class="w"> </span>poke<span class="w"> </span>0x16030<span class="w"> </span>0x123456789abcdef
</code></pre></div>
</li>
<li>
<p>Read from Scratchpad register</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>opae.io<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0<span class="w"> </span>-r<span class="w"> </span><span class="m">0</span><span class="w"> </span>peek<span class="w"> </span>0x16030
</code></pre></div>
<p>Expected output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>0x123456789abcdef
</code></pre></div>
</li>
<li>
<p>Write to Scratchpad register</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>opae.io<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0<span class="w"> </span>-r<span class="w"> </span><span class="m">0</span><span class="w"> </span>poke<span class="w"> </span>0x16030<span class="w"> </span>0xfedcba9876543210
</code></pre></div>
</li>
<li>
<p>Read from Scratchpad register</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>opae.io<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0<span class="w"> </span>-r<span class="w"> </span><span class="m">0</span><span class="w"> </span>peek<span class="w"> </span>0x16030
</code></pre></div>
<p>Expected output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>0xfedcba9876543210
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Release the opae.io tool</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>opae.io<span class="w"> </span>release<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0
</code></pre></div>
</li>
<li>
<p>Confirm the driver has been set back to <code>dfl-pci</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>opae.io<span class="w"> </span>ls
</code></pre></div>
<p>Example output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="o">[</span><span class="m">0000</span>:15:00.0<span class="o">]</span><span class="w"> </span><span class="o">(</span>0x8086:0xbcce<span class="w"> </span>0x8086:0x17d4<span class="o">)</span><span class="w"> </span>Intel<span class="w"> </span>IPU<span class="w"> </span>Platform<span class="w"> </span>f2000x<span class="w"> </span><span class="o">(</span>Driver:<span class="w"> </span>dfl-pci<span class="o">)</span>
</code></pre></div>
</li>
</ol>
<h3 id="52-how-to-debug-the-fim-with-signal-tap"><strong>5.2 How to Debug the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> with Signal Tap</strong><a class="headerlink" href="#52-how-to-debug-the-fim-with-signal-tap" title="Permanent link">&para;</a></h3>
<p>For debugging issues within the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, Signal Tap can be used to gain internal visibility into your design. This section describes the process of adding a Signal Tap instance to the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design example described in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#51-how-to-add-a-new-module-to-the-fim">How to add a new module to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></a> section, however the process can be used for any design.</p>
<p>For more detailed information on Signal Tap please see refer to <a href="https://www.intel.com/content/www/us/en/docs/programmable/683819/22-4/faq.html">Quartus Prime Pro Edition User Guide: Debug Tools</a> (RDC Document ID 683819).</p>
<p>Signal Tap uses the Intel FPGA Download Cable II USB device to provide access.  Please see <a href="https://www.intel.com/content/www/us/en/products/sku/215664/intel-fpga-download-cable-ii/specifications.html">Intel FPGA Download Cable II</a> for more information. This device is widely available via distributors for purchase.</p>
<h4 id="521-adding-signal-tap-to-the-hello-fim-example"><strong>5.2.1 Adding Signal Tap to the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> example</strong><a class="headerlink" href="#521-adding-signal-tap-to-the-hello-fim-example" title="Permanent link">&para;</a></h4>
<p>The following steps guide you through the process of adding a Signal Tap instance to your design. The added Signal Tap instance provides hardware to capture the desired internal signals and connect the stored trace information via <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr>. Please be aware that the added Signal Tap hardware will consume FPGA resources and may require additional floorplanning steps to accommodate these resources. Some areas of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> use logic lock regions and these regions may need to be re-sized. These steps assume the use of the  Intel IPU Platform F2000X-PL.  </p>
<p>The steps below use the hello_fim example to add Signal Tap, however the general process can be used for any design.</p>
<ol>
<li>
<p>The design must be synthesized before adding Signal Tap.</p>
<ul>
<li>
<p>If you are using the previously built Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design, copy the work directory and rename it so that we have a work directory dedicated to the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Signal Tap design.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a>cp<span class="w"> </span>-r<span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_hello_fim<span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_hello_fim_with_stp
</code></pre></div>
</li>
</ul>
<ul>
<li>
<p>If you are adding signal tap to a new design that has not yet been synthesized, perform the following steps to synthesize the design.</p>
<ol>
<li>Set the environment variables as described in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#441-setting-up-required-environment-variables">Setting Up Required Environment Variables</a> section.</li>
<li>
<p>Run the setup portion of the build script to create a working directory based on the original source files.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>./ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>--stage<span class="w"> </span>setup<span class="w"> </span>f2000x<span class="w"> </span>&lt;YOUR_STP_WORK_DIR&gt;
</code></pre></div>
</li>
<li>
<p>Open the project in the Intel Quartus Prime Pro GUI. The Intel Quartus Prime Pro project is named ofs_top.qpf and is located in the work directory <code>$OFS_ROOTDIR/&lt;YOUR_STP_WORK_DIR&gt;/syn/syn_top/ofs_top.qpf</code>.</p>
</li>
<li>In the <strong>Compilation Flow</strong> window, run <strong>Analysis &amp; Synthesis</strong>.</li>
<li>Once Synthesis has completed, you may skip to Step 3.</li>
</ol>
</li>
</ul>
</li>
<li>
<p>Open the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Signal Tap project in the Intel Quartus Prime Pro GUI. The Intel Quartus Prime Pro project is named ofs_top.qpf and is located in the work directory <code>$OFS_ROOTDIR/work_hello_fim_with_stp/syn/syn_top/ofs_top.qpf</code>.</p>
</li>
<li>
<p>Select <strong>Tools</strong> &gt; <strong>Signal Tap Logic Analyzer</strong> to open the Signal Tap GUI.</p>
<p><a class="glightbox" href="../images/signal_tap_log_analyizer_menu.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/signal_tap_log_analyizer_menu.png" /></a></p>
</li>
<li>
<p>Accept the "Default" selection and click "Create".</p>
<p><a class="glightbox" href="../images/new_stp_file_from_template.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/new_stp_file_from_template.png" /></a></p>
</li>
<li>
<p>This opens the Signal Tap Logic Analyzer window.</p>
<p><a class="glightbox" href="../images/signal_tap_log_analyizer_dialog.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/signal_tap_log_analyizer_dialog.png" /></a></p>
</li>
<li>
<p>Set up the clock for the STP instance. This example instruments the <strong>hello_fim_top</strong> module previously intetegrated into the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. If unfamiliar with code, it is helpful to use the Intel Quartus Prime Pro Project Navigator to find the block of interest and open the design instance for review. For example, see the image below using Project Navigator to open the <strong>top</strong> module where <strong>hello_fim_top_inst</strong> is instantiated.</p>
<p><a class="glightbox" href="../images/hello_fim_top.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/hello_fim_top.png" /></a></p>
</li>
<li>
<p>Assign the clock for sampling the Signal Tap instrumented signals of interest. Note, that the clock selected should be associated with the signals you want to view for best trace fidelity. Different clocks can be used, however, there maybe issues with trace inaccuracy due to sampling time differences. Ensure that all signals that are to be sampled are on the same clock domain as the clock you select here. In the middle right of the Signal Tap window, under <strong>Signal Configuration, Clock:</strong>, select <strong>"…"</strong> as shown below:</p>
<p><a class="glightbox" href="../images/stp_hello_fim_clk_search.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_hello_fim_clk_search.png" /></a></p>
</li>
<li>
<p>In the Node Finder tool that popped up, input <strong>"hello_fim_top_inst|clk"</strong> into the "Named:" textbox and click "Search". Select "clk" in the Matching Nodes list and click the "&gt;" button to select this clock as shown below. Click "OK" to close the Node Finder dialog.</p>
<p><a class="glightbox" href="../images/stp_node_finder_hello_fim.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_node_finder_hello_fim.png" /></a></p>
</li>
<li>
<p>Update the sample depth and other Signal Tap settings as needed for your debugging criteria.</p>
<p><a class="glightbox" href="../images/STP_Configs_hello_fim.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/STP_Configs_hello_fim.png" /></a></p>
</li>
<li>
<p>In the Signal Tap GUI add the nodes to be instrumented by double-clicking on the "Double-click to add nodes" legend.</p>
<p><a class="glightbox" href="../images/STP_Add_Nodes_hello_fim.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/STP_Add_Nodes_hello_fim.png" /></a></p>
</li>
<li>
<p>This brings up the Node Finder to add the signals to be traced. In this example we will monitor the memory mapped interface to the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. Select the signals that appear from the  search patterns <strong>hello_fim_top_inst|reset</strong> and <strong>hello_fim_top_inst|csr_lite_if*</strong>. Click Insert and close the Node Finder dialog.</p>
<p><a class="glightbox" href="../images/stp_traced_signals_hello_fim.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_traced_signals_hello_fim.png" /></a></p>
</li>
<li>
<p>To provide a unique name for your Signal Tap instance, select "auto signaltap_0", right-click, and select <strong>Rename Instance (F2)</strong>. Provide a descriptive name for your instance, for example, "STP_For_Hello_FIM".</p>
<p><a class="glightbox" href="../images/stp_rename_instance_hello_fim.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_rename_instance_hello_fim.png" /></a></p>
</li>
<li>
<p>Save the newly created Signal Tap file, and give it the same name as the instance. Ensure that the <strong>Add file to current project</strong> checkbox is ticked.</p>
<p><a class="glightbox" href="../images/save_STP_hello_fim.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/save_STP_hello_fim.png" /></a></p>
</li>
<li>
<p>In the dialog that pops up, click "Yes" to add the newly created Signal Tap file to the project settings files.</p>
<p><a class="glightbox" href="../images/add_STP_Project_hello_fim.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/add_STP_Project_hello_fim.png" /></a></p>
<p>This will aurtomatically add the following lines to <code>$OFS_ROOTDIR/work_hello_fim_with_stp/syn/syn_top/ofs_top.qsf</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>ENABLE_SIGNALTAP<span class="w"> </span>ON
<a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>USE_SIGNALTAP_FILE<span class="w"> </span>STP_For_Hello_FIM.stp
<a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>SIGNALTAP_FILE<span class="w"> </span>STP_For_Hello_FIM.stp
</code></pre></div>
</li>
<li>
<p>Close all Quartus GUIs.</p>
</li>
<li>
<p>Compile the project with the Signal Tap file added to the project. Use the <strong>-k</strong> switch to perform the compilation using the files in a specified working directory and not the original ones from the cloned repository. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>-p<span class="w"> </span>-k<span class="w"> </span>f2000x<span class="w"> </span>work_hello_fim_with_stp
</code></pre></div>
<p>Alternatively, you can copy the <strong>ofs_top.qsf</strong> and <strong>STP_For_Hello_FIM.stp</strong> files from the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> with STP work directory to replace the original files in the cloned <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repository. In this scenario, all further <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> compilation projects will include the Signal Tap instance integrated into the design. Execute the following commands for this alternative flow:</p>
<p>Copy the modified file "work_hello_fim_with_stp/syn/syn_top/ofs_top.qsf" over to the source <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repository, into "syn/syn_top/".</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_hello_fim_with_stp/syn/syn_top
<a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a>cp<span class="w"> </span>ofs_top.qsf<span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/syn/syn_top
<a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a>cp<span class="w"> </span>STP_For_Hello_FIM.stp<span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/syn/syn_top
</code></pre></div>
<p>Compile the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> using the files from the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repository to create a new work directory.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a>ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>-p<span class="w"> </span>f2000x<span class="w"> </span>work_hello_fim_with_stp_from_src_repo
</code></pre></div>
</li>
<li>
<p>Ensure that the compile completes successfully and meets timing:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a>***********************************
<a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a>***
<a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a>***<span class="w">        </span>OFS_PROJECT:<span class="w"> </span>f2000x
<a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a>***<span class="w">        </span>OFS_FIM:<span class="w"> </span>base
<a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a>***<span class="w">        </span>OFS_BOARD:<span class="w"> </span>adp
<a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a>***<span class="w">        </span>Q_PROJECT:<span class="w">  </span>ofs_top
<a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a>***<span class="w">        </span>Q_REVISION:<span class="w"> </span>ofs_top
<a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a>***<span class="w">        </span>SEED:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a>***<span class="w">        </span>Build<span class="w"> </span>Complete
<a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a>***<span class="w">        </span>Timing<span class="w"> </span>Passed!
<a id="__codelineno-113-11" name="__codelineno-113-11" href="#__codelineno-113-11"></a>***
<a id="__codelineno-113-12" name="__codelineno-113-12" href="#__codelineno-113-12"></a>***********************************
</code></pre></div>
</li>
</ol>
<h4 id="522-configuring-the-fpga-with-a-sof-image-via-jtag"><strong>5.2.2 Configuring the FPGA with a SOF Image via <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr></strong><a class="headerlink" href="#522-configuring-the-fpga-with-a-sof-image-via-jtag" title="Permanent link">&para;</a></h4>
<p>Every successful run of <code>build_top.sh</code> script creates the file <code>$OFS_ROOTDIR/&lt;WORK_DIRECTORY&gt;/syn/syn_top/output_files/ofs_top_hps.sof</code> which can be used with the Intel FPGA Download Cable II to load the image into the FPGA using the f2000x  <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> access connector. </p>
<p>Perform the steps described in the following sections to load the <code>ofs_fim.sof</code> image created in the previous section into the Agilex FPGA using the Intel FPGA Download Cable II. You will also use the Intel FPGA Download Cable II to access the Signal Tap instance via <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr>.</p>
<h5 id="5221-connecting-to-intel-fpga-download-cable"><strong>5.2.2.1 Connecting to Intel FPGA Download Cable</strong><a class="headerlink" href="#5221-connecting-to-intel-fpga-download-cable" title="Permanent link">&para;</a></h5>
<p>The f2000x  has a 10 pin <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> header on the top side of the board.  This <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> header provides access to either the Agilex FPGA or Cyclone<sup>&reg;</sup> 10 <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> device.  Perform the followign steps to connect the Itel FPGA Download Cable II and target the Agilex device:</p>
<ol>
<li>
<p>Locate SW2 and SW3 on the f2000x board as shown in the following figure.</p>
<p><a class="glightbox" href="../images/f2000x_switch_locations.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="f2000x_switch_locations" src="../images/f2000x_switch_locations.png" /></a></p>
</li>
<li>
<p>Set the switches described in the following table:</p>
<table>
<thead>
<tr>
<th>Switch</th>
<th>Position</th>
</tr>
</thead>
<tbody>
<tr>
<td>SW2</td>
<td>ON</td>
</tr>
<tr>
<td>SW3.3</td>
<td>ON</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Connect the Intel FPGA Download Cable to the <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> header of the f2000x as shown in the figure below.</p>
<p><a class="glightbox" href="../images/f2000x_jtag_connection.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="f2000x_jtag_connection" src="../images/f2000x_jtag_connection.png" /></a></p>
</li>
<li>
<p>Depending on your server, install the card in a slot that allows room for the <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> cable. The figure below shows the f2000x installed in a Supermicro server slot.</p>
<p><a class="glightbox" href="../images/f2000x_jtag_sm_server.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="f2000x_jtag_sm_server" src="../images/f2000x_jtag_sm_server.png" /></a></p>
</li>
<li>
<p>There are two <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> modes that exist. Short-chain mode is when only the Cyclone 10 device is on the <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> chain. Long-chain mode is when both the Cyclone 10 and the Agilex FPGA are on the <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> chain. Check which <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> mode the f2000x board is in by running the following command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="nv">$QUARTUS_ROOTDIR</span>/bin/jtagconfig
</code></pre></div>
<ul>
<li>
<p>Example output when in short-chain mode (only Cyclone 10 detected):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span>USB-BlasterII<span class="w"> </span><span class="o">[</span><span class="m">3</span>-4<span class="o">]</span>
<a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a>020F60DD<span class="w">    </span>10CL080<span class="o">(</span>Y<span class="p">|</span>Z<span class="o">)</span>/EP3C80/EP4CE75
</code></pre></div>
</li>
</ul>
<ul>
<li>
<p>Example output when in long-chain mode (both Cyclone 10 and Agilex detected):</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span>USB-BlasterII<span class="w"> </span><span class="o">[</span><span class="m">3</span>-4<span class="o">]</span>
<a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a>020F60DD<span class="w">   </span>10CL080<span class="o">(</span>Y<span class="p">|</span>Z<span class="o">)</span>/EP3C80/EP4CE75
<a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a>234150DD<span class="w">   </span>AGFC023R25A<span class="o">(</span>.<span class="p">|</span>AE<span class="p">|</span>R0<span class="o">)</span>
</code></pre></div>
  If the Agilex device does not appear on the chain, ensure that the switches described in Step 1 have been set correctly and power cycle the board.</p>
</li>
</ul>
</li>
</ol>
<h5 id="5222-programming-the-agilex-fpga-via-jtag"><strong>5.2.2.2 Programming the Agilex FPGA via <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr></strong><a class="headerlink" href="#5222-programming-the-agilex-fpga-via-jtag" title="Permanent link">&para;</a></h5>
<p>Perform the following steps to program the Agilex FPGA via <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr>.</p>
<ol>
<li>
<p>Set the <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> Enable bit in <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> register 0x378. The <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> registers are accessed through SPI control registers at addresses 0x8040C and 0x80400. in the PMCI.</p>
<blockquote>
<p><strong>Note</strong>: These commands must be executed as root user from the SoC.</p>
<p><strong>Note</strong>: You may find the PCIe BDF of your card by running <code>fpgainfo fme</code>.</p>
</blockquote>
<p>These commands must be executed every time a new FPGA SOF image is to be loaded prior to running the Intel Quartus Prime Pro programmer.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span>&lt;BDF&gt;
<a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a>opae.io<span class="w"> </span>-d<span class="w"> </span>&lt;BDF&gt;<span class="w"> </span>-r<span class="w"> </span><span class="m">0</span><span class="w"> </span>poke<span class="w"> </span>0x8040c<span class="w"> </span>0x100000000
<a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a>opae.io<span class="w"> </span>-d<span class="w"> </span>&lt;BDF&gt;<span class="w"> </span>-r<span class="w"> </span><span class="m">0</span><span class="w"> </span>poke<span class="w"> </span>0x80400<span class="w"> </span>0x37800000002
<a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a>opae.io<span class="w"> </span>release<span class="w"> </span>-d<span class="w"> </span>&lt;BDF&gt;
</code></pre></div>
For example, for a board with PCIe BDF <code>15:00.0</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0
<a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a>opae.io<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0<span class="w"> </span>-r<span class="w"> </span><span class="m">0</span><span class="w"> </span>poke<span class="w"> </span>0x8040c<span class="w"> </span>0x100000000
<a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a>opae.io<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0<span class="w"> </span>-r<span class="w"> </span><span class="m">0</span><span class="w"> </span>poke<span class="w"> </span>0x80400<span class="w"> </span>0x37800000002
<a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a>opae.io<span class="w"> </span>release<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0
</code></pre></div></p>
</li>
<li>
<p>The SOF file is located in the work directory <strong>$OFS_ROOTDIR/work_hello_fim_with_stp/syn/syn_top/output_files/ofs_top_hps.sof</strong>. If the target FPGA is on a different server, then transfer <strong>ofs_top_hps.sof</strong> and <strong>STP_For_Hello_FIM.stp</strong> files to the server with the target FPGA.</p>
</li>
<li>
<p>You can use a Full Intel Quartus Prime Pro Installation or Standalone Quartus Prime Programmer &amp; Tools running on the machine where the f2000x  is installed or on a separte machine such as a laptop.</p>
<blockquote>
<p><strong>Note</strong>: You can download the Quartus Prime Programmer and Tools by clicking on the "Additional Software" tab on the FPGA download page. The Quartus Prime Programmer and Tools come with Quartus programmer as well as System Console which are needed to program the flash devices.</p>
<p><strong>Note</strong>: If using the Intel FGPA download Cable on Linux, add the udev rule as described in <a href="(https://www.intel.com/content/www/us/en/support/programmable/support-resources/download/dri-usb-b-lnx.html)">Intel FPGA Download Cable (formerly USB-Blaster) Driver for Linux</a>.</p>
</blockquote>
</li>
<li>
<p>Temporarily disable the PCIe <abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr> feature. This is required because when you program the FPGA using <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr>, the f2000x PCIe link goes down for a moment causing a server surprise link down event. To prevent this server event, temporarily disable PCIe <abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr> and remove the root port connected to the f2000x  PCIe slot using the following steps:</p>
<ol>
<li>
<p>Find the root port connected to the f2000x .  In this example, the f2000x  is assigned PCIe BDF 15:00, so you will use Linux lspci tree command to determine the root port.  </p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a>lspci<span class="w"> </span>-t
</code></pre></div>
Sample Output;
<div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a>...
<a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a>    +-[0000:14]-+-00.0
<a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a>   |           +-00.1
<a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a>   |           +-00.2
<a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a>   |           +-00.3
<a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a>   |           +-00.4
<a id="__codelineno-120-7" name="__codelineno-120-7" href="#__codelineno-120-7"></a>   |           \-02.0-[15]----00.0   # The root port for 15:00.0 is 14:02.0
<a id="__codelineno-120-8" name="__codelineno-120-8" href="#__codelineno-120-8"></a>...
</code></pre></div>
In this example, we see that the root port PCIe BDF of 15:00.0 is 14:02.0.</p>
</li>
<li>
<p>Disable <abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr> on the f2000x  PCIe root port and remove the root port using the commands entered as root.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a>sudo<span class="w"> </span>su<span class="w">   </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a>setpci<span class="w"> </span>-s<span class="w"> </span><span class="m">0000</span>:14:02.0<span class="w"> </span>ECAP_AER+0x08.L<span class="o">=</span>0xFFFFFFFF
<a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a>setpci<span class="w"> </span>-s<span class="w"> </span><span class="m">0000</span>:14:02.0<span class="w"> </span>ECAP_AER+0x14.L<span class="o">=</span>0xFFFFFFFF
</code></pre></div></p>
</li>
</ol>
</li>
<li>
<p>Launch "Quartus Prime Programmer" software from the device which the Intel FPGA Programmer is connected.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="nv">$QUARTUS_ROOTDIR</span>/bin/quartus_pgmw
</code></pre></div>
<p>Click on <strong>Hardware Setup</strong>, select <strong>USB-BlasterII</strong> in the <strong>Current Selected Hardware</strong> list, and ensure the <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> <strong>Hardware Frequency</strong> is set to 16Mhz (The default is 24MHz).</p>
<p><a class="glightbox" href="../images/stp_hardware_setup.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_hardware_setup.png" /></a></p>
<p>Alternatively, use the following command from the command line to change the clock frequency:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a>jtagconfig<span class="w"> </span>–setparam<span class="w"> </span>“USB-BlasterII”<span class="w"> </span>JtagClock<span class="w"> </span>16M
</code></pre></div>
</li>
<li>
<p>Click <strong>Auto Detect</strong> and make sure the Agilex Device is shown in the <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> chain. Select the Cyclone 10 and Agilex devices if prompted.</p>
<p><a class="glightbox" href="../images/stp_autodetect_agilex.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_autodetect_agilex.png" /></a></p>
</li>
<li>
<p>Right-click on the cell in the <strong>File</strong> column for the Agilex device and click on <strong>Change file</strong></p>
<p><a class="glightbox" href="../images/stp_change_file_hello_fim.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_change_file_hello_fim.png" /></a></p>
</li>
<li>
<p>Select the generated <strong>ofs_top.sof</strong> file for the Agilex FPGA with the Signal Tap instrumented Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> example. Remember that the output files are located under <strong>work_hello_fim_with_stp/syn/syn_top/output_files/</strong>.</p>
</li>
<li>
<p>Tick the checkbox below "Program/Configure" column and click on <strong>Start</strong> to program this .sof file.</p>
<p><a class="glightbox" href="../images/stp_program_hello_fim.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_program_hello_fim.png" /></a></p>
</li>
<li>
<p>After successful programming, you can close the "Quartus Prime Programmer" software. You can answer 'No' if a dialog pops up asking to save the <strong>'Chain.cdf'</strong> file. This completes the Agilex .sof programming.</p>
</li>
<li>
<p>Remove the PCIe root port found earlier and re-scan the PCIe Bus.</p>
<blockquote>
<p><strong>Note:</strong> enter the command as root.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a>sudo<span class="w"> </span>su
<a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000<span class="se">\:</span><span class="m">14</span><span class="se">\:</span><span class="m">02</span>.0/remove
<a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/rescan
<a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="nb">exit</span>
</code></pre></div>
</li>
<li>
<p>Verify the f2000x is present by checking expected bitstream ID using <code>fpaginfo fme</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a>fpgainfo<span class="w"> </span>fme
</code></pre></div>
<p>Example output:
<div class="highlight"><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a>Intel<span class="w"> </span>IPU<span class="w"> </span>Platform<span class="w"> </span>f2000x-PL
<a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a>Board<span class="w"> </span>Management<span class="w"> </span>Controller<span class="w"> </span>NIOS<span class="w"> </span>FW<span class="w"> </span>version:<span class="w"> </span><span class="m">1</span>.1.9
<a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a>Board<span class="w"> </span>Management<span class="w"> </span>Controller<span class="w"> </span>Build<span class="w"> </span>version:<span class="w"> </span><span class="m">1</span>.1.9
<a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a>//******<span class="w"> </span>FME<span class="w"> </span>******//
<a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xF000000
<a id="__codelineno-127-6" name="__codelineno-127-6" href="#__codelineno-127-6"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:15:00.0
<a id="__codelineno-127-7" name="__codelineno-127-7" href="#__codelineno-127-7"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-127-8" name="__codelineno-127-8" href="#__codelineno-127-8"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-127-9" name="__codelineno-127-9" href="#__codelineno-127-9"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-127-10" name="__codelineno-127-10" href="#__codelineno-127-10"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x17D4
<a id="__codelineno-127-11" name="__codelineno-127-11" href="#__codelineno-127-11"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-127-12" name="__codelineno-127-12" href="#__codelineno-127-12"></a>Ports<span class="w"> </span>Num<span class="w">                        </span>:<span class="w"> </span><span class="m">01</span>
<a id="__codelineno-127-13" name="__codelineno-127-13" href="#__codelineno-127-13"></a>Bitstream<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x5010302A97C08A3
<a id="__codelineno-127-14" name="__codelineno-127-14" href="#__codelineno-127-14"></a>Bitstream<span class="w"> </span>Version<span class="w">                </span>:<span class="w"> </span><span class="m">5</span>.0.1
<a id="__codelineno-127-15" name="__codelineno-127-15" href="#__codelineno-127-15"></a>Pr<span class="w"> </span>Interface<span class="w"> </span>Id<span class="w">                  </span>:<span class="w"> </span>cf00eed4-a82b-5f07-be25-0528baec3711
<a id="__codelineno-127-16" name="__codelineno-127-16" href="#__codelineno-127-16"></a>Boot<span class="w"> </span>Page<span class="w">                        </span>:<span class="w"> </span>user1
<a id="__codelineno-127-17" name="__codelineno-127-17" href="#__codelineno-127-17"></a>User1<span class="w"> </span>Image<span class="w"> </span>Info<span class="w">                 </span>:<span class="w"> </span>9e3db8b6a4d25a4e3e46f2088b495899
<a id="__codelineno-127-18" name="__codelineno-127-18" href="#__codelineno-127-18"></a>User2<span class="w"> </span>Image<span class="w"> </span>Info<span class="w">                 </span>:<span class="w"> </span>9e3db8b6a4d25a4e3e46f2088b495899
<a id="__codelineno-127-19" name="__codelineno-127-19" href="#__codelineno-127-19"></a>Factory<span class="w"> </span>Image<span class="w"> </span>Info<span class="w">               </span>:<span class="w"> </span>None
</code></pre></div></p>
<blockquote>
<p><strong>Note:</strong> The <strong>Image Info</strong> fields will not change, because these represent the images stored in flash. In this example, we are programming the Agilex FPGA directly, thus only the Bitstream ID should change.</p>
</blockquote>
</li>
</ol>
<h4 id="523-signal-tap-trace-acquisition-of-hello-fim-signals"><strong>5.2.3 Signal Tap trace acquisition of Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> signals</strong><a class="headerlink" href="#523-signal-tap-trace-acquisition-of-hello-fim-signals" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>Once the instrumented HelloFIM SOF file is downloaded into the Agilex FPGA, start the Quartus Signal Tap GUI.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="nv">$QUARTUS_ROOTDIR</span>/bin/quartus_stpw
</code></pre></div>
</li>
<li>
<p>In the Signal Tap GUI, open your STP file. Your STP file settings will load. In this example we used <code>STP_For_Hello_FIM.stp</code>.</p>
<p><a class="glightbox" href="../images/stp_open_STP_For_Hello_FIM.stp.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_open_STP_For_Hello_FIM.stp.png" /></a></p>
</li>
<li>
<p>In the right pane of the Signal Tap GUI, in the <strong>Hardware:</strong> selection box select the cable <code>USB-BlasterII</code>. In the <strong>Device:</strong> selection box select the Agilex device.</p>
<p><a class="glightbox" href="../images/stp_select_usbBlasterII_hardware.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_select_usbBlasterII_hardware.png" /></a></p>
</li>
<li>
<p>If the Agilex Device is not displayed in the <strong>Device:</strong> list, click the <strong>'Scan Chain'</strong> button to re-scan the <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> device chain.</p>
</li>
<li>
<p>If not already set, you can create the trigger conditions. In this example, we will capture data on a rising edge of the Read Address Valid signal.</p>
<p><a class="glightbox" href="../images/stp_set_trigger_conditions.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_set_trigger_conditions.png" /></a></p>
</li>
<li>
<p>Start analysis by selecting the <strong>'STP_For_Hello_FIM'</strong> instance and pressing <strong>'F5'</strong> or clicking the <strong>Run Analysis</strong> icon in the toolbar. You should see a green message indicating the Acquisition is in progress. Then, move to the <strong>Data</strong> Tab to observe the signals captured.</p>
<p><a class="glightbox" href="../images/stp_start_signal_capture.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_start_signal_capture.png" /></a></p>
</li>
<li>
<p>To generate traffic in the <strong>csr_lite_if</strong> signals of the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> module, go back to the terminal and walk the DFH list or peek/poke the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> registers as was done during the creation of the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design example.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a>opae.io init -d 0000:15:00.0
<a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a>opae.io walk -d 0000:15:00.0
<a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a>opae.io release -d 0000:15:00.0
</code></pre></div>
<p>The signals should be captured on the rising edge of <code>arvalid</code> in this example. Zoom in to get a better view of the signals.</p>
<p><a class="glightbox" href="../images/stp_captured_csr_lite_if_traces.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_captured_csr_lite_if_traces.png" /></a></p>
</li>
<li>
<p>The PCIe <abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr> feature is automatically re-enabled by rebooting the server. </p>
</li>
</ol>
<p>This concludes the example on how to instrument an <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> with the Quartus Prime Signal Tap Logic Analyzer.</p>
<h3 id="53-how-to-compile-the-fim-in-preparation-for-designing-your-afu"><strong>5.3 How to compile the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> in preparation for designing your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#53-how-to-compile-the-fim-in-preparation-for-designing-your-afu" title="Permanent link">&para;</a></h3>
<p>To save area, the default Host Excercisers in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> can be replaced by a "he_null" block during compile-time. There are a few things to note:</p>
<ul>
<li>"he_null" is a minimal block with registers that responds to PCIe <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> request. <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> responses are required to keep PCIe alive (end points enabled in PCIe-SS needs service downstream requests).</li>
<li>If an exerciser with other I/O connections such as "he_mem" or "he_hssi" is replaced, then then those I/O ports are simply tied off.</li>
<li>The options supported are <code>null_he_lb</code>, <code>null_he_hssi</code>, <code>null_he_mem</code> and <code>null_he_mem_tg</code>. Any combination, order or all can be enabled at the same time. </li>
<li>Finer grain control is provided for you to, for example, turn off only the exercisers in the Static Region in order to save area.</li>
</ul>
<p>To compile a <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> for where the exercisers are removed and replaced with a he_null module and keeping the PF/VF multiplexor connections, execute the following command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a>ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>-p<span class="w"> </span>f2000x:null_he,null_he_hssi,null_he_mem,null_he_mem_tg<span class="w"> </span>work_null_he
</code></pre></div>
<h3 id="54-how-to-resize-the-partial-reconfiguration-region"><strong>5.4 How to Resize the Partial Reconfiguration Region</strong><a class="headerlink" href="#54-how-to-resize-the-partial-reconfiguration-region" title="Permanent link">&para;</a></h3>
<p>To take advantage of the available resources in the Agilex FPGA for an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> design, you can adjust the size of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> partition. An example reason for the changing the size of <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region is if you add more logic to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> region, then you may need to reduce the size of the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region to fit the additional logic into the static region.  Similiarly, if you reduce logic in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> region, then you can increase the size of the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region to provide more logic resources for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>After the compilation of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, the resources usage broken down by partitions is reported in the <code>Logic Lock Region Usage Summary</code> sections of following two files:</p>
<ul>
<li><code>$OFS_ROOTDIR/&lt;YOUR_WORK_DIRECTORY&gt;/syn/syn_top/output_files/ofs_top.fit.place.rpt</code></li>
<li>
<p><code>$OFS_ROOTDIR/&lt;YOUR_WORK_DIRECTORY&gt;/syn/syn_top/output_files/ofs_top.fit.rpt</code></p>
<p><a class="glightbox" href="../images/IOFS_FLOW_Logic_lock_region_usage_summary.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/IOFS_FLOW_Logic_lock_region_usage_summary.PNG" /></a></p>
</li>
</ul>
<p>In this case, the default size for the <code>afu_top|port_gasket|pr_slot|afu_main</code> <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> partition is large enough to comfortably hold the logic of the default <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, which is mainly occupied by the Host Exercisers. However, larger designs might require additional resources.</p>
<p>Perform the following steps to customize the resources allocated to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> regions:</p>
<ol>
<li>
<p>The <code>$OFS_ROOTDIR/syn/setup/pr_assignments.tcl</code> TCL file defines the Logic Lock Regions in the design, including the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> partition where the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is allocated.</p>
<p>The default design uses the the following Logic Lock Regions:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="k">set</span><span class="w"> </span>TOP_MEM_REGION<span class="w">    </span><span class="s2">&quot;X115 Y310 X219 Y344&quot;</span>
<a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a><span class="k">set</span><span class="w"> </span>BOTTOM_MEM_REGION<span class="w"> </span><span class="s2">&quot;X0 Y0 X294 Y20&quot;</span>
<a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a><span class="k">set</span><span class="w"> </span>SUBSYSTEM_REGION<span class="w">  </span><span class="s2">&quot;X0 Y0 X60 Y279; X0 Y0 X300 Y39; X261 Y0 X300 Y129;&quot;</span>
<a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a>
<a id="__codelineno-131-5" name="__codelineno-131-5" href="#__codelineno-131-5"></a><span class="k">set</span><span class="w"> </span>AFU_PLACE_REGION<span class="w">  </span><span class="s2">&quot;X61 Y40 X260 Y309; X220 Y130 X294 Y329; X12 Y280 X114 Y329;&quot;</span>
<a id="__codelineno-131-6" name="__codelineno-131-6" href="#__codelineno-131-6"></a><span class="k">set</span><span class="w"> </span>AFU_ROUTE_REGION<span class="w">  </span><span class="s2">&quot;X0 Y0 X294 Y329&quot;</span>
</code></pre></div>
<p>Each region is made up of rectangles defined by the origin (X0,Y0) and the top right corner (X1,Y1).</p>
</li>
<li>
<p>Use Quartus Chip Planner to identify the locations of the resources available within the Agilex device for placement and routing your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The image below shows the default floorplan for the f2000x Agilex device.</p>
<p><a class="glightbox" href="../images/chip_planner_coordinates.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/chip_planner_coordinates.png" /></a></p>
</li>
<li>
<p>Make changes to the <code>$OFS_ROOTDIR/syn/setup/pr_assignments.tcl</code> file based on your findings in Quartus Chip Planner. You can modify the size and location of existing Logic Lock Regions or add new ones and assign them to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> partition. You will need to modify the coordinates of other regions assigned to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> accordingly to prevent overlap.</p>
</li>
<li>
<p>Recompile your <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and create the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> relocatable build tree using the following commands:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span><span class="w">    </span>
<a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a>ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>-p<span class="w"> </span>f2000x<span class="w">  </span>&lt;YOUR_WORK_DIRECTORY&gt;
</code></pre></div>
</li>
<li>
<p>Analyze the resource utilization report per partition produced after recompiling the design.</p>
</li>
<li>
<p>Make further modifications to the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> regions until the results are satisfactory. Make sure timing constraints are met.</p>
</li>
</ol>
<p>Refer to the following documentation for more information on how to optimize the floor plan of your Partial Reconfiguration design:</p>
<ul>
<li><a href="https://www.intel.com/content/www/us/en/docs/programmable/683641/23-1/analyzing-and-optimizing-the-design-03170.html">Analyzing and Optimizing the Design Floorplan</a></li>
<li><a href="https://www.intel.com/content/www/us/en/docs/programmable/683834/23-1/step-3-floorplan-the-design.html">Partial Reconfiguration Design Flow - Step 3: Floorplan the Design</a></li>
</ul>
<h3 id="55-how-to-modify-the-memory-subsystem"><strong>5.5 How to modify the Memory Subsystem</strong><a class="headerlink" href="#55-how-to-modify-the-memory-subsystem" title="Permanent link">&para;</a></h3>
<p>In this example we will modify the Memory Subsystem to enable ECC on all of the existing memory interfaces. You may make different modifications to meet your own design requirements. Perform the following steps to make this change.</p>
<ol>
<li>
<p>Clone the design repositories or use an existing design. See the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#421-clone-the-ofs-git-repo">Clone the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Git Repo</a> section.</p>
</li>
<li>
<p>Set the environment variables as described in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#441-setting-up-required-environment-variables">Setting Up Required Environment Variables</a> section.</p>
</li>
<li>
<p>Navigate to the directory containing the Memory Subsystem IP file <code>mem_ss_fm.ip</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/ipss/mem/qip/mem_ss/<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Open the Memory Subsystem IP file in Platform Designer to perform the required edits. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a>qsys-edit<span class="w"> </span>mem_ss_fm.ip
</code></pre></div>
<p>The IP Parameter Editor GUI opens as shown below.</p>
<p><a class="glightbox" href="../images/mem_ss_init.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/mem_ss_init.PNG" /></a></p>
</li>
<li>
<p>Select the "Memory Interfaces" tab to view the current configuration of the Memory Interfaces. You may make edits to the configuration of any of the interfaces as needed. The figure below shows the default configuration of Interface 3.</p>
<p><a class="glightbox" href="../images/mem_ss_current_settings.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/mem_ss_current_settings.png" /></a></p>
</li>
<li>
<p>In this example we will enable ECC for all four interfaces. In Interface tabs 0 through 3, change the drop-down selection for <strong>Memory DQ width</strong> from <code>32 (no ECC)</code> to <code>40 (with ECC)</code>. The figure below shows this change for <strong>Interface 3</strong>.</p>
<p><a class="glightbox" href="../images/mem_ss_from_40b_ecc_to_32b_no_ecc.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/mem_ss_from_40b_ecc_to_32b_no_ecc.png" /></a></p>
</li>
<li>
<p>Generate the HDL code by clicking the <strong>Generate HDL...</strong> button at the bottom right corner of the Platform Designer window. In the dialog box that appears next, review the HDL generation options and click the <strong>Generate</strong> button at the bottom right corner of the dialog box. Save the system if prompted to do so. Once the generation process is finished, close the Platform designer windows. </p>
</li>
<li>
<p>Edit the <code>$OFS_ROOTDIR/ipss/mem/rtl/mem_ss_pkg.sv</code> file to change the <code>DDR4_DQ_WIDTH</code> from <code>32</code> to <code>40</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="c1">// DDR PARAMS</span>
<a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a><span class="p">...</span>
<a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a><span class="k">localparam</span><span class="w"> </span><span class="n">DDR4_DQ_WIDTH</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mh">40</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>Edit the <code>$OFS_ROOTDIR/syn/setup/emif_loc.tcl</code> file to assign the pins required for ECC enabled interfaces.</br></p>
<ol>
<li>
<p>Uncomment the <code>DQS4</code> pin assignments for all memory interfaces</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="c">#---------------------------------------------------------</span>
<a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a><span class="c"># EMIF CH0</span>
<a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a><span class="c">#---------------------------------------------------------</span>
<a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a><span class="nv">...</span>
<a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a><span class="c"># # CH0 DQS4 (ECC)</span>
<a id="__codelineno-136-6" name="__codelineno-136-6" href="#__codelineno-136-6"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_A39<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">0</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">32</span><span class="k">]</span>
<a id="__codelineno-136-7" name="__codelineno-136-7" href="#__codelineno-136-7"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_J35<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">0</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">33</span><span class="k">]</span>
<a id="__codelineno-136-8" name="__codelineno-136-8" href="#__codelineno-136-8"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_C38<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">0</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">34</span><span class="k">]</span>
<a id="__codelineno-136-9" name="__codelineno-136-9" href="#__codelineno-136-9"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_G34<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">0</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">35</span><span class="k">]</span>
<a id="__codelineno-136-10" name="__codelineno-136-10" href="#__codelineno-136-10"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_G38<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">0</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">36</span><span class="k">]</span>
<a id="__codelineno-136-11" name="__codelineno-136-11" href="#__codelineno-136-11"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_C34<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">0</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">37</span><span class="k">]</span>
<a id="__codelineno-136-12" name="__codelineno-136-12" href="#__codelineno-136-12"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_J39<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">0</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">38</span><span class="k">]</span>
<a id="__codelineno-136-13" name="__codelineno-136-13" href="#__codelineno-136-13"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_A35<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">0</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">39</span><span class="k">]</span>
<a id="__codelineno-136-14" name="__codelineno-136-14" href="#__codelineno-136-14"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_C36<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">0</span><span class="k">]</span>.dqs<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
<a id="__codelineno-136-15" name="__codelineno-136-15" href="#__codelineno-136-15"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_A37<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">0</span><span class="k">]</span>.dqs_n<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
<a id="__codelineno-136-16" name="__codelineno-136-16" href="#__codelineno-136-16"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_G36<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">0</span><span class="k">]</span>.dbi_n<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
<a id="__codelineno-136-17" name="__codelineno-136-17" href="#__codelineno-136-17"></a>
<a id="__codelineno-136-18" name="__codelineno-136-18" href="#__codelineno-136-18"></a><span class="c">#---------------------------------------------------------</span>
<a id="__codelineno-136-19" name="__codelineno-136-19" href="#__codelineno-136-19"></a><span class="c"># EMIF CH1</span>
<a id="__codelineno-136-20" name="__codelineno-136-20" href="#__codelineno-136-20"></a><span class="c">#---------------------------------------------------------</span>
<a id="__codelineno-136-21" name="__codelineno-136-21" href="#__codelineno-136-21"></a><span class="nv">...</span>
<a id="__codelineno-136-22" name="__codelineno-136-22" href="#__codelineno-136-22"></a><span class="c"># # CH1 DQS4 (ECC)</span>
<a id="__codelineno-136-23" name="__codelineno-136-23" href="#__codelineno-136-23"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_N7<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">1</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">32</span><span class="k">]</span>
<a id="__codelineno-136-24" name="__codelineno-136-24" href="#__codelineno-136-24"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_L12<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">1</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">33</span><span class="k">]</span>
<a id="__codelineno-136-25" name="__codelineno-136-25" href="#__codelineno-136-25"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_L6<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">1</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">34</span><span class="k">]</span>
<a id="__codelineno-136-26" name="__codelineno-136-26" href="#__codelineno-136-26"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_U14<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">1</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">35</span><span class="k">]</span>
<a id="__codelineno-136-27" name="__codelineno-136-27" href="#__codelineno-136-27"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_U7<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">1</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">36</span><span class="k">]</span>
<a id="__codelineno-136-28" name="__codelineno-136-28" href="#__codelineno-136-28"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_W12<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">1</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">37</span><span class="k">]</span>
<a id="__codelineno-136-29" name="__codelineno-136-29" href="#__codelineno-136-29"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_W6<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">1</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">38</span><span class="k">]</span>
<a id="__codelineno-136-30" name="__codelineno-136-30" href="#__codelineno-136-30"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_N14<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">1</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">39</span><span class="k">]</span>
<a id="__codelineno-136-31" name="__codelineno-136-31" href="#__codelineno-136-31"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_L9<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">1</span><span class="k">]</span>.dqs<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
<a id="__codelineno-136-32" name="__codelineno-136-32" href="#__codelineno-136-32"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_N10<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">1</span><span class="k">]</span>.dqs_n<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
<a id="__codelineno-136-33" name="__codelineno-136-33" href="#__codelineno-136-33"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_W9<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">1</span><span class="k">]</span>.dbi_n<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
<a id="__codelineno-136-34" name="__codelineno-136-34" href="#__codelineno-136-34"></a>
<a id="__codelineno-136-35" name="__codelineno-136-35" href="#__codelineno-136-35"></a><span class="c">#---------------------------------------------------------</span>
<a id="__codelineno-136-36" name="__codelineno-136-36" href="#__codelineno-136-36"></a><span class="c"># EMIF CH2</span>
<a id="__codelineno-136-37" name="__codelineno-136-37" href="#__codelineno-136-37"></a><span class="c">#---------------------------------------------------------</span>
<a id="__codelineno-136-38" name="__codelineno-136-38" href="#__codelineno-136-38"></a><span class="nv">...</span>
<a id="__codelineno-136-39" name="__codelineno-136-39" href="#__codelineno-136-39"></a><span class="c"># CH2 DQS4 (ECC)</span>
<a id="__codelineno-136-40" name="__codelineno-136-40" href="#__codelineno-136-40"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_GC37<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">32</span><span class="k">]</span>
<a id="__codelineno-136-41" name="__codelineno-136-41" href="#__codelineno-136-41"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_GC41<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">33</span><span class="k">]</span>
<a id="__codelineno-136-42" name="__codelineno-136-42" href="#__codelineno-136-42"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FY37<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">34</span><span class="k">]</span>
<a id="__codelineno-136-43" name="__codelineno-136-43" href="#__codelineno-136-43"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_GE40<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">35</span><span class="k">]</span>
<a id="__codelineno-136-44" name="__codelineno-136-44" href="#__codelineno-136-44"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FV36<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">36</span><span class="k">]</span>
<a id="__codelineno-136-45" name="__codelineno-136-45" href="#__codelineno-136-45"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FY41<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">37</span><span class="k">]</span>
<a id="__codelineno-136-46" name="__codelineno-136-46" href="#__codelineno-136-46"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_GE36<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">38</span><span class="k">]</span>
<a id="__codelineno-136-47" name="__codelineno-136-47" href="#__codelineno-136-47"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FV40<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">39</span><span class="k">]</span>
<a id="__codelineno-136-48" name="__codelineno-136-48" href="#__codelineno-136-48"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_GE38<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.dqs<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
<a id="__codelineno-136-49" name="__codelineno-136-49" href="#__codelineno-136-49"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_GC39<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.dqs_n<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
<a id="__codelineno-136-50" name="__codelineno-136-50" href="#__codelineno-136-50"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FV38<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.dbi_n<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
<a id="__codelineno-136-51" name="__codelineno-136-51" href="#__codelineno-136-51"></a>
<a id="__codelineno-136-52" name="__codelineno-136-52" href="#__codelineno-136-52"></a><span class="c">#---------------------------------------------------------</span>
<a id="__codelineno-136-53" name="__codelineno-136-53" href="#__codelineno-136-53"></a><span class="c"># EMIF CH3</span>
<a id="__codelineno-136-54" name="__codelineno-136-54" href="#__codelineno-136-54"></a><span class="c">#---------------------------------------------------------</span>
<a id="__codelineno-136-55" name="__codelineno-136-55" href="#__codelineno-136-55"></a><span class="nv">...</span>
<a id="__codelineno-136-56" name="__codelineno-136-56" href="#__codelineno-136-56"></a><span class="c"># # CH3 DQS4 (ECC)</span>
<a id="__codelineno-136-57" name="__codelineno-136-57" href="#__codelineno-136-57"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FP46<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">3</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">32</span><span class="k">]</span>
<a id="__codelineno-136-58" name="__codelineno-136-58" href="#__codelineno-136-58"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FT43<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">3</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">33</span><span class="k">]</span>
<a id="__codelineno-136-59" name="__codelineno-136-59" href="#__codelineno-136-59"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FH47<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">3</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">34</span><span class="k">]</span>
<a id="__codelineno-136-60" name="__codelineno-136-60" href="#__codelineno-136-60"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FP42<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">3</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">35</span><span class="k">]</span>
<a id="__codelineno-136-61" name="__codelineno-136-61" href="#__codelineno-136-61"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FT47<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">3</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">36</span><span class="k">]</span>
<a id="__codelineno-136-62" name="__codelineno-136-62" href="#__codelineno-136-62"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FH43<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">3</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">37</span><span class="k">]</span>
<a id="__codelineno-136-63" name="__codelineno-136-63" href="#__codelineno-136-63"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FK46<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">3</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">38</span><span class="k">]</span>
<a id="__codelineno-136-64" name="__codelineno-136-64" href="#__codelineno-136-64"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FK42<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">3</span><span class="k">]</span>.dq<span class="k">[</span><span class="nv">39</span><span class="k">]</span>
<a id="__codelineno-136-65" name="__codelineno-136-65" href="#__codelineno-136-65"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FP44<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">3</span><span class="k">]</span>.dqs<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
<a id="__codelineno-136-66" name="__codelineno-136-66" href="#__codelineno-136-66"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FT45<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">3</span><span class="k">]</span>.dqs_n<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
<a id="__codelineno-136-67" name="__codelineno-136-67" href="#__codelineno-136-67"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_FK44<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">3</span><span class="k">]</span>.dbi_n<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
</code></pre></div>
</li>
<li>
<p>Change the pin assignment for <code>ddr4_mem[1].dbi_n[4]</code> from <code>PIN_G12</code> to <code>PIN_W9</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_W9<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>ddr4_mem<span class="k">[</span><span class="nv">1</span><span class="k">]</span>.dbi_n<span class="k">[</span><span class="nv">4</span><span class="k">]</span>
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Compile the design.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a>ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>-p<span class="w"> </span>f2000x<span class="w"> </span>&lt;YOUR_WORK_DIRECTORY&gt;
</code></pre></div>
</li>
<li>
<p>You may need to adjust the floorplan of the design in order to meet timing after a design change such as this. Refer to the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#54-how-to-resize-the-partial-reconfiguration-region">How to Resize the Partial Reconfiguration Region</a> section for information regarding modifications to the floorplan.</p>
</li>
</ol>
<p>The configuration edits described here were made to the original source files of the cloned <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repository. Therefore, these modifications will present in subsequent <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> compilations. This is because the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> compilation process links and copies source files from the cloned <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repository to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> compilation work directory.</p>
<h3 id="56-how-to-compile-the-fim-with-no-hssi"><strong>5.6 How to compile the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> with No HSSI</strong><a class="headerlink" href="#56-how-to-compile-the-fim-with-no-hssi" title="Permanent link">&para;</a></h3>
<p>In this example we will compile f2000x with the Ethernet subsystem removed. To perform the flat compile of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> with no Ethernet subsystem, pass the <code>no_hssi</code> and <code>flat</code> options to the build_top.sh script:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a>ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>f2000x<span class="w"> </span>:flat,no_hssi<span class="w"> </span>&lt;YOUR_WORK_DIRECTORY&gt;
</code></pre></div>
<p>If you wish to build a <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> enabled design, you may adjust the Logic Lock regions to allocate more resources to the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region since the Ethernet subsystem has been removed from the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. Refer to the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#54-how-to-resize-the-partial-reconfiguration-region">How to Resize the Partial Reconfiguration Region</a> section for information regarding modifications to the floorplan.</p>
<h3 id="57-how-to-change-the-pcie-device-id-and-vendor-id"><strong>5.7 How to change the PCIe device ID and Vendor ID</strong><a class="headerlink" href="#57-how-to-change-the-pcie-device-id-and-vendor-id" title="Permanent link">&para;</a></h3>
<p>The PCIe configuration registers contains the Vendor, Device and Subsystem Vendor ID registers which are used in PCIe add-in cards to uniquely identify the card for assignment to software drivers.  <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> has these registers set with Intel values for out of the box usage.  If you are using <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for a PCIe add in card that your company manufactures, then update the PCIe Subsytem Subsystem ID and Vendor ID registers as described below and change OPAE provided software code to properly operate with your company's register values.</p>
<p>The Vendor ID is assigned to your company by the PCI-SIG (Special Interest Group). The PCI-SIG is the only body officially licensed to give out IDs. You must be a member of PCI-SIG to request your own ID. Information about joining PCI-SIG is available here: <a href="http://www.pcisig.com">PCI-SIG</a>. You select the Subsystem Device ID for your PCIe add in card.</p>
<p>Follow the instructions below to customize the PCIe device ID and Vendor ID of the f2000x  PLPlatform.</p>
<p>You can display the current settings using the command <code>lspci -nvmms &lt;PCIe B.D.f&gt;</code> as shown below:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a>lspci<span class="w"> </span>-nvmms<span class="w"> </span><span class="m">98</span>:00
</code></pre></div>
Example Output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a>Slot:<span class="w">   </span><span class="m">98</span>:00.0
<a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a>Class:<span class="w">  </span><span class="m">1200</span>
<a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a>Vendor:<span class="w"> </span><span class="m">8086</span>
<a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a>Device:<span class="w"> </span>bcce
<a id="__codelineno-141-5" name="__codelineno-141-5" href="#__codelineno-141-5"></a>SVendor:<span class="w">        </span><span class="m">8086</span>
<a id="__codelineno-141-6" name="__codelineno-141-6" href="#__codelineno-141-6"></a>SDevice:<span class="w">        </span><span class="m">1771</span>
<a id="__codelineno-141-7" name="__codelineno-141-7" href="#__codelineno-141-7"></a>PhySlot:<span class="w">        </span><span class="m">1</span>
<a id="__codelineno-141-8" name="__codelineno-141-8" href="#__codelineno-141-8"></a>Rev:<span class="w">    </span><span class="m">01</span>
<a id="__codelineno-141-9" name="__codelineno-141-9" href="#__codelineno-141-9"></a>NUMANode:<span class="w">       </span><span class="m">1</span>
<a id="__codelineno-141-10" name="__codelineno-141-10" href="#__codelineno-141-10"></a>
<a id="__codelineno-141-11" name="__codelineno-141-11" href="#__codelineno-141-11"></a>Slot:<span class="w">   </span><span class="m">98</span>:00.1
<a id="__codelineno-141-12" name="__codelineno-141-12" href="#__codelineno-141-12"></a>Class:<span class="w">  </span><span class="m">1200</span>
<a id="__codelineno-141-13" name="__codelineno-141-13" href="#__codelineno-141-13"></a>Vendor:<span class="w"> </span><span class="m">8086</span>
<a id="__codelineno-141-14" name="__codelineno-141-14" href="#__codelineno-141-14"></a>Device:<span class="w"> </span>bcce
<a id="__codelineno-141-15" name="__codelineno-141-15" href="#__codelineno-141-15"></a>SVendor:<span class="w">        </span><span class="m">8086</span>
<a id="__codelineno-141-16" name="__codelineno-141-16" href="#__codelineno-141-16"></a>SDevice:<span class="w">        </span><span class="m">1771</span>
<a id="__codelineno-141-17" name="__codelineno-141-17" href="#__codelineno-141-17"></a>PhySlot:<span class="w">        </span><span class="m">1</span>
<a id="__codelineno-141-18" name="__codelineno-141-18" href="#__codelineno-141-18"></a>NUMANode:<span class="w">       </span><span class="m">1</span>
<a id="__codelineno-141-19" name="__codelineno-141-19" href="#__codelineno-141-19"></a>
<a id="__codelineno-141-20" name="__codelineno-141-20" href="#__codelineno-141-20"></a>Slot:<span class="w">   </span><span class="m">98</span>:00.2
<a id="__codelineno-141-21" name="__codelineno-141-21" href="#__codelineno-141-21"></a>Class:<span class="w">  </span><span class="m">1200</span>
<a id="__codelineno-141-22" name="__codelineno-141-22" href="#__codelineno-141-22"></a>Vendor:<span class="w"> </span><span class="m">8086</span>
<a id="__codelineno-141-23" name="__codelineno-141-23" href="#__codelineno-141-23"></a>Device:<span class="w"> </span>bcce
<a id="__codelineno-141-24" name="__codelineno-141-24" href="#__codelineno-141-24"></a>SVendor:<span class="w">        </span><span class="m">8086</span>
<a id="__codelineno-141-25" name="__codelineno-141-25" href="#__codelineno-141-25"></a>SDevice:<span class="w">        </span><span class="m">1771</span>
<a id="__codelineno-141-26" name="__codelineno-141-26" href="#__codelineno-141-26"></a>PhySlot:<span class="w">        </span><span class="m">1</span>
<a id="__codelineno-141-27" name="__codelineno-141-27" href="#__codelineno-141-27"></a>NUMANode:<span class="w">       </span><span class="m">1</span>
<a id="__codelineno-141-28" name="__codelineno-141-28" href="#__codelineno-141-28"></a>
<a id="__codelineno-141-29" name="__codelineno-141-29" href="#__codelineno-141-29"></a>Slot:<span class="w">   </span><span class="m">98</span>:00.3
<a id="__codelineno-141-30" name="__codelineno-141-30" href="#__codelineno-141-30"></a>Class:<span class="w">  </span><span class="m">1200</span>
<a id="__codelineno-141-31" name="__codelineno-141-31" href="#__codelineno-141-31"></a>Vendor:<span class="w"> </span>1af4
<a id="__codelineno-141-32" name="__codelineno-141-32" href="#__codelineno-141-32"></a>Device:<span class="w"> </span><span class="m">1000</span>
<a id="__codelineno-141-33" name="__codelineno-141-33" href="#__codelineno-141-33"></a>SVendor:<span class="w">        </span>1af4
<a id="__codelineno-141-34" name="__codelineno-141-34" href="#__codelineno-141-34"></a>SDevice:<span class="w">        </span><span class="m">1771</span>
<a id="__codelineno-141-35" name="__codelineno-141-35" href="#__codelineno-141-35"></a>PhySlot:<span class="w">        </span><span class="m">1</span>
<a id="__codelineno-141-36" name="__codelineno-141-36" href="#__codelineno-141-36"></a>NUMANode:<span class="w">       </span><span class="m">1</span>
<a id="__codelineno-141-37" name="__codelineno-141-37" href="#__codelineno-141-37"></a>
<a id="__codelineno-141-38" name="__codelineno-141-38" href="#__codelineno-141-38"></a>Slot:<span class="w">   </span><span class="m">98</span>:00.4
<a id="__codelineno-141-39" name="__codelineno-141-39" href="#__codelineno-141-39"></a>Class:<span class="w">  </span><span class="m">1200</span>
<a id="__codelineno-141-40" name="__codelineno-141-40" href="#__codelineno-141-40"></a>Vendor:<span class="w"> </span><span class="m">8086</span>
<a id="__codelineno-141-41" name="__codelineno-141-41" href="#__codelineno-141-41"></a>Device:<span class="w"> </span>bcce
<a id="__codelineno-141-42" name="__codelineno-141-42" href="#__codelineno-141-42"></a>SVendor:<span class="w">        </span><span class="m">8086</span>
<a id="__codelineno-141-43" name="__codelineno-141-43" href="#__codelineno-141-43"></a>SDevice:<span class="w">        </span><span class="m">1771</span>
<a id="__codelineno-141-44" name="__codelineno-141-44" href="#__codelineno-141-44"></a>PhySlot:<span class="w">        </span><span class="m">1</span>
<a id="__codelineno-141-45" name="__codelineno-141-45" href="#__codelineno-141-45"></a>NUMANode:<span class="w">       </span><span class="m">1</span>
</code></pre></div>
<h3 id="571-changing-the-pcie-subsystem-device-id-and-vendor-id"><strong>5.7.1 Changing the PCIe Subsystem Device ID and Vendor ID</strong><a class="headerlink" href="#571-changing-the-pcie-subsystem-device-id-and-vendor-id" title="Permanent link">&para;</a></h3>
<p>You will use IP Parameter Editor to modify the PCIe configuration registers.</p>
<ol>
<li>
<p>Navigate to the PCIe Subsystem IP file and bring up IP Parameter Editor to change values.</p>
<blockquote>
<p><strong>Note:</strong> Both the Host and SoC PCIe subsystems use the same IP module, so the following changes to Device ID and Vendor ID will be reflected in both the Host and SoC PCIe Subsystems.</p>
</blockquote>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/ipss/pcie/qip/ss
<a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a>qsys-edit<span class="w"> </span>pcie_ss.ip
</code></pre></div>
The IP Parameter Editor GUI will open.  Close any tool pop-ups.</p>
<p><a class="glightbox" href="../images/pcie_ss_editor.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/pcie_ss_editor.PNG" /></a></p>
</li>
<li>
<p>Scroll down through the PCIe subsystem settings tabs to the PCIe Interfaces 0 Ports Settings tab as shown below:</p>
<p><a class="glightbox" href="../images/pcie_ss_editor2.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/pcie_ss_editor2.PNG" /></a></p>
<p>Select the PCIe0 Device Identification Registers tab. You can edit the values of Vendor ID, Device ID, Subsystem Vendor ID and Subsystem Device ID for each PF/VF in use.</p>
</li>
<li>
<p>Once you have made changes, click Generate HDL and save. </p>
</li>
<li>Make sure the environment variables are set as described in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#441-setting-up-required-environment-variables">Setting Up Required Environment Variables</a> section.</li>
<li>
<p>Build your new FPGA image with build_top.sh script</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a>ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>-p<span class="w"> </span>f2000x<span class="w"> </span>work_pcie_vid
</code></pre></div>
</li>
</ol>
<p>Be aware that OPAE FPGA management commands require recognition of the FPGA PCIe Device ID for control.  If there is a problem between OPAE management recognition of FPGA PCIe values, then control of the card will be lost.  For this reason, you are strongly encouraged to initially confiugre the FPGA via <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> to load the test FPGA image. Instructions for thes process are given in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#522-configuring-the-fpga-with-a-sof-image-via-jtag">Configuring the FPGA with a SOF Image via <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr></a> section. If there is a problem with the SOF image working with your host software that is updated for the new PCIe settings, then you can load a known good SOF file to recover.  Once you sure that both the software and FPGA work properly, you can load the FPGA into FPGA flash using the OPAE command <code>fpgasupdate</code>.</p>
<p>The changes to software required to work with new PCIe settings are described in <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/">Software Reference Manual: Intel Open FPGA Stack</a> </p>
<h3 id="58-how-to-migrate-to-a-different-agilex-device-number"><strong>5.8 How to migrate to a different Agilex device number</strong><a class="headerlink" href="#58-how-to-migrate-to-a-different-agilex-device-number" title="Permanent link">&para;</a></h3>
<p>The following instructions enable you to change the Agilex FPGA device part number of the f2000x, for example, to migrate to a device with a larger density. Be aware that this release works with Agilex devices that have P-tile for PCIe and E-tile for Ethernet.</p>
<p>The default device for the Intel® Infrastructure Processing Unit (Intel® IPU) Platform F2000X-PL is AGFC023R25A2E2VR0</p>
<h4 id="581-migrating-to-a-larger-device-with-the-same-package"><strong>5.8.1 Migrating To a Larger Device With the Same Package</strong><a class="headerlink" href="#581-migrating-to-a-larger-device-with-the-same-package" title="Permanent link">&para;</a></h4>
<p>Perform the following steps to change the device to a larger density with the same package.</p>
<ol>
<li>
<p>Clone the design repository. See the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#421-clone-the-ofs-git-repo">Clone the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Git Repo</a> section.</p>
</li>
<li>
<p>Set the environment variables as described in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#441-setting-up-required-environment-variables">Setting Up Required Environment Variables</a> section.</p>
</li>
<li>
<p>Navigate to the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Root Directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
</code></pre></div>
</li>
<li>
<p>Use the following command to change the device part number throughout the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Root directory heirarchy, replacing <code>&lt;DEFAULT_OPN&gt;</code> and <code>&lt;NEW_OPN&gt;</code> with the part numbers specific to your update:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a>grep<span class="w"> </span>-rli<span class="w"> </span><span class="s1">&#39;&lt;DEFAULT_OPN&gt;&#39;</span><span class="w"> </span>*<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-i@<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/&lt;DEFAULT_OPN&gt;/&lt;NEW_OPN&gt;/g&#39;</span><span class="w"> </span>@
</code></pre></div>
<p>For example, use the following command to change from part AGFC023R25A2E2VR0 to part AGFA027R25A2E2VR0:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a>grep<span class="w"> </span>-rli<span class="w"> </span><span class="s1">&#39;AGFC023R25A2E2VR0&#39;</span>*<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>-i@<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/AGFC023R25A2E2VR0/AGFA027R25A2E2VR0/g&#39;</span><span class="w"> </span>@
</code></pre></div>
<p>This changes all occurrences of the default device (AGFC023R25A2E2VR0) in the $OFS_ROOTDIR directory to the new device number (AGFA027R25A2E2VR0).</p>
</li>
<li>
<p>Compile the flat (non-<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>) design to verify the compilation is successful with the new part. The flat design is compiled without any Logic Lock constraints.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-147-2" name="__codelineno-147-2" href="#__codelineno-147-2"></a>ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>f2000x:flat<span class="w">  </span>&lt;YOUR_WORK_DIRECTORY&gt;
</code></pre></div>
</li>
<li>
<p>To enable the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region, use Quartus Chip Planner to analyze the compiled flat design and adjust the Logic Lock constraints defined in <code>$OFS_ROOTDIR/syn/setup/pr_assignments.tcl</code> for the new device layout. Refer to the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#54-how-to-resize-the-partial-reconfiguration-region">How to Resize the Partial Reconfiguration Region</a> section for instructions. Re-compile the design with the out-of-tree <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region enabled.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a>ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>-p<span class="w"> </span>f2000x<span class="w">  </span>&lt;YOUR_WORK_DIRECTORY&gt;
</code></pre></div>
</li>
</ol>
<h3 id="59-how-to-change-ethernet-interface-from-8x25-gbe-to-8x10-gbe"><strong>5.9 How to change Ethernet interface from 8x25 GbE to 8x10 GbE</strong><a class="headerlink" href="#59-how-to-change-ethernet-interface-from-8x25-gbe-to-8x10-gbe" title="Permanent link">&para;</a></h3>
<p>This section describes steps to change the Ethernet interface from 8x25 GbE to 8x10 GbE. </p>
<ol>
<li>
<p>Edit the HSSI IP Subsystem <strong>$OFS_ROOTDIR/ipss/hssi/qip/hssi_ss_8x25g.ip</strong> to be 8x10 GbE using IP Platform Editor.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/ipss/hssi/qip/hssi_ss
<a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a>qsys-edit<span class="w"> </span>hssi_ss_8x25g.ip
</code></pre></div>
</li>
<li>
<p>The IP Prameter Editer comes up - expect 2-5 minutes for this process to complete.  When the pop-up indicates Open System Completed, click <strong>Close</strong>.  When the General Configuration window comes up, scroll down and switch ports 0 through 7 from 25GbE to 10GbE as shown below:</p>
<p><a class="glightbox" href="../images/ip_param_editor_10g_1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ip_param_editor_10g_1.png" /></a></p>
</li>
<li>
<p>Click the IP Configuration tab and note the default settings of <strong>OFF</strong> for AN/LT and SYNCE.  You may optionally change these settings based on your application needs. The settings for P0 IP cover ports 0 to 3.  The settings for P4 cover ports 4 to 7.</p>
<p><a class="glightbox" href="../images/ip_param_editor_10g_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ip_param_editor_10g_2.png" /></a></p>
</li>
<li>
<p>Click "P0 Configuration" tab and note the default settings for maximum frame size.  You may optionally change these settings based on your application needs.  Set "P4 Configuration" as needed. </p>
<p><a class="glightbox" href="../images/ip_param_editor_10g_3.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ip_param_editor_10g_3.PNG" /></a></p>
</li>
<li>
<p>Leave other settings at default values.</p>
</li>
<li>Click <code>File</code> and <code>Save As</code> hssi_ss_8x10g.ip  Click <code>Generate HDL</code> in the bottom right hand corner of IP Editor and enable simulation support.</li>
<li>
<p>Edit $OFS_ROOTDIR/ipss/hssi/eth_design_files.tcl to comment out 8x25g and add in 8x10g.ip</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="c">#-----------------</span>
<a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a><span class="c"># HSSI SS IP</span>
<a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a><span class="c">#-----------------</span>
<a id="__codelineno-150-4" name="__codelineno-150-4" href="#__codelineno-150-4"></a><span class="c">#set_global_assignment -name IP_FILE               ../ip_lib/ipss/hssi/qip/hssi_ss/hssi_ss_8x25g.ip</span>
<a id="__codelineno-150-5" name="__codelineno-150-5" href="#__codelineno-150-5"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>IP_FILE<span class="w">               </span>..<span class="o">/</span>ip_lib<span class="o">/</span>ipss<span class="o">/</span>hssi<span class="o">/</span>qip<span class="o">/</span>hssi_ss<span class="o">/</span>hssi_ss_8x10g.ip
<a id="__codelineno-150-6" name="__codelineno-150-6" href="#__codelineno-150-6"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>IP_FILE<span class="w">               </span>..<span class="o">/</span>ip_lib<span class="o">/</span>ipss<span class="o">/</span>hssi<span class="o">/</span>qip<span class="o">/</span>ptp_iopll<span class="o">/</span>ptp_sample_clk_pll.ip
</code></pre></div>
</li>
<li>
<p>Edit $OFS_ROOTDIR/syn/syn_top/ofs_top.qsf and $OFS_ROOTDIR/syn/syn_top/ofs_pr_afu.qsf to add new macro definition:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>VERILOG_MACRO<span class="w"> </span><span class="s2">&quot;ETH_10G&quot;</span><span class="w">    </span><span class="err">#</span><span class="w"> </span>Change<span class="w"> </span>Ethernet<span class="w"> </span>from<span class="w"> </span><span class="mi">8</span>x25<span class="w"> </span>to<span class="w"> </span><span class="mi">8</span>x10<span class="w"> </span>GbE
</code></pre></div>
</li>
<li>
<p>Build new 8x10G <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a>ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>-p<span class="w"> </span>f2000x<span class="w"> </span>work_8x10gbe
</code></pre></div>
</li>
<li>
<p>You may need to adjust the floorplan of the design in order to meet timing after a design change such as this. Refer to the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#54-how-to-resize-the-partial-reconfiguration-region">How to Resize the Partial Reconfiguration Region</a> section for information regarding modifications to the floorplan.</p>
</li>
</ol>
<h3 id="510-how-to-change-ethernet-interface-from-8-x-25-gbe-to-2-x-100-gbe"><strong>5.10 How to change Ethernet interface from 8 X 25 GbE to 2 X 100 GbE</strong><a class="headerlink" href="#510-how-to-change-ethernet-interface-from-8-x-25-gbe-to-2-x-100-gbe" title="Permanent link">&para;</a></h3>
<p>This section describes steps to change the Ethernet interface from 8 X 25 GbE to 2 x 100 GbE. </p>
<ol>
<li>
<p>Edit HSSI IP Subsystem <strong>$OFS_ROOTDIR/ipss/hssi/qip/hssi_ss/hssi_ss_8x25g.ip</strong> to be 2 X 100 GbE using IP Platform Editor.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/ipss/hssi/qip/hssi_ss
<a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a>qsys-edit<span class="w"> </span>hssi_ss_8x25g.ip
</code></pre></div>
</li>
<li>
<p>The IP Prameter Editer comes up - expect 2-5 minutes for this process to complete.  When pop-up indicates Open System Completed, click 'Close'.  The General Configuration window comes up, change ports to 2 and set "PORT0_PROFILE" and "PORT4_PROFILE" to "100GCAUI-4" as shown below:</p>
<p><a class="glightbox" href="../images/ip_param_editor_100g_1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ip_param_editor_100g_1.png" /></a></p>
</li>
<li>
<p>Click the IP Configuration tab and note the default settings of OFF for AN/LT and SYNCE.  You may optionally change these settings based on your application needs.</p>
<p><a class="glightbox" href="../images/ip_param_editor_100g_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ip_param_editor_100g_2.png" /></a></p>
</li>
<li>
<p>Click "P0 Configuration" tab and note the default settings for maximum frame size.  You may optionally change these settings based on your application needs.  Set "P4 Configuration" as needed. </p>
<p><a class="glightbox" href="../images/ip_param_editor_100g_3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ip_param_editor_100g_3.png" /></a></p>
</li>
<li>
<p>Leave other settings at default values.</p>
</li>
<li>
<p>Click <code>File</code> and <code>Save As</code> hssi_ss_2x100g.  Click <code>Generate HDL</code> in the bottom right hand corner of IP Editor and enable simulation support.</p>
</li>
<li>
<p>Edit $OFS_ROOTDIR/ipss/hssi/eth_design_files.tcl to comment out 8x25g and add in 2x100g.ip</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a>#-----------------
<a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a># HSSI SS IP
<a id="__codelineno-154-3" name="__codelineno-154-3" href="#__codelineno-154-3"></a>#-----------------
<a id="__codelineno-154-4" name="__codelineno-154-4" href="#__codelineno-154-4"></a>#set_global_assignment -name IP_FILE               ../ip_lib/ipss/hssi/qip/hssi_ss/hssi_ss_8x25g.ip
<a id="__codelineno-154-5" name="__codelineno-154-5" href="#__codelineno-154-5"></a>set_global_assignment -name IP_FILE               ../ip_lib/ipss/hssi/qip/hssi_ss/hssi_ss_2x100g.ip
<a id="__codelineno-154-6" name="__codelineno-154-6" href="#__codelineno-154-6"></a>set_global_assignment -name IP_FILE               ../ip_lib/ipss/hssi/qip/ptp_iopll/ptp_sample_clk_pll.ip
</code></pre></div>
</li>
<li>
<p>Edit $OFS_ROOTDIR/syn/syn_top/ofs_top.qsf and $OFS_ROOTDIR/syn/syn_top/ofs_pr_afu.qsf to add new macro definition:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a>set_global_assignment -name VERILOG_MACRO &quot;ETH_100G&quot;      # Change Ethernet from 8x25 to 2x100 GbE
</code></pre></div>
</li>
<li>
<p>Update $OFS_ROOTDIR/syn/setup/eth_top.sdc:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a>#Timing for 100G
<a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a>set_false_path -from [get_clocks {sys_pll|iopll_0_clk_100m}] -to [get_clocks {hssi_wrapper|hssi_ss|hssi_ss_0|U_hssi_ss_ip_wrapper|U_hssi_ss_ip_top_p*|alt_ehipc3_fm_0|alt_ehipc3_fm_top_p*|alt_ehipc3_fm_hard_inst|E100GX4_FEC.altera_xcvr_native_inst|xcvr_native_s10_etile_0_example_design_4ln_ptp|tx_clkout|ch0}]; 
<a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a>
<a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a>set_false_path -from [get_clocks {hssi_wrapper|hssi_ss|hssi_ss_0|U_hssi_ss_ip_wrapper|U_hssi_ss_ip_top_p*|alt_ehipc3_fm_0|alt_ehipc3_fm_top_p*|alt_ehipc3_fm_hard_inst|E100GX4_FEC.altera_xcvr_native_inst|xcvr_native_s10_etile_0_example_design_4ln_ptp|tx_clkout|ch0}] -to [get_clocks {sys_pll|iopll_0_clk_100m}];   
</code></pre></div>
</li>
<li>
<p>Build new 2x100G <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a>cd $OFS_ROOTDIR
<a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a>ofs-common/scripts/common/syn/build_top.sh -p f2000x work_2x100gbe
</code></pre></div>
</li>
<li>
<p>You may need to adjust the floorplan of the design in order to meet timing after a design change such as this. Refer to  for information regarding modifications to the floorplan.</p>
</li>
</ol>
<h3 id="511-how-to-add-more-transceiver-channels-the-ethernet-subsystem"><strong>5.11 How to add more Transceiver channels the Ethernet Subsystem</strong><a class="headerlink" href="#511-how-to-add-more-transceiver-channels-the-ethernet-subsystem" title="Permanent link">&para;</a></h3>
<p>This section describes how to add 4 extra Ethernet channels to the existing f2000x <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design which uses the 8x25G (2x4x25G) as the default ethernet configuration.</p>
<p>In this exercise we will add 4 extra channels to make a total of 12 channels. This configuration will be called 12x25G.</p>
<ol>
<li>Clone the design repository or use an existing design. See the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#421-clone-the-ofs-git-repo">Clone the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Git Repo</a> section.</li>
<li>Set the environment variables. See the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#441-setting-up-required-environment-variables">Setting Up Required Environment Variables</a> section.</li>
<li>
<p>Navigate to the directory containing the existing Ethernet Subsystem IP <code>hssi_ss_8x25g.ip</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/ipss/hssi/qip/hssi_ss
</code></pre></div>
</li>
<li>
<p>Create a copy of the existing 8x25G IP and name it <code>hssi_ss_12x25g.ip</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a>cp<span class="w"> </span>hssi_ss_8x25g.ip<span class="w"> </span>hssi_ss_12x25g.ip
</code></pre></div>
</li>
<li>
<p>Open the newly created <code>hssi_ss_12x25g.ip</code> file in Platform Designer.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a>qsys-edit<span class="w"> </span>hssi_ss_12x25g.ip
</code></pre></div>
</li>
<li>
<p>In the <strong>HSSI Subsystem &gt; Device 0 Configuration &gt; Main Configuration</strong> tab, change the <strong>NUM_ENABLED_PORTS</strong> value from <code>8</code> to <code>12</code>. </p>
<p><a class="glightbox" href="../images/eth_ss_num_ports.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/eth_ss_num_ports.png" /></a></p>
</li>
<li>
<p>In the <strong>HSSI Subsystem &gt; Device 0 Configuration &gt; Main Configuration</strong> tab, enable Ports 8 through 11, using the same configuration as the original 8 transceiver ports.</p>
<p><a class="glightbox" href="../images/eth_ss_port_config.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/eth_ss_port_config.png" /></a></p>
<p><a class="glightbox" href="../images/eth_ss_port_config2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/eth_ss_port_config2.png" /></a></p>
</li>
<li>
<p>Click <strong>Generate HDL</strong>. Close Platform Designer once generation is complete with no errors.</p>
</li>
<li>
<p>Edit <code>$OFS_ROOTDIR/ipss/hssi/eth_design_files.tcl</code></p>
<ol>
<li>
<p>Comment out the old 8x25G IP and and the new 12x25G IP in the <strong>HSSI SS IP</strong> section</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a><span class="c">#set_global_assignment -name IP_FILE ../ip_lib/ipss/hssi/qip/hssi_ss/hssi_ss_8x25g.ip</span>
<a id="__codelineno-161-2" name="__codelineno-161-2" href="#__codelineno-161-2"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>IP_FILE<span class="w"> </span>..<span class="o">/</span>ip_lib<span class="o">/</span>ipss<span class="o">/</span>hssi<span class="o">/</span>qip<span class="o">/</span>hssi_ss<span class="o">/</span>hssi_ss_12x25g.ip
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Edit <code>$OFS_ROOTDIR/ipss/hssi/rtl/hssi_wrapper.sv</code></p>
<ol>
<li>
<p>In the <strong>HSSI SS Instantiation</strong> section, replace the existing 8x25G IP instantiation with the new 12x25G IP instantiation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a><span class="c1">//hssi_ss_8x25g</span>
<a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a><span class="n">hssi_ss_12x25g</span>
</code></pre></div>
</li>
<li>
<p>In the <strong>Serial signal mapping to QSFP</strong> section, after the <code>else</code> statement, add the 4 new Ethernet ports:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a><span class="no">`ifdef</span><span class="w"> </span><span class="n">INCLUDE_HSSI_PORT_8</span>
<a id="__codelineno-163-2" name="__codelineno-163-2" href="#__codelineno-163-2"></a><span class="k">assign</span><span class="w"> </span><span class="n">serial_rx_p</span><span class="p">[</span><span class="n">PORT_8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qsfp_serial</span><span class="p">[</span><span class="mh">2</span><span class="p">].</span><span class="n">rx_p</span><span class="p">[</span><span class="mh">0</span><span class="p">];</span>
<a id="__codelineno-163-3" name="__codelineno-163-3" href="#__codelineno-163-3"></a><span class="k">assign</span><span class="w"> </span><span class="n">serial_rx_n</span><span class="p">[</span><span class="n">PORT_8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-163-4" name="__codelineno-163-4" href="#__codelineno-163-4"></a><span class="k">assign</span><span class="w"> </span><span class="n">qsfp_serial</span><span class="p">[</span><span class="mh">2</span><span class="p">].</span><span class="n">tx_p</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serial_tx_p</span><span class="p">[</span><span class="n">PORT_8</span><span class="p">];</span>
<a id="__codelineno-163-5" name="__codelineno-163-5" href="#__codelineno-163-5"></a><span class="no">`endif</span>
<a id="__codelineno-163-6" name="__codelineno-163-6" href="#__codelineno-163-6"></a><span class="no">`ifdef</span><span class="w"> </span><span class="n">INCLUDE_HSSI_PORT_9</span>
<a id="__codelineno-163-7" name="__codelineno-163-7" href="#__codelineno-163-7"></a><span class="k">assign</span><span class="w"> </span><span class="n">serial_rx_p</span><span class="p">[</span><span class="n">PORT_9</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qsfp_serial</span><span class="p">[</span><span class="mh">2</span><span class="p">].</span><span class="n">rx_p</span><span class="p">[</span><span class="mh">1</span><span class="p">];</span>
<a id="__codelineno-163-8" name="__codelineno-163-8" href="#__codelineno-163-8"></a><span class="k">assign</span><span class="w"> </span><span class="n">serial_rx_n</span><span class="p">[</span><span class="n">PORT_9</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-163-9" name="__codelineno-163-9" href="#__codelineno-163-9"></a><span class="k">assign</span><span class="w"> </span><span class="n">qsfp_serial</span><span class="p">[</span><span class="mh">2</span><span class="p">].</span><span class="n">tx_p</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serial_tx_p</span><span class="p">[</span><span class="n">PORT_9</span><span class="p">];</span>
<a id="__codelineno-163-10" name="__codelineno-163-10" href="#__codelineno-163-10"></a><span class="no">`endif</span>
<a id="__codelineno-163-11" name="__codelineno-163-11" href="#__codelineno-163-11"></a><span class="no">`ifdef</span><span class="w"> </span><span class="n">INCLUDE_HSSI_PORT_10</span>
<a id="__codelineno-163-12" name="__codelineno-163-12" href="#__codelineno-163-12"></a><span class="k">assign</span><span class="w"> </span><span class="n">serial_rx_p</span><span class="p">[</span><span class="n">PORT_10</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qsfp_serial</span><span class="p">[</span><span class="mh">2</span><span class="p">].</span><span class="n">rx_p</span><span class="p">[</span><span class="mh">2</span><span class="p">];</span>
<a id="__codelineno-163-13" name="__codelineno-163-13" href="#__codelineno-163-13"></a><span class="k">assign</span><span class="w"> </span><span class="n">serial_rx_n</span><span class="p">[</span><span class="n">PORT_10</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-163-14" name="__codelineno-163-14" href="#__codelineno-163-14"></a><span class="k">assign</span><span class="w"> </span><span class="n">qsfp_serial</span><span class="p">[</span><span class="mh">2</span><span class="p">].</span><span class="n">tx_p</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serial_tx_p</span><span class="p">[</span><span class="n">PORT_10</span><span class="p">];</span>
<a id="__codelineno-163-15" name="__codelineno-163-15" href="#__codelineno-163-15"></a><span class="no">`endif</span>
<a id="__codelineno-163-16" name="__codelineno-163-16" href="#__codelineno-163-16"></a><span class="no">`ifdef</span><span class="w"> </span><span class="n">INCLUDE_HSSI_PORT_11</span>
<a id="__codelineno-163-17" name="__codelineno-163-17" href="#__codelineno-163-17"></a><span class="k">assign</span><span class="w"> </span><span class="n">serial_rx_p</span><span class="p">[</span><span class="n">PORT_11</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qsfp_serial</span><span class="p">[</span><span class="mh">2</span><span class="p">].</span><span class="n">rx_p</span><span class="p">[</span><span class="mh">3</span><span class="p">];</span>
<a id="__codelineno-163-18" name="__codelineno-163-18" href="#__codelineno-163-18"></a><span class="k">assign</span><span class="w"> </span><span class="n">serial_rx_n</span><span class="p">[</span><span class="n">PORT_11</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-163-19" name="__codelineno-163-19" href="#__codelineno-163-19"></a><span class="k">assign</span><span class="w"> </span><span class="n">qsfp_serial</span><span class="p">[</span><span class="mh">2</span><span class="p">].</span><span class="n">tx_p</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serial_tx_p</span><span class="p">[</span><span class="n">PORT_11</span><span class="p">];</span>
<a id="__codelineno-163-20" name="__codelineno-163-20" href="#__codelineno-163-20"></a><span class="no">`endif</span>
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Edit <code>$OFS_ROOTDIR/ipss/hssi/rtl/inc/ofs_fim_eth_plat_defines.svh</code></p>
<ol>
<li>
<p>Define the new port macros in the section configuring 25G with no CVL</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a><span class="cp">`define INCLUDE_HSSI_PORT_8</span>
<a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a><span class="cp">`define INCLUDE_HSSI_PORT_9</span>
<a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a><span class="cp">`define INCLUDE_HSSI_PORT_10</span>
<a id="__codelineno-164-4" name="__codelineno-164-4" href="#__codelineno-164-4"></a><span class="cp">`define INCLUDE_HSSI_PORT_11</span>
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Edit <code>$OFS_ROOTDIR/ipss/hssi/rtl/inc/ofs_fim_eth_plat_if_pkg.sv</code></p>
<ol>
<li>
<p>Change the parameter defining the number of QSFP ports from <code>2</code> to <code>3</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a><span class="k">localparam</span><span class="w"> </span><span class="n">NUM_QSFP_PORTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// QSFP cage on board</span>
</code></pre></div>
</li>
<li>
<p>Change the number of ethernet channels parameter for the 25G with no CVL configuration from <code>8</code> to <code>12</code></p>
<p>```verilog
localparam NUM_ETH_CHANNELS = 12; // Ethernet Ports
````</p>
</li>
</ol>
</li>
<li>
<p>Edit <code>$OFS_ROOTDIR/syn/setup/eth_loc.tcl</code></p>
<ol>
<li>
<p>Edit the pinout file to assign pins for the new QSFP. In this example we are using Channels 8-11 in the E-tile.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_DL1<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>qsfp_serial<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.tx_p<span class="k">[</span><span class="nv">0</span><span class="k">]</span>
<a id="__codelineno-166-2" name="__codelineno-166-2" href="#__codelineno-166-2"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_DN4<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>qsfp_serial<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.tx_p<span class="k">[</span><span class="nv">1</span><span class="k">]</span>
<a id="__codelineno-166-3" name="__codelineno-166-3" href="#__codelineno-166-3"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_DY1<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>qsfp_serial<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.tx_p<span class="k">[</span><span class="nv">2</span><span class="k">]</span>
<a id="__codelineno-166-4" name="__codelineno-166-4" href="#__codelineno-166-4"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_EB4<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>qsfp_serial<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.tx_p<span class="k">[</span><span class="nv">3</span><span class="k">]</span>
<a id="__codelineno-166-5" name="__codelineno-166-5" href="#__codelineno-166-5"></a>
<a id="__codelineno-166-6" name="__codelineno-166-6" href="#__codelineno-166-6"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_DL8<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>qsfp_serial<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.rx_p<span class="k">[</span><span class="nv">0</span><span class="k">]</span>
<a id="__codelineno-166-7" name="__codelineno-166-7" href="#__codelineno-166-7"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_DN13<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>qsfp_serial<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.rx_p<span class="k">[</span><span class="nv">1</span><span class="k">]</span>
<a id="__codelineno-166-8" name="__codelineno-166-8" href="#__codelineno-166-8"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_DY8<span class="w">  </span><span class="o">-</span>to<span class="w"> </span>qsfp_serial<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.rx_p<span class="k">[</span><span class="nv">2</span><span class="k">]</span>
<a id="__codelineno-166-9" name="__codelineno-166-9" href="#__codelineno-166-9"></a><span class="nv">set_location_assignment</span><span class="w"> </span>PIN_EB13<span class="w"> </span><span class="o">-</span>to<span class="w"> </span>qsfp_serial<span class="k">[</span><span class="nv">2</span><span class="k">]</span>.rx_p<span class="k">[</span><span class="nv">3</span><span class="k">]</span>
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Compile the design</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-167-2" name="__codelineno-167-2" href="#__codelineno-167-2"></a>ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>-p<span class="w"> </span>f2000x<span class="w"> </span>&lt;YOUR_WORK_DIRECTORY&gt;
</code></pre></div>
</li>
<li>
<p>You may need to adjust the floorplan of the design in order to meet timing after a design change such as this. Refer to the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#54-how-to-resize-the-partial-reconfiguration-region">How to Resize the Partial Reconfiguration Region</a> section for information regarding modifications to the floorplan.</p>
</li>
</ol>
<h3 id="512-how-to-modify-the-pfvf-mux-configuration"><strong>5.12 How to modify the PF/VF MUX configuration</strong><a class="headerlink" href="#512-how-to-modify-the-pfvf-mux-configuration" title="Permanent link">&para;</a></h3>
<p>The <strong>PF/VF Configuration Tool</strong> allows you to easily reconfigure the default number of PFs and VFs on both the SoC and Host side of your design. To modify the PF/VF configuration, you must:</p>
<ol>
<li>
<p>Decide which PCIe PF/VFs require modification.  If you are modifying host side PF/VF configuration, you must edit file <code>pcie_host.ofss</code> file found in <code>$OFS_ROOTDIR/tools/pfvf_config_tool</code>.  If you want to modify SoC-side PF/VF configuration, edit the <code>pcie_soc.ofss</code> file found in the same location.  </p>
<p>The code given below show the default Host *.ofss file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a><span class="o">[</span>ProjectSettings<span class="o">]</span>
<a id="__codelineno-168-2" name="__codelineno-168-2" href="#__codelineno-168-2"></a><span class="nv">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f2000x<span class="w"> </span>
<a id="__codelineno-168-3" name="__codelineno-168-3" href="#__codelineno-168-3"></a><span class="nv">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Agilex
<a id="__codelineno-168-4" name="__codelineno-168-4" href="#__codelineno-168-4"></a><span class="nv">fim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>base_x16
<a id="__codelineno-168-5" name="__codelineno-168-5" href="#__codelineno-168-5"></a><span class="nv">Part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>AGFC023R25A2E2VR0
<a id="__codelineno-168-6" name="__codelineno-168-6" href="#__codelineno-168-6"></a><span class="nv">IpDeployFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss.sh
<a id="__codelineno-168-7" name="__codelineno-168-7" href="#__codelineno-168-7"></a><span class="nv">IpFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss.ip
<a id="__codelineno-168-8" name="__codelineno-168-8" href="#__codelineno-168-8"></a><span class="nv">OutputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss
<a id="__codelineno-168-9" name="__codelineno-168-9" href="#__codelineno-168-9"></a><span class="nv">ComponentName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss
<a id="__codelineno-168-10" name="__codelineno-168-10" href="#__codelineno-168-10"></a><span class="nv">is_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
<a id="__codelineno-168-11" name="__codelineno-168-11" href="#__codelineno-168-11"></a>
<a id="__codelineno-168-12" name="__codelineno-168-12" href="#__codelineno-168-12"></a><span class="o">[</span>pf0<span class="o">]</span>
<a id="__codelineno-168-13" name="__codelineno-168-13" href="#__codelineno-168-13"></a>
<a id="__codelineno-168-14" name="__codelineno-168-14" href="#__codelineno-168-14"></a><span class="o">[</span>pf1<span class="o">]</span>
</code></pre></div>
<p>This default configuration is made up of two physical functions (PF), and neither of them has any virtual functions (VF). </p>
</li>
<li>
<p>Modify the OFSS file with the new PF/VF configuration.</p>
<p>An example modification to the OFSS file is shown below.  In this example we have changed the configuration to: 6 PFs in total, 4 VFs in PF0, 1 VF in PF2, and 2 VFs on PF3.  You can add up to 8 PFs and could conceivably add up to the number of VFs supported by the PCIe IP. Note that more PFs/VFs will use more FPGA resources, which may cause fitter challenges.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a><span class="o">[</span>ProjectSettings<span class="o">]</span>
<a id="__codelineno-169-2" name="__codelineno-169-2" href="#__codelineno-169-2"></a><span class="nv">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f2000x<span class="w"> </span>
<a id="__codelineno-169-3" name="__codelineno-169-3" href="#__codelineno-169-3"></a><span class="nv">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Agilex
<a id="__codelineno-169-4" name="__codelineno-169-4" href="#__codelineno-169-4"></a><span class="nv">fim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>base_x16
<a id="__codelineno-169-5" name="__codelineno-169-5" href="#__codelineno-169-5"></a><span class="nv">Part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>AGFC023R25A2E2VR0
<a id="__codelineno-169-6" name="__codelineno-169-6" href="#__codelineno-169-6"></a><span class="nv">IpDeployFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss.sh
<a id="__codelineno-169-7" name="__codelineno-169-7" href="#__codelineno-169-7"></a><span class="nv">IpFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss.ip
<a id="__codelineno-169-8" name="__codelineno-169-8" href="#__codelineno-169-8"></a><span class="nv">OutputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss
<a id="__codelineno-169-9" name="__codelineno-169-9" href="#__codelineno-169-9"></a><span class="nv">ComponentName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss
<a id="__codelineno-169-10" name="__codelineno-169-10" href="#__codelineno-169-10"></a><span class="nv">is_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
<a id="__codelineno-169-11" name="__codelineno-169-11" href="#__codelineno-169-11"></a>
<a id="__codelineno-169-12" name="__codelineno-169-12" href="#__codelineno-169-12"></a><span class="o">[</span>pf0<span class="o">]</span>
<a id="__codelineno-169-13" name="__codelineno-169-13" href="#__codelineno-169-13"></a><span class="nv">num_vfs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span>
<a id="__codelineno-169-14" name="__codelineno-169-14" href="#__codelineno-169-14"></a>
<a id="__codelineno-169-15" name="__codelineno-169-15" href="#__codelineno-169-15"></a><span class="o">[</span>pf1<span class="o">]</span>
<a id="__codelineno-169-16" name="__codelineno-169-16" href="#__codelineno-169-16"></a>
<a id="__codelineno-169-17" name="__codelineno-169-17" href="#__codelineno-169-17"></a><span class="o">[</span>pf2<span class="o">]</span>
<a id="__codelineno-169-18" name="__codelineno-169-18" href="#__codelineno-169-18"></a><span class="nv">num_vfs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-169-19" name="__codelineno-169-19" href="#__codelineno-169-19"></a>
<a id="__codelineno-169-20" name="__codelineno-169-20" href="#__codelineno-169-20"></a><span class="o">[</span>pf3<span class="o">]</span>
<a id="__codelineno-169-21" name="__codelineno-169-21" href="#__codelineno-169-21"></a><span class="nv">num_vfs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<a id="__codelineno-169-22" name="__codelineno-169-22" href="#__codelineno-169-22"></a>
<a id="__codelineno-169-23" name="__codelineno-169-23" href="#__codelineno-169-23"></a><span class="o">[</span>pf4<span class="o">]</span>
<a id="__codelineno-169-24" name="__codelineno-169-24" href="#__codelineno-169-24"></a>
<a id="__codelineno-169-25" name="__codelineno-169-25" href="#__codelineno-169-25"></a><span class="o">[</span>pf5<span class="o">]</span>
</code></pre></div>
</li>
<li>
<p>Run the <code>gen_ofs_settings.py</code> script found in <code>$OFS_ROOTDIR/ofs-fim-common/tools/pfvf_config_tool</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a>./gen_ofs_settings.py<span class="w">  </span>--ini<span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/tools/pfvf_config_tool/&lt;PCIE_SOURCE&gt;.ofss<span class="w"> </span>--platform<span class="w"> </span>&lt;PLATFORM&gt;
</code></pre></div>
<p>For example, execute the following command to generate Host settings in an f2000x design:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a>./gen_ofs_settings.py<span class="w">  </span>--ini<span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/tools/pfvf_config_tool/pcie_host.ofss<span class="w"> </span>--platform<span class="w"> </span>f2000x
</code></pre></div>
<p>This script reconfigures the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> by:</p>
<ol>
<li>Updating the PF/VF Mux Package APIs:<ul>
<li>$OFS_ROOTDIR/src/afu_top/mux/top_cfg_pkg.sv</li>
</ul>
</li>
<li>Adding/removing <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> endpoints<ul>
<li>PF0 VFs - afu_main.port_afu_instances</li>
<li>All other functions: afu_top.fim_afu_instances</li>
<li>New AFUs will be instantiated as HE-NULL (he_null.sv) AFUs</li>
</ul>
</li>
<li>Updating the pcie_ss.sh "ip-deploy" file<ul>
<li>Generating the new pcie_ss.ip file ($OFS_ROOTDOR/ipss/pcie/ss/pcie_ss.ip)</li>
<li>Adding scratch register reads/writes to sim/csr_test for added functions</li>
<li>Updating the simulation filelists ($OFS_ROOTDIR/sim/common/pfvf_sim_pkg.sv)</li>
</ul>
</li>
</ol>
<p>If the port gasket is enabled in the OFSS file, all functions in the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region must be a virtual function (VF) on physical function 0 (PF0) and are routed to Port <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Instances (port_afu_instances.sv) in the port gasket.  You can enable the port gasket in the ini (*.ofss file) by adding <code>pg_enable = True</code> under the <code>num_vfs</code> in PF0. In the 2023.1 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> SoC Attach Release for Intel IPU Platform F2000X-PL the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region is in the SoC <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, so the SoC OFSS file has the port gasket enabled by default:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a><span class="o">[</span>ProjectSettings<span class="o">]</span>
<a id="__codelineno-172-2" name="__codelineno-172-2" href="#__codelineno-172-2"></a><span class="nv">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f2000x<span class="w"> </span>
<a id="__codelineno-172-3" name="__codelineno-172-3" href="#__codelineno-172-3"></a><span class="nv">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Agilex
<a id="__codelineno-172-4" name="__codelineno-172-4" href="#__codelineno-172-4"></a><span class="nv">fim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>base_x16
<a id="__codelineno-172-5" name="__codelineno-172-5" href="#__codelineno-172-5"></a><span class="nv">Part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>AGFC023R25A2E2VR0
<a id="__codelineno-172-6" name="__codelineno-172-6" href="#__codelineno-172-6"></a><span class="nv">IpDeployFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss.sh
<a id="__codelineno-172-7" name="__codelineno-172-7" href="#__codelineno-172-7"></a><span class="nv">IpFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss.ip
<a id="__codelineno-172-8" name="__codelineno-172-8" href="#__codelineno-172-8"></a><span class="nv">OutputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss
<a id="__codelineno-172-9" name="__codelineno-172-9" href="#__codelineno-172-9"></a><span class="nv">ComponentName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss
<a id="__codelineno-172-10" name="__codelineno-172-10" href="#__codelineno-172-10"></a><span class="nv">is_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>False
<a id="__codelineno-172-11" name="__codelineno-172-11" href="#__codelineno-172-11"></a>
<a id="__codelineno-172-12" name="__codelineno-172-12" href="#__codelineno-172-12"></a><span class="o">[</span>pf0<span class="o">]</span>
<a id="__codelineno-172-13" name="__codelineno-172-13" href="#__codelineno-172-13"></a><span class="nv">pg_enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
<a id="__codelineno-172-14" name="__codelineno-172-14" href="#__codelineno-172-14"></a><span class="nv">num_vfs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>
</code></pre></div>
<p>If the port gasket is disabled, the virtual functions on PF0 are routed to <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Instances (fim_afu_instances.sv) in the static region.  All physical functions and virtual functions not on PF0 are routed to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Instances module (fim_afu_instances.sv) in afu_top.</p>
<p>After you run the <code>gen_ofs_settings.py</code> script you should see a final success report:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a><span class="m">2022</span>.07.28.21:46:38<span class="w"> </span>Info:<span class="w"> </span>Regenerate<span class="w"> </span>these<span class="w"> </span>scripts<span class="w"> </span>whenever<span class="w"> </span>you<span class="w"> </span>make<span class="w"> </span>any<span class="w"> </span>change<span class="w"> </span>to<span class="w"> </span>any<span class="w"> </span>Quartus-generated<span class="w"> </span>IP<span class="w"> </span><span class="k">in</span><span class="w"> </span>your<span class="w"> </span>project.
<a id="__codelineno-173-2" name="__codelineno-173-2" href="#__codelineno-173-2"></a><span class="m">2022</span>.07.28.21:46:38<span class="w"> </span>Info:<span class="w"> </span>Finished:<span class="w"> </span>Create<span class="w"> </span>simulation<span class="w"> </span>script
<a id="__codelineno-173-3" name="__codelineno-173-3" href="#__codelineno-173-3"></a>sh:<span class="w"> </span>/home/applications.fpga.ofs.rtl/env_not_shipped/f2000x/update_sim.sh:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory
<a id="__codelineno-173-4" name="__codelineno-173-4" href="#__codelineno-173-4"></a>Success!<span class="w">  </span>Thank<span class="w"> </span>you<span class="w"> </span><span class="k">for</span><span class="w"> </span>using<span class="w"> </span>the<span class="w"> </span>IP-Deploy<span class="w"> </span>Tool
</code></pre></div>
</li>
<li>
<p>Recompile the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> using the <code>build_top.sh</code> script described in the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#442-compiling-the-fim">Compiling the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></a> section of this guide. </p>
</li>
<li>
<p>Verify the correct functionality of new the PF/VF Mux configuration.</p>
<p>New PF/VF are seamlessly connected to their own CSR stub, which can be read at DFH Offset 0x0. You can bind to the function and perform <code>opae.io peek</code> commands to read from the stub CSR. Similarly, perform <code>opae.io poke</code> commands to write into the stub CSRs. Use this mechanism to verify that the new PF/VF Mux configuration allows to write and read back values from the stub CSRs. </p>
<p>The GUID for every new PF/VF CSR stub is the same.   </p>
<ul>
<li>NULL_GUID_L           = 64'haa31f54a3e403501</li>
<li>NULL_GUID_H           = 64'h3e7b60a0df2d4850</li>
</ul>
<blockquote>
<p><strong>Limitations:</strong> Setting 0 virtual functions on SoC PF0 is not supported. This is because the <strong><abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr></strong> region cannot be left unconnected. A loopback may need to be instantiated in this special case. </p>
</blockquote>
<p>Load the newly compiled <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> to the card to test the functionality of the new PF/VF functions. Use the following commands to verify the number of PFs/VFs created:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-174-1" name="__codelineno-174-1" href="#__codelineno-174-1"></a>sudo<span class="w"> </span>lspci<span class="w"> </span>-vvv<span class="w"> </span>-s<span class="w"> </span>b1:00.0<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>VF
</code></pre></div>
Example output:
<div class="highlight"><pre><span></span><code><a id="__codelineno-175-1" name="__codelineno-175-1" href="#__codelineno-175-1"></a>Initial<span class="w"> </span>VFs:<span class="w"> </span><span class="m">4</span>,<span class="w"> </span>Total<span class="w"> </span>VFs:<span class="w"> </span><span class="m">4</span>,<span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>VFs:<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>Function<span class="w"> </span>Dependency<span class="w"> </span>Link:<span class="w"> </span><span class="m">00</span>
<a id="__codelineno-175-2" name="__codelineno-175-2" href="#__codelineno-175-2"></a>VF<span class="w"> </span>offset:<span class="w"> </span><span class="m">6</span>,<span class="w"> </span>stride:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>Device<span class="w"> </span>ID:<span class="w"> </span>bccf<span class="w">               </span>
</code></pre></div></p>
<blockquote>
<p><strong>Note:</strong> The PCIe B:D.F associated with your board may be different. Use the <code>fpgainfo fme</code> command to see the PCIe B:D:F for your board.</p>
</blockquote>
</li>
</ol>
<h3 id="513-how-to-create-a-minimal-fim"><strong>5.13 How to Create a Minimal <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></strong><a class="headerlink" href="#513-how-to-create-a-minimal-fim" title="Permanent link">&para;</a></h3>
<p>In this example, the exercisers and Ethernet subsystem are removed and a new <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> area is used to make use of the added area from the removed components.  This minimal <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> is useful for HDL applications.</p>
<p>To create this minimal <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, perform the following steps:</p>
<ol>
<li>
<p>Change the PF/VF configuration to support only 1 PF with 1 VF. Edit the following files in the <code>$OFS_ROOTDIR/tools/pfvf_config_tool/</code> directory as shown below:</p>
<ol>
<li>
<p><code>$OFS_ROOTDIR/tools/pfvf_config_tool/pcie_host.ofss</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-176-1" name="__codelineno-176-1" href="#__codelineno-176-1"></a><span class="o">[</span>ProjectSettings<span class="o">]</span>
<a id="__codelineno-176-2" name="__codelineno-176-2" href="#__codelineno-176-2"></a><span class="nv">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f2000x<span class="w"> </span>
<a id="__codelineno-176-3" name="__codelineno-176-3" href="#__codelineno-176-3"></a><span class="nv">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Agilex
<a id="__codelineno-176-4" name="__codelineno-176-4" href="#__codelineno-176-4"></a><span class="nv">fim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>base_x16
<a id="__codelineno-176-5" name="__codelineno-176-5" href="#__codelineno-176-5"></a><span class="nv">Part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>AGFC023R25A2E2VR0
<a id="__codelineno-176-6" name="__codelineno-176-6" href="#__codelineno-176-6"></a><span class="nv">IpDeployFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss.sh
<a id="__codelineno-176-7" name="__codelineno-176-7" href="#__codelineno-176-7"></a><span class="nv">IpFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss.ip
<a id="__codelineno-176-8" name="__codelineno-176-8" href="#__codelineno-176-8"></a><span class="nv">OutputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss
<a id="__codelineno-176-9" name="__codelineno-176-9" href="#__codelineno-176-9"></a><span class="nv">ComponentName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss
<a id="__codelineno-176-10" name="__codelineno-176-10" href="#__codelineno-176-10"></a><span class="nv">is_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
<a id="__codelineno-176-11" name="__codelineno-176-11" href="#__codelineno-176-11"></a>
<a id="__codelineno-176-12" name="__codelineno-176-12" href="#__codelineno-176-12"></a><span class="o">[</span>pf0<span class="o">]</span>
</code></pre></div>
</li>
<li>
<p><code>$OFS_ROOTDIR/tools/pfvf_config_tool/pcie_soc.ofss</code> </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-177-1" name="__codelineno-177-1" href="#__codelineno-177-1"></a><span class="o">[</span>ProjectSettings<span class="o">]</span>
<a id="__codelineno-177-2" name="__codelineno-177-2" href="#__codelineno-177-2"></a><span class="nv">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f2000x<span class="w"> </span>
<a id="__codelineno-177-3" name="__codelineno-177-3" href="#__codelineno-177-3"></a><span class="nv">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Agilex
<a id="__codelineno-177-4" name="__codelineno-177-4" href="#__codelineno-177-4"></a><span class="nv">fim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>base_x16
<a id="__codelineno-177-5" name="__codelineno-177-5" href="#__codelineno-177-5"></a><span class="nv">Part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>AGFC023R25A2E2VR0
<a id="__codelineno-177-6" name="__codelineno-177-6" href="#__codelineno-177-6"></a><span class="nv">IpDeployFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss.sh
<a id="__codelineno-177-7" name="__codelineno-177-7" href="#__codelineno-177-7"></a><span class="nv">IpFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss.ip
<a id="__codelineno-177-8" name="__codelineno-177-8" href="#__codelineno-177-8"></a><span class="nv">OutputName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>soc_pcie_ss
<a id="__codelineno-177-9" name="__codelineno-177-9" href="#__codelineno-177-9"></a><span class="nv">ComponentName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pcie_ss
<a id="__codelineno-177-10" name="__codelineno-177-10" href="#__codelineno-177-10"></a><span class="nv">is_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>False
<a id="__codelineno-177-11" name="__codelineno-177-11" href="#__codelineno-177-11"></a>
<a id="__codelineno-177-12" name="__codelineno-177-12" href="#__codelineno-177-12"></a><span class="o">[</span>pf0<span class="o">]</span>
<a id="__codelineno-177-13" name="__codelineno-177-13" href="#__codelineno-177-13"></a><span class="nv">num_vfs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-177-14" name="__codelineno-177-14" href="#__codelineno-177-14"></a><span class="nv">pg_enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Save the modified ofs_dev.ofss file and build a new configuration.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-178-1" name="__codelineno-178-1" href="#__codelineno-178-1"></a>python3<span class="w"> </span>gen_ofs_settings.py<span class="w"> </span>--ini<span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/tools/pfvf_config_tool/pcie_host.ofss<span class="w"> </span>--platform<span class="w"> </span>f2000x
<a id="__codelineno-178-2" name="__codelineno-178-2" href="#__codelineno-178-2"></a>
<a id="__codelineno-178-3" name="__codelineno-178-3" href="#__codelineno-178-3"></a>python3<span class="w"> </span>gen_ofs_settings.py<span class="w"> </span>--ini<span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/tools/pfvf_config_tool/pcie_soc.ofss<span class="w"> </span>--platform<span class="w"> </span>f2000x
</code></pre></div>
</li>
<li>
<p>Compile the new <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> with exercisers removed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-179-1" name="__codelineno-179-1" href="#__codelineno-179-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-179-2" name="__codelineno-179-2" href="#__codelineno-179-2"></a>./ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>-p<span class="w"> </span>f2000x:null_he,null_he_lp,null_he_hssi,null_he_mem,null_he_mem_tg,no_hssi<span class="w"> </span>work_null_he_no_hssi
</code></pre></div>
</li>
<li>
<p>The build will complete with reduced resources as compared to the base version. You may review the floorplan in Quartus Chip Planner and modify the Logic Lock regions to allocate more resources to the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region if desired. Refer to the <a href="https://ofs.github.io/hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/#54-how-to-resize-the-partial-reconfiguration-region">How to Resize the Partial Reconfiguration Region</a> section for information regarding modifications to the floorplan. </p>
</li>
</ol>
<h2 id="6-single-event-upset-reporting"><strong>6 Single Event Upset Reporting</strong><a class="headerlink" href="#6-single-event-upset-reporting" title="Permanent link">&para;</a></h2>
<p>A Single Event Upset (SEU) is the change in state of a storage element inside a device or system. They are caused by ionizing radiation strikes that discharge the charge in storage elements, such as configuration memory cells, user memory and registers.</p>
<p>Error Detection CRC (EDCRC) circuitry in the Card <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> is used to detect SEU errors. The CRC function is enabled in Intel Quartus Prime Pro to enable CRC status to be reported to the FM61 via the dedicated CRC_ERROR pin.</p>
<p>With the EDCRC there is no method to determine the severity of an SEU error i.e. there is not way to distinguish between non-critical and catastrophic errors. Hence once the SEU error is detected, the Host system must initiate the Card <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> reset procedure.</p>
<p>SEU errors can be read from either the Card <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> SEU Status Register or the PMCI Subsystem SEU Error Indication Register. The processes to read these registers are described in greater detail in the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> User Guide. Contact your Intel representative for access to the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> User Guide.</p>
<p>Additionally, refer to the <a href="https://www.intel.com/content/www/us/en/docs/programmable/683128/23-1/seu-mitigation-overview.html">Intel Agilex SEU Mitigation User Guide</a> for more information on SEU detection and mitigation.</p>
<h2 id="notices-disclaimers">Notices &amp; Disclaimers<a class="headerlink" href="#notices-disclaimers" title="Permanent link">&para;</a></h2>
<p>Intel<sup>&reg;</sup> technologies may require enabled hardware, software or service activation.
No product or component can be absolutely secure. 
Performance varies by use, configuration and other factors.
Your costs and results may vary. 
You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Intel products described herein. You agree to grant Intel a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.
No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document, with the sole exception that you may publish an unmodified copy. You may create software implementations based on this document and in compliance with the foregoing that are intended to execute on the Intel product(s) referenced in this document. No rights are granted to create modifications or derivatives of this document.
The products described may contain design defects or errors known as errata which may cause the product to deviate from published specifications.  Current characterized errata are available on request.
Intel disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.
You are responsible for safety of the overall system, including compliance with applicable safety-related requirements or standards. 
<sup>&copy;</sup> Intel Corporation.  Intel, the Intel logo, and other Intel marks are trademarks of Intel Corporation or its subsidiaries.  Other names and brands may be claimed as the property of others. </p>
<p>OpenCL and the OpenCL logo are trademarks of Apple Inc. used by permission of the Khronos Group™.   </p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.copy", "navigation.indexes", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>