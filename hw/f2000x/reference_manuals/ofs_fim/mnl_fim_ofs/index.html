
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/">
      
      
        <link rel="next" href="../../../dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/">
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>FPGA Interface Manager Technical Reference Manual - OFS</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fpga-interface-manager-technical-reference-manual-for-intel-agilex-soc-attach-open-fpga-stack" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="OFS" class="md-header__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OFS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FPGA Interface Manager Technical Reference Manual
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-tabs__link">
        Stratix 10 PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../n6001/user_guides/ug_eval_ofs_n6001/ug_eval_script_ofs_n6001/" class="md-tabs__link">
        Agilex PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-tabs__link md-tabs__link--active">
        Agilex SoC Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../common/user_guides/oneapi_asp/ug_oneapi_asp/" class="md-tabs__link">
        oneAPI
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../sw/fpga_api/quick_start/readme/" class="md-tabs__link">
        OFS Software
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="OFS" class="md-nav__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OFS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Stratix 10 PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Stratix 10 PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/dev_guides/fim_dev/ug_dev_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/dev_guides/afu_dev/ug_dev_afu_d5005/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_sim_ofs_d5005/ug_sim_ofs_d5005/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Agilex PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Agilex PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/user_guides/ug_eval_ofs_n6001/ug_eval_script_ofs_n6001/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/reference_manuals/ofs_fim/mnl_fim_ofs_n6001/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/dev_guides/afu_dev/ug_dev_afu_ofs_n6001/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/dev_guides/hps_dev/hps_developer_ug/" class="md-nav__link">
        HPS Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/user_guides/ug_sim_ofs_n6001/ug_sim_ofs_n6001/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Agilex SoC Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Agilex SoC Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_qs_ofs_f2000x/ug_qs_ofs_f2000x/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          FPGA Interface Manager Technical Reference Manual
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        FPGA Interface Manager Technical Reference Manual
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-overview" class="md-nav__link">
    1 Overview
  </a>
  
    <nav class="md-nav" aria-label="1 Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-about-this-document" class="md-nav__link">
    1.1 About this Document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-glossary" class="md-nav__link">
    1.2 Glossary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-introduction-to-open-fpga-stack" class="md-nav__link">
    1.3 Introduction to Open FPGA Stack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-ofs-features" class="md-nav__link">
    1.4 OFS Features
  </a>
  
    <nav class="md-nav" aria-label="1.4 OFS Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-fpga-interface-manager-fim" class="md-nav__link">
    1.4.1 FPGA Interface Manager (FIM)
  </a>
  
    <nav class="md-nav" aria-label="1.4.1 FPGA Interface Manager (FIM)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#subsystem-interfaces" class="md-nav__link">
    Subsystem Interfaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fpga-management-engine-fme" class="md-nav__link">
    FPGA Management Engine (FME)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-datapath" class="md-nav__link">
    Streaming Datapath
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtualization" class="md-nav__link">
    Virtualization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-afu" class="md-nav__link">
    1.4.2 AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-platform-interface-manager" class="md-nav__link">
    1.4.3 Platform Interface Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#144-platform-feature-discovery" class="md-nav__link">
    1.4.4 Platform Feature Discovery
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#145-ofs-reference-design" class="md-nav__link">
    1.4.5 OFS Reference Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#146-fim-simulation" class="md-nav__link">
    1.4.6 FIM Simulation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-ofs-high-level-architecture" class="md-nav__link">
    2 OFS High Level Architecture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-pcie-subsystem" class="md-nav__link">
    3 PCIe Subsystem
  </a>
  
    <nav class="md-nav" aria-label="3 PCIe Subsystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-pcie-subsystem-header-format" class="md-nav__link">
    3.1 PCIe Subsystem Header Format
  </a>
  
    <nav class="md-nav" aria-label="3.1 PCIe Subsystem Header Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#311-power-user-header-format" class="md-nav__link">
    3.1.1 Power User Header Format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#312-data-mover-header-format" class="md-nav__link">
    3.1.2 Data Mover Header Format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-pcie-subsystem-interface-module" class="md-nav__link">
    3.2 PCIe Subsystem Interface Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-data-mover-request-cycles" class="md-nav__link">
    3.3 Data Mover Request Cycles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-data-mover-completion-cycles" class="md-nav__link">
    3.4 Data Mover Completion Cycles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-platform-interface-manager" class="md-nav__link">
    4 Platform Interface Manager
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-interconnect-fabric" class="md-nav__link">
    5 Interconnect Fabric
  </a>
  
    <nav class="md-nav" aria-label="5 Interconnect Fabric">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-afu-peripheral-fabric-apf" class="md-nav__link">
    5.1 AFU Peripheral Fabric (APF)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-board-peripheral-fabric-bpf" class="md-nav__link">
    5.2 Board Peripheral Fabric (BPF)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-arm-amba-4-axi4-stream-pfvf-muxdemux" class="md-nav__link">
    5.3 Arm® AMBA® 4 AXI4-Stream PF/VF Mux/Demux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-afu-interface-handler" class="md-nav__link">
    5.4 AFU Interface Handler
  </a>
  
    <nav class="md-nav" aria-label="5.4 AFU Interface Handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#541-unified-tag-remapping" class="md-nav__link">
    5.4.1 Unified Tag Remapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#542-afu-error-handling" class="md-nav__link">
    5.4.2 AFU Error Handling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-tlp-to-arm-amba-4-axi4-lite-memory-mapped-bridge-st2mm" class="md-nav__link">
    5.5 TLP to Arm® AMBA® 4 AXI4-Lite Memory Mapped Bridge (ST2MM)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-mmio-regions" class="md-nav__link">
    6 MMIO Regions
  </a>
  
    <nav class="md-nav" aria-label="6 MMIO Regions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-feature-region" class="md-nav__link">
    6.1 Feature Region
  </a>
  
    <nav class="md-nav" aria-label="6.1 Feature Region">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#611-device-feature-header-dfh-structure" class="md-nav__link">
    6.1.1 Device Feature Header (DFH) Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#621-software-access-to-registers" class="md-nav__link">
    6.2.1 Software Access to Registers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-register-attribute-definition" class="md-nav__link">
    6.2 Register Attribute Definition
  </a>
  
    <nav class="md-nav" aria-label="6.2 Register Attribute Definition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#623-csr-offset-in-bars" class="md-nav__link">
    6.2.3 CSR Offset in BARs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-clocks" class="md-nav__link">
    7 Clocks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-reset" class="md-nav__link">
    8 Reset
  </a>
  
    <nav class="md-nav" aria-label="8 Reset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-reset-signals" class="md-nav__link">
    8.1 Reset Signals
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-interrupts" class="md-nav__link">
    9 Interrupts
  </a>
  
    <nav class="md-nav" aria-label="9 Interrupts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-msi-x" class="md-nav__link">
    9.1 MSI-X
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-msi-x-entry-table" class="md-nav__link">
    9.2 MSI-X Entry Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-msi-x-pba-table" class="md-nav__link">
    9.3 MSI-X PBA Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94-interrupts-supported" class="md-nav__link">
    9.4 Interrupts Supported
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#95-msi-x-table-locations" class="md-nav__link">
    9.5 MSI-X Table Locations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-external-memory-interface-emif" class="md-nav__link">
    10 External Memory Interface (EMIF)
  </a>
  
    <nav class="md-nav" aria-label="10 External Memory Interface (EMIF)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-emif-csr" class="md-nav__link">
    10.1 EMIF CSR
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-ethernet-interface-subsystem" class="md-nav__link">
    11 Ethernet Interface Subsystem
  </a>
  
    <nav class="md-nav" aria-label="11 Ethernet Interface Subsystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-ethernet-interface-overview" class="md-nav__link">
    11.1 Ethernet Interface Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112-ofs-ethernet-subsystem-interface-module" class="md-nav__link">
    11.2 OFS  Ethernet Subsystem Interface Module
  </a>
  
    <nav class="md-nav" aria-label="11.2 OFS  Ethernet Subsystem Interface Module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1121-ethernet-subsystem-control-and-status-register-csr-map" class="md-nav__link">
    11.2.1 Ethernet Subsystem Control and Status Register (CSR) Map
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-ethernet-subsytem-software" class="md-nav__link">
    11.4 Ethernet Subsytem Software
  </a>
  
    <nav class="md-nav" aria-label="11.4 Ethernet Subsytem Software">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1141-ethernet-subsystem-linux-driver" class="md-nav__link">
    11.4.1 Ethernet Subsystem Linux Driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1142-ethernet-subsystem-opae-user-space-tool" class="md-nav__link">
    11.4.2 Ethernet Subsystem OPAE User Space Tool
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-partial-reconfiguration" class="md-nav__link">
    12 Partial Reconfiguration
  </a>
  
    <nav class="md-nav" aria-label="12 Partial Reconfiguration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-user-clock-support" class="md-nav__link">
    12.1 User Clock Support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-host-exercisers" class="md-nav__link">
    13 Host Exercisers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#131-he-lb-and-he-mem-host-exerciser" class="md-nav__link">
    13.1 HE-LB and HE-MEM Host Exerciser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-memory-traffic-generator-he-mem-tg" class="md-nav__link">
    13.2 Memory Traffic Generator  (HE-MEM-TG)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-hssi-host-exerciser-he-hssi" class="md-nav__link">
    13.2 HSSI Host Exerciser (HE-HSSI)
  </a>
  
    <nav class="md-nav" aria-label="13.2 HSSI Host Exerciser (HE-HSSI)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1322-he-hssi-csr-map" class="md-nav__link">
    13.2.2 HE-HSSI CSR Map
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-he-null-overview" class="md-nav__link">
    13.3 HE-Null Overview
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-reliability-accessibility-serviceability-ras-and-error-handling" class="md-nav__link">
    14 Reliability, Accessibility, Serviceability (RAS) and Error Handling
  </a>
  
    <nav class="md-nav" aria-label="14 Reliability, Accessibility, Serviceability (RAS) and Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-fme-errors" class="md-nav__link">
    14.1 FME Errors
  </a>
  
    <nav class="md-nav" aria-label="14.1 FME Errors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1411-fme_error0" class="md-nav__link">
    14.1.1 FME_ERROR0
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1412-pcie0_error" class="md-nav__link">
    14.1.2 PCIE0_ERROR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1413-fme_first_error-fme_next_error" class="md-nav__link">
    14.1.3 FME_FIRST_ERROR, FME_NEXT_ERROR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1414-reliability-accessibility-serviceability-ras-error-status" class="md-nav__link">
    14.1.4 Reliability, Accessibility, Serviceability (RAS) Error Status
  </a>
  
    <nav class="md-nav" aria-label="14.1.4 Reliability, Accessibility, Serviceability (RAS) Error Status">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#14141-non-fatal-errors" class="md-nav__link">
    14.1.4.1 Non-Fatal Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14142-catastrophic-fatal-errors" class="md-nav__link">
    14.1.4.2 Catastrophic &amp; Fatal Errors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1415-ras-error-injection" class="md-nav__link">
    14.1.5 RAS Error Injection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1416-fme-error-interrupts" class="md-nav__link">
    14.1.6 FME Error Interrupts
  </a>
  
    <nav class="md-nav" aria-label="14.1.6 FME Error Interrupts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#14161-msi-x-masking-pending-bit-array-pba-clearing" class="md-nav__link">
    14.1.6.1 MSI-X Masking &amp; Pending Bit Array (PBA) Clearing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1417-fme-error-handling" class="md-nav__link">
    14.1.7 FME Error Handling
  </a>
  
    <nav class="md-nav" aria-label="14.1.7 FME Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#14171-catastrophicfatal-error" class="md-nav__link">
    14.1.7.1 Catastrophic/Fatal Error
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14172-non-fatal-error" class="md-nav__link">
    14.1.7.2 Non-Fatal Error
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-mmio-requests" class="md-nav__link">
    14.3 MMIO Requests
  </a>
  
    <nav class="md-nav" aria-label="14.3 MMIO Requests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1431-unsupported-functions-and-bar" class="md-nav__link">
    14.3.1 Unsupported Functions and BAR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1432-mmio-request-decoding" class="md-nav__link">
    14.3.2 MMIO Request Decoding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1433-unused-fmeport-csr-regions" class="md-nav__link">
    14.3.3 Unused FME/Port CSR Regions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1434-unsupported-mmio-request" class="md-nav__link">
    14.3.4 Unsupported MMIO Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1435-afu-access-violation" class="md-nav__link">
    14.3.5 AFU Access Violation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1436-afu-mmio-response-timeout" class="md-nav__link">
    14.3.6 AFU MMIO Response Timeout
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15-ofs-design-hierarchy" class="md-nav__link">
    15 OFS Design Hierarchy
  </a>
  
    <nav class="md-nav" aria-label="15 OFS Design Hierarchy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#151-design-guidance" class="md-nav__link">
    15.1 Design Guidance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../dev_guides/afu_dev/ug_dev_afu_ofs_f2000x/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_sim_ofs/ug_sim_ofs/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          oneAPI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          oneAPI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/oneapi_asp/ug_oneapi_asp/" class="md-nav__link">
        oneAPI ASP Getting Started User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/oneapi_asp/oneapi_asp_ref_mnl/" class="md-nav__link">
        oneAPI Accelerator Support Package(ASP) Reference Manual
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          OFS Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          OFS Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
          OPAE USER GUIDES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          OPAE USER GUIDES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/quick_start/readme/" class="md-nav__link">
        Quick Start Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/install_guide/installation_guide/" class="md-nav__link">
        OPAE Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/prog_guide/readme/" class="md-nav__link">
        OPAE C API Programming Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/pyopae/python_bindings/" class="md-nav__link">
        OPAE Python Bindings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/plug_guide/readme/" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          OPAE LIBRARIES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          OPAE LIBRARIES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/fpga_api/" class="md-nav__link">
        OPAE C API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/fpga_cxx_api/" class="md-nav__link">
        OPAE C++ Core API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/fpga_python_api/" class="md-nav__link">
        OPAE Python API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/plug_guide/readme/" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
          OPAE LINUX KERNEL DRIVERS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          OPAE LINUX KERNEL DRIVERS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/drv_arch/drv_arch/" class="md-nav__link">
        Open Programmable Accelerator Engine (OPAE) Linux Device Driver Architecture
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../sw/fpga_tools/fpgadiag/">OPAE FPGA TOOLS</a>
          
            <label for="__nav_6_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          OPAE FPGA TOOLS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgaconf/fpgaconf/" class="md-nav__link">
        fpgaconf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgainfo/fpgainfo/" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgasupdate/fpgasupdate/" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mmlink/mmlink/" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/packager/packager/" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/userclk/userclk/" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi/hssi/" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/pci_device/pci_device/" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opae.io/opae.io/" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/rsu/rsu/" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/host_exerciser/host_exerciser/" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssistats/" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssiloopback/" class="md-nav__link">
        HSSI ethernet loopback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mem_tg/mem_tg/" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/vabtool/vabtool/" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaevfio/opaevfio/" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/ofs.uio/ofs.uio/" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaeuio/opaeuio/" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgad/fpgad/" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-overview" class="md-nav__link">
    1 Overview
  </a>
  
    <nav class="md-nav" aria-label="1 Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-about-this-document" class="md-nav__link">
    1.1 About this Document
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-glossary" class="md-nav__link">
    1.2 Glossary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-introduction-to-open-fpga-stack" class="md-nav__link">
    1.3 Introduction to Open FPGA Stack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-ofs-features" class="md-nav__link">
    1.4 OFS Features
  </a>
  
    <nav class="md-nav" aria-label="1.4 OFS Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-fpga-interface-manager-fim" class="md-nav__link">
    1.4.1 FPGA Interface Manager (FIM)
  </a>
  
    <nav class="md-nav" aria-label="1.4.1 FPGA Interface Manager (FIM)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#subsystem-interfaces" class="md-nav__link">
    Subsystem Interfaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fpga-management-engine-fme" class="md-nav__link">
    FPGA Management Engine (FME)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-datapath" class="md-nav__link">
    Streaming Datapath
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtualization" class="md-nav__link">
    Virtualization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#142-afu" class="md-nav__link">
    1.4.2 AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-platform-interface-manager" class="md-nav__link">
    1.4.3 Platform Interface Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#144-platform-feature-discovery" class="md-nav__link">
    1.4.4 Platform Feature Discovery
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#145-ofs-reference-design" class="md-nav__link">
    1.4.5 OFS Reference Design
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#146-fim-simulation" class="md-nav__link">
    1.4.6 FIM Simulation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-ofs-high-level-architecture" class="md-nav__link">
    2 OFS High Level Architecture
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-pcie-subsystem" class="md-nav__link">
    3 PCIe Subsystem
  </a>
  
    <nav class="md-nav" aria-label="3 PCIe Subsystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-pcie-subsystem-header-format" class="md-nav__link">
    3.1 PCIe Subsystem Header Format
  </a>
  
    <nav class="md-nav" aria-label="3.1 PCIe Subsystem Header Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#311-power-user-header-format" class="md-nav__link">
    3.1.1 Power User Header Format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#312-data-mover-header-format" class="md-nav__link">
    3.1.2 Data Mover Header Format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-pcie-subsystem-interface-module" class="md-nav__link">
    3.2 PCIe Subsystem Interface Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-data-mover-request-cycles" class="md-nav__link">
    3.3 Data Mover Request Cycles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-data-mover-completion-cycles" class="md-nav__link">
    3.4 Data Mover Completion Cycles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-platform-interface-manager" class="md-nav__link">
    4 Platform Interface Manager
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-interconnect-fabric" class="md-nav__link">
    5 Interconnect Fabric
  </a>
  
    <nav class="md-nav" aria-label="5 Interconnect Fabric">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-afu-peripheral-fabric-apf" class="md-nav__link">
    5.1 AFU Peripheral Fabric (APF)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-board-peripheral-fabric-bpf" class="md-nav__link">
    5.2 Board Peripheral Fabric (BPF)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-arm-amba-4-axi4-stream-pfvf-muxdemux" class="md-nav__link">
    5.3 Arm® AMBA® 4 AXI4-Stream PF/VF Mux/Demux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-afu-interface-handler" class="md-nav__link">
    5.4 AFU Interface Handler
  </a>
  
    <nav class="md-nav" aria-label="5.4 AFU Interface Handler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#541-unified-tag-remapping" class="md-nav__link">
    5.4.1 Unified Tag Remapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#542-afu-error-handling" class="md-nav__link">
    5.4.2 AFU Error Handling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-tlp-to-arm-amba-4-axi4-lite-memory-mapped-bridge-st2mm" class="md-nav__link">
    5.5 TLP to Arm® AMBA® 4 AXI4-Lite Memory Mapped Bridge (ST2MM)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-mmio-regions" class="md-nav__link">
    6 MMIO Regions
  </a>
  
    <nav class="md-nav" aria-label="6 MMIO Regions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-feature-region" class="md-nav__link">
    6.1 Feature Region
  </a>
  
    <nav class="md-nav" aria-label="6.1 Feature Region">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#611-device-feature-header-dfh-structure" class="md-nav__link">
    6.1.1 Device Feature Header (DFH) Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#621-software-access-to-registers" class="md-nav__link">
    6.2.1 Software Access to Registers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-register-attribute-definition" class="md-nav__link">
    6.2 Register Attribute Definition
  </a>
  
    <nav class="md-nav" aria-label="6.2 Register Attribute Definition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#623-csr-offset-in-bars" class="md-nav__link">
    6.2.3 CSR Offset in BARs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-clocks" class="md-nav__link">
    7 Clocks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-reset" class="md-nav__link">
    8 Reset
  </a>
  
    <nav class="md-nav" aria-label="8 Reset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-reset-signals" class="md-nav__link">
    8.1 Reset Signals
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-interrupts" class="md-nav__link">
    9 Interrupts
  </a>
  
    <nav class="md-nav" aria-label="9 Interrupts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-msi-x" class="md-nav__link">
    9.1 MSI-X
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-msi-x-entry-table" class="md-nav__link">
    9.2 MSI-X Entry Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-msi-x-pba-table" class="md-nav__link">
    9.3 MSI-X PBA Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94-interrupts-supported" class="md-nav__link">
    9.4 Interrupts Supported
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#95-msi-x-table-locations" class="md-nav__link">
    9.5 MSI-X Table Locations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-external-memory-interface-emif" class="md-nav__link">
    10 External Memory Interface (EMIF)
  </a>
  
    <nav class="md-nav" aria-label="10 External Memory Interface (EMIF)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-emif-csr" class="md-nav__link">
    10.1 EMIF CSR
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-ethernet-interface-subsystem" class="md-nav__link">
    11 Ethernet Interface Subsystem
  </a>
  
    <nav class="md-nav" aria-label="11 Ethernet Interface Subsystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-ethernet-interface-overview" class="md-nav__link">
    11.1 Ethernet Interface Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112-ofs-ethernet-subsystem-interface-module" class="md-nav__link">
    11.2 OFS  Ethernet Subsystem Interface Module
  </a>
  
    <nav class="md-nav" aria-label="11.2 OFS  Ethernet Subsystem Interface Module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1121-ethernet-subsystem-control-and-status-register-csr-map" class="md-nav__link">
    11.2.1 Ethernet Subsystem Control and Status Register (CSR) Map
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-ethernet-subsytem-software" class="md-nav__link">
    11.4 Ethernet Subsytem Software
  </a>
  
    <nav class="md-nav" aria-label="11.4 Ethernet Subsytem Software">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1141-ethernet-subsystem-linux-driver" class="md-nav__link">
    11.4.1 Ethernet Subsystem Linux Driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1142-ethernet-subsystem-opae-user-space-tool" class="md-nav__link">
    11.4.2 Ethernet Subsystem OPAE User Space Tool
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-partial-reconfiguration" class="md-nav__link">
    12 Partial Reconfiguration
  </a>
  
    <nav class="md-nav" aria-label="12 Partial Reconfiguration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-user-clock-support" class="md-nav__link">
    12.1 User Clock Support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-host-exercisers" class="md-nav__link">
    13 Host Exercisers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#131-he-lb-and-he-mem-host-exerciser" class="md-nav__link">
    13.1 HE-LB and HE-MEM Host Exerciser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-memory-traffic-generator-he-mem-tg" class="md-nav__link">
    13.2 Memory Traffic Generator  (HE-MEM-TG)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-hssi-host-exerciser-he-hssi" class="md-nav__link">
    13.2 HSSI Host Exerciser (HE-HSSI)
  </a>
  
    <nav class="md-nav" aria-label="13.2 HSSI Host Exerciser (HE-HSSI)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1322-he-hssi-csr-map" class="md-nav__link">
    13.2.2 HE-HSSI CSR Map
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-he-null-overview" class="md-nav__link">
    13.3 HE-Null Overview
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-reliability-accessibility-serviceability-ras-and-error-handling" class="md-nav__link">
    14 Reliability, Accessibility, Serviceability (RAS) and Error Handling
  </a>
  
    <nav class="md-nav" aria-label="14 Reliability, Accessibility, Serviceability (RAS) and Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#141-fme-errors" class="md-nav__link">
    14.1 FME Errors
  </a>
  
    <nav class="md-nav" aria-label="14.1 FME Errors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1411-fme_error0" class="md-nav__link">
    14.1.1 FME_ERROR0
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1412-pcie0_error" class="md-nav__link">
    14.1.2 PCIE0_ERROR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1413-fme_first_error-fme_next_error" class="md-nav__link">
    14.1.3 FME_FIRST_ERROR, FME_NEXT_ERROR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1414-reliability-accessibility-serviceability-ras-error-status" class="md-nav__link">
    14.1.4 Reliability, Accessibility, Serviceability (RAS) Error Status
  </a>
  
    <nav class="md-nav" aria-label="14.1.4 Reliability, Accessibility, Serviceability (RAS) Error Status">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#14141-non-fatal-errors" class="md-nav__link">
    14.1.4.1 Non-Fatal Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14142-catastrophic-fatal-errors" class="md-nav__link">
    14.1.4.2 Catastrophic &amp; Fatal Errors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1415-ras-error-injection" class="md-nav__link">
    14.1.5 RAS Error Injection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1416-fme-error-interrupts" class="md-nav__link">
    14.1.6 FME Error Interrupts
  </a>
  
    <nav class="md-nav" aria-label="14.1.6 FME Error Interrupts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#14161-msi-x-masking-pending-bit-array-pba-clearing" class="md-nav__link">
    14.1.6.1 MSI-X Masking &amp; Pending Bit Array (PBA) Clearing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1417-fme-error-handling" class="md-nav__link">
    14.1.7 FME Error Handling
  </a>
  
    <nav class="md-nav" aria-label="14.1.7 FME Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#14171-catastrophicfatal-error" class="md-nav__link">
    14.1.7.1 Catastrophic/Fatal Error
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14172-non-fatal-error" class="md-nav__link">
    14.1.7.2 Non-Fatal Error
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#143-mmio-requests" class="md-nav__link">
    14.3 MMIO Requests
  </a>
  
    <nav class="md-nav" aria-label="14.3 MMIO Requests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1431-unsupported-functions-and-bar" class="md-nav__link">
    14.3.1 Unsupported Functions and BAR
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1432-mmio-request-decoding" class="md-nav__link">
    14.3.2 MMIO Request Decoding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1433-unused-fmeport-csr-regions" class="md-nav__link">
    14.3.3 Unused FME/Port CSR Regions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1434-unsupported-mmio-request" class="md-nav__link">
    14.3.4 Unsupported MMIO Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1435-afu-access-violation" class="md-nav__link">
    14.3.5 AFU Access Violation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1436-afu-mmio-response-timeout" class="md-nav__link">
    14.3.6 AFU MMIO Response Timeout
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15-ofs-design-hierarchy" class="md-nav__link">
    15 OFS Design Hierarchy
  </a>
  
    <nav class="md-nav" aria-label="15 OFS Design Hierarchy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#151-design-guidance" class="md-nav__link">
    15.1 Design Guidance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="fpga-interface-manager-technical-reference-manual-for-intel-agilex-soc-attach-open-fpga-stack"><strong>FPGA Interface Manager Technical Reference Manual for Intel Agilex SoC Attach: Open FPGA Stack</strong><a class="headerlink" href="#fpga-interface-manager-technical-reference-manual-for-intel-agilex-soc-attach-open-fpga-stack" title="Permanent link">&para;</a></h1>
<p>Last updated: <strong>August 01, 2023</strong> </p>
<h2 id="1-overview">1 Overview<a class="headerlink" href="#1-overview" title="Permanent link">&para;</a></h2>
<h3 id="11-about-this-document">1.1 About this Document<a class="headerlink" href="#11-about-this-document" title="Permanent link">&para;</a></h3>
<p>This document describes the hardware architecture for the SoC Attach reference <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> of the Open FPGA Stack (<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>) targeting the Intel<sup>&reg;</sup> Agilex FPGA.  After reviewing this document you should understand the features and functions of the components that comprise the FPGA Interface Manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>), also known as the "shell."</p>
<h3 id="12-glossary">1.2 Glossary<a class="headerlink" href="#12-glossary" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th align="center">Term</th>
<th align="center">Abbreviation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Advanced Error Reporting</td>
<td align="center"><abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr></td>
<td>The PCIe <abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr> driver is the extended PCI Express error reporting capability providing more robust error reporting. <a href="https://docs.kernel.org/PCI/pcieaer-howto.html?highlight=aer">(link)</a></td>
</tr>
<tr>
<td align="center">Accelerator Functional Unit</td>
<td align="center"><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></td>
<td>Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region is the part of the design where an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may reside. This <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may or may not be a partial reconfiguration region.</td>
</tr>
<tr>
<td align="center">Basic Building Block</td>
<td align="center"><abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr></td>
<td>Features within an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>'s <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and host interface requires. All BBBs must have a (globally unique identifier) GUID.</td>
</tr>
<tr>
<td align="center">Best Known Configuration</td>
<td align="center"><abbr title="Best Known Configuration, The exact hardware configuration Intel has optimized and validated the solution against.">BKC</abbr></td>
<td>The software and hardware configuration Intel uses to verify the solution.</td>
</tr>
<tr>
<td align="center">Board Management Controller</td>
<td align="center"><abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr></td>
<td>Supports features such as board power managment, flash management, configuration management, and board telemetry monitoring and protection. The majority of the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> logic is in a separate component, such as an Intel® Max® 10 or Intel Cyclone® 10 device; a small portion of the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> known as the PMCI resides in the main Agilex FPGA.</td>
</tr>
<tr>
<td align="center">Configuration and Status Register</td>
<td align="center">CSR</td>
<td>The generic name for a register space which is accessed in order to interface with the module it resides in (e.g. <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr>, various sub-systems and modules).</td>
</tr>
<tr>
<td align="center">Data Parallel C++</td>
<td align="center">DPC++</td>
<td>DPC++ is Intel’s implementation of the SYCL standard. It supports additional attributes and language extensions which ensure DCP++ (SYCL) is efficiently implanted on Intel hardware.</td>
</tr>
<tr>
<td align="center">Device Feature List</td>
<td align="center"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr></td>
<td>The <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver to automatically load the drivers required for a given FPGA configuration. This concept is the foundation for the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> software framework. <a href="https://docs.kernel.org/fpga/dfl.html">(link)</a></td>
</tr>
<tr>
<td align="center">FPGA Interface Manager</td>
<td align="center"><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></td>
<td>Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> resides in the static region of the FPGA and contains the FPGA Management Engine (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>) and I/O ring.</td>
</tr>
<tr>
<td align="center">FPGA Management Engine</td>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td>Performs reconfiguration and other FPGA management functions. Each FPGA device only has one <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> which is accessed through PF0.</td>
</tr>
<tr>
<td align="center">Host Exerciser Module</td>
<td align="center"><abbr title="Host Exerciser Module, Host exercisers are used to exercise and characterize the various host-FPGA interactions, including Memory Mapped Input/Output (MMIO), data transfer from host to FPGA, PR, host to FPGA memory, etc.">HEM</abbr></td>
<td>Host exercisers are used to exercise and characterize the various host-FPGA interactions, including Memory Mapped Input/Output (<abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>), data transfer from host to FPGA, <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>, host to FPGA memory, etc.</td>
</tr>
<tr>
<td align="center">Input/Output Control</td>
<td align="center"><abbr title="Input/Output Control, System calls used to manipulate underlying device parameters of special files.">IOCTL</abbr></td>
<td>System calls used to manipulate underlying device parameters of special files.</td>
</tr>
<tr>
<td align="center">Intel Virtualization Technology for Directed I/O</td>
<td align="center"><abbr title="Intel Virtualization Technology for Directed I/O, Extension of the VT-x and VT-I processor virtualization technologies which adds new support for I/O device virtualization.">Intel VT-d</abbr></td>
<td>Extension of the VT-x and VT-I processor virtualization technologies which adds new support for I/O device virtualization.</td>
</tr>
<tr>
<td align="center">Joint Test Action Group</td>
<td align="center"><abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr></td>
<td>Refers to the IEEE 1149.1 <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> standard; Another FPGA configuration methodology.</td>
</tr>
<tr>
<td align="center">Memory Mapped Input/Output</td>
<td align="center"><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr></td>
<td>The memory space users may map and access both control registers and system memory buffers with accelerators.</td>
</tr>
<tr>
<td align="center">oneAPI Accelerator Support Package</td>
<td align="center">oneAPI-asp</td>
<td>A collection of hardware and software components that enable oneAPI kernel to communicate with oneAPI runtime and <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> shell components. oneAPI ASP hardware components and oneAPI kernel form the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region of a oneAPI system in <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>.</td>
</tr>
<tr>
<td align="center">Open FPGA Stack</td>
<td align="center"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr></td>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> is a software and hardware infrastructure providing an efficient approach to develop a custom FPGA-based platform or workload using an Intel, 3<sup>rd</sup> party, or custom board.</td>
</tr>
<tr>
<td align="center">Open Programmable Acceleration Engine Software Development Kit</td>
<td align="center"><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr></td>
<td>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> is a software framework for managing and accessing programmable accelerators (FPGAs). It consists of a collection of libraries and tools to facilitate the development of software applications and accelerators. The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> resides exclusively in user-space.</td>
</tr>
<tr>
<td align="center">Platform Interface Manager</td>
<td align="center"><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr></td>
<td>An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developers can use to handle clock crossing, response sorting, buffering and different protocols.</td>
</tr>
<tr>
<td align="center">Platform Management Controller Interface</td>
<td align="center">PMCI</td>
<td>The portion of the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> that resides in the Agilex FPGA and allows the FPGA to communicate with the primary <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> component on the board.</td>
</tr>
<tr>
<td align="center">Partial Reconfiguration</td>
<td align="center"><abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr></td>
<td>The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. For <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> designs, the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region is referred to as the pr_slot.</td>
</tr>
<tr>
<td align="center">Port</td>
<td align="center">N/A</td>
<td>When used in the context of the fpgainfo port command it represents the interfaces between the static FPGA fabric and the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region containing the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</td>
</tr>
<tr>
<td align="center">Remote System Update</td>
<td align="center"><abbr title="Remote System Update, A Remote System Update operation sends an instruction to the Intel FPGA PAC D5005 device that triggers a power cycle of the card only, forcing reconfiguration.">RSU</abbr></td>
<td>The process by which the host can remotely update images stored in flash through PCIe. This is done with the OPAE software command "fpgasupdate".</td>
</tr>
<tr>
<td align="center">Secure Device Manager</td>
<td align="center">SDM</td>
<td>The SDM is the point of entry to the FPGA for <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> commands and interfaces, as well as for device configuration data (from flash, SD card, or through PCI Express* hard IP).</td>
</tr>
<tr>
<td align="center">Static Region</td>
<td align="center">SR</td>
<td>The portion of the FPGA design that cannot be dynamically reconfigured during run-time.</td>
</tr>
<tr>
<td align="center">Single-Root Input-Output Virtualization</td>
<td align="center"><abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr></td>
<td>Allows the isolation of PCI Express resources for manageability and performance.</td>
</tr>
<tr>
<td align="center">SYCL</td>
<td align="center">SYCL</td>
<td>SYCL (pronounced "sickle") is a royalty-free, cross-platform abstraction layer that enables code for heterogeneous and offload processors to be written using modern ISO C++ (at least C++ 17). It provides several features that make it well-suited for programming heterogeneous systems, allowing the same code to be used for CPUs, GPUs, FPGAs or any other hardware accelerator. SYCL was developed by the Khronos Group, a non-profit organization that develops open standards (including OpenCL) for graphics, compute, vision, and multimedia. SYCL is being used by a growing number of developers in a variety of industries, including automotive, aerospace, and consumer electronics.</td>
</tr>
<tr>
<td align="center">Test Bench</td>
<td align="center"><abbr title="Testbench, Testbench or Verification Environment is used to check the functional correctness of the Design Under Test (DUT) by generating and driving a predefined input sequence to a design, capturing the design output and comparing with-respect-to expected output.">TB</abbr></td>
<td>Testbench or Verification Environment is used to check the functional correctness of the Design Under Test (DUT) by generating and driving a predefined input sequence to a design, capturing the design output and comparing with-respect-to expected output.</td>
</tr>
<tr>
<td align="center">Universal Verification Methodology</td>
<td align="center"><abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr></td>
<td>A modular, reusable, and scalable testbench structure via an API framework.  In the context of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>, the <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> enviroment provides a system level simulation environment for your design.</td>
</tr>
<tr>
<td align="center">Virtual Function Input/Output</td>
<td align="center"><abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr></td>
<td>An Input-Output Memory Management Unit (IOMMU)/device agnostic framework for exposing direct device access to userspace. (link)</td>
</tr>
</tbody>
</table>
<h3 id="13-introduction-to-open-fpga-stack">1.3 Introduction to Open FPGA Stack<a class="headerlink" href="#13-introduction-to-open-fpga-stack" title="Permanent link">&para;</a></h3>
<p>The Open FPGA Stack (<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>) is a modular infrastructure of hardware platform components, open source unstreamed software, and broad ecosystem support that enables an efficient path to develop a custom FPGA platform.  <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Provides a framework of FPGA synthesizable code, simulation environment and synthesis/simulation scripts. </p>
<p>The key components of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> include:</p>
<ul>
<li>Target development platforms such as Intel-branded  Acceleration Development Platforms (ADPs) and third-party platforms.</li>
</ul>
<ul>
<li>Board Management Controller RTL and firmware that supports telemetry monitoring and capability for remote configuration updates.</li>
</ul>
<ul>
<li>Source accessible, modular FPGA Interface  manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>) RTL with a <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> infrastructure unit tests that can be leveraged for your own custom <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> can be thought of as the FPGA shell that provides the I/O ring and timing closed management components for the FPGA.</li>
</ul>
<ul>
<li>Basic building blocks for interconnect and PF/VF translation and arbitration; Platform Interface Manager (<abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>) which provides Avalon<sup>&reg;</sup> and Arm® AMBA® 4 AXI4 bus compliant interfaces.</li>
</ul>
<ul>
<li><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> examples both in the git repository and workload examples provided by 3<sup>rd</sup> party vendors.</li>
</ul>
<ul>
<li>Unit level simulation test suite</li>
</ul>
<ul>
<li>System level simulation through a unified verification methodology (<abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr>)</li>
</ul>
<ul>
<li>OPAE software development kit (APIs, up-streamed Linux drivers and software tools)</li>
</ul>
<ul>
<li>Support for other frameworks to be built on top of the OPAE such as DPDK </li>
</ul>
<p><strong>Figure 1-1 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Ingredients</strong></p>
<p><a class="glightbox" href="images/OFS_Stack.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="images/OFS_Stack.PNG" alt="drawing" ></a></p>
<p>These components are available in a two GitHub locations:</p>
<ul>
<li><a href="https://github.com/OFS/ofs-f2000x-pl"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> hardware GitHub site</a></li>
<li><a href="https://github.com/OFS/opae-sdk">OPAE software GitHub site</a></li>
</ul>
<p>The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> hardware repository supports hardware development and simulation.  Repositories for <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> high-level design support and board management controller RTL and firmware source code are also provided.  These repositories can be found in the Intel Opensource Technology GitHub location, which requires entitlement access.  To request access, please contact your local Intel sales representative.</p>
<p><strong>Table 1-2 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Hardware Repositories</strong></p>
<table>
<thead>
<tr>
<th>Repository</th>
<th>Contains</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/OFS/ofs-f2000x-pl"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> f2000x <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Github Branch</a></td>
<td>Contains <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> or shell RTL, automated compilation scripts, and unit tests and <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> framework.</td>
</tr>
</tbody>
</table>
<p>The OPAE software GitHub site is fully opensource and contains resources for both software and workload developers.</p>
<p><strong>Table 1-3  <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Software Repositories</strong></p>
<table>
<thead>
<tr>
<th>OPAE Git Repository Folder</th>
<th>Contains</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/OFS/opae-sdk/"><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> Repo</a></td>
<td>Contains the files for building and installing <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> from source.</td>
</tr>
<tr>
<td><a href="https://github.com/OFS/linux-dfl">Linux <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr></a></td>
<td>Contains <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Linux drivers that are being upstreamed to the Linux kernel.</td>
</tr>
<tr>
<td><a href="https://github.com/OFS/ofs-platform-afu-bbb">ofs-platform-afu-bbb</a></td>
<td>Contains the files and scripts to build the platform interface manager.</td>
</tr>
<tr>
<td><a href="https://github.com/OFS/opae-sim">opae-sim</a></td>
<td>Contains the files for an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developer to build the Accelerator Functional Unit Simulation Environment (ASE) for workload development.</td>
</tr>
</tbody>
</table>
<p>Providing the hardware and software source code and supporting test frameworks in a GitHub repository allows you to customize your designs with the latest versions easily.</p>
<h3 id="14-ofs-features">1.4 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Features<a class="headerlink" href="#14-ofs-features" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> architecture within the FPGA comprises two partitions:</p>
<ul>
<li>FPGA Interface Manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>)</li>
</ul>
<ul>
<li>Accelerator Functional Unit (<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>)
    -   <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> SoC Dynamic Region and Static Region 
    -   <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Host Static Region </li>
</ul>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> or shell provides platform management functionality, clocks, resets, and interface access to the host and peripheral features of the acceleration platform. </p>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> architecture along with the supporting OPAE software supports features such as partial reconfiguration and virtualization.</p>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> provides a standard Arm® AMBA® 4 AXI4 datapath interface. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> resides in the static region of the FPGA.</p>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> partition is provided for custom acceleration workloads and may contain both static and partial reconfiguration regions.</p>
<h4 id="141-fpga-interface-manager-fim">1.4.1 FPGA Interface Manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>)<a class="headerlink" href="#141-fpga-interface-manager-fim" title="Permanent link">&para;</a></h4>
<p>The updated <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> architecture for Intel® Agilex® FPGA devices improves upon the modularity, configurability and scalability of the first release of the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> architecture while maintaining compatibility with the original design.  The primary components of the FPGA Interface Manager or shell of this reference design are: </p>
<ul>
<li>P-tile PCIe Subsystem</li>
<li>E-Tile Ethernet Subsystem</li>
<li>Memory Subsystem</li>
<li>Reset Controller</li>
<li>FPGA Management Engine (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>)</li>
<li><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Peripheral Fabric for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> accesses to other interface peripherals</li>
<li>Board Peripheral Fabric for master to slave CSR accesses from Host or <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></li>
<li>Platform Management Controller Interface (PMCI) to the board management controller</li>
</ul>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Region provides design space for custom workloads and contains both static and partial reconfiguration regions.  Partial reconfiguration allows you to update your specific logic blocks or entire workload while the rest of your static design is still in operation.</p>
<p>Note that as discussed previously, the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> RTL and firmware, the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> OPAE software stack and support for building your own customer board support package are also provided in separate <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repositories.</p>
<p><strong>Figure 1-2 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Platform Block Diagram</strong></p>
<p><a class="glightbox" href="../images/Agilex_Fabric_Features.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Agilex OFS Block Diagram" src="../images/Agilex_Fabric_Features.svg" /></a></p>
<p>The table provides an overview of the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> features targeting the Intel® Agilex® FPGA.  This reference <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> (shell) is a starting point for your custom FPGA design.  With this initial starting point, you can add or subtract interfaces or ports to different Agilex devices.</p>
<p><strong>Table 1-4 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> for Intel® Agilex® FPGA Features</strong></p>
<table>
<thead>
<tr>
<th>Key Feature</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>PCIe</td>
<td>P-tile PCIe* Gen4x16 to the Host<br />P-tile PCIe* Gen4x16 to the SoC (IceLake-D)</td>
</tr>
<tr>
<td>Virtualization</td>
<td>Host: 2 physical functions <br />SoC:   1 physical function and 3 Virtual functions</td>
</tr>
<tr>
<td>Memory</td>
<td>Four Fabric DDR4 banks, x40 (optional ECC, be configured as x32 and ECC x8 ), 1200 MHz, 4GB</td>
</tr>
<tr>
<td>Ethernet</td>
<td>Eight Arm® AMBA® 4 AXI4-Stream channels of 25G Ethernet interfacing to an E-tile Ethernet Subsystem.</td>
</tr>
<tr>
<td>Configuration and Board Manageability</td>
<td>* FPGA Management Engine that provides general control of common FPGA tasks (ex. error reporting, partial reconfiguration) * Platform Controller Management Interface (PMCI) Module contained within the Agilex FPGA that interfaces through Avalon-Streaming x8 QuadSPI and SPI to a Board Management Controller</td>
</tr>
<tr>
<td>Partial Reconfiguration</td>
<td>Partial Reconfiguration region supported in hardware and software</td>
</tr>
<tr>
<td>Software Support</td>
<td>* Linux <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers targeting <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> FIMs * OPAE Software Development Kit * OPAE Tools</td>
</tr>
</tbody>
</table>
<h5 id="subsystem-interfaces">Subsystem Interfaces<a class="headerlink" href="#subsystem-interfaces" title="Permanent link">&para;</a></h5>
<p>The PCIe, Memory and Ethernet interfaces in this design use a new flexible subsystem design that provides a standard Arm® AMBA® 4 AXI4 interface.  To access these Intel FPGA IP Subsystem documents. Please go <a href="https://rdc.intel.com">here</a> and search for the following ID numbers:
* 690604: PCIe Subsystem IP User Guide (Note: you must login to myIntel and request entitled access)
* 686148: Memory Subsystem IP User Guide (Note: you must login to myIntel and request entitled access)
* 773413: [Ethernet Subsystem Intel FPGA IP] (public document)</p>
<h5 id="fpga-management-engine-fme">FPGA Management Engine (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>)<a class="headerlink" href="#fpga-management-engine-fme" title="Permanent link">&para;</a></h5>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> contains only one <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>, regardless of the number of host interfaces to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. The <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> provides management features for the platform and controls reset and loading of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> into the partial reconfiguration region of the FPGA.</p>
<p>Any feature, such as a memory interface or global error control that you want to control through <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>, must expose its capability to host software drivers.  New features are exposed to the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> by adding a device feature header (DFH) register at the beginning of the feature's control status register (CSR) space. The <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> CSR maps to physical function 0 (PF0) Base address register 0 (BAR0) so that software can access it through a single PCIe link.  For more information about DFHs, refer to the <a href="https://github.com/OFS/linux-dfl/blob/fpga-ofs-dev/Documentation/fpga/dfl.rst">FPGA Device Feature List Framework Overview</a></p>
<h5 id="streaming-datapath">Streaming Datapath<a class="headerlink" href="#streaming-datapath" title="Permanent link">&para;</a></h5>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> implements an Arm® AMBA® 4 AXI4-Stream bus protocol for data transfer in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. Arm® AMBA® 4 AXI4-Stream channels send data packets to and from the host channel IP without data abstraction. Memory-mapped I/O (<abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>) CSR accesses are routed to the ST2MM module, which converts the Arm® AMBA® 4 AXI4-Stream to an Arm® AMBA® 4 AXI4 memory-mapped protocol.</p>
<h5 id="virtualization">Virtualization<a class="headerlink" href="#virtualization" title="Permanent link">&para;</a></h5>
<p>This design supports virtualization by making use of the virtualization functionality in the PCIe Hard IP and mapping packets to the appropriate physical or virtual function through a PF/VF multiplexer.  </p>
<p>This reference <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> example supports 2 PFs for the host and 1PF, 3VFs for the SoC; however, you may extend your configuration to whatever the PCIe Hard IP can support or your application requires.</p>
<h4 id="142-afu">1.4.2 <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr><a class="headerlink" href="#142-afu" title="Permanent link">&para;</a></h4>
<p>An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is an acceleration workload that interfaces with the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> boundary in this design comprises both static and partial reconfiguration (<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>) regions.  You can decide how you want to partition these two areas or if you want your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region to only be a partial reconfiguration region.  A port gasket within the design provides all the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>-specific modules and logic required for partial reconfiguration. Only one partial reconfiguration region is supported in this design for SoC <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>Similar to the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>, the port gasket exposes its capability to the host software driver through a DFH register placed at the beginning of the port gasket CSR space. In addition, only one PCIe link can access the port register space.  </p>
<p>You can compile your design in one of the following ways: 
* Your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> (workload) for Host (Static Area) and SoC resides in the partial reconfiguration area. 
* Your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is part of the static region and is compiled from a flat design. </p>
<p>In this design, the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region is comprised of:
* <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interface handler to verify transactions coming from <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region.
* PF/VF Mux to route transactions to and from corresponding <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> components: 
  * Host:
    * ST2MM module.
    * PCIe loopback host exerciser (HE-LPBK) .</p>
<p>* SoC:
    * ST2MM module.
    * Ethernet Subsystem (previous HSSSI) host exerciser (HE-HSSI).
    * Memory Host Exerciser (HE-MEM).
    * Traffic Generator to memory (HE-MEM-TG).
    * Port Gasket (PRG).</p>
<ul>
<li>Arm® AMBA® 4 AXI4 Streaming to Memory Map (ST2MM) Module that routes <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> CSR accesses to <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> and board peripherals.</li>
<li>Host exercisers to test PCIe, memory and Ethernet Interfaces (these can be removed from the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region after your <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design is complete to provide more resource area for workloads)</li>
<li>Port gasket and partial reconfiguration support.</li>
<li>Component for handling PLDM over MCTP over PCIe Vendor Defined Messages (VDM)</li>
</ul>
<p>For this design the PF/VF Mux provides the following mappings (found in /src/afu_top/mux/top_cfg_pkg.sv and /src/afu_top/mux/soc_top_cfg_pkg.sv):</p>
<p><strong>Table 1-5 PF/VF Mapping</strong></p>
<p><strong>SoC (IceLake-D)</strong></p>
<table>
<thead>
<tr>
<th>PF</th>
<th>VF</th>
<th>Feature</th>
<th>BAR</th>
<th>Bar Size</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PF0</strong></td>
<td></td>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> managed peripherals</td>
<td>BAR 0</td>
<td>2MB</td>
</tr>
<tr>
<td></td>
<td></td>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> peripherals  <br />Board peripherals</td>
<td>BAR 0</td>
<td>256KB  <br />768KB</td>
</tr>
<tr>
<td><strong>PF0</strong></td>
<td>VF0</td>
<td>HE-MEM</td>
<td>BAR 0</td>
<td>2MB</td>
</tr>
<tr>
<td></td>
<td>VF1</td>
<td>HE-HSSI</td>
<td>BAR 0</td>
<td>2MB</td>
</tr>
<tr>
<td></td>
<td>VF2</td>
<td>HE-MEM TG</td>
<td>BAR 0</td>
<td>2MB</td>
</tr>
</tbody>
</table>
<p><strong>Xeon Host</strong></p>
<table>
<thead>
<tr>
<th>PF</th>
<th>VF</th>
<th>Feature</th>
<th>BAR</th>
<th>Bar Size</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PF0</strong></td>
<td></td>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> managed peripherals</td>
<td>BAR 0</td>
<td>1MB</td>
</tr>
<tr>
<td></td>
<td></td>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> peripherals  <br />Board peripherals</td>
<td></td>
<td>256KB  <br />768KB</td>
</tr>
<tr>
<td><strong>PF1</strong></td>
<td></td>
<td>HE-LPBK</td>
<td>BAR 0</td>
<td>16KB</td>
</tr>
</tbody>
</table>
<p><strong>Figure 1-3 <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Diagram</strong> </p>
<p><a class="glightbox" href="images\AFU_Agilex_Focus.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="images\AFU_Agilex_Focus.svg" /></a></p>
<h4 id="143-platform-interface-manager">1.4.3 Platform Interface Manager<a class="headerlink" href="#143-platform-interface-manager" title="Permanent link">&para;</a></h4>
<p>The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> provides a way to abstract the Arm® AMBA® 4 AXI4-Stream interface to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> by providing a library of shims that convert the host channel native packet into other protocols such as Arm® AMBA® 4 AXI4 memory-mapped, Avalon<sup>&reg;</sup> streaming (Avalon-ST) or Avalon<sup>&reg;</sup> memory-mapped (Avalon-MM). </p>
<p>The FPGA or <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developer implements these interface abstractions in the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> regions (afu_top and soc_afu_top) of the design.  </p>
<p>For more information, refer to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Developer's Guide.</p>
<h4 id="144-platform-feature-discovery">1.4.4 Platform Feature Discovery<a class="headerlink" href="#144-platform-feature-discovery" title="Permanent link">&para;</a></h4>
<p>This reference design comes with specific Intel FPGA drivers that are upstreamed to linux-dfl.  These drivers abstract the hardware and operating system specific details of the platform to the host. </p>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> implements a device feature header (DFH) at the beginning of each host-discoverable feature in a linked list format that allows an FPGA platform driver running on the host to discover <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>, port, and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> features. </p>
<p>You must implement a 64-bit DFH Device Feature Header register at the beginning (first 8B aligned address) of the feature CSR space for a new feature to be discovered or enumerated by a driver.  </p>
<p>During host discovery, the driver traverses the DFH of the first feature from the first address on PF0 BAR0. Based on the information in the DFH, a driver can determine the CSR address range of the feature and other associated details. The end of the DFH contains a "next DFH offset" field that points the driver to the DFH of the next feature. </p>
<p>The software must continue traversing the linked list until it sees the EOL (End-Of-List) bit set to 1 in the "next DFH offset" field it inspects.  A 1 indicates this is the last feature in the feature set. The figure below gives a simple illustration of the feature discovery by traversing the DFH registers. This model is similar to how PCIe enumeration occurs.</p>
<p><strong>Figure 1-4 Device Feature Header Linked List Traversal</strong></p>
<p><a class="glightbox" href="../images/DFH-traversal.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="DFH Linked List" src="../images/DFH-traversal.png" /></a></p>
<h4 id="145-ofs-reference-design">1.4.5 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Reference Design<a class="headerlink" href="#145-ofs-reference-design" title="Permanent link">&para;</a></h4>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> provides <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> designs you can use as a starting point for your own custom design. These designs target a specific programmable acceleration card or development kit and exercise key FPGA device interfaces. </p>
<p>The Intel Agilex<sup>&reg;</sup> code line for <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> targets the Intel IPU Platform F2000X-PL.  <a href="https://github.com/OFS/ofs-f2000x-pl"><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> designs</a> are released to for evaluation and use. </p>
<h4 id="146-fim-simulation">1.4.6 <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Simulation<a class="headerlink" href="#146-fim-simulation" title="Permanent link">&para;</a></h4>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> provides unit tests and a <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> environment for the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and a framework for new feature verification. <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> provides a modular, reusable, and scalable testbench structure by providing an API framework that can be deployed across multiple projects. </p>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> testbench is <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> compliant and integrates third-party verification IPs from Synopsys that require a license. </p>
<p>Verification components include:</p>
<ul>
<li><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> monitor to detect correct design behavior</li>
</ul>
<ul>
<li><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> assertions for signal level integrity testing</li>
</ul>
<ul>
<li>Arm® AMBA® 4 AXI4 scoreboards to check data integrity</li>
</ul>
<ul>
<li><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> coverage to collect functional data</li>
</ul>
<p>The verification infrastructure can be found <a href="https://github.com/OFS/ofs-f2000x-pl/verification">here</a> for evaluation and use. Please refer to the <a href="https://ofs.github.io/hw//f2000x/user_guides/ug_sim_ofs/ug_sim_ofs.md">Simulation User Guide</a> for more information.</p>
<h2 id="2-ofs-high-level-architecture">2 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> High Level Architecture<a class="headerlink" href="#2-ofs-high-level-architecture" title="Permanent link">&para;</a></h2>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> provides distinct data paths that simplify the design and integration process for adding or removing interface modules:</p>
<ul>
<li><strong>High Bandwidth data path</strong> for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>-attached high-performance peripherals (Ethernet Subsystem, Memory,  workload).</li>
<li><strong>Low Bandwidth data path</strong> for <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> management and slow peripheral components (<abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr>, I2C, SMBus).</li>
<li><strong><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Peripheral Fabric (APF) to Board Peripheral Fabric (BPF) path</strong> to communicate with interface control and status registers (CSRs) and board components.</li>
<li><strong>Peer-to-peer datapath</strong> between <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> components.</li>
<li><strong>Peer-to-peer datapath</strong> between BPF components.</li>
</ul>
<p>Depending on your design goals, you can present peripherals to software as:</p>
<ul>
<li><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> managed peripherals with a device feature header that is part of a device feature list.</li>
<li>Native driver managed peripherals that are exposed through an independent physical function or virtual function.</li>
</ul>
<p><strong>Figure 2-1 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Datapath Structure</strong>  </p>
<p><a class="glightbox" href="../images/OFS-Datapaths.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="OFS_datapaths" src="../images/OFS-Datapaths.PNG" /></a></p>
<h2 id="3-pcie-subsystem">3 PCIe Subsystem<a class="headerlink" href="#3-pcie-subsystem" title="Permanent link">&para;</a></h2>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>'s PCIe Subsystem is a hierarchical design that targets the P-tile PCIe* hard IP and is configured to support Gen4 speeds and Arm® AMBA® 4 AXI4-Stream Data Mover functional mode.  The IP supports <abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr> and is configured to provide  2 PFs for the host and 1PF, 3VFs for the SoC.  Native PCIe TLP packets are sent through the PCIe usingArm® AMBA® 4 AXI4 Stream Protocol.  Before they reach the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, the packets go through an adapter in the subsystem that converts any headers to a data mover format.  Tag allocation and management for packets sent from the application to the host are done by the PF/VF Mux which is part of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region.</p>
<p><strong>Figure 3-1 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> RX-TX Datapath</strong></p>
<p><a class="glightbox" href="images\PCIe_ss_block diagram.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="PCI_SS_block_diagram" src="images\PCIe_ss_block diagram.png" /></a></p>
<p>Some key features of the PCIe interface are:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th align="center"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel Agilex FPGA SoC Attach Subsystem Configuration</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mode</td>
<td align="center">Host: PCIe Gen4x16<br />SoC: PCIe Gen4x16</td>
</tr>
<tr>
<td>Tile</td>
<td align="center">P-Tile</td>
</tr>
<tr>
<td>Port Mode</td>
<td align="center">Native Endpoint</td>
</tr>
<tr>
<td><abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr></td>
<td align="center">Host: 2 PFs, No VFs<br />SoC:  1 PFs, 3 VFs</td>
</tr>
<tr>
<td>MSI-X Support</td>
<td align="center">Yes</td>
</tr>
<tr>
<td>Functional Mode</td>
<td align="center">Data Mover</td>
</tr>
<tr>
<td>Profile</td>
<td align="center">Basic</td>
</tr>
<tr>
<td>TLP Bypass</td>
<td align="center">No</td>
</tr>
<tr>
<td>Header Packing Scheme</td>
<td align="center">Simple</td>
</tr>
<tr>
<td>Data Width</td>
<td align="center">512-bit (64-byte)</td>
</tr>
<tr>
<td>Arm® AMBA® 4 AXI4-ST Clock Frequency</td>
<td align="center">500 MHz</td>
</tr>
<tr>
<td>Tags Supported</td>
<td align="center">128</td>
</tr>
<tr>
<td>Reordering</td>
<td align="center">Enabled with buffer 64 KB</td>
</tr>
<tr>
<td>Maximum Payload Size</td>
<td align="center">512 Bytes</td>
</tr>
<tr>
<td>Memory Requests Supported</td>
<td align="center">1CL, 2CL, 4CL</td>
</tr>
<tr>
<td><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> transaction Size</td>
<td align="center">4B, 8B</td>
</tr>
<tr>
<td>Control Shadow Interface</td>
<td align="center">Enabled</td>
</tr>
<tr>
<td>Completion Timeout Interface</td>
<td align="center">Enabled</td>
</tr>
</tbody>
</table>
<p>The PCIe PF, VF and Base Address Register (BAR) configuration can be modified in the PCIe Subsystem Platform Designer GUI interface.  The current implementation for the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> for Intel IPU Platform F2000X-PL is as follows:</p>
<p><strong>Table 3-1 Function and BAR Table for <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel IPU Platform F2000X-PL</strong></p>
<p><strong>SoC (IceLake-D)</strong></p>
<table>
<thead>
<tr>
<th>PF</th>
<th>VF</th>
<th>Feature</th>
<th>BAR</th>
<th>Bar Size</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PF0</strong></td>
<td></td>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> managed peripherals</td>
<td>BAR 0</td>
<td>2MB</td>
</tr>
<tr>
<td></td>
<td></td>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> peripherals  <br />Board peripherals</td>
<td>BAR 0</td>
<td>256KB  <br />768KB</td>
</tr>
<tr>
<td><strong>PF0</strong></td>
<td>VF0</td>
<td>HE-MEM</td>
<td>BAR 0</td>
<td>2MB</td>
</tr>
<tr>
<td></td>
<td>VF1</td>
<td>HE-HSSI</td>
<td>BAR 0</td>
<td>2MB</td>
</tr>
<tr>
<td></td>
<td>VF2</td>
<td>HE-MEM TG</td>
<td>BAR 0</td>
<td>2MB</td>
</tr>
</tbody>
</table>
<p><strong>Xeon Host</strong></p>
<table>
<thead>
<tr>
<th>PF</th>
<th>VF</th>
<th>Feature</th>
<th>BAR</th>
<th>Bar Size</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PF0</strong></td>
<td></td>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> managed peripherals</td>
<td>BAR 0</td>
<td>1MB</td>
</tr>
<tr>
<td></td>
<td></td>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> peripherals  <br />Board peripherals</td>
<td></td>
<td>256KB  <br />768KB</td>
</tr>
<tr>
<td><strong>PF1</strong></td>
<td></td>
<td>HE-LPBK</td>
<td>BAR 0</td>
<td>16KB</td>
</tr>
</tbody>
</table>
<h3 id="31-pcie-subsystem-header-format">3.1 PCIe Subsystem Header Format<a class="headerlink" href="#31-pcie-subsystem-header-format" title="Permanent link">&para;</a></h3>
<p>The first 32 bytes of the TLP from the PCIe subsystem denotes the PCIe header. There are two types of header format supported – Power User Mode header and Data Mover mode header. The tuser_vendor[0] bit on the Arm® AMBA® 4 AXI4-Stream channel indicates the header format of the TLP; tuser_vendor[0] =0 indicates Power User Mode header and tuser_vendor[0] =1 indicates Data Mover Mode header.</p>
<p>The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> for Intel Agilex FPGA implements the Data Mover Functional Mode.  With this implementation, the application has the flexibility to use either mode for PCIe transaction, as shown in the following table. For more detailed information about the PCIe Subsystem, see the PCIe Subsystem Intel FPGA User Guide. </p>
<p><strong>Table 3-2 PCIe Subsystem Header Format Support for <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Agilex FPGA</strong></p>
<table> 
<thead>
<tr>
<th align="center">Direction</th>
<th align="center">Type</th>
<th align="center">Power User</th>
<th align="center">Data Mover</th>
</tr>
</thead>
<tbody><tr><td rowspan="3">Host to Endpoint </td>   
<td align="center">MWr, MRd</td>
<td align="center">Yes</td> 
<td align="center">No</td>      
</tr>
<tr><td align="center">CPL/CPLd</td>
<td align="center">Yes</td> 
<td align="center">Yes</td> 
</tr>
<tr><td align="center">Msg</td>
<td align="center">Yes</td> 
<td align="center">No</td>  
</tr>
<tr><td rowspan="4">Endpoint to Host</td>   
<td align="center">MWr, MRd</td>
<td align="center">Yes</td> 
<td align="center">Yes</td>     
</tr>
<tr><td align="center">Intr</td>
<td align="center">Yes (MWr) </td>  
<td align="center">Yes</td> 
</tr>
<tr><td align="center">CPL/CPLd</td>
<td align="center">Yes</td> 
<td align="center">Yes</td> 
</tr>
<tr><td align="center">Msg</td>
<td align="center">Yes</td> 
<td align="center">Yes</td> 
</tr>
</tbody>
</table>

<h4 id="311-power-user-header-format">3.1.1 Power User Header Format<a class="headerlink" href="#311-power-user-header-format" title="Permanent link">&para;</a></h4>
<p>The Power User Format provides user complete control over PCIe Hard IP. The user can implement functionality of interest with finer control over PCIe Transaction Layer Packet (TLP), credit handling and various mode provided by HIP. </p>
<p>The lower 16 bytes of the Power User Format are standard PCIe header as defined by PCIe specification, and the upper 16 bytes are specific to the PCIe Subsystem Intel FPGA IP. </p>
<p><strong>Table 3-3 Power User Header Format</strong></p>
<p><a class="glightbox" href="../images/pu_header_format.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="PU_header_format" src="../images/pu_header_format.PNG" /></a></p>
<p>The mapping of the PCIe defined header to the lower 16 bytes of the Arm® AMBA® 4 AXI4-Stream data channel is shown in the figure below. Each double word (DW) or 4 bytes in the PCIe header is mapped from big-endian to little-endian on Arm® AMBA® 4 AXI4-S data channel.  </p>
<p><strong>Figure 3-2 Power User Header Mapping to Arm® AMBA® 4 AXI4 Channel</strong></p>
<p><a class="glightbox" href="../images/pcie_tlp_mapping.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="pci_tlp_mapping" src="../images/pcie_tlp_mapping.PNG" /></a></p>
<h4 id="312-data-mover-header-format">3.1.2 Data Mover Header Format<a class="headerlink" href="#312-data-mover-header-format" title="Permanent link">&para;</a></h4>
<p>The data mover mode allows high bandwidth data transfers to and from Host memory. It hides the complexity of handling PCIe TLPs. This format provides a simple interface for reading and writing to Host Memory. The data mover checks link partner credits before transmitting packets. It also provides MSI-X interrupt generation capability. </p>
<p>In Data Mover Mode, the lower 16 bytes are data mover specific and do not follow a PCIe standard header.  </p>
<p><strong>Table 3-4 Data Mover Header Format</strong></p>
<p><a class="glightbox" href="../images/dm_header_format.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="pci_tlp_mapping_dm" src="../images/dm_header_format.PNG" /></a>
<a class="glightbox" href="images/dm_header_format.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img src="images/dm_header_format.PNG" alt="drawing" style="width:500px"></a></p>
<p>The mapping of the data mover header to the lower 16 bytes of the Arm® AMBA® 4 AXI4-S data channel is shown below. Each byte in the data mover header is mapped directly to the Arm® AMBA® 4 AXI4-S data channel.  </p>
<p><strong>Figure 3-3 Data Mover Header Mapping to Arm® AMBA® 4 AXI4 Channel</strong></p>
<p><a class="glightbox" href="../images/pcie_tlp_mapping_dm.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="pci_tlp_mapping_dm" src="../images/pcie_tlp_mapping_dm.PNG" /></a></p>
<h3 id="32-pcie-subsystem-interface-module">3.2 PCIe Subsystem Interface Module<a class="headerlink" href="#32-pcie-subsystem-interface-module" title="Permanent link">&para;</a></h3>
<p>The PCIe Subsystem Interface module (/ipss/pcie/rtl/pcie_ss_if.sv), provides the supporting interface between software and the PCIe subsystem.  </p>
<p>The interface module provides the following:</p>
<ul>
<li>Device Feature Header Registers</li>
<li>Control and Status Registers</li>
<li>Indirect access to PCIe subsystem CSR registers through a CSR mailbox in the PCIe Subsystem Interface.</li>
</ul>
<h3 id="33-data-mover-request-cycles">3.3 Data Mover Request Cycles<a class="headerlink" href="#33-data-mover-request-cycles" title="Permanent link">&para;</a></h3>
<p>For Host read request cycles using the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> for Intel Agilex FPGA:
* All requests in the RX direction will be <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>. 
* Requester ID from the request does get sent to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. It is the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>'s responsibility to send back a completion to the host with the correct completer ID. 
* Prefix is not supported. 
* Memory Mapped (MM) Mode is not supported.
* Slot Number is 0.
* Base address is not sent to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.
* Local Address field is not used.</p>
<p>For <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>/application request cycles using the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> for Intel Agilex FPGA:
* All requests in the TX direction will be Memory Read/Write. 
* The tag must be generated by the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>/application.
* Prefix is not supported. 
* MM Mode is not supported.
* Slot Number is 0 (non-0 only for switch)
* VF Active, VF number and PF number are obtained from Data Mover Header Packet.</p>
<p><strong>Figure 3-4 Data Mover Request Cycles</strong></p>
<p><a class="glightbox" href="../images/dm_request_cycles.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="pci_tlp_mapping_dm" src="../images/dm_request_cycles.png" /></a></p>
<h3 id="34-data-mover-completion-cycles">3.4 Data Mover Completion Cycles<a class="headerlink" href="#34-data-mover-completion-cycles" title="Permanent link">&para;</a></h3>
<p>For Host completion cycles using the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> for Intel Agilex FPGA:
* All completions in the RX direction will be Data Completions. 
* Prefix is not supported.
* MM Mode is not supported.
* Slot Number is 0.
* Data packet responses (for Memory Read requests from <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>) from the PCIe SS may come out of order when the size is &gt;64B.</p>
<p>For <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>/application completion cycles using the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> for Intel Agilex FPGA:
* All requests in the TX direction will be Memory Read/Write. 
* Requester ID is generated within the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.
* That tag must be generated by the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>/application.
* Prefix is not supported. 
* MM Mode is not supported.
* Slot Number is 0.
* VF Active, VF Number and PF number are obtained from the Data Mover Header Packet. </p>
<p><strong>Figure 3-5 Data Mover Completion Cycles</strong></p>
<p><a class="glightbox" href="../images/dm_completion_cycles.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="dm_completion_cycles" src="../images/dm_completion_cycles.png" /></a></p>
<h2 id="4-platform-interface-manager">4 Platform Interface Manager<a class="headerlink" href="#4-platform-interface-manager" title="Permanent link">&para;</a></h2>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> interfaces to an application in the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region through Arm® AMBA® 4 AXI4-Stream channels.  This format allows the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to access the host channel's raw interface without any translation. </p>
<p>As a <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> developer, you have the option to provide the raw data format associated with the host interface channel to the workload or <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developer or you can provide an intermediate protocol using Platform Interface Manager Components or your own custom interface.</p>
<p>If you expose the raw Arm® AMBA® 4 AXI4-Stream interface of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, workload developers also have the option to convert to a desired protocol using the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> resources as well.  </p>
<p>Refer to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Developer Guide and the FPGA Interface Manager Developer Guide for more information on using the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> in your design.</p>
<h2 id="5-interconnect-fabric">5 Interconnect Fabric<a class="headerlink" href="#5-interconnect-fabric" title="Permanent link">&para;</a></h2>
<p>There are three types of interconnect fabric in the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design:
 * Arm® AMBA® 4 AXI4-Stream PF/VF mux/demux fabric
 * <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Peripheral Fabric (APF)
 * Board Peripheral Fabric (BPF)</p>
<p><strong>Figure 5-1 Interconnect Fabric Diagram</strong></p>
<p><a class="glightbox" href="../images/Agilex_Interconnect_Fabric.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/Agilex_Interconnect_Fabric.svg" /></a></p>
<p>TLP packets sent from upstream PCIe Subsystem on Arm® AMBA® 4 AXI4-Stream channel are demultiplexed in the Arm® AMBA® 4 AXI4-Stream PF/VF mux/demux fabric and routed to the respective PF/VF function based on the PF/VF information in the TLP header, such as vf_active or the PF/VF number. In the opposite direction, TLP packets from downstream PF/VF function are muxed in the fabric and sent to PCIe subsystem over Arm® AMBA® 4 AXI4-Stream channel.</p>
<p>All host <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> requests targeting PF0 BAR0 are routed to the ST2MM module. The ST2MM converts <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> TLP packets into Arm® AMBA® 4 AXI4-Lite memory requests and places the requests onto <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Peripheral Fabric (APF). <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> peripherals, such as <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> managed <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> features and ST2MM, and Board Peripheral Fabric (BPF) are interconnected by APF. The BPF is the interconnect fabric one hierarchy below APF which connects all the board peripherals. Both APF and BPF allow multiple Arm® AMBA® 4 AXI4-Lite master and slave interconnect topology.</p>
<p>If you are modifying the APF or BPF connections, you must use Platform Designer to generate the fabrics directly.  Please refer to the FPGA Interface Manager Developer Guide for directions on what files must be modified and how to generate the interconnect.</p>
<p>For modifying the PF/VF mux you must update parameters in these files:
* src/includes/top_cfg_pkg.sv
* src/common/pf_vf_mux.sv
Then make the corresponding update to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> top level instantiation and connections:
* src/afu_top/soc_afu_top.sv(SoC_AFU) and src/afu_top/afu_top.sv (HOST_AFU)</p>
<p>For details on these modifications, please refer to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Interface Manager Developer Guide.  </p>
<h3 id="51-afu-peripheral-fabric-apf">5.1 <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Peripheral Fabric (APF)<a class="headerlink" href="#51-afu-peripheral-fabric-apf" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Peripheral Fabric (APF) is a 64-bit Arm® AMBA® 4 AXI4-lite compliant interconnect fabric that connects <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> peripheral modules to board peripheral modules through the Board Peripheral Fabric (BPF). </p>
<p>The fabric is clocked by <code>clk_csr</code> and has a read allowance and write allowance of 1, i.e. only 1 active write/read is allowed in the fabric at any single time. </p>
<p>The address mapping for components interconnected by the APF is listed below. All components are mapped to PF0 BAR0 and implement Arm® AMBA® 4 AXI4-lite slave interface. Note that none of the features in the APF mapping are designed to act as a master.</p>
<p><strong>Table 5-1 APF Address Mapping</strong></p>
<p><strong>SoC PF0 BAR 0</strong></p>
<table>
<thead>
<tr>
<th>Address</th>
<th>Size (Byte)</th>
<th>Feature</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00000–0xFFFFF</td>
<td>1024K</td>
<td>Board Peripherals (See BPF address mapping)</td>
</tr>
<tr>
<td><strong><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Peripherals</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x100000 – 0x10FFFF</td>
<td>64K</td>
<td>ST2MM</td>
</tr>
<tr>
<td>0x130000 – 0x13FFFF</td>
<td>64K</td>
<td><abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Gasket: <br />4K= <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Gasket DFH, control and status <br />4K= Port DFH <br />4K=User Clock <br />52K=Remote STP</td>
</tr>
<tr>
<td>0x140000 – 0x14FFFF</td>
<td>64K</td>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Error Reporting (Protocol checker)</td>
</tr>
</tbody>
</table>
<p><strong>Host PF0 BAR 0</strong></p>
<table>
<thead>
<tr>
<th>Address</th>
<th>Size (Byte)</th>
<th>Feature</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00000–0xFFFFF</td>
<td>1024K</td>
<td>Board Peripherals (See BPF address mapping)</td>
</tr>
<tr>
<td><strong><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Peripherals</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x100000 – 0x10FFFF</td>
<td>64K</td>
<td>ST2MM</td>
</tr>
<tr>
<td>0x140000 – 0x14FFFF</td>
<td>64K</td>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Error Reporting (Protocol checker)</td>
</tr>
</tbody>
</table>
<h3 id="52-board-peripheral-fabric-bpf">5.2 Board Peripheral Fabric (BPF)<a class="headerlink" href="#52-board-peripheral-fabric-bpf" title="Permanent link">&para;</a></h3>
<p>The Board Peripheral Fabric is the 64-bit Arm® AMBA® 4 AXI4-Lite compliant interconnect fabric that connects board peripheral modules to APF. The fabric is clocked by <code>clk_csr</code> and has a read allowance and write allowance of 1, i.e. only 1 active write/read is allowed in the fabric at any single time.</p>
<p>The address mapping for components interconnected by BPF is listed below. All components are mapped to PF0 BAR0 and implement Arm® AMBA® 4 AXI4-lite slave interface. The Master column indicates if a component also implements Arm® AMBA® 4 AXI4-lite master interface which can send requests to the BPF.</p>
<p><strong>Table 5-2 BPF Address Mapping</strong></p>
<p><strong>SoC PF0 BAR 0</strong></p>
<table>
<thead>
<tr>
<th>Address</th>
<th>Size (Byte)</th>
<th>Feature</th>
<th>Master</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00000 – 0x0FFFF</td>
<td>64K</td>
<td><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>, Error, etc)</td>
<td>No</td>
</tr>
<tr>
<td>0x10000 – 0x10FFF</td>
<td>4K</td>
<td>SoC PCIe Interface</td>
<td>No</td>
</tr>
<tr>
<td>0x11000 – 0x11FFF</td>
<td>4K</td>
<td>Reserved</td>
<td>-</td>
</tr>
<tr>
<td>0x12000 – 0x12FFF</td>
<td>4K</td>
<td>QSFP Controller 0</td>
<td>No</td>
</tr>
<tr>
<td>0x13000 – 0x13FFF</td>
<td>4K</td>
<td>QSFP Controller 1</td>
<td>No</td>
</tr>
<tr>
<td>0x14000 – 0x14FFF</td>
<td>4K</td>
<td>Ethernet Subsystem</td>
<td>-</td>
</tr>
<tr>
<td>0x15000 – 0x15FFF</td>
<td>4K</td>
<td>Memory Subsystem</td>
<td></td>
</tr>
<tr>
<td>0x80000 – 0xFFFFF</td>
<td>512K</td>
<td>PMCI Controller</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p><strong>Host PF0 BAR 0</strong></p>
<table>
<thead>
<tr>
<th>Address</th>
<th>Size (Byte)</th>
<th>Feature</th>
<th>Master</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00000 – 0x00FFF</td>
<td>4K</td>
<td>Host PCIe Interface</td>
<td>No</td>
</tr>
<tr>
<td>0x80000 – 0xFFFFF</td>
<td>512K</td>
<td>PMCI Controller</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h3 id="53-arm-amba-4-axi4-stream-pfvf-muxdemux">5.3 Arm® AMBA® 4 AXI4-Stream PF/VF Mux/Demux<a class="headerlink" href="#53-arm-amba-4-axi4-stream-pfvf-muxdemux" title="Permanent link">&para;</a></h3>
<p>The Arm® AMBA® 4 AXI4-Stream PF/VF Mux/Demux routes the PCIe TLP packets from the PCIe subsystem Arm® AMBA® 4 AXI4-Stream RX channel to downstream PF/VF based on the pf_num and vf_num information in the PCIe TLP header.</p>
<p>The Arm® AMBA® 4 AXI4-Stream PF/VF mux arbitrates PCIe TLP packets from downstream PF/VF to the PCIe SS Arm® AMBA® 4 AXI4-S TX channel.
The PF/VF Mux/Demux is an M X N switch that allows any M port to target any N port, and any N port to target any M port, where M is the number of host/upstream ports, and N is the numbers functions/downstream ports.   </p>
<p>The fpga top package file, <code>/src/afu_top/mux/top_cfg_pkg.sv and soc_top_cfg_pkg.sv</code> and, contains the PF/VF parameters and mappings.</p>
<p><strong>Figure 5-2 PF/VF Mux</strong></p>
<p><a class="glightbox" href="../images/PF-VF-mux.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="pfvf-mux" src="../images/PF-VF-mux.png" /></a></p>
<p>The PF/VF mux integration is part of afu_top (<code>src/afu_top/afu_top.sv and /soc_afu_top</code>).  There are two independent TX PF/VF MUX trees, labeled "A" and "B".</p>
<p>Both an A and a B port are passed to each <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> component with a unique PF/VF. You can design your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> components to send all requests to the primary A port or partition requests across both A and B ports. A typical high-performance <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> sends read requests to the B port and everything else to the A port, giving the arbiter freedom to keep both the host TX and RX channels busy.</p>
<p>In the reference <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> provided for Intel Agilex <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>, the A and B TX trees have been multiplexed down to a single channel for A and another for B. The A/B multiplexer merges them into a single TX stream that will be passed to the tag remapper.</p>
<p>The tag remapper provides unique tags as required by the PCIe specification.  Tags are not provided by the PCIe Subsystem FPGA IP.  When creating your own <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> you can leverage this module to generate unique tags.</p>
<p>Note that the primary PF/VF Mux A supports RX and TX ports.  For the secondary PF/VF Mux B only TX ports are supported and the RX input to the Mux is tied off.  </p>
<p>The default mapping is shown below:</p>
<p><strong>Table 5-3 PF/VF Mapping</strong></p>
<p><strong>SoC (IceLake-D)</strong></p>
<table>
<thead>
<tr>
<th>PF</th>
<th>VF</th>
<th>Feature</th>
<th>BAR</th>
<th>Bar Size</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PF0</strong></td>
<td></td>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> managed peripherals</td>
<td>BAR 0</td>
<td>2MB</td>
</tr>
<tr>
<td></td>
<td></td>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> peripherals  <br />Board peripherals</td>
<td>BAR 0</td>
<td>256KB  <br />768KB</td>
</tr>
<tr>
<td><strong>PF0</strong></td>
<td>VF0</td>
<td>HE-MEM</td>
<td>BAR 0</td>
<td>2MB</td>
</tr>
<tr>
<td></td>
<td>VF1</td>
<td>HE-HSSI</td>
<td>BAR 0</td>
<td>2MB</td>
</tr>
<tr>
<td></td>
<td>VF2</td>
<td>HE-MEM TG</td>
<td>BAR 0</td>
<td>2MB</td>
</tr>
</tbody>
</table>
<p><strong>Xeon Host</strong></p>
<table>
<thead>
<tr>
<th>PF</th>
<th>VF</th>
<th>Feature</th>
<th>BAR</th>
<th>Bar Size</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PF0</strong></td>
<td></td>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> managed peripherals</td>
<td>BAR 0</td>
<td>1MB</td>
</tr>
<tr>
<td></td>
<td></td>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> peripherals  <br />Board peripherals</td>
<td></td>
<td>256KB  <br />768KB</td>
</tr>
<tr>
<td><strong>PF1</strong></td>
<td></td>
<td>HE-LPBK</td>
<td>BAR 0</td>
<td>16KB</td>
</tr>
</tbody>
</table>
<p>For information on how to modify the PF/VF mapping for your own design, refer to the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Developer User Guide.</p>
<h3 id="54-afu-interface-handler">5.4 <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interface Handler<a class="headerlink" href="#54-afu-interface-handler" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interface Handler resides inline between the PCIe Arm® AMBA® 4 AXI4-Stream Adapter and the Arm® AMBA® 4 AXI4-Stream PF/VF Demux/Mux logic. Its main function is to provide:
* Unique PCIe tags – Each PCIe transaction shares the 512 tags across all VFs in the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region
* <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> error logging for all VFs in the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region</p>
<h4 id="541-unified-tag-remapping">5.4.1 Unified Tag Remapping<a class="headerlink" href="#541-unified-tag-remapping" title="Permanent link">&para;</a></h4>
<p>When a FPGA function sends out a read cycle, it allocates a unique tag which is subsequently used to identify the read completion.  The tag is considered busy; it cannot be assigned to another read cycle until read completion.  While a tag may be unique within a unit, two different units could unknowingly send out two read cycles of the same tag.  The PCIe subsystem requires unique tags for all read cycles irrespective of their origins.  Therefore, a mechanism is needed to uniquify tag globally across different units.</p>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> contains a tag remapper (<code>tag_remap.sv</code>) that intercepts the read cycle, finds a globally unique tag, and replaces the original tag value.  It also restores the original tag value when returning completion to the read requester.  tag_remap is placed between the Arm® AMBA® 4 AXI4-Stream interface of the PCIE subsystem and the PF/VF Mux/Demux.</p>
<p>The logic is described as follows:</p>
<ol>
<li>A sub-module (<code>ofs_fim_tag_pool</code>) maintains a pool of available tags.</li>
<li>TX read requests are held until a tag is available from the pool by setting tvalid=0 to the host, and tready=0 to the PF/VF Mux/Demux.</li>
<li>When a TX read is dispatched, the tag is marked busy in the pool.</li>
<li>The original tag is stored in tag_reg, so it can be recovered when returning a completion to the unit/function.</li>
<li>Because completion to a read request can split into multiple smaller transfer sizes, responses are monitored and the final completion is detected using PCIe TLP rules.</li>
<li>Tags are released in the pool only when all requested data are transferred.</li>
<li>When the completion returns, the original tag is restored from <code>tag_reg</code>.</li>
</ol>
<h4 id="542-afu-error-handling">5.4.2 <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Error Handling<a class="headerlink" href="#542-afu-error-handling" title="Permanent link">&para;</a></h4>
<p>In this <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> design, the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interface Handler handles error logging for all VFs in the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. Errors handled are as follows</p>
<p><strong>Table 5-4 <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Error Descriptions</strong></p>
<table>
    <thead> 
        <tr>
        <th>Checker</th>    
        <th>Field</th>
        <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr><td rowspan="12">AFU protocol checker (PCIe TLP)</td>
        <td>Malformed TLP</td>
        <td>AFU PCIe TLP contains unsupported format type</td></tr>
        <tr>
        <td>MaxPayloadError</td>
        <td>AFU memory write payload size exceeds max_payload_length limit</td></tr>
        <tr>
        <td>MaxReadReqSizeError</td>
        <td>AFU memory read payload size exceeds max_read_request_size limit</td></tr>
        <tr>
        <td>MaxTagError</td>
        <td>AFU memory read request tag value exceeds the maximum supported tag count</td></tr>
        <tr>
        <tr>
        <td>UnalignedAddrErr</td>
        <td>The address field in AFU memory write/read request TLP is not DW-aligned.</td></tr>
        <tr><td>UnexpMMIOResp</td>
        <td>AFU is sending a MMIO read response with no matching MMIO read request.</td></tr>
        <tr><td>MMIOTimedOut</td><td>AFU is not responding to a MMIO read request within the pre-defined response timeout period. </td></tr>
        <tr><td>MMIODataPayloadOverrun</td><td>The number of data payload sent by AFU for a MMIO response (cplD) is more than the data length specified in the response.</td></tr>
    <tr><td>MMIOInsufficientData</td><td>The number of data payload sent by AFU for a MMIO response (cplD) is less than the data length specified in the response.</td></tr>
    <tr><td>TxMWrDataPayloadOverrun</td><td>    The number of data payload sent by AFU for a memory write request is more than the data length specified in the request.</td></tr>
    <tr><td>TxMWrInsufficientData</td><td>  The number of data payload sent by AFU for a memory write request is less than the data length specified in the request.</td></tr>
    <tr><td>AFU Protocol Checker (Arm® AMBA® 4 AXI4-Stream)</td><td>TxValidViolation</td><td>Three checkers are implemented in the FIM to catch errors and protocol violations.</td>
    </tbody>
</table>

<h3 id="55-tlp-to-arm-amba-4-axi4-lite-memory-mapped-bridge-st2mm">5.5 TLP to Arm® AMBA® 4 AXI4-Lite Memory Mapped Bridge (ST2MM)<a class="headerlink" href="#55-tlp-to-arm-amba-4-axi4-lite-memory-mapped-bridge-st2mm" title="Permanent link">&para;</a></h3>
<p>ST2MM implements the following key features:
* Host <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> bridge
    * Maps <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> TLP packets received from the PCIe Subsystem over streaming interface to Arm® AMBA® 4 AXI4-Lite memory-mapped request. The memory-mapped request is sent to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> or Board peripherals over APF and BPF.
    * Maps Arm® AMBA® 4 AXI4-lite MM response received from <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> or Board peripherals to TLP packets and send the packets over ST streaming channel to host HIA subsystem.
* Sends <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> response of all 0’s for <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> read to unused BAR region.
* Interrupt
    * Sends interrupt packets to the PCIe subsystem when interrupt requests are received from the peripherals. Interrupts can be requested by a peripheral through a memory write to interrupt CSR registers in the ST2MM.</p>
<p><strong>Figure 5-3 ST2MM Module</strong></p>
<p><a class="glightbox" href="../images/st2mm.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="st2mm" src="../images/st2mm.png" /></a></p>
<p>ST2MM implements both Arm® AMBA® 4 AXI4-lite master and slave interfaces that are connected to the designated slave and master port on APF. Host memory requests are sent on the ST2MM master interface to AFP where the requests are routed to the targeted peripherals. </p>
<h2 id="6-mmio-regions">6 <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Regions<a class="headerlink" href="#6-mmio-regions" title="Permanent link">&para;</a></h2>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> expose their functionalities to the host software through a set of CSR registers that are mapped to an <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region (Memory Mapped IO). An <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region is an address space within a base address register (BAR) region to which features are memory mapped.  </p>
<p>For example, when a feature is mapped to an <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region, the CSR registers of that feature are located within the address range of that region. There can be multiple <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> regions within a BAR region. </p>
<h3 id="61-feature-region">6.1 Feature Region<a class="headerlink" href="#61-feature-region" title="Permanent link">&para;</a></h3>
<p>A group of related CSRs can be categorized as a feature region. For example, a DMA engine has queue management function and quality of service (QoS) function; these are two different features of the DMA engine. A feature region is contained within a single PCIe BAR and cannot span across two BAR region boundaries. </p>
<p>A Device Feature Header (DFH) register marks the start of the feature region and sub-feature region, and you must place it at the first address of the region. Each DFH starts at 4KB boundary. A DFH register contains information that OPAE software requires to enumerate the feature. It also has an offset field that points to the next DFH in a feature list. OPAE software traverses the linked list of DFHs in each BAR region to discover all the features implemented on the platform. </p>
<p>The <code>EOL</code> field in a DFH marks the end of a DFH list and is only set in the DFH of the last feature in the feature list. The feature type field in the DFH is used to differentiate between the different types of feature region. Basic building blocks (<abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr>) and private features are always a child of an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> or FPGA Interface Unit (FIU) and must be contained within an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> or FIU, respectively.  </p>
<h4 id="611-device-feature-header-dfh-structure">6.1.1 Device Feature Header (DFH) Structure<a class="headerlink" href="#611-device-feature-header-dfh-structure" title="Permanent link">&para;</a></h4>
<p>All DFHs must follow the following structure to be compatible with OPAE software.  Note that only features you want to be exposed to the OPAE software must have a DFH.</p>
<p><strong>Table 6-1: DFH Register Structure</strong></p>
<table>
<thead>
<tr>
<th align="center">Bitfield Name</th>
<th align="center">Range</th>
<th align="center">Access</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">FeatureType</td>
<td align="center">63:60</td>
<td align="center">RO</td>
<td>4’b0000 – Reserved <br>4’b0001 – <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr><br>4’b0010 – <abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr><br>4’b0011 – Private Feature<br>4'b0100 – <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr><br></td>
</tr>
<tr>
<td align="center">Reserved</td>
<td align="center">59:41</td>
<td align="center">Rsvd</td>
<td>Reserved</td>
</tr>
<tr>
<td align="center">EOL</td>
<td align="center">40</td>
<td align="center">RO</td>
<td>End of DFH List<br>1'b0=No other feature header beyond this one<br>1'b1=This is the last feature header</td>
</tr>
<tr>
<td align="center">NextDFHByteOffset</td>
<td align="center">39:16</td>
<td align="center">RO</td>
<td>Next DFH byte offset<br>Next DFH Address= Current DFH address + Next DFH byte offset.  You can also use this value as an indication of the maximum size of the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region occupied by this feature.<br></td>
</tr>
<tr>
<td align="center">FeatureRev</td>
<td align="center">15:12</td>
<td align="center">RO</td>
<td>For <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Feature type= <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> major version number that is user defined.<br>All other feature types= Feature revision number</td>
</tr>
<tr>
<td align="center">FeatureID</td>
<td align="center">11:0</td>
<td align="center">RO</td>
<td>For <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> feature type= CoreFIM version number<br>For <abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr> feature type= Intel defined ID for <abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr><br>For private feature type= User-defined ID to identify within an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr><br> For FIU type=ID for FIU unit (ex. 0 for <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>, 1 for Port)</td>
</tr>
</tbody>
</table>
<p>You must increment a feature revision number if a feature changes.  This change requires a corresponding change in the software to detect the new version and report mismatches between the hardware and software revision number. </p>
<p>When indicating "FeatureType" in your DFH Structure, use the following guidance:
* <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>= Any static region feature you want discovered through software.  <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> features must implement mandatory <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> registers, including a <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> feature ID.
* <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>= User Application region; may be <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region.  <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> feature must implement mandatory <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> register including an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> ID.
* Private Feature = Linked list of features within the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> or <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> which are enumerated and managed by separate software and do not require an ID.
* Basic Building Blocks (<abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr>) = Special features within the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> or <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> that are meant to be reusable basic building blocks.  They are enumerated and called by separate software services.  </p>
<p><strong>Table 6-2: Mandatory <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Registers</strong></p>
<p>The following table details the registers required for a <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> feature or <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to be discovered by OPAE software.  The ID_H and ID_L fields allow you to create a unique feature or <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> identifier that remains unchanged while the FeatureRev in the DFH register increments.</p>
<table>
<thead>
<tr>
<th>Byte Address offset with respect to DFH</th>
<th align="center">Register Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x0000</td>
<td align="center">DFH with corresponding FeatureType field implemented</td>
</tr>
<tr>
<td>0x0008</td>
<td align="center">ID_L: Lower 64 bits of unique ID number (GUID)</td>
</tr>
<tr>
<td>0x0010</td>
<td align="center">ID_H: Upper 64 bits of unique ID number (GUID)</td>
</tr>
<tr>
<td>0x0018</td>
<td align="center">Next <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></td>
</tr>
</tbody>
</table>
<p><strong>Table 6-3: Next <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Register Definition</strong></p>
<p>The following table details the "Next <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Register Definition."  This register is used if you have multiple AFUs that can be used with your <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.  </p>
<table>
<thead>
<tr>
<th align="center">Bit</th>
<th align="center">Attribute</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">63:24</td>
<td align="center">Reserved</td>
<td>Reserved</td>
</tr>
<tr>
<td align="center">23:0</td>
<td align="center">RO</td>
<td>Next <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> DFH Byte Offset <br>Next <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> DFH address =current address + offset; where a value of 0 implies this is the last <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in the list. <br/>Example:<br/> AFU0 at address 0x0: Next <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> offset= 0x100 <br/> AFU1@ address 0x100: Next <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> offset = 0x100<br/> AFU2 at address 0x200: Next <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> offset = 0x0 (End of <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> List)</td>
</tr>
</tbody>
</table>
<p><strong>6.2 Control and Status Registers</strong></p>
<p>All the Control and Status Registers (CSRs) in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> are 64-bit registers with the following <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> write, and <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> read support.</p>
<p><strong>Table 6-4: CSR <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Read and Write Support</strong></p>
<table>
<thead>
<tr>
<th align="center">Request</th>
<th align="center">Memory Attribute</th>
<th align="center">Payload size</th>
<th align="center">Memory Ordering</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Write</td>
<td align="center">UC</td>
<td align="center">4B or 8B</td>
<td align="center">Strongly ordered</td>
</tr>
<tr>
<td align="center"><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Read</td>
<td align="center">UC</td>
<td align="center">4B or 8B</td>
<td align="center">Strongly ordered</td>
</tr>
</tbody>
</table>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> does not reorder the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> requests or responses. For <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> writes, there is no reordering of requests in <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, and UC ordering rules are followed. Similarly, for <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> reads, there is no re-ordering of requests or responses in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may opt to re-order the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> read responses but the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> does not enforce read response ordering. </p>
<h4 id="621-software-access-to-registers">6.2.1 Software Access to Registers<a class="headerlink" href="#621-software-access-to-registers" title="Permanent link">&para;</a></h4>
<ul>
<li>Software accesses 64-bit registers as aligned quadwords. For example, to modify a field (bit or byte) in a 64-bit register, the entire quadword is read, the appropriate field(s) are modified, and the entire quadword is written back.</li>
<li>When updating registers through multiple accesses (whether in software or due to hardware disassembly), certain registers may have specific requirements on how the accesses must be ordered for proper behavior. These are documented as part of the respective register descriptions.</li>
<li>For compatibility with future extensions or enhancements, software must assign the last read value to all “Reserved and Preserved” (RsvdP) fields when written. In other words, any updates to a register must be read so that the appropriate merge between the RsvdP and updated fields occurs. Also, software must assign a value of zero for “Reserved and Zero” (RsvdZ) fields when written.</li>
<li>PCIe locked operations to FPGA hardware registers are not supported. Software must not issue locked operations to access FPGA hardware registers.</li>
</ul>
<p>In the following two cases, the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> terminates <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Read requests by sending a completion with the data (CplD) specified below:
* <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Timeout:  This occurs when the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> does not respond within a set timeout. The timeout value is currently configured to 512 pclks (clk_2x). In this case, the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> returns all 1s.</p>
<ul>
<li>Illegal <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Accesses: This occurs when the read is accessing undefined registers in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> or if an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> access violation.  An example of an access violation is when a PF attempts to access the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> when it is set to VF mode, or when a VF attempts to access the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> when it is set to PF mode. In this case, the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> will returns all 0s.</li>
</ul>
<h3 id="62-register-attribute-definition">6.2 Register Attribute Definition<a class="headerlink" href="#62-register-attribute-definition" title="Permanent link">&para;</a></h3>
<p><strong>Table 6-5: <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Register Attribute Definitions</strong></p>
<table>
<thead>
<tr>
<th align="center">Attribute</th>
<th align="center">Expansion</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">RW</td>
<td align="center">Read/Write</td>
<td>This bit can be read or written by software.</td>
</tr>
<tr>
<td align="center">RO</td>
<td align="center">Read Only</td>
<td>The bit is set by hardware only. Software can only read this bit. Writes do not have any effect.</td>
</tr>
<tr>
<td align="center">RW1C</td>
<td align="center">Read/ Write 1 to Clear</td>
<td>Software can read or clear this bit. The software must write 1 to clear this bit. Writing zero to RW1C bit has no effect. Note that a multi-bit RW1C field may exist. In this case, all bits in the field are cleared if a 1 is written to any of the bits.</td>
</tr>
<tr>
<td align="center">RW1S</td>
<td align="center">Read/ Write 1 to Set</td>
<td>Software can read this bit. Writing a 1 to the bit sets it to 1. Writing a 0 has no effect. It is not possible for software to set this bit to 0. The 1 to 0 transition can only be performed by HW.</td>
</tr>
<tr>
<td align="center">RW1CS</td>
<td align="center">Read/Write 1 to Clear Sticky</td>
<td>Software can read and clear this bit. Writing a 1 to a bit clears it, while writing a 0 to a bit has no effect. This bit is only reinitialized to its default value by a power-on reset.</td>
</tr>
<tr>
<td align="center">RWD</td>
<td align="center">Read/Write Sticky across Hard Reset</td>
<td>The bit can be read or written by SW. This bit is sticky or unchanged by any reset type, including Hard Reset. The bit gets cleared only with power on.</td>
</tr>
<tr>
<td align="center">*S</td>
<td align="center">Sticky across Soft Reset</td>
<td>The bit will be sticky or unchanged by soft reset. These bits are only re-initialized to their default value by a power-on reset.</td>
</tr>
<tr>
<td align="center">*D</td>
<td align="center">Sticky across Hard Reset</td>
<td>The bit is sticky or unchanged by or unchanged by any reset type, including hard reset. The bit gets cleared only with power on.</td>
</tr>
<tr>
<td align="center">Rsvd</td>
<td align="center">Reserved</td>
<td>Reserved for future definitions. Currently don’t care bits.</td>
</tr>
<tr>
<td align="center">RsvdP</td>
<td align="center">Reserved and Protected</td>
<td>Reserved for future RW implementations. The software must preserve the value of this bit by read modify write.</td>
</tr>
<tr>
<td align="center">RsvdZ</td>
<td align="center">Reserved and Zero</td>
<td>Reserved for future RW1C implementations. The software must write zero to this bit.</td>
</tr>
</tbody>
</table>
<h4 id="623-csr-offset-in-bars">6.2.3 CSR Offset in BARs<a class="headerlink" href="#623-csr-offset-in-bars" title="Permanent link">&para;</a></h4>
<p>The table below captures the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> features in the supported BAR regions. The highlighted offset indicates the first DFH in the DFH list of a BAR region where device driver starts the DFH traversal.</p>
<p><strong>Table 6-6: PF0 BAR0 Features SoC <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong></p>
<table>
<thead>
<tr>
<th><strong>Offset</strong></th>
<th><strong>Feature CSR set</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0x0000</strong></td>
<td><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></td>
</tr>
<tr>
<td><strong>0x10000</strong></td>
<td>PCIe Interface</td>
</tr>
<tr>
<td><strong>0x12000</strong></td>
<td>QSFP Controller 0</td>
</tr>
<tr>
<td><strong>0x13000</strong></td>
<td>QSFP Controller 1</td>
</tr>
<tr>
<td><strong>0x14000</strong></td>
<td>Ethernet Interface</td>
</tr>
<tr>
<td><strong>0x15000</strong></td>
<td>Memory Interface</td>
</tr>
<tr>
<td><strong>0x80000</strong></td>
<td>PMCI</td>
</tr>
<tr>
<td><strong>0x100000</strong></td>
<td>St2MM</td>
</tr>
<tr>
<td><strong>0x130000</strong></td>
<td><abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Control &amp;  Status (Port Gasket)</td>
</tr>
<tr>
<td><strong>0x131000</strong></td>
<td>Port CSRs (Port Gasket)</td>
</tr>
<tr>
<td><strong>0x132000</strong></td>
<td>User Clock (Port  Gasket)</td>
</tr>
<tr>
<td><strong>0x133000</strong></td>
<td>Remote SignalTap (Port Gasket)</td>
</tr>
<tr>
<td><strong>0x140000</strong></td>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Errors (Protocol Checker)</td>
</tr>
</tbody>
</table>
<p>Table 6-7: PF0 BAR0 Features Host <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></p>
<table>
<thead>
<tr>
<th><strong>Offset</strong></th>
<th><strong>Feature CSR  set</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0x0000</strong></td>
<td>PCIe Interface</td>
</tr>
</tbody>
</table>
<h2 id="7-clocks">7 Clocks<a class="headerlink" href="#7-clocks" title="Permanent link">&para;</a></h2>
<p>The following table provides external clock sources which correspond to pins on the FPGA that drive blocks of internal logic or are used as a reference clock for internal PLLs.  The names in the table are used in the top.sv or are the logical clock names used by their respective functional blocks.  </p>
<p><strong>Table 7-1: External Clock Source</strong> </p>
<table>
<thead>
<tr>
<th>Clock</th>
<th>Frequency</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SYS_REFCLK</td>
<td>100MHz</td>
<td>Reference clock to system IOPLL (sys_pll) which provides <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> system clocks.</td>
</tr>
<tr>
<td>PCIE_REFCLK0</td>
<td>100MHz</td>
<td>PCIe  Refclk 0</td>
</tr>
<tr>
<td>PCIE_REFCLK1</td>
<td>100MHz</td>
<td>PCIe Refclk 1</td>
</tr>
<tr>
<td>SOC_PCIE_REFCLK0</td>
<td>100MHz</td>
<td>PCIe Refclk 0 on the SOC side</td>
</tr>
<tr>
<td>SOC_PCIE_REFCLK1</td>
<td>100MHz</td>
<td>PCIe Refclk 1 on the SOC side</td>
</tr>
<tr>
<td>qsfp_ref_clk</td>
<td>156.25MHz</td>
<td>Ethernet  Refclk</td>
</tr>
<tr>
<td>ddr4[0].ref_clk</td>
<td>150MHz</td>
<td>Refclk  for EMIF channel 0</td>
</tr>
<tr>
<td>ddr4[1].ref_clk</td>
<td>150MHz</td>
<td>Refclk for EMIF channel 1</td>
</tr>
<tr>
<td>ddr4[2].ref_clk</td>
<td>150MHz</td>
<td>Refclk  for EMIF channel 2</td>
</tr>
<tr>
<td>ddr4[3].ref_clk</td>
<td>150MHz</td>
<td>Refclk for EMIF channel 3</td>
</tr>
<tr>
<td>sdm_config_clk</td>
<td>125MHz</td>
<td>SDM  Config Clock</td>
</tr>
<tr>
<td>altera_reserved_tck</td>
<td>10MHz</td>
<td>Default  <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> Clock</td>
</tr>
</tbody>
</table>
<p><strong>Table 7-2: Internal Clocks</strong></p>
<table>
<thead>
<tr>
<th>Clock</th>
<th>Frequency</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>clk_sys</td>
<td>400MHz</td>
<td>System clock. Primary clock for PCIe datapath.</td>
</tr>
<tr>
<td>clk_100m</td>
<td>100MHz</td>
<td>100MHz clock. For RemoteSTP and user  clock, or any logic that requires a 100MHz clock.</td>
</tr>
<tr>
<td>clk_csr</td>
<td>100MHz</td>
<td>Arm® AMBA® 4 AXI4-lite  interconnect fabric and CSR clock. Driven by clk_100m.</td>
</tr>
<tr>
<td>clk_2x</td>
<td>400MHz</td>
<td>2x clock to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> slot. Driven by clk_sys.</td>
</tr>
<tr>
<td>clk_1x</td>
<td>171.43MHz</td>
<td>1x clock to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> slot.</td>
</tr>
<tr>
<td>uclk_usr</td>
<td>312.50  MHz</td>
<td>Configurable  “H” clk for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. Default 312.50 MHz</td>
</tr>
<tr>
<td>uclk_usr_div2</td>
<td>156.25 MHz</td>
<td>Configurable  “L” clk for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. Default 156.25 MHz</td>
</tr>
</tbody>
</table>
<h2 id="8-reset">8 Reset<a class="headerlink" href="#8-reset" title="Permanent link">&para;</a></h2>
<h3 id="81-reset-signals">8.1 Reset Signals<a class="headerlink" href="#81-reset-signals" title="Permanent link">&para;</a></h3>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> system reset signals are driven according to a their respective requirements derived from their use cases.  The behavioral code defining the reset operation is located in the file <code>rst_ctrl.sv</code>. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> System Reset Drivers table below provides a list of the input and feedback signals that compose the various resets.</p>
<p><strong>Table 8-1: <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> System Reset Drivers</strong></p>
<table>
<thead>
<tr>
<th align="center">Reset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>nPERST</code> pin</td>
<td>Active low PCIe reset pin from the PCIe card edge that may be set by the host machine for cold or warm resets.</td>
</tr>
<tr>
<td align="center"><code>nCONFIG</code> pin</td>
<td>Active low input to the FPGA that causes the FPGA to lose its configuration data, enter a reset state, and tri-state all I/O pins. Host software must reload the FPGA <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> after nCONFIG is activated.</td>
</tr>
<tr>
<td align="center"><code>ninit_done</code></td>
<td>Active low signal indicating FPGA core configuration is complete and FPGA has entered usermode.  This signal is provided by the configuration monitor block in rst_ctrl.sv.</td>
</tr>
<tr>
<td align="center"><code>pcie_reset_status</code></td>
<td>Active high reset status from PCIe hard IP. When driven high, this signal indicates that the PCIe IP core is not ready for usermode.</td>
</tr>
<tr>
<td align="center"><code>locked</code></td>
<td>Active high SYS IOPLL locked signal</td>
</tr>
<tr>
<td align="center"><code>pcie_cold_rst_ack_n</code></td>
<td>Reset Acknowledge signal from the PCIe subsystem that lets the Reset Controller know that the Cold Reset sequence has been completed.</td>
</tr>
<tr>
<td align="center"><code>pcie_warm_rst_ack_n</code></td>
<td>Reset Acknowledge signal from the PCIe subsystem that lets the Reset Controller know that the Warm Reset sequence has been completed.</td>
</tr>
</tbody>
</table>
<p>Upon power-on, the reset module in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> holds the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> in reset until all the reset conditions are de-activated:</p>
<ul>
<li><code>nPERST</code> signal is asserted.</li>
<li>The <code>INIT_DONE</code> pin is driven high to indicate core configuration is complete.</li>
<li>The SYS IOPLL is locked.</li>
<li>The reset status from PCIe hard IP is de-asserted indicating the IP is ready for transfer. </li>
</ul>
<p>The reset module places the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> back into reset if any of these conditions becomes active again.
The only way to invoke a system reset to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> after power-up is to deassert the <code>nPERST</code> pin either by performing a warm reboot or through PCIe driver intervention. There are soft reset signals set aside to allow software to reset the Port, <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and partial reconfiguration IP. </p>
<p>The following table lists the reset outputs from the <code>rst_ctrl.sv</code> block.</p>
<p>​                                                     <br />
<strong>Table 8-2: <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> System Reset Outputs</strong></p>
<table>
<thead>
<tr>
<th align="center">Reset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>rst_n_sys</code> pin</td>
<td>System general reset synchronous to <code>clk_sys</code>.  This is a warm reset of the FPGA logic.  Sticky bits in the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> and other CSR registers will not be reset by this signal.</td>
</tr>
<tr>
<td align="center"><code>rst_n_100m</code> pin</td>
<td>System general reset synchronous to clk_100m.</td>
</tr>
<tr>
<td align="center"><code>ninit_done</code></td>
<td>Active low signal indicating FPGA core configuration is complete and FPGA has entered usermode.  This signal is provided by the configuration monitor block in rst_ctrl.sv.</td>
</tr>
<tr>
<td align="center"><code>pwr_good_n</code></td>
<td>Hardware reset conditioned by <code>ninit_done</code> and the <code>pll_locked</code> signal.  The signal is generally set when power has been cycled or a physical hardware fault has occurred, requiring a reset of the FPGA logic.   This signal is synchronous to <code>clk_sys</code>.</td>
</tr>
<tr>
<td align="center"><code>pcie_cold_rst_ack_n</code></td>
<td>Hardware reset conditioned by the <code>pcie_reset_status</code> which is a summary reset driven by the PCIe Hard IP logic tile on the FPGA die.  This signal is synchronous to <code>clk_sy</code>s.</td>
</tr>
<tr>
<td align="center"><code>pcie_warm_rst_ack_n</code></td>
<td>Soft reset conditioned by <code>nPERST</code> when the pcie_reset_status is not asserted, meaning a warm reset is desired.  Cold reset sticky bits in the PCIe subsystem will not be reset by this signal.</td>
</tr>
</tbody>
</table>
<h2 id="9-interrupts">9 Interrupts<a class="headerlink" href="#9-interrupts" title="Permanent link">&para;</a></h2>
<p>The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> platform supports interrupts through MSI-X feature implemented in the PCIe SS. The MSI-X Interrupt feature handles <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> interrupts. </p>
<h3 id="91-msi-x">9.1 MSI-X<a class="headerlink" href="#91-msi-x" title="Permanent link">&para;</a></h3>
<p><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> interrupts are primarily used to notify the host of error events happened in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. When any of the bits in the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error status registers is set, an interrupt request is sent to the MSI-X module. There are <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error status registers for various FPGA features such as RAS Error, Temperature monitoring etc. If any of those error registers log an error, we trigger an <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> interrupt.</p>
<p>An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> sends an interrupt to the MSI-X module in the PCIE SS on the AXI interrupt request channel. </p>
<p>The MSI-X table entries and PBA vectors are implemented in the PCIE SS. The PCIE SS supports upto 4096 vectors in Static MSI-X mode</p>
<h3 id="92-msi-x-entry-table">9.2 MSI-X Entry Table<a class="headerlink" href="#92-msi-x-entry-table" title="Permanent link">&para;</a></h3>
<p>Each entry in the MSI-X table stores the message address, message data, and vector control for one interrupt vector. The address, data, and vector control information are populated by software (usually done by the PCIe SRIOV driver) after reading the PCIe endpoint configuration space.</p>
<h3 id="93-msi-x-pba-table">9.3 MSI-X PBA Table<a class="headerlink" href="#93-msi-x-pba-table" title="Permanent link">&para;</a></h3>
<p>The PBA table contains a corresponding bit for each MSI-X interrupt vector. This PBA bit is set if that interrupt is triggered but is masked. When the interrupt is unmasked, the PBA bit is unset, and an interrupt is sent to the Host. When the Application generates an interrupt from an IRQ source, it sets the corresponding PBA bit. </p>
<p>When the interrupt is triggered by an IRQ Source, the IRQ Processor checks the masking of that interrupt to determine if the PBA bit should be set. If unmasked, the IRQ Processor looks up MSI-X address and data for the interrupt vector and generates the interrupt request over the PCIe EP.</p>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> implements the pending bit array as per the MSI-X specification.  When interrupts are enabled the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> immediately generates an interrupt in response to a suitable event.  When interrupt vectors are masked, the pending bit array entry for the corresponding interrupt vector is set without issuing an interrupt.  When interrupt vectors are re-enabled, any pending interrupt entries are issued to the PCIe EP</p>
<h3 id="94-interrupts-supported">9.4 Interrupts Supported<a class="headerlink" href="#94-interrupts-supported" title="Permanent link">&para;</a></h3>
<p><strong>Table 9-1: <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Agilex FPGA Interrupts Supported</strong></p>
<table> 
<thead>
<tr>
<th align="center">PF/VF</th>
<th align="center">Vector</th>
<th align="center">Assignment</th>
</tr>
</thead>
<tbody><tr><td rowspan="2">PF0</td> 
<td align="center">0-5</td>
<td align="center">Reserved</td>        
</tr>
<tr><td align="center">6</td>
<td align="center">FME Error Interrupt</td></tr>
<tr><td>PF0.VF0</td><td align="center">0-3</td><td>User AFU Interrupt</td></tr>
</tbody>
</table>

<h3 id="95-msi-x-table-locations">9.5 MSI-X Table Locations<a class="headerlink" href="#95-msi-x-table-locations" title="Permanent link">&para;</a></h3>
<p>The MSI-X vector tables are at BAR4, address 0x2000. The MSI-X PBA tables are at BAR4, address 0x3000.</p>
<p><strong>Table 9-2: PF0 BAR4 Features</strong></p>
<table>
<thead>
<tr>
<th align="center">Offset</th>
<th>Feature CSR set</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0x02000</td>
<td>MSI-X Vector Tables</td>
</tr>
<tr>
<td align="center">0x03000</td>
<td>MSI-X PBA Tables</td>
</tr>
</tbody>
</table>
<h2 id="10-external-memory-interface-emif">10 External Memory Interface (EMIF)<a class="headerlink" href="#10-external-memory-interface-emif" title="Permanent link">&para;</a></h2>
<p>There are 4 EMIF channels (4 DDR4 banks) on the f2000x platform which is targeted <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>  for Intel Agilex FPGA. The HE-MEM exerciser module in <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. ECC is not implemented in this design. Both memory subsystem and HE-MEM implement Arm® AMBA® 4 AXI4-MM interface.</p>
<p>**Table 10-1 Memory Subsystem Configuration on the Intel IPU Platform F2000X-PL platform **</p>
<table>
<thead>
<tr>
<th><strong>EMIF  Channel #</strong></th>
<th><strong>Width</strong></th>
<th><strong>ECC</strong></th>
<th><strong>Size (GB)</strong></th>
<th><strong>Speed  (MT/s)</strong></th>
<th><strong>DDR4 Device</strong></th>
<th><strong>FPGA Bank</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>x32</td>
<td>x8</td>
<td>4</td>
<td>2400</td>
<td>Three 1Gx16</td>
<td>3D</td>
</tr>
<tr>
<td>1</td>
<td>x32</td>
<td>x8</td>
<td>4</td>
<td>2400</td>
<td>Three 1Gx16</td>
<td>3A</td>
</tr>
<tr>
<td>2</td>
<td>x32</td>
<td>x8</td>
<td>4</td>
<td>2400</td>
<td>Three 1Gx16</td>
<td>2F</td>
</tr>
<tr>
<td>3</td>
<td>x32</td>
<td>x8</td>
<td>4</td>
<td>2400</td>
<td>Three 1Gx16</td>
<td>2E</td>
</tr>
</tbody>
</table>
<p><strong>Figure 10-1: EMIF Interfaces</strong></p>
<p><a class="glightbox" href="../images/ofs-ea-emif-interfaces.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ofs-ea-emif-interfaces.png" /></a></p>
<h3 id="101-emif-csr">10.1 EMIF CSR<a class="headerlink" href="#101-emif-csr" title="Permanent link">&para;</a></h3>
<p>TheMIF is implemented as an external <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> feature in <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> EA and the CSR for the EMIF feature is memory mapped to the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> BAR region. The following table captures the EMIF CSR registers.</p>
<p><strong>Table 10-2: EMIF CSR Registers</strong></p>
<table>
<thead>
<tr>
<th><strong>EMIF_DFH</strong></th>
<th><strong>0x000</strong></th>
<th></th>
<th><strong>0x300000001000100F</strong></th>
<th><strong>EMIF Management DFH</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>FIELD NAME</strong></td>
<td><strong>RANGE</strong></td>
<td><strong>ACCESS</strong></td>
<td><strong>DEFAULT</strong></td>
<td><strong>DESCRIPTION</strong></td>
</tr>
<tr>
<td>FeatureType</td>
<td>[63:60]</td>
<td>RO</td>
<td>0x3</td>
<td>Feature Type = Private Feature</td>
</tr>
<tr>
<td>Reserved40</td>
<td>[59:40]</td>
<td>RsvdZ</td>
<td>0x0</td>
<td>Reserved</td>
</tr>
<tr>
<td>NextDfhByteOffset</td>
<td>[39:16]</td>
<td>RO</td>
<td>0x1000</td>
<td>Next DFH Byte  offset</td>
</tr>
<tr>
<td>FeatureRev</td>
<td>[15:12]</td>
<td>RO</td>
<td>0x1</td>
<td>Feature Revision</td>
</tr>
<tr>
<td>FeatureID</td>
<td>[11:0]</td>
<td>RO</td>
<td>0x00F</td>
<td>Feature Id</td>
</tr>
</tbody>
</table>
<p>​               </p>
<table>
<thead>
<tr>
<th><strong>EMIF_STAT</strong></th>
<th><strong>0x008</strong></th>
<th></th>
<th><strong>0x0000000000000000</strong></th>
<th><strong>EMIF Calibration Status</strong> <strong>Register</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>FIELD NAME</strong></td>
<td><strong>RANGE</strong></td>
<td><strong>ACCESS</strong></td>
<td><strong>DEFAULT</strong></td>
<td><strong>DESCRIPTION</strong></td>
</tr>
<tr>
<td>Reserved</td>
<td>[63:8]</td>
<td>RsvdZ</td>
<td>0x0</td>
<td>Reserved</td>
</tr>
<tr>
<td>CalFaliure</td>
<td>[7:4]</td>
<td>RO</td>
<td>0x0</td>
<td>EMIF PHY Calibration Failure (1 bit per interface)</td>
</tr>
<tr>
<td>CalSuccess</td>
<td>[3:0]</td>
<td>RO</td>
<td>0x0</td>
<td>EMIF PHY  Calibration Successful (1 bit per  interface)</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th><strong>EMIF_CAPABILI TY</strong></th>
<th><strong>0x010</strong></th>
<th></th>
<th><strong>0x000000000000000F</strong></th>
<th><strong>EMIF Capabliity Register</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>FIELD NAME</strong></td>
<td><strong>RANGE</strong></td>
<td><strong>ACCESS</strong></td>
<td><strong>DEFAULT</strong></td>
<td><strong>DESCRIPTION</strong></td>
</tr>
<tr>
<td>Reserved</td>
<td>[63:4]</td>
<td>RsvdZ</td>
<td>0x0</td>
<td>Reserved</td>
</tr>
<tr>
<td>EMIFCap</td>
<td>[3:0]</td>
<td>RO</td>
<td>0xF</td>
<td>Attached Memory  Capability (1 bit per  interface)</td>
</tr>
</tbody>
</table>
<h2 id="11-ethernet-interface-subsystem">11 Ethernet Interface Subsystem<a class="headerlink" href="#11-ethernet-interface-subsystem" title="Permanent link">&para;</a></h2>
<h3 id="111-ethernet-interface-overview">11.1 Ethernet Interface Overview<a class="headerlink" href="#111-ethernet-interface-overview" title="Permanent link">&para;</a></h3>
<p>The Ethernet Subsystem provides portability to different Ethernet configurations across platforms and generations and reusability of the hardware framework and software stack. This reference <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> implements an E-tile Ethernet Subsystem IP in a 2x4x25GbE configuration and provides a Linux driver that can be leveraged for customization. Each group of 4x25GbE routes to a QSFP.</p>
<p>For more information about how to reconfigure the Ethernet Subsystem please refer to the [Ethernet Subsystem Intel FPGA IP].</p>
<p><strong>Table 11-1: Ethernet Configurations for example <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> FIMs for Agilex FPGAs</strong></p>
<table>
<thead>
<tr>
<th>Configuration/Mode</th>
<th>Base Fim</th>
</tr>
</thead>
<tbody>
<tr>
<td>IP file name</td>
<td>hssi_ss_8x25g</td>
</tr>
<tr>
<td>Number of ports enabled</td>
<td>8</td>
</tr>
<tr>
<td>Enabled ports</td>
<td>Port 0-7</td>
</tr>
<tr>
<td>Port{x} profile</td>
<td>25GbE</td>
</tr>
<tr>
<td>Port{x} subprofile</td>
<td>MAC+PCS</td>
</tr>
<tr>
<td>Port{x} RSFEC</td>
<td>True</td>
</tr>
<tr>
<td>Port{x} PTP</td>
<td>False</td>
</tr>
<tr>
<td>Enable AN/LT</td>
<td>False (for simulation efficiency)</td>
</tr>
<tr>
<td>Enable NPDME</td>
<td>True</td>
</tr>
<tr>
<td>Enable <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> to Avalon master bridge</td>
<td>False</td>
</tr>
<tr>
<td>Enable Tx packet classifier</td>
<td>NA</td>
</tr>
<tr>
<td>PTP accuracy mode</td>
<td>NA</td>
</tr>
<tr>
<td>Enable iCAL and pCAL recipe at power</td>
<td>True</td>
</tr>
<tr>
<td>TX/RX maximum frame size</td>
<td>1518</td>
</tr>
<tr>
<td>Enforce maximum frame size</td>
<td>False</td>
</tr>
<tr>
<td>Link fault generation mode</td>
<td>Bidirectional</td>
</tr>
<tr>
<td>Stop TX traffic when link partner sends PAUSE</td>
<td>Yes</td>
</tr>
<tr>
<td>Bytes to remove from RX frames</td>
<td>Remove CRC bytes</td>
</tr>
<tr>
<td>Forward RX PAUSE requests</td>
<td>False</td>
</tr>
<tr>
<td>Use source address insertion</td>
<td>False</td>
</tr>
<tr>
<td>Enable TX/RX VLAN detection</td>
<td>True</td>
</tr>
<tr>
<td>Enable asynchronous adapter clocks</td>
<td>False</td>
</tr>
<tr>
<td>Enable preamble Passthrough</td>
<td>False</td>
</tr>
<tr>
<td>Enable asynchronous adapter clocks</td>
<td>False</td>
</tr>
<tr>
<td>Enable strict preamble check</td>
<td>False</td>
</tr>
<tr>
<td>Enable strict SFD check</td>
<td>False</td>
</tr>
<tr>
<td>Average IPG</td>
<td>12</td>
</tr>
<tr>
<td>Enable adaptation load soft IP</td>
<td>True</td>
</tr>
<tr>
<td>Additional IPG removed as per AM period</td>
<td>0</td>
</tr>
<tr>
<td>PMA adaptation select</td>
<td>NRZ_28Gbps_VSR</td>
</tr>
</tbody>
</table>
<p>To determine which Transceiver Subsystem port maps to the QSFP A and B lanes, please refer to the following table:</p>
<p><strong>Table 11-2: Transceiver Subsystem Port Mapping</strong></p>
<table>
<thead>
<tr>
<th>Port Number</th>
<th>base 2x4x25G</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>QSFP-A Lane-0</td>
</tr>
<tr>
<td>1</td>
<td>QSFP-A Lane-1</td>
</tr>
<tr>
<td>2</td>
<td>QSFP-A Lane-2</td>
</tr>
<tr>
<td>3</td>
<td>QSFP-A Lane-3</td>
</tr>
<tr>
<td>4</td>
<td>QSFP-B Lane-0</td>
</tr>
<tr>
<td>5</td>
<td>QSFP-B Lane-1</td>
</tr>
<tr>
<td>6</td>
<td>QSFP-B Lane-2</td>
</tr>
<tr>
<td>7</td>
<td>QSFP-B Lane-3</td>
</tr>
<tr>
<td>8</td>
<td>NA</td>
</tr>
<tr>
<td>9</td>
<td>NA</td>
</tr>
<tr>
<td>10</td>
<td>NA</td>
</tr>
<tr>
<td>11</td>
<td>NA</td>
</tr>
<tr>
<td>12</td>
<td>NA</td>
</tr>
<tr>
<td>13</td>
<td>NA</td>
</tr>
<tr>
<td>14</td>
<td>NA</td>
</tr>
<tr>
<td>15</td>
<td>NA</td>
</tr>
</tbody>
</table>
<p><strong>Figure 11-1: Transceiver Subsystem Block Diagram</strong></p>
<p><a class="glightbox" href="../images/transceiver-ss.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/transceiver-ss.png" /></a></p>
<p>A host exerciser, named he-hssi, is provided in the pr_slot of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> partition. The Transceiver susbystem interface to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> has an Arm® AMBA® 4 AXI4-Stream data and sideband interface.  </p>
<h3 id="112-ofs-ethernet-subsystem-interface-module">11.2 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>  Ethernet Subsystem Interface Module<a class="headerlink" href="#112-ofs-ethernet-subsystem-interface-module" title="Permanent link">&para;</a></h3>
<p>A wrapper around the  Ethernet Subsystem integrates the following features:</p>
<ul>
<li>DFH registers </li>
<li>Control &amp; status registers </li>
<li>Indirect access to Transceiver SS CSR registers via CSR mailbox in the Ethernet Subsystem interface </li>
</ul>
<h4 id="1121-ethernet-subsystem-control-and-status-register-csr-map">11.2.1 Ethernet Subsystem Control and Status Register (CSR) Map<a class="headerlink" href="#1121-ethernet-subsystem-control-and-status-register-csr-map" title="Permanent link">&para;</a></h4>
<p>The Ethernet Subsystem connects to the APF which is memory mapped to PF0 BAR0. The Ethernet Subsystem CSR space in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> consists of two parts:</p>
<ul>
<li>Ethernet Subsystem CSRs assigned from offset 0x000 to 0x7FF</li>
<li>Additional CSRs are added to <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> at offset 0x800 to 0xFFF</li>
</ul>
<p>The PCIe subsystem uses Arm® AMBA® 4 AXI4 Memory Mapped accesses to read and write Ethernet Subsystem Control and Status Registers in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. The Ethernet Subsystem CSR Map structure is designed to scale according to IP capabilities.</p>
<p>The Ethernet Subsystem CSR Map can be found <code>ipss/hssi/HSSI_SS_CSR.xls</code>.</p>
<h3 id="114-ethernet-subsytem-software">11.4 Ethernet Subsytem Software<a class="headerlink" href="#114-ethernet-subsytem-software" title="Permanent link">&para;</a></h3>
<p>There are two pieces of software related to running the Ethernet Subsystem: The Linux* dfl network driver and the user space OPAE Tools.</p>
<h4 id="1141-ethernet-subsystem-linux-driver">11.4.1 Ethernet Subsystem Linux Driver<a class="headerlink" href="#1141-ethernet-subsystem-linux-driver" title="Permanent link">&para;</a></h4>
<p>The Ethernet subystem is exposed as a feature in the PCIe PF BAR0 region. It has a Device Feature Header (DFH) specifying the interface.</p>
<p>The primary functionality of the driver is to interact with the ethernet MAC and PHY through an indirect register access mailbox implemented by the HSSI_RCFG_CMD0, HSSI_RCFG_DATA0 registers described above. To aid in RTL bringup, the driver provides a debugfs interface directly to the indirect register access mailbox. For each HSSI interface in the system there would be a directory with the following form containing two files, regaddr and regval: /sys/kernel/debug/dfl-fme.X.Y</p>
<p>To read a register offset in the MAC/PHY write the offset to the regaddr file as a C hex string (e.g. 0x04) and then read the value as string out of regval file. To write a register offset in the MAC/PHY write the offset to the regaddr file as a C hex string (e.g. 0x04) and then write the value as a C hex string to regval file.</p>
<h4 id="1142-ethernet-subsystem-opae-user-space-tool">11.4.2 Ethernet Subsystem OPAE User Space Tool<a class="headerlink" href="#1142-ethernet-subsystem-opae-user-space-tool" title="Permanent link">&para;</a></h4>
<p>User space OPAE Tools that are part of <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> provide support for the Ethernet Subsystem. You can use the --help option to print more information about each of these commands:</p>
<ul>
<li>hssi: Provides a means of interacting with the 10G and 100G HSSI AFUs through the host exerciser.</li>
<li>hssiloopback: Enables and disables Ethernet loopback.</li>
<li>hssistats: Provides MAC statistics.</li>
</ul>
<h2 id="12-partial-reconfiguration">12 Partial Reconfiguration<a class="headerlink" href="#12-partial-reconfiguration" title="Permanent link">&para;</a></h2>
<p>Partial Reconfiguration (<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>) is an Intel FPGA technology that allows users to reconfigure parts of the FPGA device dynamically, while the remainder of the device continues to operate. In a non-partial reconfiguration flow, any change to the design requires full reprogramming of the entire configuration RAM (CRAM) arrays in the device. With partial reconfiguration, you can dynamically reprogram one or more CRAM frames. A partial reconfiguration design has a static region, and a <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> regions, which can be modified to implement new logic. The portion of the CRAM on the chip to be reconfigured is contained within a <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region. For the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> flow, your design must be partitioned into static region and reconfigurable region. The static region is the area of your FPGA that is not reconfigured without reprogramming the entire FPGA. An area of the chip that you plan to partially reconfigure is a <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region.</p>
<p>The Port Gasket contains all the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> specific modules and logic, such as <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> slot reset/freeze control, user clock, remote STP etc. For this reference example only one <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> slot is supported.</p>
<p>The Figure below shows the fundamental concepts required to support <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> in <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> platform. There are 4 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> management DFH – <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>, Port, User Clock and Remote STP in Port Gasket that is exposed to <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> software. These platform capabilities are generally used in conjunction to Partial Reconfiguration. The Figure below also demonstrates the concepts of adding a new interface to the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region.</p>
<p><strong>Figure 12-1 Partial Reconfiguration Gasket</strong></p>
<p><a class="glightbox" href="../images/PR_blockdiagram.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="PR_block" src="../images/PR_blockdiagram.png" /></a></p>
<p>The isolation logic is provided on the output signals of the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region to ensure they don’t glitch and affect the interfacing logic in the Static Region (SR). The isolation logic is controlled by the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Freeze logic during <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> operation.</p>
<h3 id="121-user-clock-support">12.1 User Clock Support<a class="headerlink" href="#121-user-clock-support" title="Permanent link">&para;</a></h3>
<p>The reference platform provides two user configurable clock (uclk_usr, uclk_usr_div2) for use by the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. These clocks are generated by a reconfigurable IOPLL. The control and status of these clocks is expose through two pairs of command and status registers (USR_CLK_FREQ_CMD0 / USR_CLK_FREQ_STS0 &amp; USR_CLK_FREQ_CMD1 / USR_CLK_FREQ_STS1). The first pair controls the fPLL reconfiguration functionality. The second pair controls a clock frequency measurement block.</p>
<p>The following are the default values of the userclk.</p>
<p>uclk_usr: 312.5 MHz</p>
<p>uclk_usr_div2: 156.2 MHz</p>
<p><strong>Table 12-1 usr_clk_* Acceptable Programming Range</strong></p>
<table>
<thead>
<tr>
<th>Fabric Frequency Range</th>
<th>uclk_usr (H)</th>
<th>uclk_usr_div2 (L)</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>0-400 MHz</td>
<td>0-800 MHz</td>
<td>0-400 MHz</td>
<td>Clocks set on 2x relationship for L&lt;400 MHz</td>
</tr>
<tr>
<td>400-800 MHz</td>
<td>400-800 MHz</td>
<td>400-800 MHz</td>
<td>Clks are equal for L&gt;400 MHz</td>
</tr>
</tbody>
</table>
<p><strong>PLL Reconfiguration</strong></p>
<p>The blue bit stream hardware exposes the low level IOPLL reconfiguration interfaces directly to software control. Through the USR_CLK_FREQ_CMD0 register software can select the reference clock, assert the PLL power down pin and issue reads and writes on the IOPLL Avalon-mm reconfiguration bus. Through the USR_CLK_FREQ_STS0 register software can query the IOPLL active reference clock, locked status and readdata returned from the IOPLL AVMM interface for read requests.</p>
<p><strong>Clock Frequency Counter</strong></p>
<p>The user clocks, generated by the reconfigurable IOPLL, are connected to a frequency measurement circuit. Software selects which of the two clocks to measure by setting the clock select bit in the USER_CLK_FREQ_CMD1 register. After 10ms software can read the frequency, in 10 KHz units, from the USER_CLK_FREQ_STS1 register. Reading this register before 10ms has passed will return undefined data but otherwise has no effect.</p>
<p><strong>Configuring User Clocks</strong></p>
<p>To program the user clock to the desired frequency, user will set the clock-frequency-low and clock-frequency-high fields in the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> GBS .json file to the desired frequency value. During <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>, SW will try to provide the closest possible frequency to the value specified in the .json file.</p>
<h3 id="13-host-exercisers">13 Host Exercisers<a class="headerlink" href="#13-host-exercisers" title="Permanent link">&para;</a></h3>
<p>The Host Exerciser (HE) modules are responsible for generating traffic with the intent of exercising the specific interface they are designed to connect to. They are intended to test the interface in simulation and hardware, enable measurement of bandwidth and other performance KPIs and, in some cases, provide an example of data movement between interfaces (PCIe to DDR for e.g.) for adoption into a customer application.</p>
<h3 id="131-he-lb-and-he-mem-host-exerciser">13.1 HE-LB and HE-MEM Host Exerciser<a class="headerlink" href="#131-he-lb-and-he-mem-host-exerciser" title="Permanent link">&para;</a></h3>
<p>The Host Exerciser Loopback module is a traffic generator that can be attached both to host memory, over PCIe (HE-LB), and to local memory, such as board-attached DDR (HE-MEM). The Host Exerciser (HE) is responsible for generating traffic with the intention of exercising the path from the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to the Host at full bandwidth as well as demonstrating data path correctness. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> picks up the HE-LB module behind the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> (Platform Interface Manager). The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> converts the Arm® AMBA® 4 AXI4 with TLP out of the PCIe SS to standard Arm® AMBA® 4 AXI4 (MM for completions and Lite for CSR) interfaces. The figure below shows how the HE-LB is instantiated in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.</p>
<p><strong>Figure 13-1 HE-LB Dataflow Diagram</strong> </p>
<p><a class="glightbox" href="../images/he-lb.svg" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="drawing" src="../images/he-lb.svg" /></a></p>
<p>The exerciser has two primary modes: loopback, in which read data is fed back as writes, and read/write mode, in which reads and writes are generated independently. Furthermore, the host_exerciser software provided with OPAE that drives the RTL has two major modes: "lpbk" and "mem". These modes only select the UUID of the HE <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, with lpbk selecting a version configured with no local memory (56e203e9-864f-49a7-b94b-12284c31e02b) and mem seeking a version with local memory (8568ab4e-6ba5-4616-bb65-2a578330a8eb). The behavior of each engine with and without local memory is described below.</p>
<p><strong>Figure 13-2 HE Engine Heirarchy</strong> </p>
<pre class="mermaid"><code>flowchart TB
    classDef gr fill:green,color:white;
    classDef ol fill:olive,color:white;
    classDef rd fill:maroon,color:white;

    he_lb("he_lb_top"):::gr --- he_lb_main
    he_mem("he_mem_top"):::gr --- he_lb_main
    he_lb_main:::gr ---- he_lb_engines
    he_lb_engines:::gr ---- mode_rdwr:::rd
    he_lb_engines:::gr ---- mode_lpbk:::rd
    he_lb_engines:::gr ---- mode_atomic:::rd
    he_lb_main --- he_lb_csr:::ol</code></pre>
<p>For more details of HE-LB and HE-MEM IP, please refer to ofs-fim-common/src/common/he_lb/README.md</p>
<h3 id="132-memory-traffic-generator-he-mem-tg">13.2 Memory Traffic Generator  (HE-MEM-TG)<a class="headerlink" href="#132-memory-traffic-generator-he-mem-tg" title="Permanent link">&para;</a></h3>
<p>The memory traffic generator (TG) <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> provides a way for users to characterize local memory channel bandwidth with a variety of traffic configuration features including request burst size, read/write interleave count, address offset, address strobe, and data pattern.</p>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> consists of a series of configurable Arm® AMBA® 4 AXI4-MM traffic generators connected to the available local memory channels not attached to HE-MEM. It has a separate CSR block for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> feature information and high-level status, including a TG_CAPABILITY register that describes the available traffic generators with a 1 bit active high mask and a TG_STAT register that provides the 4-bit, one-hot status of each TG in adjacent fields. The status is decoded left to right as follows: pass, fail, timeout, active. For additional detail, refer to the MEM_TG CSR table ofs-fim-common/src/common/mem_tg/MEM_TG_CSR.xls</p>
<p>Each traffic generator is configured through a separate Avalon-MM interface at incremental offsets of 0x1000 from the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> DFH. For details on the TG2 configuration space, refer to the MEM_TG_CSR.xls. The default configuration for each TG performs a single-word write followed by a read at address 0. Triggering the start of the test on a TG will initiate a counter to measure the duration of the test which is recorded in the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSR block and used to report memory channel bandwidth.</p>
<p><a class="glightbox" href="images\mem-tg.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="images\mem-tg.png" /></a></p>
<h3 id="132-hssi-host-exerciser-he-hssi">13.2 HSSI Host Exerciser (HE-HSSI)<a class="headerlink" href="#132-hssi-host-exerciser-he-hssi" title="Permanent link">&para;</a></h3>
<p>HE-HSSI is an Ethernet <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that handles client side ethernet traffic. The reference HE-HSSI has following features:</p>
<ul>
<li>HE-HSSI provides an E-tile compatible interface with the Transceiver Subsystem.</li>
<li>Includes a traffic generator and checker or monitor</li>
<li>Provides pause signals to the Transceiver Subsystem for XON and XOFF generation</li>
<li>Generates traffic or incoming traffic that can be looped back into transmit path by enabling loopback mode, which will bypass traffic generator</li>
<li>At the HE-HSSI interface boundary the Ethernet data interface is Arm® AMBA® 4 AXI4-Stream with 64-bit data at eth_clk clock</li>
<li>The Traffic generator and checker modules have a 64-bit data interface at eth_clk clock.</li>
<li>The traffic generator supports the following modes:<ul>
<li>Fixed length or Random Length</li>
<li>Incremental pattern or Random pattern</li>
</ul>
</li>
<li>Traffic checker does a 32-bit crc check in 10/25G. In the 100G configuration, there is no data integrity check, only a packet counter.</li>
<li>The CSR of this <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is accessible through Arm® AMBA® 4 AXI4-Stream PCIe TLP interface</li>
<li>The PCIe TLP to CSR Interface Conversion module converts PCIe TLPs into simple CSR interface</li>
<li>The CSR space of the traffic generator and checker modules are accessed in an indirect way using mailbox registers</li>
<li>If used for more than one channel, each channel has a separate traffic generator and traffic checker with separate CSR space.</li>
<li>Reads and Writes to individual traffic controller CSR spaces can be done by selecting that particular channel using channel select register.</li>
</ul>
<p>The HE-HSSI Ethernet block diagram is below.</p>
<p><strong>Figure 13-3: HE-HSSI Block Diagram Block Diagram</strong></p>
<p><a class="glightbox" href="../images/OFS-EA-HSSI-AFU-datapath.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="he-hssi-afu" src="../images/OFS-EA-HSSI-AFU-datapath.png" /></a></p>
<p>The diagram below shows the path followed depending on if you enable loopback mode in HE-HSSI or not. In loopback mode, traffic is looped back into the transmit path which will bypass traffic. Alternatively, the traffic generates traffic.</p>
<p><strong>Figure 13-4: HE-HSSI Operation Mode Traffic Patterns</strong> <a class="glightbox" href="../images/HE-HSSI-modes.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="drawing" src="../images/HE-HSSI-modes.png" /></a></p>
<h4 id="1322-he-hssi-csr-map">13.2.2 HE-HSSI CSR Map<a class="headerlink" href="#1322-he-hssi-csr-map" title="Permanent link">&para;</a></h4>
<p>The reference HSSI <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> contains the following registers and a similar arrangement of register space can be implemented for other use case-specific HSSI AFUs.</p>
<ul>
<li><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> DFH Register: Device feature header for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> (AFU_DFH)</li>
<li><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> ID Registers: 128-bit UUID for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> which occupies two 64-bit registers (AFU_ID_L, AFU_ID_H)</li>
<li>Mailbox Registers: Command and Data register for traffic controller register access. It follows the standard access method defined for <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>. Access method and implementation is same as Reconfiguration Interface defined for the HSSI <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. (TRAFFIC_CTRL_CMD, TRAFFIC_CTRL_DATA)</li>
<li>Channel Select Register: Channel select register for traffic controller mailbox access. It is used in cases where more than one channel is in the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, else it defaults to zero, meaning channel-0 is selected. (TRAFFIC_CTRL_PORT_SEL)</li>
<li>Scratchpad Register: Scratchpad register for CSR access checking. (AFU_SCRATCHPAD)</li>
</ul>
<p>The CSR excel for HE-HSSI module can be found at ofs-fim-common/src/common/he_hssi/HE_HSSI_CSR.xls.</p>
<h3 id="133-he-null-overview">13.3 HE-Null Overview<a class="headerlink" href="#133-he-null-overview" title="Permanent link">&para;</a></h3>
<p>This module is a simple stub that is used to replace various HE and other blocks in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> whenever they are bypassed using the qsf compiler directive such as null_he_lb, null_he_hssi, null_he_mem and null_he_mem_tg. To find out more about these compiler directives, refer to the [Intel® FPGA Interface Manager Developer Guide: <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel® Agilex® PCIe Attach FPGAs].</p>
<p><strong>Table 13-1 HE-Null DFH</strong></p>
<table>
<thead>
<tr>
<th>REGISTER NAME</th>
<th>ADDRESS</th>
<th>ACCESS</th>
<th>DEFAULT</th>
<th>DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr>
<td>DFH</td>
<td>0x0000</td>
<td>RO</td>
<td>0x0000_0000_1000_0000</td>
<td>DFH register</td>
</tr>
<tr>
<td>GUID_L</td>
<td>0x0008</td>
<td>RO</td>
<td>0xaa31f54a3e403501</td>
<td>Lower 64b of GUID</td>
</tr>
<tr>
<td>GUID_H</td>
<td>0x0010</td>
<td>RO</td>
<td>0x3e7b60a0df2d4850</td>
<td>Upper 64b of GUID</td>
</tr>
<tr>
<td>SCRATCHPAD</td>
<td>0x0018</td>
<td>RW</td>
<td>0x0</td>
<td>Scratchpad</td>
</tr>
</tbody>
</table>
<p><strong>Figure 13-5: HE-Null Block Diagram</strong></p>
<p><a class="glightbox" href="../images/he-null-diagram.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="he-null" src="../images/he-null-diagram.png" /></a></p>
<h2 id="14-reliability-accessibility-serviceability-ras-and-error-handling">14 Reliability, Accessibility, Serviceability (RAS) and Error Handling<a class="headerlink" href="#14-reliability-accessibility-serviceability-ras-and-error-handling" title="Permanent link">&para;</a></h2>
<ol>
<li>Downstream <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> checker: Identifies <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> violations.  For example, these checker flags violations of the interface specification. </li>
<li>Upstream software or PCIe link checker: Identifies invalid traffic from PCIe that violates <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> or PCIe specifications. For example, this checker flags an application sending traffic if it violates the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> specification or creates a PCIe link issue by causing completion timeout or malformed TLP. </li>
<li><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> - Checks for bugs in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> fabric.</li>
</ol>
<p>Errors reported by the checker are logged in either the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error registers port error registers, or both, as shown in the table below.  For more details on each of the registers, please refer to <a href="https://github.com/OFS/ofs-fim-common/blob/release/ofs-2023.1/src/common/fme/xls/osc/FME_CSR.xls">FME_CSR.xls</a></p>
<p><strong>Table 14-1: Error Registers</strong></p>
<table>
<thead>
<tr>
<th align="center"><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Region</th>
<th align="center">Area</th>
<th>Register</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td align="center">CoreFIM</td>
<td>FME_ERROR</td>
<td><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Error Status Register 0.  Registers parity errors, underflow or overflow errors and access mismatches.</td>
</tr>
<tr>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td align="center">CoreFIM</td>
<td>FME_ERROR0_MASK</td>
<td><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Error Mask Register 0.  Write a 0 to mask errors in the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Error Status Register 0.</td>
</tr>
<tr>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td align="center">External</td>
<td>PCIE0_ERROR</td>
<td>PCIe0 Error Status Register.</td>
</tr>
<tr>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td align="center">External</td>
<td>PCIE0_ERROR_MASK</td>
<td>PCIe0 Error Mask Register 0.  Write a 0 to mask errors in the PCIe0 Error Status Register 0.</td>
</tr>
<tr>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td align="center">CoreFIM</td>
<td>FME_FIRST_ERROR</td>
<td>First <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Error Register.</td>
</tr>
<tr>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td align="center">CoreFIM</td>
<td>FME_NEXT_ERROR</td>
<td><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Next Error Register.</td>
</tr>
<tr>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td align="center">CoreFIM</td>
<td>RAS_NOFAT_ERR_STAT</td>
<td>Reliability/Accessibility/Serviceability (RAS) Non-Fatal Error Status Register.</td>
</tr>
<tr>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td align="center">CoreFIM</td>
<td>RAS_NOFAT_ERR_MASK</td>
<td>RAS Non-Fatal Error Mask Register. Write 0 to mask error fields in RAS_NOFAT_ERR_STAT Register.</td>
</tr>
<tr>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td align="center">CoreFIM</td>
<td>RAS_CATFAT_ERR_STAT</td>
<td>RAS Catastrophic and Fatal Errors Status Register.</td>
</tr>
<tr>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td align="center">CoreFIM</td>
<td>RAS_CATFAT_ERR_MASK</td>
<td>RAS Catastrophic and Fatal Errors Mask Register. Write 0 to mask error fields in the RAS_CATFAT_ERR_STAT Register.</td>
</tr>
<tr>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td align="center">CoreFIM</td>
<td>RAS_ERROR_INJ</td>
<td>RAS error Injection Register.</td>
</tr>
<tr>
<td align="center">PORT</td>
<td align="center">CoreFIM</td>
<td>PORT_ERROR</td>
<td>Port Error Status Register.</td>
</tr>
<tr>
<td align="center">PORT</td>
<td align="center">CoreFIM</td>
<td>PORT_FIRST_ERROR</td>
<td>Port First Error Register .</td>
</tr>
<tr>
<td align="center">PORT</td>
<td align="center">CoreFIM</td>
<td>PORT_MALFORMED_REQ0</td>
<td>Port Malformed Request Register 0.  Provides malformed request header LSBs.</td>
</tr>
<tr>
<td align="center">PORT</td>
<td align="center">CoreFIM</td>
<td>PORT_MALFORMED_REQ1</td>
<td>Port Malformed Request Register 1.  Provides malformed request header MSBs.</td>
</tr>
</tbody>
</table>
<h3 id="141-fme-errors">14.1 <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Errors<a class="headerlink" href="#141-fme-errors" title="Permanent link">&para;</a></h3>
<h4 id="1411-fme_error0">14.1.1 FME_ERROR0<a class="headerlink" href="#1411-fme_error0" title="Permanent link">&para;</a></h4>
<p>The FME_ERROR0 register flags CoreFIM <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> errors in the Global Error (GLBL_ERROR) private feature. The error bits in this register are sticky bits. You can only clear these bits through software or through a system reset. Writing a 1 to the error field in the register clears the corresponding error bit. Writing a 1 to the corresponding bit in FME_ERROR0_MASK register masks the error.</p>
<p><strong>Table 14-2: <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Error Types</strong></p>
<table>
<thead>
<tr>
<th align="center">Error Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Fabric errors</td>
<td>FIFO underflow/overflow condition in CoreFIM. These errors only occur if you have introduced bugs into the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> or during very rare single event upset (SEU) or SEU-like events.</td>
</tr>
<tr>
<td align="center">Invalid port access</td>
<td>A port can either be mapped to a PF or a VF, and not both. The checker reads the <code>AfuAccessCtrl</code> field in the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> CSR PORT0_OFFSET register to determine the access type of the Port. If it finds a PF is trying to access a port that is mapped to a VF or vice-versa, an error will be reported.</td>
</tr>
<tr>
<td align="center">Invalid <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> access</td>
<td>An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> can either be mapped to a PF or a VF, and not both. The checker reads the <code>AfuAccessCtrl</code> field in the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> CSR PORT0_OFFSET register to determine the access type of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> associated with the Port. If it finds a PF is trying to access an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that is mapped to a VF or vice-versa, an error is reported and a fake response is sent back to the requester to avoid a completion timeout on the host.</td>
</tr>
</tbody>
</table>
<h4 id="1412-pcie0_error">14.1.2 PCIE0_ERROR<a class="headerlink" href="#1412-pcie0_error" title="Permanent link">&para;</a></h4>
<p>The PCIe Avalon-ST to Arm® AMBA® 4 AXI4-Stream bridge monitors the PCIe link for errors and logs any such errors in the PCIE0_ERROR register (in PCIE0 feature region) and PCIE0_ERROR register in the GLBL_ERR private feature.    The error bits in the PCIE0_ERROR register are sticky bits that you can only clear through software or through a system reset. Writing a 1 to the error field in the register clears the corresponding error bit. Writing a 1 to the corresponding bit in PCIE0_ERROR0_MASK masks the error.  </p>
<p>If you have other external <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> features, you can add similar <external_module>_ERROR registers to this space. Please refer to the following spreadsheet: https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/ofs-f2000x-pl/ipss/pcie/rtl/PCIE_CSR.xls or the SystemVerilog file: https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/ofs-f2000x-pl/ipss/pcie/rtl/pcie_csr.sv for more details on this register. </p>
<hr />
<p><strong>NOTE</strong></p>
<p>The PCIE0_ERROR register is located in both the Global Error external feature memory space and a separate PCIe external feature memory space.  OPAE software supports the PCIe external feature memory space beginning at offset 0x40000 for <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> EA and going forward.  PCIe registers beginning at 0x4000 in the Global Error external feature memory space are there for backward compatibility to the Intel® Infrastructure Processing Unit (Intel® IPU) Platform F2000X-PL</p>
<hr />
<h4 id="1413-fme_first_error-fme_next_error">14.1.3 FME_FIRST_ERROR, FME_NEXT_ERROR<a class="headerlink" href="#1413-fme_first_error-fme_next_error" title="Permanent link">&para;</a></h4>
<p>The FME_FIRST_ERROR register flags which of the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error reporting registers, such as FME_ERROR0, PCIE0_ERROR0, has reported the first error occurrence. The error fields of the first error register are then continuously logged into the FME_FIRST_ERROR register until a system reset or software clears all the errors in that first error register.
Likewise, the FME_NEXT_ERROR indicates which of the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error reporting registers (except the first error register) has reported the next occurrence of error after the first error register. The error fields of the next error register are continuously logged into the FME_NEXT_ERROR register until a system reset or software clears all the errors in the second error register.</p>
<p>Please refer to <a href="https://github.com/OFS/ofs-fim-common/blob/release/ofs-2023.1/src/common/fme/fme_csr.sv">fme_csr.sv</a> for individual register field descriptions or the SystemVerilog file: <a href="https://github.com/OFS/ofs-fim-common/blob/release/ofs-2023.1/src/common/fme/fme_csr.sv">fme_csr.sv</a></p>
<h4 id="1414-reliability-accessibility-serviceability-ras-error-status">14.1.4 Reliability, Accessibility, Serviceability (RAS) Error Status<a class="headerlink" href="#1414-reliability-accessibility-serviceability-ras-error-status" title="Permanent link">&para;</a></h4>
<p>The RAS feature in CoreFIM labels errors as non-fatal, fatal or catastrophic based on their impact to the system. 
* A non-fatal error usually originates from software or an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.  With a non-fatal error, the user application may still be able to recover from the error by performing a soft reset on the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, fixing the user application software if necessary, and clearing the error. On the other hand, a fatal or catastrophic error is non-recoverable and requires the platform to be reset.
* Non-fatal errors are logged in the RAS_NOFAT_ERR_STAT register and fatal or catastrophic errors are logged in the RAS_CATFAT_ERR_STAT register.</p>
<h5 id="14141-non-fatal-errors">14.1.4.1 Non-Fatal Errors<a class="headerlink" href="#14141-non-fatal-errors" title="Permanent link">&para;</a></h5>
<p>The RAS_NOFAT_ERR_STAT is a read-only status register that is specifically added for the RAS feature. It logs the high-level status of non-fatal errors in the hardware.  Unlike the error bits in the PCIE0_ERROR and FME_ERROR0 registers which are RW1C (software can write a 1 to clear the error), the error bits in this register are read-only and can only be cleared by system reset. Software has an option to mask the error using RAS_NOFAT_ERR_MASK.</p>
<p>Please refer to <a href="https://github.com/OFS/ofs-fim-common/blob/release/ofs-2023.1/src/common/fme/xls/osc/FME_CSR.xls">FME_CSR.xls</a> for individual register field descriptions or the SystemVerilog file: <a href="https://github.com/OFS/ofs-fim-common/blob/release/ofs-2023.1/src/common/fme/fme_csr.sv">fme_csr.sv</a></p>
<h5 id="14142-catastrophic-fatal-errors">14.1.4.2 Catastrophic &amp; Fatal Errors<a class="headerlink" href="#14142-catastrophic-fatal-errors" title="Permanent link">&para;</a></h5>
<p>The RAS_CATFAT_ERR_STAT is a read-only status register that is specifically added for the RAS feature. It captures the high-level status of errors that can only be recovered with a system reset. Therefore, the error bits in the RAS_CATFAT_ERR_STAT register are read-only and can only be cleared by system reset or masked through RAS_CATFAT_ERR_MASK.
Please refer to <a href="https://github.com/OFS/ofs-fim-common/blob/release/ofs-2023.1/src/common/fme/xls/osc/FME_CSR.xls">FME_CSR.xls</a> for individual register field descriptions or the SystemVerilog file: <a href="https://github.com/OFS/ofs-fim-common/blob/release/ofs-2023.1/src/common/fme/fme_csr.sv">fme_csr.sv</a></p>
<h4 id="1415-ras-error-injection">14.1.5 RAS Error Injection<a class="headerlink" href="#1415-ras-error-injection" title="Permanent link">&para;</a></h4>
<p>For software testing purposes, you can inject non-fatal, fatal, and catastrophic errors into the platform through the RAS_ERROR_INJ register.  These errors are reported in the RAS_CATFAT_ERR_STAT and RAS_NOFAT_ERR_STAT registers.
Please refer to <a href="https://github.com/OFS/ofs-fim-common/blob/release/ofs-2023.1/src/common/fme/xls/osc/FME_CSR.xls">FME_CSR.xls</a> for individual register field descriptions or the SystemVerilog file: <a href="https://github.com/OFS/ofs-fim-common/blob/release/ofs-2023.1/src/common/fme/fme_csr.sv">fme_csr.sv</a></p>
<h4 id="1416-fme-error-interrupts">14.1.6 <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Error Interrupts<a class="headerlink" href="#1416-fme-error-interrupts" title="Permanent link">&para;</a></h4>
<p>In an event of an <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error, the MSI-X module in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> generates an interrupt so the host can decide on the next course of action. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> does not stall upstream and downstream traffic after the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error. However, a port error triggered by invalid request from a user <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> stalls all the traffic going from <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to PCIe.
The interrupt capability is discoverable by querying the <code>NumbSuppInterrupt</code> field of the PORT_CAPABILITY register in the Port private feature.  The MSI-X vector number is recorded in the <code>InterruptVectorNumber</code> field of the GLBL_ERROR_CAPABILITY register of the Global Error external feature.</p>
<p>An <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error interrupt is generated in response to the FME_ERROR0, PCIE0_ERROR0, RAS_NOFAT_ERR_STAT, or RAS_CATFAT_ERR_STAT registers recording a new, unmasked, error per the rules defined by CoreFIM interrupt feature.</p>
<h5 id="14161-msi-x-masking-pending-bit-array-pba-clearing">14.1.6.1 MSI-X Masking &amp; Pending Bit Array (PBA) Clearing<a class="headerlink" href="#14161-msi-x-masking-pending-bit-array-pba-clearing" title="Permanent link">&para;</a></h5>
<p>If the MSI-X vector corresponding to the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error interrupt is masked, events are recorded in the PBA array.  Clearing the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error status registers clears the corresponding MSI-X PBA entries.  If only some events are cleared, the normal interrupt triggering rules apply and a new pending interrupt is registered.</p>
<h4 id="1417-fme-error-handling">14.1.7 <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Error Handling<a class="headerlink" href="#1417-fme-error-handling" title="Permanent link">&para;</a></h4>
<p>When the host receives an <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error interrupt, it must take the recommended actions described below to bring the system back to its normal operation.</p>
<h5 id="14171-catastrophicfatal-error">14.1.7.1 Catastrophic/Fatal Error<a class="headerlink" href="#14171-catastrophicfatal-error" title="Permanent link">&para;</a></h5>
<p>A system reset is mandatory for any catastrophic or fatal error.</p>
<h5 id="14172-non-fatal-error">14.1.7.2 Non-Fatal Error<a class="headerlink" href="#14172-non-fatal-error" title="Permanent link">&para;</a></h5>
<p>When software receives a non-fatal error interrupt which does not require a system reset, it can take the following steps to clear the error after software handles the error:
1.  Set the *_ERROR_MASK register to all 1’s to mask all errors
2. Clear the *_FIRST_ERROR register
3. Clear the *_ERROR register
4. Set *_ERROR_MASK register to all 0’s to enable all errors</p>
<ul>
<li>Result: The *_ERROR &amp; *_FIRST_ERROR registers begin capturing new errors.</li>
</ul>
<hr />
<p><strong>NOTE</strong></p>
<p>A system reset can only clear RAS Error status registers.</p>
<hr />
<h3 id="143-mmio-requests">14.3 <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Requests<a class="headerlink" href="#143-mmio-requests" title="Permanent link">&para;</a></h3>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> is designed to gracefully handle <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> request scenarios.  </p>
<h4 id="1431-unsupported-functions-and-bar">14.3.1 Unsupported Functions and BAR<a class="headerlink" href="#1431-unsupported-functions-and-bar" title="Permanent link">&para;</a></h4>
<p>The PCIe hard IP in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> guarantees that only TLP packets for the functions and BARs supported by the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> (as configured in PCIe HIP IP instantiation) are sent to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.</p>
<h4 id="1432-mmio-request-decoding">14.3.2 <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Request Decoding<a class="headerlink" href="#1432-mmio-request-decoding" title="Permanent link">&para;</a></h4>
<p>The packet router and memory decoder in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> ensure that only legal <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> requests are forwarded to the targeted <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region. Full address and BAR decoding is done both in the packet router and the memory decoder to ensure the requests are forwarded to the designated CSR region as defined in the <a href="#mmio_regions"><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Regions</a> chapter.  Any unsolicited/illegal <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> request is dropped, and an error is reported back to host through the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error register.</p>
<h4 id="1433-unused-fmeport-csr-regions">14.3.3 Unused <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>/Port CSR Regions<a class="headerlink" href="#1433-unused-fmeport-csr-regions" title="Permanent link">&para;</a></h4>
<p>All the CSR slaves in <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> which are mapped to the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> or Port CSR regions must always respond to <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> read requests targeting its associated CSR region. A CSR slave must return all 0s for <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> reads to its unused CSR region such as a reserved space or a region where no CSR register is implemented for the address.</p>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> ensures <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> reads to <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> or Port CSR regions that are not mapped to any CSR slave always gets a response of all 0s. The memory decoder module and fake responder module in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> provide this guaranteed response.</p>
<h4 id="1434-unsupported-mmio-request">14.3.4 Unsupported <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Request<a class="headerlink" href="#1434-unsupported-mmio-request" title="Permanent link">&para;</a></h4>
<p>Any <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> request targeting <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> or Port CSR regions with a length or address alignment that are not  supported by the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> is dropped, and an error is logged in PCIE0_ERROR register. The <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> checker module in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> guarantees this response. When an unsupported <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> read request to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> CSR region is detected, the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> sends back a CPL (completion without data) with error status (UR) back to host.</p>
<h4 id="1435-afu-access-violation">14.3.5 <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Access Violation<a class="headerlink" href="#1435-afu-access-violation" title="Permanent link">&para;</a></h4>
<p><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> access violations refer to the scenarios where a PF is attempting to access the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region of an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> bound to a VF (virtualization enabled), or when a VF is trying to access the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region of an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> bound to a PF (virtualization disabled). When such a violation is detected, the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> drops the request and logs the error in the FME_ERROR0 register. If the request is an <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> read request, the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> returns a fake response to the host.</p>
<h4 id="1436-afu-mmio-response-timeout">14.3.6 <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Response Timeout<a class="headerlink" href="#1436-afu-mmio-response-timeout" title="Permanent link">&para;</a></h4>
<p>An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Response timeout functions in the same manner described in the <a href="#mmio-resp-timeout"><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Response Timeout</a> section.</p>
<h2 id="15-ofs-design-hierarchy">15 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Design Hierarchy<a class="headerlink" href="#15-ofs-design-hierarchy" title="Permanent link">&para;</a></h2>
<p>Files for design, build and unit test simulation are found at https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/ofs-f2000x-pl, release branch release/ofs-2023.1.  </p>
<h3 id="151-design-guidance">15.1 Design Guidance<a class="headerlink" href="#151-design-guidance" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> is designed with configurability and scalability in mind.  At a high level, these are the necessary steps for a user to customize the design.  Please refer to the <a href="https://ofs.github.io/hw//f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x.md">FPGA Interface Manager Developer's Guide</a></p>
<p><strong>Table 15-2 Features</strong></p>
<table>
<thead>
<tr>
<th>Step</th>
<th>Description</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Re-configure PCIe HIP for additional VFs (if necessary)</td>
<td>* PF0 is mandatory for running OPAE software<br />* Only modification of the VFs (added or subtracted) by the user is recommended. <br />* Default configuration supports 1 PF and 3 VFs.</td>
</tr>
<tr>
<td>2</td>
<td>Update Arm® AMBA® 4 AXI4-Stream PF/VF MUX-DEMUX configuration (if necessary)</td>
<td>* The PF/VF MUX-DEMUX is parameterized for flexibility. You can change, add or delete PF or VF functions by updating the top_cfg_pkg.sv file. * You also have the option of keeping the default configuration and tying off the unused VFs if needed.</td>
</tr>
<tr>
<td>3</td>
<td>Update top level and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> level as necessary</td>
<td>* If you integrating additional external interfaces, make the edits at the top level (ofs_top.sv) and propagate the interface down to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> level (afu_top.sv and soc_afu_top.sv)</td>
</tr>
<tr>
<td>4</td>
<td>Add user implemented function(s) in <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></td>
<td>* All of your implemented functions must have the required Arm® AMBA® 4 AXI4-Stream interface for both the data path and the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> control path to CSRs. <br />* All CSRs in the user-implemented function must have the required DFH layout. <br />* See host exerciser CSRs for reference.</td>
</tr>
<tr>
<td>5</td>
<td>Update <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> testbench</td>
<td>* The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> full chip <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> environment is coded specifically for verifying the default configuration containing the host exercisers for the PCIe, memory, and Ethernet. <br />* User must update the <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> testbench to reflect new RTL behavior for any customization changes. <br />See The <a href="https://ofs.github.io/hw//f2000x/user_guides/ug_sim_ofs/ug_sim_ofs.md">Simulation User Guide</a></td>
</tr>
</tbody>
</table>
<p>For more information on modifying the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, refer to the <a href="https://ofs.github.io/hw//f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x.md">FPGA Interface Manager Developer's Guide</a></p>
<h2 id="notices-disclaimers">Notices &amp; Disclaimers<a class="headerlink" href="#notices-disclaimers" title="Permanent link">&para;</a></h2>
<p>Intel<sup>&reg;</sup> technologies may require enabled hardware, software or service activation.
No product or component can be absolutely secure. 
Performance varies by use, configuration and other factors.
Your costs and results may vary. 
You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Intel products described herein. You agree to grant Intel a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.
No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document, with the sole exception that you may publish an unmodified copy. You may create software implementations based on this document and in compliance with the foregoing that are intended to execute on the Intel product(s) referenced in this document. No rights are granted to create modifications or derivatives of this document.
The products described may contain design defects or errors known as errata which may cause the product to deviate from published specifications.  Current characterized errata are available on request.
Intel disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.
You are responsible for safety of the overall system, including compliance with applicable safety-related requirements or standards. 
<sup>&copy;</sup> Intel Corporation.  Intel, the Intel logo, and other Intel marks are trademarks of Intel Corporation or its subsidiaries.  Other names and brands may be claimed as the property of others. </p>
<p>OpenCL and the OpenCL logo are trademarks of Apple Inc. used by permission of the Khronos Group™.   </p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.copy", "navigation.indexes", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>