
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../../d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/">
      
      
        <link rel="next" href="../../../../d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/">
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.13">
    
    
      
        <title>Software Reference Manual - OFS</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.ffa9267a.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#software-reference-manual-open-fpga-stack" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="OFS" class="md-header__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OFS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Software Reference Manual
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-tabs__link md-tabs__link--active">
        Stratix 10 OFS Hardware Docs
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../sw/fpga_api/quick_start/readme.md" class="md-tabs__link">
        OFS Software
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="OFS" class="md-nav__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OFS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Stratix 10 OFS Hardware Docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Stratix 10 OFS Hardware Docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Software Reference Manual
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Software Reference Manual
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#10-introduction" class="md-nav__link">
    1.0 Introduction
  </a>
  
    <nav class="md-nav" aria-label="1.0 Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-audience" class="md-nav__link">
    1.1 Audience
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-terminology" class="md-nav__link">
    1.2 Terminology
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20-opae-software-development-kit-sdk" class="md-nav__link">
    2.0 OPAE Software Development Kit (SDK)
  </a>
  
    <nav class="md-nav" aria-label="2.0 OPAE Software Development Kit (SDK)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#table-additional-websites-and-links" class="md-nav__link">
    Table : Additional Websites and Links
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#20-opae-c-api" class="md-nav__link">
    2.0 OPAE C API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21-libopae-c" class="md-nav__link">
    2.1 libopae-c
  </a>
  
    <nav class="md-nav" aria-label="2.1 libopae-c">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-device-abstraction" class="md-nav__link">
    2.1.1 Device Abstraction
  </a>
  
    <nav class="md-nav" aria-label="2.1.1 Device Abstraction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2111-device-types" class="md-nav__link">
    2.1.1.1 Device types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2112-tokens-and-handles" class="md-nav__link">
    2.1.1.2 Tokens and Handles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-enumeration" class="md-nav__link">
    2.1.2 Enumeration
  </a>
  
    <nav class="md-nav" aria-label="2.1.2 Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2121-fpga_properties-and-filtering" class="md-nav__link">
    2.1.2.1 fpga_properties and Filtering
  </a>
  
    <nav class="md-nav" aria-label="2.1.2.1 fpga_properties and Filtering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21211-common-properties" class="md-nav__link">
    2.1.2.1.1 Common Properties
  </a>
  
    <nav class="md-nav" aria-label="2.1.2.1.1 Common Properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21212-fpga_device-properties" class="md-nav__link">
    2.1.2.1.2 FPGA_DEVICE Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21213-fpga_accelerator-properties" class="md-nav__link">
    2.1.2.1.3 FPGA_ACCELERATOR Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213-access" class="md-nav__link">
    2.1.3 Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214-events" class="md-nav__link">
    2.1.4 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215-mmio-and-shared-memory" class="md-nav__link">
    2.1.5 MMIO and Shared Memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#216-management" class="md-nav__link">
    2.1.6 Management
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#217-errors" class="md-nav__link">
    2.1.7 Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#218-metrics" class="md-nav__link">
    2.1.8 Metrics
  </a>
  
    <nav class="md-nav" aria-label="2.1.8 Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2181-querying-metric-values-by-index" class="md-nav__link">
    2.1.8.1 Querying Metric Values by Index
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2182-querying-metric-values-by-name" class="md-nav__link">
    2.1.8.2 Querying Metric Values by Name
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#219-sysobject" class="md-nav__link">
    2.1.9 SysObject
  </a>
  
    <nav class="md-nav" aria-label="2.1.9 SysObject">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2191-fpga_object_container-apis" class="md-nav__link">
    2.1.9.1 FPGA_OBJECT_CONTAINER API’s
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2192-fpga_object_attribute-apis" class="md-nav__link">
    2.1.9.2 FPGA_OBJECT_ATTRIBUTE API’s
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2110-utilities" class="md-nav__link">
    2.1.10 Utilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-dfl-driver-ioctl-interfaces" class="md-nav__link">
    2.2 DFL Driver IOCTL Interfaces
  </a>
  
    <nav class="md-nav" aria-label="2.2 DFL Driver IOCTL Interfaces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-port-reset" class="md-nav__link">
    2.2.1 Port Reset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-port-information" class="md-nav__link">
    2.2.2 Port Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-mmio-region-information" class="md-nav__link">
    2.2.3 MMIO Region Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-shared-memory-mapping-and-unmapping" class="md-nav__link">
    2.2.4 Shared Memory Mapping and Unmapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#225-number-of-port-error-irqs" class="md-nav__link">
    2.2.5 Number of Port Error IRQs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#226-port-error-interrupt-configuration" class="md-nav__link">
    2.2.6 Port Error Interrupt Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#227-number-of-afu-interrupts" class="md-nav__link">
    2.2.7 Number of AFU Interrupts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#228-user-afu-interrupt-configuration" class="md-nav__link">
    2.2.8 User AFU Interrupt Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#229-partial-reconfiguration" class="md-nav__link">
    2.2.9 Partial Reconfiguration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2210-number-of-fme-error-irqs" class="md-nav__link">
    2.2.10 Number of FME Error IRQs
  </a>
  
    <nav class="md-nav" aria-label="2.2.10 Number of FME Error IRQs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2211-fme-error-interrupt-configuration" class="md-nav__link">
    2.2.11 FME Error Interrupt Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-plugin-manager" class="md-nav__link">
    2.3 Plugin Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#231-plugin-model" class="md-nav__link">
    2.3.1 Plugin Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232-libxfpga-plugin" class="md-nav__link">
    2.3.2 libxfpga Plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#233-libopae-v-plugin" class="md-nav__link">
    2.3.3 libopae-v Plugin
  </a>
  
    <nav class="md-nav" aria-label="2.3.3 libopae-v Plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2331-supporting-libraries" class="md-nav__link">
    2.3.3.1 Supporting Libraries
  </a>
  
    <nav class="md-nav" aria-label="2.3.3.1 Supporting Libraries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#23311-libopaevfio" class="md-nav__link">
    2.3.3.1.1 libopaevfio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23312-libopaemem" class="md-nav__link">
    2.3.3.1.2 libopaemem
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2332-configuring-pcie-virtual-functions" class="md-nav__link">
    2.3.3.2 Configuring PCIe Virtual Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-application-flow" class="md-nav__link">
    2.4 Application Flow
  </a>
  
    <nav class="md-nav" aria-label="2.4 Application Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#241-create-filter-criteria" class="md-nav__link">
    2.4.1 Create Filter Criteria
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#242-enumerate-the-afu" class="md-nav__link">
    2.4.2 Enumerate the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#243-open-the-afu" class="md-nav__link">
    2.4.3 Open the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#244-map-mmio-region" class="md-nav__link">
    2.4.4 Map MMIO Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#245-allocate-dma-buffers" class="md-nav__link">
    2.4.5 Allocate DMA Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#246-make-afu-aware-of-dma-buffers" class="md-nav__link">
    2.4.6 Make AFU Aware of DMA Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#247-initiate-an-acceleration-task" class="md-nav__link">
    2.4.7 Initiate an Acceleration Task
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#248-wait-for-task-completion" class="md-nav__link">
    2.4.8 Wait for Task Completion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#249-free-dma-buffers" class="md-nav__link">
    2.4.9 Free DMA Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2410-unmap-mmio-region" class="md-nav__link">
    2.4.10 Unmap MMIO Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2411-close-the-afu" class="md-nav__link">
    2.4.11 Close the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2412-release-the-tokens-and-properties" class="md-nav__link">
    2.4.12 Release the Tokens and Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#30-opae-c-api" class="md-nav__link">
    3.0 OPAE C++ API
  </a>
  
    <nav class="md-nav" aria-label="3.0 OPAE C++ API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-libopae-cxx-core" class="md-nav__link">
    3.1 libopae-cxx-core
  </a>
  
    <nav class="md-nav" aria-label="3.1 libopae-cxx-core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#311-properties" class="md-nav__link">
    3.1.1 Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#312-tokens" class="md-nav__link">
    3.1.2 Tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#313-handles" class="md-nav__link">
    3.1.3 Handles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#314-shared-memory" class="md-nav__link">
    3.1.4 Shared Memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#315-events" class="md-nav__link">
    3.1.5 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#316-errors" class="md-nav__link">
    3.1.6 Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#317-sysobject" class="md-nav__link">
    3.1.7 SysObject
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#40-opae-python-api" class="md-nav__link">
    4.0 OPAE Python API
  </a>
  
    <nav class="md-nav" aria-label="4.0 OPAE Python API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-_opae" class="md-nav__link">
    4.1 _opae
  </a>
  
    <nav class="md-nav" aria-label="4.1 _opae">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-enumeration" class="md-nav__link">
    4.1.1 Enumeration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412-properties" class="md-nav__link">
    4.1.2 Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#413-tokens" class="md-nav__link">
    4.1.3 Tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#414-handles" class="md-nav__link">
    4.1.4 Handles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#415-shared-memory" class="md-nav__link">
    4.1.5 Shared Memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#416-events" class="md-nav__link">
    4.1.6 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#417-errors" class="md-nav__link">
    4.1.7 Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#418-sysobject" class="md-nav__link">
    4.1.8 SysObject
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#50-management-interfaces-opaeadmin" class="md-nav__link">
    5.0 Management Interfaces - opae.admin
  </a>
  
    <nav class="md-nav" aria-label="5.0 Management Interfaces - opae.admin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-sysfs" class="md-nav__link">
    5.1 sysfs
  </a>
  
    <nav class="md-nav" aria-label="5.1 sysfs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-sysfs_node" class="md-nav__link">
    5.1.1 sysfs_node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-pci_node" class="md-nav__link">
    5.1.2 pci_node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-sysfs_driver" class="md-nav__link">
    5.1.3 sysfs_driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514-sysfs_device" class="md-nav__link">
    5.1.4 sysfs_device
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#515-pcie_device" class="md-nav__link">
    5.1.5 pcie_device
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-fpga" class="md-nav__link">
    5.2 fpga
  </a>
  
    <nav class="md-nav" aria-label="5.2 fpga">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#521-region" class="md-nav__link">
    5.2.1 region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#522-fme" class="md-nav__link">
    5.2.2 fme
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#523-port" class="md-nav__link">
    5.2.3 port
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#524-fpga_base" class="md-nav__link">
    5.2.4 fpga_base
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#525-fpga" class="md-nav__link">
    5.2.5 fpga
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-opaeadmin-utilities" class="md-nav__link">
    5.3 opae.admin Utilities
  </a>
  
    <nav class="md-nav" aria-label="5.3 opae.admin Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531-fpgasupdate" class="md-nav__link">
    5.3.1 fpgasupdate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#532-pci_device" class="md-nav__link">
    5.3.2 pci_device
  </a>
  
    <nav class="md-nav" aria-label="5.3.2 pci_device">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5321-pci_device-aer-subcommand" class="md-nav__link">
    5.3.2.1 pci_device aer subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5322-pci_device-unbind-subcommand" class="md-nav__link">
    5.3.2.2 pci_device unbind subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5323-pci_device-rescan-subcommand" class="md-nav__link">
    5.3.2.3 pci_device rescan subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5324-pci_device-remove-subcommand" class="md-nav__link">
    5.3.2.4 pci_device remove subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5325-pci_device-topology-subcommand" class="md-nav__link">
    5.3.2.5 pci_device topology subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5326-pci_device-vf-subcommand" class="md-nav__link">
    5.3.2.6 pci_device vf subcommand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#533-rsu" class="md-nav__link">
    5.3.3 rsu
  </a>
  
    <nav class="md-nav" aria-label="5.3.3 rsu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5331-rsu-bmc-subcommand" class="md-nav__link">
    5.3.3.1 rsu bmc subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5332-rsu-retimer-subcommand" class="md-nav__link">
    5.3.3.2 rsu retimer subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5333-rsu-fpga-subcommand" class="md-nav__link">
    5.3.3.3 rsu fpga subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5334-rsu-sdm-subcommand" class="md-nav__link">
    5.3.3.4 rsu sdm subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5335-rsu-fpgadefault-subcommand" class="md-nav__link">
    5.3.3.5 rsu fpgadefault subcommand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#60-sample-applications" class="md-nav__link">
    6.0 Sample Applications
  </a>
  
    <nav class="md-nav" aria-label="6.0 Sample Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-afu-test-framework" class="md-nav__link">
    6.1 afu-test Framework
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-afu-test-based-samples" class="md-nav__link">
    6.2 afu-test Based Samples
  </a>
  
    <nav class="md-nav" aria-label="6.2 afu-test Based Samples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#621-dummy_afu" class="md-nav__link">
    6.2.1 dummy_afu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#622-host_exerciser" class="md-nav__link">
    6.2.2 host_exerciser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#623-hssi" class="md-nav__link">
    6.2.3 hssi
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#70-other-utilities" class="md-nav__link">
    7.0 Other Utilities
  </a>
  
    <nav class="md-nav" aria-label="7.0 Other Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-opaeio" class="md-nav__link">
    7.1 opae.io
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-bitstreaminfo" class="md-nav__link">
    7.2 bitstreaminfo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-fpgareg" class="md-nav__link">
    7.3 fpgareg
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-opaevfio" class="md-nav__link">
    7.4 opaevfio
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#80-building-opae" class="md-nav__link">
    8.0 Building OPAE
  </a>
  
    <nav class="md-nav" aria-label="8.0 Building OPAE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-installing-prerequisite-packages" class="md-nav__link">
    8.1 Installing Prerequisite Packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-cloning-the-sdk-repository" class="md-nav__link">
    8.2 Cloning the SDK repository
  </a>
  
    <nav class="md-nav" aria-label="8.2 Cloning the SDK repository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#83-cmake-options" class="md-nav__link">
    8.3 CMake Options
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-building-opae-for-debug" class="md-nav__link">
    8.4 Building OPAE for Debug
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#85-creating-rpms" class="md-nav__link">
    8.5 Creating RPMs
  </a>
  
    <nav class="md-nav" aria-label="8.5 Creating RPMs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#851-updating-the-rpm-version-information" class="md-nav__link">
    8.5.1 Updating the RPM Version Information
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#90-debugging-opae" class="md-nav__link">
    9.0 Debugging OPAE
  </a>
  
    <nav class="md-nav" aria-label="9.0 Debugging OPAE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-enabling-debug-logging" class="md-nav__link">
    9.1  Enabling Debug Logging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-gdb" class="md-nav__link">
    9.2 GDB
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#100-adding-new-device-support" class="md-nav__link">
    10.0 Adding New Device Support
  </a>
  
    <nav class="md-nav" aria-label="10.0 Adding New Device Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-configuration-file-search-order" class="md-nav__link">
    10.1 Configuration File Search Order
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-configuration-file-format" class="md-nav__link">
    10.2 Configuration File Format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#110-dfl-linux-kernel-drivers" class="md-nav__link">
    11.0 DFL Linux Kernel Drivers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/dev_guides/fim_dev/ug_dev_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/dev_guides/afu_dev/ug_dev_afu_d5005/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          OFS Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          OFS Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          OPAE USER GUIDES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          OPAE USER GUIDES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/quick_start/readme.md" class="md-nav__link">
        Quick Start Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/install_guide/installation_guide.md" class="md-nav__link">
        OPAE Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/prog_guide/readme.md" class="md-nav__link">
        OPAE C API Programming Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://opae.github.io/latest/docs/pyopae/README.html" class="md-nav__link">
        OPAE Python Bindings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/plug_guide/readme.md" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          OPAE LIBRARIES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          OPAE LIBRARIES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://opae.github.io/latest/docs/fpga_api/fpga_api.html" class="md-nav__link">
        OPAE C API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://opae.github.io/latest/docs/fpga_api/fpga_cxx_api.html" class="md-nav__link">
        OPAE C++ Core API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://opae.github.io/latest/docs/fpga_api/fpga_python_api.html" class="md-nav__link">
        OPAE Python API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/plug_guide/readme.md" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          OPAE LINUX KERNEL DRIVERS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          OPAE LINUX KERNEL DRIVERS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/drv_arch/drv_arch.md" class="md-nav__link">
        Open Programmable Accelerator Engine (OPAE) Linux Device Driver Architecture
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          OPAE FPGA TOOLS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          OPAE FPGA TOOLS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgaconf/fpgaconf.md" class="md-nav__link">
        fpgaconf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgainfo/fpgainfo.md" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgasupdate/fpgasupdate.md" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mmlink/mmlink.md" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/packager/packager.md" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/userclk/userclk.md" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi/hssi.md" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/pci_device/pci_device.md" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opae.io/opae.io.md" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/rsu/rsu.md" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/host_exerciser/host_exerciser.md" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssistats.md" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssimac.md" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssiloopback.md" class="md-nav__link">
        HSSI ethernet loopback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mem_tg/mem_tg.md" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/vabtool/vabtool.md" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaevfio/opaevfio.md" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/ofs.uio/ofs.uio.md" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaeuio/opaeuio.md" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgad/fpgad.md" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgadiag/README.md" class="md-nav__link">
        fpgadiag
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#10-introduction" class="md-nav__link">
    1.0 Introduction
  </a>
  
    <nav class="md-nav" aria-label="1.0 Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-audience" class="md-nav__link">
    1.1 Audience
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-terminology" class="md-nav__link">
    1.2 Terminology
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20-opae-software-development-kit-sdk" class="md-nav__link">
    2.0 OPAE Software Development Kit (SDK)
  </a>
  
    <nav class="md-nav" aria-label="2.0 OPAE Software Development Kit (SDK)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#table-additional-websites-and-links" class="md-nav__link">
    Table : Additional Websites and Links
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#20-opae-c-api" class="md-nav__link">
    2.0 OPAE C API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21-libopae-c" class="md-nav__link">
    2.1 libopae-c
  </a>
  
    <nav class="md-nav" aria-label="2.1 libopae-c">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-device-abstraction" class="md-nav__link">
    2.1.1 Device Abstraction
  </a>
  
    <nav class="md-nav" aria-label="2.1.1 Device Abstraction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2111-device-types" class="md-nav__link">
    2.1.1.1 Device types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2112-tokens-and-handles" class="md-nav__link">
    2.1.1.2 Tokens and Handles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-enumeration" class="md-nav__link">
    2.1.2 Enumeration
  </a>
  
    <nav class="md-nav" aria-label="2.1.2 Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2121-fpga_properties-and-filtering" class="md-nav__link">
    2.1.2.1 fpga_properties and Filtering
  </a>
  
    <nav class="md-nav" aria-label="2.1.2.1 fpga_properties and Filtering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21211-common-properties" class="md-nav__link">
    2.1.2.1.1 Common Properties
  </a>
  
    <nav class="md-nav" aria-label="2.1.2.1.1 Common Properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21212-fpga_device-properties" class="md-nav__link">
    2.1.2.1.2 FPGA_DEVICE Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21213-fpga_accelerator-properties" class="md-nav__link">
    2.1.2.1.3 FPGA_ACCELERATOR Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213-access" class="md-nav__link">
    2.1.3 Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214-events" class="md-nav__link">
    2.1.4 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215-mmio-and-shared-memory" class="md-nav__link">
    2.1.5 MMIO and Shared Memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#216-management" class="md-nav__link">
    2.1.6 Management
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#217-errors" class="md-nav__link">
    2.1.7 Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#218-metrics" class="md-nav__link">
    2.1.8 Metrics
  </a>
  
    <nav class="md-nav" aria-label="2.1.8 Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2181-querying-metric-values-by-index" class="md-nav__link">
    2.1.8.1 Querying Metric Values by Index
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2182-querying-metric-values-by-name" class="md-nav__link">
    2.1.8.2 Querying Metric Values by Name
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#219-sysobject" class="md-nav__link">
    2.1.9 SysObject
  </a>
  
    <nav class="md-nav" aria-label="2.1.9 SysObject">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2191-fpga_object_container-apis" class="md-nav__link">
    2.1.9.1 FPGA_OBJECT_CONTAINER API’s
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2192-fpga_object_attribute-apis" class="md-nav__link">
    2.1.9.2 FPGA_OBJECT_ATTRIBUTE API’s
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2110-utilities" class="md-nav__link">
    2.1.10 Utilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-dfl-driver-ioctl-interfaces" class="md-nav__link">
    2.2 DFL Driver IOCTL Interfaces
  </a>
  
    <nav class="md-nav" aria-label="2.2 DFL Driver IOCTL Interfaces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-port-reset" class="md-nav__link">
    2.2.1 Port Reset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-port-information" class="md-nav__link">
    2.2.2 Port Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-mmio-region-information" class="md-nav__link">
    2.2.3 MMIO Region Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-shared-memory-mapping-and-unmapping" class="md-nav__link">
    2.2.4 Shared Memory Mapping and Unmapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#225-number-of-port-error-irqs" class="md-nav__link">
    2.2.5 Number of Port Error IRQs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#226-port-error-interrupt-configuration" class="md-nav__link">
    2.2.6 Port Error Interrupt Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#227-number-of-afu-interrupts" class="md-nav__link">
    2.2.7 Number of AFU Interrupts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#228-user-afu-interrupt-configuration" class="md-nav__link">
    2.2.8 User AFU Interrupt Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#229-partial-reconfiguration" class="md-nav__link">
    2.2.9 Partial Reconfiguration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2210-number-of-fme-error-irqs" class="md-nav__link">
    2.2.10 Number of FME Error IRQs
  </a>
  
    <nav class="md-nav" aria-label="2.2.10 Number of FME Error IRQs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2211-fme-error-interrupt-configuration" class="md-nav__link">
    2.2.11 FME Error Interrupt Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-plugin-manager" class="md-nav__link">
    2.3 Plugin Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#231-plugin-model" class="md-nav__link">
    2.3.1 Plugin Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232-libxfpga-plugin" class="md-nav__link">
    2.3.2 libxfpga Plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#233-libopae-v-plugin" class="md-nav__link">
    2.3.3 libopae-v Plugin
  </a>
  
    <nav class="md-nav" aria-label="2.3.3 libopae-v Plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2331-supporting-libraries" class="md-nav__link">
    2.3.3.1 Supporting Libraries
  </a>
  
    <nav class="md-nav" aria-label="2.3.3.1 Supporting Libraries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#23311-libopaevfio" class="md-nav__link">
    2.3.3.1.1 libopaevfio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23312-libopaemem" class="md-nav__link">
    2.3.3.1.2 libopaemem
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2332-configuring-pcie-virtual-functions" class="md-nav__link">
    2.3.3.2 Configuring PCIe Virtual Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-application-flow" class="md-nav__link">
    2.4 Application Flow
  </a>
  
    <nav class="md-nav" aria-label="2.4 Application Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#241-create-filter-criteria" class="md-nav__link">
    2.4.1 Create Filter Criteria
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#242-enumerate-the-afu" class="md-nav__link">
    2.4.2 Enumerate the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#243-open-the-afu" class="md-nav__link">
    2.4.3 Open the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#244-map-mmio-region" class="md-nav__link">
    2.4.4 Map MMIO Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#245-allocate-dma-buffers" class="md-nav__link">
    2.4.5 Allocate DMA Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#246-make-afu-aware-of-dma-buffers" class="md-nav__link">
    2.4.6 Make AFU Aware of DMA Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#247-initiate-an-acceleration-task" class="md-nav__link">
    2.4.7 Initiate an Acceleration Task
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#248-wait-for-task-completion" class="md-nav__link">
    2.4.8 Wait for Task Completion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#249-free-dma-buffers" class="md-nav__link">
    2.4.9 Free DMA Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2410-unmap-mmio-region" class="md-nav__link">
    2.4.10 Unmap MMIO Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2411-close-the-afu" class="md-nav__link">
    2.4.11 Close the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2412-release-the-tokens-and-properties" class="md-nav__link">
    2.4.12 Release the Tokens and Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#30-opae-c-api" class="md-nav__link">
    3.0 OPAE C++ API
  </a>
  
    <nav class="md-nav" aria-label="3.0 OPAE C++ API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-libopae-cxx-core" class="md-nav__link">
    3.1 libopae-cxx-core
  </a>
  
    <nav class="md-nav" aria-label="3.1 libopae-cxx-core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#311-properties" class="md-nav__link">
    3.1.1 Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#312-tokens" class="md-nav__link">
    3.1.2 Tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#313-handles" class="md-nav__link">
    3.1.3 Handles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#314-shared-memory" class="md-nav__link">
    3.1.4 Shared Memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#315-events" class="md-nav__link">
    3.1.5 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#316-errors" class="md-nav__link">
    3.1.6 Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#317-sysobject" class="md-nav__link">
    3.1.7 SysObject
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#40-opae-python-api" class="md-nav__link">
    4.0 OPAE Python API
  </a>
  
    <nav class="md-nav" aria-label="4.0 OPAE Python API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-_opae" class="md-nav__link">
    4.1 _opae
  </a>
  
    <nav class="md-nav" aria-label="4.1 _opae">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-enumeration" class="md-nav__link">
    4.1.1 Enumeration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412-properties" class="md-nav__link">
    4.1.2 Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#413-tokens" class="md-nav__link">
    4.1.3 Tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#414-handles" class="md-nav__link">
    4.1.4 Handles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#415-shared-memory" class="md-nav__link">
    4.1.5 Shared Memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#416-events" class="md-nav__link">
    4.1.6 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#417-errors" class="md-nav__link">
    4.1.7 Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#418-sysobject" class="md-nav__link">
    4.1.8 SysObject
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#50-management-interfaces-opaeadmin" class="md-nav__link">
    5.0 Management Interfaces - opae.admin
  </a>
  
    <nav class="md-nav" aria-label="5.0 Management Interfaces - opae.admin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-sysfs" class="md-nav__link">
    5.1 sysfs
  </a>
  
    <nav class="md-nav" aria-label="5.1 sysfs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-sysfs_node" class="md-nav__link">
    5.1.1 sysfs_node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-pci_node" class="md-nav__link">
    5.1.2 pci_node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-sysfs_driver" class="md-nav__link">
    5.1.3 sysfs_driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514-sysfs_device" class="md-nav__link">
    5.1.4 sysfs_device
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#515-pcie_device" class="md-nav__link">
    5.1.5 pcie_device
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-fpga" class="md-nav__link">
    5.2 fpga
  </a>
  
    <nav class="md-nav" aria-label="5.2 fpga">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#521-region" class="md-nav__link">
    5.2.1 region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#522-fme" class="md-nav__link">
    5.2.2 fme
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#523-port" class="md-nav__link">
    5.2.3 port
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#524-fpga_base" class="md-nav__link">
    5.2.4 fpga_base
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#525-fpga" class="md-nav__link">
    5.2.5 fpga
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-opaeadmin-utilities" class="md-nav__link">
    5.3 opae.admin Utilities
  </a>
  
    <nav class="md-nav" aria-label="5.3 opae.admin Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531-fpgasupdate" class="md-nav__link">
    5.3.1 fpgasupdate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#532-pci_device" class="md-nav__link">
    5.3.2 pci_device
  </a>
  
    <nav class="md-nav" aria-label="5.3.2 pci_device">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5321-pci_device-aer-subcommand" class="md-nav__link">
    5.3.2.1 pci_device aer subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5322-pci_device-unbind-subcommand" class="md-nav__link">
    5.3.2.2 pci_device unbind subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5323-pci_device-rescan-subcommand" class="md-nav__link">
    5.3.2.3 pci_device rescan subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5324-pci_device-remove-subcommand" class="md-nav__link">
    5.3.2.4 pci_device remove subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5325-pci_device-topology-subcommand" class="md-nav__link">
    5.3.2.5 pci_device topology subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5326-pci_device-vf-subcommand" class="md-nav__link">
    5.3.2.6 pci_device vf subcommand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#533-rsu" class="md-nav__link">
    5.3.3 rsu
  </a>
  
    <nav class="md-nav" aria-label="5.3.3 rsu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5331-rsu-bmc-subcommand" class="md-nav__link">
    5.3.3.1 rsu bmc subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5332-rsu-retimer-subcommand" class="md-nav__link">
    5.3.3.2 rsu retimer subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5333-rsu-fpga-subcommand" class="md-nav__link">
    5.3.3.3 rsu fpga subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5334-rsu-sdm-subcommand" class="md-nav__link">
    5.3.3.4 rsu sdm subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5335-rsu-fpgadefault-subcommand" class="md-nav__link">
    5.3.3.5 rsu fpgadefault subcommand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#60-sample-applications" class="md-nav__link">
    6.0 Sample Applications
  </a>
  
    <nav class="md-nav" aria-label="6.0 Sample Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-afu-test-framework" class="md-nav__link">
    6.1 afu-test Framework
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-afu-test-based-samples" class="md-nav__link">
    6.2 afu-test Based Samples
  </a>
  
    <nav class="md-nav" aria-label="6.2 afu-test Based Samples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#621-dummy_afu" class="md-nav__link">
    6.2.1 dummy_afu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#622-host_exerciser" class="md-nav__link">
    6.2.2 host_exerciser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#623-hssi" class="md-nav__link">
    6.2.3 hssi
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#70-other-utilities" class="md-nav__link">
    7.0 Other Utilities
  </a>
  
    <nav class="md-nav" aria-label="7.0 Other Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-opaeio" class="md-nav__link">
    7.1 opae.io
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-bitstreaminfo" class="md-nav__link">
    7.2 bitstreaminfo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-fpgareg" class="md-nav__link">
    7.3 fpgareg
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-opaevfio" class="md-nav__link">
    7.4 opaevfio
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#80-building-opae" class="md-nav__link">
    8.0 Building OPAE
  </a>
  
    <nav class="md-nav" aria-label="8.0 Building OPAE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-installing-prerequisite-packages" class="md-nav__link">
    8.1 Installing Prerequisite Packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-cloning-the-sdk-repository" class="md-nav__link">
    8.2 Cloning the SDK repository
  </a>
  
    <nav class="md-nav" aria-label="8.2 Cloning the SDK repository">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#83-cmake-options" class="md-nav__link">
    8.3 CMake Options
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-building-opae-for-debug" class="md-nav__link">
    8.4 Building OPAE for Debug
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#85-creating-rpms" class="md-nav__link">
    8.5 Creating RPMs
  </a>
  
    <nav class="md-nav" aria-label="8.5 Creating RPMs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#851-updating-the-rpm-version-information" class="md-nav__link">
    8.5.1 Updating the RPM Version Information
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#90-debugging-opae" class="md-nav__link">
    9.0 Debugging OPAE
  </a>
  
    <nav class="md-nav" aria-label="9.0 Debugging OPAE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-enabling-debug-logging" class="md-nav__link">
    9.1  Enabling Debug Logging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-gdb" class="md-nav__link">
    9.2 GDB
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#100-adding-new-device-support" class="md-nav__link">
    10.0 Adding New Device Support
  </a>
  
    <nav class="md-nav" aria-label="10.0 Adding New Device Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-configuration-file-search-order" class="md-nav__link">
    10.1 Configuration File Search Order
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-configuration-file-format" class="md-nav__link">
    10.2 Configuration File Format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#110-dfl-linux-kernel-drivers" class="md-nav__link">
    11.0 DFL Linux Kernel Drivers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="software-reference-manual-open-fpga-stack">Software Reference Manual:  Open FPGA Stack</h1>
<p><a name="heading-1.0"></a></p>
<h2 id="10-introduction"><strong>1.0 Introduction</strong></h2>
<p><a name="heading-1.1"></a></p>
<h3 id="11-audience"><strong>1.1 Audience</strong></h3>
<p>The information presented in this document is intended to be used by software developers looking to increase their knowledge of the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> user-space software stack and the kernel-space linux-dfl drivers. This information is intended as a starting point, with links to where users can deep dive on specific topics. </p>
<p><a name="heading-1.2"></a></p>
<h3 id="12-terminology"><strong>1.2 Terminology</strong></h3>
<table>
<thead>
<tr>
<th>Term</th>
<th>Abbreviation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>O</strong>pen <strong>F</strong>PGA <strong>S</strong>tack</td>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr></td>
<td>A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and software developers to optimize and reuse their designs.</td>
</tr>
<tr>
<td><strong>A</strong>ccelerator <strong>F</strong>unctional <strong>U</strong>nit</td>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></td>
<td>Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance.  <em>Note: An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region is the part of the design where an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may reside.  This <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may or may not be a partial reconfiguration region.</em></td>
</tr>
<tr>
<td><strong>B</strong>oard <strong>M</strong>anagement <strong>C</strong>ontroller</td>
<td><abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr></td>
<td>Supports features such as power sequence management and board monitoring through on-board sensors.</td>
</tr>
<tr>
<td><strong>F</strong>PGA <strong>I</strong>nterface <strong>M</strong>anager</td>
<td><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></td>
<td>Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs.  The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> resides in the static region of the FPGA and contains the FPGA Management Engine (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>) and I/O ring.</td>
</tr>
<tr>
<td><strong>P</strong>latform <strong>I</strong>nterface <strong>M</strong>anager</td>
<td><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr></td>
<td>An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developers can use to handle clock crossing, response sorting, buffering and different protocols.</td>
</tr>
<tr>
<td>Intel <strong>V</strong>irtualization <strong>T</strong>echnology for <strong>D</strong>irected I/O</td>
<td><abbr title="Intel Virtualization Technology for Directed I/O, Extension of the VT-x and VT-I processor virtualization technologies which adds new support for I/O device virtualization.">Intel VT-d</abbr></td>
<td>Extension of the VT-x and VT-I processor virtualization technologies which adds new support for I/O device virtualization.</td>
</tr>
<tr>
<td><strong>S</strong>ingle-<strong>R</strong>oot <strong>I</strong>nput-<strong>O</strong>utput <strong>V</strong>irtualization</td>
<td><abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr></td>
<td>Allows the isolation of PCI Express resources for manageability and performance.</td>
</tr>
<tr>
<td><strong>H</strong>ost <strong>E</strong>xerciser <strong>M</strong>odule</td>
<td><abbr title="Host Exerciser Module, Host exercisers are used to exercise and characterize the various host-FPGA interactions, including Memory Mapped Input/Output (MMIO), data transfer from host to FPGA, PR, host to FPGA memory, etc.">HEM</abbr></td>
<td>Host exercisers are used to exercise and characterize the various host-FPGA interactions, including Memory Mapped Input/Output (<abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>), data transfer from host to FPGA, <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>, host to FPGA memory, etc.</td>
</tr>
<tr>
<td><strong>D</strong>evice <strong>F</strong>eature <strong>L</strong>ist</td>
<td><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr></td>
<td>A concept inherited from <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>. The <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers provide support for FPGA devices that are designed to support the Device Feature List. The <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver to automatically load the drivers required for a given FPGA configuration. <a href="https://docs.kernel.org/fpga/dfl.html?highlight=sriov">(link)</a></td>
</tr>
<tr>
<td><strong>B</strong>est <strong>K</strong>nown <strong>C</strong>onfiguration</td>
<td><abbr title="Best Known Configuration, The exact hardware configuration Intel has optimized and validated the solution against.">BKC</abbr></td>
<td>The exact hardware configuration Intel has optimized and validated the solution against.</td>
</tr>
<tr>
<td><strong>O</strong>pen <strong>P</strong>rogrammable <strong>A</strong>cceleration <strong>E</strong>ngine</td>
<td>OPAE</td>
<td>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> is a software framework for managing and accessing programmable accelerators (FPGAs). It consists of a collection of libraries and tools to facilitate the development of software applications and accelerators. The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> resides exclusively in user-space.</td>
</tr>
<tr>
<td><strong>M</strong>emory <strong>M</strong>apped <strong>I</strong>nput/<strong>O</strong>utput</td>
<td><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr></td>
<td>Users may map and access both control registers and system memory buffers with accelerators.</td>
</tr>
<tr>
<td><strong>F</strong>PGA <strong>M</strong>anagement <strong>E</strong>ngine</td>
<td><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td>Performs reconfiguration and other infrastructure functions. Each FPGA device only has one <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>.</td>
</tr>
<tr>
<td><strong>I</strong>nput/<strong>O</strong>utput Control</td>
<td><abbr title="Input/Output Control, System calls used to manipulate underlying device parameters of special files.">IOCTL</abbr></td>
<td>System calls used to manipulate underlying device parameters of special files.</td>
</tr>
<tr>
<td><strong>V</strong>irtual <strong>F</strong>unction <strong>I</strong>nput/<strong>O</strong>utput</td>
<td><abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr></td>
<td>An IOMMU/device agnostic framework for exposing direct device access to userspace. <a href="https://www.kernel.org/doc/html/latest/driver-api/vfio.html">(link)</a></td>
</tr>
<tr>
<td><strong>C</strong>onfiguration and <strong>S</strong>tatus <strong>R</strong>egister</td>
<td>CSR</td>
<td>Communication with the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is achieved by reading/writing CSRs and reading/writing shared memory buffers.</td>
</tr>
<tr>
<td>Port</td>
<td>N/A</td>
<td>Represents the interface between the static FPGA fabric and a <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region containing an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</td>
</tr>
<tr>
<td><strong>A</strong>dvanced <strong>E</strong>rror <strong>R</strong>eporting</td>
<td><abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr></td>
<td>The PCIe <abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr> driver is the extended PCI Express error reporting capability providing more robust error reporting. <a href="https://docs.kernel.org/PCI/pcieaer-howto.html?highlight=aer">(link)</a></td>
</tr>
</tbody>
</table>
<p><a name="heading-1.3"></a></p>
<h2 id="20-opae-software-development-kit-sdk"><strong>2.0 OPAE Software Development Kit (SDK)</strong></h2>
<p>The OPAE C library is a lightweight user-space library that provides abstraction for FPGA resources in a compute environment. Built on top of the OPAE Intel® FPGA driver stack that supports Intel® FPGA platforms, the library abstracts away hardware specific and OS specific details and exposes the underlying FPGA resources as a set of features accessible from within software programs running on the host. The OPAE source code is available on the <a href="https://github.com/OFS/opae-sdk"><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> repository</a>, under the opae-sdk tag.</p>
<p>These features include the acceleration logic configured on the device, as well as functions to manage and reconfigure the device. The library enables user applications to transparently and seamlessly leverage FPGA-based acceleration.</p>
<p>Most of the information related to OPAE can be found on the official <a href="https://ofs.github.io"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Site</a> page. The following is a summary of the information present on this web page:</p>
<ul>
<li>Configuration options present in the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> build and installation flow</li>
<li>The steps required to build a sample OPAE application</li>
<li>An explanation of the basic application flow</li>
<li>A reference for the C, C++, and Python APIs</li>
<li>An explanation of the OPAE Linux Device Driver Architecture</li>
<li>Definitions for the various user-facing <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> tools</li>
</ul>
<p>The remaining sections on OPAE in this document are unique and build on basic principles explained in opae.github.io.</p>
<p><a name="table-2"></a></p>
<h4 id="table-additional-websites-and-links">Table : Additional Websites and Links</h4>
<table>
<thead>
<tr>
<th>Document</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> on github</td>
<td><a href="https://github.com/OFS/opae-sdk"><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> repository</a></td>
</tr>
<tr>
<td>OPAE Documents</td>
<td><a href="https://ofs.github.io"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Site</a></td>
</tr>
<tr>
<td>pybind11</td>
<td>https://pybind11.readthedocs.io/en/stable/</td>
</tr>
<tr>
<td>CLI11</td>
<td>https://github.com/CLIUtils/CLI11</td>
</tr>
<tr>
<td>spdlog</td>
<td>https://github.com/gabime/spdlog</td>
</tr>
</tbody>
</table>
<p><a name="heading-2.0"></a></p>
<h3 id="20-opae-c-api"><strong>2.0 OPAE C API</strong></h3>
<p><a name="heading-2.1"></a></p>
<h3 id="21-libopae-c"><strong>2.1 libopae-c</strong></h3>
<p><a name="heading-2.1.1"></a></p>
<h4 id="211-device-abstraction"><strong>2.1.1 Device Abstraction</strong></h4>
<p>The OPAE C API relies on two base abstractions concerning how the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>
and accelerator are presented to and manipulated by the user. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> is
concerned with management functionality. Access to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and its
interfaces is typically restricted to privileged (root) users. The
accelerator contains the user-defined logic in its reconfigurable
region. Most OPAE end-user applications are concerned with querying and
opening the accelerator device, then interacting with the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> via <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>
and shared memory.</p>
<p><a name="heading-2.1.1.1"></a></p>
<h5 id="2111-device-types"><strong>2.1.1.1 Device types</strong></h5>
<p>The C enum
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L100-L115">fpga_objtype</a>
defines two variants. The FPGA_DEVICE variant corresponds to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>
portion of the device, and the FPGA_ACCELERATOR refers to the
accelerator, also known as the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>An FPGA_DEVICE refers loosely to the sysfs tree rooted at the dfl-fme.X
directory, for example /sys/class/fpga_region/region0/dfl-fme.0, and
its associated device file /dev/dfl-fme.0.</p>
<p>An FPGA_ACCELERATOR refers loosely to the sysfs tree rooted at the
dfl-port.X directory, for example
/sys/class/fpga_region/region0/dfl-port.0, and its associated device
file /dev/dfl-port.0.</p>
<p>The number X in dfl-fme.X and dfl-port.X refers to a numeric ID that is
assigned by the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> device driver to uniquely identify an instance of
the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>/Accelerator. Systems with multiple FPGA acceleration devices
will have multiple dfl-fme.X’s and matching dfl-port.X’s.</p>
<p><a name="heading-2.1.1.2"></a></p>
<h5 id="2112-tokens-and-handles"><strong>2.1.1.2 Tokens and Handles</strong></h5>
<p>An
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L94-L107">fpga_token</a>
is an opaque data structure that uniquely represents an FPGA_DEVICE or
an FPGA_ACCELERATOR. Tokens convey existence, but not ownership. Tokens
are retrieved via the OPAE enumeration process described below using the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L46-L103">fpgaEnumerate()</a>
call.</p>
<p>An
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L109-L120">fpga_handle</a>
is an opaque data structure that corresponds to an opened device
instance, whether FPGA_DEVICE or FPGA_ACCELERATOR. A Handle is
obtained from a token via the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L41-L73">fpgaOpen()</a>
call. A handle conveys that the /dev/dfl-fme.X or /dev/dfl-port.X device
file has been opened and is ready for interaction via its <abbr title="Input/Output Control, System calls used to manipulate underlying device parameters of special files.">IOCTL</abbr>
interface.</p>
<p><a name="heading-2.1.2"></a></p>
<h3 id="212-enumeration"><strong>2.1.2 Enumeration</strong></h3>
<p>Enumeration is the process by which an OPAE application becomes aware of
the existence of FPGA_DEVICE’s and FPGA_ACCELERATOR’s. Refer to the
signature of the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L46-L103">fpgaEnumerate()</a>
call:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaEnumerate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">fpga_properties</span><span class="w"> </span><span class="o">*</span><span class="n">filters</span><span class="p">,</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_filters</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">fpaa_token</span><span class="w"> </span><span class="o">*</span><span class="n">tokens</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">max_tokens</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">num_matches</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 1 fpgaEnumerate()</p>
<p><a name="figure1"></a></p>
<p>The typical enumeration flow involves an initial call to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L46-L103">fpgaEnumerate()</a>
to discover the number of available tokens.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">fpgaEnumerate</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num_matches</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 2 Discovering Number of Tokens</p>
<p><a name="figure-2"></a></p>
<p>Once the number of available tokens is known, the application can
allocate the correct amount of space to hold the tokens:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">fpga_token</span><span class="w"> </span><span class="o">*</span><span class="n">tokens</span><span class="p">;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_tokens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_matches</span><span class="p">;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">tokens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">fpga_token</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">calloc</span><span class="p">(</span><span class="n">num_tokens</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">fpga_token</span><span class="p">));</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">fpgaEnumerate</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">tokens</span><span class="p">,</span><span class="w"> </span><span class="n">num_tokens</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num_matches</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 3 Enumerating All Tokens</p>
<p><a name="figure-3"></a></p>
<p>Note that parameters filters and num_filters were not used in the
preceding example, as they were NULL and 0. When no filtering criteria
are provided,
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L46-L103">fpgaEnumerate()</a>
returns all tokens that can be enumerated.</p>
<p><a name="heading-2.1.2.1"></a></p>
<h4 id="2121-fpga_properties-and-filtering"><strong>2.1.2.1 fpga_properties and Filtering</strong></h4>
<p>An
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L71-L92">fpga_properties</a>
is an opaque data structure used to retrieve all of the properties
concerning an FPGA_DEVICE or FPGA_ACCELERATOR. These properties can be
included in the filters parameter to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L46-L103">fpgaEnumerate()</a>
to select tokens by specific criteria.</p>
<p><a name="heading-2.1.2.1.1"></a></p>
<h5 id="21211-common-properties"><strong>2.1.2.1.1 Common Properties</strong></h5>
<p>Table 3 lists the set of
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/props.h#L82-L133">properties</a>
that are common to FPGA_DEVICE and FPGA_ACCELERATOR:</p>
<p><a name="table-3"></a></p>
<table>
<thead>
<tr class="header">
<th> Property</th>
<th> Description</th>
</tr>
</thread>
<tbody>
<tr class="even">
<td>fpga_guid guid;</td>
<td>FPGA_DEVICE: PR Interface ID<br />
FPGA_ACCELERATOR: AFU ID</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>fpga_token parent;</td>
<td>FPGA_DEVICE: always NULL<br />
FPGA_ACCELERATOR: the token of the corresponding FPGA_DEVICE, if any. Otherwise, NULL.</td>
</tr>
<tr class="even">
<td>fpga_objtype objtype;</td>
<td>FPGA_DEVICE or FPGA_ACCELERATOR</td>
</tr>
<tr class="odd">
<td>uint16_t segment;</td>
<td>The segment portion of the PCIe address: ssss:bb:dd.f</td>
</tr>
<tr class="even">
<td>uint8_t bus;</td>
<td><p>The bus portion of the PCIe address:</p>
<p>ssss:bb:dd.f</p></td>
</tr>
<tr class="odd">
<td>uint8_t device;</td>
<td><p>The device portion of the PCIe address:</p>
<p>ssss:bb:dd.f</p></td>
</tr>
<tr class="even">
<td>uint8_t function;</td>
<td>The function portion of the PCIe address: ssss:bb:dd.f</td>
</tr>
<tr class="odd">
<td>uint64_t object_id;</td>
<td>A unique 64-bit value that identifies this token on the system.</td>
</tr>
<tr class="even">
<td>uint16_t vendor_id;</td>
<td>The PCIe Vendor ID</td>
</tr>
<tr class="odd">
<td>uint16_t device_id;</td>
<td>The PCIe Device ID</td>
</tr>
<tr class="even">
<td>uint32_t num_errors;</td>
<td>The number of error sysfs nodes available for this token.</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L117-L132">fpga_interface</a> interface;</td>
<td>An identifier for the underlying plugin-based access method.</td>
</tr>
</tbody>
</table>

<p align = "center">Table 3 Common Properties</p>

<p><a name="heading-2.1.2.1.2"></a></p>
<h6 id="21212-fpga_device-properties"><strong>2.1.2.1.2 FPGA_DEVICE Properties</strong></h6>
<p>Table 4 lists the set of properties that are specific to FPGA_DEVICE
token types.</p>
<p><a name="table-4"></a></p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>uint64_t bbs_id;</td>
<td><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>-specific Blue Bitstream ID</td>
</tr>
<tr>
<td><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L135-L146">fpga_version</a> bbs_version;</td>
<td>BBS version</td>
</tr>
</tbody>
</table>
<p><a name="table-4"></a></p>
<p align = "center">Table 4 FPGA_DEVICE Properties</p>

<p><a name="heading-2.1.2.1.3"></a></p>
<h6 id="21213-fpga_accelerator-properties"><strong>2.1.2.1.3 FPGA_ACCELERATOR Properties</strong></h6>
<p>Table 5 lists the set of properties that are specific to
FPGA_ACCELERATOR token types.</p>
<p><a name="table-5"></a></p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L92-L98">fpga_accelerator_state</a> state;</td>
<td>Whether the Accelerator is currently open</td>
</tr>
<tr>
<td>uint32_t num_mmio;</td>
<td>The number of <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> regions available</td>
</tr>
<tr>
<td>uint32_t num_interrupts;</td>
<td>The number of interrupts available</td>
</tr>
</tbody>
</table>
<p align = "center">Table 5 FPGA_ACCELERATOR Properties</p>

<p>Following is an example of using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L71-L92">fpga_properties</a>
to enumerate a specific <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="cp">#define NLB0_AFU &quot;D8424DC4-A4A3-C413-F89E-433683F9040B&quot;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">fpga_properties</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">fpga_guid</span><span class="w"> </span><span class="n">afu_id</span><span class="p">;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">fpgaGetProperties</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">filter</span><span class="p">);</span><span class="w"> </span><span class="c1">// NULL: a new empty properties</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">fpgaPropertiesSetObjectType</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="n">FPGA_ACCELERATOR</span><span class="p">);</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="n">uuid_parse</span><span class="p">(</span><span class="n">NLB0_AFU</span><span class="p">,</span><span class="w"> </span><span class="n">afu_id</span><span class="p">);</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="n">fpgaPropertiesSetGuid</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="n">afu_id</span><span class="p">);</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="n">fpgaEnumerate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tokens</span><span class="p">,</span><span class="w"> </span><span class="n">num_tokens</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num_matches</span><span class="p">);</span>
</code></pre></div>
Relevant Links: 
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L122-L133">fpga_guid</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/properties.h#L77-L105">fpgaGetProperties</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/properties.h#L216-L227">fpgaPropertiesSetObjectType</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/properties.h#L591-L605">fpgaPropertiesSetGUID</a></p>
<p align = "center">Figure 4 Filtering During Enumeration</p>
<p><a name="figure 4"></a></p>
<p>Note that fpga_properties and fpga_token’s are allocated resources
that must be freed by their respective API calls, ie
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/properties.h#L160-L176">fpgaDestroyProperties()</a>
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L120-L133">fpgaDestroyToken()</a>.</p>
<p><a name="heading-2.1.3"></a></p>
<h3 id="213-access"><strong>2.1.3 Access</strong></h3>
<p>Once a token is discovered and returned to the caller by
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L46-L103">fpgaEnumerate()</a>,
the token can be converted into a handle by
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L41-L73">fpgaOpen()</a>.
Upon a successful call to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L41-L73">fpgaOpen()</a>,
the associated /dev/dfl-fme.X (FPGA_DEVICE) or /dev/dfl-port.X
(FPGA_ACCELERATOR) is opened and ready for use. Having acquired an
fpga_handle, the application can then use the handle with any of the
OPAE APIs that require an fpga_handle as an input parameter.</p>
<p>Like tokens and properties, handles are allocated resources. When a
handle is no longer needed, it should be closed and released by calling
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L75-L88">fpgaClose()</a>.</p>
<p><a name="heading-2.1.4"></a></p>
<h3 id="214-events"><strong>2.1.4 Events</strong></h3>
<p>Event registration in OPAE is a two-step process. First, the type of
event must be identified. The following
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L71-L82">fpga_event_type</a>
variants are defined:</p>
<p><a name="table-6"></a></p>
<table>
<thead>
<tr>
<th>Event</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>FPGA_EVENT_INTERRUPT</td>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> interrupt</td>
</tr>
<tr>
<td>FPGA_EVENT_ERROR</td>
<td>Infrastructure error event (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>/Port Error)</td>
</tr>
</tbody>
</table>
<p>Table 6 FPGA Event Types</p>
<p>Once the desired event type is known, an
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L148-L160">fpga_event_handle</a>
is created via
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/event.h#L50-L63">fpgaCreateEventHandle()</a>.
Once the event handle is available, the event notification is registered
using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/event.h#L96-L128">fpgaRegisterEvent()</a>.
In the example below, note the use of the flags field for passing the
desired IRQ vector when the event type is FPGA_EVENT_INTERRUPT. With
the event registered, the application can then use
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/event.h#L82-L94">fpgaGetOSObjectFromEventHandle()</a>
to obtain a file descriptor for use with the poll() system call. When
the interrupt occurs, the file descriptor will be set to the signaled
state by the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">fpga_event_handle</span><span class="w"> </span><span class="n">event_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">fpgaCreateEventHandle</span><span class="p">(</span><span class="o">&amp;</span><span class="n">event_handle</span><span class="p">);</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">fpgaRegisterEvent</span><span class="p">(</span><span class="n">fpga_handle</span><span class="p">,</span><span class="w"> </span><span class="n">FPGA_EVENT_INTERRUPT</span><span class="p">,</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="n">event_handle</span><span class="p">,</span><span class="w"> </span><span class="n">irq_vector</span><span class="p">);</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="n">fpgaGetOSObjectFromEventHandle</span><span class="p">(</span><span class="n">event_handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fd</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 5 Creating and Registering Events</p>
<p><a name="figure-5"></a></p>
<p>When an event notification is no longer needed, it should be released by
calling
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/event.h#L130-L154">fpgaUnregisterEvent()</a>.
Like device handles, event handles are allocated resources that must be
freed when no longer used. To free an event handle, use the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/event.h#L65-L79">fpgaDestroyEventHandle()</a>
call.</p>
<p><a name="heading-2.1.5"></a></p>
<h3 id="215-mmio-and-shared-memory"><strong>2.1.5 <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> and Shared Memory</strong></h3>
<p>Communication with the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is achieved via reading and writing CSRs and
by reading and writing to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>/host shared memory buffers. An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>’s CSRs
are memory-mapped into the application process address space by way of
the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mmio.h#L141-L183">fpgaMapMMIO()</a>
call.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">mmio_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">fpgaMapMMIO</span><span class="p">(</span><span class="n">fpga_handle</span><span class="p">,</span><span class="w"> </span><span class="n">mmio_num</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">fpga_handle</span><span class="p">,</span><span class="w"> </span><span class="n">mmio_num</span><span class="p">,</span><span class="w"> </span><span class="n">MY_CSR</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 6 Mapping and Accessing CSRs</p>
<p><a name="figure6"></a></p>
<p>The second parameter, mmio_num, is the zero-based index identifying the
desired <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region. The maximum number of <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> regions for a particular
handle is found by accessing the num_mmio property. Refer to the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/properties.h#L607-L618">fpgaPropertiesGetNumMMIO()</a>
call.</p>
<p>Once the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSRs are mapped into the process address space, the
application can use the fpgaReadMMIO<strong>XX</strong>() and fpgaWriteMMIO<strong>XX</strong>() family of
functions, eg
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mmio.h#L67-L83">fpgaReadMMIO64()</a>
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mmio.h#L49-L65">fpgaWriteMMIO64()</a>.
When an <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region is no longer needed, it should be unmapped from the
process address space using the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mmio.h#L185-L201">fpgaUnmapMMIO()</a>
call.</p>
<p>Shared memory buffers are allocated by way of the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L55-L99">fpgaPrepareBuffer()</a>
call.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaPrepareBuffer</span><span class="p">(</span><span class="n">fpga_handle</span><span class="w"> </span><span class="n">handle</span><span class="p">,</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="n">buf_addr</span><span class="p">,</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">wsid</span><span class="p">,</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 7 fpgaPrepareBuffer()</p>
<p><a name="figure-7"></a></p>
<p>Three buffer lengths are supported by this allocation method:</p>
<p><a name="table-7"></a></p>
<table>
<thead>
<tr>
<th>Length</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>4096 (4KiB)</td>
<td>No memory configuration needed.</td>
</tr>
<tr>
<td>2097152 (2MiB)</td>
<td>Requires 2MiB huge pages to be allocated.</td>
</tr>
<tr>
<td>1073741824 (1GiB)</td>
<td>Requires 1GiB huge pages to be allocated.</td>
</tr>
</tbody>
</table>
<p align = "center">Table 7 fpgaPrepareBuffer() Lengths</p>
<p><a name="table-7"></a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nb">echo</span><span class="w"> </span><span class="m">8</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nb">echo</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/mm/hugepages/hugepages-1048576kB/nr_hugepages
</code></pre></div>
<p align = "center">Figure 8 Configuring Huge Pages</p>
<p><a name="figure-8"></a></p>
<p>The buf_addr parameter to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L55-L99">fpgaPrepareBuffer()</a>
is a pointer to a void * that accepts the user virtual base address of
the newly-created buffer. The wsid parameter is a pointer to a uint64_t
that receives a unique workspace ID for the buffer allocation. This
workspace ID is used in subsequent calls to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L101-L115">fpgaReleaseBuffer()</a>,
which should be called when the buffer is no longer needed and in calls
to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L117-L136">fpgaGetIOAddress()</a>
which is used to query the IO base address of the buffer. The IO base
address can be programmed into the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> by means of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSR space.
For example, here is a code snippet from the
<a href="https://github.com/OFS/opae-sdk/blob/master/samples/hello_fpga/hello_fpga.c">hello_fpga</a>
sample that demonstrates programming a shared buffer’s IO base address
into an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSR in <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region 0:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="cp">#define LOG2_CL 6</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="cp">#define CACHELINE_ALIGNED_ADDR(p) ((p) &gt;&gt; LOG2_CL)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">fpgaGetIOAddress</span><span class="p">(</span><span class="n">accelerator_handle</span><span class="p">,</span><span class="w"> </span><span class="n">input_wsid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iova</span><span class="p">);</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">accelerator_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">nlb_base_addr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">CSR_SRC_ADDR</span><span class="p">,</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">CACHELINE_ALIGNED_ADDR</span><span class="p">(</span><span class="n">iova</span><span class="p">));</span>
</code></pre></div>
<p align = "center">Figure 9 Programming Shared Memory</p>
<p><a name="figure-9"></a></p>
<p>If applications need to map a shared buffer that has been allocated by
some other means than
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L55-L99">fpgaPrepareBuffer()</a>,
then the flags parameter can be set to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L140">FPGA_BUF_PREALLOCATED</a>.
This causes
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L55-L99">fpgaPrepareBuffer()</a>
to skip the allocation portion of the call and to only memory map the
given buf_addr into the application process address space.</p>
<p>Buffers can also be allocated and mapped as read-only by specifying
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L142">FPGA_BUF_READ_ONLY</a>.</p>
<p><a name="heading-2.1.6"></a></p>
<h3 id="216-management"><strong>2.1.6 Management</strong></h3>
<p>The management feature in OPAE concerns re-programming the programmable
region of the Port. To program the Port bitstream, pass a handle to the
FPGA_DEVICE associated with the desired Port. The slot parameter
identifies which Port to program in the case of multi-port
implementations. Most designs will only pass zero as the slot parameter.
The bitstream parameter is a buffer that contains the entire bitstream
contents, including the JSON bitstream header information. The
bitstream_len field gives the length of bitstream in bytes.</p>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/manage.h#L109-L141">fpgaReconfigureSlot()</a>
first checks whether the FPGA_ACCELERATOR corresponding to the
FPGA_DEVICE in fme_handle is open. If it is open, then the programming
request is aborted with an error code. The application may pass
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L162">FPGA_RECONF_FORCE</a>
in the flags parameter in order to avoid this open check and forcefully
program the bitstream.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaReconfigureSlot</span><span class="p">(</span><span class="n">fpga_handle</span><span class="w"> </span><span class="n">fme_handle</span><span class="p">,</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">slot</span><span class="p">,</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">bitstream</span><span class="p">,</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kt">size_t</span><span class="w"> </span><span class="n">bitstream_len</span><span class="p">,</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 10 fpgaReconfigureSlot()</p>
<p><a name="figure-10"></a></p>
<p><a name="heading-2.1.7"></a></p>
<h3 id="217-errors"><strong>2.1.7 Errors</strong></h3>
<p>The OPAE errors API provides a means to query and clear both
FPGA_DEVICE and FPGA_ACCELERATOR errors. Each FPGA device exports a
collection of error registers via the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers’ sysfs tree, for both
the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> and the Port. Each register is typically an unsigned 64-bit mask
of the current errors, where each bit or some collection of bits
specifies an error type. An error is signaled if its bit or collection
of bits is non-zero. Note that the 32-bit error index may vary from one
process execution to the next. Applications should use
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/error.h#L91-L106">fpgaGetErrorInfo</a>()
and examine the error name returned in the struct
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L162-L172">fpga_error_info</a>
to identify the desired 64-bit error mask.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">fpga_error_info</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kt">char</span><span class="w"> </span><span class="n">name</span><span class="p">[</span><span class="n">FPGA_ERROR_NAME_MAX</span><span class="p">];</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="kt">bool</span><span class="w"> </span><span class="n">can_clear</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="p">};</span>
</code></pre></div>
<p align = "center">Figure 11 struct fpga_error_info</p>
<p><a name="figure-11"></a></p>
<p>Each 64-bit mask of errors is assigned a unique 32-bit integer index and
a unique name. Given an fpga_token and an error index,
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/error.h#L91-L106">fpgaGetErrorInfo</a>()
retrieves the struct
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L162-L172">fpga_error_info</a>
corresponding to the error.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaGetErrorInfo</span><span class="p">(</span><span class="n">fpga_token</span><span class="w"> </span><span class="n">token</span><span class="p">,</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">error_num</span><span class="p">,</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">fpga_error_info</span><span class="w"> </span><span class="o">*</span><span class="n">error_info</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 12 fpgaGetErrorInfo()</p>
<p><a name="figure-12"></a></p>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/error.h#L46-L60">fpgaReadError</a>()
provides access to the raw 64-bit error mask, given the unique error
index.
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/error.h#L62-L75">fpgaClearError</a>()
clears the errors for a particular index.
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/error.h#L77-L89">fpgaClearAllErrors</a>()
clears all the errors for the given fpga_token.</p>
<p><a name="heading-2.1.8"></a></p>
<h3 id="218-metrics"><strong>2.1.8 Metrics</strong></h3>
<p>The OPAE metrics API refers to a group of functions and data structures
that allow querying the various device metrics from the Board Management
Controller component of the FPGA device. A metric is described by an
instance of struct
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L208-L221">fpga_metric_info</a>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">fpga_metric_info</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">metric_num</span><span class="p">;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">fpga_guid</span><span class="w"> </span><span class="n">metric_guid</span><span class="p">;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="kt">char</span><span class="w"> </span><span class="n">qualifier_name</span><span class="p">[</span><span class="n">FPGA_METRIC_STR_SIZE</span><span class="p">];</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="kt">char</span><span class="w"> </span><span class="n">group_name</span><span class="p">[</span><span class="n">FPGA_METRIC_STR_SIZE</span><span class="p">];</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="kt">char</span><span class="w"> </span><span class="n">metric_name</span><span class="p">[</span><span class="n">FPGA_METRIC_STR_SIZE</span><span class="p">];</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="kt">char</span><span class="w"> </span><span class="n">metric_units</span><span class="p">[</span><span class="n">FPGA_METRIC_STR_SIZE</span><span class="p">];</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_metric_datatype</span><span class="w"> </span><span class="n">metric_datatype</span><span class="p">;</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_metric_type</span><span class="w"> </span><span class="n">metric_type</span><span class="p">;</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="p">}</span><span class="w"> </span><span class="n">fpga_metric_info</span><span class="p">;</span>
</code></pre></div>
Relevant Links: 
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L200-L210">fpga_metric_datatype</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L188-L198">fpga_metric_type</a></p>
<p align = "center">Figure 13 fpga_metric_info</p>
<p><a name="figure-13"></a></p>
<p>The group_name field holds a string describing the broad categorization
of the metric. Some sample values for group_name are “thermal_mgmt”
and “power_mgmt”. The metric_name field contains the metric’s name.
The number and names of metrics may vary from one FPGA platform to the
next. The qualifier_name field is a concatenation of group_name and
metric_name, with a colon character in between. The metric_units field
contains the string name of the unit of measurement for the specific
metric. Some examples for metric_units are “Volts”, “Amps”, and
“Celsius”.</p>
<p>The metric_datatype field uniquely identifies the underlying C data
type for the metric’s value:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_metric_datatype</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">FPGA_METRIC_DATATYPE_INT</span><span class="p">,</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">FPGA_METRIC_DATATYPE_FLOAT</span><span class="p">,</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">FPGA_METRIC_DATATYPE_DOUBLE</span><span class="p">,</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">FPGA_METRIC_DATATYPE_BOOL</span><span class="p">,</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="n">FPGA_METRIC_DATATYPE_UNKNOWN</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="p">};</span>
</code></pre></div>
<p align = "center">Figure 14 enum fpga_metric_datatype</p>
<p><a name="figure-14"></a></p>
<p>The metric_type field classifies the metric into a broad category. This
information is redundant with the group_name field.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_metric_type</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">FPGA_METRIC_TYPE_POWER</span><span class="p">,</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">FPGA_METRIC_TYPE_THERMAL</span><span class="p">,</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">FPGA_METRIC_TYPE_PERFORMANCE_CTR</span><span class="p">,</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="n">FPGA_METRIC_TYPE_AFU</span><span class="p">,</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="n">FPGA_METRIC_TYPE_UNKNOWN</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="p">};</span>
</code></pre></div>
<p align = "center">Figure 15 enum fpga_metric_type</p>
<p><a name="figure-15"></a></p>
<p>In order to enumerate the information for each of the metrics available
from the FPGA device, determine the number of metrics using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/metrics.h#L45-L57">fpgaGetNumMetrics</a>().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">num_metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">fpgaGetNumMetrics</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num_metrics</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 16 Determining Number of Metrics</p>
<p><a name="figure-16"></a></p>
<p>This call retrieves the number of available metrics for the FPGA_DEVICE
that is opened behind the handle parameter to the call. Refer to 2.1.3
Access for information about the fpgaOpen() call. When the number of
available metrics is known, allocate a buffer large enough to hold that
many
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L208-L221">fpga_metric_info</a>
data structures, and call
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/metrics.h#L59-L75">fpgaGetMetricsInfo</a>()
to populate the entries:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">fpga_metric_info</span><span class="w"> </span><span class="o">*</span><span class="n">metric_info</span><span class="p">;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">metric_infos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_metrics</span><span class="p">;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">metric_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calloc</span><span class="p">(</span><span class="n">num_metrics</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">fpga_metric_info</span><span class="p">));</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">fpgaGetMetricsInfo</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">metric_info</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">metric_infos</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 17 Querying Metrics Info</p>
<p><a name="figure-17"></a></p>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L223-L231">fpga_metric</a>
structure is the representation of a metric’s value:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">fpga_metric</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">metric_num</span><span class="p">;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">metric_value</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="kt">bool</span><span class="w"> </span><span class="n">isvalid</span><span class="p">;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="p">}</span><span class="w"> </span><span class="n">fpga_metric</span><span class="p">;</span>
</code></pre></div>
Relevant Links:
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L196-L205">metric_value</a></p>
<p align = "center">Figure 18 struct fpga_metric</p>
<p><a name="figure-18"></a></p>
<p>The metric_num field matches the metric_num field of the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L208-L221">fpga_metric_info</a>
structure. value contains the metric value, which is encoded in the C
data type identified by the metric_datatype field of
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L208-L221">fpga_metric_info</a>.
Finally, the isvalid field denotes whether the metric value is valid.</p>
<p>There are two methods of obtaining a metric’s value, given the
information in the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L208-L221">fpga_metric_info</a>
structure:</p>
<p><a name="heading-2.1.8.1"></a></p>
<h4 id="2181-querying-metric-values-by-index"><strong>2.1.8.1 Querying Metric Values by Index</strong></h4>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/metrics.h#L77-L94">fpgaGetMetricsByIndex</a>()
retrieves a metric value using the metric_num field of the metric info:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">metric_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metric_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">metric_num</span><span class="p">;</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">fpga_metric</span><span class="w"> </span><span class="n">metric0</span><span class="p">;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">fpgaGetMetricsByIndex</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">metric_num</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">metric0</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 19 Retrieve Metric by Index</p>
<p><a name="figure-19"></a></p>
<p>This call allows retrieving one or more metric values, each identified
by their unique metric_num. The second and fourth parameters allow
passing arrays so that multiple values can be fetched in a single call.</p>
<p><a name="heading-2.1.8.2"></a></p>
<h4 id="2182-querying-metric-values-by-name"><strong>2.1.8.2 Querying Metric Values by Name</strong></h4>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/metrics.h#L96-L112">fpgaGetMetricsByName</a>()
retrieves a metric value using the metric_name field of the metric
info:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">metric_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metric_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">metric_name</span><span class="p">;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">fpga_metric</span><span class="w"> </span><span class="n">metric1</span><span class="p">;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">fpgaGetMetricsByName</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">metric_name</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">metric1</span><span class="p">);</span>
</code></pre></div>
<p>This call also allows retrieving one or more metric values, each
identified by their unique metric_name. The second and fourth
parameters allow passing arrays so that multiple values can be fetched
in a single call.</p>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/metrics.h#L115-L133">fpgaGetMetricsThresholdInfo</a>()
call is provided for legacy implementations only. It should be
considered deprecated for current and future FPGA designs.</p>
<p><a name="heading-2.1.9"></a></p>
<h3 id="219-sysobject"><strong>2.1.9 SysObject</strong></h3>
<p>When the hardware access method in use is the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers (see 2.3.2
libxfpga Plugin), the sysfs tree rooted at the struct _fpga_token’s
sysfspath member is accessible via the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> SysObject API. The
SysObject API provides an abstraction to search, traverse, read, and
write sysfs entities. These sysfs entities may take the form of
directories, which are referred to as containers, or files, which are
referred to as attributes. Figure 20 enum fpga_sysobject_type shows
the API’s means of distinguishing between the two types.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_sysobject_type</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">FPGA_OBJECT_CONTAINER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1u</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">FPGA_OBJECT_ATTRIBUTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1u</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="p">};</span>
</code></pre></div>
<p align = "center">Figure 20 enum fpga_sysobject_type</p>
<p><a name="figure-20"></a></p>
<p>The SysObject API introduces another opaque structure type,
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L174-L189">fpga_object</a>.
An
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L174-L189">fpga_object</a>
can be queried from an fpga_token or an fpga_handle by way of the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L42-L67">fpgaTokenGetObject</a>()
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L69-L94">fpgaHandleGetObject</a>()
API’s.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaTokenGetObject</span><span class="p">(</span><span class="n">fpga_token</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">fpga_object</span><span class="w"> </span><span class="o">*</span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaHandleGetObject</span><span class="p">(</span><span class="n">fpga_handle</span><span class="w"> </span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="n">fpga_object</span><span class="w"> </span><span class="o">*</span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 21 fpgaTokenGetObject() / fpgaHandleGetObject()</p>
<p><a name="figure-21"></a></p>
<p>The remainder of the SysObject API is broken into two categories of
calls, depending on the fpga_object’s type. The type of an fpga_object
is learned via
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L145-L155">fpgaObjectGetType</a>().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectGetType</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_sysobject_type</span><span class="w"> </span><span class="o">*</span><span class="n">type</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 22 fpgaObjectGetType()</p>
<p><a name="figure-22"></a></p>
<p>When an fpga_object is no longer needed, it should be freed via
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L157-L170">fpgaDestroyObject</a>().</p>
<p><a name="heading-2.1.9.1"></a></p>
<h4 id="2191-fpga_object_container-apis"><strong>2.1.9.1 FPGA_OBJECT_CONTAINER API’s</strong></h4>
<p>For directory sysfs entities, passing a value of
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L172">FPGA_OBJECT_RECURSE_ONE</a>
or
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L175">FPGA_OBJECT_RECURSE_ALL</a>
in the flags parameter to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L42-L67">fpgaTokenGetObject</a>()
or
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L69-L94">fpgaHandleGetObject</a>()
causes these two API’s to treat the target object as either a
single-layer or multi-layer directory structure, making its child
entities available for query via
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L96-L124">fpgaObjectGetObject</a>()
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L126-L144">fpgaObjectGetObjectAt</a>().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectGetObject</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">fpga_object</span><span class="w"> </span><span class="o">*</span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectGetObjectAt</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">idx</span><span class="p">,</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">fpga_object</span><span class="w"> </span><span class="o">*</span><span class="n">object</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 23 fpgaObjectGetObject() / fpgaObjectGetObjectAt()</p>
<p><a name="figure-23"></a></p>
<p>Any child object resulting from
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L96-L124">fpgaObjectGetObject</a>()
or
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L126-L144">fpgaObjectGetObjectAt</a>()
must be freed via
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L157-L170">fpgaDestroyObject</a>()
when it is no longer needed.</p>
<p><a name="heading-2.1.9.2"></a></p>
<h4 id="2192-fpga_object_attribute-apis"><strong>2.1.9.2 FPGA_OBJECT_ATTRIBUTE API’s</strong></h4>
<p>Attribute sysfs entities may be queried for their size and read from or
written to. In order to determine the size of an attribute’s data, use
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L172-L184">fpgaObjectGetSize</a>().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectGetSize</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 24 fpgaObjectGetSize()</p>
<p><a name="figure-24"></a></p>
<p>Attributes containing arbitrary string data can be read with
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L186-L202">fpgaObjectRead</a>().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectRead</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="kt">size_t</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 25 fpgaObjectRead()</p>
<p><a name="figure-25"></a></p>
<p>If an attribute contains an unsigned integer value, its value can be
read with
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L204-L219">fpgaObjectRead64</a>()
and written with
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L221-L236">fpgaObjectWrite64</a>().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectRead64</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectWrite64</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 26 fpgaObjectRead64() / fpgaObjectWrite64()</p>
<p><a name="figure-26"></a></p>
<p><a name="heading-2.1.10"></a></p>
<h3 id="2110-utilities"><strong>2.1.10 Utilities</strong></h3>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L38-L69">fpga_result</a>
enumeration defines a set of error codes used throughout OPAE. In order
to convert an
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L38-L69">fpga_result</a>
error code into a printable string, the application can use the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/utils.h#L42-L51">fpgaErrStr()</a>
call.</p>
<p><a name = "heading-2.2"></a></p>
<h3 id="22-dfl-driver-ioctl-interfaces"><strong>2.2 <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> Driver <abbr title="Input/Output Control, System calls used to manipulate underlying device parameters of special files.">IOCTL</abbr> Interfaces</strong></h3>
<p>The <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers export an <abbr title="Input/Output Control, System calls used to manipulate underlying device parameters of special files.">IOCTL</abbr> interface which the libxfpga.so plugin
consumes in order to query and configure aspects of the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> and Port.
These interfaces are used only internally by the SDK; they are not
customer-facing. The description here is provided for completeness only.</p>
<p><a name="heading-2.2.1"></a></p>
<h4 id="221-port-reset"><strong>2.2.1 Port Reset</strong></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L70-L80"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_RESET</a>
ioctl is used by the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L90-L102">fpgaReset()</a>
call in order to perform a Port reset. The fpga_handle passed to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L90-L102">fpgaReset()</a>
must be a valid open handle to an FPGA_ACCELERATOR. The ioctl requires
no input/output parameters.</p>
<p><a name="heading-2.2.2"></a></p>
<h4 id="222-port-information"><strong>2.2.2 Port Information</strong></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L82-L99"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_GET_INFO</a>
ioctl is used to query properties of the Port, notably the number of
associated <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> regions. The ioctl requires a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L90-L97">dfl_fpga_port_info</a>.</p>
<p><a name="heading-2.2.3"></a></p>
<h4 id="223-mmio-region-information"><strong>2.2.3 <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Region Information</strong></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L101-L128"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_GET_REGION_INFO</a>
ioctl is used to query the details of an <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region. The ioctl requires
a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L110-L126">dfl_fpga_port_region_info</a>.
The index field of the struct is populated by the caller, and the
padding, size, and offset values are populated by the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver.</p>
<p><a name="heading-2.2.4"></a></p>
<h4 id="224-shared-memory-mapping-and-unmapping"><strong>2.2.4 Shared Memory Mapping and Unmapping</strong></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L130-L149"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_DMA_MAP</a>
ioctl is used to map a memory buffer into the application’s process
address space. The ioctl requires a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L139-L147">dfl_fpga_port_dma_map</a>.</p>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L151-L165"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_DMA_UNMAP</a>
ioctl is used to unmap a memory buffer from the application’s process
address space. The ioctl requires a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L158-L163">dfl_fpga_port_dma_unmap</a>.</p>
<p>These ioctls provide the underpinnings of the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L55-L99">fpgaPrepareBuffer()</a>
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L101-L115">fpgaReleaseBuffer()</a>
calls.</p>
<p><a name="heading-2.2.5"></a></p>
<h4 id="225-number-of-port-error-irqs"><strong>2.2.5 Number of Port Error IRQs</strong></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L180-L189"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_ERR_GET_IRQ_NUM</a>
ioctl is used to query the number of Port error interrupt vectors
available. The ioctl requires a pointer to a uint32_t that receives the
Port error interrupt count.</p>
<p><a name="heading-2.2.6"></a></p>
<h4 id="226-port-error-interrupt-configuration"><strong>2.2.6 Port Error Interrupt Configuration</strong></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L191-L201"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_ERR_SET_IRQ</a>
ioctl is used to configure one or more file descriptors for the Port
Error interrupt. The ioctl requires a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L167-L178">dfl_fpga_irq_set</a>.
The values stored in the evtfds field of this struct should be populated
with the event file descriptors for the interrupt, as returned by the
eventfd() C standard library API.</p>
<p><a name="heading-2.2.7"></a></p>
<h4 id="227-number-of-afu-interrupts"><strong>2.2.7 Number of <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interrupts</strong></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L203-L212"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_UINT_GET_IRQ_NUM</a>
ioctl is used to query the number of <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> interrupt vectors available.
The ioctl requires a pointer to a uint32_t that receives the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>
interrupt count.</p>
<p><a name="heading-2.2.8"></a></p>
<h4 id="228-user-afu-interrupt-configuration"><strong>2.2.8 User <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interrupt Configuration</strong></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L214-L224"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_UINT_SET_IRQ</a>
ioctl is used to configure one or more file descriptors for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>
interrupt. The ioctl requires a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L167-L178">dfl_fpga_irq_set</a>.
The values stored in the evtfds field of this struct should be populated
with the event file descriptors for the interrupt, as returned by the
eventfd() C standard library API.</p>
<p><a name="heading-2.2.9"></a></p>
<h4 id="229-partial-reconfiguration"><strong>2.2.9 Partial Reconfiguration</strong></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L228-L249"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>_PORT_<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr></a>
ioctl is used to update the logic stored in the Port’s programmable
region. This ioctl must be issued on the device file descriptor
corresponding to the FPGA_DEVICE (/dev/dfl-fme.X). The ioctl requires a
pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L240-L247">dfl_fpga_fme_port_pr</a>
with each of the fields populated.</p>
<p><a name="heading-2.2.10"></a></p>
<h4 id="2210-number-of-fme-error-irqs"><strong>2.2.10 Number of <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Error IRQs</strong></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L269-L278"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>_ERR_GET_IRQ_NUM</a>
ioctl is used to query the number of <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error interrupt vectors
available. The ioctl requires a pointer to a uint32_t that receives the
<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error interrupt count.</p>
<p><a name="heading-2.2.11"></a></p>
<h5 id="2211-fme-error-interrupt-configuration"><strong>2.2.11 <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Error Interrupt Configuration</strong></h5>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L280-L290"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>_ERR_SET_IRQ</a>
ioctl is used to configure one or more file descriptors for the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>
Error interrupt. The ioctl requires a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L167-L178">dfl_fpga_irq_set</a>.
The values stored in the evtfds field of this struct should be populated
with the event file descriptors for the interrupt, as returned by the
eventfd() C standard library API.
as returned by the eventfd() C standard library API.</p>
<p><a name = "heading-2.3"></a></p>
<h3 id="23-plugin-manager"><strong>2.3 Plugin Manager</strong></h3>
<p>The OPAE Plugin Manager refers to initialization code in libopae-c that
examines an FPGA device’s PCIe Vendor and Device ID and makes an
association between a particular FPGA device and its access method. OPAE
currently supports three device access methods:</p>
<table>
<tbody>
<tr class="odd">
<td><blockquote>
<p><strong>Access Method</strong></p>
</blockquote></td>
<td><blockquote>
<p><strong>Plugin Module</strong></p>
</blockquote></td>
</tr>
<tr class="even">
<td>Device Feature List drivers</td>
<td>libxfpga.so</td>
</tr>
<tr class="odd">
<td>Virtual Function I/O</td>
<td>libopae-v.so</td>
</tr>
<tr class="even">
<td>AFU Simulation Environment</td>
<td>libase.so</td>
</tr>
</tbody>
</table>

<p align = "center">Table 9 Plugin Device Access Methods</p>
<p><a name="table-9"></a></p>
<p>The Plugin Manager allows code that is written to a specific API
signature to access FPGA hardware via different mechanisms. In other
words, the end user codes to the OPAE API; and the OPAE API, based on
configuration data, routes the hardware access to the device via
different means.</p>
<p>As an example, consider an API configuration that accesses FPGA
device_A via the Device Feature List drivers and that accesses FPGA
device_B via <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr>. The application is coded against the OPAE API.</p>
<p>As part of its initialization process, the application enumerates and
discovers an fpga_token corresponding to device_A. That fpga_token is
opened and its <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region 0 is mapped via a call to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L577-L589">fpgaMapMMIO</a>().</p>
<p>The API configuration for device_A is such that the fpga_handle
corresponding to device_A routes its hardware access calls through
libxfpga.so. The call to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L577-L589">fpgaMapMMIO</a>()
is redirected to libxfpga.so’s implementation of the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> mapping
function,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/mmio.c#L374-L401">xfpga_fpgaMapMMIO</a>().
As a result, the call to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/mmio.c#L374-L401">xfpga_fpgaMapMMIO</a>()
uses its <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/mmio.c#L71"><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> file
descriptor</a>
to communicate with the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver to map the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region.</p>
<p>Subsequently, the application enumerates and discovers an fpga_token
corresponding to device_B. That fpga_token is opened and its <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>
region 0 is mapped via a call to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L577-L589">fpgaMapMMIO</a>().</p>
<p>The API configuration for device_B is such that the fpga_handle
corresponding to device_B routes its hardware access calls through
libopae-v.so. The call to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L577-L589">fpgaMapMMIO</a>()
is redirected to libopae-v.so’s implementation of the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> mapping
function,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.c#L996-L1014">vfio_fpgaMapMMIO</a>().
As a result, the call to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.c#L996-L1014">vfio_fpgaMapMMIO</a>()
uses the <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.c#L843-L850"><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>
mapping</a>
performed by libopaevfio.so during initialization of the <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr> session.</p>
<p><a name="heading-2.3.1"></a></p>
<h3 id="231-plugin-model"><strong>2.3.1 Plugin Model</strong></h3>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> plugin model is facilitated by its use of opaque C
structures for
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L94-L107">fpga_token</a>
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L109-L120">fpga_handle</a>.
These types are both declared as void *; and this allows the parameters
to the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> functions to take different forms, depending on the
layer of the SDK being used.</p>
<p>At the topmost layer, for example when calling
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L685-L821">fpgaEnumerate</a>(),
the output fpga_token parameter array is actually an array of pointers
to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/opae_int.h#L102-L109">opae_wrapped_token</a>
struct’s.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_wrapped_token</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">magic</span><span class="p">;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="n">fpga_token</span><span class="w"> </span><span class="n">opae_token</span><span class="p">;</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ref_count</span><span class="p">;</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_wrapped_token</span><span class="w"> </span><span class="o">*</span><span class="n">prev</span><span class="p">;</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_wrapped_token</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="p">;</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="n">opae_api_adapter_table</span><span class="w"> </span><span class="o">*</span><span class="n">adapter_table</span><span class="p">;</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="p">}</span><span class="w"> </span><span class="n">opae_wrapped_token</span><span class="p">;</span>
</code></pre></div>
<p align = "center">Figure 27 opae_wrapped_token</p>
<p><a name="figure-27"></a></p>
<p>An
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/opae_int.h#L102-L109">opae_wrapped_token</a>,
as the name suggests, is a thin wrapper around the lower-layer token
which is stored in struct member opae_token. The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/adapter.h#L38-L220">adapter_table</a>
struct member is a pointer to a plugin-specific adapter table. The
adapter table provides a mapping between the top-layer
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/opae_int.h#L102-L109">opae_wrapped_token</a>
and its underlying plugin-specific API entry points, which are called
using the opae_token struct member (the lower-level token).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_api_adapter_table</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_api_adapter_table</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="p">;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">opae_plugin</span><span class="w"> </span><span class="n">plugin</span><span class="p">;</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="p">...</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="n">fpga_result</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fpgaEnumerate</span><span class="p">)(</span><span class="k">const</span><span class="w"> </span><span class="n">fpga_properties</span><span class="w"> </span><span class="o">*</span><span class="n">filters</span><span class="p">,</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_filters</span><span class="p">,</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="n">fpga_token</span><span class="w"> </span><span class="o">*</span><span class="n">tokens</span><span class="p">,</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">max_tokens</span><span class="p">,</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">num_matches</span><span class="p">);</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="p">...</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">initialize</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">finalize</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="p">}</span><span class="w"> </span><span class="n">opae_api_adapter_table</span><span class="p">;</span>
</code></pre></div>
<p align = "center">Figure 28 opae_api_adapter_table</p>
<p><a name="figure-28"></a></p>
<p>When libopae-c loads, the plugin manager uses the plugin configuration
data to open and configure a session to each of the required plugin
libraries. During this configuration process, each plugin is passed an
empty adapter table struct. The purpose of the plugin configuration is
to populate this adapter table struct with each of the plugin-specific
API entry points.</p>
<p>When the top-level
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L685-L821">fpgaEnumerate</a>()
is called, each adapter table’s plugin-specific fpgaEnumerate() struct
member is called; and the output fpga_token’s are collected. At this
point, these fpga_token’s are the lower-level token structure types.
Before the top-level
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L685-L821">fpgaEnumerate</a>()
returns, these plugin-specific tokens are wrapped inside
opae_wrapped_token structures, along with a pointer to the respective
adapter table.</p>
<p>After enumeration is complete, the application goes on to call other
top-level <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> functions with the wrapped tokens. Each top-level
entry point which accepts an fpga_token knows that it is actually being
passed an
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/opae_int.h#L102-L109">opae_wrapped_token</a>.
With this knowledge, the entry point peeks inside the wrapped token and
calls through to the plugin-specific API entry point using the adapter
table, passing the lower-level opae_token struct member.</p>
<p><a name="heading-2.3.2"></a></p>
<h3 id="232-libxfpga-plugin"><strong>2.3.2 libxfpga Plugin</strong></h3>
<p>2.3.1 Plugin Model introduced the concept of an
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/opae_int.h#L102-L109">opae_wrapped_token</a>
and a corresponding plugin-specific token structure. libxfpga.so is the
plugin library that implements the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver hardware access method.
Its plugin-specific token data structure is struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/types_int.h#L101-L108">_fpga_token</a>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_fpga_token</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">fpga_token_header</span><span class="w"> </span><span class="n">hdr</span><span class="p">;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">device_instance</span><span class="p">;</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">subdev_instance</span><span class="p">;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="kt">char</span><span class="w"> </span><span class="n">sysfspath</span><span class="p">[</span><span class="n">SYSFS_PATH_MAX</span><span class="p">];</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="kt">char</span><span class="w"> </span><span class="n">devpath</span><span class="p">[</span><span class="n">DEV_PATH_MAX</span><span class="p">];</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="k">struct</span><span class="w"> </span><span class="nc">error_list</span><span class="w"> </span><span class="o">*</span><span class="n">errors</span><span class="p">;</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="p">};</span>
</code></pre></div>
Relevant Links:
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L255-L276">fpga_token_header</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/error_int.h#L38-L43">error_list</a></p>
<p align = "center">Figure 29 struct _fpga_token</p>
<p><a name="figure-29"></a></p>
<p>A struct _fpga_token corresponding to the Port will have sysfspath and
devpath members that contain strings like the following example paths:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>sysfspath:<span class="w"> </span>“/sys/class/fpga_region/region0/dfl-port.0”
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>devpath:<span class="w"> </span>“/dev/dfl-port.0”
</code></pre></div>
<p align = "center">Figure 30 libxfpga Port Token</p>
<p><a name="figure-30"></a></p>
<p>Likewise, a struct _fpga_token corresponding to the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> will have
sysfspath and devpath members that contain strings like the following
example paths:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>sysfspath:<span class="w"> </span>“/sys/class/fpga_region/region0/dfl-fme.0”
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>devpath:<span class="w"> </span>“/dev/dfl-fme.0”
</code></pre></div>
<p align = "center">Figure 31 libxfpga FME Token</p>
<p><a name="figure-31"></a></p>
<p>When a call to the top-level
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L272-L307">fpgaOpen</a>()
is made, the lower-level token is unwrapped and passed to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/open.c#L41-L172">xfpga_fpgaOpen</a>().
In return,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/open.c#L41-L172">xfpga_fpgaOpen</a>()
opens the character device file identified by the devpath member of the
struct _fpga_token. It then allocates and initializes an instance of
libxfpga.so’s plugin-specific handle data structure, struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/types_int.h#L153-L177">_fpga_handle</a>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_fpga_handle</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">pthread_mutex_t</span><span class="w"> </span><span class="n">lock</span><span class="p">;</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">magic</span><span class="p">;</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="n">fpga_token</span><span class="w"> </span><span class="n">token</span><span class="p">;</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">fddev</span><span class="p">;</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="kt">int</span><span class="w"> </span><span class="n">fdfpgad</span><span class="p">;</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_irqs</span><span class="p">;</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">irq_set</span><span class="p">;</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="k">struct</span><span class="w"> </span><span class="nc">wsid_tracker</span><span class="w"> </span><span class="o">*</span><span class="n">wsid_root</span><span class="p">;</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="k">struct</span><span class="w"> </span><span class="nc">wsid_tracker</span><span class="w"> </span><span class="o">*</span><span class="n">mmio_root</span><span class="p">;</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">umsg_virt</span><span class="p">;</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">umsg_size</span><span class="p">;</span>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">umsg_iova</span><span class="p">;</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="kt">bool</span><span class="w"> </span><span class="n">metric_enum_status</span><span class="p">;</span>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="n">fpga_metric_vector</span><span class="w"> </span><span class="n">fpga_enum_metric_vector</span><span class="p">;</span>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">bmc_handle</span><span class="p">;</span>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_fpga_bmc_metric</span><span class="w"> </span><span class="o">*</span><span class="n">_bmc_metric_cache_value</span><span class="p">;</span>
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">num_bmc_metric</span><span class="p">;</span>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">flags</span><span class="p">;</span>
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="p">};</span>
</code></pre></div>
Relevant Links:
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/types_int.h#L205-L211">wsid_tracker</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/metrics/vector.h#L45-L49">fpga_metric_vector</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/types_int.h#L146-L151">_fpga_bmc_metric</a></p>
<p align = "center">Figure 32 struct _fpga_handle</p>
<p><a name="figure-32"></a></p>
<p><a name="heading-2.3.3"></a></p>
<h3 id="233-libopae-v-plugin"><strong>2.3.3 libopae-v Plugin</strong></h3>
<p>libopae-v.so is the plugin library that implements the <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr> hardware
access method. Its plugin-specific token data structure is
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.h#L98-L115">vfio_token</a>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="cp">#define USER_MMIO_MAX 8</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_vfio_token</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="n">fpga_token_header</span><span class="w"> </span><span class="n">hdr</span><span class="p">;</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="n">fpga_guid</span><span class="w"> </span><span class="n">compat_id</span><span class="p">;</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="n">pci_device_t</span><span class="w"> </span><span class="o">*</span><span class="n">device</span><span class="p">;</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">region</span><span class="p">;</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">mmio_size</span><span class="p">;</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">pr_control</span><span class="p">;</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">user_mmio_count</span><span class="p">;</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">user_mmio</span><span class="p">[</span><span class="n">USER_MMIO_MAX</span><span class="p">];</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">bitstream_id</span><span class="p">;</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">bitstream_mdata</span><span class="p">;</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="kt">uint8_t</span><span class="w"> </span><span class="n">num_ports</span><span class="p">;</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_vfio_token</span><span class="w"> </span><span class="o">*</span><span class="n">parent</span><span class="p">;</span>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_vfio_token</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="p">;</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="n">vfio_ops</span><span class="w"> </span><span class="n">ops</span><span class="p">;</span>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="p">}</span><span class="w"> </span><span class="n">vfio_token</span><span class="p">;</span>
</code></pre></div>
Relevant Links:
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L255-L276">fpga_token_header</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.h#L83-L92">pci_device_t</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.h#L94-L96">vfio_ops</a></p>
<p align = "center">Figure 33 vfio_token</p>
<p><a name="figure-33"></a></p>
<p>When a call to the top-level
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L272-L307">fpgaOpen</a>()
is made, the lower-level token is unwrapped and passed to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.c#L603-L681">vfio_fpgaOpen</a>().
In return,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.c#L603-L681">vfio_fpgaOpen</a>()
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.c#L645">opens the <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr>
device</a>
matching the device address found in the input vfio_token. It then
allocates and initializes an instance of libopae-v.so’s plugin-specific
handle data structure,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.h#L124-L134">vfio_handle</a>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_vfio_handle</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">magic</span><span class="p">;</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_vfio_token</span><span class="w"> </span><span class="o">*</span><span class="n">token</span><span class="p">;</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="n">vfio_pair_t</span><span class="w"> </span><span class="o">*</span><span class="n">vfio_pair</span><span class="p">;</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="k">volatile</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">mmio_base</span><span class="p">;</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="kt">size_t</span><span class="w"> </span><span class="n">mmio_size</span><span class="p">;</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="n">pthread_mutex_t</span><span class="w"> </span><span class="n">lock</span><span class="p">;</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="cp">#define OPAE_FLAG_HAS_AVX512 (1u &lt;&lt; 0)</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">flags</span><span class="p">;</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="p">}</span><span class="w"> </span><span class="n">vfio_handle</span><span class="p">;</span>
</code></pre></div>
Relevant Links:
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.h#L98-L115">vfio_token</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.h#L118-L122">vfio_pair_t</a></p>
<p align = "center">Figure 34 vfio_handle</p>
<p><a name="figure-34"></a></p>
<p><a name="heading-2.3.3.1"></a></p>
<h4 id="2331-supporting-libraries"><strong>2.3.3.1 Supporting Libraries</strong></h4>
<p><a name="heading-2.3.3.1.1"></a></p>
<h5 id="23311-libopaevfio"><strong>2.3.3.1.1 libopaevfio</strong></h5>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/vfio.h">libopaevfio.so</a>
is OPAE’s implementation of the Linux kernel’s Virtual Function I/O
interface. This <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr> interface presents a generic means of configuring
and accessing PCIe endpoints from a user-space process via a supporting
Linux kernel device driver, vfio-pci.</p>
<p>libopaevfio.so provides APIs for opening/closing a <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr> device instance,
for mapping/unmapping <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> spaces, for allocating/freeing DMA buffers,
and for configuring interrupts for the device.</p>
<p><a name="heading-2.3.3.1.2"></a></p>
<h5 id="23312-libopaemem"><strong>2.3.3.1.2 libopaemem</strong></h5>
<p>Each DMA buffer allocation made by libopaevfio.so’s
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/vfio.h#L333-L336">opae_vfio_buffer_allocate</a>()
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/vfio.h#L394-L398">opae_vfio_buffer_allocate_ex</a>()
APIs requires a backing I/O Virtual Address range. These address ranges
are discovered at <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr> device open time by way of the
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopaevfio/opaevfio.c#L543"><abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr>_IOMMU_GET_INFO</a>
ioctl.</p>
<p>Each range specifies a large contiguous block of I/O Virtual Address
space. The typical DMA buffer allocation size is significantly less than
one of these IOVA blocks, so the division of each block into allocatable
segments must be managed so that multiple DMA buffer allocations can be
made from a single block. In other words, the IOVA blocks must be
memory-managed in order to make efficient use of them.</p>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mem_alloc.h">libopaemem.so</a>
provides a generic means of managing a large memory space, consisting of
individual large memory blocks of contiguous address space. When a DMA
buffer allocation is requested, libopaevfio.so uses this generic memory
manager to carve out a small chunk of contiguous IOVA address space in
order for the DMA mapping to be made. The IOVA space corresponding to
the allocation is marked as allocated, and the rest of the large block
remains as allocatable space within the memory manager. Subsequent
de-allocation returns a chunk of IOVA space to the free state,
coalescing contiguous chunks as they are freed. The allocations and
de-allocations of the IOVA space can occur in any order with respect to
each other. libopaemem.so tracks both the allocated and free block
space, carving out small chunks from the large IOVA blocks on
allocations, and coalescing small chunks back into larger ones on frees.</p>
<p><a name="heading-2.3.3.2"></a></p>
<h4 id="2332-configuring-pcie-virtual-functions"><strong>2.3.3.2 Configuring PCIe Virtual Functions</strong></h4>
<p>Before an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> can be accessed with <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr>, the FPGA Physical Function must
be configured to enable its Virtual Functions. Then, each VF must be
bound to the vfio-pci Linux kernel driver.</p>
<p>As of the Arrow Creek program, the FPGA hardware allows multiple <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>’s
to co-exist by placing each <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in its own PCIe Virtual Function. Upon
system startup, no PCIe VF’s exist. The pci_device command can be used
to enable the VF’s and their <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>’s. First, use the lspci command to
examine the current device topology:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># lspci | grep cel</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>b1:00.0<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>b1:00.1<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>b1:00.2<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>b1:00.3<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Red<span class="w"> </span>Hat,<span class="w"> </span>Inc.<span class="w"> </span>Virtio<span class="w"> </span>network<span class="w"> </span>device
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>b1:00.4<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
</code></pre></div>
<p align = "center">Figure 35 lspci Device Topology</p>
<p><a name="figure-35"></a></p>
<p>In this example, VF’s are controlled by PF 0, as highlighted in <a href="#figure-35">Figure
35 lspci Device Topology</a>. In the figure, each PF is shown as having the
Arrow Creek PF PCIe device ID of bcce.</p>
<p>Now, use the pci_device command to enable three VF’s for PF0:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1"># pci_device 0000:b1:00.0 vf 3</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="c1"># lspci | grep cel</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>b1:00.0<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>b1:00.1<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>b1:00.2<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>b1:00.3<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Red<span class="w"> </span>Hat,<span class="w"> </span>Inc.<span class="w"> </span>Virtio<span class="w"> </span>network<span class="w"> </span>device
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>b1:00.4<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>b1:00.5<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>b1:00.6<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>b1:00.7<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf
</code></pre></div>
<p align = "center">Figure 36 Enable Virtual Functions</p>
<p><a name="figure-36"></a></p>
<p>Figure 20 Enable Virtual Functions shows that three VF’s were created.
Each VF is shown as having the Arrow Creek VF PCIe device ID of bccf.</p>
<p>Now, each Virtual Function must be bound to the vfio-pci Linux kernel
driver so that it can be accessed via <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># opaevfio -i -u myuser -g mygroup 0000:b1:00.5</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.5<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.5<span class="w"> </span>is<span class="w"> </span><span class="m">318</span>
</code></pre></div>
<p align = "center">Figure 37 Bind VF's to vfio-pci</p>
<p><a name="figure-37"></a></p>
<p>Here, myuser and mygroup identify the unprivileged user/group that
requires access to the device. The opaevfio command will change the
ownership of the device per the values given.</p>
<p>Once the VF’s are bound to vfio-pci, the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> will find and
enumerate them with libopae-v.so:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># fpgainfo port</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>Object<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xEF00000
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w"> </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.0
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>Device<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>Socket<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0x00
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>Object<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xE0B1000000000000
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w"> </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.7
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>Device<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>Socket<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0x01
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>Accelerator<span class="w"> </span>GUID<span class="w"> </span>:<span class="w"> </span>4dadea34-2c78-48cb-a3dc-5b831f5cecbb
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>Object<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xC0B1000000000000
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w"> </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.6
<a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>Device<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a>Socket<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0x01
<a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a>Accelerator<span class="w"> </span>GUID<span class="w"> </span>:<span class="w"> </span>823c334c-98bf-11ea-bb37-0242ac130002
<a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a>Object<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xA0B1000000000000
<a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w"> </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.5
<a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a>Device<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a>Socket<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0x01
<a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a>Accelerator<span class="w"> </span>GUID<span class="w"> </span>:<span class="w"> </span>8568ab4e-6ba5-4616-bb65-2a578330a8eb
</code></pre></div>
<p align = "center">Figure 38 List VF's with fpgainfo</p>
<p><a name="figure-38"></a></p>
<p>When the VF’s are no longer needed, they can be unbound from the
vfio-pci driver:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># opaevfio -r 0000:b1:00.5</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>Releasing<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.5<span class="w"> </span>from<span class="w"> </span>vfio-pci
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="c1"># opaevfio -r 0000:b1:00.6</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>Releasing<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.6<span class="w"> </span>from<span class="w"> </span>vfio-pci
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="c1"># opaevfio -r 0000:b1:00.7</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>Releasing<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.7<span class="w"> </span>from<span class="w"> </span>vfio-pci
</code></pre></div>
<p align = "center">Figure 39 Unbind VF's from vfio-pci</p>
<p><a name="figure-39"></a></p>
<p>Finally, the VF’s can be disabled:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># pci_device 0000:b1:00.0 vf 0</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="c1"># lspci | grep cel</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>b1:00.0<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>b1:00.1<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>b1:00.2<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>b1:00.3<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Red<span class="w"> </span>Hat,<span class="w"> </span>Inc.<span class="w"> </span>Virtio<span class="w"> </span>network<span class="w"> </span>device
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>b1:00.4<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
</code></pre></div>
<p align = "center">Figure 40 Disable Virtual Functions</p>
<p><a name="figure-40"></a></p>
<p><a name = "heading-2.4"></a></p>
<h3 id="24-application-flow"><strong>2.4 Application Flow</strong></h3>
<p>A typical OPAE application that interacts with an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> via <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> and
shared memory will have a flow similar to the one described in this
section.</p>
<p><a name="heading-2.4.1"></a></p>
<h4 id="241-create-filter-criteria"><strong>2.4.1 Create Filter Criteria</strong></h4>
<p>Refer to 2.1.2 Enumeration. When enumerating <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>’s, if no filtering
criteria is specified, then
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L101-L103">fpgaEnumerate</a>()
returns fpga_token’s for each <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that is present in the system. In
order to limit the enumeration search to a specific <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, create an
fpga_properties object and set its guid to that of the desired <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="cp">#define MY_AFU_GUID “57fa0b03-ab4f-4b02-b4eb-d3fe1ec18518”</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="n">fpga_properties</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="n">fpga_guid</span><span class="w"> </span><span class="n">guid</span><span class="p">;</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="n">fpgaGetProperties</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">filter</span><span class="p">);</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="n">uuid_parse</span><span class="p">(</span><span class="n">MY_AFU_GUID</span><span class="p">,</span><span class="w"> </span><span class="n">guid</span><span class="p">);</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="n">fpgaPropertiesSetGUID</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="n">guid</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 41 Flow: Create Filter Criteria</p>
<p><a name="figure-41"></a></p>
<p><a name="heading-2.4.2"></a></p>
<h4 id="242-enumerate-the-afu"><strong>2.4.2 Enumerate the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong></h4>
<p>With the filtering criteria in place, enumerate to obtain an fpga_token
for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">fpga_token</span><span class="w"> </span><span class="n">afu_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="n">fpgaEnumerate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">afu_token</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num_matches</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 42 Flow: Enumerate the AFU</p>
<p><a name="figure-42"></a></p>
<p><a name="heading-2.4.3"></a></p>
<h4 id="243-open-the-afu"><strong>2.4.3 Open the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong></h4>
<p>After finding an fpga_token for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L101-L103">fpgaEnumerate</a>(),
the token must be opened with
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L72-L73">fpgaOpen</a>()
to establish a session with the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The process of opening an
fpga_token creates an fpga_handle:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">fpga_handle</span><span class="w"> </span><span class="n">afu_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">fpgaOpen</span><span class="p">(</span><span class="n">afu_token</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 43 Flow: Open the AFU</p>
<p><a name="figure-43"></a></p>
<p><a name="heading-2.4.4"></a></p>
<h4 id="244-map-mmio-region"><strong>2.4.4 Map <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Region</strong></h4>
<p>In order to access the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to program its CSR’s, the
region must first be mapped into the application’s process address
space. This is accomplished using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mmio.h#L182-L183">fpgaMapMMIO</a>():</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">fpgaMapMMIO</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 44 Flow: Map MMIO Region</p>
<p><a name="figure-44"></a></p>
<p><a name="heading-2.4.5"></a></p>
<h4 id="245-allocate-dma-buffers"><strong>2.4.5 Allocate DMA Buffers</strong></h4>
<p>If the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is DMA-capable, shared memory buffers can be allocated and
mapped into the process address space and the IOMMU with
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L97-L99">fpgaPrepareBuffer</a>().
Refer to Figure 8 Configuring Huge Pages for instructions on configuring
2MiB and 1GiB huge pages.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="cp">#define BUF_SIZE (2 * 1024 * 1024)</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="k">volatile</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">src_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">src_wsid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="k">volatile</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">dest_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">dest_wsid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="n">fpgaPrepareBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">src_ptr</span><span class="p">,</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="o">&amp;</span><span class="n">src_wsid</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="n">fpgaPrepareBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dest_ptr</span><span class="p">,</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="o">&amp;</span><span class="n">dest_wsid</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="n">memset</span><span class="p">(</span><span class="n">src_ptr</span><span class="p">,</span><span class="w"> </span><span class="mh">0xaf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="n">memset</span><span class="p">(</span><span class="n">dest_ptr</span><span class="p">,</span><span class="w"> </span><span class="mh">0xbe</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 45 Flow: Allocate DMA Buffers</p>
<p><a name="figure-45"></a></p>
<p><a name="heading-2.4.6"></a></p>
<h4 id="246-make-afu-aware-of-dma-buffers"><strong>2.4.6 Make <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Aware of DMA Buffers</strong></h4>
<p>The process by which locations of shared memory buffers and their sizes
are made known to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is entirely <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>-specific. This example shows
the method used by the Native Loopback <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. Each buffer I/O virtual
address is cacheline-aligned and programmed into a unique <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSR; then
the buffer size in lines is programmed into a length CSR:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="cp">#define CSR_SRC_ADDR 0x000A </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="cp">#define CSR_DEST_ADDR 0x000B </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="cp">#define CSR_NUM_LINES 0x000C </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">src_iova</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">dest_iova</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="n">fpgaGetIOAddress</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">src_wsid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">src_iova</span><span class="p">);</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="n">fpgaGetIOAddress</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">dest_wsid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dest_iova</span><span class="p">);</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_SRC_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">src_iova</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_DEST_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">dest_iova</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_NUM_LINES</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">64</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 46 Flow: Make AFU Aware of DMA Buffers</p>
<p><a name="figure-46"></a></p>
<p><a name="heading-2.4.7"></a></p>
<h4 id="247-initiate-an-acceleration-task"><strong>2.4.7 Initiate an Acceleration Task</strong></h4>
<p>With the shared buffer configuration complete, the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> can be told to
initiate the acceleration task. This process is <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>-specific. The Native
Loopback <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> starts the acceleration task by writing a value to its
control CSR:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="cp">#define CSR_CTRL 0x000D </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_CTRL</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 47 Initiate an Acceleration Task</p>
<p><a name="figure-47"></a></p>
<p><a name="heading-2.4.8"></a></p>
<h4 id="248-wait-for-task-completion">2.4.8 Wait for Task Completion</h4>
<p>Once the acceleration task is initiated, the application may poll the
<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> for a completion status. This process is <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>-specific. The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may
provide a status CSR for the application to poll; or the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may
communicate status to the application by means of a result code written
to a shared buffer.</p>
<p><a name="heading-2.4.9"></a></p>
<h4 id="249-free-dma-buffers">2.4.9 Free DMA Buffers</h4>
<p>When the acceleration task completes and the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is quiesced such that
there are no outstanding memory transactions targeted for the shared
memory, the DMA buffers can be unmapped and freed using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L115">fpgaReleaseBuffer</a>():</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">fpgaReleaseBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">src_wsid</span><span class="p">);</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="n">fpgaReleaseBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">dest_wsid</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 48 Flow: Free DMA Buffers</p>
<p><a name="figure-48"></a></p>
<p><a name="heading-2.4.10"></a></p>
<h4 id="2410-unmap-mmio-region">2.4.10 Unmap <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Region</h4>
<p>The <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> regions should also be unmapped using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mmio.h#L200-L201">fpgaUnmapMMIO</a>():</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">fpgaUnmapMMIO</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="p">);</span>
</code></pre></div>
<br></p>
<p align = "center">Figure 49 Flow: Unmap MMIO Region</p>
<p><a name="figure-49"></a></p>
<p><a name="heading-2.4.11"></a></p>
<h4 id="2411-close-the-afu"><strong>2.4.11 Close the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong></h4>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> handle should be closed via
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L88">fpgaClose</a>()
to release its resources:</p>
<p><br></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">fpgaClose</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">);</span>
</code></pre></div>
<p><br></p>
<p><a name="heading-2.4.12"></a></p>
<p><br></p>
<h4 id="2412-release-the-tokens-and-properties">2.4.12 Release the Tokens and Properties</h4>
<p>The fpga_token’s returned by
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L101-L103">fpgaEnumerate</a>()
should be destroyed using the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L133">fpgaDestroyToken</a>()
API. The fpga_properties objects should be destroyed using the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/properties.h#L176">fpgaDestroyProperties</a>()
API:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="n">fpgaDestroyToken</span><span class="p">(</span><span class="o">&amp;</span><span class="n">afu_token</span><span class="p">);</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="n">fpgaDestroyProperties</span><span class="p">(</span><span class="o">&amp;</span><span class="n">filter</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 51 Flow: Release the Tokens and Properties</p>
<p><a name="figure-51"></a></p>
<p><a name="heading-3.0"></a></p>
<h3 id="30-opae-c-api"><strong>3.0 OPAE C++ API</strong></h3>
<p>The OPAE C++ API refers to a C++ layer that sits on top of the OPAE C
API, providing object-oriented implementations of the main OPAE C API
abstractions: properties, tokens, handles, dma buffers, etc. Like the
OPAE C API, the <a href="https://github.com/OFS/opae-sdk/tree/master/include/opae/cxx/core">C++ API
headers</a>
contain Doxygen markup for each of the provided classes.</p>
<p><a name="heading-3.1"></a></p>
<h4 id="31-libopae-cxx-core"><strong>3.1 libopae-cxx-core</strong></h4>
<p>The implementation files for the C++ API are compiled into
libopae-cxx-core.so. A convenience header,
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core.h">core.h</a>,
provides a quick means of including each of the C++ API headers. Each of
the types comprising the C++ API is located within the opae::fpga::types
C++ namespace.</p>
<p><a name="heading-3.1.1"></a></p>
<h5 id="311-properties"><strong>3.1.1 Properties</strong></h5>
<p>Class
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/properties.h#L41-L137">properties</a>
provides the C++ implementation of the fpga_properties type and its
associated APIs.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">properties</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">properties</span><span class="o">::</span><span class="n">get</span><span class="p">();</span>
</code></pre></div>
<p align = "center">Figure 52 C++ Create New Empty Properties</p>
<p><a name="figure-52"></a></p>
<p>Class properties provides <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/properties.h#L114-L136">member
variables</a>
for each fpga_properties item that can be manipulated with
fpgaPropertiesGet…() and fpgaPropertiesSet…(). For example, to set the
<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> ID in a properties instance and to set that instance’s type to
FPGA_ACCELERATOR:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="cp">#define MY_AFU_ID “8ad74241-d13b-48eb-b428-7986dcbcab14”</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="n">filter</span><span class="o">-&gt;</span><span class="n">guid</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">MY_AFU_ID</span><span class="p">);</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="n">filter</span><span class="o">-&gt;</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPGA_ACCELERATOR</span><span class="p">;</span>
</code></pre></div>
<p align = "center">Figure 53 C++ Properties Set GUID and Type</p>
<p><a name="figure-53"></a></p>
<p><a name="heading-3.1.2"></a></p>
<h5 id="312-tokens"><strong>3.1.2 Tokens</strong></h5>
<p>Class
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/token.h#L39-L77">token</a>
provides the C++ implementation of the fpga_token type and its
associated APIs. Class token also provides the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/token.h#L48-L54">enumerate</a>()
static member function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">token</span><span class="o">::</span><span class="n">ptr_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tokens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">token</span><span class="o">::</span><span class="n">enumerate</span><span class="p">({</span><span class="n">filter</span><span class="p">});</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tokens</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="c1">// flag error and return</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="p">}</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="n">token</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">tok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</code></pre></div>
<p align = "center">Figure 54 C++ Enumeration</p>
<p><a name="figure-54"></a></p>
<p><a name="heading-3.1.3"></a></p>
<h5 id="313-handles"><strong>3.1.3 Handles</strong></h5>
<p>Class
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/handle.h#L38-L194">handle</a>
provides the C++ implementation of the fpga_handle type and its
associated APIs. The handle class provides member functions for opening
and closing a token, for reading and writing to <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> space, and for
reconfiguring the FPGA’s Programmable Region.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">handle</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">accel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handle</span><span class="o">::</span><span class="n">open</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 55 C++ Opening a Handle</p>
<p><a name="figure-55"></a></p>
<p><a name="heading-3.1.4"></a></p>
<h5 id="314-shared-memory"><strong>3.1.4 Shared Memory</strong></h5>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/shared_buffer.h#L42-L173">shared_buffer</a>
class provides member functions for allocating and releasing DMA
buffers, for querying buffer attributes, and for reading and writing
buffers.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="cp">#define BUF_SIZE (2 * 1024 * 1024)</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="n">shared_buffer</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shared_buffer</span><span class="o">::</span><span class="n">allocate</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="n">shared_buffer</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shared_buffer</span><span class="o">::</span><span class="n">allocate</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="n">std</span><span class="o">::</span><span class="n">fill_n</span><span class="p">(</span><span class="n">input</span><span class="o">-&gt;</span><span class="n">c_type</span><span class="p">(),</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">,</span><span class="w"> </span><span class="mh">0xaf</span><span class="p">);</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="n">std</span><span class="o">::</span><span class="n">fill_n</span><span class="p">(</span><span class="n">output</span><span class="o">-&gt;</span><span class="n">c_type</span><span class="p">(),</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">,</span><span class="w"> </span><span class="mh">0xbe</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 56 C++ Allocate and Init Buffers</p>
<p><a name="figure-56"></a></p>
<p>Once DMA buffers have been allocated, their IO addresses are programmed
into <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>-specific CSRs to enable the DMA. Here, the IO address of each
buffer is aligned to the nearest cache line before programming it into
the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSR space. The number of cache lines is then programmed into the
appropriate <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSR.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="cp">#define CSR_SRC_ADDR 0x000A </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="cp">#define CSR_DEST_ADDR 0x000B </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="cp">#define CSR_NUM_LINES 0x000C </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="cp">#define LOG2_CL 6</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="n">accel</span><span class="o">-&gt;</span><span class="n">write_csr64</span><span class="p">(</span><span class="n">CSR_SRC_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="o">-&gt;</span><span class="n">io_address</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">LOG2_CL</span><span class="p">);</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="n">accel</span><span class="o">-&gt;</span><span class="n">write_csr64</span><span class="p">(</span><span class="n">CSR_DEST_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="o">-&gt;</span><span class="n">io_address</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">LOG2_CL</span><span class="p">);</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="n">accel</span><span class="o">-&gt;</span><span class="n">write_csr32</span><span class="p">(</span><span class="n">CSR_NUM_LINES</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">64</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 57 C++ Make the AFU Aware of DMA Buffers</p>
<p><a name="figure-57"></a></p>
<p><a name="heading-3.1.5"></a></p>
<h5 id="315-events"><strong>3.1.5 Events</strong></h5>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/events.h#L37-L108">event</a>
class provides member functions for event registration. In order to
register an event, provide the handle::ptr_t for the desired device,
along with the event type and optional flags.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">vect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="n">event</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">evt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="o">::</span><span class="n">register_event</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="n">FPGA_EVENT_INTERRUPT</span><span class="p">,</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="n">vect</span><span class="p">);</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">evt_fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evt</span><span class="p">.</span><span class="n">os_object</span><span class="p">();</span>
</code></pre></div>
<p align = "center">Figure 58 C++ Event Registration</p>
<p><a name="figure-58"></a></p>
<p><a name="heading-3.1.6"></a></p>
<h5 id="316-errors"><strong>3.1.6 Errors</strong></h5>
<p>Class
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/errors.h#L37-L97">error</a>
provides a means of querying the device errors given a token::ptr_t.
The token and integer ID provided to the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/errors.h#L50-L59">error::get</a>()
static member function uniquely identify one of the 64-bit error masks
associated with the token.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="n">error</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">error</span><span class="o">::</span><span class="n">get</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 59 C++ Query Device Errors</p>
<p><a name="figure-59"></a></p>
<p><a name="heading-3.1.7"></a></p>
<h5 id="317-sysobject"><strong>3.1.7 SysObject</strong></h5>
<p>Class
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/sysobject.h#L38-L196">sysobject</a>
is the C++ implementation of the OPAE SysObject API. sysobject provides
a means of creating class instances via its two
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/sysobject.h#L52-L86">sysobject::get</a>()
static member functions. A third non-static
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/sysobject.h#L88-L103">sysobject::get</a>()
enables creating a sysobject instance given a parent sysobject instance.
The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/sysobject.h#L124-L137">read64</a>()
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/sysobject.h#L139-L152">write64</a>()
member functions allow reading and writing the sysobject’s value as a
64-bit unsigned integer. The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/sysobject.h#L154-L177">bytes</a>()
member functions allow reading a sysobject’s value as a raw byte stream.</p>
<p><a name="heading-4.0"></a></p>
<h3 id="40-opae-python-api"><strong>4.0 OPAE Python API</strong></h3>
<p>The OPAE Python API refers to a Python layer that sits on top of the
OPAE C++ API, providing Python implementations of the OPAE C++ API
abstractions: properties, tokens, handles, dma buffers, etc.</p>
<p><a name="heading-4.1"></a></p>
<h4 id="41-_opae"><strong>4.1 _opae</strong></h4>
<p>The Python API is coded as a
<a href="https://pybind11.readthedocs.io/en/stable/">pybind11</a> project, which
allows C++ code to directly interface with Python internals. Each C++
API concept is encoded into a Python equivalent. The functionality
exists as a Python extension module, compiled into _opae.so.</p>
<p><a name="heading-4.1.1"></a></p>
<h5 id="411-enumeration"><strong>4.1.1 Enumeration</strong></h5>
<p>Enumeration is somewhat simplified as compared to the OPAE C/C++ APIs.
The fpga.enumerate() function accepts keyword arguments for each of the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/properties.h#L115-L136">property
names</a>
that are defined in the C++ API. As an example, to enumerate for an
FPGA_ACCELERATOR by its GUID:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="kn">from</span> <span class="nn">opae</span> <span class="kn">import</span> <span class="n">fpga</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="n">MY_ACCEL</span> <span class="o">=</span> <span class="err">“</span><span class="n">d573b29e</span><span class="o">-</span><span class="mi">176</span><span class="n">f</span><span class="o">-</span><span class="mi">4</span><span class="n">cb7</span><span class="o">-</span><span class="n">b810</span><span class="o">-</span><span class="n">efbf7be34cc9</span><span class="err">”</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="n">tokens</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">enumerate</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">fpga</span><span class="o">.</span><span class="n">ACCELERATOR</span><span class="p">,</span> <span class="n">guid</span><span class="o">=</span><span class="n">MY_ACCEL</span><span class="p">)</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="k">assert</span> <span class="n">tokens</span><span class="p">,</span> <span class="err">“</span><span class="n">No</span> <span class="n">accelerator</span> <span class="n">matches</span> <span class="p">{}</span><span class="err">”</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MY_ACCEL</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 60 Python Enumeration</p>
<p><a name="figure-60"></a></p>
<p>The return value from the fpga.enumerate() function is a list of all the
token objects matching the search criteria.</p>
<p><a name="heading-4.1.2"></a></p>
<h5 id="412-properties"><strong>4.1.2 Properties</strong></h5>
<p>Querying properties for a token or handle is also a bit different in the
Python API. In order to query properties for one of these objects, pass
the object to the fpga.properties() constructor. The return value is a
properties object with each of the <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/properties.h#L115-L136">property
names</a>
defined as instance attributes.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="n">prop</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;0x</span><span class="si">{</span><span class="n">prop</span><span class="o">.</span><span class="n">vendor_id</span><span class="si">:</span><span class="s1">04x</span><span class="si">}</span><span class="s1"> 0x</span><span class="si">{</span><span class="n">prop</span><span class="o">.</span><span class="n">device_id</span><span class="si">:</span><span class="s1">04x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 61 Python Get Token Properties</p>
<p><a name="figure-61"></a></p>
<p>Properties objects may also be created by invoking the fpga.properties()
constructor, passing the same keyword arguments as those to
fpga.enumerate(). Properties objects created in this way are also useful
for enumeration purposes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="n">props</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">fpga</span><span class="o">.</span><span class="n">ACCELERATOR</span><span class="p">)</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="n">tokens</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">enumerate</span><span class="p">([</span><span class="n">props</span><span class="p">])</span>
</code></pre></div>
<p align = "center">Figure 62 Python Properties Constructor</p>
<p><a name="figure-62"></a></p>
<p><a name="heading-4.1.3"></a></p>
<h5 id="413-tokens"><strong>4.1.3 Tokens</strong></h5>
<p>Tokens overload both the __getitem__ and __getattr__ methods to
enable the SysObject API. Both of the following are valid forms of
accessing the ‘errors/first_error’ sysfs attribute, given a token
object:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="n">tok</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="n">ferr</span> <span class="o">=</span> <span class="n">tok</span><span class="p">[</span><span class="s1">&#39;errors/first_error&#39;</span><span class="p">]</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;first error: 0x</span><span class="si">{</span><span class="n">ferr</span><span class="o">.</span><span class="n">read64</span><span class="p">()</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;0x</span><span class="si">{:0x}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">first_error</span><span class="o">.</span><span class="n">read64</span><span class="p">()))</span>
</code></pre></div>
<p align = "center">Figure 63 Python Tokens and SysObject API</p>
<p><a name="figure-63"></a></p>
<p>Tokens also implement a find() method, which accepts a glob expression
in order to search sysfs. The following example finds the “id” sysfs
entry in the given token’s sysfs tree.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="n">my_id</span> <span class="o">=</span> <span class="n">tok</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="err">‘</span><span class="n">i</span><span class="err">?’</span><span class="p">)</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">my_id</span><span class="o">.</span><span class="n">read64</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 64 Python Token Find</p>
<p><a name="figure-64"></a></p>
<p><a name="heading-4.1.4"></a></p>
<h5 id="414-handles"><strong>4.1.4 Handles</strong></h5>
<p>Tokens are converted to handles by way of the fpga.open() function. The
flags (second) parameter to fpga.open() may be zero or
fpga.OPEN_SHARED.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="k">with</span> <span class="n">fpga</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">fpga</span><span class="o">.</span><span class="n">OPEN_SHARED</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>    <span class="n">use_the_handle</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 65 Python Open Handle</p>
<p><a name="figure-65"></a></p>
<p>Like token objects, handle objects overload __getitem__ and
__getattr__ methods to enable the SysObject API. handle also
provides a find() method similar to token’s find().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="n">err</span> <span class="o">=</span> <span class="n">handle</span><span class="p">[</span><span class="s1">&#39;errors/errors&#39;</span><span class="p">]</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;errors: 0x</span><span class="si">{</span><span class="n">err</span><span class="o">.</span><span class="n">read64</span><span class="p">()</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;first error: 0x</span><span class="si">{:0x}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="n">handle</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">first_error</span><span class="o">.</span><span class="n">read64</span><span class="p">()))</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="n">my_id</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;i?&#39;</span><span class="p">)</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">my_id</span><span class="o">.</span><span class="n">read64</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 66 Python Handles and SysObject API</p>
<p><a name="figure-66"></a></p>
<p>Partial reconfiguration is provided by class handle’s reconfigure()
method. The first parameter, slot, will be zero in most designs. The
second parameter is an opened file descriptor to the file containing the
GBS image. The third parameter, flags, defaults to zero.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="err">‘</span><span class="n">my</span><span class="o">.</span><span class="n">gbs</span><span class="err">’</span><span class="p">,</span> <span class="err">‘</span><span class="n">rb</span><span class="err">’</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>    <span class="n">handle</span><span class="o">.</span><span class="n">reconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 67 Python Partial Reconfiguration</p>
<p><a name="figure-67"></a></p>
<p>Device reset is accomplished by means of handle’s reset() method, which
takes no parameters.</p>
<p>Finally for handles, CSR space reads are accomplished via read_csr32()
and read_csr64(). Both methods accept the register offset as the first
parameter and an optional csr_space index, which defaults to zero, as
the second parameter. CSR space writes are accomplished via
write_csr32() and write_csr64(). Both methods accept the register
offset as the first parameter, the value to write as the second, and an
optional csr_space index, which defaults to zero, as the third.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="nb">print</span><span class="p">(</span><span class="err">’</span><span class="mi">0</span><span class="n">x</span><span class="p">{:</span><span class="mi">0</span><span class="n">x</span><span class="p">}</span><span class="err">’</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">read_csr32</span><span class="p">(</span><span class="mh">0x000a</span><span class="p">)))</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="nb">print</span><span class="p">(</span><span class="err">‘</span><span class="mi">0</span><span class="n">x</span><span class="p">{:</span><span class="mi">0</span><span class="n">x</span><span class="p">}</span><span class="err">’</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">read_csr64</span><span class="p">(</span><span class="mh">0x000c</span><span class="p">)))</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="n">handle</span><span class="o">.</span><span class="n">write_csr32</span><span class="p">(</span><span class="mh">0x000b</span><span class="p">,</span> <span class="mh">0xdecafbad</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="n">handle</span><span class="o">.</span><span class="n">write_csr64</span><span class="p">(</span><span class="mh">0x000e</span><span class="p">,</span> <span class="mh">0xc0cac01adecafbad</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 68 Python Read/Write CSR</p>
<p><a name="figure-68"></a></p>
<p><a name="heading-4.1.5"></a></p>
<h5 id="415-shared-memory"><strong>4.1.5 Shared Memory</strong></h5>
<p>The fpga.allocate_shared_buffer() function provides access to the OPAE
memory allocator. The allocation sizes and required huge page
configurations are the same as those noted in 2.1.5 <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> and Shared
Memory.</p>
<p>The fpga.allocate_shared_buffer() function returns an object instance
of type shared_buffer. The shared_buffer class implements methods
size(), wsid(), and io_address(), which return the buffer size in
bytes, the unique workspace ID, and the IO address respectively:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="n">buf</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">allocate_shared_buffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="err">’</span><span class="n">size</span><span class="p">:</span> <span class="p">{</span><span class="n">buf</span><span class="o">.</span><span class="n">size</span><span class="p">()}</span><span class="err">’</span><span class="p">)</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="err">’</span><span class="n">wsid</span><span class="p">:</span> <span class="mi">0</span><span class="n">x</span><span class="p">{</span><span class="n">buf</span><span class="o">.</span><span class="n">wsid</span><span class="p">():</span><span class="mi">0</span><span class="n">x</span><span class="p">}</span><span class="err">’</span><span class="p">)</span>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="err">’</span><span class="n">io_address</span><span class="p">:</span> <span class="mi">0</span><span class="n">x</span><span class="p">{</span><span class="n">buf</span><span class="o">.</span><span class="n">io_address</span><span class="p">():</span><span class="mi">0</span><span class="n">x</span><span class="p">}</span><span class="err">’</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 69 Python Allocate Shared Memory</p>
<p><a name="figure-69"></a></p>
<p>The shared_buffer class implements a fill() method which takes an
integer parameter which is applied to each byte of the buffer (similar
to C standard library’s memset()). The compare() method compares the
contents of the first size bytes of one buffer to another. The value
returned from compare() is the same as the C standard library’s
memcmp(). The copy() method copies the first size bytes of the calling
buffer into the argument buffer.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="n">b0</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">allocate_shared_buffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="n">b1</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">allocate_shared_buffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="n">b0</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mh">0xa5</span><span class="p">)</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="n">b1</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mh">0xa5</span><span class="p">)</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;compare: </span><span class="si">{</span><span class="n">b0</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">4096</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="n">b1</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mh">0xa0</span><span class="p">)</span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="n">b0</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;compare: </span><span class="si">{</span><span class="n">b0</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">4096</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 70 Python Buffer Fill, Copy, Compare</p>
<p><a name="figure-70"></a></p>
<p>shared_buffer’s read32() and read64() methods read a 32- or 64-bit
value from the given offset. The write32() and write64() methods write a
32- or 64-bit value to the given offset.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;value at 0: 0x</span><span class="si">{</span><span class="n">b0</span><span class="o">.</span><span class="n">read32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;value at 4: 0x</span><span class="si">{</span><span class="n">b0</span><span class="o">.</span><span class="n">read64</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="n">b0</span><span class="o">.</span><span class="n">write32</span><span class="p">(</span><span class="mh">0xabadbeef</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="n">b0</span><span class="o">.</span><span class="n">write64</span><span class="p">(</span><span class="mh">0xdecafbadabadbeef</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;value at 0: 0x</span><span class="si">{</span><span class="n">b0</span><span class="o">.</span><span class="n">read32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;value at 4: 0x</span><span class="si">{</span><span class="n">b0</span><span class="o">.</span><span class="n">read64</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 71 Python Buffer Read and Write</p>
<p><a name="figure-71"></a></p>
<p>The shared_buffer class provides three polling methods: poll(),
poll32(), and poll64(). Each method takes an offset as its first
parameter. The second parameter is a value and the third is a mask. The
value and mask parameters are 8 bits wide for poll(), 32 bits wide for
poll32(), and 64 bits wide for poll64(). The fourth and last parameter
is a timeout value which defaults to 1000 microseconds.</p>
<p>Each polling method reads the n-bit wide item at offset and applies
(logical AND) the mask to that value. The masked value created in the
previous step is then compared to the second parameter, value. If the
two values are equal, then the method returns true immediately.
Otherwise, the method continues to loop, attempting the same comparison
over and over <strong>without sleeping</strong>. Finally, if the elapsed time from
the beginning of the call to the current time is greater than or equal
to the timeout value, then the method times out and returns false.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="k">if</span> <span class="n">b0</span><span class="o">.</span><span class="n">poll32</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0xbebebebe</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">,</span> <span class="mi">250</span><span class="p">):</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="err">‘</span><span class="n">Got</span> <span class="n">it</span><span class="err">!’</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 72 Python Buffer Poll</p>
<p><a name="figure-72"></a></p>
<p>The shared_buffer split() method allows creating two or more buffer
objects from one larger buffer object. The return value is a list of
shared_buffer instances whose sizes match the arguments given to
split().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">2048</span><span class="p">)</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;b1 io_address: 0x</span><span class="si">{</span><span class="n">b1</span><span class="o">.</span><span class="n">io_address</span><span class="p">()</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;b2 io_address: 0x</span><span class="si">{</span><span class="n">b2</span><span class="o">.</span><span class="n">io_address</span><span class="p">()</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 73 Python Splitting Buffer</p>
<p><a name="figure-73"></a></p>
<p>Finally, the shared_buffer class implements the Python buffer protocol
to support
<a href="https://docs.python.org/dev/library/stdtypes.html#memoryviewhttps://docs.python.org/dev/library/stdtypes.html">memoryview</a>
objects. The Python buffer protocol allows access to an object’s
underlying memory without copying that memory. As a brief example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="n">mv</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="k">assert</span> <span class="n">mv</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="k">assert</span> <span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xbe</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="n">b1</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">65536</span><span class="p">)</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="k">assert</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;L&#39;</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b1</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">19</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">65536</span>
</code></pre></div>
<p align = "center">Figure 74 Python memoryview</p>
<p><a name="figure-74"></a></p>
<p><a name="heading-4.1.6"></a></p>
<h5 id="416-events"><strong>4.1.6 Events</strong></h5>
<p>Given a handle and an event type, the fpga.register_event() function
returns an object of type event. The event class implements one method,
os_object(), which returns the underlying file descriptor that can be
used to poll for the event:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="kn">import</span> <span class="nn">select</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="n">evt</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">register_event</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">fpga</span><span class="o">.</span><span class="n">EVENT_ERROR</span><span class="p">)</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="n">os_object</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">os_object</span><span class="p">()</span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="n">received_event</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="n">epoll</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">epoll</span><span class="p">()</span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="n">epoll</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">os_object</span><span class="p">,</span> <span class="n">select</span><span class="o">.</span><span class="n">EPOLLIN</span><span class="p">)</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="k">for</span> <span class="n">fileno</span><span class="p">,</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">epoll</span><span class="o">.</span><span class="n">poll</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a>    <span class="k">if</span> <span class="n">fileno</span> <span class="o">==</span> <span class="n">os_object</span><span class="p">:</span>
<a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a>        <span class="n">received_event</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;received: </span><span class="si">{</span><span class="n">received_event</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 75 Python Events</p>
<p><a name="figure-75"></a></p>
<p>In addition to fpga.EVENT_ERROR, fpga.EVENT_INTERRUPT, and
fpga.EVENT_POWER_THERMAL are also supported.</p>
<p><a name="heading-4.1.7"></a></p>
<h5 id="417-errors"><strong>4.1.7 Errors</strong></h5>
<p>Given a token, the fpga.errors() function returns a list of objects of
type error. Each error instance represents a 64-bit mask of error
values. The error bit masks are platform-dependent. Each error instance
has two attributes: name and can_clear and one method: read_value()
which returns the 64-bit error mask.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">fpga</span><span class="o">.</span><span class="n">errors</span><span class="p">(</span><span class="n">tok</span><span class="p">):</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="err">’</span><span class="n">name</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{e.name}</span><span class="s2">&quot;</span><span class="err">’</span><span class="p">)</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="err">’</span><span class="n">can_clear</span><span class="p">:</span> <span class="p">{</span><span class="n">e</span><span class="o">.</span><span class="n">can_clear</span><span class="p">}</span><span class="err">’</span><span class="p">)</span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="err">’</span><span class="n">value</span><span class="p">:</span> <span class="p">{</span><span class="n">e</span><span class="o">.</span><span class="n">read_value</span><span class="p">()}</span><span class="err">’</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 76 Python Get Errors</p>
<p><a name="figure-76"></a></p>
<p><a name="heading-4.1.8"></a></p>
<h5 id="418-sysobject"><strong>4.1.8 SysObject</strong></h5>
<p>The Python API’s SysObject implementation is introduced in 4.1.3 Tokens
and 4.1.4 Handles. When the index operator (__getitem__) or
attribute reference (__getattr__) is used and the referenced string
or attribute name corresponds to a sysfs entry in the sysfs path of
either a token or a handle, then an object of type sysobject is
returned.</p>
<p>The size() method returns the length of the sysfs entry in bytes. Note
that a typical sysfs entry is terminated with a ‘\n’ followed by the
‘\0’ NULL terminator. The bytes() method returns the sysfs entry’s
value as a string.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="n">afu_id</span> <span class="o">=</span> <span class="n">tok</span><span class="p">[</span><span class="s1">&#39;afu_id&#39;</span><span class="p">]</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="k">assert</span> <span class="n">afu_id</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;size: </span><span class="si">{</span><span class="n">afu_id</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="si">}</span><span class="s1"> bytes: </span><span class="si">{</span><span class="n">afu_id</span><span class="o">.</span><span class="n">bytes</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 77 Python sysobject as Bytes</p>
<p><a name="figure-77"></a></p>
<p>The sysobject read64() and write64() methods provide a means to read and
write a sysfs entry’s value as an unsigned 64-bit integer. The sysobject
class itself also implements the __getitem__ and __getattr__
methods so that a sysobject of type FPGA_OBJECT_CONTAINER can retrieve
sysobject instances for child sysfs entries.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="n">errs</span> <span class="o">=</span> <span class="n">tok</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="n">first</span> <span class="o">=</span> <span class="n">errs</span><span class="p">[</span><span class="s1">&#39;first_error&#39;</span><span class="p">]</span>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="k">assert</span> <span class="n">first</span>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;first 0x</span><span class="si">{</span><span class="n">first</span><span class="o">.</span><span class="n">read64</span><span class="p">()</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 78 Python sysobject Container</p>
<p><a name="figure-78"></a></p>
<p><a name = "heading-5.0"></a></p>
<h3 id="50-management-interfaces-opaeadmin"><strong>5.0 Management Interfaces - opae.admin</strong></h3>
<p>While the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> C, C++, and Python APIs focus on presenting the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and all its related functionality to the end user, there is also a need for a maintenance functionality to aid in configuring the platform and performing secure firmware updates for the FPGA device and its components.  opae.admin is a Python framework which provides abstractions for performing these types of maintenance tasks on FPGA devices.  opae.admin provides Python classes which model the FPGA and the sysfs interfaces provided by the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers.</p>
<p><a name="heading-5.1"></a></p>
<h4 id="51-sysfs"><strong>5.1 sysfs</strong></h4>
<p>opae.admin’s sysfs module provides abstractions for interacting with sysfs nodes, which comprise the base entity abstraction of opae.admin.</p>
<p><a name="heading-5.1.1"></a></p>
<h5 id="511-sysfs_node"><strong>5.1.1 sysfs_node</strong></h5>
<p>A sysfs_node is an object that tracks a unique path within a sysfs directory tree.  sysfs_node provides methods for finding and constructing other sysfs_node objects, based on the root path of the parent sysfs_node object.  sysfs_node also provides a mechanism to read and write sysfs file contents.  sysfs_node serves as the base class for many of the sysfs module’s other classes.</p>
<p><a name="heading-5.1.2"></a></p>
<h5 id="512-pci_node"><strong>5.1.2 pci_node</strong></h5>
<p>A pci_node is a sysfs_node that is rooted at /sys/bus/pci/devices.  Each pci_node has a unique PCIe address corresponding to the PCIe device it represents.  Methods for finding the pci_node’s children, for determining the PCIe device tree rooted at the node, for manipulating the node’s PCIe address, for determining the vendor and device ID’s, and for removing, unbinding, and rescanning the device are provided.</p>
<p><a name="heading-5.1.3"></a></p>
<h5 id="513-sysfs_driver"><strong>5.1.3 sysfs_driver</strong></h5>
<p>A sysfs_driver is a sysfs_node that provides a method for unbinding a sysfs_device object.</p>
<p><a name="heading-5.1.4"></a></p>
<h5 id="514-sysfs_device"><strong>5.1.4 sysfs_device</strong></h5>
<p>A sysfs_device is a sysfs_node that is located under /sys/class or /sys/bus.  sysfs_device provides the basis for opae.admin’s FPGA enumeration capability.</p>
<p><a name="heading-5.1.5"></a></p>
<h5 id="515-pcie_device"><strong>5.1.5 pcie_device</strong></h5>
<p>A pcie_device is a sysfs_device that is rooted at /sys/bus/pci/devices.</p>
<p><a name="heading-5.2"></a></p>
<h4 id="52-fpga"><strong>5.2 fpga</strong></h4>
<p>opae.admin’s fpga module provides classes which abstract an FPGA and its components.</p>
<p><a name="heading-5.2.1"></a></p>
<h5 id="521-region"><strong>5.2.1 region</strong></h5>
<p>A region is a sysfs_node that has an associated Linux character device, rooted at /dev.  Methods for opening the region’s character device file and for interacting with the character device via its <abbr title="Input/Output Control, System calls used to manipulate underlying device parameters of special files.">IOCTL</abbr> interface are provided.</p>
<p><a name="heading-5.2.2"></a></p>
<h5 id="522-fme"><strong>5.2.2 fme</strong></h5>
<p>An fme is a region that represents an FPGA device’s <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> component.  An fme provides accessors for the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> interface ID, the various bus paths that may exist under an <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>, and the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> firmware revision information.</p>
<p><a name="heading-5.2.3"></a></p>
<h5 id="523-port"><strong>5.2.3 port</strong></h5>
<p>A port is a region that represents an FPGA device’s Port component.  A port provides an accessor for the Port <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> ID.</p>
<p><a name="heading-5.2.4"></a></p>
<h5 id="524-fpga_base"><strong>5.2.4 fpga_base</strong></h5>
<p>An fpga_base is a sysfs_device that provides accessors for the FPGA device’s <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>, for the FPGA device’s Port, and for the secure update sysfs controls.  fpga_base provides routines for enabling and disabling <abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr> and for performing device <abbr title="Remote System Update, A Remote System Update operation sends an instruction to the Intel FPGA PAC D5005 device that triggers a power cycle of the card only, forcing reconfiguration.">RSU</abbr>.</p>
<p><a name="heading-5.2.5"></a></p>
<h5 id="525-fpga"><strong>5.2.5 fpga</strong></h5>
<p>An fpga (derived from fpga_base) is the basis for representing the FPGA device in opae.admin.  Utilities such as fpgasupdate rely on fpga’s enum classmethod to enumerate all of the FPGA devices in the system.  In order for a device to enumerate via this mechanism, it must be bound to the dfl-pci driver at the time of enumeration.</p>
<p><a name="heading-5.3"></a></p>
<h4 id="53-opaeadmin-utilities"><strong>5.3 opae.admin Utilities</strong></h4>
<p>Several utilities are written on top of opae.admin’s class abstractions.  The following sections highlight some of the most commonly-used utilities.</p>
<p><a name="heading-5.3.1"></a></p>
<h5 id="531-fpgasupdate"><strong>5.3.1 fpgasupdate</strong></h5>
<p>fpgasupdate, or FPGA Secure Update, is used to apply firmware updates to the components of the FPGA.  As the name implies, these updates target a secure FPGA device, one that has the ability to implement a secure root of trust.
The command-line interface to fpgasupdate was designed to be as simple as possible for the end user.  The command simply takes a path to the firmware update file to be applied and the PCIe address of the targeted FPGA device.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="c1"># fpgasupdate update-file.bin 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 79 fpgasupdate Interface</p>
<p><a name="figure-79"></a></p>
<p>fpgasupdate can apply a variety of firmware image updates.
| Image| Description|
| -----| -----|
|Programmable Region Image| .gbs or Green BitStream|
|SR Root Key Hash|  Static Region RKH|
|<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Root Key Hash|  Programmable Region RKH|
|FPGA Firmware Image|   Static Region Device Firmware|
|<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Authentication Certificate| Programmable Region Auth Cert|
|<abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> Firmware Image|    Board Management Controller Firmware|
|SR Thermal Image|  Static Region Thermal Sensor Thresholds|
|<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Thermal Image|  Programmable Region Thermal Sensor Thresholds|
|CSK Cancelation|   Code Signing Key Cancelation Request|
|SDM Image| Secure Device Manager Firmware|</p>
<p align = "center">Table 10 fpgasupdate Image Types</p>
<p><a name="table-10"></a></p>
<p><a name="heading-5.3.2"></a></p>
<h5 id="532-pci_device"><strong>5.3.2 pci_device</strong></h5>
<p>pci_device is a utility that provides a convenient interface to some of the Linux Kernel’s standard PCIe device capabilities.</p>
<p><a name="heading-5.3.2.1"></a></p>
<h6 id="5321-pci_device-aer-subcommand"><strong>5.3.2.1 pci_device aer subcommand</strong></h6>
<p>The aer dump subcommand displays the Correctable, Fatal, and NonFatal device errors.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="c1"># pci_device 0000:b2:00.0 aer dump</span>
</code></pre></div>
<p align = "center">Figure 80 pci_device aer dump</p>
<p><a name="figure-80"></a></p>
<p>The aer mask subcommand displays, masks, or unmasks errors using the syntax of the setpci command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="c1"># pci_device 0000:b2:00.0 aer mask show</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>0x00010000<span class="w"> </span>0x000031c1
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="c1"># pci_device 0000:b2:00.0 aer mask all</span>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="c1"># pci_device 0000:b2:00.0 aer mask off</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="c1"># pci_device 0000:b2:00.0 aer mask 0x01010101 0x10101010</span>
</code></pre></div>
<p align = "center">Figure 81 pci_device aer mask</p>
<p><a name="figure-81"></a></p>
<p>The aer clear subcommand clears the current errors.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="c1"># pci_device 0000:b2:00.0 aer clear</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>aer<span class="w"> </span>clear<span class="w"> </span>errors:<span class="w"> </span><span class="m">00000000</span>
</code></pre></div>
<p align = "center">Figure 82 pci_device aer clear</p>
<p><a name="figure-82"></a></p>
<p><a name="heading-5.3.2.2"></a></p>
<h6 id="5322-pci_device-unbind-subcommand"><strong>5.3.2.2 pci_device unbind subcommand</strong></h6>
<p>The unbind subcommand unbinds the target device from the currently-bound device driver.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="c1"># pci_device 0000:b2:00.0 unbind</span>
</code></pre></div>
<p align = "center">Figure 83 pci_device unbind</p>
<p><a name="figure-83"></a></p>
<p>In order to re-bind the device to a driver, eg dfl-pci, use the following commands:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="c1"># cd /sys/bus/pci/drivers/dfl-pci</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="c1"># echo 0000:b2:00.0 &gt; bind</span>
</code></pre></div>
<p align = "center">Figure 84 Re-binding a Driver</p>
<p><a name="figure-84"></a></p>
<p><a name="heading-5.3.2.3"></a></p>
<h6 id="5323-pci_device-rescan-subcommand"><strong>5.3.2.3 pci_device rescan subcommand</strong></h6>
<p>The rescan subcommand triggers a PCIe bus rescan of all PCIe devices.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="c1"># pci_device 0000:b2:00.0 rescan</span>
</code></pre></div>
<p align = "center">Figure 85 pci_device rescan</p>
<p><a name="figure-85"></a></p>
<p><a name="heading-5.3.2.4"></a></p>
<h6 id="5324-pci_device-remove-subcommand"><strong>5.3.2.4 pci_device remove subcommand</strong></h6>
<p>The remove subcommand removes the target device from Linux kernel management.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="c1"># pci_device 0000:b2:00.0 remove</span>
</code></pre></div>
<p align = "center">Figure 86 pci_device remove</p>
<p><a name="figure-86"></a></p>
<p>Note: a reboot may be required in order to re-establish the Linux kernel management for the device.</p>
<p><a name="heading-5.3.2.5"></a></p>
<h6 id="5325-pci_device-topology-subcommand"><strong>5.3.2.5 pci_device topology subcommand</strong></h6>
<p>The topology subcommand shows a tab-delimited depiction of the target device as it exists in the PCIe device tree in the Linux kernel.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="c1"># pci_device 0000:b2:00.0 topology</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3a:00.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x2030<span class="o">)]</span><span class="w"> </span><span class="o">(</span>pcieport<span class="o">)</span>
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="w">    </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3b:00.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x10b5,<span class="w"> </span>0x8747<span class="o">)]</span><span class="w"> </span><span class="o">(</span>pcieport<span class="o">)</span>
<a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="w">        </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3c:09.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x10b5,<span class="w"> </span>0x8747<span class="o">)]</span><span class="w"> </span><span class="o">(</span>pcieport<span class="o">)</span>
<a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="w">            </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:b2:00.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x0b30<span class="o">)]</span><span class="w"> </span><span class="o">(</span>dfl-pci<span class="o">)</span>
<a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w">        </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3c:11.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x10b5,<span class="w"> </span>0x8747<span class="o">)]</span><span class="w"> </span><span class="o">(</span>pcieport<span class="o">)</span>
<a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="w">            </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:43:00.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x0b32<span class="o">)]</span><span class="w"> </span><span class="o">(</span>no<span class="w"> </span>driver<span class="o">)</span>
<a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="w">        </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3c:08.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x10b5,<span class="w"> </span>0x8747<span class="o">)]</span><span class="w"> </span><span class="o">(</span>pcieport<span class="o">)</span>
<a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="w">            </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3d:00.1<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x0d58<span class="o">)]</span><span class="w"> </span><span class="o">(</span>i40e<span class="o">)</span>
<a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="w">            </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3d:00.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x0d58<span class="o">)]</span><span class="w"> </span><span class="o">(</span>i40e<span class="o">)</span>
<a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="w">        </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3c:10.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x10b5,<span class="w"> </span>0x8747<span class="o">)]</span><span class="w"> </span><span class="o">(</span>pcieport<span class="o">)</span>
<a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a><span class="w">            </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:41:00.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x0d58<span class="o">)]</span><span class="w"> </span><span class="o">(</span>i40e<span class="o">)</span>
<a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a><span class="w">            </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:41:00.1<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x0d58<span class="o">)]</span><span class="w"> </span><span class="o">(</span>i40e<span class="o">)</span>
</code></pre></div>
<p align = "center">Figure 87 pci_device topology</p>
<p><a name="figure-87"></a></p>
<p>The green output indicates the target device.  The other endpoint devices are shown in blue.</p>
<p><a name="heading-5.3.2.6"></a></p>
<h6 id="5326-pci_device-vf-subcommand"><strong>5.3.2.6 pci_device vf subcommand</strong></h6>
<p>The vf subcommand allows setting the value of the sriov_numvfs sysfs node of the target device.  This is useful in scenarios where device functionality is presented in the form of one or more PCIe Virtual Functions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="c1"># pci_device 0000:b2:00.0 vf 3</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="c1"># pci_device 0000:b2:00.0 vf 0</span>
</code></pre></div>
<p align = "center">Figure 88 pci_device vf</p>
<p><a name="figure-88"></a></p>
<p><a name="heading-5.3.3"></a></p>
<h5 id="533-rsu"><strong>5.3.3 rsu</strong></h5>
<p>rsu is a utility that performs Remote System Update.  rsu is used subsequent to programming a firmware update or other supported file type with fpgasupdate, in order to reset the targeted FPGA entity so that a newly-loaded firmware image becomes active.</p>
<p><a name="heading-5.3.3.1"></a></p>
<h6 id="5331-rsu-bmc-subcommand"><strong>5.3.3.1 rsu bmc subcommand</strong></h6>
<p>The bmc subcommand causes a Board Management Controller reset.  This command is used to apply a previous fpgasupdate of a <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> firmware image.  The --page argument selects the desired boot image.  Valid values for --page are ‘user’ and ‘factory’.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="c1"># rsu bmc --page user 0000:b2:00.0</span>
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="c1"># rsu bmc --page factory 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 89 rsu bmc</p>
<p><a name="figure-89"></a></p>
<p><a name="heading-5.3.3.2"></a></p>
<h6 id="5332-rsu-retimer-subcommand"><strong>5.3.3.2 rsu retimer subcommand</strong></h6>
<p>The retimer subcommand causes a Parkvale reset (specific to Vista Creek).  This command is used to apply a previous fpgasupdate of a <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> firmware image (the Parkvale firmware is contained within the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> firmware image).  The retimer subcommand causes only the Parkvale to reset.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="c1"># rsu retimer 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 90 rsu retimer</p>
<p><a name="figure-90"></a></p>
<p><a name="heading-5.3.3.3"></a></p>
<h6 id="5333-rsu-fpga-subcommand"><strong>5.3.3.3 rsu fpga subcommand</strong></h6>
<p>The fpga subcommand causes a reconfiguration of the FPGA Static Region.  This command is used to apply a previous fpgasupdate of the Static Region image.  The --page argument selects the desired boot image.  Valid values for --page are ‘user1’, ‘user2’, and ‘factory’.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="c1"># rsu fpga --page user1 0000:b2:00.0</span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="c1"># rsu fpga --page user2 0000:b2:00.0</span>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="c1"># rsu fpga --page factory 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 91 rsu fpga</p>
<p><a name="figure-91"></a></p>
<p><a name="heading-5.3.3.4"></a></p>
<h6 id="5334-rsu-sdm-subcommand"><strong>5.3.3.4 rsu sdm subcommand</strong></h6>
<p>The sdm subcommand causes a reset of the Secure Device Manager.  This command is used to apply a previous fpgasupdate of the SDM image.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="c1"># rsu sdm 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 92 rsu sdm</p>
<p><a name="figure-92"></a></p>
<p><a name="heading-5.3.3.5"></a></p>
<h6 id="5335-rsu-fpgadefault-subcommand"><strong>5.3.3.5 rsu fpgadefault subcommand</strong></h6>
<p>The fpgadefault subcommand can be used to display the default FPGA boot sequence; and it can be used to select the image to boot on the next reset of the FPGA.
When given without additional parameters, the fpgadefault subcommand displays the default FPGA boot sequence:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="c1"># rsu fpgadefault 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 93 rsu Displaying FPGA Boot Sequence</p>
<p><a name="figure-93"></a></p>
<p>The parameters to the fpgadefault subcommand are --page and --fallback.  The --page parameter accepts ‘user1’, ‘user2’, or ‘factory’, specifying the desired page to boot the FPGA from on the next reset.  Note that this subcommand does not actually cause the reset to occur.  Please refer to rsu fpga subcommand for an example of resetting the FPGA using the rsu command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="c1"># rsu fpgadefault --page user1 0000:b2:00.0</span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="c1"># rsu fpgadefault --page user2 0000:b2:00.0</span>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="c1"># rsu fpgadefault --page factory 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 94 rsu Select FPGA Boot Image</p>
<p><a name="figure-94"></a></p>
<p>The --fallback parameter accepts a comma-separated list of the keywords ‘user1’, ‘user2’, and ‘factory’.  These keywords, in conjunction with the --page value are used to determine a fallback boot sequence for the FPGA.
The fallback boot sequence is used to determine which FPGA image to load in the case of a boot failure.  For example, given the following command, the FPGA would attempt to boot in the order ‘factory’, ‘user1’, ‘user2’.  That is to say, if the ‘factory’ image failed to boot, then the ‘user1’ image would be tried.  Failing to boot ‘user1’, the ‘user2’ image would be tried.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="c1"># rsu fpgadefault --page factory --fallback user1,user2 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 95 rsu Select FPGA Boot Image and Fallback</p>
<p><a name="figure-95"></a></p>
<p><a name="heading-6.0"></a></p>
<h3 id="60-sample-applications"><strong>6.0 Sample Applications</strong></h3>
<p><a name="heading-6.1"></a></p>
<h4 id="61-afu-test-framework"><strong>6.1 afu-test Framework</strong></h4>
<p>afu-test refers to a test-writing framework that exists as a set of C++
classes written on top of the OPAE C++ bindings. The first class,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/afu-test/afu_test.h#L151-L341">afu</a>,
serves as the base class for the test application abstraction. Class
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/afu-test/afu_test.h#L151-L341">afu</a>
provides integration with <a href="https://github.com/CLIUtils/CLI11">CLI11</a>, a
C++ ’11 command-line parsing framework, and with
<a href="https://github.com/gabime/spdlog">spdlog</a>, a C++ logging library. The
second class,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/afu-test/afu_test.h#L113-L132">command</a>
represents a unique test sequence that is called by the afu object.
Instances of the
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/afu-test/afu_test.h#L113-L132">command</a>
class implement the test-specific workload.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">afu</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="n">afu</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">afu_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span>
<a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">log_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">open_handle</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">afu_id</span><span class="p">);</span>
<a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[]);</span>
<a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">CLI</span><span class="o">::</span><span class="n">App</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="n">command</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">test</span><span class="p">);</span>
<a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a><span class="n">CLI</span><span class="o">::</span><span class="n">App</span><span class="w"> </span><span class="o">*</span><span class="n">register_command</span><span class="p">();</span>
<a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a><span class="p">};</span>
</code></pre></div>
<p align = "center">Figure 96 C++ class afu</p>
<p><a name="figure-96"></a></p>
<p>The afu class constructor initializes the CLI11 command parser with some
general, application-wide parameters.</p>
<table>
<thead>
<tr>
<th>Subcommand</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-g,--guid</td>
<td>Accelerator <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> ID.</td>
</tr>
<tr>
<td>-p,--pci-address</td>
<td>Address of the accelerator device.</td>
</tr>
<tr>
<td>-l,--log-level</td>
<td>Requested spdlog output level.</td>
</tr>
<tr>
<td>-s,--shared</td>
<td>Open the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in shared mode?</td>
</tr>
<tr>
<td>-t,--timeout</td>
<td>Application timeout in milliseconds.</td>
</tr>
</tbody>
</table>
<p align = "center">Figure 97 class afu Application Parameters</p>
<p><a name="figure-97"></a></p>
<p>The register_command() member function adds a test
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/afu-test/afu_test.h#L113-L132">command</a>
instance to the afu object. Each test command that an afu object is
capable of executing is registered during the test’s startup code. For
instance, here is the
<a href="https://github.com/OFS/opae-sdk/blob/master/samples/hssi/hssi.cpp#L51-L54">hssi</a>
application’s use of register_command():</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="n">hssi_afu</span><span class="w"> </span><span class="n">app</span><span class="p">;</span>
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="p">{</span>
<a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="n">app</span><span class="p">.</span><span class="n">register_command</span><span class="o">&lt;</span><span class="n">hssi_10g_cmd</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="n">app</span><span class="p">.</span><span class="n">register_command</span><span class="o">&lt;</span><span class="n">hssi_100g_cmd</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="n">app</span><span class="p">.</span><span class="n">register_command</span><span class="o">&lt;</span><span class="n">hssi_pkt_filt_10g_cmd</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="n">app</span><span class="p">.</span><span class="n">register_command</span><span class="o">&lt;</span><span class="n">hssi_pkt_filt_100g_cmd</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="err">…</span>
<a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a><span class="n">app</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a><span class="p">}</span>
</code></pre></div>
<p align = "center">Figure 98 hssi's app.register_command()</p>
<p><a name="figure-98"></a></p>
<p>Next, the afu instance’s main() member function is called. main()
initializes the spdlog instance, searches its database of registered
commands to find the command matching the test requested from the
command prompt, uses the open_handle() member function to enumerate for
the requested <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> ID, and calls its run() member function, passing the
CLI::App and the test command variables. The run() member function
initializes a test timeout mechanism, then calls the command parameter’s
run() to invoke the test-specific logic.</p>
<p>With all the boiler-plate of application startup, configuration, and
running handled by the afu class, the test-specific
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/afu-test/afu_test.h#L113-L132">command</a>
class is left to implement only a minimum number of member functions:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">command</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">description</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">afu</span><span class="w"> </span><span class="o">*</span><span class="n">afu</span><span class="p">,</span><span class="w"> </span><span class="n">CLI</span><span class="o">::</span><span class="n">App</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">add_options</span><span class="p">(</span><span class="n">CLI</span><span class="o">::</span><span class="n">App</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">afu_id</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="p">};</span>
</code></pre></div>
<p align = "center">Figure 99 class command</p>
<p><a name="figure-99"></a></p>
<p>The name() member function gives the unique command name. Some examples
of names from the hssi app are hssi_10g, hssi_100g, pkt_filt_10g,
and pkt_filt_100g. The description() member function gives a brief
description that is included in the command-specific help output.
add_options() adds command-specific command-line options. afu_id()
gives the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> ID for the command, in string form. Finally, run()
implements the command-specific test functionality.</p>
<p><a name="heading-6.2"></a></p>
<h4 id="62-afu-test-based-samples"><strong>6.2 afu-test Based Samples</strong></h4>
<p><a name="heading-6.2.1"></a></p>
<h5 id="621-dummy_afu"><strong>6.2.1 dummy_afu</strong></h5>
<p>The dummy_afu application is a afu-test based application that
implements three commands: mmio, ddr, and lpbk.</p>
<table>
<thead>
<tr>
<th>Target</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td># dummy_afu <a href="https://github.com/OFS/opae-sdk/blob/master/samples/dummy_afu/mmio.h#L131-L152">mmio</a></td>
<td>Targets special scratchpad area implemented by the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</td>
</tr>
<tr>
<td># dummy_afu <a href="https://github.com/OFS/opae-sdk/blob/master/samples/dummy_afu/ddr.h#L60-L103">ddr</a></td>
<td>Execute dummy_afu-specific DDR test.</td>
</tr>
<tr>
<td># dummy_afu <a href="https://github.com/OFS/opae-sdk/blob/master/samples/dummy_afu/lpbk.h#L50-L65">lpbk</a></td>
<td>Execute a simple loopback test.</td>
</tr>
</tbody>
</table>
<p><a name="heading-6.2.2"></a></p>
<h5 id="622-host_exerciser"><strong>6.2.2 host_exerciser</strong></h5>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/doc/src/fpga_tools/host_exerciser/host_exerciser.md">host_exerciser</a>
markdown document.</p>
<p><a name="heading-6.2.3"></a></p>
<h5 id="623-hssi"><strong>6.2.3 hssi</strong></h5>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/doc/src/fpga_tools/hssi/hssi.md">hssi</a>
markdown document.</p>
<p><a name="heading-7.0"></a></p>
<h3 id="70-other-utilities"><strong>7.0 Other Utilities</strong></h3>
<p><a name="heading-7.1"></a></p>
<h4 id="71-opaeio"><strong>7.1 opae.io</strong></h4>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/doc/src/fpga_tools/opae.io/opae.io.md">opae.io</a>
markdown document.</p>
<p><a name="heading-7.2"></a></p>
<h4 id="72-bitstreaminfo"><strong>7.2 bitstreaminfo</strong></h4>
<p>The bitstreaminfo command prints diagnostic information about firmware
image files that have been passed through the PACSign utility. PACSign
prepends secure block 0 and secure block 1 data headers to the images
that it processes. These headers contain signature hashes and other
metadata that are consumed by the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> firmware during a secure update.</p>
<p>To run bitstreaminfo, pass the path to the desired firmware image file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="c1"># bitstreaminfo my_file.bin </span>
</code></pre></div>
<p align = "center">Figure 100 Running bitstreaminfo</p>
<p><a name="figure-100"></a></p>
<p><a name="heading-7.3"></a></p>
<h4 id="73-fpgareg"><strong>7.3 fpgareg</strong></h4>
<p>The fpgareg command prints the register spaces for the following fpga
device components:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td># fpgareg 0000:b1:00.0 pcie</td>
<td>Walks and prints the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> for the device.</td>
</tr>
<tr>
<td># fpgareg 0000:b1:00.0 bmc</td>
<td>Prints the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> registers for the device.</td>
</tr>
<tr>
<td># fpgareg 0000:b1:00.0 hssi</td>
<td>Prints the HSSI registers for the device.</td>
</tr>
<tr>
<td># fpgareg 0000:b1:00.0 acc</td>
<td>Prints the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> register spaces.</td>
</tr>
</tbody>
</table>
<p align = "center">Figure 101 fpgareg Commands</p>
<p><a name="figure-101"></a></p>
<p>Note that fpgareg is only available as of Arrow Creek ADP and forward.
It will not work with prior platforms, eg N3000.</p>
<p><a name="heading-7.4"></a></p>
<h4 id="74-opaevfio"><strong>7.4 opaevfio</strong></h4>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/doc/src/fpga_tools/opaevfio/opaevfio.md">opaevfio</a>
markdown document.</p>
<p><a name="heading-8.0"></a></p>
<h3 id="80-building-opae"><strong>8.0 Building OPAE</strong></h3>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> uses the cmake build and configuration system, version &gt;=
3.10. The basic steps required to build the SDK from source are:</p>
<p>Install prerequisite packages.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>&lt;https://github.com/OFS/opae-sdk.git&gt;
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>opae-sdk
<a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a>$<span class="w"> </span>mkdir<span class="w"> </span>build
<a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
<a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a>$<span class="w"> </span>cmake<span class="w"> </span>..<span class="w"> </span>&lt;cmake<span class="w"> </span>options&gt;
<a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a>$<span class="w"> </span>make
</code></pre></div>
<p><a name="heading-8.1"></a></p>
<h4 id="81-installing-prerequisite-packages"><strong>8.1 Installing Prerequisite Packages</strong></h4>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> is intended to build and run on modern Linux distributions.
The SDK contains a set of system configuration scripts to aid the system
configuration process.</p>
<table>
<thead>
<tr>
<th>Script</th>
<th>Target Operating System</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/OFS/opae-sdk/blob/master/setup/centos.sh">centos.sh</a></td>
<td>CentOS 8.x</td>
</tr>
<tr>
<td><a href="https://github.com/OFS/opae-sdk/blob/master/setup/fedora.sh">fedora.sh</a></td>
<td>Fedora 33/34</td>
</tr>
<tr>
<td><a href="https://github.com/OFS/opae-sdk/blob/master/setup/ubuntu.sh">ubuntu.sh</a></td>
<td>Ubuntu 20.04 LTS</td>
</tr>
</tbody>
</table>
<p align = "center">Table 11 System Configuration Scripts</p>
<p><a name="table-11"></a></p>
<p><a name="heading-8.2"></a></p>
<h4 id="82-cloning-the-sdk-repository"><strong>8.2 Cloning the SDK repository</strong></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/OFS/opae-sdk.git
</code></pre></div>
<p><a name="heading-8.3"></a></p>
<h5 id="83-cmake-options"><strong>8.3 CMake Options</strong></h5>
<table>
<thead>
<tr class="header">
<th>Option</th>
<th>Description</th>
<th>Values</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-DCMAKE_BUILD_TYPE</td>
<td>Configure debugging info</td>
<td><p>Debug</p>
<p>Release</p>
<p>Coverage</p>
<p>RelWithDebInfo</p></td>
<td>RelWithDebInfo</td>
</tr>
<tr class="even">
<td>-DCMAKE_INSTALL_PREFIX</td>
<td>Root install path</td>
<td><varies></td>
<td>/usr/local</td>
</tr>
<tr class="odd">
<td>-DOPAE_BUILD_SPHINX_DOC</td>
<td>Enable/Disable docs</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="even">
<td>-DOPAE_BUILD_TESTS</td>
<td>Enable/Disable unit tests</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="odd">
<td>-DOPAE_ENABLE_MOCK</td>
<td>Enable/Disable mock driver for unit tests</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="even">
<td>-DOPAE_INSTALL_RPATH</td>
<td>Enable/Disable rpath for install</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="odd">
<td>-DOPAE_VERSION_LOCAL</td>
<td>Local version string</td>
<td><varies></td>
<td><none></td>
</tr>
<tr class="even">
<td>-DOPAE_PRESERVE_REPOS</td>
<td>Preserve local changes to external repos?</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="odd">
<td>-D OPAE_BUILD_LIBOPAE_CXX</td>
<td>Enable C++ bindings</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="even">
<td>-DOPAE_WITH_PYBIND11</td>
<td>Enable pybind11</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="odd">
<td>-D OPAE_BUILD_PYTHON_DIST</td>
<td>Enable Python bindings</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="even">
<td>-DOPAE_BUILD_LIBOPAEVFIO</td>
<td>Build libopaevfio.so</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="odd">
<td>-D OPAE_BUILD_PLUGIN_VFIO</td>
<td>Build libopae-v.so</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="even">
<td>-DOPAE_BUILD_LIBOPAEUIO</td>
<td>Build libopaeuio.so</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="odd">
<td>-DOPAE_BUILD_LIBOFS</td>
<td>Build OFS Copy Engine</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="even">
<td>-DOPAE_BUILD_SAMPLES</td>
<td>Build Samples</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="odd">
<td>-DOPAE_BUILD_LEGACY</td>
<td>Build legacy repo</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="even">
<td>-DOPAE_LEGACY_TAG</td>
<td>Specify legacy build tag</td>
<td><varies></td>
<td>master</td>
</tr>
<tr class="odd">
<td>-DOPAE_WITH_CLI11</td>
<td>Enable apps which use CLI11</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="even">
<td>-DOPAE_WITH_SPDLOG</td>
<td>Enable apps which use spdlog</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="odd">
<td>-DOPAE_WITH_LIBEDIT</td>
<td>Enable apps which use libedit</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="even">
<td>-DOPAE_WITH_HWLOC</td>
<td>Enable apps which use hwloc</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="odd">
<td>-DOPAE_WITH_TBB</td>
<td>Enable apps which use Thread Building Blocks</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="even">
<td>-DOPAE_MINIMAL_BUILD</td>
<td>Enable/Disable minimal build. When set to ON, disable CLI11, spdlog, libedit, hwloc, tbb</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
</tbody>
</table>

<p align = "center">Table 12 CMake Options</p>
<p><a name="table-12"></a></p>
<p><a name="heading-8.4"></a></p>
<h4 id="84-building-opae-for-debug"><strong>8.4 Building OPAE for Debug</strong></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>$<span class="w"> </span>cmake<span class="w"> </span>..<span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Debug
</code></pre></div>
<p><a name="heading-8.5"></a></p>
<h4 id="85-creating-rpms"><strong>8.5 Creating RPMs</strong></h4>
<p>To ease the RPM creation process, the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> provides a simple RPM
creation script. The parameters to the RPM create script are fedora or
rhel, depending on which distribution is targeted. For rhel, the build
flag -DOPAE_MINIMAL_BUILD is set to ON, omitting the binaries which
have dependencies on external components that RHEL does not include in
its base repositories.</p>
<p>In order to create RPMs for Fedora, run the create script on a system
loaded with all the Fedora build prerequisites. If prerequisites are
missing, the create script will complain until they are resolved.</p>
<p>In order to create RPMs for RHEL, run the create script on a system
loaded with all the RHEL build prerequisites. If prerequisites are
missing, the create script will complain until they are resolved.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>opae-sdk
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a>$<span class="w"> </span>./packaging/opae/rpm/create<span class="w"> </span>fedora
<a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a>-OR-
<a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a>$<span class="w"> </span>./packaging/opae/rpm/create<span class="w"> </span>rhel
</code></pre></div>
<p align = "center"> Figure 102 RPM Creation</p>
<p><a name="figure-102"></a></p>
<p>After running the create script, the RPM files will be located in the
packaging/opae/rpm directory.</p>
<p><a name="heading-8.5.1"></a></p>
<h5 id="851-updating-the-rpm-version-information"><strong>8.5.1 Updating the RPM Version Information</strong></h5>
<p>The RPMs will be versioned according to the information found in the
file
<a href="https://github.com/OFS/opae-sdk/blob/master/packaging/opae/version#L27-L28">packaging/opae/version</a>.
Edit this file to update the version information, then re-run the create
script to create the RPMs.</p>
<p><a name = "heading-9.0"></a></p>
<h3 id="90-debugging-opae"><strong>9.0 Debugging OPAE</strong></h3>
<p><a name="heading-9.1"></a></p>
<h4 id="91-enabling-debug-logging"><strong>9.1  Enabling Debug Logging</strong></h4>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> has a built-in debug logging facility.  To enable it, set the cmake flag <code>-DCMAKE_BUILD_TYPE=Debug</code> and then use the following environment variables:
| Variable| Description|
| ----- | ----- |
|LIBOPAE_LOG=1| Enable debug logging output.  When not set, only critical error messages are displayed.|
|LIBOPAE_LOGFILE=file.log|  Capture debug log output to file.log.  When not set, the logging appears on stdout and stderr.  The file must appear in a relative path or it can be rooted at /tmp.|</p>
<p align = "center"> Table 13 Logging Environment Variables</p>
<p><a name="table-13"></a></p>
<p><a name="heading-9.2"></a></p>
<h4 id="92-gdb"><strong>9.2 GDB</strong></h4>
<p>To enable gdb-based debugging, the cmake configuration step must specify a value for -DCMAKE_BUILD_TYPE of either Debug or RelWithDebInfo so that debug symbols are included in the output binaries.
The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> makes use of dynamically-loaded library modules.  When debugging with gdb, the best practice is to remove all <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> libraries from the system installation paths to ensure that library modules are only loaded from the local build tree:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>opae-sdk/build
<a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a>$<span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$PWD</span>/lib<span class="w"> </span>gdb<span class="w"> </span>--args<span class="w"> </span>&lt;some_opae_executable&gt;<span class="w"> </span>&lt;args&gt;
</code></pre></div>
<p align = "center">Figure 103 Debugging with GDB</p>
<p><a name="figure-103"></a></p>
<p><a name = "heading-10.0"></a></p>
<h3 id="100-adding-new-device-support"><strong>10.0 Adding New Device Support</strong></h3>
<p>As of OPAE 2.2.0 the SDK has transitioned to a single configuration file model.  The libraries, plugins, and applications obtain their runtime configuration during startup by examining a single JSON configuration file.  In doing so, the original configuration file formats for libopae-c and fpgad have been deprecated in favor of the respective sections in the new configuration file. </p>
<h4 id="101-configuration-file-search-order"><strong>10.1 Configuration File Search Order</strong></h4>
<p>By default the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> will install its configuration file to /etc/opae/opae.cfg. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">opae</span><span class="o">/</span><span class="n">opae</span><span class="p">.</span><span class="n">cfg</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 104 Default Configuration File</p>
<p><a name="figure-104"></a></p>
<p>The SDK searches for the configuration file during startup by employing the following search algorithm: </p>
<p>First, the environment variable LIBOPAE_CFGFILE is examined.  If it is set to a path that represents a valid path to a configuration file, then that configuration file path is used, and the search is complete. </p>
<p>Next, the HOME environment variable is examined.  If its value is valid, then it is prepended to the following set of relative paths.  If HOME is not set, then the search continues with the value of the current user’s home path as determined by getpwuid().  The home path, if any, determined by getpwuid() is prepended to the following set of relative paths.  Searching completes successfully if any of these home-relative search paths is valid. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="o">/</span><span class="p">.</span><span class="n">local</span><span class="o">/</span><span class="n">opae</span><span class="p">.</span><span class="n">cfg</span><span class="w"> </span>
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a>
<a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="o">/</span><span class="p">.</span><span class="n">local</span><span class="o">/</span><span class="n">opae</span><span class="o">/</span><span class="n">opae</span><span class="p">.</span><span class="n">cfg</span><span class="w"> </span>
<a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a>
<a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="o">/</span><span class="p">.</span><span class="n">config</span><span class="o">/</span><span class="n">opae</span><span class="o">/</span><span class="n">opae</span><span class="p">.</span><span class="n">cfg</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 105 HOME Relative Search Paths</p>
<p><a name="figure-105"></a></p>
<p>Finally, the configuration file search continues with the following system-wide paths.  If any of these paths is found to contain a configuration file, then searching completes successfully. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">opae</span><span class="o">/</span><span class="n">opae</span><span class="p">.</span><span class="n">cfg</span><span class="w"> </span>
<a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a>
<a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">opae</span><span class="o">/</span><span class="n">opae</span><span class="p">.</span><span class="n">cfg</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 106 System Search Paths</p>
<p><a name="figure-106"></a></p>
<p>If the search exhausts all of the possible configuration file locations without finding a configuration file, then an internal default configuration is used.  This internal default configuration matches that of the opae.cfg file shipped with the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr>. </p>
<h4 id="102-configuration-file-format"><strong>10.2 Configuration File Format </strong></h4>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> configuration file is stored in JSON formatted text.  The file has two main sections: “configs” and “configurations”.  The “configs” section is an array of strings.  Each value in the “configs” array is a key into the data stored in the “configurations” section.  If a key is present in “configs”, then that key is searched for and processed in “configurations”.  If the key is not found in “configs”, then that section of “configurations” will not be processed, irrespective of whether it exists in “configurations”. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a>
<a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a>
<a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a>
<a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a><span class="w">      </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-108-8" name="__codelineno-108-8" href="#__codelineno-108-8"></a>
<a id="__codelineno-108-9" name="__codelineno-108-9" href="#__codelineno-108-9"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-108-10" name="__codelineno-108-10" href="#__codelineno-108-10"></a>
<a id="__codelineno-108-11" name="__codelineno-108-11" href="#__codelineno-108-11"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-108-12" name="__codelineno-108-12" href="#__codelineno-108-12"></a>
<a id="__codelineno-108-13" name="__codelineno-108-13" href="#__codelineno-108-13"></a><span class="w">  </span><span class="err">“</span><span class="n">configs</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-108-14" name="__codelineno-108-14" href="#__codelineno-108-14"></a>
<a id="__codelineno-108-15" name="__codelineno-108-15" href="#__codelineno-108-15"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="w"> </span>
<a id="__codelineno-108-16" name="__codelineno-108-16" href="#__codelineno-108-16"></a>
<a id="__codelineno-108-17" name="__codelineno-108-17" href="#__codelineno-108-17"></a><span class="w">  </span><span class="p">]</span><span class="w"> </span>
<a id="__codelineno-108-18" name="__codelineno-108-18" href="#__codelineno-108-18"></a>
<a id="__codelineno-108-19" name="__codelineno-108-19" href="#__codelineno-108-19"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 107 Keyed Configurations</p>
<p><a name="figure-107"></a></p>
<p>Each keyed section in “configurations” has four top-level entries: “enabled”, “platform”, “devices”, “opae”. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a>
<a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a>
<a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a>
<a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="w">      </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a>
<a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a><span class="w">      </span><span class="err">“</span><span class="n">platform</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">Intel</span><span class="w"> </span><span class="n">Acceleration</span><span class="w"> </span><span class="n">Development</span><span class="w"> </span><span class="n">Platform</span><span class="w"> </span><span class="n">C6100</span><span class="err">”</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-109-10" name="__codelineno-109-10" href="#__codelineno-109-10"></a>
<a id="__codelineno-109-11" name="__codelineno-109-11" href="#__codelineno-109-11"></a><span class="w">      </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-109-12" name="__codelineno-109-12" href="#__codelineno-109-12"></a>
<a id="__codelineno-109-13" name="__codelineno-109-13" href="#__codelineno-109-13"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="err">“</span><span class="n">name</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="err">“</span><span class="n">id</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-109-14" name="__codelineno-109-14" href="#__codelineno-109-14"></a>
<a id="__codelineno-109-15" name="__codelineno-109-15" href="#__codelineno-109-15"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="err">“</span><span class="n">name</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_vf</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="err">“</span><span class="n">id</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-109-16" name="__codelineno-109-16" href="#__codelineno-109-16"></a>
<a id="__codelineno-109-17" name="__codelineno-109-17" href="#__codelineno-109-17"></a><span class="w">      </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-109-18" name="__codelineno-109-18" href="#__codelineno-109-18"></a>
<a id="__codelineno-109-19" name="__codelineno-109-19" href="#__codelineno-109-19"></a><span class="w">      </span><span class="err">“</span><span class="n">opae</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-109-20" name="__codelineno-109-20" href="#__codelineno-109-20"></a>
<a id="__codelineno-109-21" name="__codelineno-109-21" href="#__codelineno-109-21"></a><span class="w">        </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-109-22" name="__codelineno-109-22" href="#__codelineno-109-22"></a>
<a id="__codelineno-109-23" name="__codelineno-109-23" href="#__codelineno-109-23"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-109-24" name="__codelineno-109-24" href="#__codelineno-109-24"></a>
<a id="__codelineno-109-25" name="__codelineno-109-25" href="#__codelineno-109-25"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-109-26" name="__codelineno-109-26" href="#__codelineno-109-26"></a>
<a id="__codelineno-109-27" name="__codelineno-109-27" href="#__codelineno-109-27"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-109-28" name="__codelineno-109-28" href="#__codelineno-109-28"></a>
<a id="__codelineno-109-29" name="__codelineno-109-29" href="#__codelineno-109-29"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 108 Configurations Format</p>
<p><a name="figure-108"></a></p>
<p>The “enabled” key holds a Boolean value.  If the value is false or if the “enabled” key is omitted, then that configuration is skipped when parsing the file.  The “platform” key holds a string that identifies the current configuration item as a product family.  The “devices” key contains the device descriptions. </p>
<p>“devices” is an array of objects that contain a “name” and an “id” key.  The “name” is a shorthand descriptor for a device PF or VF.  The value of “name” appears elsewhere in the current “configurations” section in order to uniquely identify the device.  “id” is an array of four strings, corresponding to the PCIe Vendor ID, Device ID, Subsystem Vendor ID, and Subsystem Device ID of the device.  The entries corresponding to Vendor ID and Device ID must contain valid 16-bit hex integers.  The entries corresponding to Subsystem Vendor ID and Subsystem Device ID may be 16-bit hex integers or the special wildcard string “*”, which indicates a don’t care condition. </p>
<p>The remaining sections in this chapter outline the format of the “opae” configurations key. </p>
<p>“plugin”: libopae-c and libopae-v </p>
<p>The “plugin” key in the “opae” section of a configuration is an array of <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> plugin configuration data.  Each item in the array matches one or more PF or VF devices to a plugin library module. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>
<a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a>
<a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a>
<a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="w">      </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a>
<a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a><span class="w">      </span><span class="err">“</span><span class="n">opae</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a>
<a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a><span class="w">        </span><span class="err">“</span><span class="n">plugin</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a>
<a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a><span class="w">          </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a>
<a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a><span class="w">            </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-110-16" name="__codelineno-110-16" href="#__codelineno-110-16"></a>
<a id="__codelineno-110-17" name="__codelineno-110-17" href="#__codelineno-110-17"></a><span class="w">            </span><span class="err">“</span><span class="n">module</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">libxfpga</span><span class="p">.</span><span class="n">so</span><span class="err">”</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-110-18" name="__codelineno-110-18" href="#__codelineno-110-18"></a>
<a id="__codelineno-110-19" name="__codelineno-110-19" href="#__codelineno-110-19"></a><span class="w">            </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="w"> </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-110-20" name="__codelineno-110-20" href="#__codelineno-110-20"></a>
<a id="__codelineno-110-21" name="__codelineno-110-21" href="#__codelineno-110-21"></a><span class="w">            </span><span class="err">“</span><span class="n">configuration</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
<a id="__codelineno-110-22" name="__codelineno-110-22" href="#__codelineno-110-22"></a>
<a id="__codelineno-110-23" name="__codelineno-110-23" href="#__codelineno-110-23"></a><span class="w">          </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-110-24" name="__codelineno-110-24" href="#__codelineno-110-24"></a>
<a id="__codelineno-110-25" name="__codelineno-110-25" href="#__codelineno-110-25"></a><span class="w">          </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-110-26" name="__codelineno-110-26" href="#__codelineno-110-26"></a>
<a id="__codelineno-110-27" name="__codelineno-110-27" href="#__codelineno-110-27"></a><span class="w">            </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-110-28" name="__codelineno-110-28" href="#__codelineno-110-28"></a>
<a id="__codelineno-110-29" name="__codelineno-110-29" href="#__codelineno-110-29"></a><span class="w">            </span><span class="err">“</span><span class="n">module</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">libopae</span><span class="o">-</span><span class="n">v</span><span class="p">.</span><span class="n">so</span><span class="err">”</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-110-30" name="__codelineno-110-30" href="#__codelineno-110-30"></a>
<a id="__codelineno-110-31" name="__codelineno-110-31" href="#__codelineno-110-31"></a><span class="w">            </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_vf</span><span class="err">”</span><span class="w"> </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-110-32" name="__codelineno-110-32" href="#__codelineno-110-32"></a>
<a id="__codelineno-110-33" name="__codelineno-110-33" href="#__codelineno-110-33"></a><span class="w">            </span><span class="err">“</span><span class="n">configuration</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
<a id="__codelineno-110-34" name="__codelineno-110-34" href="#__codelineno-110-34"></a>
<a id="__codelineno-110-35" name="__codelineno-110-35" href="#__codelineno-110-35"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-110-36" name="__codelineno-110-36" href="#__codelineno-110-36"></a>
<a id="__codelineno-110-37" name="__codelineno-110-37" href="#__codelineno-110-37"></a><span class="w">        </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-110-38" name="__codelineno-110-38" href="#__codelineno-110-38"></a>
<a id="__codelineno-110-39" name="__codelineno-110-39" href="#__codelineno-110-39"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-110-40" name="__codelineno-110-40" href="#__codelineno-110-40"></a>
<a id="__codelineno-110-41" name="__codelineno-110-41" href="#__codelineno-110-41"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-110-42" name="__codelineno-110-42" href="#__codelineno-110-42"></a>
<a id="__codelineno-110-43" name="__codelineno-110-43" href="#__codelineno-110-43"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-110-44" name="__codelineno-110-44" href="#__codelineno-110-44"></a>
<a id="__codelineno-110-45" name="__codelineno-110-45" href="#__codelineno-110-45"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 109 "opae" / "plugin" key/</p>
<p><a name="figure-109"></a></p>
<p>If the “enabled” key is false or if it is omitted, then that “plugin” array entry is skipped, and parsing continues.  The “module” key is a string that identifies the desired plugin module library for the entry.  The “devices” array lists one or more PF/VF identifiers.  Each array value must be a string, and it must match a device that is described in the “configurations” “devices” section.  The “configuration” key of the “plugin” section specifies a unique plugin-specific configuration.  Currently, libopae-c and libopae-v use no plugin-specific config, so these keys are left empty. </p>
<p>“fpgainfo”: fpgainfo application </p>
<p>The “fpgainfo” key in the “opae” section of a configuration is an array of fpgainfo plugin configuration data.  Each item in the array matches one or more PF or VF devices to an fpgainfo plugin library module. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a>
<a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a>
<a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a>
<a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a><span class="w">      </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a>
<a id="__codelineno-111-9" name="__codelineno-111-9" href="#__codelineno-111-9"></a><span class="w">      </span><span class="err">“</span><span class="n">opae</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-111-10" name="__codelineno-111-10" href="#__codelineno-111-10"></a>
<a id="__codelineno-111-11" name="__codelineno-111-11" href="#__codelineno-111-11"></a><span class="w">        </span><span class="err">“</span><span class="n">fpgainfo</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-111-12" name="__codelineno-111-12" href="#__codelineno-111-12"></a>
<a id="__codelineno-111-13" name="__codelineno-111-13" href="#__codelineno-111-13"></a><span class="w">          </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-111-14" name="__codelineno-111-14" href="#__codelineno-111-14"></a>
<a id="__codelineno-111-15" name="__codelineno-111-15" href="#__codelineno-111-15"></a><span class="w">            </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-111-16" name="__codelineno-111-16" href="#__codelineno-111-16"></a>
<a id="__codelineno-111-17" name="__codelineno-111-17" href="#__codelineno-111-17"></a><span class="w">            </span><span class="err">“</span><span class="n">module</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">libboard_c6100</span><span class="p">.</span><span class="n">so</span><span class="err">”</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-111-18" name="__codelineno-111-18" href="#__codelineno-111-18"></a>
<a id="__codelineno-111-19" name="__codelineno-111-19" href="#__codelineno-111-19"></a><span class="w">            </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-111-20" name="__codelineno-111-20" href="#__codelineno-111-20"></a>
<a id="__codelineno-111-21" name="__codelineno-111-21" href="#__codelineno-111-21"></a><span class="w">              </span><span class="p">{</span><span class="w"> </span><span class="err">“</span><span class="n">device</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="err">“</span><span class="n">feature_id</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="mh">0x12</span><span class="err">”</span><span class="w"> </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-111-22" name="__codelineno-111-22" href="#__codelineno-111-22"></a>
<a id="__codelineno-111-23" name="__codelineno-111-23" href="#__codelineno-111-23"></a><span class="w">              </span><span class="p">{</span><span class="w"> </span><span class="err">“</span><span class="n">device</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_vf</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="err">“</span><span class="n">feature_id</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="mh">0x12</span><span class="err">”</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-111-24" name="__codelineno-111-24" href="#__codelineno-111-24"></a>
<a id="__codelineno-111-25" name="__codelineno-111-25" href="#__codelineno-111-25"></a><span class="w">            </span><span class="p">]</span><span class="w"> </span>
<a id="__codelineno-111-26" name="__codelineno-111-26" href="#__codelineno-111-26"></a>
<a id="__codelineno-111-27" name="__codelineno-111-27" href="#__codelineno-111-27"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-111-28" name="__codelineno-111-28" href="#__codelineno-111-28"></a>
<a id="__codelineno-111-29" name="__codelineno-111-29" href="#__codelineno-111-29"></a><span class="w">        </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-111-30" name="__codelineno-111-30" href="#__codelineno-111-30"></a>
<a id="__codelineno-111-31" name="__codelineno-111-31" href="#__codelineno-111-31"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-111-32" name="__codelineno-111-32" href="#__codelineno-111-32"></a>
<a id="__codelineno-111-33" name="__codelineno-111-33" href="#__codelineno-111-33"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-111-34" name="__codelineno-111-34" href="#__codelineno-111-34"></a>
<a id="__codelineno-111-35" name="__codelineno-111-35" href="#__codelineno-111-35"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-111-36" name="__codelineno-111-36" href="#__codelineno-111-36"></a>
<a id="__codelineno-111-37" name="__codelineno-111-37" href="#__codelineno-111-37"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 110 "opae" / "fpgainfo" key</p>
<p><a name="figure-110"></a></p>
<p>If the “enabled” key is false or if it is omitted, then that “fpgainfo” array entry is skipped, and parsing continues.  The “module” key is a string that identifies the desired fpgainfo module library for the entry.  Each “devices” array entry gives a PF/VF identifier in its “device” key and a <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> feature ID in its “feature_id” key. </p>
<p>“fpgad”: fpgad daemon process </p>
<p>The “fpgad” key in the “opae” section of a configuration is an array of fpgad plugin configuration data.  Each item in the array matches one or more PF or VF devices to an fpgad plugin library module. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a>
<a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a>
<a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a>
<a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="w">      </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a>
<a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a><span class="w">      </span><span class="err">“</span><span class="n">opae</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a>
<a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a><span class="w">        </span><span class="err">“</span><span class="n">fpgad</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-112-12" name="__codelineno-112-12" href="#__codelineno-112-12"></a>
<a id="__codelineno-112-13" name="__codelineno-112-13" href="#__codelineno-112-13"></a><span class="w">          </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-112-14" name="__codelineno-112-14" href="#__codelineno-112-14"></a>
<a id="__codelineno-112-15" name="__codelineno-112-15" href="#__codelineno-112-15"></a><span class="w">            </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-112-16" name="__codelineno-112-16" href="#__codelineno-112-16"></a>
<a id="__codelineno-112-17" name="__codelineno-112-17" href="#__codelineno-112-17"></a><span class="w">            </span><span class="err">“</span><span class="n">module</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">libfpgad</span><span class="o">-</span><span class="n">vc</span><span class="p">.</span><span class="n">so</span><span class="err">”</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-112-18" name="__codelineno-112-18" href="#__codelineno-112-18"></a>
<a id="__codelineno-112-19" name="__codelineno-112-19" href="#__codelineno-112-19"></a><span class="w">            </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="w"> </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-112-20" name="__codelineno-112-20" href="#__codelineno-112-20"></a>
<a id="__codelineno-112-21" name="__codelineno-112-21" href="#__codelineno-112-21"></a><span class="w">            </span><span class="err">“</span><span class="n">configuration</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-112-22" name="__codelineno-112-22" href="#__codelineno-112-22"></a>
<a id="__codelineno-112-23" name="__codelineno-112-23" href="#__codelineno-112-23"></a><span class="w">              </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-112-24" name="__codelineno-112-24" href="#__codelineno-112-24"></a>
<a id="__codelineno-112-25" name="__codelineno-112-25" href="#__codelineno-112-25"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-112-26" name="__codelineno-112-26" href="#__codelineno-112-26"></a>
<a id="__codelineno-112-27" name="__codelineno-112-27" href="#__codelineno-112-27"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-112-28" name="__codelineno-112-28" href="#__codelineno-112-28"></a>
<a id="__codelineno-112-29" name="__codelineno-112-29" href="#__codelineno-112-29"></a><span class="w">        </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-112-30" name="__codelineno-112-30" href="#__codelineno-112-30"></a>
<a id="__codelineno-112-31" name="__codelineno-112-31" href="#__codelineno-112-31"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-112-32" name="__codelineno-112-32" href="#__codelineno-112-32"></a>
<a id="__codelineno-112-33" name="__codelineno-112-33" href="#__codelineno-112-33"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-112-34" name="__codelineno-112-34" href="#__codelineno-112-34"></a>
<a id="__codelineno-112-35" name="__codelineno-112-35" href="#__codelineno-112-35"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-112-36" name="__codelineno-112-36" href="#__codelineno-112-36"></a>
<a id="__codelineno-112-37" name="__codelineno-112-37" href="#__codelineno-112-37"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 111 "opae" / "fpgad" key </p>
<p><a name="figure-111"></a></p>
<p>If the “enabled” key is false or if it is omitted, then that “fpgad” array entry is skipped, and parsing continues.  The “module” key is a string that identifies the desired fpgad plugin module library for the entry.  The “devices” array lists one or more PF/VF identifiers.  Each array value must be a string, and it must match a device that is described in the “configurations” “devices” section.  The “configuration” key of the “fpgad” section specifies a unique plugin-specific configuration. </p>
<p>“rsu”: rsu script </p>
<p>The “rsu” key in the “opae” section of a configuration is an array of rsu script configuration data.  Each item in the array matches one or more PF devices to an rsu configuration. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a>
<a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a>
<a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a>
<a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="w">      </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a>
<a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a><span class="w">      </span><span class="err">“</span><span class="n">opae</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a>
<a id="__codelineno-113-11" name="__codelineno-113-11" href="#__codelineno-113-11"></a><span class="w">        </span><span class="err">“</span><span class="n">rsu</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-113-12" name="__codelineno-113-12" href="#__codelineno-113-12"></a>
<a id="__codelineno-113-13" name="__codelineno-113-13" href="#__codelineno-113-13"></a><span class="w">          </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-113-14" name="__codelineno-113-14" href="#__codelineno-113-14"></a>
<a id="__codelineno-113-15" name="__codelineno-113-15" href="#__codelineno-113-15"></a><span class="w">            </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-113-16" name="__codelineno-113-16" href="#__codelineno-113-16"></a>
<a id="__codelineno-113-17" name="__codelineno-113-17" href="#__codelineno-113-17"></a><span class="w">            </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="w"> </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-113-18" name="__codelineno-113-18" href="#__codelineno-113-18"></a>
<a id="__codelineno-113-19" name="__codelineno-113-19" href="#__codelineno-113-19"></a><span class="w">            </span><span class="err">“</span><span class="n">fpga_default_sequences</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">common_rsu_sequences</span><span class="err">”</span><span class="w"> </span>
<a id="__codelineno-113-20" name="__codelineno-113-20" href="#__codelineno-113-20"></a>
<a id="__codelineno-113-21" name="__codelineno-113-21" href="#__codelineno-113-21"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-113-22" name="__codelineno-113-22" href="#__codelineno-113-22"></a>
<a id="__codelineno-113-23" name="__codelineno-113-23" href="#__codelineno-113-23"></a><span class="w">        </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-113-24" name="__codelineno-113-24" href="#__codelineno-113-24"></a>
<a id="__codelineno-113-25" name="__codelineno-113-25" href="#__codelineno-113-25"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-113-26" name="__codelineno-113-26" href="#__codelineno-113-26"></a>
<a id="__codelineno-113-27" name="__codelineno-113-27" href="#__codelineno-113-27"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-113-28" name="__codelineno-113-28" href="#__codelineno-113-28"></a>
<a id="__codelineno-113-29" name="__codelineno-113-29" href="#__codelineno-113-29"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-113-30" name="__codelineno-113-30" href="#__codelineno-113-30"></a>
<a id="__codelineno-113-31" name="__codelineno-113-31" href="#__codelineno-113-31"></a><span class="w">  </span><span class="err">“</span><span class="n">common_rsu_sequences</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-113-32" name="__codelineno-113-32" href="#__codelineno-113-32"></a>
<a id="__codelineno-113-33" name="__codelineno-113-33" href="#__codelineno-113-33"></a><span class="w">    </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-113-34" name="__codelineno-113-34" href="#__codelineno-113-34"></a>
<a id="__codelineno-113-35" name="__codelineno-113-35" href="#__codelineno-113-35"></a><span class="w">  </span><span class="p">]</span><span class="w"> </span>
<a id="__codelineno-113-36" name="__codelineno-113-36" href="#__codelineno-113-36"></a>
<a id="__codelineno-113-37" name="__codelineno-113-37" href="#__codelineno-113-37"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 112 "opae" / "rsu" key  </p>
<p><a name="figure-112"></a></p>
<p>If the “enabled” key is false or if it is omitted, then that “rsu” array entry is skipped, and parsing continues.  When disabled, the device(s) mentioned in that array entry will not be available for the rsu command. The “devices” array lists one or more PF identifiers.  Each array value must be a string, and it must match a device that is described in the “configurations” “devices” section.  The “fpga_default_sequences” key of the “rsu” section specifies a JSON key.  The configuration searches for that JSON key at the global level of the configuration file, and when found applies its value as the valid set of fpga boot sequences that can be used with the rsu fpgadefault subcommand. </p>
<p><code>C
“fpgareg”: fpgareg script</code></p>
<p>The “fpgareg” key in the “opae” section of a configuration is an array of fpgareg script configuration data.  Each item in the array matches one or more PF/VF devices to an fpgareg configuration. </p>
<p>```C
{ </p>
<p>“configurations”: { </p>
<div class="highlight"><pre><span></span><code>“c6100”: {

  ...

  “opae”: {

    “fpgareg”: [

      {

        “enabled”: true,

        “devices”: [ “c6100_pf”, “c6100_vf” ]

      }

    ],

  }

}
</code></pre></div>
<p>}, </p>
<p>} 
 ```</p>
<p align = "center">Figure 113 "opae" / "fpgareg" key   </p>
<p><a name="figure-113"></a></p>
<p>If the “enabled” key is false or if it is omitted, then that “fpgareg” array entry is skipped, and parsing continues.  When disabled, the device(s) mentioned in that array entry will not be available for the fpgareg command. The “devices” array lists one or more PF/VF identifiers.  Each array value must be a string, and it must match a device that is described in the “configurations” “devices” section.   </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="err">“</span><span class="n">opae</span><span class="p">.</span><span class="n">io</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="n">opae</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="n">application</span><span class="w"> </span>
</code></pre></div>
<p>The “opae.io” key in the “opae” section of a configuration is an array of opae.io configuration data.  Each item in the array matches one or more PF/VF devices to an opae.io platform string. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a>
<a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a>
<a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a>
<a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a><span class="w">      </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a>
<a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a><span class="w">      </span><span class="err">“</span><span class="n">opae</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a>
<a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a><span class="w">        </span><span class="err">“</span><span class="n">opae</span><span class="p">.</span><span class="n">io</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a>
<a id="__codelineno-115-13" name="__codelineno-115-13" href="#__codelineno-115-13"></a><span class="w">          </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-115-14" name="__codelineno-115-14" href="#__codelineno-115-14"></a>
<a id="__codelineno-115-15" name="__codelineno-115-15" href="#__codelineno-115-15"></a><span class="w">            </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-115-16" name="__codelineno-115-16" href="#__codelineno-115-16"></a>
<a id="__codelineno-115-17" name="__codelineno-115-17" href="#__codelineno-115-17"></a><span class="w">            </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_vf</span><span class="err">”</span><span class="w"> </span><span class="p">]</span><span class="w"> </span>
<a id="__codelineno-115-18" name="__codelineno-115-18" href="#__codelineno-115-18"></a>
<a id="__codelineno-115-19" name="__codelineno-115-19" href="#__codelineno-115-19"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-115-20" name="__codelineno-115-20" href="#__codelineno-115-20"></a>
<a id="__codelineno-115-21" name="__codelineno-115-21" href="#__codelineno-115-21"></a><span class="w">        </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-115-22" name="__codelineno-115-22" href="#__codelineno-115-22"></a>
<a id="__codelineno-115-23" name="__codelineno-115-23" href="#__codelineno-115-23"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-115-24" name="__codelineno-115-24" href="#__codelineno-115-24"></a>
<a id="__codelineno-115-25" name="__codelineno-115-25" href="#__codelineno-115-25"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-115-26" name="__codelineno-115-26" href="#__codelineno-115-26"></a>
<a id="__codelineno-115-27" name="__codelineno-115-27" href="#__codelineno-115-27"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-115-28" name="__codelineno-115-28" href="#__codelineno-115-28"></a>
<a id="__codelineno-115-29" name="__codelineno-115-29" href="#__codelineno-115-29"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 114 "opae" / "opae.io" key    </p>
<p><a name="figure-114"></a></p>
<p>If the “enabled” key is false or if it is omitted, then that “opae.io” array entry is skipped, and parsing continues.  When disabled, the device(s) mentioned in that array entry will continue to be available for the opae.io command.  The device(s) platform string will not be shown in the <code>opae.io ls</code> command.  The “devices” array lists one or more PF/VF identifiers.  Each array value must be a string, and it must match a device that is described in the “configurations” “devices” section.   </p>
<p>Libxfpga – Updating the Metrics API </p>
<p>Edit libraries/plugins/xfpga/sysfs.c.  Find the definition of the opae_id_to_hw_type() function.  Update the function to add the new vendor/device ID to hw_type mapping. </p>
<p>This mapping is used by the SDK’s metrics API to determine the method of accessing the board sensor information and is very specific to the underlying <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> implementation.  It may be necessary to add a new hw_type value and to update the logic in libraries/plugins/xfpga/metrics. </p>
<p><a name = "heading-11.0"></a></p>
<h2 id="110-dfl-linux-kernel-drivers"><strong>11.0 <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> Linux Kernel Drivers</strong></h2>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver software provides the bottom-most API to FPGA platforms. Libraries such as OPAE and frameworks such as DPDK are consumers of the APIs provided by <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>. Applications may be built on top of these frameworks and libraries. The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> software does not cover any out-of-band management interfaces. <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> driver software is designed to be extendable, flexible, and provide for bare-metal and virtualized functionality.</p>
<p>The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> driver software can be found in the<a href="https://github.com/OFS/linux-dfl"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repository - linux-dfl</a>, under the linux-dfl specific category. This repository has an associated <a href="https://github.com/OFS/linux-dfl/wiki"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repository - linux-dfl - wiki page</a> that includes the following information:
- An description of the three available branch archetypes
- Configuration tweaks required while building the kernel
- A functional description of the available <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> framework
- Descriptions for all currently available driver modules that support FPGA <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> board solutions
- Steps to create a new <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver
- Steps to port a <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver patch</p>
<p><br></p>
<h2 id="notices-disclaimers">Notices &amp; Disclaimers</h2>
<p>Intel<sup>&reg;</sup> technologies may require enabled hardware, software or service activation.
No product or component can be absolutely secure. 
Performance varies by use, configuration and other factors.
Your costs and results may vary. 
You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Intel products described herein. You agree to grant Intel a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.
No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document, with the sole exception that you may publish an unmodified copy. You may create software implementations based on this document and in compliance with the foregoing that are intended to execute on the Intel product(s) referenced in this document. No rights are granted to create modifications or derivatives of this document.
The products described may contain design defects or errors known as errata which may cause the product to deviate from published specifications.  Current characterized errata are available on request.
Intel disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.
You are responsible for safety of the overall system, including compliance with applicable safety-related requirements or standards. 
<sup>&copy;</sup> Intel Corporation.  Intel, the Intel logo, and other Intel marks are trademarks of Intel Corporation or its subsidiaries.  Other names and brands may be claimed as the property of others.   </p>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.top", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
    
  </body>
</html>