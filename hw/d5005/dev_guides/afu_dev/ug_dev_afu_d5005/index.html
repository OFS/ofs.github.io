
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../fim_dev/ug_dev_fim_ofs_d5005/">
      
      
        <link rel="next" href="../../../user_guides/ug_sim_ofs_d5005/ug_sim_ofs_d5005/">
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>AFU Developer Guide - OFS</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#accelerator-functional-unit-developer-guide-open-fpga-stack-for-intel-stratix-10" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="OFS" class="md-header__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OFS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AFU Developer Guide
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-tabs__link md-tabs__link--active">
        Stratix 10 PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../n6001/user_guides/ug_eval_ofs_n6001/ug_eval_script_ofs_n6001/" class="md-tabs__link">
        Agilex PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../f2000x/user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-tabs__link">
        Agilex SoC Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../common/user_guides/oneapi_asp/ug_oneapi_asp/" class="md-tabs__link">
        oneAPI
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../sw/fpga_api/quick_start/readme/" class="md-tabs__link">
        OFS Software
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="OFS" class="md-nav__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OFS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Stratix 10 PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Stratix 10 PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference_manuals/ofs_fim/mnl_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fim_dev/ug_dev_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        AFU Developer Guide
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_sim_ofs_d5005/ug_sim_ofs_d5005/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Agilex PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Agilex PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/user_guides/ug_eval_ofs_n6001/ug_eval_script_ofs_n6001/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/reference_manuals/ofs_fim/mnl_fim_ofs_n6001/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/dev_guides/afu_dev/ug_dev_afu_ofs_n6001/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/dev_guides/hps_dev/hps_developer_ug/" class="md-nav__link">
        HPS Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/user_guides/ug_sim_ofs_n6001/ug_sim_ofs_n6001/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Agilex SoC Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Agilex SoC Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/user_guides/ug_qs_ofs_f2000x/ug_qs_ofs_f2000x/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/reference_manuals/ofs_fim/mnl_fim_ofs/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/dev_guides/afu_dev/ug_dev_afu_ofs_f2000x/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/user_guides/ug_sim_ofs/ug_sim_ofs/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          oneAPI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          oneAPI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/oneapi_asp/ug_oneapi_asp/" class="md-nav__link">
        oneAPI ASP Getting Started User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/oneapi_asp/oneapi_asp_ref_mnl/" class="md-nav__link">
        oneAPI Accelerator Support Package(ASP) Reference Manual
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          OFS Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          OFS Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
          OPAE USER GUIDES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          OPAE USER GUIDES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/quick_start/readme/" class="md-nav__link">
        Quick Start Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/install_guide/installation_guide/" class="md-nav__link">
        OPAE Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/prog_guide/readme/" class="md-nav__link">
        OPAE C API Programming Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/pyopae/python_bindings/" class="md-nav__link">
        OPAE Python Bindings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/plug_guide/readme/" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          OPAE LIBRARIES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          OPAE LIBRARIES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/fpga_api/" class="md-nav__link">
        OPAE C API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/fpga_cxx_api/" class="md-nav__link">
        OPAE C++ Core API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/fpga_python_api/" class="md-nav__link">
        OPAE Python API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/plug_guide/readme/" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
          OPAE LINUX KERNEL DRIVERS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          OPAE LINUX KERNEL DRIVERS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/drv_arch/drv_arch/" class="md-nav__link">
        Open Programmable Accelerator Engine (OPAE) Linux Device Driver Architecture
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../sw/fpga_tools/fpgadiag/">OPAE FPGA TOOLS</a>
          
            <label for="__nav_6_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          OPAE FPGA TOOLS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgaconf/fpgaconf/" class="md-nav__link">
        fpgaconf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgainfo/fpgainfo/" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgasupdate/fpgasupdate/" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mmlink/mmlink/" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/packager/packager/" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/userclk/userclk/" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi/hssi/" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/pci_device/pci_device/" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opae.io/opae.io/" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/rsu/rsu/" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/host_exerciser/host_exerciser/" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssistats/" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssiloopback/" class="md-nav__link">
        HSSI ethernet loopback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mem_tg/mem_tg/" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/vabtool/vabtool/" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaevfio/opaevfio/" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/ofs.uio/ofs.uio/" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaeuio/opaeuio/" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgad/fpgad/" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="accelerator-functional-unit-developer-guide-open-fpga-stack-for-intel-stratix-10">Accelerator Functional Unit Developer Guide: Open FPGA Stack for Intel® Stratix 10®<a class="headerlink" href="#accelerator-functional-unit-developer-guide-open-fpga-stack-for-intel-stratix-10" title="Permanent link">&para;</a></h1>
<h1 id="1-introduction">1. Introduction<a class="headerlink" href="#1-introduction" title="Permanent link">&para;</a></h1>
<p>This document is a design guide for creating an Accelerator Functional Unit (<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>) using Open FPGA Stack (<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>) for Intel® Stratix 10® FPGA. The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> concept consists of separating the FPGA design development process into two parts, the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, as shown in the diagram below:</p>
<p><a class="glightbox" href="../images/FIM_top_intro.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/FIM_top_intro.png" /></a>
</br></br></p>
<p>This diagram shows the FPGA board interface development separation from the internal FPGA workload creation. This separation starts with the FPGA Interface Manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>), which consists of the external interfaces and board management functions. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> is the base system layer typically provided by board vendors. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> interface is specific to a particular physical platform. The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> uses the external interfaces with user-defined logic to perform a specific application. Separating the lengthy and complicated process of developing and integrating external interfaces for an FPGA into a board allows the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developer to focus on their workload needs.  Intel® <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel® Stratix 10® FPGA provides the following tools for rapid <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development:</p>
<ul>
<li>Scripts for both compilation setup</li>
<li>Integration with Open Programmable Acceleration Engine (OPAE) SDK for rapid software development for your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> application</li>
</ul>
<p>Please notice that the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region consists of both static and <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> logic in the above block diagram. Creating <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> logic for the static region is described in <a href="https://ofs.github.io/hw/d5005/dev_guides/fim_dev/ug_dev_fim_ofs_d5005/">Intel® FPGA Interface Manager Developer Guide: Open Stack for Intel® Stratix 10®</a> . This guide covers logic in the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Main (<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>) region.</p>
<h2 id="11-document-organization">1.1 Document Organization<a class="headerlink" href="#11-document-organization" title="Permanent link">&para;</a></h2>
<p>This document is organized as follows:</p>
<ul>
<li>Description of design flow</li>
<li>Interfaces and functionality provided in the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></li>
<li>Downloading and installing Intel® OFSand <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr></li>
<li>Hardware/Software co-simulation using ASE</li>
<li>Testing the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> example in Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005</li>
<li>Debugging an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> with Remote Signal Tap</li>
</ul>
<p>This guide provides theory followed by tutorial steps to solidify your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development knowledge.</p>
<p>This guide uses the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 as the platform for all tutorial steps. Additionally, this guide and the tutorial steps can be used with other platforms; However, please consult the <strong>board</strong> and <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> supplier of other platforms for specific instructions on the use of custom <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> to develop  <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> design.</p>
<p>If you have worked with previous Intel® Programmable Acceleration products, you will find <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel® Stratix 10® FPGA is similar; however, there are differences, and you are advised to carefully read and follow the tutorial steps to understand the design tools and flow fully.</p>
<h2 id="12-prerequisite">1.2 Prerequisite<a class="headerlink" href="#12-prerequisite" title="Permanent link">&para;</a></h2>
<p>This guide assumes you understand the following FPGA logic design-related knowledge and skills:</p>
<ul>
<li>FPGA compilation flows, including the  Intel® Quartus® Prime Pro Edition design flow.</li>
<li>Static Timing closure, including familiarity with the Timing Analyzer tool in  Intel® Quartus® Prime Pro Edition software, applying timing constraints, Synopsys* Design Constraints (.sdc) language and Tcl scripting, and design methods to close on critical timing paths.</li>
<li>RTL and coding practices to create synthesized logic.</li>
<li>High-level synthesis (HLS) and Platform Designer design entry tools are supported.</li>
<li>RTL simulation tools.</li>
<li>Signal Tap Logic Analyzer tool in the  Intel® Quartus® Prime Pro Edition software.</li>
</ul>
<h3 id="121-development-environment">1.2.1 Development Environment<a class="headerlink" href="#121-development-environment" title="Permanent link">&para;</a></h3>
<p>To run the tutorial steps in this guide requires this <strong>development</strong> environment:</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>Operating System</td>
<td>RHEL 8.2</td>
</tr>
<tr>
<td>Python</td>
<td>3.7.7</td>
</tr>
<tr>
<td>cmake</td>
<td>3.11.4</td>
</tr>
<tr>
<td>GCC</td>
<td>7.2.0</td>
</tr>
<tr>
<td>git</td>
<td>1.8.3.1</td>
</tr>
<tr>
<td>perl</td>
<td>5.8.8</td>
</tr>
</tbody>
</table>
<p>Verify your development has the above tools installed.</p>
<p>The following server and Intel® <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> card are required to run the examples in this guide:</p>
<ol>
<li>Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 with root entry hash erased (Please contact Intel® for root entry hash erase instructions). The standard Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 card is programmed only to allow the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> binary files signed by Intel® to be loaded. The root entry hash erases process will allow unsigned <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> binary files to be loaded.</li>
<li>Qualified Server Models see <a href="https://www.intel.com/content/www/us/en/products/details/fpga/platforms/pac/d5005/view.html">Qualified Servers</a>.</li>
<li>Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 installed in the qualified server following instructions in <a href="https://ofs.github.io/hw/d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Getting Started User Guide</a></li>
</ol>
<h2 id="13-acceleration-functional-unit-afu-development-flow">1.3 Acceleration Functional Unit (<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>) Development Flow<a class="headerlink" href="#13-acceleration-functional-unit-afu-development-flow" title="Permanent link">&para;</a></h2>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Stack provides a rapid design methodology for creating complex FPGA applications. In addition, you are provided with the following:</p>
<ul>
<li>Hardware shell layer, known as <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> </li>
<li>Software stack including tools for debug/diagnostics</li>
<li>FPGA design flow  with full-stack simulation support</li>
<li><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> code samples demonstrating all interfaces</li>
</ul>
<p>For any non-Intel® platform, contact your board vendor for the above components specific to the platform.
To start with <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development, the first step should be to understand your platform capabilities. For example, what interface is the FPGA connected to the Host machine over PCI-E, if it is AXI like the Intel® Stratix 10® FPGA Platform, or CCIP or CXL. Does the platform provide an External Memory Interface or the HSSI interface? Once you know what the platform offers, you can develop your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> requirements and architecture as the next step. 
This document will cover example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> architecture and things that will help build <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> for Intel® Stratix 10® FPGA reference platform and others coming in the future. In addition, this knowledge can be relatively applied for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development on other vendor-provided platforms.</p>
<p>The figure below shows a typical <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development process independent of the platform used. </p>
<p><br></p>
<pre class="mermaid"><code>flowchart  TB;
    A[Understand platform capabilities with OFS]--&gt;B[Review AFU requirements and code samples provided];
    B[Review AFU requirements and code samples provided]--&gt;C[Define AFU architecture];
    C[Define AFU architecture]--&gt;D[Design AFU hardware];
    D[Design AFU hardware]--&gt;E[Develop AFU software to control hardware];
    E[Develop AFU software to control hardware]--&gt;F{"Simulate in AFU Simulation Enviroment (ASE)"};
    F:::if -- Pass --&gt; H["Compile AFU for synthesis, place &amp; route and timing (uses Quartus)"];
    H["Compile AFU for synthesis, place &amp; route and timing (uses Quartus)"] --&gt; I["Analyze Quartus Compile reports"];
    I --&gt; J{"Quartus reports clean? (e.g. timing closed)"};
    J:::if -- No --&gt; P2;
    J -- Yes --&gt; K["Run/Validate design on OFS Platform"];
    K --&gt; L{"Hardware validation pass?"};
    L == Yes ==&gt; M["AFU ready to deploy"];
    L -- No --&gt; N["Debug on hardware using traditional FPGA tools (e.g. SignalTab"];
    N --&gt; P2["Fix AFU design (e.g Design changes, timing closure constraints)"];
    P2 --&gt; O{"Need functional validation?"};
    O:::if -- Yes --&gt;P["Fix AFU design (e.g Functional design changes, bug fixes)"];
    O -- No --&gt;H;    
    F -- Fail --&gt; P;
    P --&gt;D;      

    classDef default color:#fff,fill:#0071c5,stroke:#71c5,stroke-width:1px
    classDef if color:#0071c5,fill:#fff,stroke:#0071c5,stroke-width:2px</code></pre>
<h3 id="131-high-level-data-flow">1.3.1. High Level Data Flow<a class="headerlink" href="#131-high-level-data-flow" title="Permanent link">&para;</a></h3>
<p>The OFShigh-level data flow is shown below:
<a class="glightbox" href="../images/IOFS_DataFlow.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/IOFS_DataFlow.png" /></a>
The control and data are composed of the following:</p>
<ul>
<li>Host Interface Adapter (PCIe)</li>
<li>Low-Performance Peripherals<ul>
<li>Slow speed peripherals (I2C, Smbus, etc)</li>
<li>Management peripherals (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>)</li>
</ul>
</li>
</ul>
<ul>
<li>High-Performance Peripherals<ul>
<li>Memory peripherals</li>
<li>Acceleration Function peripherals</li>
<li>HPS Peripheral</li>
</ul>
</li>
</ul>
<ul>
<li>Fabrics<ul>
<li>Peripheral Fabric (multi-drop)</li>
<li><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Streaming fabric (point to point)</li>
</ul>
</li>
</ul>
<p>Peripherals are connected using AXI or Avalon:</p>
<ul>
<li>Via the peripheral fabric (AXI4-Lite, multi-drop)</li>
<li>Via the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> streaming fabric (AXI-S, point to point)</li>
</ul>
<p>Peripherals are presented to software as:</p>
<ul>
<li><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> managed peripherals that implement DFH CSR structure.  </li>
<li>Native driver managed peripherals (i.e., Exposed via an independent PF, VF)</li>
</ul>
<p>The peripherals connected to the peripheral fabric are primarily OPAE managed resources, whereas the peripherals connected to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> are "primarily" driven by native OS drivers. The word "primarily" is used since the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is not mandated to expose all its peripherals to Intel® OPAE. Instead, it can be connected to the peripheral fabric but can choose to expose only a subset of its capability to OPAE.</p>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> uses a defined set of CSRs to expose the functionality of the FPGA to the host software. These registers are described in <a href="https://ofs.github.io/hw/d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/#7-mmio-regions">Open FPGA Stack Reference Manual - <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Regions section</a>.</p>
<p>If you make changes to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> that affect the software operation, Intel® <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> provides a mechanism to communicate that information to the proper software driver. The <a href="https://ofs.github.io/hw/d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/#721-device-feature-header-dfh-structure">Device Feature Header (DFH) structure</a> provides a mechanism to maintain compatibility with OPAE software. Please see <a href="https://github.com/ofs/linux-dfl/blob/fpga-ofs-dev/Documentation/fpga/dfl.rst#fpga-device-feature-list-dfl-framework-overview">FPGA Device Feature List (<abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>) Framework Overview</a> for an excellent description of <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> operation from the driver perspective.</p>
<p>When planning your address space for your <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> updates, please be aware <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> targeting Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005, 256KB of <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region is allocated for external <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> features, and 128kB of <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region is given for external port features. Each external feature must implement a feature DFH, and the DFH needs to be placed at the 4KB boundary. The last feature in the external feature list must have the EOL bit in its DFH set to 1 to mark the end of the external feature list. Since the FPGA address space is limited, consider using an indirect addressing scheme to conserve address space.</p>
<h3 id="132-considerations-for-pim-usage">1.3.2. Considerations for <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Usage<a class="headerlink" href="#132-considerations-for-pim-usage" title="Permanent link">&para;</a></h3>
<p>An early decision for your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development is determining if the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> will be included in your design flow. The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> is an abstraction layer, enabling partial <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> portability across hardware despite variations in hardware topology and native interfaces. Use of the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> is optional for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development. The use of the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> adds a level of logic between an accelerator (an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>) and the platform (the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>). It is a collection of System Verilog interfaces and shims. Please see <a href="https://github.com/OFS/ofs-platform-afu-bbb/blob/master/plat_if_develop/ofs_plat_if/docs/PIM_AFU_interface.md">Connecting an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to a Platform using <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr></a> for details on using the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> and its capabilities. Please see <a href="https://github.com/OFS/examples-afu/tree/main/tutorial"><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Tutorial</a> for a detailed tutorial on using <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>. The learning steps <a href="https://github.com/OFS/examples-afu/tree/main/tutorial"><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Tutorial</a> can be run with Intel® <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel® Stratix 10® FPGA <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> package after you have installed this package as described later in this guide.  </p>
<p>If you choose not to use the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>, please see <a href="https://github.com/OFS/examples-afu/tree/main/tutorial">Non-<abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Development</a> for instructions on using a traditional RTL design flow. Note, the example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> provided in Intel® <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> does not include <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>.</p>
<h3 id="133-afu-interfaces-included-with-intel-fpga-pac-d5005">1.3.3 <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interfaces Included with Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005<a class="headerlink" href="#133-afu-interfaces-included-with-intel-fpga-pac-d5005" title="Permanent link">&para;</a></h3>
<p>The figure below shows the interfaces available to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in this architecture. It also shows the design hierarchy with module names from the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> (top.sv) to the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  region <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> (afu_main.sv). One of the main differences from the previous Intel® Stratix 10® FPGA <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> architecture is a static port gasket region (port_gasket.sv) that has components to facilitate the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and also consists of the GBS region (afu_main.sv) via the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  slot. The Port Gasket contains all the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> -specific modules and logic, e.g., <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  slot reset/freeze control, user clock, remote STP etc. Architecturally, a Port Gasket can have multiple <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  slots to which user workload can be programmed. However, only one <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  slot is supported for Intel® <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Release for Intel® Stratix 10® FPGA. Therefore, everything in the Port Gasket until the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  slot should be provided by the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> developer. The task of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developer is to add their desired application in the afu_main.sv module by stripping out unwanted logic and instantiating the target accelerator. As shown in the figure below, here are the interfaces connected to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> (highlighted in green) via Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>:</p>
<ul>
<li>AXI Streaming (AXI-S) interface to the Host via PCIe Gen3x16</li>
<li>Avalon Memory-Mapped Channels (4) to the DDR4 EMIF interface</li>
<li>AXI Streaming (AXI-S) interface to the HSSI 10G Ethernet</li>
</ul>
<p><a class="glightbox" href="../images/rel1_afu.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="AFU top and AFU " src="../images/rel1_afu.png" /></a></p>
<h3 id="134-platform-capabilities">1.3.4. Platform Capabilities<a class="headerlink" href="#134-platform-capabilities" title="Permanent link">&para;</a></h3>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> targets operation in the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 card.  The block diagram of the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 is shown below:
<a class="glightbox" href="../images/d5005_Top.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/d5005_Top.png" /></a></p>
<p>The key Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 FPGA interfaces are:</p>
<ul>
<li>Host interface 
    - PCIe Gen3 x 16</li>
<li>Network interface<ul>
<li>2 - QSFP28 cages</li>
<li>Current <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> supports 1 x 10 GbE, other interfaces can be created  </li>
</ul>
</li>
<li>External Memory<ul>
<li>2 or 4 channels of DDR4-2400 to RDIMM modules</li>
<li>RDIMM modules =  8GB organized as 1 Gb X 72</li>
</ul>
</li>
<li>Board Management<ul>
<li>SPI interface</li>
<li>FPGA configuration</li>
</ul>
</li>
</ul>
<h3 id="135-top-level-fpga">1.3.5. Top Level FPGA<a class="headerlink" href="#135-top-level-fpga" title="Permanent link">&para;</a></h3>
<p>The internal FPGA architecture is shown below:</p>
<p><a class="glightbox" href="../images/Top_Rel1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/Top_Rel1.png" /></a></p>
<h1 id="2-set-up-afu-development-environment">2. Set Up <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Development Environment<a class="headerlink" href="#2-set-up-afu-development-environment" title="Permanent link">&para;</a></h1>
<p>This section covers:</p>
<ul>
<li>Development environment set up</li>
<li>Retrieving and installing <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>, <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr></li>
<li>Building theIntel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></li>
<li>Building a relocatable <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> tree</li>
<li>Compiling the host_chan_mmio example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></li>
</ul>
<p>Additionally, this section includes steps to demonstrate loading and running the host_chan_mmio example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in an Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 equipped Linux server.</p>
<h2 id="21-prepare-afu-development-environment">2.1. Prepare <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development environment<a class="headerlink" href="#21-prepare-afu-development-environment" title="Permanent link">&para;</a></h2>
<p>Typical development and hardware test environments consist of a development server or workstation with installed FPGA development tools and a separate server installed with the target <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>-compatible FPGA PCIe card. The typical usage and flow of data between these two servers are shown below:</p>
<p><a class="glightbox" href="../images/AFU_Dev_Deploy.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/AFU_Dev_Deploy.png" /></a></p>
<p>Please refer to Unit Level Simulation if you would like to make any simulation <a href="https://ofs.github.io/hw/d5005/dev_guides/fim_dev/ug_dev_fim_ofs_d5005/#412-unit-level-simulation">Unit Level Simulation</a>.</p>
<p>Note that both development and hardware testing can be performed on the same server if desired.</p>
<p>This guide uses Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 as the target <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>-compatible FPGA PCIe card platform for demonstration steps. The Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 must be fully installed following <a href="https://ofs.github.io/hw/d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Getting Started User Guide</a> If using a different <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> FPGA PCIe card, contact your supplier for instructions on how to install and operate a user-developed <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong>  </p>
<p>The following chapters assume you use the same server for development and Deployment (Run the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>/<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>/SW over the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005):</p>
<p>Development: Modify the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>/<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>/SW run simulation and compile the design (Generate the binaries). 
Deployment: Program the binaries under the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 and exercise the Hardware and Sw with real hardware</p>
</blockquote>
<h3 id="211-installation-of-quartus-and-ofs">2.1.1. Installation of Quartus and <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr><a class="headerlink" href="#211-installation-of-quartus-and-ofs" title="Permanent link">&para;</a></h3>
<p>Building <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> with <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> forIntel® Stratix 10® FPGA requires the build machine to have at least 64 GB of RAM.  </p>
<p>The following is a summary of the steps to set up for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development:</p>
<ol>
<li>Install  Intel® Quartus® Prime Pro Edition  23.1 Linux with Intel® Stratix 10® FPGA device support.</li>
<li>Make sure support tools are installed and meet version requirements.</li>
<li>Clone the repository.</li>
<li>Review the files provided in the repository.</li>
<li>Build a relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  tree - this will be the base <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> for your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</li>
</ol>
<p>Intel® Quartus® Prime Pro Edition version  23.1 is the currently verified version of  Intel® Quartus® Prime Pro Edition 23.1 used for building the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> images. The recommended Best Known Configuration (<abbr title="Best Known Configuration, The exact hardware configuration Intel has optimized and validated the solution against.">BKC</abbr>) <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Version 2023.1:</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>Intel® Quartus® Prime Pro Edition</td>
<td>23.1</td>
</tr>
<tr>
<td>Operating System</td>
<td>RHEL 8.2</td>
</tr>
<tr>
<td><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr></td>
<td><a href="https://github.com/OFS/opae-sdk/tree/2.5.0-3">2.5.0-3</a></td>
</tr>
<tr>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Release</td>
<td><a href="https://github.com/OFS/ofs-d5005/releases/tag/ofs-2023.1">ofs-2023.1</a></td>
</tr>
<tr>
<td>Python</td>
<td>3.7.7</td>
</tr>
<tr>
<td>cmake</td>
<td>3.11.4</td>
</tr>
<tr>
<td>GCC</td>
<td>7.2.0</td>
</tr>
<tr>
<td>git</td>
<td>1.8.3.1</td>
</tr>
<tr>
<td>perl</td>
<td>5.8.8</td>
</tr>
</tbody>
</table>
<h4 id="2111-installation-of-quartus">2.1.1.1 Installation of Quartus<a class="headerlink" href="#2111-installation-of-quartus" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>Download <a href="https://www.intel.com/content/www/us/en/software-kit/746666/intel-quartus-prime-pro-edition-design-software-version-22-3-for-linux.html">Intel® Quartus® Prime Pro Edition Linux</a>.</p>
</li>
<li>
<p>After running the  Intel® Quartus® Prime Pro Edition version  23.1 installer, set the PATH environment variable to make utility <code>quartus</code>, <code>jtagconfig</code>, and <code>quartus_pgm</code> discoverable. Edit your bashrc file <code>~/.bashrc</code> to add the following line:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_MAINPATH</span><span class="o">=</span>&lt;Quartus<span class="w"> </span>install<span class="w"> </span>directory&gt;
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_MAINPATH</span>/quartus
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_HOME</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_INSTALL_DIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">IMPORT_IP_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/../ipexport
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nb">export</span><span class="w"> </span><span class="nv">IP_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/../ip
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nb">export</span><span class="w"> </span><span class="nv">INTELFPGAOCLSDKROOT</span><span class="o">=</span><span class="nv">$QUARTUS_MAINPATH</span>/hld
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QSYS_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_MAINPATH</span>/qsys/bin
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$QUARTUS_ROOTDIR</span>/bin
</code></pre></div>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_MAINPATH</span><span class="o">=</span>/home/&lt;mylocaluser&gt;/intelFPGA_pro/23.1
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_MAINPATH</span>/quartus
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_HOME</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_INSTALL_DIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">IMPORT_IP_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/../ipexport
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="nb">export</span><span class="w"> </span><span class="nv">IP_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/../ip
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="nb">export</span><span class="w"> </span><span class="nv">INTELFPGAOCLSDKROOT</span><span class="o">=</span><span class="nv">$QUARTUS_MAINPATH</span>/hld
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QSYS_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_MAINPATH</span>/qsys/bin
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/home/intelFPGA_pro/23.1/quartus/bin
</code></pre></div>
<ol>
<li>Verify that  Intel® Quartus® Prime Pro Edition is discoverable by opening a new shell:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>$<span class="w"> </span>which<span class="w"> </span>quartus
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>/home/&lt;mylocaluser&gt;/intelFPGA_pro/23.1/quartus/bin/quartus
</code></pre></div>
<blockquote>
<p><strong><em>NOTE:</em></strong>  </p>
<p>Ensure your proxy is set up if you use an intranet network.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">no_proxy</span><span class="o">=</span>&lt;yourproxy&gt;
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">http_proxy</span><span class="o">=</span>&lt;yourproxy&gt;
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">https_proxy</span><span class="o">=</span>&lt;yourproxy&gt;
</code></pre></div>
</p>
</blockquote>
<hr />
<p><strong>Useful resources</strong></p>
<p><a href="https://www.intel.com/content/www/us/en/support/programmable/licensing/quartus-licenses.html">Intel® FPGA Software Licenses</a> \
<a href="https://www.intel.com/content/www/us/en/docs/programmable/683472/22-3/introduction-to-fpga-software-installation.html">Intel® FPGA Software Installation and Licensing manual</a> </p>
<p>Cloning the repo using the HTTPS method requires a personal access token. Please see this blog post for information about obtaining a personal access token, <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">Github Creating a personal access token</a>.</p>
<hr />
<blockquote>
<p><strong><em>Console Output:</em></strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>quartus_syn<span class="w"> </span>--version
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>Quartus<span class="w"> </span>Prime<span class="w"> </span>Synthesis
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>Version<span class="w"> </span><span class="m">23</span>.1.0<span class="w"> </span>Build<span class="w"> </span><span class="m">104</span><span class="w"> </span><span class="m">09</span>/14/2022<span class="w"> </span>SC<span class="w"> </span>Pro<span class="w"> </span>Edition
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>Copyright<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="m">2022</span><span class="w">  </span>Intel<span class="w"> </span>Corporation.<span class="w"> </span>All<span class="w"> </span>rights<span class="w"> </span>reserved.
</code></pre></div>
</p>
</blockquote>
<h4 id="2112-install-ofs">2.1.1.2. Install <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr><a class="headerlink" href="#2112-install-ofs" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>Retrieve <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repositories:</p>
<p>The Intel® <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> source code is included in the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> GitHub repository. First, create a new directory to store the retrieved files as a clean starting point. The following is a short description of each repository, followed by the git commands for cloning. The instructions section uses the HTTPS git method for cloning repositories.  </p>
</li>
<li>
<p>Navigate to the location for storage of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> source, create the top-level source directory, and clone <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repositories.</p>
</li>
</ol>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>mkdir<span class="w"> </span>ofs_fim_build_root
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nb">cd</span><span class="w"> </span>ofs_fim_build_root
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_BUILD_ROOT</span><span class="o">=</span><span class="nv">$PWD</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>git<span class="w"> </span>clone<span class="w"> </span>--recurse-submodules<span class="w">  </span>https://github.com/OFS/ofs-d5005.git
</code></pre></div></p>
<blockquote>
<p><strong><em>Console Output:</em></strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>Cloning<span class="w"> </span>into<span class="w"> </span><span class="s1">&#39;ofs-d5005&#39;</span><span class="w"> </span>...
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>Username<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;https://github.com&#39;</span>:<span class="w"> </span><span class="s">&lt;&lt;Enter your git hub username&gt;&gt;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="s">Password for &#39;https://&lt;&lt;Your username&gt;&gt;&#39;: &lt;&lt;Enter</span><span class="w"> </span>your<span class="w"> </span>personal<span class="w"> </span>access<span class="w"> </span>token&gt;&gt;
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>remote:<span class="w"> </span>Enumerating<span class="w"> </span>objects:<span class="w">  </span>....
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>...
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>...
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>Resolving<span class="w"> </span>deltas<span class="w">  </span>...,<span class="w"> </span><span class="k">done</span>.
</code></pre></div>
</p>
</blockquote>
<p>Edit your bashrc file ~/.bashrc to add the following lines:
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_ROOTDIR</span><span class="o">=</span><span class="nv">$OFS_BUILD_ROOT</span>/ofs-d5005
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">WORKDIR</span><span class="o">=</span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">VERDIR</span><span class="o">=</span><span class="nv">$OFS_ROOTDIR</span>/verification
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nb">cd</span><span class="w"> </span>ofs-d5005
</code></pre></div></p>
<p>Select the latest <a href="https://github.com/OFS/ofs-d5005/releases/"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Release</a>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>git<span class="w"> </span>checkout<span class="w"> </span>tags/ofs-2023.1
</code></pre></div></p>
<blockquote>
<p><strong><em>Console Output:</em></strong><br />
```sh
You are in 'detached HEAD' state. You can look around, make experimental changes and commit them, and you can discard any commits you make in this state without impacting any branches by performing another checkout.</p>
<p>If you want to create a new branch to retain commits you create, you may do so (now or later) by using -b with the checkout command again. Example:</p>
<p>git checkout -b <new-branch-name>
HEAD is now at 7e4dc70 ofs-2023.1</p>
</blockquote>
<h4 id="2113-directory-structure-of-ofs">2.1.1.3. Directory Structure of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr><a class="headerlink" href="#2113-directory-structure-of-ofs" title="Permanent link">&para;</a></h4>
<p>Verify the following directories in the $OFS_BUILD_ROOT directory with the following command.  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">cd</span><span class="w">  </span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>ls
</code></pre></div>
<blockquote>
<p><strong><em>Console Output:</em></strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="w"> </span>eval_scripts<span class="w"> </span>ipss<span class="w"> </span>ofs-common<span class="w"> </span>license<span class="w">  </span>LICENSE.md<span class="w">  </span>README.md<span class="w">  </span>sim<span class="w">  </span>src<span class="w">  </span>syn<span class="w">  </span>verification
</code></pre></div>
</p>
</blockquote>
<p>The directories are arranged as shown below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>├──<span class="w"> </span>eval_scripts
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>│<span class="w">   </span>├──<span class="w"> </span>ofs_d5005_eval.sh
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>│<span class="w">   </span>├──<span class="w"> </span>README_ofs_d5005_eval.txt
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="p">|</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>├──<span class="w"> </span>ofs-common
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>│<span class="w">   </span>├──<span class="w"> </span>scripts
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>│<span class="w">   </span>├──<span class="w"> </span>src
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>│<span class="w">   </span>├──<span class="w"> </span>verification
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="p">|</span><span class="w">   </span>├──<span class="w"> </span>LICENSE.txt<span class="w">   </span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>│<span class="w">   </span>└──<span class="w"> </span>README.md
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>├──<span class="w"> </span>ipss<span class="w">        </span>**Directory<span class="w"> </span>ipss<span class="w"> </span>consists<span class="w"> </span>of<span class="w"> </span>Platform<span class="w"> </span>Designer<span class="w"> </span>subsystems<span class="w"> </span>used<span class="w"> </span><span class="k">in</span><span class="w"> </span>FIM**
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>│<span class="w">   </span>├──<span class="w"> </span>hssi
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>│<span class="w">   </span>├──<span class="w"> </span>mem
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>│<span class="w">   </span>├──<span class="w"> </span>pcie
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="p">|</span><span class="w">   </span>├──<span class="w"> </span>pmic<span class="w"> </span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="p">|</span><span class="w">   </span>├──<span class="w"> </span>spi<span class="w">  </span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>│<span class="w">   </span>└──<span class="w"> </span>README.md
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>├──<span class="w"> </span>license
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>│<span class="w">   </span>└──<span class="w"> </span>quartus-0.0-0.01iofs-linux.run<span class="w">    </span>**<span class="w"> </span>Quartus<span class="w"> </span>Patch<span class="w"> </span>with<span class="w"> </span>IP<span class="w"> </span>licenses.<span class="w">  </span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>│<span class="w">                                         </span>**<span class="w"> </span>Note,<span class="w"> </span>these<span class="w"> </span>licenses<span class="w"> </span>are<span class="w"> </span>not<span class="w"> </span>used<span class="w"> </span><span class="k">for</span><span class="w"> </span>Intel®<span class="w"> </span>FPGA<span class="w"> </span>PAC<span class="w"> </span>D5005**<span class="w"> </span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>├──<span class="w"> </span>sim<span class="w">             </span>**Unit<span class="w"> </span>level<span class="w"> </span>simulation<span class="w"> </span>files**
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>│<span class="w">   </span>├──<span class="w"> </span>unit_test
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>│<span class="w">   </span>├──<span class="w"> </span>scripts
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>│<span class="w">   </span>├──<span class="w"> </span>bfm
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>│<span class="w">   </span>├──<span class="w"> </span>rp_bfm<span class="w">   </span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>│<span class="w">   </span>└──<span class="w"> </span>readme.txt<span class="w">     </span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>│<span class="w">    </span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>├──<span class="w"> </span>LICENSE.txt
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>├──<span class="w"> </span>README.md
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="p">|</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>├──<span class="w"> </span>src<span class="w">             </span>**Source<span class="w"> </span>RTL<span class="w"> </span>files**
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>│<span class="w">   </span>├──<span class="w"> </span>afu_top
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>│<span class="w">   </span>├──<span class="w"> </span>includes
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>│<span class="w">   </span>├──<span class="w"> </span>pd_qsys
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a>│<span class="w">   </span>├──<span class="w"> </span>top
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="p">|</span><span class="w">   </span>└──<span class="w"> </span>README.md
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a>├──<span class="w"> </span>external
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>│<span class="w">   </span>└──<span class="w"> </span>ofs-platform-afu-bbb
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a><span class="p">|</span>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>├──<span class="w"> </span>syn<span class="w">              </span>**Quartus<span class="w"> </span>compilation<span class="w"> </span>settings**
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>│<span class="w">   </span>├──<span class="w"> </span>scripts
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a>│<span class="w">   </span>├──<span class="w"> </span>setup
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a>│<span class="w">   </span>├──<span class="w"> </span>syn_top
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a>│<span class="w">   </span>├──<span class="w"> </span>readme.txt
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>│<span class="w">   </span>└──<span class="w"> </span>README
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>├──<span class="w"> </span>eval_scripts
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>│<span class="w">   </span>├──<span class="w"> </span>ofs_d5005_eval.sh
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>│<span class="w">   </span>├──<span class="w"> </span>README_ofs_d5005_eval.txt
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="p">|</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>├──<span class="w"> </span>ofs-common
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>│<span class="w">   </span>├──<span class="w"> </span>scripts
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>│<span class="w">   </span>├──<span class="w"> </span>src
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>│<span class="w">   </span>├──<span class="w"> </span>verification
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="p">|</span><span class="w">   </span>├──<span class="w"> </span>LICENSE.txt<span class="w">   </span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>│<span class="w">   </span>└──<span class="w"> </span>README.md
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>├──<span class="w"> </span>ipss<span class="w">        </span>**Directory<span class="w"> </span>ipss<span class="w"> </span>consists<span class="w"> </span>of<span class="w"> </span>Platform<span class="w"> </span>Designer<span class="w"> </span>subsystems<span class="w"> </span>used<span class="w"> </span><span class="k">in</span><span class="w"> </span>FIM**
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>│<span class="w">   </span>├──<span class="w"> </span>hssi
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>│<span class="w">   </span>├──<span class="w"> </span>mem
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>│<span class="w">   </span>├──<span class="w"> </span>pcie
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="p">|</span><span class="w">   </span>├──<span class="w"> </span>pmic<span class="w"> </span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="p">|</span><span class="w">   </span>├──<span class="w"> </span>spi<span class="w">  </span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>│<span class="w">   </span>└──<span class="w"> </span>README.md
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>├──<span class="w"> </span>license
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>│<span class="w">   </span>└──<span class="w"> </span>quartus-0.0-0.01iofs-linux.run<span class="w">    </span>**<span class="w"> </span>Quartus<span class="w"> </span>Patch<span class="w"> </span>with<span class="w"> </span>IP<span class="w"> </span>licenses.<span class="w">  </span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>│<span class="w">                                         </span>**<span class="w"> </span>Note,<span class="w"> </span>these<span class="w"> </span>licenses<span class="w"> </span>are<span class="w"> </span>not<span class="w"> </span>used<span class="w"> </span><span class="k">for</span><span class="w"> </span>Intel®<span class="w"> </span>FPGA<span class="w"> </span>PAC<span class="w"> </span>D5005**<span class="w"> </span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>├──<span class="w"> </span>sim<span class="w">             </span>**Unit<span class="w"> </span>level<span class="w"> </span>simulation<span class="w"> </span>files**
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>│<span class="w">   </span>├──<span class="w"> </span>unit_test
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>│<span class="w">   </span>├──<span class="w"> </span>scripts
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>│<span class="w">   </span>├──<span class="w"> </span>bfm
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>│<span class="w">   </span>├──<span class="w"> </span>rp_bfm<span class="w">   </span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>│<span class="w">   </span>└──<span class="w"> </span>readme.txt<span class="w">     </span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>│<span class="w">    </span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>├──<span class="w"> </span>LICENSE.txt
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>├──<span class="w"> </span>README.md
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="p">|</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>├──<span class="w"> </span>src<span class="w">             </span>**Source<span class="w"> </span>RTL<span class="w"> </span>files**
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>│<span class="w">   </span>├──<span class="w"> </span>afu_top
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>│<span class="w">   </span>├──<span class="w"> </span>includes
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>│<span class="w">   </span>├──<span class="w"> </span>pd_qsys
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>│<span class="w">   </span>├──<span class="w"> </span>top
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="p">|</span><span class="w">   </span>└──<span class="w"> </span>README.md
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>├──<span class="w"> </span>external
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a>│<span class="w">   </span>└──<span class="w"> </span>ofs-platform-afu-bbb
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="p">|</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a>├──<span class="w"> </span>verification<span class="w">     </span>**Top<span class="w"> </span>level<span class="w"> </span>UVM<span class="w"> </span>simulation<span class="w"> </span>files**
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a>│<span class="w">   </span>├──<span class="w"> </span>scripts
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a>│<span class="w">   </span>├──<span class="w"> </span>README.d5005
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a>│<span class="w">   </span>└──<span class="w"> </span>regress_d5005.pl
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a>├──<span class="w"> </span>syn<span class="w">              </span>**Quartus<span class="w"> </span>compilation<span class="w"> </span>settings**
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>│<span class="w">   </span>├──<span class="w"> </span>scripts
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a>│<span class="w">   </span>├──<span class="w"> </span>setup
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a>│<span class="w">   </span>├──<span class="w"> </span>syn_top
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a>│<span class="w">   </span>├──<span class="w"> </span>readme.txt
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a>│<span class="w">   </span>└──<span class="w"> </span>README
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a>--&gt;
</code></pre></div>
<h4 id="2114-license-installation-for-ofs">2.1.1.4 License Installation for <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr><a class="headerlink" href="#2114-license-installation-for-ofs" title="Permanent link">&para;</a></h4>
<p>The required setup Intel® <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <a href="https://github.com/OFS/ofs-d5005/blob/release/1.0.x/license/quartus-0.0-0.01iofs-linux.run">License quartus-0.0-0.01iofs-linux.run</a>, follow the following steps :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/license
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>chmod<span class="w"> </span>+x<span class="w"> </span>quartus-0.0-0.01iofs-linux.run
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>sudo<span class="w"> </span>./quartus-0.0-0.01iofs-linux.run
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c1"># Confirm the license instaltion using below command.</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>quartus_syn<span class="w"> </span>--version
</code></pre></div>
<h4 id="2115-retrieve-pim-files">2.1.1.5. Retrieve <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Files<a class="headerlink" href="#2115-retrieve-pim-files" title="Permanent link">&para;</a></h4>
<p>The ofs-platform-afu-bbb repository contains the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> files and example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that can be used for testing and demonstration purposes. This guide will use the host_chan_mmio example in the remaining sections to demonstrate <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> capabilities.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/OFS/ofs-platform-afu-bbb.git
</code></pre></div>
Edit your bashrc file ~/.bashrc to add the following lines:
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_PLATFORM_AFU_BBB</span><span class="o">=</span><span class="nv">$OFS_BUILD_ROOT</span>/ofs-platform-afu-bbb
</code></pre></div></p>
<p>Verify the following directories are present in $OFS_BUILD_ROOT directory.
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>ls
</code></pre></div></p>
<blockquote>
<p><strong><em>Console Output:</em></strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="w"> </span>COPYING<span class="w">  </span>plat_if_develop<span class="w">  </span>plat_if_release<span class="w">  </span>plat_if_tests<span class="w">  </span>README.md
</code></pre></div>
</p>
</blockquote>
<h3 id="212-compiling-the-ofs-fim">2.1.2. Compiling the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr><a class="headerlink" href="#212-compiling-the-ofs-fim" title="Permanent link">&para;</a></h3>
<p>Intel® <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> provides a build script with the following FPGA image creation options:</p>
<ul>
<li>Flat compile, which combines the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> into one FPGA image loaded into the entire FPGA device as a static image.</li>
<li>A <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  compile that creates an FPGA image consisting of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> that is loaded into the static region of the FPGA and a default <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that is loaded into dynamic region. Additional <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may be loaded into the dynamic region using partial reconfiguration.  </li>
</ul>
<p>The build scripts included with <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> are verified to run in a bash shell. Other shells have not been tested. Each build script step will take several hours to complete. Building in Quartus GUI is not supported - you must build with the provided scripts.</p>
<p>The following sections describe how to set up the environment and build the provided <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> with a relocatable tree supporting <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> . You will use this relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  tree for all example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> simulation and compilation steps in this guide.</p>
<h4 id="2121-setting-up-required-environment-variables">2.1.2.1. Setting Up Required Environment Variables<a class="headerlink" href="#2121-setting-up-required-environment-variables" title="Permanent link">&para;</a></h4>
<p>Set required environment variables as shown below. These environment variables must be set before simulation or compilation tasks, so creating a simple script to set these variables saves time.</p>
<p>Edit your bashrc file ~/.bashrc to add the following lines:
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_SDK_REPO_BRANCH</span><span class="o">=</span>release/2.5.0
</code></pre></div></p>
<blockquote>
<p><strong><em>Check point :</em></strong><br />
Ensure you file ~/.bashrc have all the following lines:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_MAINPATH</span><span class="o">=</span>&lt;Quartus<span class="w"> </span>install<span class="w"> </span>directory&gt;
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_MAINPATH</span>/quartus
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_HOME</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_INSTALL_DIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">IMPORT_IP_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/../ipexport
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="nb">export</span><span class="w"> </span><span class="nv">IP_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/../ip
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="nb">export</span><span class="w"> </span><span class="nv">INTELFPGAOCLSDKROOT</span><span class="o">=</span><span class="nv">$QUARTUS_MAINPATH</span>/hld
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QSYS_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_MAINPATH</span>/qsys/bin
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$QUARTUS_ROOTDIR</span>/bin
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_BUILD_ROOT</span><span class="o">=</span>&lt;root<span class="w"> </span>location&gt;<span class="w"> </span>**<span class="w"> </span>Here<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>located<span class="w"> </span>your<span class="w"> </span>ofs-d5005<span class="w"> </span>and<span class="w"> </span>ofs-platform-afu-bbb
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_ROOTDIR</span><span class="o">=</span><span class="nv">$OFS_BUILD_ROOT</span>/ofs-d5005
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="nb">export</span><span class="w"> </span><span class="nv">WORKDIR</span><span class="o">=</span><span class="nv">$OFS_ROOTDIR</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="nb">export</span><span class="w"> </span><span class="nv">VERDIR</span><span class="o">=</span><span class="nv">$OFS_ROOTDIR</span>/verification
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_PLATFORM_AFU_BBB</span><span class="o">=</span><span class="nv">$OFS_BUILD_ROOT</span>/ofs-platform-afu-bbb
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_SDK_REPO_BRANCH</span><span class="o">=</span>release/2.5.0
</code></pre></div>
</p>
</blockquote>
<h4 id="2122-compiling-your-base-fim">2.1.2.2. Compiling Your Base <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr><a class="headerlink" href="#2122-compiling-your-base-fim" title="Permanent link">&para;</a></h4>
<p>The usage of the compile build script is shown below:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>ofs-common/scripts/common/syn/build_top.sh [-p] target_configuration work_dir 
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>      * target_configuration - Specifies the project  
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>         For example: d5005
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>      * work_dir - Work Directory for this build in the form a directory name. It is created in the &lt;local repo directory&gt;/ofs-d5005/&lt;work_dir&gt; 
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>          - NOTE: The directory name must start with &quot;work&quot;. If the working directory exists, the script stops and asks if you want to overwrite the directory.
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>            - e.g.
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>                - ofs-common/scripts/common/syn/build_top.sh d5005 work_d5005
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>                work directory as a name will be created in &lt;local repo directory&gt;/ofs-d5005/work_d5005
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>                The obmission of &lt;work_dir&gt; results in a default work directory (&lt;local repo  directory&gt;/ofs-d5005/work)
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>        - compile reports and artifacts (.rpt, .sof, etc) are stored in &lt;work_dir&gt;/syn/&lt;OFS_PROJECT&gt;/&lt;OFS_FIM&gt;/&lt;OFS_BOARD&gt;/syn_top/output_files
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>        - There is a log file created in ofs-d5005 directory.  
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>        - [-p]  Optional switch for creating a relocatable PR  build tree supporting the creation of a PR -able AFU workload.   
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>        The &quot;-p&quot; switch invokes generate_pr_release.sh at the end of the FIM build and writes the PR  build tree to the top of the working directory. More information on this option is provided below. 
</code></pre></div>
In the following example, you will build the provided example design using a flat, non-<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  build flow. If you use the -p, you could avoid the section.</p>
<h4 id="21221-relocatable-pr-directory-tree">2.1.2.2.1. Relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Directory Tree.<a class="headerlink" href="#21221-relocatable-pr-directory-tree" title="Permanent link">&para;</a></h4>
<p>Build the provided base example design:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>ofs-common/scripts/common/syn/build_top.sh<span class="w"> </span>d5005<span class="w"> </span>work_d5005
</code></pre></div></p>
<blockquote>
<p><strong><em>Console Output:</em></strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="w">    </span>...<span class="w"> </span>build<span class="w"> </span>takes<span class="w"> </span>~5<span class="w"> </span>hours<span class="w"> </span>to<span class="w"> </span><span class="nb">complete</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>Compile<span class="w"> </span>work<span class="w"> </span>directory:<span class="w">     </span>&lt;<span class="nv">$OFS_BUILD_ROOT</span>&gt;/work_d5005/syn/syn_top
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>Compile<span class="w"> </span>artifact<span class="w"> </span>directory:<span class="w"> </span>&lt;<span class="nv">$OFS_BUILD_ROOT</span>&gt;/work_d5005/syn/syn_top/output_files
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>***********************************
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>***
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>***<span class="w">        </span>OFS_PROJECT:<span class="w"> </span>d5005
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>***<span class="w">        </span>Q_PROJECT:<span class="w">  </span>d5005
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>***<span class="w">        </span>Q_REVISION:<span class="w"> </span>d5005
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>***<span class="w">        </span>SEED:<span class="w"> </span><span class="m">03</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>***<span class="w">        </span>Build<span class="w"> </span>Complete
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>***<span class="w">        </span>Timing<span class="w"> </span>Passed!
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>***
</code></pre></div>
</p>
<p><strong><em>Pro Tip:</em></strong><br />
if the timing report fails, try to go into the iofs_pr_afu.qsf and modify the seed number from 3 to 4, it will create multiple seed/starting points of your design to find the best timing/fit.
<code>/home/&lt;myuser&gt;/&lt;mainfolderforOFS&gt;/ofs-d5005/work_d5005/syn/syn_top/iofs_pr_afu.qsf</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>set_global_assignment<span class="w"> </span>-name<span class="w"> </span>SEED<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1">#0-4</span>
</code></pre></div>
</p>
</blockquote>
<p>The build script copies the ipss, sim, src, and syn directories to the specified work directory, and then these copied files are used in the Quartus compilation process. Therefore, do not edit the files in the work directory; these files are copies of source files.</p>
<p>Some of the critical output files are described below:</p>
<p>$OFS_ROOTDIR/<work_dir "work_d5005">/syn/syn_top</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>├── syn_top                    //Intel® FPGA PAC D5005 Quartus build area with Quartus files used this build
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>│  ├── d5005.ipregen.rpt       // IP regeneration report states the output of IP upgrade
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>│  ├── d5005.qpf               // Quartus Project File (qpf) mentions about Quartus version and project revision
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>│  ├── d5005.qsf               // Quartus Settings File (qsf) lists current project settings and entity level assignments
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>│  ├── d5005.stp               // Signal Tap file included in the d5005.qsf. This file can be modified as required
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>│  ├── fme_id.mif              // the fme id hex value is stored in a mif file format
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>│  ├── iofs_pr_afu.json        // PR JSON file
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>│  ├── iofs_pr_afu.qsf                // PR AFU qsf file
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>│  ├── iofs_pr_afu_sources.tcl        // AFU source file list
</code></pre></div>
<p>$OFS_ROOTDIR/<work_dir>/syn/syn_top/output_files == Directory with build reports and FPGA programming files.</p>
<p>The programming files consist of the Quartus generated d5005.sof and d5005.pof. The Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 board hardware provides a 2 Gb flash device to store the FPGA programming files and a <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> CARD that reads this flash and programs the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 Intel® Stratix 10® FPGA. The ./ofs-common/scripts/common/syn/build_top.sh script runs script file ./ofs-common/scripts/common/syn/build_top.sh which takes the Quartus generated d5005.sof and creates binary files in the proper format to be loaded into the 2 Gb flash device.  You can also run build_flash.sh by itself if needed. </p>
<p>The build script will run PACSign and create an unsigned FPGA programming file for both user1 and user2 locations of the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 flash. Please note, if the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 has the root entry hash key loaded, then PACsign must be run to add the proper key to the FPGA binary file. Please see <a href="https://github.com/otcshare/intel-ofs-docs/blob/main/d5005/user_guides/%20ug_security_ofs_d5005/ug-pac-security-d5005.md">Security User Guide: Intel® Open FPGA Stack for Intel® Stratix 10® FPGA</a> for details on the security aspects of Intel® Open FPGA Stack and refer to <a href="https://github.com/otcshare/intel-ofs-docs/blob/main/d5005/user_guides/%20ug_security_ofs_d5005/ug-pac-security-d5005.md"><abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> User Guide</a> for Flash partition.</p>
<p>The following table provides further detail on the generated bin files.</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>d5005.sof</td>
<td>This is the Quartus generated programming file created by Quartus synthesis and place and route. This file can be used to program the FPGA using a <span title='Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.'><strong><abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr></strong> </span> programmer. This file is the source file for the binary files used to program the FPGA flash.</td>
</tr>
<tr>
<td>d5005.bin</td>
<td>This is an intermediate raw binary image of the FPGA</td>
</tr>
<tr>
<td>d5005_page1.bin</td>
<td>This is the binary file created from the input file, d5005.sof. This file is used as the input file to the PACSign utility to generate <strong>d5005_page1_unsigned.bin</strong> binary image file.</td>
</tr>
<tr>
<td>d5005_page1_unsigned.bin</td>
<td>This is the unsigned PACSign output which can be programmed into the FPGA flash of an unsigned Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 using the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> utility <strong>fpgasupdate</strong></td>
</tr>
<tr>
<td>mfg_d5005_reversed.bin</td>
<td>A particular programming file for a third-party device used in board manufacturing. This file is typically not used.</td>
</tr>
</tbody>
</table>
<p>build/output_files/timing_report == Directory containing clocks report, failing paths and passing margin reports</p>
<h3 id="213-relocatable-pr-directory-tree">2.1.3. Relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Directory Tree<a class="headerlink" href="#213-relocatable-pr-directory-tree" title="Permanent link">&para;</a></h3>
<p>If you are developing <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> to be used by another team developing the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> workload, scripts are provided that create a relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  directory tree. ODM and board developers will use this capability to enable a broad set of <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to be loaded on a board using <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> . The relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  directory contains the Quartus *.qdb file that goes the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.</p>
<p>Creating the relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  directory tree requires a clone of the Intel® Basic Building Blocks (<abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr>) repository. The OFS_PLATFORM_AFU_BBB environment variable must point to the repository, for example.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/OFS/ofs-platform-afu-bbb.git
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>
</code></pre></div></p>
<p>You can create this relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  directory tree by either:</p>
<ul>
<li>Build <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using ofs-common/scripts/common/syn/build_top.sh followed by running /syn/common/scripts/generate_pr_release.sh (section 2.1.3. Relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Directory Tree)</li>
<li>Build <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using ofs-common/scripts/common/syn/build_top.sh with optional -p switch included</li>
</ul>
<p>The generate_pr_release.sh has the following command structure:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>ofs-common/scripts/common/syn/generate_pr_release.sh -t &lt;path to generated release tree&gt; *Board Build Target* &lt;work dir from build_top.sh&gt;
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>Where:
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>-t &lt;path to generated release tree&gt; = location for your relocatable PR  directory tree
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>*Board Build Target* is the name of the board target/FIM e.g. d5005
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>&lt;work dir from build_top.sh&gt; 
</code></pre></div>
Here is an example of running the generate_pr_release.sh script in <em>user mode</em>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>ofs-common/scripts/common/syn/generate_pr_release.sh<span class="w"> </span>-t<span class="w"> </span>work_d5005/build_tree<span class="w"> </span>d5005<span class="w">  </span>work_d5005
</code></pre></div>
<blockquote>
<p><strong><em>Console Output:</em></strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>**********************************
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>*********<span class="w"> </span>ENV<span class="w"> </span>SETUP<span class="w"> </span>**************
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>FIM<span class="w"> </span>Project:
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">  </span><span class="nv">OFS_PROJECT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>d5005
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">  </span><span class="nv">OFS_FIM</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>.
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">  </span><span class="nv">OFS_BOARD</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>.
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">  </span><span class="nv">Q_PROJECT</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>d5005
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">  </span><span class="nv">Q_REVISION</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>d5005
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">  </span>Fitter<span class="w"> </span><span class="nv">SEED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">03</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>FME<span class="w"> </span>id
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="w">  </span><span class="nv">BITSTREAM_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>040100022c164db1
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="w">  </span><span class="nv">BITSTREAM_MD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0000000002212053</span>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>...
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>...
</code></pre></div>
</p>
</blockquote>
<p>The resulting relocatable build tree has the following structure:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>.
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>├──<span class="w"> </span>bin
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>│<span class="w">   </span>├──<span class="w"> </span>afu_synth
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>│<span class="w">   </span>├──<span class="w"> </span>build_env_config
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>│<span class="w">   </span>├──<span class="w"> </span>run.sh<span class="w"> </span>-&gt;<span class="w"> </span>afu_synth
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>│<span class="w">   </span>└──<span class="w"> </span>update_pim
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>├──<span class="w"> </span>hw
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>│<span class="w">   </span>├──<span class="w"> </span>blue_bits
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>d5005_page1_unsigned.bin
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>d5005.sof<span class="w"> </span>-&gt;<span class="w"> </span>../lib/build/syn/syn_top/<span class="w">   </span>output_files/d5005.sof
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>│<span class="w">   </span>└──<span class="w"> </span>lib
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>│<span class="w">       </span>├──<span class="w"> </span>build
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>│<span class="w">       </span>├──<span class="w"> </span>fme-ifc-id.txt
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>│<span class="w">       </span>├──<span class="w"> </span>fme-platform-class.txt
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a>│<span class="w">       </span>└──<span class="w"> </span>platform
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a>├──<span class="w"> </span>README
</code></pre></div>
<p>Edit your bashrc file ~/.bashrc to add the following line:
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_PLATFORM_ROOT</span><span class="o">=</span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/build_tree
</code></pre></div></p>
<h3 id="214-programing-the-fim">2.1.4. Programing the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr><a class="headerlink" href="#214-programing-the-fim" title="Permanent link">&para;</a></h3>
<ol>
<li>Run the following command to find the PCIe address for your card.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>sudo<span class="w"> </span>fpgainfo<span class="w"> </span>fme
</code></pre></div>
<blockquote>
<p><strong><em>Console Output:</em></strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>Board<span class="w"> </span>Management<span class="w"> </span>Controller,<span class="w"> </span>MAX10<span class="w"> </span>NIOS<span class="w"> </span>FW<span class="w"> </span>version:<span class="w"> </span><span class="m">2</span>.0.13
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>Board<span class="w"> </span>Management<span class="w"> </span>Controller,<span class="w"> </span>MAX10<span class="w"> </span>Build<span class="w"> </span>version:<span class="w"> </span><span class="m">2</span>.0.8
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>//******<span class="w"> </span>FME<span class="w"> </span>******//
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xF000000
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:3B:00.0
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>Ports<span class="w"> </span>Num<span class="w">                        </span>:<span class="w"> </span><span class="m">01</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>Bitstream<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span><span class="m">288511862659474365</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>Bitstream<span class="w"> </span>Version<span class="w">                </span>:<span class="w"> </span><span class="m">4</span>.0.1
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>Pr<span class="w"> </span>Interface<span class="w"> </span>Id<span class="w">                  </span>:<span class="w"> </span>2b5c1c35-9ec4-54ec-8835-94ce6b6c3461
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>Boot<span class="w"> </span>Page<span class="w">                        </span>:<span class="w"> </span>user
</code></pre></div>
</p>
</blockquote>
<h4 id="2141-load-fim-into-the-flash-of-the-intel-fpga-pac-d5005">2.1.4.1. Load <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> into the Flash of the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005<a class="headerlink" href="#2141-load-fim-into-the-flash-of-the-intel-fpga-pac-d5005" title="Permanent link">&para;</a></h4>
<p>The base <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> used in <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> compilation must be loaded on the board. In this step, you will load the generated <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> binary into the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 FPGA flash. By performing this step, subsequent <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developed in this guide will use this base <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and allow your newly created <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to match the base <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> loaded on the board.</p>
<p>More information related to fpgaupdate is located <a href="https://ofs.github.io/hw/d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Getting Started User Guide</a>.</p>
<p>Run fpgasupdate to load the image into the user location of the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 FPGA flash and the <span title='Remote System Update, A Remote System Update operation sends an instruction to the Intel® FPGA PAC D5005 that triggers a power cycle of the card only, forcing reconfiguration.'><strong><abbr title="Remote System Update, A Remote System Update operation sends an instruction to the Intel FPGA PAC D5005 device that triggers a power cycle of the card only, forcing reconfiguration.">RSU</abbr></strong> </span> command to reboot the PCIE Card:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>sudo<span class="w"> </span>fpgasupdate<span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/syn/syn_top/output_files/d5005_page1_unsigned.bin<span class="w"> </span>3b:00.0
</code></pre></div>
Run rsu command to re-configure FPGA on Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005.
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>sudo<span class="w"> </span>rsu<span class="w"> </span>bmcimg<span class="w"> </span>3b:00.0
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>sudo<span class="w"> </span>fpgainfo<span class="w"> </span>fme
</code></pre></div>
<blockquote>
<p><strong><em>Console Output:</em></strong><br />
```sh</p>
<p>Board Management Controller, MAX10 NIOS FW version: 2.0.13
Board Management Controller, MAX10 Build version: 2.0.8
//****** <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> ******//
Object Id                        : 0xF000000
PCIe s:b:d.f                     : 0000:3b:00.0
Device Id                        : 0xBCCE
Socket Id                        : 0x00
Ports Num                        : 01
Bitstream Id                     : 288511862659474365
Bitstream Version                : 4.0.1
Pr Interface Id                  : 2b5c1c35-9ec4-54ec-8835-94ce6b6c3461
Boot Page                        : user
</p>
</blockquote>
<h1 id="30-opae-software-development-kit">3.0 OPAE Software Development Kit<a class="headerlink" href="#30-opae-software-development-kit" title="Permanent link">&para;</a></h1>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> software stack sits in user space on top of the Intel® <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> kernel drivers. It is a common software infrastructure layer that simplifies and streamlines the integration of programmable accelerators such as FPGAs into software applications and environments. OPAE consists of a set of drivers, user-space libraries, and tools to discover, enumerate, share, query, access, manipulate, and re-configure programmable accelerators. OPAE is designed to support a layered, common programming model across different platforms and devices. To learn more about OPAE, its documentation, code samples, an explanation of the available tools, and an overview of the software architecture, please visit the <a href="https://opae.github.io/latest/docs/fpga_tools/opae.io/opae.io.html">OPAE.io</a> page.</p>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> source code is contained within a single GitHub repository
hosted at the <a href="https://github.com/OFS/opae-sdk">OPAE GitHub</a>. This repository is open source and should not require any permissions to access.</p>
<h3 id="31-opae-sdk-build-environment-setup">3.1 <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> Build Environment Setup<a class="headerlink" href="#31-opae-sdk-build-environment-setup" title="Permanent link">&para;</a></h3>
<p>This installation process assumes the user has access to an internet connection to pull specific GitHub repositories and satisfy package dependencies. If an offline install process is required, please reach out to your Intel® representative.</p>
<p><strong>1.</strong> Before <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> installation, the user must remove any prior OPAE frameworks. To remove these packages:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>remove<span class="w"> </span>opae*
</code></pre></div>
<p><strong>2.</strong> The user must enable the following repository changes in order to install all dependencies on CentOS 8.3:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>config-manager<span class="w"> </span>--set-enabled<span class="w"> </span>powertools
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>epel-release
</code></pre></div>
<p><strong>3.</strong> The following package dependencies must be satisfied by the user. Double check that all packages have been found and installed:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>autoconf<span class="w"> </span>automake<span class="w"> </span>bison<span class="w"> </span>boost<span class="w"> </span>boost-devel<span class="w"> </span>cmake<span class="w"> </span>doxygen<span class="w"> </span>dwarves<span class="w"> </span>elfutils-libelf-devel<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>flex<span class="w"> </span>gcc<span class="w"> </span>gcc-c++<span class="w"> </span>git<span class="w"> </span>hwloc-devel<span class="w"> </span>json-c-devel<span class="w"> </span>libarchive<span class="w"> </span>libedit<span class="w"> </span>libedit-devel<span class="w"> </span>libpcap<span class="w"> </span>libpng12<span class="w"> </span>libuuid<span class="w"> </span>libuuid-devel<span class="w"> </span>libxml2<span class="w"> </span>libxml2-devel<span class="w"> </span>make<span class="w"> </span>ncurses<span class="w">  </span><span class="se">\</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>ncurses-devel<span class="w"> </span>ncurses-libs<span class="w"> </span>openssl-devel<span class="w"> </span>python2-pip<span class="w"> </span>python3-devel<span class="w"> </span>python3-jsonschema<span class="w"> </span>rsync<span class="w"> </span>tbb-devel<span class="w"> </span>libudev-devel
</code></pre></div>
<p>All steps in this installation will use a generic top-level directory at <code>$OFS_BUILD_ROOT</code>. If the user has created a different top-level directory, replace this path with the user's custom path.</p>
<p><strong>4.</strong> Initialize an empty git repository and clone the tagged <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> source code:</p>
<h3 id="32-install-opae-sdk">3.2 Install <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr><a class="headerlink" href="#32-install-opae-sdk" title="Permanent link">&para;</a></h3>
<p>Perform the following steps to install <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/OFS/opae-sdk.git
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="nb">cd</span><span class="w"> </span>opae-sdk
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>git<span class="w"> </span>checkout<span class="w"> </span>tags/2.5.0-3<span class="w"> </span>-b<span class="w"> </span>release/2.5.0
</code></pre></div>
Verify proper branch is selected</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>git<span class="w"> </span>describe
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">  </span><span class="m">2</span>.5.0-3
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>git<span class="w"> </span>branch
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">  </span>master
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">  </span>*<span class="w"> </span>release/2.5.0
</code></pre></div>
<h3 id="33-building-and-installing-the-opae-sdk">3.3 Building and Installing the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr><a class="headerlink" href="#33-building-and-installing-the-opae-sdk" title="Permanent link">&para;</a></h3>
<p><strong>1.</strong> Build the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> source code, and pack it into several local RPM packages. Building the code into packages allows for easier installation and removal. This build script can use multiple processors to parallelize the build process. Display how many processors are available with the <code>nproc</code> command, and then specify how many make threads to utilize with the -j option. Note that the number of threads can exceed the number of processors. In this case, the number of threads is set to the number of processors in the system.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/opae-sdk
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>mkdir<span class="w"> </span>install-opae-sdk
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="nb">cd</span><span class="w"> </span>install-opae-sdk
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>cmake<span class="w"> </span>..<span class="w"> </span>-DCPACK_GENERATOR<span class="o">=</span>RPM<span class="w"> </span>-DOPAE_BUILD_FPGABIST<span class="o">=</span>ON<span class="w"> </span>-DOPAE_BUILD_PYTHON_DIST<span class="o">=</span>ON<span class="w"> </span>-DCMAKE_BUILD_PREFIX<span class="o">=</span>/install-opae-sdk<span class="w"> </span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>make<span class="w"> </span>-j<span class="w"> </span><span class="sb">`</span>nproc<span class="sb">`</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>make<span class="w"> </span>-j<span class="w"> </span><span class="sb">`</span>nproc<span class="sb">`</span><span class="w"> </span>package_rpm
</code></pre></div>
<p>The <code>install-opae-sdk</code> directory location was selected for ease of use. If the user wishes to build the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> in a different location, they will need to replace the '..' in the above command with the direct or relative path to the opae-sdk repository.</p>
<p><strong>2.</strong> After a successful compile, there should be eight packages present:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/opae-sdk/install-opae-sdk
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>ls<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>rpm
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>opae-2.5.0-3.x86_64.rpm<span class="w">                                                                                                    </span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>opae-PACSign-2.5.0-3.x86_64.rpm<span class="w">                                                                                            </span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>opae-devel-2.5.0-3.x86_64.rpm<span class="w">                                                                                              </span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>opae-libs-2.5.0-3.x86_64.rpm<span class="w">                                                                                               </span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>opae-opae.admin-2.5.0-3.x86_64.rpm<span class="w">                                                                                         </span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>opae-packager-2.5.0-3.x86_64.rpm<span class="w">                                                                                           </span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>opae-tests-2.5.0-3.x86_64.rpm<span class="w">                                                                                              </span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>opae-tools-2.5.0-3.x86_64.rpm<span class="w">                                                                                              </span>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a>opae-tools-extra-2.5.0-3.x86_64.rpm
</code></pre></div>
<p><strong>3.</strong> Install the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> packages:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/opae-sdk/install-opae-sdk
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>localinstall<span class="w"> </span>-y<span class="w"> </span>opae*.rpm
</code></pre></div>
<p><strong>4.</strong> check that all packages have been installed:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>rpm<span class="w"> </span>-qa<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>opae
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>opae-devel-2.5.0-3.x86_64<span class="w">                                                                                                  </span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>opae-packager-2.5.0-3.x86_64<span class="w">                                                                                               </span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>opae-2.5.0-3.x86_64<span class="w">                                                                                                        </span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>opae-tools-2.5.0-3.x86_64<span class="w">                                                                                                  </span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>opae-PACSign-2.5.0-3.x86_64<span class="w">                                                                                                </span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>opae-tools-extra-2.5.0-3.x86_64<span class="w">                                                                                            </span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a>opae-opae.admin-2.5.0-3.x86_64<span class="w">                                                                                             </span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a>opae-tests-2.5.0-3.x86_64<span class="w">                                                                                                  </span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a>opae-libs-2.5.0-3.x86_64
</code></pre></div>
<p><strong>5.</strong> Setup required environment variables</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$OFS_BUILD_ROOT</span>/opae-sdk/install-opae-sdk/bin
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LIBRARY_PATH</span><span class="o">=</span><span class="nv">$OFS_BUILD_ROOT</span>/opae-sdk/install-opae-sdk/lib
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$OFS_BUILD_ROOT</span>/opae-sdk/install-opae-sdk/lib64
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nb">cd</span><span class="w"> </span>../lib/python*/site-packages
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$PWD</span>
</code></pre></div></p>
<h1 id="4-compiling-an-afu">4. Compiling An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr><a class="headerlink" href="#4-compiling-an-afu" title="Permanent link">&para;</a></h1>
<p>This section will use the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> build tree created in the previous steps to compile an example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. This section will continue the work with the <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.. You can perform the build steps listed below to demonstrate the ease in building and running a real example on the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005.</p>
<p>To run the steps in this section, you must complete all steps in section <a href="#2-set-up-afu-development-environment">2. Set Up <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Development Environment</a>, and ensure the <code>OPAE_PLATFORM_ROOT</code> "environment variable that points to the directory of the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  build tree generated previously. </p>
<p>Ensure your bashrc file ~/.bashrc have the following line:
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_PLATFORM_ROOT</span><span class="o">=</span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/build_tree
</code></pre></div></p>
<h2 id="41-set-afu-synthesis-environment">4.1. Set <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Synthesis Environment<a class="headerlink" href="#41-set-afu-synthesis-environment" title="Permanent link">&para;</a></h2>
<p>Here, you will create the synthesis environment to build the <code>host_chan_mmio</code> example. The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> flow includes the synthesis environment creation script <code>afu_synth_setup</code> for this task. The usage of afu_synth_setup is shown below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>usage: afu_synth_setup [-h] -s SOURCES [-p PLATFORM] [-l LIB] [-f] dst
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>Generate a Quartus build environment for an AFU. A build environment is
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>instantiated from a release and configured for the specified AFU. AFU
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>source files are specified in a text file parsed by rtl_src_config,
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>which is part of the OPAE base environment.
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>positional arguments:
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>  dst                   Target directory path (directory must not exist).
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>optional arguments:
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>  -h, --help            show this help message and exit
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>  -s SOURCES, --sources SOURCES
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a>                        AFU source specification file that will be passed to
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a>                        rtl_src_config. See &quot;rtl_src_config --help&quot; for the
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a>                        file&#39;s syntax. rtl_src_config translates the source
<a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a>                        list into either Quartus or RTL simulator syntax.
<a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a>  -p PLATFORM, --platform PLATFORM
<a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a>                        FPGA platform name.
<a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a>  -l LIB, --lib LIB     FPGA platform release hw/lib directory. If not
<a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a>                        specified, the environment variables OPAE_FPGA_HW_LIB
<a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a>                        and then BBS_LIB_PATH are checked.
<a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a>  -f, --force           Overwrite target directory if it exists.
</code></pre></div>
<p>Execute <code>afu_synth_setup</code> "as follows to create the synthesis environment for a <code>host_chan_mmio</code> "<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that fits the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> previously constructed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>afu_synth_setup<span class="w"> </span>-s<span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/hw/rtl/test_mmio_axi1.txt<span class="w"> </span>build_d5005_x16
</code></pre></div>
<p>Now, execute the <code>afu_synth</code> command that resides inside the <code>$OFS_ROOTDIR/work_d5005/build_tree/bin</code> directory, to actually build the <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/build_d5005_x16
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="nv">$OPAE_PLATFORM_ROOT</span>/bin/afu_synth
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>...
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>...
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>Wrote<span class="w"> </span>host_chan_mmio.gbs
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="o">===========================================================================</span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="w"> </span>PR<span class="w"> </span>AFU<span class="w"> </span>compilation<span class="w"> </span><span class="nb">complete</span>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="w"> </span>AFU<span class="w"> </span>gbs<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span><span class="s1">&#39;host_chan_mmio.gbs&#39;</span>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="w"> </span>Design<span class="w"> </span>meets<span class="w"> </span><span class="nv">timing</span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="o">===========================================================================</span>
</code></pre></div>
<h3 id="411-loading-and-running-the-host_chan_mmio-example-afu">4.1.1. Loading and Running the <strong>host_chan_mmio</strong> example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr><a class="headerlink" href="#411-loading-and-running-the-host_chan_mmio-example-afu" title="Permanent link">&para;</a></h3>
<p>Once the compilation completes successfully, load the new bitstream file, <code>host_chan_mmio.gbs</code>, into the partial reconfiguration region of the target Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005. Keep in mind, that the loaded image is dynamic - this image is not stored in flash, and if the card is power cycled, then the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>  region is re-loaded with the default <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>To load the image, perform the following steps:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/build_d5005_x16
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>sudo<span class="w"> </span>fpgasupdate<span class="w"> </span>host_chan_mmio.gbs<span class="w"> </span>3b:00.0
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="o">[</span>sudo<span class="o">]</span><span class="w"> </span>password<span class="w"> </span><span class="k">for</span><span class="w"> </span>&lt;&lt;Your<span class="w"> </span>username&gt;&gt;:<span class="w"> </span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="o">[</span>WARNING<span class="w"> </span><span class="o">]</span><span class="w"> </span>Update<span class="w"> </span>starting.<span class="w"> </span>Please<span class="w"> </span><span class="k">do</span><span class="w"> </span>not<span class="w"> </span>interrupt.
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="o">[</span>INFO<span class="w">    </span><span class="o">]</span><span class="w"> </span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>Partial<span class="w"> </span>Reconfiguration<span class="w"> </span>OK
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="o">[</span>INFO<span class="w">    </span><span class="o">]</span><span class="w"> </span>Total<span class="w"> </span>time:<span class="w"> </span><span class="m">0</span>:00:01.88
</code></pre></div>
<p>Determine the BDF of the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005.</p>
<p>The PCIe BDF address is initially determined when the server powers on. The user can determine the addresses of all Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 using lspci:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>lspci<span class="w"> </span>-d<span class="w"> </span>:bcce
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>3b:00.0<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
</code></pre></div>
<p>Set up your board to work with the newly loaded host_chan_mmio.gbs</p>
<ol>
<li>
<p>Create the Virtual Functions (VFs):
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>sudo<span class="w"> </span>pci_device<span class="w"> </span>3b:00.0<span class="w"> </span>vf<span class="w"> </span><span class="m">3</span>
</code></pre></div></p>
</li>
<li>
<p>Verify that all three VFs have been created.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>$<span class="w"> </span>lspci<span class="w"> </span>-s<span class="w"> </span>3b:00
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>3b:00.0<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>3b:00.1<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>3b:00.2<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>3b:00.3<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
</code></pre></div>
<ol>
<li>Bind the 3 VFs to the vfio-pci driver.</li>
</ol>
<p>sudo opae.io init -d <pcie dev id> <your username>, e.g.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:3b:00.1<span class="w"> </span>user:user
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.1<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.1<span class="w"> </span>is<span class="w"> </span><span class="m">142</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>Assigning<span class="w"> </span>/dev/vfio/142<span class="w"> </span>to<span class="w"> </span>&lt;<span class="nb">local</span><span class="w"> </span>user&gt;
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/142<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:3b:00.2<span class="w"> </span>user:user
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.2<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.2<span class="w"> </span>is<span class="w"> </span><span class="m">143</span>
<a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a>Assigning<span class="w"> </span>/dev/vfio/143<span class="w"> </span>to<span class="w"> </span>&lt;<span class="nb">local</span><span class="w"> </span>user&gt;
<a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/143<span class="w"> </span>to<span class="w"> </span>rw-rw-----
<a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a>
<a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:3b:00.3<span class="w"> </span>user:user
<a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.3<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.3<span class="w"> </span>is<span class="w"> </span><span class="m">144</span>
<a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a>Assigning<span class="w"> </span>/dev/vfio/144<span class="w"> </span>to<span class="w"> </span>&lt;<span class="nb">local</span><span class="w"> </span>user&gt;
<a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/144<span class="w"> </span>to<span class="w"> </span>rw-rw----
</code></pre></div>
<ol>
<li>Verify the new <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is loaded.  The host_chan_mmio <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> GUID is 76d7ae9c-f66b-461f-816a-5428bcebdbc5.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>$<span class="w"> </span>fpgainfo<span class="w"> </span>port
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xEF00000
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:3B:00.0
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x138D
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x603B000000000000
<a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:3B:00.3
<a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x138D
<a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>d15ab1ed-0000-0000-0210-000000000000
<a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x403B000000000000
<a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:3B:00.2
<a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-64-24" name="__codelineno-64-24" href="#__codelineno-64-24"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-64-25" name="__codelineno-64-25" href="#__codelineno-64-25"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x138D
<a id="__codelineno-64-26" name="__codelineno-64-26" href="#__codelineno-64-26"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-64-27" name="__codelineno-64-27" href="#__codelineno-64-27"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>76d7ae9c-f66b-461f-816a-5428bcebdbc5
<a id="__codelineno-64-28" name="__codelineno-64-28" href="#__codelineno-64-28"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-64-29" name="__codelineno-64-29" href="#__codelineno-64-29"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x203B000000000000
<a id="__codelineno-64-30" name="__codelineno-64-30" href="#__codelineno-64-30"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:3B:00.1
<a id="__codelineno-64-31" name="__codelineno-64-31" href="#__codelineno-64-31"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-64-32" name="__codelineno-64-32" href="#__codelineno-64-32"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-64-33" name="__codelineno-64-33" href="#__codelineno-64-33"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-64-34" name="__codelineno-64-34" href="#__codelineno-64-34"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x138D
<a id="__codelineno-64-35" name="__codelineno-64-35" href="#__codelineno-64-35"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-64-36" name="__codelineno-64-36" href="#__codelineno-64-36"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>56e203e9-864f-49a7-b94b-12284c31e02b
</code></pre></div>
<p>Run the host_chan_mmio software application to demonstrate the newly loaded <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> image. You navigate to $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/sw and compile the software application and then run.</p>
<p>If <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> libraries were not installed in the default systems directory <code>/usr/lib64/</code> ", define the OPAE_LOC environment variable to point to the directory where the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> libraries were installed.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_LOC</span><span class="o">=</span>/usr
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">LIBRARY_PATH</span><span class="o">=</span><span class="nv">$OPAE_LOC</span>/lib64:<span class="nv">$LIBRARY_PATH</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$OPAE_LOC</span>/lib64:<span class="nv">$LD_LIBRARY_PATH</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/sw
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>make<span class="w"> </span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>./host_chan_mmio
</code></pre></div></p>
<blockquote>
<p><strong><em>Console Output:</em></strong><br />
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>AFU<span class="w"> </span>ID:<span class="w">  </span>76d7ae9cf66b461f<span class="w"> </span>816a5428bcebdbc5
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>AFU<span class="w"> </span>MMIO<span class="w"> </span>interface:<span class="w"> </span>AXI<span class="w"> </span>Lite
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>AFU<span class="w"> </span>MMIO<span class="w"> </span><span class="nb">read</span><span class="w"> </span>bus<span class="w"> </span>width:<span class="w"> </span><span class="m">64</span><span class="w"> </span>bits
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="m">512</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>write<span class="w"> </span>supported:<span class="w"> </span>yes
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>AFU<span class="w"> </span>pClk<span class="w"> </span>frequency:<span class="w"> </span><span class="m">250</span><span class="w"> </span>MHz
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>Testing<span class="w"> </span><span class="m">32</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>reads:
<a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="w">  </span>PASS<span class="w"> </span>-<span class="w"> </span><span class="m">4</span><span class="w"> </span>tests
<a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>
<a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>Testing<span class="w"> </span><span class="m">32</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>writes:
<a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a><span class="w">  </span>PASS<span class="w"> </span>-<span class="w"> </span><span class="m">5</span><span class="w"> </span>tests
<a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a>
<a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a>Testing<span class="w"> </span><span class="m">64</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>writes:
<a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a><span class="w">  </span>PASS<span class="w"> </span>-<span class="w"> </span><span class="m">5</span><span class="w"> </span>tests
<a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a>
<a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a>Testing<span class="w"> </span><span class="m">512</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>writes:
<a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a><span class="w">  </span>PASS
</code></pre></div></p>
</blockquote>
<h3 id="412-loading-and-running-the-hello_world-example-afu">4.1.2. Loading and running the <strong>hello_world</strong> example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr><a class="headerlink" href="#412-loading-and-running-the-hello_world-example-afu" title="Permanent link">&para;</a></h3>
<p>The platform-independent <abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr> repository, <a href="https://github.com/OPAE/ofs-platform-afu-bbb">ofs-platform-afu-bbb</a>, also provides some interesting [example AFUs]. In this section, you will compile and execute the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>-based <code>hello_world</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The RTL of the <code>hello_world</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> receives from the host application an address via memory-mapped I/O (<abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>) write and generates a DMA write to the memory line at that address. The content written to memory is the string "Hello world!". The host application spins, waiting for the memory line to be updated. Once available, the software prints out the string.</p>
<p>The <code>hello_world</code> example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> consists of the following files. </p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>hello_world
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>├──<span class="w"> </span>hw
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>│<span class="w">   </span>└──<span class="w"> </span>rtl
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>│<span class="w">       </span>├──<span class="w"> </span>avalon
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>hello_world_avalon.sv
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_plat_afu.sv
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a>│<span class="w">       </span>│<span class="w">   </span>└──<span class="w"> </span>sources.txt
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a>│<span class="w">       </span>├──<span class="w"> </span>axi
<a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>hello_world_axi.sv
<a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_plat_afu.sv
<a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a>│<span class="w">       </span>│<span class="w">   </span>└──<span class="w"> </span>sources.txt
<a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a>│<span class="w">       </span>├──<span class="w"> </span>ccip
<a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>hello_world_ccip.sv
<a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_plat_afu.sv
<a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a>│<span class="w">       </span>│<span class="w">   </span>└──<span class="w"> </span>sources.txt
<a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a>│<span class="w">       </span>└──<span class="w"> </span>hello_world.json
<a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a>├──<span class="w"> </span>README.md
<a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a>└──<span class="w"> </span>sw
<a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a><span class="w">    </span>├──<span class="w"> </span>hello_world.c
<a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a><span class="w">    </span>└──<span class="w">  </span>Makefile
</code></pre></div>
The <strong>hw</strong> directory contains the RTL to implement the hardware functionality using CCIP, Avalon, and AXI interfaces. However, this guide will use the AXI version of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to go through the compilation steps. The <strong>sw</strong> directory of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> contains the source code of the host application that communicates with the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware.</p>
<p>The following instructions can be used to compile other <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> samples accompanying this repository.</p>
<ol>
<li>If not done already, download and clone the below repository.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span><span class="w"> </span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="w">   </span>git<span class="w"> </span>clone<span class="w"> </span><span class="si">${</span><span class="p">{ env.D5005_url_intel-fpga-bbb </span><span class="si">}</span><span class="o">}</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="w">   </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/OFS/examples-afu.git
</code></pre></div>
<ol>
<li>Install the Basic Building Blocks include files and libraries. </li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span>intel-fpga-bbb
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="w">   </span>mkdir<span class="w"> </span>build
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span>build
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="w">   </span>cmake<span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>/usr<span class="w"> </span>..
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="w">   </span>make
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">   </span>make<span class="w"> </span>install
</code></pre></div>
<p>By default, the Basic Building Blocks include and library files will be installed in <code>/usr/local</code>. You can change this installation prefix to another path by adding <code>-DCMAKE_INSTALL_PREFIX=&lt;&lt;custom_path&gt;&gt;</code> to the cmake command, as above. In most cases, you should choose the same prefix for both the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> and the Basic Building Blocks.</p>
<p>If OPAE and the Basic Building Blocks are installed to standard system directories, such as <code>/usr/</code> and <code>/usr/local</code>, they may already be found on C and C++ header and library search paths. Otherwise, their installation directories must be added explicitly.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; * Header files from OPAE and <abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr> must either be on the default compiler search paths or on both C_INCLUDE_PATH and CPLUS_INCLUDE_PATH.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; * OPAE and <abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr> libraries must either be on the default linker search paths or on both LIBRARY_PATH and LD_LIBRARY_PATH.</p>
<ol>
<li>Make sure to set the next environment variables.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="w">  </span><span class="c1"># Set the FPGA_BBB_CCI_SRC variable to the full path of the intel-fpga-bbb directory created in the git clone step above.</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">FPGA_BBB_CCI_SRC</span><span class="o">=</span><span class="nv">$OFS_BUILD_ROOT</span>/examples-afu<span class="w">  </span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="w">  </span><span class="c1"># Header files from OPAE and MPF must either be on the default compiler search paths or on both C_INCLUDE_PATH and CPLUS_INCLUDE_PATH.</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">C_INCLUDE_PATH</span><span class="o">=</span>/usr/src/debug/opae-2.5.0-3.el8.x86_64/tests/framework
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="w">  </span><span class="c1"># OPAE and MPF libraries must either be on the default linker search paths or on both LIBRARY_PATH and LD_LIBRARY_PATH.  </span>
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_LOC</span><span class="o">=</span>/usr
<a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">LIBRARY_PATH</span><span class="o">=</span><span class="nv">$OPAE_LOC</span>/lib:<span class="nv">$LIBRARY_PATH</span>
<a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$OPAE_LOC</span>/lib64:<span class="nv">$LD_LIBRARY_PATH</span>
<a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>
<a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="w">  </span><span class="c1"># OPAE_PLATFORM_ROOT points to a release tree that has been configured with the Platform Interface Manager (PIM).  </span>
<a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_PLATFORM_ROOT</span><span class="o">=</span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/build_tree
</code></pre></div>
<ol>
<li>
<p>Compile the <code>hello_word</code> sample <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. 
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="w">  </span>$<span class="w"> </span>afu_synth_setup<span class="w"> </span>-s<span class="w"> </span><span class="nv">$FPGA_BBB_CCI_SRC</span>/tutorial/afu_types/01_pim_ifc/hello_world/hw/rtl/axi/sources.txt<span class="w"> </span>hello_world_synth
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>hello_world_synth
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="w">  </span>$<span class="w"> </span><span class="si">${</span><span class="nv">OPAE_PLATFORM_ROOT</span><span class="si">}</span>/bin/afu_synth
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a>
<a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a>
<a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>.
<a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a>.
<a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a>.
<a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a>Info<span class="w"> </span><span class="o">(</span><span class="m">19538</span><span class="o">)</span>:<span class="w"> </span>Reading<span class="w"> </span>SDC<span class="w"> </span>files<span class="w"> </span>took<span class="w"> </span><span class="m">00</span>:00:06<span class="w"> </span>cumulatively<span class="w"> </span><span class="k">in</span><span class="w"> </span>this<span class="w"> </span>process.
<a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a>Wrote<span class="w"> </span>hello_world.gbs
<a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a>
<a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a><span class="o">===========================================================================</span>
<a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a><span class="w"> </span>PR<span class="w"> </span>AFU<span class="w"> </span>compilation<span class="w"> </span><span class="nb">complete</span>
<a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a><span class="w"> </span>AFU<span class="w"> </span>gbs<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span><span class="s1">&#39;hello_world.gbs&#39;</span>
<a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a><span class="w"> </span>Design<span class="w"> </span>meets<span class="w"> </span><span class="nv">timing</span>
<a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a><span class="o">===========================================================================</span>
</code></pre></div></p>
</li>
<li>
<p>To test the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in actual hardware, load the <code>hello_world.gbs</code> to the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 card. For this step to be successful, the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> must have already been loaded to the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 card following the steps described in Section 2 of this document.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/hello_world_synth
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="w">  </span>$<span class="w"> </span>sudo<span class="w"> </span>fpgasupdate<span class="w"> </span>hello_world.gbs<span class="w"> </span>3b:00.0
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="w">  </span><span class="o">[</span>sudo<span class="o">]</span><span class="w"> </span>password<span class="w"> </span><span class="k">for</span><span class="w"> </span>&lt;&lt;Your<span class="w"> </span>username&gt;&gt;:<span class="w"> </span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="o">[</span><span class="m">2022</span>-12-06<span class="w"> </span><span class="m">13</span>:25:10.22<span class="o">]</span><span class="w"> </span><span class="o">[</span>WARNING<span class="w"> </span><span class="o">]</span><span class="w"> </span>Update<span class="w"> </span>starting.<span class="w"> </span>Please<span class="w"> </span><span class="k">do</span><span class="w"> </span>not<span class="w"> </span>interrupt.
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="o">[</span><span class="m">2022</span>-12-06<span class="w"> </span><span class="m">13</span>:25:12.06<span class="o">]</span><span class="w"> </span><span class="o">[</span>INFO<span class="w">    </span><span class="o">]</span><span class="w"> </span>
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a>Partial<span class="w"> </span>Reconfiguration<span class="w"> </span>OK
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="o">[</span><span class="m">2022</span>-12-06<span class="w"> </span><span class="m">13</span>:25:12.06<span class="o">]</span><span class="w"> </span><span class="o">[</span>INFO<span class="w">    </span><span class="o">]</span><span class="w"> </span>Total<span class="w"> </span>time:<span class="w"> </span><span class="m">0</span>:00:01.83
</code></pre></div>
<p>Set up your Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 board to work with the newly loaded <code>hello_world.gbs</code> file.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="c1">#  Create the Virtual Functions (VFs):</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>pci_device<span class="w"> </span>3b:00.0<span class="w"> </span>vf<span class="w"> </span><span class="m">3</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="w"> </span><span class="c1"># Verify:</span>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="w"> </span>$<span class="w"> </span>lspci<span class="w"> </span>-s<span class="w"> </span>3b:00
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>3b:00.0<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a>3b:00.1<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a>3b:00.2<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a>3b:00.3<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a>
<a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="w"> </span><span class="c1"># Bond VFs to VFIO driver.  Enter &lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a>
<a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:3b:00.1<span class="w"> </span>&lt;Your<span class="w"> </span>username&gt;
<a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="w"> </span>Unbinding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.1<span class="w"> </span>from<span class="w"> </span>dfl-pci
<a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.1<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.1<span class="w"> </span>is<span class="w"> </span><span class="m">142</span>
<a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/142<span class="w"> </span>to<span class="w"> </span>&lt;Your<span class="w"> </span>username&gt;
<a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/142<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a>
<a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:3b:00.2<span class="w"> </span>&lt;Your<span class="w"> </span>username&gt;
<a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a><span class="w"> </span>Unbinding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.2<span class="w"> </span>from<span class="w"> </span>dfl-pci
<a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.2<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-74-24" name="__codelineno-74-24" href="#__codelineno-74-24"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.2<span class="w"> </span>is<span class="w"> </span><span class="m">143</span>
<a id="__codelineno-74-25" name="__codelineno-74-25" href="#__codelineno-74-25"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/143<span class="w"> </span>to<span class="w"> </span>&lt;Your<span class="w"> </span>username&gt;
<a id="__codelineno-74-26" name="__codelineno-74-26" href="#__codelineno-74-26"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/143<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-74-27" name="__codelineno-74-27" href="#__codelineno-74-27"></a>
<a id="__codelineno-74-28" name="__codelineno-74-28" href="#__codelineno-74-28"></a>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:3b:00.3<span class="w"> </span>&lt;Your<span class="w"> </span>username&gt;
<a id="__codelineno-74-29" name="__codelineno-74-29" href="#__codelineno-74-29"></a><span class="w"> </span>Unbinding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.3<span class="w"> </span>from<span class="w"> </span>dfl-pci
<a id="__codelineno-74-30" name="__codelineno-74-30" href="#__codelineno-74-30"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.3<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-74-31" name="__codelineno-74-31" href="#__codelineno-74-31"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:3b:00.3<span class="w"> </span>is<span class="w"> </span><span class="m">144</span>
<a id="__codelineno-74-32" name="__codelineno-74-32" href="#__codelineno-74-32"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/144<span class="w"> </span>to<span class="w"> </span>&lt;Your<span class="w"> </span>username&gt;
<a id="__codelineno-74-33" name="__codelineno-74-33" href="#__codelineno-74-33"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/144<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-74-34" name="__codelineno-74-34" href="#__codelineno-74-34"></a>
<a id="__codelineno-74-35" name="__codelineno-74-35" href="#__codelineno-74-35"></a><span class="c1"># &lt; Verify the new AFU is loaded.  The hello_world AFU GUID is &quot;c6aa954a-9b91-4a37-abc1-1d9f0709dcc3&quot;.</span>
<a id="__codelineno-74-36" name="__codelineno-74-36" href="#__codelineno-74-36"></a>
<a id="__codelineno-74-37" name="__codelineno-74-37" href="#__codelineno-74-37"></a>$<span class="w"> </span>fpgainfo<span class="w"> </span>port
<a id="__codelineno-74-38" name="__codelineno-74-38" href="#__codelineno-74-38"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-74-39" name="__codelineno-74-39" href="#__codelineno-74-39"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xEF00000
<a id="__codelineno-74-40" name="__codelineno-74-40" href="#__codelineno-74-40"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:3B:00.0
<a id="__codelineno-74-41" name="__codelineno-74-41" href="#__codelineno-74-41"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-74-42" name="__codelineno-74-42" href="#__codelineno-74-42"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-74-43" name="__codelineno-74-43" href="#__codelineno-74-43"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-74-44" name="__codelineno-74-44" href="#__codelineno-74-44"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x138D
<a id="__codelineno-74-45" name="__codelineno-74-45" href="#__codelineno-74-45"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-74-46" name="__codelineno-74-46" href="#__codelineno-74-46"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-74-47" name="__codelineno-74-47" href="#__codelineno-74-47"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x603B000000000000
<a id="__codelineno-74-48" name="__codelineno-74-48" href="#__codelineno-74-48"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:3B:00.3
<a id="__codelineno-74-49" name="__codelineno-74-49" href="#__codelineno-74-49"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-74-50" name="__codelineno-74-50" href="#__codelineno-74-50"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-74-51" name="__codelineno-74-51" href="#__codelineno-74-51"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-74-52" name="__codelineno-74-52" href="#__codelineno-74-52"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x138D
<a id="__codelineno-74-53" name="__codelineno-74-53" href="#__codelineno-74-53"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-74-54" name="__codelineno-74-54" href="#__codelineno-74-54"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>c6aa954a-9b91-4a37-abc1-1d9f0709dcc3
<a id="__codelineno-74-55" name="__codelineno-74-55" href="#__codelineno-74-55"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-74-56" name="__codelineno-74-56" href="#__codelineno-74-56"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x403B000000000000
<a id="__codelineno-74-57" name="__codelineno-74-57" href="#__codelineno-74-57"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:3B:00.2
<a id="__codelineno-74-58" name="__codelineno-74-58" href="#__codelineno-74-58"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-74-59" name="__codelineno-74-59" href="#__codelineno-74-59"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-74-60" name="__codelineno-74-60" href="#__codelineno-74-60"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-74-61" name="__codelineno-74-61" href="#__codelineno-74-61"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x138D
<a id="__codelineno-74-62" name="__codelineno-74-62" href="#__codelineno-74-62"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-74-63" name="__codelineno-74-63" href="#__codelineno-74-63"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>c6aa954a-9b91-4a37-abc1-1d9f0709dcc3
<a id="__codelineno-74-64" name="__codelineno-74-64" href="#__codelineno-74-64"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-74-65" name="__codelineno-74-65" href="#__codelineno-74-65"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x203B000000000000
<a id="__codelineno-74-66" name="__codelineno-74-66" href="#__codelineno-74-66"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:3B:00.1
<a id="__codelineno-74-67" name="__codelineno-74-67" href="#__codelineno-74-67"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-74-68" name="__codelineno-74-68" href="#__codelineno-74-68"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-74-69" name="__codelineno-74-69" href="#__codelineno-74-69"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-74-70" name="__codelineno-74-70" href="#__codelineno-74-70"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x138D
<a id="__codelineno-74-71" name="__codelineno-74-71" href="#__codelineno-74-71"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-74-72" name="__codelineno-74-72" href="#__codelineno-74-72"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>56e203e9-864f-49a7-b94b-12284c31e02b
</code></pre></div>
<ol>
<li>Compile and execute the host application of the <code>hello_world</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. You should see the application outputs the "Hello world!" message in the terminal.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="w">  </span><span class="c1"># Move to the sw directory of the hello_world AFU and run the following commands in user mode</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$FPGA_BBB_CCI_SRC</span>/tutorial/afu_types/01_pim_ifc/hello_world/sw/
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w">   </span>make
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="w">  </span><span class="c1"># Launch the host application</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="w">   </span>./hello_world
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="w">   </span>Hello<span class="w"> </span>world<span class="w"> </span>TLP!
</code></pre></div>
<h3 id="413-modify-the-afu-user-clocks-frequency">4.1.3. Modify the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> user clocks frequency<a class="headerlink" href="#413-modify-the-afu-user-clocks-frequency" title="Permanent link">&para;</a></h3>
<p>An OPAE compliant <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> specifies the frequency of the <code>uclk_usr</code> and <code>uclk_usr_div2</code> clocks through the JSON file for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> configuration located under the <code>&lt;afu_example&gt;/hw/rtl</code> directory of an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> design. For instance, the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> configuration file of the <code>host_chan_mmio</code> example is <code>$OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/hw/rtl/host_chan_mmio.json</code>.</p>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> specifies the frequency for uClk_usr in its platform configuration file using the following key:value pairs:</p>
<div class="highlight"><pre><span></span><code>  &quot;clock-frequency-high&quot;: [&lt;float-value&gt;|”auto”|”auto-&lt;float-value&gt;”]
  &quot;clock-frequency-low&quot;: [&lt;float-value&gt;|”auto”|”auto-&lt;float-value&gt;”]
</code></pre></div>
<p>These <code>key:value</code> tuples are used to configure the PLL of the target platform that provides the user clocks through the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> clocks interface. In addition, the specified frequency affects the timing closure process on the user clocks during <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> compilation. </p>
<p>Setting the value field to a float number (e.g., 315.0 to specify 315 MHz) drives the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> generation process to close timing within the bounds set by the low and high values and sets the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>'s JSON metadata to specify the user clock PLL  frequency values.</p>
<p>The following example shows the JSON file of the <code>host_chan_mmio</code> to set the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> uClk to 300 MHz and uClk_div2 to 150 MHz.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>{
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>   &quot;version&quot;: 1,
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>   &quot;afu-image&quot;: {
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>      &quot;power&quot;: 0,
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>      &quot;clock-frequency-high&quot;: 300,
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>      &quot;clock-frequency-low&quot;: 150,
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a>      &quot;afu-top-interface&quot;:
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>         {
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a>            &quot;class&quot;: &quot;ofs_plat_afu&quot;
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a>         },
<a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a>      &quot;accelerator-clusters&quot;:
<a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a>         [
<a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a>            {
<a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a>               &quot;name&quot;: &quot;host_chan_mmio&quot;,
<a id="__codelineno-76-15" name="__codelineno-76-15" href="#__codelineno-76-15"></a>               &quot;total-contexts&quot;: 1,
<a id="__codelineno-76-16" name="__codelineno-76-16" href="#__codelineno-76-16"></a>               &quot;accelerator-type-uuid&quot;: &quot;76d7ae9c-f66b-461f-816a-5428bcebdbc5&quot;
<a id="__codelineno-76-17" name="__codelineno-76-17" href="#__codelineno-76-17"></a>            }
<a id="__codelineno-76-18" name="__codelineno-76-18" href="#__codelineno-76-18"></a>         ]
<a id="__codelineno-76-19" name="__codelineno-76-19" href="#__codelineno-76-19"></a>   }
<a id="__codelineno-76-20" name="__codelineno-76-20" href="#__codelineno-76-20"></a>}
</code></pre></div>
<p>Save the changes to <code>host_chan_mmio.json</code> file, then execute the <code>afu_synth_setup</code> script to create a new copy of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> files with the modified user clock settigns.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="w">  </span>$<span class="w"> </span>afu_synth_setup<span class="w"> </span>-s<span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/hw/rtl/test_mmio_axi1.txt<span class="w"> </span>build_d5005_afu_clks
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a>Loading<span class="w"> </span>platform<span class="w"> </span>database:<span class="w"> </span>/home/&lt;Your<span class="w"> </span>username&gt;/&lt;Your<span class="w"> </span>localpath&gt;/ofs-d5005/work_d5005/build_tree/hw/lib/platform/platform_db/ofs_d5005.json
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>Loading<span class="w"> </span>platform-params<span class="w"> </span>database:<span class="w"> </span>/usr/share/opae/platform/platform_db/platform_defaults.json
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a>Loading<span class="w"> </span>AFU<span class="w"> </span>database:<span class="w"> </span>/usr/share/opae/platform/afu_top_ifc_db/ofs_plat_afu.json
<a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a>Writing<span class="w"> </span>platform/platform_afu_top_config.vh
<a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a>Writing<span class="w"> </span>platform/platform_if_addenda.qsf
<a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a>Writing<span class="w"> </span>../hw/afu_json_info.vh
</code></pre></div>
Compile the <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> with the new frequency values.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/build_d5005_afu_clks
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="w">   </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/build_tree/bin/afu_synth
</code></pre></div>
<p>During the compilation phase, you will observe the Timing Analyzer uses the specified user clock frequency values as the target to close timing.</p>
<p><a class="glightbox" href="../images/usrclk_timing.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Figure Timing Analyzer" src="../images/usrclk_timing.PNG" /></a></p>
<p><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developers must ensure the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware design meets timing. The compilation of an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that fails timing shows a message similar to the following.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>.
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>.
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a>.
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a>Wrote<span class="w"> </span>host_chan_mmio.gbs
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a>
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="o">===========================================================================</span>
<a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="w"> </span>PR<span class="w"> </span>AFU<span class="w"> </span>compilation<span class="w"> </span><span class="nb">complete</span>
<a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="w"> </span>AFU<span class="w"> </span>gbs<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span><span class="s1">&#39;host_chan_mmio.gbs&#39;</span>
<a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a>
<a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="w">  </span>***<span class="w"> </span>Design<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>meet<span class="w"> </span>timing
<a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="w">  </span>***<span class="w"> </span>See<span class="w"> </span>build/syn/syn_top/output_files/timing_report
<a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a>
<a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a><span class="o">===========================================================================</span>
</code></pre></div>
<p>The previous output indicates the location of the timing reports for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> designer to identify the failing paths and perform the necessary design changes. Next, is a listing of the timing report files from a <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that fails to meet timing after modifying the user clock frequency values.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/build_d5005_afu_clks
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="w">  </span>$<span class="w"> </span>ls<span class="w"> </span>build/syn/syn_top/output_files/timing_report
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>clocks.rpt<span class="w">  </span>clocks.sta.fail.summary<span class="w">  </span>clocks.sta.pass.summary<span class="w"> </span>iofs_pr_afu_2_slow_900mv_0c_recovery.rpt
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>iofs_pr_afu_2_slow_900mv_0c_setup.rpt
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>iofs_pr_afu_2_slow_900mv_100c_recovery.rpt
<a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>iofs_pr_afu_2_slow_900mv_100c_setup.rpt
<a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a>iofs_pr_afu_2_slow_vid2_0c_recovery.rpt
<a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a>iofs_pr_afu_2_slow_vid2_0c_setup.rpt
<a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a>iofs_pr_afu_2_slow_vid2_100c_recovery.rpt
<a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a>iofs_pr_afu_2_slow_vid2_100c_setup.rpt
<a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a>iofs_pr_afu_MIN_fast_900mv_0c_recovery.rpt
<a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a>iofs_pr_afu_MIN_fast_900mv_0c_setup.rpt
<a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a>iofs_pr_afu_MIN_fast_900mv_100c_recovery.rpt
<a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a>iofs_pr_afu_MIN_fast_900mv_100c_setup.rpt
</code></pre></div>
<blockquote>
<p><strong>Warning:</strong> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developers must inform software developers of the maximum operating frequency (Fmax) of the user clocks to avoid any unexpected behavior of the accelerator and potentially of the overall system.</p>
</blockquote>
<h1 id="5-simulating-an-afu-using-ase">5. Simulating an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using ASE<a class="headerlink" href="#5-simulating-an-afu-using-ase" title="Permanent link">&para;</a></h1>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Simulation Environment (ASE) is a hardware/software co-simulation environment for your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. See diagram below illustrating ASE operation:</p>
<p><a class="glightbox" href="../images/ASE_HighLevel.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_HighLevel.png" /></a></p>
<p>ASE uses the simulator Direct Programming Interface (DPI) to provide HW/SW connectivity.  The PCIe connection to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> under testing is emulated with a transactional model.</p>
<p>The following list describes ASE operation:</p>
<ul>
<li>Attempts to replicate the transactions that will be seen in real system.</li>
<li>Provides a memory model to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, so illegal memory accesses can be identified early.</li>
<li>Not a cache simulator.</li>
<li>Does not guarantee synthesizability or timing closure.</li>
<li>Does not model system latency.</li>
<li>No administrator privileges are needed to run ASE.  All code is user level.</li>
</ul>
<p>The remainder of this section is a tutorial providing the steps on how to run ASE with either VCS or QuestaSim using an example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> build tree previously created in this guide.</p>
<h2 id="51-set-up-steps-to-run-ase">5.1. Set Up Steps to Run ASE<a class="headerlink" href="#51-set-up-steps-to-run-ase" title="Permanent link">&para;</a></h2>
<p>In this section you will set up your server to support ASE by independently downloading and installing <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> and ASE. Then, set up the required environment variables.</p>
<h3 id="511-install-opae-sdk">5.1.1. Install <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr><a class="headerlink" href="#511-install-opae-sdk" title="Permanent link">&para;</a></h3>
<p>Follow the instructions documented in the Getting Started Guide: Intel® Open FPGA Stack for Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005, section <a href="https://ofs.github.io/hw/d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/#50-opae-software-development-kit">5.0 OPAE Software Development Kit</a> to build and install the required <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> for the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> card.</p>
<p>The Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> card requires <strong>opae-2.5.0-3</strong>. Follow the instructions provided in the Getting Started Guide: Intel® Open FPGA Stack for Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 section <a href="https://ofs.github.io/hw/d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/#50-opae-software-development-kit">5.0 OPAE Software Development Kit</a>. However, just make sure to check out the cloned repository to tag <strong>2.5.0-3</strong> and branch <strong>release/2.5.0</strong>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>git<span class="w"> </span>checkout<span class="w"> </span>tags/2.5.0-3<span class="w"> </span>-b<span class="w"> </span>release/2.5.0
</code></pre></div>
<h3 id="512-install-ase-tools">5.1.2 Install ASE Tools<a class="headerlink" href="#512-install-ase-tools" title="Permanent link">&para;</a></h3>
<p>ASE is an RTL simulator for OPAE-based AFUs. The simulator emulates both the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> software user space API and the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> RTL interface. The majority of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> as well as devices such as PCIe and local memory are emulated with simple functional models.</p>
<p>ASE must be installed separatedly from the OPAE-SDK. However, the recommendation is to install it in the same target directory as OPAE-SDK.</p>
<ol>
<li>
<p>If not done already, set the environment variables as described in section, <a href="#2-set-up-afu-development-environment">Set Up <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Development Environment</a>.</p>
</li>
<li>
<p>Clone the <code>ase-sim</code> repository.</p>
</li>
</ol>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="w">  </span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/OFS/opae-sim.git
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>opae-sim<span class="w">  </span>
</code></pre></div>
2. Building ASE requires the include file <code>mock/opae_std.h</code>. If the OPAE-SDK was installed under the default system directories, the <strong>C_INCLUDE_PATH</strong> variable must be set as follows. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">C_INCLUDE_PATH</span><span class="o">=</span><span class="s2">&quot;/usr/src/debug/opae-2.5.0-3.el8.x86_64/tests/framework&quot;</span>
</code></pre></div>
<ol>
<li>Create a build directory and build ASE to be installed under the default system directories along with <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr>.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="w">   </span>mkdir<span class="w"> </span>build
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span>build
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="w">   </span>cmake<span class="w">  </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>/usr<span class="w"> </span>..
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="w">   </span>make
</code></pre></div>
<p>Optionally, if the desire is to install ASE binaries in a different location to the system's default, provide the path to CMAKE through the CMAKE_INSTALL_PREFIX switch, as follows.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="w">   </span>cmake<span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>&lt;&lt;/some/arbitrary/path&gt;&gt;<span class="w"> </span>..<span class="w">  </span>
</code></pre></div>
<ol>
<li>Install ASE binaries and libraries under the system directory <code>/usr</code>.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="w">   </span>sudo<span class="w"> </span>make<span class="w"> </span>install<span class="w">  </span>
</code></pre></div>
<h3 id="513-setup-required-ase-environment-variables">5.1.3. Setup Required ASE Environment Variables<a class="headerlink" href="#513-setup-required-ase-environment-variables" title="Permanent link">&para;</a></h3>
<p>The values set to the following environment variables assume the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> and ASE were installed in the default system directories below <code>/usr</code>. Setup these variables in the shell where ASE will be executed. You may wish to add these variables to the script you created to facilitate configuring your environment.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span>/usr/bin
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PWD</span>:<span class="nv">$PATH</span>
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span>../lib/python*/site-packages
<a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$PWD</span>
<a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span>/usr/lib
<a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">LIBRARY_PATH</span><span class="o">=</span><span class="nv">$PWD</span>
<a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span>/usr/lib64
<a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$PWD</span>
<a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/ofs-platform-afu-bbb
<a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_PLATFORM_AFU_BBB</span><span class="o">=</span><span class="nv">$PWD</span>
<a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/build_tree
<a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_PLATFORM_ROOT</span><span class="o">=</span><span class="nv">$PWD</span>
<a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a>
<a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a><span class="w">  </span><span class="c1">## For VCS, set the following:</span>
<a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a>
<a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">VCS_HOME</span><span class="o">=</span>&lt;Set<span class="w"> </span>the<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>VCS<span class="w"> </span>installation<span class="w"> </span>directory&gt;
<a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$VCS_HOME</span>/bin:<span class="nv">$PATH</span>
<a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a>
<a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a><span class="w">  </span><span class="c1">## For QuestaSIM, set the following:</span>
<a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">MTI_HOME</span><span class="o">=</span>&lt;path<span class="w"> </span>to<span class="w"> </span>Modelsim<span class="w"> </span>installation<span class="w"> </span>directory&gt;
<a id="__codelineno-87-21" name="__codelineno-87-21" href="#__codelineno-87-21"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$MTI_HOME</span>/linux_x86_64/:<span class="nv">$MTI_HOME</span>/bin/:<span class="nv">$PATH</span>
</code></pre></div>
<h2 id="52-simulating-the-host_chan_mmio-afu">5.2. Simulating the <strong>host_chan_mmio</strong> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr><a class="headerlink" href="#52-simulating-the-host_chan_mmio-afu" title="Permanent link">&para;</a></h2>
<p>The <code>$OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio</code> is a simple example demonstrating both hardware and software access to an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The <code>host_chan_mmio</code> example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> consists of the following files:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>host_chan_mmio
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>├── hw
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a>│   └── rtl
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>│       ├── avalon
<a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a>│       │   ├── afu_avalon512.sv
<a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a>│       │   ├── afu_avalon.sv
<a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a>│       │   ├── ofs_plat_afu_avalon512.sv
<a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a>│       │   ├── ofs_plat_afu_avalon_from_ccip.sv
<a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a>│       │   ├── ofs_plat_afu_avalon_from_axi.sv
<a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a>│       │   └── ofs_plat_afu_avalon.sv
<a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a>│       ├── axi
<a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a>│       │   ├── afu_axi512.sv
<a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a>│       │   ├── afu_axi.sv
<a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a>│       │   ├── ofs_plat_afu_axi512.sv
<a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a>│       │   ├── ofs_plat_afu_axi_from_ccip.sv
<a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a>│       │   └── ofs_plat_afu_axi.sv
<a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a>│       ├── host_chan_mmio.json
<a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a>│       ├── test_mmio_avalon0_from_ccip.txt
<a id="__codelineno-88-19" name="__codelineno-88-19" href="#__codelineno-88-19"></a>│       ├── test_mmio_avalon1.txt
<a id="__codelineno-88-20" name="__codelineno-88-20" href="#__codelineno-88-20"></a>│       ├── test_mmio_avalon2_512rw.txt
<a id="__codelineno-88-21" name="__codelineno-88-21" href="#__codelineno-88-21"></a>│       ├── test_mmio_axi0_from_ccip.txt
<a id="__codelineno-88-22" name="__codelineno-88-22" href="#__codelineno-88-22"></a>│       ├── test_mmio_axi1.txt
<a id="__codelineno-88-23" name="__codelineno-88-23" href="#__codelineno-88-23"></a>│       └── test_mmio_axi2_512rw.txt
<a id="__codelineno-88-24" name="__codelineno-88-24" href="#__codelineno-88-24"></a>└── sw
<a id="__codelineno-88-25" name="__codelineno-88-25" href="#__codelineno-88-25"></a>    ├── main.c
<a id="__codelineno-88-26" name="__codelineno-88-26" href="#__codelineno-88-26"></a>    ├── Makefile
</code></pre></div>
<p>This example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> contains examples using both Avalon and AXI interface buses. This guide will use the AXI version of the <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>ASE uses client-server application architecture to deliver hardware/software co-simulation.  You require one shell for the hardware based simulation and another shell where the software application is running. The hardware is started first with a simulation compilation and simulator startup script, once the simulator has loaded the design, it will wait until the software process starts. Once the software process starts, the simulator proceeds.  Transaction logging and waveform capture is performed.</p>
<h3 id="521-set-up-and-run-the-hw-simulation-process">5.2.1 Set Up and Run the HW Simulation Process<a class="headerlink" href="#521-set-up-and-run-the-hw-simulation-process" title="Permanent link">&para;</a></h3>
<p>You will run the <code>afu_sim_setup</code> script to create the scripts for running the ASE environment.  The <code>afu_sim_setup</code> script has the following usage:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>usage: afu_sim_setup [-h] -s SOURCES [-p PLATFORM] [-t {VCS,QUESTA,MODELSIM}]
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>                     [-f] [--ase-mode ASE_MODE] [--ase-verbose]
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>                     dst
<a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a>
<a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a>Generate an ASE simulation environment for an AFU. An ASE environment is
<a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a>instantiated from the OPAE installation and then configured for the specified
<a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a>AFU. AFU source files are specified in a text file that is parsed by
<a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a>rtl_src_config, which is also part of the OPAE base environment.
<a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a>
<a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a>positional arguments:
<a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a>  dst                   Target directory path (directory must not exist).
<a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a>
<a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a>optional arguments:
<a id="__codelineno-89-14" name="__codelineno-89-14" href="#__codelineno-89-14"></a>  -h, --help            show this help message and exit
<a id="__codelineno-89-15" name="__codelineno-89-15" href="#__codelineno-89-15"></a>  -s SOURCES, --sources SOURCES
<a id="__codelineno-89-16" name="__codelineno-89-16" href="#__codelineno-89-16"></a>                        AFU source specification file that will be passed to
<a id="__codelineno-89-17" name="__codelineno-89-17" href="#__codelineno-89-17"></a>                        rtl_src_config. See &quot;rtl_src_config --help&quot; for the
<a id="__codelineno-89-18" name="__codelineno-89-18" href="#__codelineno-89-18"></a>                        file&#39;s syntax. rtl_src_config translates the source
<a id="__codelineno-89-19" name="__codelineno-89-19" href="#__codelineno-89-19"></a>                        list into either Quartus or RTL simulator syntax.
<a id="__codelineno-89-20" name="__codelineno-89-20" href="#__codelineno-89-20"></a>  -p PLATFORM, --platform PLATFORM
<a id="__codelineno-89-21" name="__codelineno-89-21" href="#__codelineno-89-21"></a>                        FPGA Platform to simulate.
<a id="__codelineno-89-22" name="__codelineno-89-22" href="#__codelineno-89-22"></a>  -t {VCS,QUESTA,MODELSIM}, --tool {VCS,QUESTA,MODELSIM}
<a id="__codelineno-89-23" name="__codelineno-89-23" href="#__codelineno-89-23"></a>                        Default simulator.
<a id="__codelineno-89-24" name="__codelineno-89-24" href="#__codelineno-89-24"></a>  -f, --force           Overwrite target directory if it exists.
<a id="__codelineno-89-25" name="__codelineno-89-25" href="#__codelineno-89-25"></a>  --ase-mode ASE_MODE   ASE execution mode (default, mode 3, exits on
<a id="__codelineno-89-26" name="__codelineno-89-26" href="#__codelineno-89-26"></a>                        completion). See ase.cfg in the target directory.
<a id="__codelineno-89-27" name="__codelineno-89-27" href="#__codelineno-89-27"></a>  --ase-verbose         When set, ASE prints each CCI-P transaction to the
<a id="__codelineno-89-28" name="__codelineno-89-28" href="#__codelineno-89-28"></a>                        command line. Transactions are always logged to
<a id="__codelineno-89-29" name="__codelineno-89-29" href="#__codelineno-89-29"></a>                        work/ccip_transactions.tsv, even when not set. This
<a id="__codelineno-89-30" name="__codelineno-89-30" href="#__codelineno-89-30"></a>                        switch sets ENABLE_CL_VIEW in ase.cfg.
</code></pre></div>
<p>Run <code>afu_sim_setup</code> to create the ASE simulation environment for the <code>host_chan_mmio</code> example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The <code>'-t VCS'</code> option indicates to prepare the ASE simulation environment for VCS.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>cd $OFS_ROOTDIR/work_d5005/
<a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a>
<a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>afu_sim_setup -s $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/hw/rtl/test_mmio_axi1.txt -t VCS host_chan_mmio_sim
<a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a>
<a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a>Copying ASE from /opae-sdk/install-opae-sdk/share/opae/ase...
<a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a>Copying ASE from /usr/share/opae/ase...
<a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a>#################################################################
<a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a>#                                                               #
<a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a>#             OPAE Intel(R) Xeon(R) + FPGA Library              #
<a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a>#               AFU Simulation Environment (ASE)                #
<a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a>#                                                               #
<a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a>#################################################################
<a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a>
<a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a>Tool Brand: VCS
<a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a>Loading platform database: /home/&lt;Your username&gt;/&lt;Your localpath&gt;/ofs-d5005/work_d5005/build_tree/hw/lib/platform/platform_db/ofs_d5005.json
<a id="__codelineno-90-16" name="__codelineno-90-16" href="#__codelineno-90-16"></a>Loading platform-params database: /usr/share/opae/platform/platform_db/platform_defaults.json
<a id="__codelineno-90-17" name="__codelineno-90-17" href="#__codelineno-90-17"></a>Loading AFU database: /usr/share/opae/platform/afu_top_ifc_db/ofs_plat_afu.json
<a id="__codelineno-90-18" name="__codelineno-90-18" href="#__codelineno-90-18"></a>Writing rtl/platform_afu_top_config.vh
<a id="__codelineno-90-19" name="__codelineno-90-19" href="#__codelineno-90-19"></a>Writing rtl/platform_if_addenda.txt
<a id="__codelineno-90-20" name="__codelineno-90-20" href="#__codelineno-90-20"></a>Writing rtl/platform_if_includes.txt
<a id="__codelineno-90-21" name="__codelineno-90-21" href="#__codelineno-90-21"></a>Writing rtl/ase_platform_name.txt
<a id="__codelineno-90-22" name="__codelineno-90-22" href="#__codelineno-90-22"></a>Writing rtl/ase_platform_config.mk and rtl/ase_platform_config.cmake
<a id="__codelineno-90-23" name="__codelineno-90-23" href="#__codelineno-90-23"></a>ASE Platform: discrete (FPGA_PLATFORM_DISCRETE)
</code></pre></div>
<p>The <code>afu_sim_setup</code> creates the ASE scripts in the directory <code>host_chan_mmio_sim</code> where the <code>afu_sim_setup</code> script was run.  Start the simulator as shown below in <em>user mode</em>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span>host_chan_mmio_sim
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">   </span>make
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">   </span>make<span class="w"> </span>sim
</code></pre></div>
<p>This process launches the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware simulator. Before moving to the next section, pay attention to the simulator output highlighted in the image below.</p>
<p><a class="glightbox" href="../images/ASE_HW.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_HW.png" /></a></p>
<p>The simulation artifacts are stored in host_chan_mmio/work and consist of:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>log_ase_events.tsv
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>log_ofs_plat_host_chan.tsv 
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a>log_ofs_plat_local_mem.tsv 
<a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a>log_pf_vf_mux_A.tsv 
<a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a>log_pf_vf_mux_B.tsv 
</code></pre></div>
<h3 id="522-set-up-and-run-the-sw-process">5.2.2 Set Up and Run the SW Process<a class="headerlink" href="#522-set-up-and-run-the-sw-process" title="Permanent link">&para;</a></h3>
<p>Open an additional shell to build and run the host application that communicates with the actual <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware. Set up the same environment variable you have set up in the shell you have been working on until this point. </p>
<p>Additionally, as indicated by the hardware simulator output that is currently executing in the "simulator shell", copy and paste the line <code>"export ASE_WORKDIR=..."</code>, into the new "software shell". See the last image of the previous section.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="w">   </span><span class="nb">export</span><span class="w"> </span><span class="nv">ASE_WORKDIR</span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;as directed in HW simula</span>tion<span class="w"> </span>shell&gt;&gt;
</code></pre></div>
Then, go to the sw directory of the <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> example to compile the host application.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/sw<span class="w">  </span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>make
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a>
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>afu_json_mgr<span class="w"> </span>json-info<span class="w"> </span>--afu-json<span class="o">=</span>../hw/rtl/host_chan_mmio.json<span class="w"> </span>--c-hdr<span class="o">=</span>obj/afu_json_info.h
<a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>Writing<span class="w"> </span>obj/afu_json_info.h
<a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>cc<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-std<span class="o">=</span>gnu99<span class="w"> </span>-fstack-protector<span class="w"> </span>-fPIE<span class="w"> </span>-fPIC<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat<span class="w"> </span>-Wformat-security<span class="w"> </span>-I../../common/sw<span class="w"> </span>-I./obj<span class="w"> </span>-c<span class="w"> </span>main.c<span class="w"> </span>-o<span class="w"> </span>obj/main.o
<a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>cc<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-std<span class="o">=</span>gnu99<span class="w"> </span>-fstack-protector<span class="w"> </span>-fPIE<span class="w"> </span>-fPIC<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat<span class="w"> </span>-Wformat-security<span class="w"> </span>-I../../common/sw<span class="w"> </span>-I./obj<span class="w"> </span>-c<span class="w"> </span>test_host_chan_mmio.c<span class="w"> </span>-o<span class="w"> </span>obj/test_host_chan_mmio.o
<a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>cc<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-std<span class="o">=</span>gnu99<span class="w"> </span>-fstack-protector<span class="w"> </span>-fPIE<span class="w"> </span>-fPIC<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat<span class="w"> </span>-Wformat-security<span class="w"> </span>-I../../common/sw<span class="w"> </span>-I./obj<span class="w"> </span>-c<span class="w"> </span>../../common/sw/connect.c<span class="w"> </span>-o<span class="w"> </span>obj/connect.o
<a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a>cc<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-std<span class="o">=</span>gnu99<span class="w"> </span>-fstack-protector<span class="w"> </span>-fPIE<span class="w"> </span>-fPIC<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat<span class="w"> </span>-Wformat-security<span class="w"> </span>-I../../common/sw<span class="w"> </span>-I./obj<span class="w"> </span>-c<span class="w"> </span>../../common/sw/csr_mgr.c<span class="w"> </span>-o<span class="w"> </span>obj/csr_mgr.o
<a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a>cc<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-std<span class="o">=</span>gnu99<span class="w"> </span>-fstack-protector<span class="w"> </span>-fPIE<span class="w"> </span>-fPIC<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat<span class="w"> </span>-Wformat-security<span class="w"> </span>-I../../common/sw<span class="w"> </span>-I./obj<span class="w"> </span>-c<span class="w"> </span>../../common/sw/hash32.c<span class="w"> </span>-o<span class="w"> </span>obj/hash32.o
<a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a>cc<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-std<span class="o">=</span>gnu99<span class="w"> </span>-fstack-protector<span class="w"> </span>-fPIE<span class="w"> </span>-fPIC<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat<span class="w"> </span>-Wformat-security<span class="w"> </span>-I../../common/sw<span class="w"> </span>-I./obj<span class="w"> </span>-c<span class="w"> </span>../../common/sw/test_data.c<span class="w"> </span>-o<span class="w"> </span>obj/test_data.o
<a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a>cc<span class="w"> </span>-o<span class="w"> </span>host_chan_mmio<span class="w"> </span>obj/main.o<span class="w"> </span>obj/test_host_chan_mmio.o<span class="w"> </span>obj/connect.o<span class="w"> </span>obj/csr_mgr.o<span class="w"> </span>obj/hash32.o<span class="w"> </span>obj/test_data.o<span class="w">  </span>-z<span class="w"> </span>noexecstack<span class="w"> </span>-z<span class="w"> </span>relro<span class="w"> </span>-z<span class="w"> </span>now<span class="w"> </span>-pie<span class="w"> </span>-luuid<span class="w"> </span>-lopae-c
</code></pre></div>
<p>Now, launch the host application to exercise the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware running on the simulator shell. The next image shows the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware simulation process on the left side shell. The right hand shell shows the host application's output of a successful simulation.</p>
<p><a class="glightbox" href="../images/ASE_RUN.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_RUN.png" /></a></p>
<p>Finally, on the hardware simulation shell, you can view the wave forms by invoking the following command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="w">   </span>make<span class="w"> </span>wave
</code></pre></div>
<p>This brings up the VCS simulator GUI and loads the simulation waveform files. Use the Hierarchy window to navigate to the <strong>afu</strong> instance located under, <code>ase_top | ase_top_plat | ofs_plat_afu | afu</code> , as shown below.</p>
<p><a class="glightbox" href="../images/ASE_VCS_hier.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_VCS_hier.png" /></a></p>
<p>Right click on the <code>afu (afu)</code> entry to display the drop-down menu. Then, click on <code>Add to Waves | New Wave View</code> to display the following waveforms window.</p>
<p><a class="glightbox" href="../images/ASE_VCS_AFU_Waveforms.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_VCS_AFU_Waveforms.png" /></a>
</br></br></p>
<h3 id="53-simulating-the-hello_world-afu">5.3 Simulating the <strong>hello_world</strong> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr><a class="headerlink" href="#53-simulating-the-hello_world-afu" title="Permanent link">&para;</a></h3>
<p>In this section, you will quickly simulate the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>-based <code>hello_world</code> sample <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> accompanying the example_afu repository.</p>
<ol>
<li>
<p>Set the environment variables as described in section <a href="#51-set-up-steps-to-run-ase">5.1. Set Up Steps to Run ASE</a>.</p>
</li>
<li>
<p>Prepare an RTL simulation environment for the AXI version of the <code>hello_world</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>Simulation with ASE requires two software processes, one to simulate the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> RTL and the other to run the host software that exercises the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. To construct an RTL simulation environment under the directory <code>$OFS_ROOTDIR/work_d5005</code>, execute the following.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="w">  </span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005
<a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="w">  </span>$<span class="w"> </span>afu_sim_setup<span class="w"> </span>-s<span class="w"> </span><span class="nv">$FPGA_BBB_CCI_SRC</span>/tutorial/afu_types/01_pim_ifc/hello_world/hw/rtl/axi/sources.txt<span class="w"> </span>-t<span class="w"> </span>VCS<span class="w"> </span>hello_world_sim
<a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a>
<a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a>Copying<span class="w"> </span>ASE<span class="w"> </span>from<span class="w"> </span>/usr/local/share/opae/ase...
<a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="c1">#################################################################</span>
<a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="c1">#                                                               #</span>
<a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="c1">#             OPAE Intel(R) Xeon(R) + FPGA Library              #</span>
<a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a><span class="c1">#               AFU Simulation Environment (ASE)                #</span>
<a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a><span class="c1">#                                                               #</span>
<a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a><span class="c1">#################################################################</span>
<a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a>
<a id="__codelineno-96-12" name="__codelineno-96-12" href="#__codelineno-96-12"></a>Tool<span class="w"> </span>Brand:<span class="w"> </span>VCS
<a id="__codelineno-96-13" name="__codelineno-96-13" href="#__codelineno-96-13"></a>Loading<span class="w"> </span>platform<span class="w"> </span>database:<span class="w"> </span>/home/&lt;Your<span class="w"> </span>username&gt;/&lt;Your<span class="w"> </span>localpath&gt;/ofs-d5005/work_d5005/build_tree/hw/lib/platform/platform_db/ofs_d5005.json
<a id="__codelineno-96-14" name="__codelineno-96-14" href="#__codelineno-96-14"></a>Loading<span class="w"> </span>platform-params<span class="w"> </span>database:<span class="w"> </span>/usr/share/opae/platform/platform_db/platform_defaults.json
<a id="__codelineno-96-15" name="__codelineno-96-15" href="#__codelineno-96-15"></a>Loading<span class="w"> </span>AFU<span class="w"> </span>database:<span class="w"> </span>/usr/share/opae/platform/afu_top_ifc_db/ofs_plat_afu.json
<a id="__codelineno-96-16" name="__codelineno-96-16" href="#__codelineno-96-16"></a>Writing<span class="w"> </span>rtl/platform_afu_top_config.vh
<a id="__codelineno-96-17" name="__codelineno-96-17" href="#__codelineno-96-17"></a>Writing<span class="w"> </span>rtl/platform_if_addenda.txt
<a id="__codelineno-96-18" name="__codelineno-96-18" href="#__codelineno-96-18"></a>Writing<span class="w"> </span>rtl/platform_if_includes.txt
<a id="__codelineno-96-19" name="__codelineno-96-19" href="#__codelineno-96-19"></a>Writing<span class="w"> </span>rtl/ase_platform_name.txt
<a id="__codelineno-96-20" name="__codelineno-96-20" href="#__codelineno-96-20"></a>Writing<span class="w"> </span>rtl/ase_platform_config.mk<span class="w"> </span>and<span class="w"> </span>rtl/ase_platform_config.cmake
<a id="__codelineno-96-21" name="__codelineno-96-21" href="#__codelineno-96-21"></a>ASE<span class="w"> </span>Platform:<span class="w"> </span>discrete<span class="w"> </span><span class="o">(</span>FPGA_PLATFORM_DISCRETE<span class="o">)</span>
</code></pre></div>
<p>The <code>afu_sim_setup</code> script constructs an ASE environment in the <code>hello_world_sim</code> subdirectory. If the command fails, confirm that the path to the afu_sim_setup is on your PATH environment variable (in the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> bin directory) and that your Python version is at least 3.7.</p>
</li>
<li>
<p>Build and execute the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> RTL simulator in <em>user mode</em>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="w">   </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/hello_world_sim
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="w">   </span>make
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="w">   </span>make<span class="w"> </span>sim<span class="w">  </span>
</code></pre></div>
<p>The previous commands will build and run the VCS RTL simulator, which prints a message saying it is ready for simulation. The simulation process also prints a message instructing you to set the ASE_WORKDIR environment variable in a second shell.</p>
<ol>
<li>
<p>Open a second shell where you will build and execute the host software. In this new "software shell", set up the environment variables you have set up so far in the "hardware simulation" shell.</p>
</li>
<li>
<p>Also, set the ASE_WORKDIR environment variable following the instructions given in the "hardware simulation" shell.</p>
</li>
</ol>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ASE_WORKDIR</span><span class="o">=</span><span class="nv">$OFS_ROOTDIR</span>/work_d5005/hello_world_sim/work
</code></pre></div>
6. Then, move to the <strong>sw</strong> directory of the <code>hello_world</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> sample to build the host software.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$FPGA_BBB_CCI_SRC</span>/examples-afu/tutorial/afu_types/01_pim_ifc/hello_world/sw
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="w">   </span>make<span class="w">      </span>
</code></pre></div>
<ol>
<li>Run the <code>hello_world</code> host application to resume the work of the RTL simulation. The host software process and the RTL simulation execute in lockstep. If successful, you should see the <strong>Hello world!</strong> output.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="w">  </span>$<span class="w"> </span>with_ase<span class="w"> </span>./hello_world
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>
<a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="w">  </span><span class="o">[</span>APP<span class="o">]</span><span class="w">  </span>Initializing<span class="w"> </span>simulation<span class="w"> </span>session<span class="w"> </span>...
<a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a>Hello<span class="w"> </span>world!
<a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="w">  </span><span class="o">[</span>APP<span class="o">]</span><span class="w">  </span>Deinitializing<span class="w"> </span>simulation<span class="w"> </span>session
<a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="w">  </span><span class="o">[</span>APP<span class="o">]</span><span class="w">         </span>Took<span class="w"> </span><span class="m">43</span>,978,424<span class="w"> </span>nsec
<a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="w">  </span><span class="o">[</span>APP<span class="o">]</span><span class="w">  </span>Session<span class="w"> </span>ended
</code></pre></div>
<p>The image below shows the simulation of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware and the execution of the host application side-by-side.</p>
<p></br></p>
<p><a class="glightbox" href="../images/ASE_Run_hello_world.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_Run_hello_world.png" /></a></p>
<p></br></p>
<ol>
<li>Finally, on the hardware simulation shell, you can view the wave forms by invoking the following command.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="w">   </span>make<span class="w"> </span>wave
</code></pre></div>
<p>This brings up the DVE GUI and loads the simulation waveform files. Use the Hierarchy window to navigate to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> instance located under, <code>ase_top | ase_top_plat | ofs_plat_afu</code>, as shown below.</p>
<p><a class="glightbox" href="../images/ASE_VCS_hier_hello_world.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_VCS_hier_hello_world.png" /></a></p>
<p>Right click on the <code>ofs_plat_afu</code> entry to display the drop-down menu. Then, click on <code>Add to Waves | New Wave View</code> to display the following waveforms window.</p>
<p><a class="glightbox" href="../images/ASE_VCS_AFU_Hello_World_Waveforms.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_VCS_AFU_Hello_World_Waveforms.png" /></a>
</br></br></p>
</li>
</ol>
<h1 id="6-adding-remote-signal-tap-logic-analyzer-to-debug-the-afu">6. Adding Remote Signal Tap Logic Analyzer to debug the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr><a class="headerlink" href="#6-adding-remote-signal-tap-logic-analyzer-to-debug-the-afu" title="Permanent link">&para;</a></h1>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> provides a remote Signal Tap facility. It also supports the following in system debug tools included with the Intel®  Intel® Quartus® Prime Pro Edition:</p>
<ul>
<li>In-system Sources and Probes</li>
<li>In-system Memory Content Editor</li>
<li>Signal Probe</li>
<li>System Console</li>
</ul>
<p>This section is a short guide on adding remote Signal Tap instances to an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> for in-system debugging. In order of execution, you can follow the steps in the following sections to create an instrumented <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The host_chan_mmio <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is used in this guide as the target <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to be instrumented.</p>
<p>You need a basic understanding of Signal Tap. Please see the <a href="https://www.intel.com/content/www/us/en/programmable/support/training/course/odsw1164.html">Signal Tap Logic Analyzer: Introduction &amp; Getting Started</a> Web-Based Training for more information.</p>
<p>You will run with a Signal Tap GUI running locally on the server with the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 as shown below:</p>
<p><a class="glightbox" href="../images/RSTP_local.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/RSTP_local.png" /></a></p>
<h2 id="61-adding-rstp-to-the-host_chan_mmio-afu">6.1. Adding RSTP to the host_chan_mmio <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr><a class="headerlink" href="#61-adding-rstp-to-the-host_chan_mmio-afu" title="Permanent link">&para;</a></h2>
<p>RSTP is added to an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> by:</p>
<ol>
<li>Defining signals to be instrumented in Signal Tap. Create a new *.stp file.</li>
<li>Modify ofs_top.qpf to include the new *.stp file</li>
<li>Modify ofs_top.qsf</li>
<li>Modify ofs_pr_afu.qsf </li>
<li>Re-run afu_synth_setup to update project settings</li>
<li>Re-run $OPAE_PLATFORM_ROOT/bin/afu_synth to build the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> -able image containing the RSTP instance</li>
</ol>
<p>The following steps use the previously built host_chan_mmio <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> example. You can use these detailed steps to instrument your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<ol>
<li>
<p>Navigate to host_chan_mmio <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Quartus project and open the project using Quartus GUI.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a> cd $OFS_ROOTDIR/work_d5005/build_d5005_x16/build/syn/syn_top
<a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a> $ quartus d5005.qpf &amp;
</code></pre></div>
</li>
<li>
<p>Once the project is loaded in Quartus, review the project hierarchy as shown in the Project Navigator. This example will add Signal Tap probe points to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region. Reviewing the code will give insight into the function of this block. You can up the code in the Project Navigator by expanding afu_top - port_gasket - pr_slot - afu_main - ofs_plat_afu, then select instance afu, right-click, select Locate Node - Locate in Design File as shown below.</p>
<p><a class="glightbox" href="../images/stp_proj_nav.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_proj_nav.PNG" /></a></p>
</li>
<li>
<p>Bring up Signal Tap to create the *.stp file. In the Quartus GUI, go to Tools - Signal Tap Logic Analyzer. Click <code>Create</code> to accept the default template in the New File from Template pop-up. The Signal Tap Logic Analyzer window comes up.</p>
</li>
<li>
<p>Set up the clock for the Signal Tap logic instance by clicking <code>...</code> button as shown below:</p>
<p><a class="glightbox" href="../images/stp_clock.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_clock.PNG" /></a>
5. The Node Finder comes up, and you will click <code>...</code> as shown below to bring up the hierarchy navigator or copy-paste the following location at <code>Look in</code>:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>iofs_top<span class="p">|</span>afu_top<span class="p">|</span>port_gasket<span class="p">|</span>pr_slot<span class="p">|</span>afu_main<span class="p">|</span>ofs_plat_afu<span class="p">|</span>afu
</code></pre></div>
<p><a class="glightbox" href="../images/stp_clk_bringup_hier_nav.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_clk_bringup_hier_nav.PNG" /></a></p>
<ol>
<li>
<p>In the Select Hierarchy Level, navigate to top - afu_top - port_gasket - pr_slot - afu_main - ofs_plat_afu, then select instance afu and click <code>Ok</code>.</p>
</li>
<li>
<p>Enter <code>*clk*</code> in the <code>Named:</code> box and click <code>Search</code>.  This brings up matching terms.  Click <code>mmio64_if.clk</code> and <code>&gt;</code>.  Verify your Node Finder is as shown below and then click <code>Ok</code>:
   <a class="glightbox" href="../images/stp_set_up_clk.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_set_up_clk.PNG" /></a></p>
</li>
<li>
<p>Double click the <code>Double-click to add nodes</code> and once again, click <code>...</code> and navigate to top - afu_top - port_gasket - pr_slot - afu_main - ofs_plat_afu, then select instance afu and click <code>Ok</code>.  Enter <code>mmio64</code> then click <code>&gt;&gt;</code> to add these signals to the STP instance as shown below:
    <a class="glightbox" href="../images/stp_sig_select.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_sig_select.PNG" /></a></p>
<p>Then click <code>Insert</code> and <code>Close</code>.</p>
</li>
<li>
<p>Save the newly created STP by clicking <code>File - Save As</code> in the save as navigate to $OFS_ROOTDIR/work_d5005/build_d5005_x16/build/syn/syn_top and save the STP file as <code>host_chan_mmio.stp</code> as shown below:
      <a class="glightbox" href="../images/stp_save_stp.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_save_stp.PNG" /></a></p>
</li>
<li>Edit <code>ofs_top.qsf</code> to add host_chan_mmio.stp file and enable STP.  Open $OFS_ROOTDIR/work_d5005/build_d5005_x16/build/syn/syn_top/d5005.qpf in an editor and modify lines as shown below:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>set_global_assignment<span class="w"> </span>-name<span class="w"> </span>ENABLE_SIGNALTAP<span class="w"> </span>ON
<a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a>set_global_assignment<span class="w"> </span>-name<span class="w"> </span>USE_SIGNALTAP_FILE<span class="w"> </span>host_chan_mmio.stp
<a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a>set_global_assignment<span class="w"> </span>-name<span class="w"> </span>SIGNALTAP_FILE<span class="w"> </span>host_chan_mmio.stp
</code></pre></div>
<p>Save the d5005.qpf and close Quartus.</p>
<ol>
<li>Edit <code>iofs_pr_afu.qsf</code> to add host_chan_mmio.stp file and enable STP.  Open
$OPAE_PLATFORM_ROOT/hw/lib/build/syn/syn_top/iofs_pr_afu.qsf in an editor and ensure the lines are included as  below (note: the verilog macro <code>INCLUDE_REMOTE_STP</code> will already be present), also copy and paste the file <code>host_chan_mmio.stp</code> in this location:</li>
</ol>
<p>The updated lines are:
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>set_global_assignment<span class="w"> </span>-name<span class="w"> </span>VERILOG_MACRO<span class="w"> </span><span class="s2">&quot;INCLUDE_REMOTE_STP&quot;</span>
<a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a>set_global_assignment<span class="w"> </span>-name<span class="w"> </span>ENABLE_SIGNALTAP<span class="w"> </span>ON
<a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a>set_global_assignment<span class="w"> </span>-name<span class="w"> </span>USE_SIGNALTAP_FILE<span class="w"> </span>host_chan_mmio.stp
<a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a>set_global_assignment<span class="w"> </span>-name<span class="w"> </span>SIGNALTAP_FILE<span class="w"> </span>host_chan_mmio.stp
</code></pre></div>
Save the iofs_pr_afu.qsf and ensure Quartus is closed.</p>
<ol>
<li>The afu_synth script is run to create a new copy of <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> files. In your original build shell, enter the following commands:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>    $ cd $OFS_ROOTDIR/build_d5005_x16
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a>    $ afu_synth_setup -s $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/hw/rtl/test_mmio_axi1.txt build_d5005_x16_stp
<a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a>
<a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a>    Notice that your previous build_d5005_x16_stp directory is preserved, and a new build_d5005_x16_stp directory is created. You will use build_d5005_x16_stp to build the STP-enabled image.
<a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a>
<a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a>    $ cd build_d5005_x16_stp
<a id="__codelineno-106-7" name="__codelineno-106-7" href="#__codelineno-106-7"></a>    $ $OPAE_PLATFORM_ROOT/bin/afu_synth
<a id="__codelineno-106-8" name="__codelineno-106-8" href="#__codelineno-106-8"></a>
<a id="__codelineno-106-9" name="__codelineno-106-9" href="#__codelineno-106-9"></a>...
<a id="__codelineno-106-10" name="__codelineno-106-10" href="#__codelineno-106-10"></a>...
<a id="__codelineno-106-11" name="__codelineno-106-11" href="#__codelineno-106-11"></a>Wrote host_chan_mmio.gbs
<a id="__codelineno-106-12" name="__codelineno-106-12" href="#__codelineno-106-12"></a>
<a id="__codelineno-106-13" name="__codelineno-106-13" href="#__codelineno-106-13"></a>===========================================================================
<a id="__codelineno-106-14" name="__codelineno-106-14" href="#__codelineno-106-14"></a> PR AFU compilation complete
<a id="__codelineno-106-15" name="__codelineno-106-15" href="#__codelineno-106-15"></a> AFU gbs file is &#39;host_chan_mmio.gbs&#39;
<a id="__codelineno-106-16" name="__codelineno-106-16" href="#__codelineno-106-16"></a>  Design meets timing
<a id="__codelineno-106-17" name="__codelineno-106-17" href="#__codelineno-106-17"></a>===========================================================================
</code></pre></div>
<ol>
<li>Once compilation completes, the new host_chan_mmio.gbs file that contains the Signal Tap instance can be loaded.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a>$ sudo fpgasupdate host_chan_mmio.gbs 3b:00.0
<a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a>[sudo] password for &lt;myuser&gt;: 
<a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a>[WARNING ] Update starting. Please do not interrupt.
<a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a> [INFO    ] 
<a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a>Partial Reconfiguration OK
<a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a>[INFO    ] Total time: 0:00:01.87
</code></pre></div>
<ol>
<li>Use the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> mmlink tool to create a TCP/IP connection to your Intel® Stratix 10® FPGA card under test. The mmlink command has the following format:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>Usage:
<a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a>mmlink
<a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a>&lt;Segment&gt;             --segment=&lt;SEGMENT NUMBER&gt;
<a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a>&lt;Bus&gt;                 --bus=&lt;BUS NUMBER&gt;           OR  -B &lt;BUS NUMBER&gt;
<a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a>&lt;Device&gt;              --device=&lt;DEVICE NUMBER&gt;     OR  -D &lt;DEVICE NUMBER&gt;
<a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a>&lt;Function&gt;            --function=&lt;FUNCTION NUMBER&gt; OR  -F &lt;FUNCTION NUMBER&gt;
<a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a>&lt;Socket-id&gt;           --socket-id=&lt;SOCKET NUMBER&gt;  OR  -S &lt;SOCKET NUMBER&gt;
<a id="__codelineno-108-8" name="__codelineno-108-8" href="#__codelineno-108-8"></a>&lt;TCP PORT&gt;            --port=&lt;PORT&gt;                OR  -P &lt;PORT&gt;
<a id="__codelineno-108-9" name="__codelineno-108-9" href="#__codelineno-108-9"></a>&lt;IP ADDRESS&gt;          --ip=&lt;IP ADDRESS&gt;            OR  -I &lt;IP ADDRESS&gt;
<a id="__codelineno-108-10" name="__codelineno-108-10" href="#__codelineno-108-10"></a>&lt;Version&gt;             -v,--version Print version and exit
</code></pre></div>
<blockquote>
<p><strong><em>ProTip:</em></strong>  </p>
<p>Open a new shell session for mmlink; this console needs to remain open to allow mmlink connection.</p>
</blockquote>
<p>Enter the command below to create a connection using port 3333:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>mmlink<span class="w"> </span>-P<span class="w"> </span><span class="m">3333</span><span class="w"> </span>-B<span class="w"> </span>0x3b
<a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a>
<a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="w"> </span>-------<span class="w"> </span>Command<span class="w"> </span>line<span class="w"> </span>Input<span class="w"> </span>START<span class="w"> </span>----
<a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a>
<a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="w"> </span>Socket-id<span class="w">             </span>:<span class="w"> </span>-1
<a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="w"> </span>Port<span class="w">                  </span>:<span class="w"> </span><span class="m">3333</span>
<a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="w"> </span>IP<span class="w"> </span>address<span class="w">            </span>:<span class="w"> </span><span class="m">0</span>.0.0.0
<a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a><span class="w"> </span>-------<span class="w"> </span>Command<span class="w"> </span>line<span class="w"> </span>Input<span class="w"> </span>END<span class="w">   </span>----
<a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a>
<a id="__codelineno-109-10" name="__codelineno-109-10" href="#__codelineno-109-10"></a>PORT<span class="w"> </span>Resource<span class="w"> </span>found.
<a id="__codelineno-109-11" name="__codelineno-109-11" href="#__codelineno-109-11"></a>Server<span class="w"> </span>socket<span class="w"> </span>is<span class="w"> </span>listening<span class="w"> </span>on<span class="w"> </span>port:<span class="w"> </span><span class="m">3333</span>
</code></pre></div>
<p>Leave this shell open with the mmlink connection.</p>
<ol>
<li>In this step, you will open a new shell and enable <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> over protocol. You must have Quartus Prime Pro ®  23.1 Programmer loaded on the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 server for local debugging.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>$<span class="w"> </span>jtagconfig<span class="w"> </span>--add<span class="w"> </span>JTAG-over-protocol<span class="w"> </span>sti://localhost:0/intel/remote-debug/127.0.0.1:3333/0
<a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>
<a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a>Verify<span class="w"> </span>connectivity<span class="w"> </span>with<span class="w"> </span>jtagconfig<span class="w"> </span>--debug
<a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a>
<a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a>$<span class="w"> </span>jtagconfig<span class="w"> </span>--debug
<a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="m">1</span><span class="o">)</span><span class="w"> </span>JTAG-over-protocol<span class="w"> </span><span class="o">[</span>sti://localhost:0/intel/remote-debug/127.0.0.1:3333/0<span class="o">]</span>
<a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="w">   </span><span class="o">(</span>JTAG<span class="w"> </span>Server<span class="w"> </span>Version<span class="w"> </span><span class="m">23</span>.1.0<span class="w"> </span>Build<span class="w"> </span><span class="m">104</span><span class="w"> </span><span class="m">09</span>/14/2022<span class="w"> </span>SC<span class="w"> </span>Pro<span class="w"> </span>Edition<span class="o">)</span>
<a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a><span class="w">  </span>020D10DD<span class="w">   </span>VTAP10<span class="w"> </span><span class="o">(</span><span class="nv">IR</span><span class="o">=</span><span class="m">10</span><span class="o">)</span>
<a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a><span class="w">    </span>Design<span class="w"> </span><span class="nb">hash</span><span class="w">    </span>D41D8CD98F00B204E980
<a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a><span class="w">    </span>+<span class="w"> </span>Node<span class="w"> </span>00406E00<span class="w">  </span>Virtual<span class="w"> </span>JTAG<span class="w"> </span><span class="c1">#0</span>
<a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a>
<a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a><span class="w">  </span>Captured<span class="w"> </span>DR<span class="w"> </span>after<span class="w"> </span><span class="nv">reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>020D10DD<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="m">32</span><span class="o">]</span>
<a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a><span class="w">  </span>Captured<span class="w"> </span>IR<span class="w"> </span>after<span class="w"> </span><span class="nv">reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="m">155</span><span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="m">10</span><span class="o">]</span>
<a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a><span class="w">  </span>Captured<span class="w"> </span>Bypass<span class="w"> </span>after<span class="w"> </span><span class="nv">reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="m">1</span><span class="o">]</span>
<a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a><span class="w">  </span>Captured<span class="w"> </span>Bypass<span class="w"> </span><span class="nv">chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="m">1</span><span class="o">]</span>
</code></pre></div>
<ol>
<li>Start Quartus Signal Tap GUI, connect to target, load stp file by navigating to 
$OPAE_PLATFORM_ROOT/hw/lib/build/syn/syn_top/ . The Quartus Signal Tap must be the same version of Quartus used to compile the host_chan_mmio.gbs. Quartus Prime Pro ®  23.1 Pro is used in the steps below:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="nb">cd</span><span class="w"> </span><span class="nv">$OPAE_PLATFORM_ROOT</span>/hw/lib/build/syn/syn_top/
<a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a>quartus_stpw<span class="w"> </span>host_chan_mmio.stp
</code></pre></div>
<p>This command brings up Signal Tap GUI. Connect to the Signal Tap over protocol by selecting the <code>Hardware</code> button on the right side of the GUI and clicking the "Please Select" pull-down as shown below:</p>
<p><span title='Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.'><strong><abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr></strong> </span> over protocol selected:</p>
<p><a class="glightbox" href="../images/ST_JTAG_Selected.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ST_JTAG_Selected.PNG" /></a></p>
<p>This connection process will take approximately 2-3 minutes for the Signal Tap instance to indicate "Ready to acquire".</p>
<p>8) Set the trigger condition for a rising edge on signal <code>valid</code> signal.
9) In the Signal Tap window, enable acquisition by pressing key <code>F5</code>. The Signal Tap GUI will indicate "Acquisition in progress". Run the hello_world application and observe that the Signal Tap instance has triggered. You should see signals being captured in the Signaltap GUI.</p>
<p>See captured image below:</p>
<p><a class="glightbox" href="../images/stp_data.PNG" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_data.PNG" /></a></p>
<p>To end your Signal Tap session, close the Signal Tap GUI, then in the mmlink shell, enter <code>ctrl c</code> to kill the mmlink process.</p>
<h2 id="notices-disclaimers">Notices &amp; Disclaimers<a class="headerlink" href="#notices-disclaimers" title="Permanent link">&para;</a></h2>
<p>Intel<sup>&reg;</sup> technologies may require enabled hardware, software or service activation.
No product or component can be absolutely secure. 
Performance varies by use, configuration and other factors.
Your costs and results may vary. 
You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Intel products described herein. You agree to grant Intel a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.
No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document, with the sole exception that you may publish an unmodified copy. You may create software implementations based on this document and in compliance with the foregoing that are intended to execute on the Intel product(s) referenced in this document. No rights are granted to create modifications or derivatives of this document.
The products described may contain design defects or errors known as errata which may cause the product to deviate from published specifications.  Current characterized errata are available on request.
Intel disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.
You are responsible for safety of the overall system, including compliance with applicable safety-related requirements or standards. 
<sup>&copy;</sup> Intel Corporation.  Intel, the Intel logo, and other Intel marks are trademarks of Intel Corporation or its subsidiaries.  Other names and brands may be claimed as the property of others. </p>
<p>OpenCL and the OpenCL logo are trademarks of Apple Inc. used by permission of the Khronos Group™.   </p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.copy", "navigation.indexes", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>