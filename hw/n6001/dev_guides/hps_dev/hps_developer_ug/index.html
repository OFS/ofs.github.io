
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../afu_dev/ug_dev_afu_ofs_n6001/">
      
      
        <link rel="next" href="../../../user_guides/ug_sim_ofs_n6001/ug_sim_ofs_n6001/">
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>HPS Developer Guide - OFS</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hard-processor-system-software-developer-guide-ofs-for-intel-agilex-fpgas-targeting-intel-n60001-pl-fpga-smartnic-platform" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="OFS" class="md-header__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OFS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              HPS Developer Guide
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-tabs__link">
        Stratix 10 PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../user_guides/ug_eval_ofs_n6001/ug_eval_script_ofs_n6001/" class="md-tabs__link md-tabs__link--active">
        Agilex PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../f2000x/user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-tabs__link">
        Agilex SoC Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../common/user_guides/oneapi_asp/ug_oneapi_asp/" class="md-tabs__link">
        oneAPI
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../sw/fpga_api/quick_start/readme/" class="md-tabs__link">
        OFS Software
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="OFS" class="md-nav__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OFS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Stratix 10 PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Stratix 10 PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/dev_guides/fim_dev/ug_dev_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/dev_guides/afu_dev/ug_dev_afu_d5005/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_sim_ofs_d5005/ug_sim_ofs_d5005/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Agilex PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Agilex PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_eval_ofs_n6001/ug_eval_script_ofs_n6001/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference_manuals/ofs_fim/mnl_fim_ofs_n6001/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fim_dev/ug_dev_fim_ofs_n6001/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../afu_dev/ug_dev_afu_ofs_n6001/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          HPS Developer Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        HPS Developer Guide
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#file-types" class="md-nav__link">
    File Types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-introduction" class="md-nav__link">
    1.0 Introduction
  </a>
  
    <nav class="md-nav" aria-label="1.0 Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-reference-documents" class="md-nav__link">
    1.1 Reference Documents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-reference-images" class="md-nav__link">
    1.2 Reference Images
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20-architecture-overview" class="md-nav__link">
    2.0 Architecture Overview
  </a>
  
    <nav class="md-nav" aria-label="2.0 Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-hps-peripherals" class="md-nav__link">
    2.1 HPS Peripherals
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-zarlink-device" class="md-nav__link">
    2.2 Zarlink Device
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-copy-engine" class="md-nav__link">
    2.3 Copy Engine
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-boot-flow" class="md-nav__link">
    2.4 Boot Flow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-authorization" class="md-nav__link">
    2.5 Authorization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#30-environment-setup" class="md-nav__link">
    3.0 Environment Setup
  </a>
  
    <nav class="md-nav" aria-label="3.0 Environment Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-building-u-boot" class="md-nav__link">
    3.1 Building U-Boot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-yocto" class="md-nav__link">
    3.2 Yocto
  </a>
  
    <nav class="md-nav" aria-label="3.2 Yocto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321-customizing-the-yocto-image" class="md-nav__link">
    3.2.1 Customizing the Yocto Image
  </a>
  
    <nav class="md-nav" aria-label="3.2.1 Customizing the Yocto Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3211-extending-the-u-boot-recipe" class="md-nav__link">
    3.2.1.1 Extending the U-Boot recipe
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3212-patching-the-linux-kernel" class="md-nav__link">
    3.2.1.2 Patching The Linux Kernel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3213-adding-custom-user-space-software" class="md-nav__link">
    3.2.1.3 Adding Custom User Space Software
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3214-adding-kernel-driver-software" class="md-nav__link">
    3.2.1.4 Adding Kernel Driver Software
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3215-creating-an-image-type" class="md-nav__link">
    3.2.1.5 Creating an Image Type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3216-testing-and-debugging" class="md-nav__link">
    3.2.1.6 Testing and Debugging
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#40-booting-the-hps" class="md-nav__link">
    4.0 Booting the HPS
  </a>
  
    <nav class="md-nav" aria-label="4.0 Booting the HPS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-ofs-fim-boot-overview" class="md-nav__link">
    4.1 OFS FIM Boot Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-booting-ofs-fim-for-intel-agilex-fpga" class="md-nav__link">
    4.2 Booting OFS FIM for Intel Agilex FPGA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-example-boot" class="md-nav__link">
    4.3 Example Boot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#50-hps-command-usage" class="md-nav__link">
    5.0 HPS Command Usage
  </a>
  
    <nav class="md-nav" aria-label="5.0 HPS Command Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-synopsis" class="md-nav__link">
    5.1 Synopsis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-description" class="md-nav__link">
    5.2 Description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-options" class="md-nav__link">
    5.3 Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-subcommands" class="md-nav__link">
    5.4 Subcommands
  </a>
  
    <nav class="md-nav" aria-label="5.4 Subcommands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#541-cpeng" class="md-nav__link">
    5.4.1 cpeng
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#542-heartbeat" class="md-nav__link">
    5.4.2 heartbeat
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#60-meta-bakepy" class="md-nav__link">
    6.0 meta-bake.py
  </a>
  
    <nav class="md-nav" aria-label="6.0 meta-bake.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-running-meta-bakepy" class="md-nav__link">
    6.1 Running meta-bake.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-required-changes" class="md-nav__link">
    6.2 Required Changes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-manual-build" class="md-nav__link">
    6.3 Manual Build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-manual-vab-signing" class="md-nav__link">
    6.4 Manual VAB Signing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#70-debugging" class="md-nav__link">
    7.0 Debugging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#80-connecting-remotely-to-the-hps-using-ssh" class="md-nav__link">
    8.0 Connecting remotely to the HPS using ssh
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#90-example-design-enabling-emmc-i2c-and-uart-in-platform-design" class="md-nav__link">
    9.0 Example Design - Enabling eMMC, I2C and UART in Platform Design
  </a>
  
    <nav class="md-nav" aria-label="9.0 Example Design - Enabling eMMC, I2C and UART in Platform Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-configuring-the-fim" class="md-nav__link">
    9.1 Configuring the FIM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-configuring-the-hps" class="md-nav__link">
    9.2 Configuring the HPS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-emmc-testing-from-the-hps" class="md-nav__link">
    9.3 eMMC Testing from the HPS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#layersyaml-reference" class="md-nav__link">
    layers.yaml Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faqs" class="md-nav__link">
    FAQs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-links" class="md-nav__link">
    Further Links
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_sim_ofs_n6001/ug_sim_ofs_n6001/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Agilex SoC Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Agilex SoC Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/user_guides/ug_qs_ofs_f2000x/ug_qs_ofs_f2000x/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/reference_manuals/ofs_fim/mnl_fim_ofs/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/dev_guides/fim_dev/ug_dev_fim_ofs_f2000x/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/dev_guides/afu_dev/ug_dev_afu_ofs_f2000x/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/user_guides/ug_sim_ofs/ug_sim_ofs/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          oneAPI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          oneAPI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/user_guides/oneapi_asp/ug_oneapi_asp/" class="md-nav__link">
        oneAPI ASP Getting Started User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/oneapi_asp/oneapi_asp_ref_mnl/" class="md-nav__link">
        oneAPI Accelerator Support Package(ASP) Reference Manual
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          OFS Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          OFS Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
          OPAE USER GUIDES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          OPAE USER GUIDES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/quick_start/readme/" class="md-nav__link">
        Quick Start Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/install_guide/installation_guide/" class="md-nav__link">
        OPAE Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/prog_guide/readme/" class="md-nav__link">
        OPAE C API Programming Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/pyopae/python_bindings/" class="md-nav__link">
        OPAE Python Bindings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/plug_guide/readme/" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          OPAE LIBRARIES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          OPAE LIBRARIES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/fpga_api/" class="md-nav__link">
        OPAE C API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/fpga_cxx_api/" class="md-nav__link">
        OPAE C++ Core API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/fpga_python_api/" class="md-nav__link">
        OPAE Python API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/plug_guide/readme/" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
          OPAE LINUX KERNEL DRIVERS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          OPAE LINUX KERNEL DRIVERS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/drv_arch/drv_arch/" class="md-nav__link">
        Open Programmable Accelerator Engine (OPAE) Linux Device Driver Architecture
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../sw/fpga_tools/fpgadiag/">OPAE FPGA TOOLS</a>
          
            <label for="__nav_6_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          OPAE FPGA TOOLS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgaconf/fpgaconf/" class="md-nav__link">
        fpgaconf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgainfo/fpgainfo/" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgasupdate/fpgasupdate/" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mmlink/mmlink/" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/packager/packager/" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/userclk/userclk/" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi/hssi/" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/pci_device/pci_device/" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opae.io/opae.io/" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/rsu/rsu/" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/host_exerciser/host_exerciser/" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssistats/" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssiloopback/" class="md-nav__link">
        HSSI ethernet loopback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mem_tg/mem_tg/" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/vabtool/vabtool/" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaevfio/opaevfio/" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/ofs.uio/ofs.uio/" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaeuio/opaeuio/" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgad/fpgad/" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#file-types" class="md-nav__link">
    File Types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-introduction" class="md-nav__link">
    1.0 Introduction
  </a>
  
    <nav class="md-nav" aria-label="1.0 Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-reference-documents" class="md-nav__link">
    1.1 Reference Documents
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-reference-images" class="md-nav__link">
    1.2 Reference Images
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20-architecture-overview" class="md-nav__link">
    2.0 Architecture Overview
  </a>
  
    <nav class="md-nav" aria-label="2.0 Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-hps-peripherals" class="md-nav__link">
    2.1 HPS Peripherals
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-zarlink-device" class="md-nav__link">
    2.2 Zarlink Device
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-copy-engine" class="md-nav__link">
    2.3 Copy Engine
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-boot-flow" class="md-nav__link">
    2.4 Boot Flow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-authorization" class="md-nav__link">
    2.5 Authorization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#30-environment-setup" class="md-nav__link">
    3.0 Environment Setup
  </a>
  
    <nav class="md-nav" aria-label="3.0 Environment Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-building-u-boot" class="md-nav__link">
    3.1 Building U-Boot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-yocto" class="md-nav__link">
    3.2 Yocto
  </a>
  
    <nav class="md-nav" aria-label="3.2 Yocto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321-customizing-the-yocto-image" class="md-nav__link">
    3.2.1 Customizing the Yocto Image
  </a>
  
    <nav class="md-nav" aria-label="3.2.1 Customizing the Yocto Image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3211-extending-the-u-boot-recipe" class="md-nav__link">
    3.2.1.1 Extending the U-Boot recipe
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3212-patching-the-linux-kernel" class="md-nav__link">
    3.2.1.2 Patching The Linux Kernel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3213-adding-custom-user-space-software" class="md-nav__link">
    3.2.1.3 Adding Custom User Space Software
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3214-adding-kernel-driver-software" class="md-nav__link">
    3.2.1.4 Adding Kernel Driver Software
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3215-creating-an-image-type" class="md-nav__link">
    3.2.1.5 Creating an Image Type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3216-testing-and-debugging" class="md-nav__link">
    3.2.1.6 Testing and Debugging
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#40-booting-the-hps" class="md-nav__link">
    4.0 Booting the HPS
  </a>
  
    <nav class="md-nav" aria-label="4.0 Booting the HPS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-ofs-fim-boot-overview" class="md-nav__link">
    4.1 OFS FIM Boot Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-booting-ofs-fim-for-intel-agilex-fpga" class="md-nav__link">
    4.2 Booting OFS FIM for Intel Agilex FPGA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-example-boot" class="md-nav__link">
    4.3 Example Boot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#50-hps-command-usage" class="md-nav__link">
    5.0 HPS Command Usage
  </a>
  
    <nav class="md-nav" aria-label="5.0 HPS Command Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-synopsis" class="md-nav__link">
    5.1 Synopsis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-description" class="md-nav__link">
    5.2 Description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-options" class="md-nav__link">
    5.3 Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-subcommands" class="md-nav__link">
    5.4 Subcommands
  </a>
  
    <nav class="md-nav" aria-label="5.4 Subcommands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#541-cpeng" class="md-nav__link">
    5.4.1 cpeng
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#542-heartbeat" class="md-nav__link">
    5.4.2 heartbeat
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#60-meta-bakepy" class="md-nav__link">
    6.0 meta-bake.py
  </a>
  
    <nav class="md-nav" aria-label="6.0 meta-bake.py">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-running-meta-bakepy" class="md-nav__link">
    6.1 Running meta-bake.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-required-changes" class="md-nav__link">
    6.2 Required Changes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-manual-build" class="md-nav__link">
    6.3 Manual Build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-manual-vab-signing" class="md-nav__link">
    6.4 Manual VAB Signing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#70-debugging" class="md-nav__link">
    7.0 Debugging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#80-connecting-remotely-to-the-hps-using-ssh" class="md-nav__link">
    8.0 Connecting remotely to the HPS using ssh
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#90-example-design-enabling-emmc-i2c-and-uart-in-platform-design" class="md-nav__link">
    9.0 Example Design - Enabling eMMC, I2C and UART in Platform Design
  </a>
  
    <nav class="md-nav" aria-label="9.0 Example Design - Enabling eMMC, I2C and UART in Platform Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-configuring-the-fim" class="md-nav__link">
    9.1 Configuring the FIM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-configuring-the-hps" class="md-nav__link">
    9.2 Configuring the HPS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-emmc-testing-from-the-hps" class="md-nav__link">
    9.3 eMMC Testing from the HPS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#layersyaml-reference" class="md-nav__link">
    layers.yaml Reference
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faqs" class="md-nav__link">
    FAQs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-links" class="md-nav__link">
    Further Links
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="hard-processor-system-software-developer-guide-ofs-for-intel-agilex-fpgas-targeting-intel-n60001-pl-fpga-smartnic-platform">Hard Processor System Software Developer Guide: <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel Agilex FPGAs Targeting Intel® N6000/1-PL FPGA SmartNIC Platform<a class="headerlink" href="#hard-processor-system-software-developer-guide-ofs-for-intel-agilex-fpgas-targeting-intel-n60001-pl-fpga-smartnic-platform" title="Permanent link">&para;</a></h1>
<p><a href="https://www.intel.com/content/www/us/en/search.html?ws=text#q=quartus%20prime%20pro%2023.1&amp;sort=relevancy">Quartus Prime Pro Version: 23.1</a></p>
<p>Last updated: Last updated: <strong>August 01, 2023</strong> </p>
<h2 id="file-types">File Types<a class="headerlink" href="#file-types" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Extension</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ITS File (*.its)</td>
<td>The image source file which describes the contents of the image and defines various properties used during boot. Actual contents to be included in the image (kernel, ramdisk, etc.) are specified in the image source file as paths to the appropriate data files.</td>
</tr>
<tr>
<td>ITB File (*.itb)</td>
<td>Produced as output from <code>mkimage</code>, using an image source file. Contains all the referenced data (kernel, ramdisk, SSBL, etc.) and other information needed by UBoot to handle the image properly. This image is transferred to the target and booted.</td>
</tr>
<tr>
<td>DTB File (*.dtb)</td>
<td>The Device Tree Blob is loaded into memory by U-Boot during the boot process, and a pointer to it is shared with the kernel. This file describes the system's hardware layout to the kernel.</td>
</tr>
<tr>
<td>FIT Image (*.fit)</td>
<td>Format used for uImage payloads developed by U-Boot. On aarch64 the kernel must be in image format and needs a device tree to boot.</td>
</tr>
<tr>
<td>SPL (*.spl)</td>
<td>The Secondary Program Loader is a small binary which is embedded in a <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> SOF and loaded into board DDR4 RAM when the FPGA is initially configured. This file is responsible for loading U-Boot into system RAM.</td>
</tr>
</tbody>
</table>
<h2 id="10-introduction">1.0 Introduction<a class="headerlink" href="#10-introduction" title="Permanent link">&para;</a></h2>
<p>The Open FPGA Stack (<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>) is a modular collection of hardware platform components, open source upstreamed software, and broad ecosystem support that enables an efficient path to develop a custom FPGA platform. <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Provides a framework of FPGA synthesizable code, a simulation environment and synthesis/simulation scripts.  The updated <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> architecture for Intel Agilex FPGA devices improves upon the modularity, configurability and scalability of the first release of the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> architecture while maintaining compatibility with the original design.  The primary components of the FPGA Interface Manager or shell of the reference design are:</p>
<ul>
<li>PCIe Subsystem</li>
<li>HSSI Subsystem</li>
<li>Memory Subsystem</li>
<li>Hard Processor System (HPS)</li>
<li>Reset Controller</li>
<li>FPGA Management Engine (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>)</li>
<li><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Peripheral Fabric for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> accesses to other interface peripherals</li>
<li>Board Peripheral Fabric for master to slave CSR accesses from Host or <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></li>
<li>SPI Interface to <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> controller</li>
</ul>
<p>The Intel<sup>&reg;</sup> N6000-PL and N6001-PL FPGA SmartNIC Platforms are acceleration cards that use the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> infrastructure. The key difference between these two platforms is:</p>
<ul>
<li>Intel<sup>&reg;</sup> N6000-PL SmartNIC Platform has a bifurcated PCIe bus with Gen4x8 interfacing to the the Intel Agilex FPGA and Gen4x8 interfacing to an Intel E810 SmartNIC.  This platform is targeted specifically for VRAN, UPF and vCSR applications.  The FPGA designs targeting these vertical market applications were generated using the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> infrastructure.</li>
<li>Intel<sup>&reg;</sup> N6001-PL SmartNIC Platform has a Gen4x16 interface directly to the Intel Agilex FPGa and is not populated with an Intel E810 SmartNIC.  This platform is the reference platform for the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> reference designs for Intel Agilex FPGA.  </li>
</ul>
<p>Note: throughout this document "Intel N6000/1-PL FPGA SmartNIC Platform" denotes both cards. This document describes the software package that runs on the Hard Processor System (HPS) which is a key component within both platforms.</p>
<p>The Intel N6000/1-PL FPGA SmartNIC Platform has a customized build script that can be used to both set up a development environment and build the essential pieces of the HPS software image. This script, <code>meta-bake.py</code>, has its own dedicated <a href="#31-building-u-boot"><strong>Section 3.1 Building U-Boot</strong></a> which can be used to quickly get started with the HPS build flow. It is recommended you use this build script to construct the first and second stage bootloader files, as it will handle all of the setup and patching required to build out your complete Yocto image. You can familiarize yourself with the contents of this package in its public GitHub repository located at https://github.com/OPAE/meta-opae-fpga/tree/main/tools/meta-bake. All other information included for individual components is included for learning purposes only and is not meant as a recipe for image creation.</p>
<h3 id="11-reference-documents">1.1 Reference Documents<a class="headerlink" href="#11-reference-documents" title="Permanent link">&para;</a></h3>
<p>This document pulls much of its information from related Agilex FPGA documentation hosted on <a href="intel.com">intel.com</a>. Reading these references is not required for initial platform bring up, but will serve to further your knowledge of the FPGA SoC boot and configuration process.</p>
<p><strong>Table 1. Reference Documents</strong></p>
<table>
<thead>
<tr>
<th><strong>Document Title</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.intel.com/content/www/us/en/programmable/documentation/slu1548263438002.html">Intel® Agilex™ Hard Processor System Technical Reference Manual</a></td>
</tr>
<tr>
<td><a href="https://www.intel.com/content/www/us/en/programmable/documentation/pww1591206997703.html">Intel® Agilex™ SoC FPGA Boot User Guide</a></td>
</tr>
<tr>
<td><a href="https://www.intel.com/content/www/us/en/programmable/documentation/oex1546548090650.html">Intel® Agilex™ Configuration User Guide</a></td>
</tr>
</tbody>
</table>
<h3 id="12-reference-images">1.2 Reference Images<a class="headerlink" href="#12-reference-images" title="Permanent link">&para;</a></h3>
<p>Intel has provided a set of two pre-compiled ITB images that can be used for exploration and evaluation of the HPS bring-up flow. These images contain the complete SSBL package specific to the board and can be copied to the N6000/1-PL SmartNIC Platform with an HPS enabled <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> loaded. Refer to <a href="#41-example-boot"><strong>Section 4.1 Example Boot</strong></a> for an example on how to use the built-in copy engine IP in tandem with the host-side <code>cpeng</code> software to transfer an SSBL.</p>
<p>The package is found on the official <a href="https://github.com/OFS/ofs-n6001/releases/tag/ofs-2023.1-1"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> 2023.1 Release on GitHub</a>. Two ITB artifacts are included at the bottom of the page under <em>Assets</em> - one with the Vendor Authorized Boot (VAB) certificate included, and one without. Which you choose to load depends on whether the currently loaded <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> requires VAB authentication. <a href="#43-example-boot"><strong>Section 4.3 Example Boot</strong></a> contains instructions on the boot flow using these files for platform bring up.</p>
<p>The default username for these two images is <code>root</code> and the password is empty. A good place to start after loading the ITB is to set up SSH for file transfers and the remote console, as seen in <a href="8.0-connecting-remotely-to-the-hps-using-ssh"><strong>8.0 Connecting remotely to the HPS using <code>ssh</code></strong></a>.</p>
<h2 id="20-architecture-overview">2.0 Architecture Overview<a class="headerlink" href="#20-architecture-overview" title="Permanent link">&para;</a></h2>
<p>The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> architecture is classified into:</p>
<ul>
<li>1. Host Interface Adapters (PCIe)</li>
<li>2. Low Performance Peripherals</li>
    <ul>
    <li>2.1. Slow speed peripherals (example: JTAG, I2C, SMBus, and so on)</li>
    <li>2.2. Management peripherals (example: FPGA FME)</li>
    </ul>
<li>3. High Performance Peripherals</li>
    <ul>
    <li>3.1. Memory peripherals</li>
    <li>3.2. Acceleration Function Units (AFUs)</li>
    <li>3.3. HPS Peripheral</li>
    </ul>
<li>4. Fabrics</li>
    <ul>
    <li>4.1. Peripheral Fabric (multi drop)</li>
    <li>4.2. AFU Streaming fabric (point to point)</li>
    </ul>
</ul>

<p>The HPS is connected to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and implements all the board specific flows that customers require to begin the application development using the HPS such as host communication, firmware load and update, integration with <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>, and memory. The HPS implements a basic <em>Hello World</em> software application and is intended as a starting point for customers to begin development with HPS.</p>
<h3 id="21-hps-peripherals">2.1 HPS Peripherals<a class="headerlink" href="#21-hps-peripherals" title="Permanent link">&para;</a></h3>
<p><strong>Figure 1  Intel Agilex FPGA HPS Peripherals</strong></p>
<p><a class="glightbox" href="../images/Image1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/Image1.png" /></a></p>
<p>The Intel Agilex™ SoC integrates a full-featured Arm<sup>&reg;</sup> Cortex-A53<sup>&reg;</sup> MPCore Processor.</p>
<p>The Cortex-A53 MPCore supports high-performance applications and provides the capability for secure processing and virtualization.</p>
<p>Each CPU in the processor has the following features:</p>
<ul>
<li>Support for 32-bit and 64-bit instruction sets.</li>
<li>To pipeline with symmetric dual issue of most instructions.</li>
<li>Arm NEON<sup>&reg;</sup> Single Instruction Multiple Data (SIMD) co-processor with a Floating-Point Unit (FPU)</li>
<li>Single and double-precision IEEE-754 floating point math support</li>
<li>Integer and polynomial math support.</li>
<li>Symmetric Multiprocessing (SMP) and Asymmetric Multiprocessing (AMP) modes.</li>
<li>Armv8 Cryptography Extension.</li>
<li>Level 1 (L1) cache:</li>
<li>32 KB two-way set associative instruction cache.</li>
<li>Single Error Detect (SED) and parity checking support for L1 instruction cache.</li>
<li>32 KB four-way set associative data cache.</li>
<li>Error checking and correction (ECC), Single Error Correct, Double Error Detect (SECDED) protection for L1 data cache.</li>
<li>Memory Management Unit (MMU) that communicates with the System MMU (SMMU).</li>
<li>Generic timer.</li>
<li>Governor module that controls clock and reset.</li>
<li>Debug modules:</li>
<li>Performance Monitor Unit.</li>
<li>Embedded Trace Macrocell (ETMv4).</li>
<li>Arm CoreSight<sup>&reg;</sup> cross trigger interface, the four CPUs share a 1 MB L2 cache with ECC, SECDED protection.</li>
</ul>
<p>A Snoop Control Unit (SCU) maintains coherency between the CPUs and communicates with the system Cache Coherency Unit (CCU). At a system level, the Cortex-A53 MPCore interfaces to a Generic Interrupt Controller (GIC), CCU, and System Memory Management Unit (SMMU).</p>
<p>Beyond the Arm Cortex-A53 MPCore Processor, the HPS integrates a variety of useful peripherals for use in your design, such as Ethernet, USB, Memory Controller, on-chip RAM, SPI, UART and more. Refer to the <a href="https://www.intel.com/content/www/us/en/programmable/documentation/slu1548263438002.html">Intel® Agilex™ Hard Processor System Technical Reference Manual</a> for more information.</p>
<h3 id="22-zarlink-device">2.2 Zarlink Device<a class="headerlink" href="#22-zarlink-device" title="Permanent link">&para;</a></h3>
<p>The Microchip® Zarlink device ZL30793 is used for time synchronization. It acts as the protocol engine that drives IEEE 1588-2008 PTP protocol. The Zarlink device is connected to the HPS side and the programming interface is SPI. The FPGA bitstream containing the HPS has the First Stage Bootloader (FSBL) only. This enable commands to be given from a terminal program connected through UART.</p>
<p>The software in HPS can access the Clock generator through SPI to enable write and read operations controlled by the terminal program. It can also read the status of the hold over and Loss of Lock signals and control the LED.</p>
<h3 id="23-copy-engine">2.3 Copy Engine<a class="headerlink" href="#23-copy-engine" title="Permanent link">&para;</a></h3>
<p>A host with <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> and Linux <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> installed will provide the <code>hps</code> OPAE command with related options to transfer images from host to the HPS image. The module in the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and HPS software that performs this transfer is called the Copy Engine (CPE), which is included by default within the HPS image.</p>
<p>Refer to the <a href="../../../user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/">Getting Started Guide: <sup>&reg;</sup> Open FPGA Stack for Intel Agilex FPGAs</a> for platform and software installation instructions.</p>
<p>The CPE software is patched into Linux on the HPS in Yocto through the <em>meta-intel-fpga-refdes</em> layer. This service is <em>daemonized</em> and requires <code>systemd</code> in order to operate. This service will communicate with the HPS IP integrated in the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> in order to coordinate and monitor file transfers from the host CPE software to DDR connected the HPS. The CPE HPS-side software takes advantage of the built-in I/O lightweight kernel module to communicate with the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>'s HPS IP. It can restart the transfer if the initial transfer of the image is not successful. The CPE can also serve as reference on how to integrate your own <em>systemd</em> service in the Linux build running on the HPS.</p>
<h3 id="24-boot-flow">2.4 Boot Flow<a class="headerlink" href="#24-boot-flow" title="Permanent link">&para;</a></h3>
<p>The boot flow for the Agilex <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> design for the Intel N6000/1-PL FPGA SmartNIC Platform is an FPGA-first boot flow, meaning the Intel Agilex Secure Device Manager (SDM) configures the FPGA first and then boots the HPS. Alternatively, you can boot the HPS first and then configure the FPGA core as part of the Second-Stage Boot Loader (SSBL) or after the Operating System (OS) boots. HPS-first boot is not covered in this document, but for more information please refer to the <a href="https://www.intel.com/content/www/us/en/programmable/documentation/pww1591206997703.html">Intel® Agilex™ SoC FPGA Boot User Guide</a>.</p>
<p>For the FPGA-first boot flow supported by the Intel Agilex <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, the First Stage Bootloader is part of FPGA bitstream. The available Secure Device Manager (SDM) in the FPGA initially configures the FPGA core and periphery in this mode. The first stage bootloader is produced as a part of a U-Boot build and cna be manually inserted into a Quartus generated SOF file as shown in step 7 of <a href="#92-configuring-the-hps"><strong>Section 9.2 Configuring the HPS</strong></a>.</p>
<p>After completion, the HPS boots. All the I/O, including the HPS-allocated I/O, are configured, and brought out of tri-state. If the HPS is not booted:</p>
<ul>
<li>The HPS is held in reset</li>
<li>HPS-dedicated I/O are held in reset</li>
<li>HPS-allocated I/O are driven with reset values from the HPS.</li>
<li>If the FPGA is configured before the HPS boots, then the boot flow looks as shown in the example figure below.</li>
</ul>
<p><strong>Figure 2. Typical FPGA First Configuration Steps</strong></p>
<p><a class="glightbox" href="images/Image2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="images/Image2.png" /></a></p>
<p>The flow includes the Time from Power-on-Reset (TPOR) to boot completion (TBoot_Complete).</p>
<p><strong>Table 2. FPGA Configuration First Stages</strong></p>
<table>
<thead>
<tr>
<th><strong>Time</strong></th>
<th><strong>Boot Stage</strong></th>
<th><strong>Device State</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>TPOR to T1</td>
<td>POR</td>
<td>Power-on reset</td>
</tr>
<tr>
<td>T1 to T2</td>
<td>SDM: Boot ROM</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>1. SDM samples the MSEL pins to determine the configuration scheme and boot source.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>2. SDM establishes the device security level based on eFuse values.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>3. SDM initializes the device by reading the configuration firmware (initial part of the bitstream) from the boot source.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>4. SDM authenticates and decrypts the configuration firmware (this process occurs as necessary throughout the configuration).</td>
</tr>
<tr>
<td></td>
<td></td>
<td>5. SDM starts executing the configuration firmware.</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>T2 to T3</td>
<td>SDM: Configuration Firmware</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>1. SDM I/O are enabled.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>2. SDM configures the FPGA I/O and core (full configuration) and enables the rest of your configured SDM I/O.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>3. SDM loads the FSBL from the bitstream into HPS on-chip RAM.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>4. SDM enables HPS SDRAM I/O and optionally enables HPS debug.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>5. FPGA is in user mode.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>6. HPS is released from reset. CPU1-CPU3 are in a wait-for-interrupt (WFI) state.</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>T3 to T4</td>
<td>First-Stage Boot Loader (FSBL)</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>1. HPS verifies the FPGA is in user mode.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>2. The FSBL initializes the HPS, including the SDRAM.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>3. The user application through the host must request the copy engine using the OPAE command hps to transfer the itb image (SSBL +Linux) to the HPS DRAM.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>4. HPS peripheral I/O pin mux and buffers are configured. Clocks, resets, and bridges are also configured.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>5. HPS I/O peripherals are available.</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>T4 to T5</td>
<td>Second-Stage Boot Loader (SSBL)</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>1. HPS bootstrap completes.</td>
</tr>
<tr>
<td></td>
<td></td>
<td>2. OS is loaded into SDRAM.</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>T5 to TBoot\Complete</td>
<td>Operating System (OS)</td>
<td>The OS boots and applications are scheduled for runtime launch.</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>When using the Pre-boot Execution Environment (PXE) boot mechanism, you must use an option ROM. <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> does not have PXE boot implemented in the HPS.</p>
<h3 id="25-authorization">2.5 Authorization<a class="headerlink" href="#25-authorization" title="Permanent link">&para;</a></h3>
<p>The HPS FSBL is part of the static region (SR) FPGA bitstream. Intel provides the capability to sign the FPGA bitstream binaries so that they can be authenticated when remotely updated and when configuring the FPGA. Signing of the SR bitstream is a two-stage process where you must sign with:</p>
<div class="highlight"><pre><span></span><code>1. `quartus_sign` tool
2. OPAE `PACSign` tool
</code></pre></div>
<p>Signing with PACSign ensures the security of the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> <abbr title="Remote System Update, A Remote System Update operation sends an instruction to the Intel FPGA PAC D5005 device that triggers a power cycle of the card only, forcing reconfiguration.">RSU</abbr> update process to the flash, and requires a compatible binary file. Quartus signing provides ensures security when the bitstream is configured through the SDM into the Intel Agilex FPGA device using Vendor Authorized Boot.</p>
<p>Vendor Authorized Bootloader (VAB) considers the SDM as a trusted root entity such that when firmware is authenticated and booted and is running on the SDM with dedicated crypto HW IP blocks, it is considered a trusted entity. As such it is trusted to perform the authentication and authorization steps for subsequent bitstreams.</p>
<p>Each subsequent loaded object after the SDM boot firmware does not need to re-implement the authentication and authorization functions. The authentication and authorization functions are centralized. Arm Trusted Firmware (ATF) is used to make a trusted execution environment (TEE) in the HPS. The source code for both Arm Trusted firmware and the First Stage Boot Loader (FSBL) is provided in the GitHub.</p>
<p>The SSBL + Linux is a part of an itb file and may also be signed with Quartus_sign and PACSign for authentication. This process is demonstrated in <a href="#92-configuring-the-hps"><strong>Section 9.2 Configuring the HPS</strong></a>.</p>
<h2 id="30-environment-setup">3.0 Environment Setup<a class="headerlink" href="#30-environment-setup" title="Permanent link">&para;</a></h2>
<h3 id="31-building-u-boot">3.1 Building U-Boot<a class="headerlink" href="#31-building-u-boot" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../images/Image3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/Image3.png" /></a></p>
<p>When creating a development environment using <code>meta-bake.py</code> both U-Boot and the patches required to work with the Intel N6000/1-PL FPGA SmartNIC Platform are located at <em>/meta-opae-fpga/tools/meta-bake/build/agilex-n6000-rootfs/tmp/work/agilex-poky-linux/u-boot-socfpga/1_v2021.07+gitAUTOINC+24e26ba4a0-r0/build/socfpga_agilex_n6000_defconfig</em>. To review the required patches applied to U-Boot, navigate to <em>/meta-opae-fpga/tools/meta-bake/build/agilex-n6000-rootfs/tmp/work/agilex-poky-linux/u-boot-socfpga/1_v2021.07+gitAUTOINC+24e26ba4a0-r0/git/patches</em>. From there, using git commands such as <code>git status</code> and <code>git branch</code> will show changes to the build environment. </p>
<p>Currently the <em>meta-bake</em> build flow requires a specific environment and software dependencies. Refer to section <a href="#61-running-meta-bakepy">6.1 Running meta-bake.py</a> for more information. </p>
<p>Invoke the <code>meta-bake.py</code> build script to build your entire image, including U-Boot.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/meta-opae-fpga/tools/meta-bake
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>$<span class="w"> </span>./meta-bake.py<span class="w"> </span>--conf<span class="w"> </span>n6000/layers.yaml<span class="w"> </span>builddir
</code></pre></div>
<p>This build process is highly system dependent and can take upwards of 1 hour to complete. Make sure you have at least 200 GB of free space on the system before running a build.</p>
<p>To build U-Boot manually after execution of <code>meta-bake.py</code> navigate to <em>/meta-bake/build/agilex-n6000-rootfs/tmp/work/agilex-poky-linux/u-boot-srcfpga/1_v2021.07+gitAUTOINC+24e26ba4a0-r0/build/socfpga_agilex_n6000_defconfig</em> and run <code>make</code>. After running meta-bake.py, you can rebuild U-Boot to incorporate any changes you have made. Navigate to the U-Boot directory at <em>/meta-opae-fpga/tools/meta-bake/build/agilex-n6000-rootfs/tmp/work/agilex-poky-linux/u-boot-socfpga/1_v2021.07+gitAUTOINC+24e26ba4a0-r0/build/socfpga_agilex_n6000_defconfig</em> and run the following commands to rebuild.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$<span class="w"> </span>wget<span class="w"> </span>https://developer.arm.com/-/media/Files/downloads/gnu-a/10.2-2020.11/binrel/gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>$<span class="w"> </span>tar<span class="w"> </span>xf<span class="w"> </span>gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>$<span class="w"> </span>rm<span class="w"> </span>gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">CROSS_COMPILE</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">ARCH</span><span class="o">=</span>arm64
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>$<span class="w"> </span>make<span class="w"> </span>-j<span class="w"> </span><span class="sb">`</span>nproc<span class="sb">`</span>
</code></pre></div>
<p>This recompile will result in a new ITB SSBL which may be loaded on an Intel FPGA SmartNIC N6000/1 platform. Several components of the ITB image are present under the U-Boot directory but are not rebuilt as a part of this flow. These files will need to be replaced before rebuilding U-Boot for changes to take affect.</p>
<p>U-Boot comes with its own <code>dumpimage</code> tool, which can be used to identify an image and extract and identify its contents. This tool is built by default under <em>/u-boot-socfpga/tools</em>, and in the <code>meta-bake.py</code> environment setup under <em>/meta-opae-fpga/tools/meta-bake/build/agilex-n6000-rootfs/tmp/work/agilex-poky-linux/u-boot-socfpga/1_v2021.07+gitAUTOINC+24e26ba4a0-r0/build/socfpga_agilex_n6000_defconfig/tools</em>. This tool can also be used to extract specific components of the ITB file.</p>
<h3 id="32-yocto">3.2 Yocto<a class="headerlink" href="#32-yocto" title="Permanent link">&para;</a></h3>
<p>Yocto is an open source toolkit used to create Linux distributions and commonly used for creating Linux images
and bootloaders for embedded environments. A Yocto build environment is made up of one or more layers, with each
layer consisting of recipes that get processed to build/install components in a layer. The workhorse of a Yocto
build is the program called <code>bitbake</code>. This program processes the recipes to compile and build packages and images
for the target platform. For SoC platforms, like the HPS, the ARM cross compiler is required.</p>
<p>The build script used for the Agilex SoC GSRD, <code>create-linux-distro-release</code>, is a bash script that automates the build
of Linux images of different types (gsrd, nand, etc.) that are compatible with a target FPGA platform (agilex, stratix10, etc.). This script has been ported to Python 3 and modified to build an environment for the Intel FPGA SmartNIC N6000/1 platform, named <code>meta-bake.py</code>. This script pulls in the necessary patches and additional changes needed to support the platform.</p>
<p>In general, <code>meta-bake.py</code> pulls Yocto layers/recipes from public repositories, configures a Yocto build environment, and builds an image for a supported FPGA platform. The Yocto layer is always the first to be built, and includes the <code>bitbake</code> utility. The following table lists remote repositories hosting Yocto meta data source used by <code>meta-bake.py</code> and <code>create-linux-distro</code> as well as source code used for building binaries that make up the Linux image (kernel and rootfs).</p>
<p><strong>Note:</strong> Not all repositories can be viewed in a web browser. All can be cloned using git.</p>
<table>
<thead>
<tr>
<th>Repository</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>https://git.yoctoproject.org/git/poky</td>
<td>Base build tools and meta data layers</td>
</tr>
<tr>
<td>https://git.openembedded.org/meta-openembedded</td>
<td>Layers for OE-core packages</td>
</tr>
<tr>
<td>https://git.yoctoproject.org/git/meta-intel-fpga</td>
<td>Meta data layers for Intel FPGA SoC platforms</td>
</tr>
<tr>
<td>https://github.com/altera-opensource/meta-intel-fpga-refdes</td>
<td>BSP layer for Intel SoC FPGA GSRD</td>
</tr>
<tr>
<td>https://github.com/altera-opensource/linux-socfpga</td>
<td>Linux kernel source repository for socfpga</td>
</tr>
<tr>
<td>https://github.com/altera-opensource/u-boot-socfpga</td>
<td>U-Boot bootloader source repository for socfpga</td>
</tr>
<tr>
<td>https://github.com/altera-opensource/arm-trusted-firmware</td>
<td>Source for ATF</td>
</tr>
</tbody>
</table>
<p>Recipes in the <em>meta-intel-fpga-refdes</em> layer mostly inherit from and extend recipes in other layers.
The following table lists the new or modified recipes (in <em>meta-intel-fpga-refdes</em>) necessary to support an Intel FPGA SmartNIC N6000/1 HPS boot image.</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Recipe</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Linux Kernel</td>
<td>recipes-kernel/linux/linux-socfpga-lts_5.10.bbappend</td>
<td>Recipe to append the GSRC SoC FPGA device tree to the Yocto build</td>
</tr>
<tr>
<td>U-Boot</td>
<td>recipes-bsp/u-boot/u-boot-socfpga_v2021.07.bbappend</td>
<td>Recipe to fetch and build socfpga U-Boot. Modified to support N6000/1 in U-Boot. This also creates a shell script, *mkuboot-fit.sh.</td>
</tr>
<tr>
<td>copy-engine</td>
<td>recipes-bsp/copy-engine/copy-engine-0.1.bb</td>
<td>New recipe to build copy-engine daemon in rootfs.</td>
</tr>
<tr>
<td>N6000/1 Image</td>
<td>recipes-images/poky/n6000-image-minimal.bb</td>
<td>New recipe to create the N6000/1 image with copy-engine and linuxptp packages installed.</td>
</tr>
</tbody>
</table>
<p><em>mkuboot-fit.sh</em> is meant to be called after a Yocto build to create the U-Boot FIT image for N6000/1, and is called automatically by <code>meta-bake.py</code>. This is a workaround for the Yocto
build order which builds the bootloader (U-Boot) before building the Linux image rootfs. Because the rootfs is part of the U-Boot FIT
image, the rootfs must be built before building the bootloader. The result of calling this script is copying the rootfs (as a .cpio file)
to the U-Boot source file tree and calling <code>make</code> in the U-Boot build tree. When called again with the rootfs present, the resulting image
will contain the rootfs. This is performed automatically as a part of the <code>meta-bake.py</code> build flow.</p>
<p>See <a href="https://www.yoctoproject.org">here</a> for more information regarding Yocto.
Several reference designs found in rocketboards.org use Yocto for building the Linux image and/or bootloader.
For the N6000/1 image and boot flow, the Yocto build
<a href="https://releases.rocketboards.org/release/2021.04/gsrd/tools/create-linux-distro-release">script</a> for the
<a href="https://rocketboards.org/foswiki/Documentation/AgilexSoCGSRD">Agilex SoC Golden System Reference Design</a> has
been adapted to automate building the boot loader, Linux Image, and filesystem needed to support N6000/1 devices.</p>
<h4 id="321-customizing-the-yocto-image">3.2.1 Customizing the Yocto Image<a class="headerlink" href="#321-customizing-the-yocto-image" title="Permanent link">&para;</a></h4>
<p>The following is a list of customizations made for building Yocto to run on the Intel FPGA SmartNIC N6000/1-PL platform.</p>
<h5 id="3211-extending-the-u-boot-recipe">3.2.1.1 Extending the U-Boot recipe<a class="headerlink" href="#3211-extending-the-u-boot-recipe" title="Permanent link">&para;</a></h5>
<p>A recipe extension file (recipes-bsb/u-boot/u-boot-socfpga_v2021.07.bbappend) has been added to the <em>meta-intel-fpga-refdes</em> layer
which accomplishes the following:</p>
<ul>
<li>Adds patches using Yocto's patching mechanism</li>
<li>Introduces a new U-Boot config, <em>socfpga_agilex_n6000_defconfig</em>, and associates it with a keyword, <code>agilex-n6000</code>, that can be
referenced in Yocto configuration files. These patches are necessary until those changes are merged into the public u-boot-socfpga
repository. This config works for both Smartnic Platforms.</li>
<li>Creates <em>mkuboot-fit.sh</em> script file with variables for U-Boot source and build directories that will get expanded
to the actual paths that Yocto uses for fetching/building U-Boot.
Along with this recipe file, relevant patch files have been added. Once the changes are in the U-Boot repository, the patches and
any references to them must be removed.</li>
</ul>
<h5 id="3212-patching-the-linux-kernel">3.2.1.2 Patching The Linux Kernel<a class="headerlink" href="#3212-patching-the-linux-kernel" title="Permanent link">&para;</a></h5>
<p>The kernel extension recipe, <em>meta-intel-fpga-refdes/recipes-kernel/linux/linux-socfpga-lts_5.10.bbappend</em>, in the <em>meta-intel-fpga-refdes</em> layer, has been
modified to add a patch file using Yocto's patching mechanism. This patch file adds the device tree for N6000/1 and is only
necessary until this change is merged into the public linux-socfpga repository.</p>
<h5 id="3213-adding-custom-user-space-software">3.2.1.3 Adding Custom User Space Software<a class="headerlink" href="#3213-adding-custom-user-space-software" title="Permanent link">&para;</a></h5>
<p>A new recipe, <em>meta-intel-fpga-refdes/recipes-bsp/copy-engine-0.1.bb</em> and relevant source files, have been added to the <em>meta-intel-fpga-refdes</em> layer.
This recipe includes instructions for building the copy-engine program as well as installing it as a systemd service.
Yocto will build this into an RPM package that gets installed into any image that includes it in the <code>IMAGE_INSTALL</code> variable.
This recipe may be used as a guide for installing additional user space software.</p>
<p>You may also create a new Hello World application and add it to the Yocto build as shown below.</p>
<ol>
<li>Generate a BSD 3-Clause License and create an MD5 hash of it.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>Copyright<span class="w"> </span><span class="o">(</span>c<span class="o">)</span><span class="w"> </span><span class="m">2023</span>,<span class="w"> </span>User<span class="err">&#39;</span>s<span class="w"> </span>Name<span class="w"> </span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>All<span class="w"> </span>rights<span class="w"> </span>reserved.<span class="w"> </span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>Redistribution<span class="w"> </span>and<span class="w"> </span>use<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">source</span><span class="w"> </span>and<span class="w"> </span>binary<span class="w"> </span>forms,<span class="w"> </span>with<span class="w"> </span>or<span class="w"> </span>without<span class="w"> </span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>modification,<span class="w"> </span>are<span class="w"> </span>permitted<span class="w"> </span>provided<span class="w"> </span>that<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>conditions<span class="w"> </span>are<span class="w"> </span>met:<span class="w"> </span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w"> </span>*<span class="w"> </span>Redistributions<span class="w"> </span>of<span class="w"> </span><span class="nb">source</span><span class="w"> </span>code<span class="w"> </span>must<span class="w"> </span>retain<span class="w"> </span>the<span class="w"> </span>above<span class="w"> </span>copyright<span class="w"> </span>notice,<span class="w"> </span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">   </span>this<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>conditions<span class="w"> </span>and<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>disclaimer.<span class="w"> </span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w"> </span>*<span class="w"> </span>Redistributions<span class="w"> </span><span class="k">in</span><span class="w"> </span>binary<span class="w"> </span>form<span class="w"> </span>must<span class="w"> </span>reproduce<span class="w"> </span>the<span class="w"> </span>above<span class="w"> </span>copyright<span class="w"> </span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">   </span>notice,<span class="w"> </span>this<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>conditions<span class="w"> </span>and<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>disclaimer<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">   </span>documentation<span class="w"> </span>and/or<span class="w"> </span>other<span class="w"> </span>materials<span class="w"> </span>provided<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>distribution.<span class="w"> </span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w"> </span>*<span class="w"> </span>Neither<span class="w"> </span>the<span class="w"> </span>name<span class="w"> </span>of<span class="w"> </span>Company<span class="w"> </span>Name<span class="w"> </span>nor<span class="w"> </span>the<span class="w"> </span>names<span class="w"> </span>of<span class="w"> </span>its<span class="w"> </span>contributors<span class="w"> </span>may<span class="w"> </span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">   </span>be<span class="w"> </span>used<span class="w"> </span>to<span class="w"> </span>endorse<span class="w"> </span>or<span class="w"> </span>promote<span class="w"> </span>products<span class="w"> </span>derived<span class="w"> </span>from<span class="w"> </span>this<span class="w"> </span>software<span class="w"> </span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">   </span>without<span class="w"> </span>specific<span class="w"> </span>prior<span class="w"> </span>written<span class="w"> </span>permission.<span class="w"> </span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>THIS<span class="w"> </span>SOFTWARE<span class="w"> </span>IS<span class="w"> </span>PROVIDED<span class="w"> </span>BY<span class="w"> </span>THE<span class="w"> </span>COPYRIGHT<span class="w"> </span>HOLDERS<span class="w"> </span>AND<span class="w"> </span>CONTRIBUTORS<span class="w"> </span><span class="s2">&quot;AS IS&quot;</span><span class="w"> </span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>AND<span class="w"> </span>ANY<span class="w"> </span>EXPRESS<span class="w"> </span>OR<span class="w"> </span>IMPLIED<span class="w"> </span>WARRANTIES,<span class="w"> </span>INCLUDING,<span class="w"> </span>BUT<span class="w"> </span>NOT<span class="w"> </span>LIMITED<span class="w"> </span>TO,<span class="w"> </span>THE<span class="w"> </span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>IMPLIED<span class="w"> </span>WARRANTIES<span class="w"> </span>OF<span class="w"> </span>MERCHANTABILITY<span class="w"> </span>AND<span class="w"> </span>FITNESS<span class="w"> </span>FOR<span class="w"> </span>A<span class="w"> </span>PARTICULAR<span class="w"> </span>PURPOSE<span class="w"> </span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>ARE<span class="w"> </span>DISCLAIMED.<span class="w"> </span>IN<span class="w"> </span>NO<span class="w"> </span>EVENT<span class="w"> </span>SHALL<span class="w"> </span>THE<span class="w"> </span>COPYRIGHT<span class="w"> </span>OWNER<span class="w"> </span>OR<span class="w"> </span>CONTRIBUTORS<span class="w"> </span>BE<span class="w"> </span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>LIABLE<span class="w"> </span>FOR<span class="w"> </span>ANY<span class="w"> </span>DIRECT,<span class="w"> </span>INDIRECT,<span class="w"> </span>INCIDENTAL,<span class="w"> </span>SPECIAL,<span class="w"> </span>EXEMPLARY,<span class="w"> </span>OR<span class="w"> </span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>CONSEQUENTIAL<span class="w"> </span>DAMAGES<span class="w"> </span><span class="o">(</span>INCLUDING,<span class="w"> </span>BUT<span class="w"> </span>NOT<span class="w"> </span>LIMITED<span class="w"> </span>TO,<span class="w"> </span>PROCUREMENT<span class="w"> </span>OF<span class="w"> </span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>SUBSTITUTE<span class="w"> </span>GOODS<span class="w"> </span>OR<span class="w"> </span>SERVICES<span class="p">;</span><span class="w"> </span>LOSS<span class="w"> </span>OF<span class="w"> </span>USE,<span class="w"> </span>DATA,<span class="w"> </span>OR<span class="w"> </span>PROFITS<span class="p">;</span><span class="w"> </span>OR<span class="w"> </span>BUSINESS<span class="w"> </span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>INTERRUPTION<span class="o">)</span><span class="w"> </span>HOWEVER<span class="w"> </span>CAUSED<span class="w"> </span>AND<span class="w"> </span>ON<span class="w"> </span>ANY<span class="w"> </span>THEORY<span class="w"> </span>OF<span class="w"> </span>LIABILITY,<span class="w"> </span>WHETHER<span class="w"> </span>IN<span class="w"> </span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>CONTRACT,<span class="w"> </span>STRICT<span class="w"> </span>LIABILITY,<span class="w"> </span>OR<span class="w"> </span>TORT<span class="w"> </span><span class="o">(</span>INCLUDING<span class="w"> </span>NEGLIGENCE<span class="w"> </span>OR<span class="w"> </span>OTHERWISE<span class="o">)</span><span class="w"> </span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>ARISING<span class="w"> </span>IN<span class="w"> </span>ANY<span class="w"> </span>WAY<span class="w"> </span>OUT<span class="w"> </span>OF<span class="w"> </span>THE<span class="w"> </span>USE<span class="w"> </span>OF<span class="w"> </span>THIS<span class="w"> </span>SOFTWARE,<span class="w"> </span>EVEN<span class="w"> </span>IF<span class="w"> </span>ADVISED<span class="w"> </span>OF<span class="w"> </span>THE<span class="w"> </span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>POSSIBILITY<span class="w"> </span>OF<span class="w"> </span>SUCH<span class="w"> </span>DAMAGE.<span class="w"> </span>
</code></pre></div>
<p>After license creation you will need to create an MD5 Hash of the clause. On Linux you can either pipe the raw text into <code>echo "text" | md5sum</code>, or create a new file and point to it <code>md5sum licensefile.txt</code>.</p>
<ol>
<li>Create a BB recipe file, following the same directory structure as other Yocto recipes.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/meta-opae-fpga/tools/meta-bake/build/meta-intel-fpga-refdes
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>recipe-example/helloworld<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>recipe-example/helloworld
</code></pre></div>
<p>Create recipe file <code>helloworld.bb</code> in directory <em>helloworld</em>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">SUMMARY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Example hello world&quot;</span><span class="w"> </span><span class="n">DESCRIPTION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;helloworld in HPS&quot;</span><span class="w"> </span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">AUTHOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Your Name &lt;your.email@address.com&gt;&quot;</span><span class="w"> </span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="n">LICENSE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BSD-3-Clause&quot;</span><span class="w"> </span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="n">LIC_FILES_CHKSUM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;file://${COMMON_LICENSE_DIR}/BSD-3-Clause;md5=&lt;Your MD5 Hash&gt;&quot;</span><span class="w"> </span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="n">inherit</span><span class="w"> </span><span class="n">systemd</span><span class="w"> </span><span class="n">pkgconfig</span><span class="w"> </span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="n">SRC_URI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;file://helloworld.c&quot;</span><span class="w"> </span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;${WORKDIR}&quot;</span><span class="w"> </span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="n">do_compile</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">        </span><span class="n">$</span><span class="p">{</span><span class="n">CC</span><span class="p">}</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">CFLAGS</span><span class="p">}</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">LDFLAGS</span><span class="p">}</span><span class="w"> </span><span class="n">helloworld</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">helloworld</span><span class="w"> </span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="p">}</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="n">do_install</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">        </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">D</span><span class="p">}</span><span class="n">$</span><span class="p">{</span><span class="n">bindir</span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">        </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="mo">0755</span><span class="w"> </span><span class="n">helloworld</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">D</span><span class="p">}</span><span class="n">$</span><span class="p">{</span><span class="n">bindir</span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<ol>
<li>Create source file <code>helloworld.c</code> in the same <em>helloworld</em> directory.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="c1"> </span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="nf">void</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="n">Printf</span><span class="p">(</span><span class="err">“\</span><span class="n">nHello</span><span class="w"> </span><span class="n">World</span><span class="err">\</span><span class="n">n</span><span class="err">”</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<ol>
<li>Re-run <code>./meta-bake.py --conf n6000/layers.yaml &lt;Build Directory&gt;</code>. This will a new programmable SSBL that contains your Hello World program. Program the resulting ITB file as shown in <a href="#43-example-boot"><strong>Section 4.3 Example Boot</strong></a> and verify the application has been included in your build.</li>
</ol>
<h5 id="3214-adding-kernel-driver-software">3.2.1.4 Adding Kernel Driver Software<a class="headerlink" href="#3214-adding-kernel-driver-software" title="Permanent link">&para;</a></h5>
<p>New recipes for custom kenel modules can be created at <em>/build/meta-intel-fpga-refdes/recipes-kernel/linux/</em>, and instructed to include custom module code. These can be patched in, included as a part of a new branch, or included by default if upstreamed. For more information visit the YoctoProject's <a href="https://docs.yoctoproject.org/2.6/kernel-dev/kernel-dev.html">Linux Kernel Development Manual</a>. An example file from N6000/1 that can be used as an example is <em>/build/meta-intel-fpga-refdes/recipes-kernel/linux/linux-socfpga-lts_5.10.bbappend</em>.</p>
<h5 id="3215-creating-an-image-type">3.2.1.5 Creating an Image Type<a class="headerlink" href="#3215-creating-an-image-type" title="Permanent link">&para;</a></h5>
<p>A new recipe, <em>meta-intel-fpga-refdes/recipes-images/poky/n6000-image-minimal.bb</em>, has been added that includes directives to install the copy-engine
package (built in this layer) as well as the <code>linuxptp</code> package (available in other layers). In addition to including these
packages, this recipe includes a rootfs post processing command that removes the Linux kernel image files from the rootfs.
This is done because the Linux kernel is part of the U-Boot FIT image and therefore not used from the rootfs. Removing this
redundant file reduces the final U-Boot FIT image by about 30Kb. This recipe may be modified or used as a guide to add additional
user space software.</p>
<h5 id="3216-testing-and-debugging">3.2.1.6 Testing and Debugging<a class="headerlink" href="#3216-testing-and-debugging" title="Permanent link">&para;</a></h5>
<p>As mentioned previously, the script will erase source files every time it is executed. This means that any changes
made locally will be lost when the script is run again after making these changes. The example below shows how to
test local changes without executing the script again.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>poky/oe-init-build-env<span class="w"> </span>agilex-gsrd-rootfs/
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>$<span class="w"> </span>bitbake<span class="w"> </span>n6000-image-minimal
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>$<span class="w"> </span>./agilex-n6000-rootfs/tmp/deploy/images/agilex/mkuboot-fit.sh
</code></pre></div>
<h2 id="40-booting-the-hps">4.0 Booting the HPS<a class="headerlink" href="#40-booting-the-hps" title="Permanent link">&para;</a></h2>
<h3 id="41-ofs-fim-boot-overview">4.1 <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Boot Overview<a class="headerlink" href="#41-ofs-fim-boot-overview" title="Permanent link">&para;</a></h3>
<p>This implementation of an FPGA First boot flow requires that the FSBL poll on a given register before continuing to boot the HPS. Once this register indicates it is (copy engine) ready, the FSBL loads a monolithic U-Boot FIT image at a given offset 0x02000000.</p>
<p>This image is made up of the following components:</p>
<ul>
<li>U-Boot bootloader also referred to as second stage bootloader</li>
<li>Linux Kernel image</li>
<li>Root filesystem (rootfs) consisting of kernel modules as well as user space software.</li>
</ul>
<h3 id="42-booting-ofs-fim-for-intel-agilex-fpga">4.2 Booting <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> for Intel Agilex FPGA<a class="headerlink" href="#42-booting-ofs-fim-for-intel-agilex-fpga" title="Permanent link">&para;</a></h3>
<p>As mentioned before, the Intel N6000/1-PL FPGA SmartNIC boot flow is an FPGA-first boot flow which requires that the Intel Agilex FPGA to be configured with the necessary components (SPL/FSBL, copyengine) in order for the HPS to boot.</p>
<p>SD/eMMC is not supported for FSBL for HPS first</p>
<ul>
<li>First Stage Bootloader (FSBL): u-boot-spl-dtb.hex is embedded into FPGA image</li>
<li>Monolithic FIT Image Downloaded from Host, u-boot.itb contains the following components<p>1) Second Stage Bootloader (SSBL): U-Boot + U-Boot Device Tree</p>
<p>2) Linux kernel, Image, + Linux Device Tree</p>
<p>3) Linux RAM based Root File System</p>
</li>
</ul>
<ul>
<li>First Stage Bootloader (FSBL) is U-boot-spl</li>
<li>U-boot-spl is built when U-Boot is built</li>
<li>Artifact is u-boot-spl-dtb.hex<ul>
<li>The user has to check into build location : <a href="https://github.com/OFS/ofs-n6001/blob/45a7dfbcdac16131aabf392457cfbbd51631888e/syn/setup/vab_sw/u-boot-spl-dtb.hex#L4">ofs-n6001/syn/setup/vab_sw/u-boot-spl-dtb.hex</a></li>
<li>Then run the command</li>
<li>quartus/pfg -c -o hps/path=u-boot-spl-dtb.hex orig.sof orig/fsbl.sof</li>
</ul>
</li>
</ul>
<p>Things to consider while developing your ITB image:</p>
<div class="highlight"><pre><span></span><code>- The size of the u-boot.itb matters.
- FIT is downloaded to [0x2000000](https://github.com/altera-opensource/u-boot-socfpga/blob/541b6afcb183ddb350ad367c9b63cc6db94c1f6e/configs/socfpga_agilex_n6010_defconfig#L4)
- Linux Device Tree and RootFS are unpacked to high memory
- Linux is unpacked to an address specified in the FIT, [0xb600000](https://github.com/altera-opensource/u-boot-socfpga/blob/541b6afcb183ddb350ad367c9b63cc6db94c1f6e/arch/arm/dts/socfpga_agilex_n6010-u-boot.dtsi#L4)
- If size of u-boot.itb is greater than 0xb600000 – 0x2000000, then FIT will be corrupted mid extraction, resulting in unpredictable kernel crashes.
</code></pre></div>
<p>This example assumes the following preconditions have been met prior to booting HPS:</p>
<p>1) A SOF file synthesized with the SPL (u-boot-spl-dtb.hex).</p>
<p>2) Copy engine IP with relevant registers accessible to host and HPS.</p>
<p>Once the host FPGA boots with the required bitstream, the SPL in the HPS begins polling a register in the copy engine. One way to get an indication that the HPS is ready to continue past the SPL is to use a terminal emulator on a host with a serial cable connected to the FPGA's UART port. To transfer the U-Boot FIT image, use the <code>hps cpeng</code> subcommand from the host. Note, the <code>hps</code> program can be installed as part of installing the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> and Linux <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> suite of packages.</p>
<p><code>hps</code> command details are located in <a href="#50-hps-command-usage"><strong>Section 5.0 HPS Command Usage</strong></a>.</p>
<h3 id="43-example-boot">4.3 Example Boot<a class="headerlink" href="#43-example-boot" title="Permanent link">&para;</a></h3>
<p>This example assumes the following preconditions have been met prior to booting HPS:</p>
<ul>
<li>A SOF file synthesized with the SPL (u-boot-spl-dtb.hex).</li>
<li>Copy engine IP with relevant registers accessible to host and HPS.</li>
</ul>
<p>Once the host FPGA boots with the required bitstream, the SPL in the HPS will begin polling a register in the copy engine.
One way to get an indication that the HPS is ready to continue past the SPL is to use a terminal emulator on a host with a
serial cable connected to the FPGA's UART port.</p>
<p>To transfer the U-Boot FIT image, use the <code>hps</code> program with <code>cpeng</code> subcommand from the host.
Note, the <code>hps</code> program is installed as part of installing the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> suite of packages.
See <a href="https://github.com/OPAE/opae-sdk/tree/master/ofs/apps/cpeng#readme">here</a> for information on running the <code>hps</code> program. The following example assumes your N6000/1 board is at PCIe BDF <em>0000:b1:00.0</em>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># Bind vfio-pci driver to Copy Engine PCIe Physical Function</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span>b1:00.4<span class="w"> </span>root
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="c1"># Load the HPS SSBL</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>$<span class="w"> </span>hps<span class="w"> </span>cpeng<span class="w"> </span>-f<span class="w"> </span>u-boot.itb
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="o">[</span><span class="m">2021</span>-09-25<span class="w"> </span><span class="m">01</span>:59:25.538<span class="o">]</span><span class="w"> </span><span class="o">[</span>cpeng<span class="o">]</span><span class="w"> </span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>starting<span class="w"> </span>copy<span class="w"> </span>of<span class="w"> </span>file:u-boot.itb,<span class="w"> </span>size:<span class="w"> </span><span class="m">116725656</span>,<span class="w"> </span>chunk<span class="w"> </span>size:<span class="w"> </span><span class="m">4096</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="o">[</span><span class="m">2021</span>-09-25<span class="w"> </span><span class="m">01</span>:59:29.935<span class="o">]</span><span class="w"> </span><span class="o">[</span>cpeng<span class="o">]</span><span class="w"> </span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>last<span class="w"> </span>chunk<span class="w"> </span><span class="m">1944</span>,<span class="w"> </span>aligned<span class="w"> </span><span class="m">2048</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="o">[</span><span class="m">2021</span>-09-25<span class="w"> </span><span class="m">01</span>:59:29.935<span class="o">]</span><span class="w"> </span><span class="o">[</span>cpeng<span class="o">]</span><span class="w"> </span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>transferred<span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">28498</span><span class="w"> </span>chunk<span class="o">(</span>s<span class="o">)</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="o">[</span><span class="m">2021</span>-09-25<span class="w"> </span><span class="m">01</span>:59:29.935<span class="o">]</span><span class="w"> </span><span class="o">[</span>cpeng<span class="o">]</span><span class="w"> </span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>ssbl<span class="w"> </span>verify...
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="o">[</span><span class="m">2021</span>-09-25<span class="w"> </span><span class="m">01</span>:59:33.848<span class="o">]</span><span class="w"> </span><span class="o">[</span>cpeng<span class="o">]</span><span class="w"> </span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>ssbl<span class="w"> </span>verified
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="o">[</span><span class="m">2021</span>-09-25<span class="w"> </span><span class="m">01</span>:59:33.848<span class="o">]</span><span class="w"> </span><span class="o">[</span>cpeng<span class="o">]</span><span class="w"> </span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>kernel<span class="w"> </span>verify...
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="o">[</span><span class="m">2021</span>-09-25<span class="w"> </span><span class="m">01</span>:59:39.626<span class="o">]</span><span class="w"> </span><span class="o">[</span>cpeng<span class="o">]</span><span class="w"> </span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>kernel<span class="w"> </span>verified
</code></pre></div>
<p>This will transfer the U-Boot FIT image via the copy engine IP to the HPS DDR and then signal completion of the transfer to the
copy engine. Once the copy engine completes the actual transfer, it will write to the register the HPS SPL is polling on allowing
the SPL to load the U-Boot bootloader which will in turn boot into the Linux image embedded in the U-Boot FIT image.
If a terminal emulator is connected to the UART as described above, a user can observe U-Boot and Linux running on the HPS.</p>
<ol>
<li>Validate the HPS SSBL has been loaded by checking for its heartbeat.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>$<span class="w"> </span>hps<span class="w"> </span>heartbeat
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="o">[</span><span class="m">2021</span>-09-25<span class="w"> </span><span class="m">01</span>:59:42.722<span class="o">]</span><span class="w"> </span><span class="o">[</span>heartbeat<span class="o">]</span><span class="w"> </span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>heartbeat<span class="w"> </span>value:<span class="w"> </span>0x30015
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="o">[</span><span class="m">2021</span>-09-25<span class="w"> </span><span class="m">01</span>:59:43.722<span class="o">]</span><span class="w"> </span><span class="o">[</span>heartbeat<span class="o">]</span><span class="w"> </span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>heartbeat<span class="w"> </span>value:<span class="w"> </span>0x40015
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="o">[</span><span class="m">2021</span>-09-25<span class="w"> </span><span class="m">01</span>:59:44.722<span class="o">]</span><span class="w"> </span><span class="o">[</span>heartbeat<span class="o">]</span><span class="w"> </span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>heartbeat<span class="w"> </span>value:<span class="w"> </span>0x50015
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="o">[</span><span class="m">2021</span>-09-25<span class="w"> </span><span class="m">01</span>:59:45.723<span class="o">]</span><span class="w"> </span><span class="o">[</span>heartbeat<span class="o">]</span><span class="w"> </span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>heartbeat<span class="w"> </span>value:<span class="w"> </span>0x60015
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="o">[</span><span class="m">2021</span>-09-25<span class="w"> </span><span class="m">01</span>:59:46.723<span class="o">]</span><span class="w"> </span><span class="o">[</span>heartbeat<span class="o">]</span><span class="w"> </span><span class="o">[</span>info<span class="o">]</span><span class="w"> </span>heartbeat<span class="w"> </span>value:<span class="w"> </span>0x70015
</code></pre></div>
<ol>
<li>Login to HPS as user, root, with no password over serial connection. This process is covered in <a href="#8.0-connecting-remotely-to-the-hps-using-ssh"><strong>8.0 Connecting remotely to the HPS using <code>ssh</code></strong></a>.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>agilex<span class="w"> </span>login:<span class="w"> </span>root
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>root@agilex:~#<span class="w"> </span>ls
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>root@agilex:~#<span class="w"> </span>ls<span class="w"> </span>/
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>bin<span class="w"> </span>dev<span class="w"> </span>home<span class="w"> </span>lib<span class="w"> </span>mnt<span class="w"> </span>root<span class="w"> </span>sbin<span class="w"> </span>sys<span class="w"> </span>usr
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>boot<span class="w"> </span>etc<span class="w"> </span>init<span class="w"> </span>media<span class="w"> </span>proc<span class="w"> </span>run<span class="w"> </span>srv<span class="w"> </span>tmp<span class="w"> </span>var
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>root@agilex:~#
</code></pre></div>
<h2 id="50-hps-command-usage">5.0 HPS Command Usage<a class="headerlink" href="#50-hps-command-usage" title="Permanent link">&para;</a></h2>
<h3 id="51-synopsis">5.1 Synopsis<a class="headerlink" href="#51-synopsis" title="Permanent link">&para;</a></h3>
<pre>hps OPTIONS SUBCOMMAND SUBCOMMAND\_OPTIONS</pre>

<h3 id="52-description">5.2 Description<a class="headerlink" href="#52-description" title="Permanent link">&para;</a></h3>
<p>hps is an application to aid in the development, deployment, and debugging of an HPS (hard processor system) on an Intel Agilex device using <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>. The current version of the hps program assumes an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> (accelerator functional unit) is configured into the FPGA that can be discovered/accessed through an OPAE library and used for communicating with the HPS. When invoked with one of its subcommands, hps will enumerate the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> for that subcommand before executing it.</p>
<h3 id="53-options">5.3 Options<a class="headerlink" href="#53-options" title="Permanent link">&para;</a></h3>
<pre>-h,--help

Print this help message and exit

-p,--pci-address address

Use address in the filter for locating the AFU where address must be in

the following format: [domain]\bus\:\device\.\function\

-l,--log-level \level\

stdout logging level. Must be one of:

{trace,debug,info,warning,error,critical,off}

Default is info.

-s,--shared

open in shared mode, default is off

-t,--timeout timeout

Program timeout in milliseconds. Default is 60000 ms.</pre>

<h3 id="54-subcommands">5.4 Subcommands<a class="headerlink" href="#54-subcommands" title="Permanent link">&para;</a></h3>
<h4 id="541-cpeng">5.4.1 cpeng<a class="headerlink" href="#541-cpeng" title="Permanent link">&para;</a></h4>
<p>The copy engine command is used to program copy engine <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> registers to copy an image file from the host into the FPGA DDR.
When the HPS boots, the first stage boot loader loads an image
from a specific offset in DDR that will be used to transition into the second
stage boot loader and subsequently boot into the embedded Linux that is also
part of this image.</p>
<table>
<thead>
<tr>
<th>cpeng  options</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-h,--help</td>
<td>Print this help message and exit</td>
</tr>
<tr>
<td>-f,--filename filename</td>
<td>Path to image file to copy. Default is u-boot.itb</td>
</tr>
<tr>
<td>-d,--destination offset</td>
<td>DDR Offset. Default is 0x2000000.</td>
</tr>
<tr>
<td>-t,--timeout cpeng timeout</td>
<td>Timeout of cpeng command in microseconds. Default is 1 sec (1000000 usec).</td>
</tr>
<tr>
<td>-r,--data-request-limit size</td>
<td>Can be 64, 128, 512, or 1024 and represents the PCIe request size in bytes that the copy engine IP will use. This is encoded to 0, 1, 2, or 3 and written to the copy engine DATA\REQUEST\LIMIT register. Default is 512.</td>
</tr>
<tr>
<td>-c,--chunk size</td>
<td>Split the copy into chunks of size size. 0 indicates no chunks. Chunk sizes must be aligned with data request limit. Default is 4096.</td>
</tr>
<tr>
<td>--soft-reset</td>
<td>Issue a soft reset only.</td>
</tr>
<tr>
<td>--skip-ssbl-verify</td>
<td>Do not wait for ssbl verify.</td>
</tr>
<tr>
<td>--skip-kernel-verify</td>
<td>Do now wait for kernel verify.</td>
</tr>
</tbody>
</table>
<h4 id="542-heartbeat">5.4.2 heartbeat<a class="headerlink" href="#542-heartbeat" title="Permanent link">&para;</a></h4>
<p>This subcommand reads the value in the HPS2HOST register
to check for a hearbeat. This compares the value to previous value
read and determines the HPS is alive if the value is incrementing.
This relies on the hps running the hello-cpeng program in <em>heartbeat</em>
mode which will increment the upper 16 bits in the HPS2HOST register.
Please see a typical sequence of using the rsu and hps commands as below for a device with BDF 15:00:0</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>rsu<span class="w"> </span>fpga<span class="w"> </span>-p<span class="w"> </span>user1<span class="w"> </span><span class="m">15</span>:00.0
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>sudo<span class="w"> </span>opae.io<span class="w"> </span>release<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.4<span class="w"> </span>root:root
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>hps<span class="w"> </span>cpeng<span class="w"> </span>-f<span class="w"> </span>u-boot-userkey-vab.itb
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>timeout<span class="w"> </span><span class="m">5</span><span class="w"> </span>hps<span class="w"> </span>heartbeat
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>sudo<span class="w"> </span>opae.io<span class="w"> </span>release<span class="w"> </span>-d<span class="w"> </span><span class="m">15</span>:00.0
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>hps<span class="w"> </span>cpeng<span class="w"> </span>-f<span class="w"> </span>u-boot-userkey-vab.itb
</code></pre></div>
<p>The above command will transfer the U-Boot FIT image via the copy engine IP to the HPS DDR and then signal completion of the transfer to the copy engine. After the copy engine completes the actual transfer, it writes to the register the HPS SPL is polling on allowing the SPL to load the U-Boot bootloader which in turn boots into the Linux image embedded in the U-Boot FIT image. If a terminal emulator is connected to the UART as described above, a user can observe U-Boot and Linux running on the HPS.</p>
<p>First FSBL is loaded and executed by FPGA configuration. Then Board/Server gets powered on. FPGA Configuration is done via <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> followed by a reboot</p>
<p>The FSBL will send the following output the serial port:
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>U-Boot<span class="w"> </span>SPL<span class="w"> </span><span class="m">2021</span>.07-00312-g32c0556437<span class="w"> </span><span class="o">(</span>Sep<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">2021</span><span class="w"> </span>-<span class="w"> </span><span class="m">08</span>:42:45<span class="w"> </span>-0700<span class="o">)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>Reset<span class="w"> </span>state:<span class="w"> </span>Cold
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>MPU<span class="w"> </span><span class="m">1200000</span><span class="w"> </span>kHz
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>L4<span class="w"> </span>Main<span class="w"> </span><span class="m">400000</span><span class="w"> </span>kHz
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>L4<span class="w"> </span>sys<span class="w"> </span>free<span class="w"> </span><span class="m">100000</span><span class="w"> </span>kHz
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>L4<span class="w"> </span>MP<span class="w"> </span><span class="m">200000</span><span class="w"> </span>kHz
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>L4<span class="w"> </span>SP<span class="w"> </span><span class="m">100000</span><span class="w"> </span>kHz
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>SDMMC<span class="w"> </span><span class="m">50000</span><span class="w"> </span>kHz
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>DDR:<span class="w"> </span>Warning:<span class="w"> </span>DRAM<span class="w"> </span>size<span class="w"> </span>from<span class="w"> </span>device<span class="w"> </span>tree<span class="w"> </span><span class="o">(</span><span class="m">1024</span><span class="w"> </span>MiB<span class="o">)</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>mismatch<span class="w"> </span>with<span class="w"> </span>hardware<span class="w"> </span><span class="o">(</span><span class="m">2048</span><span class="w"> </span>MiB<span class="o">)</span>.
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>DDR:<span class="w"> </span><span class="m">1024</span><span class="w"> </span>MiB
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>SDRAM-ECC:<span class="w"> </span>Initialized<span class="w"> </span>success<span class="w"> </span>with<span class="w"> </span><span class="m">239</span><span class="w"> </span>ms
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>host<span class="w"> </span>to<span class="w"> </span>copy<span class="w"> </span>image
</code></pre></div></p>
<h2 id="60-meta-bakepy">6.0 meta-bake.py<a class="headerlink" href="#60-meta-bakepy" title="Permanent link">&para;</a></h2>
<p>A script called <em>meta-bake.py</em> has been added to allow for more control of configuration/customization of recipes and their dependencies.
This script separates the data from the logic by requiring that data be expressed in a yaml configuration file. This file contains the
following confiration data:</p>
<ul>
<li>machine - The FPGA/SoC platform to build for, choices are agilex, stratix10, arria10, cyclone5</li>
<li>image - The image type to build, choices are gsrd, nand, pcie, pr, qsqpi, sgmii, tse, n6000</li>
<li>target - The build target to build. This is typically a Yocto image to build.</li>
<li>fit - Make a monolothic FIT image after the Yocto build. This will use U-Boot source and binaries as well as the rootfs made for the image.</li>
<li>repos - A list of repositories to pull for Yocto recipes. This information is made up of:<ul>
<li>name - The project name (this is also the directory where source is clone to)</li>
<li>url - The URL to pull the source from</li>
<li>branch - The branch to checkout</li>
<li>add_layers - Can be either True or a list of sub-directories to add as layers in bblayers.conf</li>
<li>patch - Path to a file to use to patch the source code</li>
<li>keep - When set to true, this will leave the source tree untouched on subsequent runs</li>
</ul>
</li>
<li>upstream_versions - Dependencies/versions to use for either Linux kernel, U-Boot, and/or ATF. This information is made up of:<ul>
<li>name - Project name</li>
<li>version - version to configure recipes that use it</li>
<li>branch - branch to use, will use git hash in recipe</li>
<li>url - URL to pull the source from</li>
<li>disabled - when set to True, this project will be ignored</li>
</ul>
</li>
<li>local - Used to configure local.conf used by Yocto/bitbake build. This information is made up of:<ul>
<li>remove - List of keys to remove from local.conf</li>
<li>values - Dictionary of key/value pairs to use to insert into local.conf. Any existing key/value pairs will be overwritten.</li>
</ul>
</li>
</ul>
<h3 id="61-running-meta-bakepy">6.1 Running meta-bake.py<a class="headerlink" href="#61-running-meta-bakepy" title="Permanent link">&para;</a></h3>
<p>To create an U-Boot fit and spl image for N6000/1 platforms, run the following command after meeting these setup conditions:</p>
<ul>
<li>Host PC with Ubuntu 20.04 LTS<ul>
<li>ARM cross compiler<ul>
<li>set CROSS_COMPILE environment variable to: <path to cross compiler>/bin/aarch64-linux-gnu-
    - e.x. export CROSS_COMPILE=aarch64-linux-gnu-</li>
<li>set ARCH to: arm64
    - e.x. export ARCH=arm64</li>
</ul>
</li>
</ul>
</li>
<li>At least 100 Gb of disk space</li>
<li>Tested on <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> 3.0.0</li>
</ul>
<p>This script does not require any bare-metal accesses to perform its build and can be run from a VM with no alterations. Ensure that the Ubuntu 20.04 Guest VM you create has enough to space to perform the entire build (recommend at least 200 GiB total space), as does the drive it is stored on. You will need to configure proxy access in the VM if required for your environment. You can use any VM technology; having <code>ssh</code> enabled in the VM will allow you to more easily transfer the completed build files back to the host system but is not required.</p>
<p>Package dependencies to build Yocto on each supported OS can be found on the <a href="https://docs.yoctoproject.org/1.8/yocto-project-qs/yocto-project-qs.html">Yocto Quick Start</a> page.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>wget<span class="w"> </span>https://developer.arm.com/-/media/Files/downloads/gnu-a/10.2-2020.11/binrel/gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>tar<span class="w"> </span>xf<span class="w"> </span>gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>rm<span class="w"> </span>gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu.tar.xz
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CROSS_COMPILE</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/gcc-arm-10.2-2020.11-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ARCH</span><span class="o">=</span>arm64
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>./meta-bake.py<span class="w"> </span>build
</code></pre></div>
<p>After running this build, the images you need to boot the HPS are located under build/agilex-n6000-images. Follow the steps in <a href="#43-example-boot"><strong>Section 4.3 Example Boot</strong></a> to finish bringing up your board.</p>
<p>This script will do the following:</p>
<ul>
<li>Parse layers.yaml for configuration to use for build</li>
<li>Download recipe repositories (including poky) listed in <code>repos</code> secion of layers.yaml</li>
<li>Apply refdes-n6000 patch to meta-intel-fpga-refdes source tree</li>
<li>Configure Yocto build in build directory</li>
<li>Source build/poky/oe-init-build-env passing in agilex-n6000-rootfs. This will initialize conf files.</li>
<li>Configure build/agilex-n6000-rootfs/conf/local.conf using values in <code>local</code> section of layers.yaml
         * <em>Note</em>: IMAGE_FSTYPES is configured to include <code>cpio</code></li>
<li>Configure build/agilex-n6000-rootfs/conf/bblayers.conf using layer specification in <code>repos</code> section of layers.yaml</li>
<li>Run Yocto build for target listed in layers.conf</li>
<li>Call <code>bitbake n6000-image-minimal</code></li>
<li>Get environment variables to locate rootfs cpio file as well as U-Boot source and build directories</li>
<li>Copy rootfs created by Yocto build for U-Boot</li>
<li>Copy rootfs cpio file (n6000-image-minimal-agilex*.rootfs.cpio) to U-Boot build directory for selected configuration (socfpga_agilex_n6000_defconfig)</li>
<li>Call U-Boot build in directory for selected configuration</li>
<li>Copy FIT image (u-boot.itb) to images directory, build/agilex-n6000-images</li>
<li>Many important images are copied to <em>build/agilex-n6000-images</em>, which may be useful if using VAB</li>
</ul>
<h3 id="62-required-changes">6.2 Required Changes<a class="headerlink" href="#62-required-changes" title="Permanent link">&para;</a></h3>
<p>The patch file applied on top of the <em>meta-intel-fpga-refdes</em> repository introduces patches to:</p>
<ul>
<li>Add patch files so that Yocto can modify Linux kernel to add configuration for creating a device tree binary (DTB) compatible with N6000/1</li>
<li>Add patch files so that Yocto can modify the bootloader in U-Boot to support booting with the assistance of the copy engine IP</li>
<li>Modify rootfs to include copy-engine daemon as well as other packages that can be useful for debug</li>
</ul>
<p>These changes may eventually be merged into upstream repositories for <em>linux-socfpga</em>, <em>u-boot-socfpga</em>, and <em>meta-intel-fpga-refdes</em>.
Once all changes make their way into the repositories for the aforementioned projects, it will no longer be necessary to apply patches.</p>
<h3 id="63-manual-build">6.3 Manual Build<a class="headerlink" href="#63-manual-build" title="Permanent link">&para;</a></h3>
<p>One may use <code>meta-bake.py</code> to only pull down required repositories and configure a Yocto build environment by using the <em>--skip-build</em> command line argument.
To initiate a build after this, <code>source poky/oe-init-build-env</code> passing in a directory as the only argument.
This will set up the user's environment to be able to run bitbake.
To build the Yocto image, run <code>bitbake n6000-image-minimal</code>.
This will build all the components necessary to build a FIT image.
Once the build is complete, U-Boot make system may be used to make the FIT.
The U-Boot build directory for the selected configuration can be found in the Yocto build environment directory at:
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>tmp/work/agilex-poky-linux/u-boot-socfpga/1_v2021.07+gitAUTOINC+24e26ba4a0-r0/build/socfpga_agilex_n6000_defconfig
</code></pre></div>
Once in this directory, ensure that the necessary files are present in here in order to assemble the FIT image (u-boot.itb)
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>$<span class="w"> </span>cp<span class="w"> </span>../../../../../../deploy/images/agilex/n6000-image-minimal-agilex.cpio<span class="w"> </span>rootfs.cpio
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>$<span class="w"> </span>ls<span class="w"> </span>Image<span class="w"> </span>linux.dtb<span class="w"> </span>rootfs.cpio
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>Image<span class="w">  </span>linux.dtb<span class="w">  </span>rootfs.cpio
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>$<span class="w"> </span>make
</code></pre></div></p>
<h3 id="64-manual-vab-signing">6.4 Manual VAB Signing<a class="headerlink" href="#64-manual-vab-signing" title="Permanent link">&para;</a></h3>
<ul>
<li>By default, <code>meta-bake.py</code> will sign and certify the proper files for use with VAB. Below is an example on how to perform the manual <a href="https://rocketboards.org/foswiki/Documentation/IntelAgilexSoCSecureBootDemoDesign#:~:text=5.%20Generate%20Signature,qky/software0_cancel3.qky">VAB Signing Process</a>.</li>
</ul>
<p>Make sure Quartus already installed and its tools added to environment. Example PATH=$PATH:/home/intelFPGA\pro/21.3/quartus/bin/</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>HPS_VAB
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>$<span class="w"> </span>quartus_sign<span class="w"> </span>--family<span class="o">=</span>agilex<span class="w"> </span>--operation<span class="o">=</span>make_private_pem<span class="w"> </span>--curve<span class="o">=</span>secp384r1<span class="w"> </span>--no_passphrase<span class="w"> </span>userkey_root_private.pem
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>$<span class="w"> </span>quartus_sign<span class="w"> </span>--family<span class="o">=</span>agilex<span class="w"> </span>--operation<span class="o">=</span>make_public_pem<span class="w"> </span>userkey_root_private.pem<span class="w"> </span>userkey_root_public.pem
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>$<span class="w"> </span>quartus_sign<span class="w"> </span>--family<span class="o">=</span>agilex<span class="w"> </span>--operation<span class="o">=</span>make_rootuserkey_root_public.pem<span class="w"> </span>userkey_root_public.qky
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>$<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>fcs_prepare
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>$<span class="w"> </span>./fcs_prepare<span class="w"> </span>--hps_cert<span class="w"> </span>bl31.bin<span class="w"> </span>-v
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>$<span class="w"> </span>quartus_sign<span class="w"> </span>--family<span class="o">=</span>agilex<span class="w"> </span>--operation<span class="o">=</span>SIGN<span class="w"> </span>--qky<span class="o">=</span>userkey_root_public.qky<span class="w"> </span>--pem<span class="o">=</span>userkey_root_private.pem<span class="w"> </span>unsigned_cert.ccert<span class="w"> </span>signed_cert_bl31.bin.ccert
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="c1"># ATF Sign</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>$<span class="w"> </span>./fcs_prepare<span class="w"> </span>--finish<span class="w"> </span>signed_cert_bl31.bin.ccert<span class="w"> </span>--imagefile<span class="w"> </span>bl31.bin
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>$<span class="w"> </span>mv<span class="w"> </span>hps_image_signed.vab<span class="w"> </span>signed-bl31.bin
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>$<span class="w"> </span>rm<span class="w"> </span>unsigned_cert.ccert
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="c1"># u-boot-nodtb</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>$<span class="w"> </span>./fcs_prepare<span class="w"> </span>--hps_cert<span class="w"> </span>u-boot-nodtb.bin<span class="w"> </span>-v
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="c1">#signed_u-boot-nodtb.bin.ccert</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>$<span class="w"> </span>quartus_sign<span class="w"> </span>--family<span class="o">=</span>agilex<span class="w"> </span>--operation<span class="o">=</span>SIGN<span class="w"> </span>--qky<span class="o">=</span>userkey_root_public.qky<span class="w"> </span>--pem<span class="o">=</span>userkey_root_private.pem<span class="w"> </span>unsigned_cert.ccert<span class="w"> </span>signed_u-boot-nodtb.bin.ccert
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="c1"># u-boot-nodtb.bin Sign</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>$<span class="w"> </span>./fcs_prepare<span class="w"> </span>--finish<span class="w"> </span>signed_u-boot-nodtb.bin.ccert<span class="w"> </span>--imagefile<span class="w"> </span>u-boot-nodtb.bin
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>$<span class="w"> </span>mv<span class="w"> </span>hps_image_signed.vab<span class="w"> </span>signed-u-boot-nodtb.bin
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>$<span class="w"> </span>rm<span class="w"> </span>unsigned<span class="se">\_</span>cert.ccert
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="c1"># u-boot.dtb</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>$<span class="w"> </span>./fcs_prepare<span class="w"> </span>--hps_cert<span class="w"> </span>u-boot.dtb<span class="w"> </span>-v
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="c1">#signed_u-boot.dtb.ccert</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>$<span class="w"> </span>quartus_sign<span class="w"> </span>--family<span class="o">=</span>agilex<span class="w"> </span>--operation<span class="o">=</span>SIGN<span class="w"> </span>--qky<span class="o">=</span>userkey_root_public.qky<span class="w"> </span>--pem<span class="o">=</span>userkey_root_private.pem<span class="w"> </span>unsigned_cert.ccert<span class="w"> </span>signed_u-boot.dtb.ccert
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="c1"># u-boot.dtb Sign</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a>$<span class="w"> </span>./fcs_prepare<span class="w"> </span>--finish<span class="w"> </span>signed_u-boot.dtb.ccert<span class="w"> </span>--imagefile<span class="w"> </span>u-boot.dtb
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a>$<span class="w"> </span>mv<span class="w"> </span>hps_image_signed.vab<span class="w"> </span>signed-u-boot.dtb
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a>$<span class="w"> </span>rm<span class="w"> </span>unsigned_cert.ccert
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="c1"># Image</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>$<span class="w"> </span>./fcs_prepare<span class="w"> </span>--hps/cert<span class="w"> </span>Image<span class="w"> </span>-v
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="c1">#signed_Image.ccert</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a>$<span class="w"> </span>quartus_sign<span class="w"> </span>--family<span class="o">=</span>agilex<span class="w"> </span>--operation<span class="o">=</span>SIGN<span class="w"> </span>--qky<span class="o">=</span>userkey_root_public.qky<span class="w"> </span>--pem<span class="o">=</span>userkey_root_private.pem<span class="w"> </span>unsigned_cert.ccert<span class="w"> </span>signed_Image.ccert
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a>
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a><span class="c1"># Image Sign</span>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a>$<span class="w"> </span>./fcs_prepare<span class="w"> </span>--finish<span class="w"> </span>signed_Image.ccert<span class="w"> </span>--imagefile<span class="w"> </span>Image
<a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a>$<span class="w"> </span>mv<span class="w"> </span>hps_image_signed.vab<span class="w"> </span>signed-Image
<a id="__codelineno-15-55" name="__codelineno-15-55" href="#__codelineno-15-55"></a>$<span class="w"> </span>rm<span class="w"> </span>unsigned_cert.ccert
<a id="__codelineno-15-56" name="__codelineno-15-56" href="#__codelineno-15-56"></a>
<a id="__codelineno-15-57" name="__codelineno-15-57" href="#__codelineno-15-57"></a><span class="c1"># linux.dtb</span>
<a id="__codelineno-15-58" name="__codelineno-15-58" href="#__codelineno-15-58"></a>
<a id="__codelineno-15-59" name="__codelineno-15-59" href="#__codelineno-15-59"></a>$<span class="w"> </span>./fcs_prepare<span class="w"> </span>--hps_cert<span class="w"> </span>linux.dtb<span class="w"> </span>-v
<a id="__codelineno-15-60" name="__codelineno-15-60" href="#__codelineno-15-60"></a>
<a id="__codelineno-15-61" name="__codelineno-15-61" href="#__codelineno-15-61"></a><span class="c1">#signed_linux.dtb.ccert</span>
<a id="__codelineno-15-62" name="__codelineno-15-62" href="#__codelineno-15-62"></a>
<a id="__codelineno-15-63" name="__codelineno-15-63" href="#__codelineno-15-63"></a>$<span class="w"> </span>quartus_sign<span class="w"> </span>--family<span class="o">=</span>agilex<span class="w"> </span>--operation<span class="o">=</span>SIGN<span class="w"> </span>--qky<span class="o">=</span>userkey_root_public.qky<span class="w"> </span>--pem<span class="o">=</span>userkey_root_private.pem<span class="w"> </span>unsigned_cert.ccert<span class="w"> </span>signed_linux.dtb.ccert
<a id="__codelineno-15-64" name="__codelineno-15-64" href="#__codelineno-15-64"></a>
<a id="__codelineno-15-65" name="__codelineno-15-65" href="#__codelineno-15-65"></a><span class="c1"># linux.dtb Sign</span>
<a id="__codelineno-15-66" name="__codelineno-15-66" href="#__codelineno-15-66"></a>
<a id="__codelineno-15-67" name="__codelineno-15-67" href="#__codelineno-15-67"></a>$<span class="w"> </span>./fcs_prepare<span class="w"> </span>--finish<span class="w"> </span>signed_linux.dtb.ccert<span class="w"> </span>--imagefile<span class="w"> </span>linux.dtb
<a id="__codelineno-15-68" name="__codelineno-15-68" href="#__codelineno-15-68"></a>$<span class="w"> </span>mv<span class="w"> </span>hps_image_signed.vab<span class="w"> </span>signed-linux.dtb
<a id="__codelineno-15-69" name="__codelineno-15-69" href="#__codelineno-15-69"></a>$<span class="w"> </span>rm<span class="w"> </span>unsigned_cert.ccert
<a id="__codelineno-15-70" name="__codelineno-15-70" href="#__codelineno-15-70"></a>
<a id="__codelineno-15-71" name="__codelineno-15-71" href="#__codelineno-15-71"></a><span class="c1"># rootfs.cpio</span>
<a id="__codelineno-15-72" name="__codelineno-15-72" href="#__codelineno-15-72"></a>
<a id="__codelineno-15-73" name="__codelineno-15-73" href="#__codelineno-15-73"></a>$<span class="w"> </span>./fcs_prepare<span class="w"> </span>--hps_cert<span class="w"> </span>rootfs.cpio<span class="w"> </span>-v
<a id="__codelineno-15-74" name="__codelineno-15-74" href="#__codelineno-15-74"></a>
<a id="__codelineno-15-75" name="__codelineno-15-75" href="#__codelineno-15-75"></a><span class="c1">#signed_rootfs.cpio.ccert</span>
<a id="__codelineno-15-76" name="__codelineno-15-76" href="#__codelineno-15-76"></a>
<a id="__codelineno-15-77" name="__codelineno-15-77" href="#__codelineno-15-77"></a>$<span class="w"> </span>quartus_sign<span class="w"> </span>--family<span class="o">=</span>agilex<span class="w"> </span>--operation<span class="o">=</span>SIGN<span class="w"> </span>--qky<span class="o">=</span>userkey_root_public.qky<span class="w"> </span>--pem<span class="o">=</span>userkey_root_private.pem<span class="w"> </span>unsigned_cert.ccert<span class="w"> </span>signed_rootfs.cpio.ccert
<a id="__codelineno-15-78" name="__codelineno-15-78" href="#__codelineno-15-78"></a>
<a id="__codelineno-15-79" name="__codelineno-15-79" href="#__codelineno-15-79"></a><span class="c1"># rootfs.cpio</span>
<a id="__codelineno-15-80" name="__codelineno-15-80" href="#__codelineno-15-80"></a>
<a id="__codelineno-15-81" name="__codelineno-15-81" href="#__codelineno-15-81"></a>$<span class="w"> </span>./fcs_prepare<span class="w"> </span>--finish<span class="w"> </span>signed_rootfs.cpio.ccert<span class="w"> </span>--imagefile<span class="w"> </span>rootfs.cpio
<a id="__codelineno-15-82" name="__codelineno-15-82" href="#__codelineno-15-82"></a>$<span class="w"> </span>mv<span class="w"> </span>hps_image_signed.vab<span class="w"> </span>signed-rootfs.cpio
<a id="__codelineno-15-83" name="__codelineno-15-83" href="#__codelineno-15-83"></a>$<span class="w"> </span>rm<span class="w"> </span>unsigned_cert.ccert
</code></pre></div>
<p>Copy the following files to <em>u-boot-socfpga</em> folder:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">#Copy the image back to uboot folder</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>$<span class="w"> </span>cp<span class="w"> </span>signed-bl31.bin<span class="w"> </span>../u-boot-socfpga/
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>$<span class="w"> </span>cp<span class="w"> </span>signed-u-boot-nodtb.bin<span class="w"> </span>../u-boot-socfpga/
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>$<span class="w"> </span>cp<span class="w"> </span>signed-u-boot.dtb<span class="w"> </span>../u-boot-socfpga/
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>$<span class="w"> </span>cp<span class="w"> </span>signed-Image<span class="w"> </span>../u-boot-socfpga/
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>$<span class="w"> </span>cp<span class="w"> </span>signed-linux.dtb<span class="w"> </span>../u-boot-socfpga/
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>$<span class="w"> </span>cp<span class="w"> </span>signed-root
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>$<span class="w"> </span>fs.cpio<span class="w"> </span>../u-boot-socfpga/
</code></pre></div>
Recompile the U-Boot</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/altera-opensource/u-boot-socfpga
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>u-boot-socfpga
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span>CROSS<span class="se">\C</span>OMPILE<span class="o">=</span>aarch64-none-linux-gnu-<span class="p">;</span><span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">ARCH</span><span class="o">=</span>arm
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>$<span class="w"> </span>make<span class="w"> </span>socfpga/agilex/n6000/vab/defconfig
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>$<span class="w"> </span>make<span class="w"> </span>-j<span class="w"> </span><span class="m">24</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
</code></pre></div>
<p><strong>Figure 3.1 N6000/1 Configs</strong></p>
<p><a class="glightbox" href="../images/Image4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/Image4.png" /></a></p>
<p>If you not see the defconfig desired, please checkout the correct branch version. Example config shown above is socfpga_v2021.10.</p>
<p>If the memory device tree it mismatches with your hardware (figure below), change the memory device tree at u-boot-socfpga/arch/arm/dts/socfpga_agilex_n6000-u-boot.dtsi</p>
<p>To make it 2GB, change as</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>memory {
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>\* 2GB \*
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>reg = &lt;0 0x00000000 0 0x40000000&gt;,&lt;0 0x00000000 0 0x40000000&gt;;
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>};
</code></pre></div>
<strong>Figure 3.2 Device tree mismatches example</strong></p>
<p><a class="glightbox" href="../images/Image5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/Image5.png" /></a></p>
<p>Refer to 6. Host Side Startup</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span>4b:00.4<span class="w"> </span>root:root
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>$<span class="w"> </span>hps<span class="w"> </span>cpeng<span class="w"> </span>-f<span class="w"> </span>u-boot.itb
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>$<span class="w"> </span>timeout<span class="w"> </span><span class="m">5</span><span class="w"> </span>hps<span class="w"> </span>heartbeat
</code></pre></div>
The error happen (Figure below) when the Images do not sign with VAB.</p>
<p><strong>Figure 3.3 VAB certificate error example</strong></p>
<p><a class="glightbox" href="../images/Image6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/Image6.png" /></a></p>
<h2 id="70-debugging">7.0 Debugging<a class="headerlink" href="#70-debugging" title="Permanent link">&para;</a></h2>
<p>Debugging the HPS from the host side is standard HPS debugging. The primary debug tool is UART on the HPS and Arm DS-5 debugger.</p>
<p>A UART connection can be enabled on the board using the following procedure:</p>
<ol>
<li>
<p>Connect the HPS Debug Card and HPS UART to the Intel N6000/1-PL FPGA SmartNIC Platform board</p>
</li>
<li>
<p>Open Putty with the following setting
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>    Port:COM4
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>    Baudrate:115200
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    Data bits : 8
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    Stop bits : 1
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>    Parity : None
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>    Flow Control : None
</code></pre></div></p>
</li>
<li>
<p>Reboot the Intel N6000/1-PL FPGA SmartNIC Platform board by typing <code>reboot</code> in the shell. You will be able to see the HPS UART traffic in the putty. If any issues are encountered in this step, check the HPS UART connection and the UART driver.</p>
</li>
<li>
<p>Check the PCI bdf ( <strong>lspci | grep acc</strong> ) or <strong>fpgainfo fme</strong> at the shell prompt.</p>
</li>
<li>
<p>Run the rsu and fpga\reconfig scripts with respective arguments to print the logs.</p>
</li>
</ol>
<h2 id="80-connecting-remotely-to-the-hps-using-ssh">8.0 Connecting remotely to the HPS using <code>ssh</code><a class="headerlink" href="#80-connecting-remotely-to-the-hps-using-ssh" title="Permanent link">&para;</a></h2>
<p>The HPS running on the Intel FPGA N6000/1-PL SmartNIC Platform can be remotely accessed to via the utility <code>ssh</code>, allowing the user to run commands and copy files. SSH must be run over a Point-To-Point Protocol daemon that has been included in the HPS software (as a part of the <em>meta-openembedded</em> layer, in the <em>recipes-daemons/ippool</em> recipe). In this example, the HPS is set up as a PPP Server, and the host OS is set up as a PPP Client. Serial communication between the host and HPS is accomplished via HPS UART1, which communicates through the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> to the Soft UART on the FPGA, who in turn communicates with the host over PCIe.</p>
<p>The following steps assume the SSBL has not yet been loaded onto the HPS. If it has, a cold boot will reset the system.</p>
<ol>
<li>The HPS Copy Engine Module is available for access on PF 4 via the PF/VF Mux on the FPGA. This port needs to be bound to driver <code>vfio-pci</code> (the following example assumes PCIE BDF 0000:b1:00.0). Substitute your device's BDF address and desired user/group access permissions into the following command.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.4<span class="w"> </span>&lt;USER&gt;<span class="o">[</span>:&lt;GROUP&gt;<span class="o">]</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>Unbinding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.4<span class="w"> </span>from<span class="w"> </span>dfl-pci
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.4<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.4<span class="w"> </span>is<span class="w"> </span><span class="m">190</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>Assigning<span class="w"> </span>/dev/vfio/190<span class="w"> </span>to<span class="w"> </span>DCPsupport
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/190<span class="w"> </span>to<span class="w"> </span>rw-rw----
</code></pre></div>
<ol>
<li>When an HPS enabled SOF or BIN with the FSBL is loaded onto the FPGA, a message will be displayed on the host OS (seen via <code>dmesg</code>) after boot once the serial port has been registered with the dfl-uart driver. The UART driver is included as a part of the linux-dfl driver package. An example output from <code>dmesg</code> is shown below (search dmesg using <code>dmesg | grep dfl-uart</code>):</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="o">[</span><span class="w">    </span><span class="m">7</span>.343014<span class="o">]</span><span class="w"> </span>dfl-uart<span class="w"> </span>dfl_dev.7:<span class="w"> </span>serial8250_register_8250_port<span class="w"> </span><span class="m">2</span>
</code></pre></div>
<p>The device file that corresponds with serial UART port 2 is <code>/dev/ttyS2</code> (format is <code>/dev/ttyS&lt;port number&gt;</code>). A serial communication program can be used to view the HPS boot in realtime, then log in and run commands when boot has completed. Minicom is the program that will be used in this example, although others will work. Install Minicom using DNF <code>sudo dnf install minicom</code>. </p>
<ol>
<li>Minicom requires configuration changes before it can listen to the serial device. Using the built-in menu accessed by <code>sudo minicom -s</code>, ensure the information under "Serial port setup" matches the following, where the serial device corresponds with the serial port discussed previously:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="w"> </span>+-----------------------------------------------------------------------+
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>A<span class="w"> </span>-<span class="w">    </span>Serial<span class="w"> </span>Device<span class="w">      </span>:<span class="w"> </span>/dev/ttyS2<span class="w">                                </span><span class="p">|</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span><span class="p">|</span><span class="w">                                                                       </span><span class="p">|</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>C<span class="w"> </span>-<span class="w">   </span>Callin<span class="w"> </span>Program<span class="w">      </span>:<span class="w">                                           </span><span class="p">|</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>D<span class="w"> </span>-<span class="w">  </span>Callout<span class="w"> </span>Program<span class="w">      </span>:<span class="w">                                           </span><span class="p">|</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>E<span class="w"> </span>-<span class="w">    </span>Bps/Par/Bits<span class="w">       </span>:<span class="w"> </span><span class="m">115200</span><span class="w"> </span>8N1<span class="w">                                </span><span class="p">|</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>F<span class="w"> </span>-<span class="w"> </span>Hardware<span class="w"> </span>Flow<span class="w"> </span>Control<span class="w"> </span>:<span class="w"> </span>Yes<span class="w">                                       </span><span class="p">|</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>G<span class="w"> </span>-<span class="w"> </span>Software<span class="w"> </span>Flow<span class="w"> </span>Control<span class="w"> </span>:<span class="w"> </span>No<span class="w">                                        </span><span class="p">|</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">    </span><span class="p">|</span><span class="w">                                                                       </span><span class="p">|</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">    </span><span class="p">|</span><span class="w">    </span>Change<span class="w"> </span>which<span class="w"> </span>setting?<span class="w">                                              </span><span class="p">|</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">    </span>+-----------------------------------------------------------------------+
</code></pre></div>
<ol>
<li>
<p>Save and exit the configuration menu. Run Minicom using the command <code>sudo minicom</code> and keep the terminal open and connected.</p>
</li>
<li>
<p>Load the SSBL onto the HPS using a second terminal. This requires a built ITB image.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>$<span class="w"> </span>hps<span class="w"> </span>cpeng<span class="w"> </span>-f<span class="w"> </span>u-boot.itb
</code></pre></div>
<ol>
<li>You should see the HPS boot sequence continue through your Minicom terminal. Once boot has completed, log in using the user <code>root</code> with an empty password.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>...
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>...
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>...
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="o">[</span><span class="w">  </span>OK<span class="w">  </span><span class="o">]</span><span class="w"> </span>Finished<span class="w"> </span>Load/Save<span class="w"> </span>Random<span class="w"> </span>Seed.
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="o">[</span><span class="w">  </span>OK<span class="w">  </span><span class="o">]</span><span class="w"> </span>Finished<span class="w"> </span>OpenSSH<span class="w"> </span>Key<span class="w"> </span>Generation.
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>Poky<span class="w"> </span><span class="o">(</span>Yocto<span class="w"> </span>Project<span class="w"> </span>Reference<span class="w"> </span>Distro<span class="o">)</span><span class="w"> </span><span class="m">3</span>.3.6<span class="w"> </span>agilex<span class="w"> </span>ttyS0
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>agilex<span class="w"> </span>login:<span class="w"> </span>root
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>root@agilex:~#
</code></pre></div>
<ol>
<li>Configure the running Yocto image on the HPS as a PPP server. Run the following command through Minicom on the HPS (connects address 192.168.250.2 on the HPS to 192.168.250.1 on the host):</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>root@agilex:~#<span class="w"> </span>pppd<span class="w"> </span>noauth<span class="w"> </span>passive<span class="w"> </span><span class="m">192</span>.168.250.1:192.168.250.2
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="o">[</span><span class="w">  </span><span class="m">410</span>.465450<span class="o">]</span><span class="w"> </span>PPP<span class="w"> </span>generic<span class="w"> </span>driver<span class="w"> </span>version<span class="w"> </span><span class="m">2</span>.4.2
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>...
</code></pre></div>
<ol>
<li>Exit the Minicom program running on the host using <code>^A X</code>. Execute the following command on the host to establish a PPP connection as the client (if not installed on the host, run <code>sudo dnf install ppp</code>):</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>pppd<span class="w"> </span>ttyS2<span class="w"> </span><span class="m">115200</span><span class="w"> </span>crtscts<span class="w"> </span>lock<span class="w"> </span><span class="nb">local</span><span class="w"> </span>noauth<span class="w"> </span>passive<span class="w"> </span>debug
</code></pre></div>
<ol>
<li>A new network interface device registered to ppp should be visible.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>$<span class="w"> </span>ip<span class="w"> </span>-4<span class="w"> </span>addr
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>...
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="m">8</span>:<span class="w"> </span>ppp0:<span class="w"> </span>&lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">1500</span><span class="w"> </span>qdisc<span class="w"> </span>fq_codel<span class="w"> </span>state<span class="w"> </span>UNKNOWN<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">3</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span>inet<span class="w"> </span><span class="m">192</span>.168.250.2<span class="w"> </span>peer<span class="w"> </span><span class="m">192</span>.168.250.1/32<span class="w"> </span>scope<span class="w"> </span>global<span class="w"> </span>ppp0
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
</code></pre></div>
<p>With both the client and server communicating, <code>ssh</code> and <code>scp</code> can be used to run commands and transfer files using IPv4 address 192.168.250.1 on the host. An example operation run on the host OS is shown below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="o">[</span>user@localhost<span class="w"> </span><span class="o">]</span>:<span class="w"> </span>scp<span class="w"> </span>file_package.tar.gz<span class="w"> </span>root@192.168.250.1
</code></pre></div>
<p><strong>Note:</strong> If you are developing software for the HPS and altering system settings, it is possible for <code>ssh</code> to prohibit a connection due to a false man-in-the-middle attack warning. The flag <code>&lt;ssh/scp&gt; -o StrictHostKeyChecking=no</code> can be used to ignore the warning.</p>
<h2 id="90-example-design-enabling-emmc-i2c-and-uart-in-platform-design">9.0 Example Design - Enabling eMMC, I2C and UART in Platform Design<a class="headerlink" href="#90-example-design-enabling-emmc-i2c-and-uart-in-platform-design" title="Permanent link">&para;</a></h2>
<p>The following section will walk through the process by which eMMC, I2C, and UART can be added to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and the HPS image. The goal of this section is to allow the HPS to configure eMMC memory on boot and uses WNC's <a href="https://www.intel.com/content/www/us/en/products/details/fpga/platforms/smartnic/n6000-pl-platform.html">FPGA SmartNIC Series</a> as a reference.</p>
<h3 id="91-configuring-the-fim">9.1 Configuring the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr><a class="headerlink" href="#91-configuring-the-fim" title="Permanent link">&para;</a></h3>
<ol>
<li>Configure eMMC, I2C, and UAET in Platform Designer. ACtual pin assignments are determined by the WNC board schematic. In Quartus, navigate to the HPS Processor Subsystem Intel Agilex FPGA IP -&gt; Pin Mux and Peripherals -&gt; Advanced -&gt; Advanced IP Placement.</li>
</ol>
<p><a class="glightbox" href="../images/wnc1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Pin Planner" src="../images/wnc1.png" /></a></p>
<p>Check your pin assigments for the eMMC, UART and I2C in the Pin Planner. If these assignments are not present, then they can be found at the following <a href="https://github.com/OFS/ofs-n6001/blob/45a7dfbcdac16131aabf392457cfbbd51631888e/syn/setup/hps_loc.tcl#L4">link</a>. Based on the changes shown above, the UART pins are removed on HPS IO3 and IO4 what are mapped on AG6 and AB1.</p>
<p><a class="glightbox" href="../images/wnc2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="HPS Pin Assignments" src="../images/wnc2.png" /></a></p>
<ol>
<li>Click Apply Selections-&gt;Generate HDL</li>
</ol>
<p><a class="glightbox" href="../images/wnc3.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Generate HDL" src="../images/wnc3.png" /></a></p>
<ol>
<li>Check for instantiation in <code>top.sv</code>. Click Generate -&gt; Show Instatiation Template.</li>
</ol>
<p><a class="glightbox" href="../images/wnc4.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Instatiation Template" src="../images/wnc4.png" /></a></p>
<p>The following image demonstrates eMMC and I2C properly instatiated in <code>top.sv</code>.</p>
<p><a class="glightbox" href="../images/wnc5.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="top.sv Instatiation" src="../images/wnc5.png" /></a></p>
<ol>
<li>Add the following to the hps_ss modules in <code>top.sv</code>.</li>
</ol>
<p><a class="glightbox" href="../images/wnc6.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="hps_ss part 1" src="../images/wnc6.png" /></a></p>
<p><a class="glightbox" href="../images/wnc7.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="hps_ss part 2" src="../images/wnc7.png" /></a></p>
<ol>
<li>Compile the design.</li>
</ol>
<p><a class="glightbox" href="../images/wnc8.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Compile" src="../images/wnc8.png" /></a></p>
<h3 id="92-configuring-the-hps">9.2 Configuring the HPS<a class="headerlink" href="#92-configuring-the-hps" title="Permanent link">&para;</a></h3>
<ol>
<li>Enable mmc and DesignWare Memory Card interface flags in U-Boot (.config). After building U-Boot with <code>meta-bake.py</code>, this file is located at <em><build_directory>/agilex-n6000-rootfs/tmp/work/agilex-poky-linux/u-boot-socfpga/<version>/build/socfpga_agilex_n6000_defconfig/.config</em>.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nv">CONFIG_CMD_MMC</span><span class="o">=</span>y<span class="w"> </span>//Enable<span class="w"> </span>mmc<span class="w"> </span><span class="nb">command</span><span class="w"> </span>tool<span class="w"> </span><span class="k">in</span><span class="w"> </span>uboot<span class="w"> </span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="nv">CONFIG_MMC_DW</span><span class="o">=</span>y<span class="w"> </span>//<span class="w"> </span>support<span class="w"> </span>DesignWare<span class="w"> </span>Memory<span class="w"> </span>Card<span class="w"> </span>Interface
</code></pre></div>
<p><a class="glightbox" href="../images/wnc9.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt=".config changes 1" src="../images/wnc9.png" /></a></p>
<p><a class="glightbox" href="../images/wnc10.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt=".config changes 1" src="../images/wnc10.png" /></a></p>
<ol>
<li>Enable and configure I2C and eMMC in U-Boot (socfpga_agilex_n6000.dts). After building U-Boot with <code>meta-bake.py</code>, this file is located at <em><build_directory>/agilex-n6000-rootfs/tmp/work/agilex-poky-linux/u-boot-socfpga/<version>git/arch/arm/dts/socfpga_agilex_n6000.dts</em>.</li>
</ol>
<p><a class="glightbox" href="../images/wnc11.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="DTS Changes UBOOT" src="../images/wnc11.png" /></a></p>
<ol>
<li>Enable and configure I2C and eMMC in the Linux device tree (socfpga_agilex_n6000.dts). After building U-Boot with <code>meta-bake.py</code>, this file is located at <em><build_directory>/agilex-n6000-rootfs/tmp/work-shared/agilex/kernel-source/arch/arm64/boot/dts/intel/socfpga_agilex_n6000.dts</em>.</li>
</ol>
<p><a class="glightbox" href="../images/wnc12.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="DTS Changes Linux" src="../images/wnc12.png" /></a></p>
<ol>
<li>Compile Linux by navigating to the directory <em>agilex-n6000-rootfs/tmp/work/agilex-poky-linux/linux-socfpga-lts/5.10.60-lts+gitAUTOINC+c35d63f9c7-r0/linux-agilex-standard-build</em> and running the following:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>$<span class="w"> </span>make<span class="w"> </span>-j<span class="w"> </span><span class="sb">`</span>nproc<span class="sb">`</span><span class="w"> </span>Image<span class="w"> </span>dtbs<span class="w">  </span>
</code></pre></div>
<ol>
<li>Add the software utilities<code>util-linux-mkfs e2fsprogs.mke2fs e2fsprogs</code> in to the Linux RootFS. Thes utilities will be used to create a filsystem (ext4, FAT32, etc.) and partition the eMMC. Make the following changes in <em>meta-intel-fpga-refdes/recipes-images/poky/n6000-image-minimal.bb</em>.</li>
</ol>
<p><a class="glightbox" href="../images/wnc13.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="Utility additions" src="../images/wnc13.png" /></a></p>
<ol>
<li>
<p>As an output from the Linux compilation from step 4 you will produce the files <strong>Image</strong> and <strong>socfpga_agilex_n6000.dtb</strong>. Transfer both over to the socfpga_agilex_n6000_defconfig directory. Rename <strong>socfpga_agilex_n6000.dtb</strong> to <strong>linux.dtb</strong>. Compile U-Boot by running <code>make</code> in directory <em>agilex-n6000-rootfs/tmp/work/agilex-poky-linux/u-boot-socfpga/1_v2021.07+gitAUTOINC+24e26ba4a0-r0/build/socfpga_agilex_n6000_defconfig/</em>. This compilation will produce both <code>spl/u-boot-spl-dtb.hex</code> and <code>u-boot.itb</code>. </p>
</li>
<li>
<p>Combines these files with your SOF FSBL bootloader (created in <a href="#91-configuring-the-fim"><strong>Section 9.1 Configuring the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></strong></a>).</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>$<span class="w"> </span>quartus_pfg<span class="w"> </span>-c<span class="w"> </span>ofs_top.sof<span class="w"> </span>ofs_top_hps.sof<span class="w"> </span>-o<span class="w"> </span><span class="nv">hps_path</span><span class="o">=</span>u-boot-spl-dtb.hex
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>$<span class="w"> </span>quartus_pfg<span class="w"> </span>-c<span class="w">  </span>ofs_top_hps_pof_flash.pfg<span class="w"> </span>//to<span class="w"> </span>pof<span class="w"> </span>file<span class="w"> </span>and<span class="w"> </span>flash<span class="w"> </span>to<span class="w"> </span>qspi
</code></pre></div>
<p>Program the FSBL enabled SOF onto the FPGA and warm reboot the server for changes to take affect. After reboot has completed use the following commands to program the SSBL.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>release<span class="w"> </span>-d<span class="w"> </span>d8:00.0
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span>d8:00.4<span class="w"> </span>root:root
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>$<span class="w"> </span>hps<span class="w"> </span>cpeng<span class="w"> </span>-f<span class="w"> </span>u-boot.itb
</code></pre></div>
<p>During HPS boot you should see the following message if the eMMC has been properly configured.</p>
<p><a class="glightbox" href="../images/wnc14.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="EMMC Boot Message" src="../images/wnc14.png" /></a></p>
<h3 id="93-emmc-testing-from-the-hps">9.3 eMMC Testing from the HPS<a class="headerlink" href="#93-emmc-testing-from-the-hps" title="Permanent link">&para;</a></h3>
<p><strong>The following memory test was run from the U-Boot shell.</strong></p>
<ol>
<li>Erase eMMC using a start block offset 0x400.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>$<span class="w"> </span>mmc<span class="w"> </span>erase<span class="w"> </span>0x400<span class="w"> </span><span class="m">20</span>
</code></pre></div>
<p><a class="glightbox" href="../images/wnc15.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/wnc15.png" /></a></p>
<p>Write test data (at 0x00A00000) into the eMMC offset 0x400.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>$<span class="w"> </span>mmc<span class="w"> </span>write<span class="w"> </span>0x00A00000<span class="w"> </span>0x400<span class="w"> </span><span class="m">10</span>
</code></pre></div>
<p><a class="glightbox" href="../images/wnc16.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/wnc16.png" /></a></p>
<p>Read test data (at 0x00A00040) back from eMMC offset 0x400.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>$<span class="w"> </span>mmc<span class="w"> </span><span class="nb">read</span><span class="w"> </span>0x00A00040<span class="w"> </span>0x400<span class="w"> </span><span class="m">10</span>
</code></pre></div>
<p><a class="glightbox" href="../images/wnc17.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/wnc17.png" /></a></p>
<p>Data comparison at memory offset 0x00A00000 and 0x00A00040. Data should match.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>$<span class="w"> </span>cmp.l<span class="w"> </span>0x00A00000<span class="w"> </span>0x00A00040<span class="w"> </span><span class="m">10</span>.
</code></pre></div>
<p><a class="glightbox" href="../images/wnc18.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/wnc18.png" /></a></p>
<p><strong>The following memory test was run from Linux running on the HPS.</strong></p>
<ol>
<li>Display the eMMC and its partitions.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>$<span class="w"> </span>fdisk<span class="w"> </span>-l
</code></pre></div>
<p><a class="glightbox" href="images/nc19.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="images/nc19.png" /></a></p>
<ol>
<li>Create a primary partition on the eMMC.</li>
</ol>
<p><a class="glightbox" href="../images/wnc20.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/wnc20.png" /></a></p>
<ol>
<li>Verify the partition has been created.</li>
</ol>
<p><a class="glightbox" href="../images/wnc21.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/wnc21.png" /></a></p>
<ol>
<li>Format the ext3 filesystem in the partition you just created (p1).</li>
</ol>
<p><a class="glightbox" href="../images/wnc22.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/wnc22.png" /></a></p>
<ol>
<li>Create the directory <code>mydata</code> in /mnt. Mount the eMMC p1 partition to <code>/mnt/mydata</code> and verify the filsystem mount was successful.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/mydata
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>$<span class="w"> </span>mount<span class="w"> </span>/dev/mmcblk0p1<span class="w"> </span>/mnt/mydata
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>$<span class="w"> </span>df
</code></pre></div>
<p><a class="glightbox" href="../images/wnc23.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/wnc23.png" /></a></p>
<ol>
<li>Create a new text file and write some data in it - "Hello World!". After the device has been written to run <code>sync</code>, unmount eMMC p1 partition and verify the unmount was successful.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>$<span class="w"> </span>sync
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>$<span class="w"> </span>umount<span class="w"> </span>/dev/mmcblk0p1
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>$<span class="w"> </span>df
</code></pre></div>
<p><a class="glightbox" href="../images/wnc24.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/wnc24.png" /></a></p>
<h2 id="layersyaml-reference">layers.yaml Reference<a class="headerlink" href="#layersyaml-reference" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nt">machine</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agilex</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">n6000</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">n6000-image-minimal</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="nt">fit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="nt">uboot-dtb</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">u-boot-nodtb.bin</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">u-boot.dtb</span><span class="p p-Indicator">]</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="nt">linux-binary</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">bl31.bin</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">linux.dtb</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">rootfs.cpio</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">Image</span><span class="p p-Indicator">]</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="nt">root-public-qky</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">userkey_root_public.qky</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="nt">root-private-pem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">userkey_root_private.pem</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="nt">root-public-pem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">userkey_root_public.pem</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="nt">repos</span><span class="p">:</span>
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">poky</span>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://git.yoctoproject.org/git/poky.git</span>
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">    </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hardknott</span>
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta-intel-fpga</span>
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://git.yoctoproject.org/git/meta-intel-fpga.git</span>
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="w">    </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hardknott</span>
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w">    </span><span class="nt">add_layers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta-intel-fpga-refdes</span>
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/altera-opensource/meta-intel-fpga-refdes.git</span>
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="w">    </span><span class="c1">#url__: https://github.com/intel-innersource/os.linux.yocto.reference-design.meta-intel-fpga-refdes.git</span>
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w">    </span><span class="c1">#url: git@github.com:intel-innersource/os.linux.yocto.reference-design.meta-intel-fpga-refdes.git</span>
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="w">    </span><span class="c1">#branch: rrojo/n6000</span>
<a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="w">    </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hardknott</span>
<a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">refdes-n6000-ppp.patch</span>
<a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="w">    </span><span class="nt">keep</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="w">    </span><span class="nt">add_layers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta-openembedded</span>
<a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/openembedded/meta-openembedded.git</span>
<a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a><span class="w">    </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hardknott</span>
<a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a><span class="w">    </span><span class="nt">add_layers</span><span class="p">:</span>
<a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta-oe</span>
<a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta-networking</span>
<a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta-python</span>
<a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fcs_prepare</span>
<a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/altera-opensource/fcs_apps.git</span>
<a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a><span class="w">    </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fcs_prepare</span>
<a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a>
<a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a><span class="nt">ingredients</span><span class="p">:</span>
<a id="__codelineno-41-40" name="__codelineno-41-40" href="#__codelineno-41-40"></a><span class="w">  </span><span class="nt">linux</span><span class="p">:</span>
<a id="__codelineno-41-41" name="__codelineno-41-41" href="#__codelineno-41-41"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux-socfpga</span>
<a id="__codelineno-41-42" name="__codelineno-41-42" href="#__codelineno-41-42"></a><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;5.10.100&#39;</span>
<a id="__codelineno-41-43" name="__codelineno-41-43" href="#__codelineno-41-43"></a><span class="w">    </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">socfpga-5.10.100-lts</span>
<a id="__codelineno-41-44" name="__codelineno-41-44" href="#__codelineno-41-44"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/altera-opensource/linux-socfpga.git</span>
<a id="__codelineno-41-45" name="__codelineno-41-45" href="#__codelineno-41-45"></a><span class="w">  </span><span class="nt">uboot</span><span class="p">:</span>
<a id="__codelineno-41-46" name="__codelineno-41-46" href="#__codelineno-41-46"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">u-boot-socfpga</span>
<a id="__codelineno-41-47" name="__codelineno-41-47" href="#__codelineno-41-47"></a><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2021.07&#39;</span>
<a id="__codelineno-41-48" name="__codelineno-41-48" href="#__codelineno-41-48"></a><span class="w">    </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">socfpga_v2021.07</span>
<a id="__codelineno-41-49" name="__codelineno-41-49" href="#__codelineno-41-49"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/altera-opensource/u-boot-socfpga.git</span>
<a id="__codelineno-41-50" name="__codelineno-41-50" href="#__codelineno-41-50"></a><span class="w">  </span><span class="nt">atf</span><span class="p">:</span>
<a id="__codelineno-41-51" name="__codelineno-41-51" href="#__codelineno-41-51"></a><span class="w">    </span><span class="nt">disabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-41-52" name="__codelineno-41-52" href="#__codelineno-41-52"></a><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2.4.1&#39;</span>
<a id="__codelineno-41-53" name="__codelineno-41-53" href="#__codelineno-41-53"></a><span class="w">    </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">socfpga_v2.4.1</span>
<a id="__codelineno-41-54" name="__codelineno-41-54" href="#__codelineno-41-54"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/altera-opensource/arm-trusted-firmware.git</span>
<a id="__codelineno-41-55" name="__codelineno-41-55" href="#__codelineno-41-55"></a><span class="nt">local</span><span class="p">:</span>
<a id="__codelineno-41-56" name="__codelineno-41-56" href="#__codelineno-41-56"></a><span class="w">  </span><span class="nt">remove</span><span class="p">:</span>
<a id="__codelineno-41-57" name="__codelineno-41-57" href="#__codelineno-41-57"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MACHINE</span>
<a id="__codelineno-41-58" name="__codelineno-41-58" href="#__codelineno-41-58"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UBOOT_CONFIG</span>
<a id="__codelineno-41-59" name="__codelineno-41-59" href="#__codelineno-41-59"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IMAGE</span>
<a id="__codelineno-41-60" name="__codelineno-41-60" href="#__codelineno-41-60"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SRC_URI</span>
<a id="__codelineno-41-61" name="__codelineno-41-61" href="#__codelineno-41-61"></a><span class="w">  </span><span class="nt">values</span><span class="p">:</span>
<a id="__codelineno-41-62" name="__codelineno-41-62" href="#__codelineno-41-62"></a><span class="w">    </span><span class="nt">MACHINE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$machine</span>
<a id="__codelineno-41-63" name="__codelineno-41-63" href="#__codelineno-41-63"></a><span class="w">    </span><span class="nt">DL_DIR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$build_dir/downloads</span>
<a id="__codelineno-41-64" name="__codelineno-41-64" href="#__codelineno-41-64"></a><span class="w">    </span><span class="nt">DISTRO_FEATURES_append</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;</span><span class="nv"> </span><span class="s">systemd&quot;</span>
<a id="__codelineno-41-65" name="__codelineno-41-65" href="#__codelineno-41-65"></a><span class="w">    </span><span class="nt">VIRTUAL-RUNTIME_init_manager</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">systemd</span>
<a id="__codelineno-41-66" name="__codelineno-41-66" href="#__codelineno-41-66"></a><span class="w">    </span><span class="nt">IMAGE_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$image</span>
<a id="__codelineno-41-67" name="__codelineno-41-67" href="#__codelineno-41-67"></a><span class="w">    </span><span class="nt">IMAGE_FSTYPES</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;+=cpio</span><span class="nv"> </span><span class="s">tar.gz&quot;</span>
<a id="__codelineno-41-68" name="__codelineno-41-68" href="#__codelineno-41-68"></a><span class="w">    </span><span class="nt">PREFERRED_PROVIDER_virtual/kernel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux-socfpga-lts</span>
<a id="__codelineno-41-69" name="__codelineno-41-69" href="#__codelineno-41-69"></a><span class="w">    </span><span class="nt">PREFERRED_VERSION_linux-socfpga-lts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.10%</span>
<a id="__codelineno-41-70" name="__codelineno-41-70" href="#__codelineno-41-70"></a><span class="w">    </span><span class="nt">UBOOT_CONFIG</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agilex-n6000</span>
<a id="__codelineno-41-71" name="__codelineno-41-71" href="#__codelineno-41-71"></a><span class="w">    </span><span class="nt">PREFERRED_PROVIDER_virtual/bootloader</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">u-boot-socfpga</span>
<a id="__codelineno-41-72" name="__codelineno-41-72" href="#__codelineno-41-72"></a><span class="w">    </span><span class="nt">PREFERRED_VERSION_u-boot-socfpga</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2021.07%</span>
</code></pre></div>
<h2 id="faqs">FAQs<a class="headerlink" href="#faqs" title="Permanent link">&para;</a></h2>
<p>Below are the Frequently Asked Questions:</p>
<ol>
<li>
<p>How will you get the software stack for HPS (FSBL, U-Boot, Kernel)? Or will there be a package available to them on Git, Intel RDC?</p>
<p><strong>Answer</strong> : HPS software has been around for quite a long time. Support for the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> and the N6000-PL FPGA SmartNIC Platform will be upstreamed and available from rocketboards.com, just like any other HPS based project.</p>
</li>
<li>
<p>What are the recommended steps for building the binaries and where will those be located?</p>
<p><strong>Answer:</strong> There are many documents on building the binaries at rocketboards.com. Any reference binaries can be stored at rocketboards.com as well.</p>
</li>
<li>
<p>What are the host side commands used to put the binaries to Copy Engine and from there to HPS?</p>
<p><strong>Answer:</strong> There is a single command, hps to download the single binary through the Copy Engine to the HPS.</p>
</li>
<li>
<p>What are the host side commands used to reset the HPS from Host side?</p>
<p><strong>Answer:</strong> This functionality is planned to be added to the hps command.</p>
</li>
<li>
<p>What is the procedure used to debug the HPS from Host side?</p>
<p><strong>Answer:</strong> Debugging the HPS from the host side is standard HPS debugging. The primary debug tool is UART on the HPS and the Arm DS debugger.</p>
</li>
<li>
<p>Do we have performance metrics about HPS, like whether any bench marking information available with any sample application is available?</p>
<p><strong>Answer:</strong> Any performance metrics on the HPS would be available on rocketboards.com.</p>
</li>
<li>
<p>What is the PXE boot flow and what is required to enable the same?</p>
<p><strong>Answer:</strong> On some configurations, HPS is treated as a fully-fledged SoC and can PXE boot itself. But you must add this functionality.</p>
</li>
</ol>
<h2 id="further-links">Further Links<a class="headerlink" href="#further-links" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Description</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Getting Started User Guide: <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel® Agilex® PCIe Attach FPGAs</td>
<td>https://ofs.github.io/hw/n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/</td>
</tr>
<tr>
<td>Intel® FPGA Interface Manager Developer Guide: <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel® Agilex® PCIe Attach FPGAs</td>
<td>https://ofs.github.io/hw/n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/</td>
</tr>
<tr>
<td>Open FPGA Stack Technical Reference Manual for Intel Agilex FPGA PCIe Attach</td>
<td>https://ofs.github.io/hw/n6001/reference_manuals/ofs_fim/mnl_fim_ofs_n6001/</td>
</tr>
<tr>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Development Guide: <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel® Agilex® PCIe Attach FPGAs</td>
<td>https://ofs.github.io/hw/N6001/dev_guides/afu_dev/ug_dev_afu_n6001/</td>
</tr>
<tr>
<td>Simulation User Guide: <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel® Agilex® PCIe Attach FPGAs</td>
<td>https://ofs.github.io/hw/n6001/user_guides/ug_sim_ofs_n6001/ug_sim_ofs_n6001/</td>
</tr>
<tr>
<td>FPGA Device Feature List (<abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>) Framework Overview</td>
<td>https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/linux-dfl/blob/fpga-ofs-dev/Documentation/fpga/dfl.rst#fpga-device-feature-list-dfl-framework-overview</td>
</tr>
<tr>
<td>ofs-platform-afu-bbb</td>
<td>https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/ofs-platform-afu-bbb</td>
</tr>
<tr>
<td>Connecting an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to a Platform using <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr></td>
<td>https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/ofs-platform-afu-bbb/blob/master/plat_if_develop/ofs_plat_if/docs/PIM_AFU_interface.md</td>
</tr>
<tr>
<td>example AFUs</td>
<td>https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/examples-afu.git</td>
</tr>
<tr>
<td><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Tutorial</td>
<td>https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/examples-afu/tree/main/tutorial</td>
</tr>
<tr>
<td>Non-<abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Development</td>
<td>https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/examples-afu/tree/main/tutorial</td>
</tr>
<tr>
<td>Intel FPGA IP Subsystem for PCI Express IP User Guide</td>
<td>https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/ofs.github.io/docs/hw/common/user_guides/ug_qs_pcie_ss.pdf</td>
</tr>
<tr>
<td>Memory Subsystem Intel FPGA IP User Guide</td>
<td>https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/ofs.github.io/docs/hw/common/user_guides/ug_qs_mem_ss.pdf</td>
</tr>
<tr>
<td>OPAE.io</td>
<td>https://opae.github.io/latest/docs/fpga_tools/opae.io/opae.io.html</td>
</tr>
<tr>
<td>OPAE GitHub</td>
<td>https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/opae-sdk</td>
</tr>
<tr>
<td>README_ofs_n6001_eval.txt</td>
<td>https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/ofs-n6001/blob/release/ofs-2023.1/eval_scripts/README_ofs_n6001_eval.txt</td>
</tr>
<tr>
<td><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Regions</td>
<td>https://ofs.github.io/hw/d5005/reference_manuals/ofs_fim/mnl_fim_ofs_n6001/#mmio_regions</td>
</tr>
<tr>
<td>evaluation script</td>
<td>https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>/ofs-n6001/tree/release/ofs-2023.1/eval_scripts</td>
</tr>
<tr>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr></td>
<td>https://github.com/<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr></td>
</tr>
<tr>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> GitHub page</td>
<td>https://ofs.github.io</td>
</tr>
<tr>
<td><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> Wiki</td>
<td>https://github.com/OPAE/linux-dfl/wiki</td>
</tr>
</tbody>
</table>
<h2 id="notices-disclaimers">Notices &amp; Disclaimers<a class="headerlink" href="#notices-disclaimers" title="Permanent link">&para;</a></h2>
<p>Intel<sup>&reg;</sup> technologies may require enabled hardware, software or service activation.
No product or component can be absolutely secure. 
Performance varies by use, configuration and other factors.
Your costs and results may vary. 
You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Intel products described herein. You agree to grant Intel a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.
No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document, with the sole exception that you may publish an unmodified copy. You may create software implementations based on this document and in compliance with the foregoing that are intended to execute on the Intel product(s) referenced in this document. No rights are granted to create modifications or derivatives of this document.
The products described may contain design defects or errors known as errata which may cause the product to deviate from published specifications.  Current characterized errata are available on request.
Intel disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.
You are responsible for safety of the overall system, including compliance with applicable safety-related requirements or standards. 
<sup>&copy;</sup> Intel Corporation.  Intel, the Intel logo, and other Intel marks are trademarks of Intel Corporation or its subsidiaries.  Other names and brands may be claimed as the property of others. </p>
<p>OpenCL and the OpenCL logo are trademarks of Apple Inc. used by permission of the Khronos Group™. </p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.copy", "navigation.indexes", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>