
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../hw/common/user_guides/afu_dev/ug_dev_afu_ofs_agx7_pcie_attach/ug_dev_afu_ofs_agx7_pcie_attach/">
      
      
        <link rel="next" href="../ug_dev_afu_sim_env/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>PIM Based AFU Developer Guide - OFS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pim-based-afu-developer-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OFS" class="md-header__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OFS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PIM Based AFU Developer Guide
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hw/common/user_guides/ug_fpga_developer/ug_fpga_developer/" class="md-tabs__link">
        Start Here
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hw/doc_modules/contents_s10_pcie_attach/" class="md-tabs__link">
        Stratix® 10 PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hw/doc_modules/contents_agx7_pcie_attach/" class="md-tabs__link md-tabs__link--active">
        Agilex® 7 PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hw/doc_modules/contents_agx7_soc_attach/" class="md-tabs__link">
        Agilex SoC Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hw/common/user_guides/oneapi_asp/ug_oneapi_asp/" class="md-tabs__link">
        oneAPI
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hw/common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-tabs__link">
        OFS Software
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OFS" class="md-nav__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OFS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Start Here
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Start Here
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/user_guides/ug_fpga_developer/ug_fpga_developer/" class="md-nav__link">
        FPGA Developer Journey Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Stratix® 10 PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Stratix® 10 PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/doc_modules/contents_s10_pcie_attach/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../d5005/adp_board_installation_guidelines/" class="md-nav__link">
        Board Installation Guide (Intel® FPGA PAC D5005)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/sw_installation/pcie_attach/sw_install_pcie_attach/" class="md-nav__link">
        Software Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/" class="md-nav__link">
        Getting Started Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-nav__link">
        Automated Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/" class="md-nav__link">
        Shell Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/d5005/dev_guides/fim_dev/ug_dev_fim_ofs_d5005/" class="md-nav__link">
        Shell Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
          Workload Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Workload Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/d5005/dev_guides/afu_dev/ug_dev_afu_d5005/" class="md-nav__link">
        Workload Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../d5005/ug_dev_pim_based_afu/" class="md-nav__link">
        PIM Based AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../d5005/ug_dev_afu_sim_env/" class="md-nav__link">
        AFU Simulation Environment User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/d5005/user_guides/ug_sim_ofs_d5005/ug_sim_ofs_d5005/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
          Virtualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_10">
          <span class="md-nav__icon md-icon"></span>
          Virtualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../d5005/ug_docker/" class="md-nav__link">
        Docker User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../d5005/ug_kvm/" class="md-nav__link">
        KVM User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Agilex® 7 PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Agilex® 7 PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/doc_modules/contents_agx7_pcie_attach/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          Board Installation Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Board Installation Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../adp_board_installation_guidelines/" class="md-nav__link">
        Intel® FPGA SmartNIC N6000/1-PL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/board_installation/devkit_board_installation/devkit_board_installation_guidelines/" class="md-nav__link">
        Agilex® 7 FPGA I-Series and F-Series Development Kits
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/sw_installation/pcie_attach/sw_install_pcie_attach/" class="md-nav__link">
        Software Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          Getting Started Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Getting Started Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/iseries_devkit/user_guides/ug_qs_ofs_iseries/ug_qs_ofs_iseries/" class="md-nav__link">
        OFS for Agilex® 7 FPGA I-Series Development Kit (2xR-Tile,1xF-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/ftile_devkit/user_guides/ug_qs_ofs_ftile/ug_qs_ofs_ftile/" class="md-nav__link">
        OFS for Agilex® 7 FPGA F-Series Development Kit (2xF-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/" class="md-nav__link">
        OFS for Intel® FPGA SmartNIC N6001-PL
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/user_guides/ug_eval_script_ofs_agx7_pcie_attach/ug_eval_script_ofs_agx7_pcie_attach/" class="md-nav__link">
        Automated Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/n6001/reference_manuals/ofs_fim/mnl_fim_ofs_n6001/" class="md-nav__link">
        Shell Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
          Shell Developer Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_7">
          <span class="md-nav__icon md-icon"></span>
          Shell Developer Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/iseries_devkit/dev_guides/fim_dev/ug_ofs_iseries_dk_fim_dev/" class="md-nav__link">
        PCIe Attach I-Series (2xR-Tile, F-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/ftile_devkit/dev_guides/fim_dev/ug_ofs_ftile_dk_fim_dev/" class="md-nav__link">
        PCIe Attach F-Series (2xF-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/" class="md-nav__link">
        PCIe Attach F-Series (P-Tile/E-Tile)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/n6001/dev_guides/hps_dev/hps_developer_ug/" class="md-nav__link">
        HPS Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/user_guides/ug_sim_ofs_agx7_pcie_attach/ug_sim_ofs_agx7_pcie_attach/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" checked>
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
          Workload Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_10">
          <span class="md-nav__icon md-icon"></span>
          Workload Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/user_guides/afu_dev/ug_dev_afu_ofs_agx7_pcie_attach/ug_dev_afu_ofs_agx7_pcie_attach/" class="md-nav__link">
        Workload Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          PIM Based AFU Developer Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        PIM Based AFU Developer Guide
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    1. Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-afu-build-environment" class="md-nav__link">
    2. AFU Build Environment
  </a>
  
    <nav class="md-nav" aria-label="2. AFU Build Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-pim-resources" class="md-nav__link">
    2.1. PIM Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-using-pim-to-interface-with-an-afu" class="md-nav__link">
    3. Using PIM to interface with an AFU
  </a>
  
    <nav class="md-nav" aria-label="3. Using PIM to interface with an AFU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-top-level-module-ofs_plaf_afu" class="md-nav__link">
    3.1. Top Level Module - ofs_plaf_afu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-host-channel" class="md-nav__link">
    3.2. Host Channel
  </a>
  
    <nav class="md-nav" aria-label="3.2. Host Channel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321-create-the-host-channel-interfaces-to-the-afu" class="md-nav__link">
    3.2.1. Create the host channel interfaces to the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#322-connect-the-host-channel-to-the-pim-shim" class="md-nav__link">
    3.2.2. Connect the host channel to the PIM Shim
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#323-avalon-example" class="md-nav__link">
    3.2.3. Avalon Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-local-memory" class="md-nav__link">
    3.3. Local Memory
  </a>
  
    <nav class="md-nav" aria-label="3.3. Local Memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331-create-the-local-memory-interfaces-to-the-afu" class="md-nav__link">
    3.3.1. Create the local memory interfaces to the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#332-connect-local-memory-to-the-pim-shim" class="md-nav__link">
    3.3.2. Connect local memory to the PIM Shim
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#333-avalon-example" class="md-nav__link">
    3.3.3. Avalon Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-high-speed-serial-interface-hssi" class="md-nav__link">
    3.4. High Speed Serial Interface (HSSI)
  </a>
  
    <nav class="md-nav" aria-label="3.4. High Speed Serial Interface (HSSI)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#341-create-the-hssi-interfaces-to-the-afu" class="md-nav__link">
    3.4.1. Create the HSSI interfaces to the AFU
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-tie-off-unused-ports" class="md-nav__link">
    3.5. Tie Off Unused ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-afu-instantiation" class="md-nav__link">
    3.6. AFU Instantiation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-afu" class="md-nav__link">
    4. AFU
  </a>
  
    <nav class="md-nav" aria-label="4. AFU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-afu-top-level-module" class="md-nav__link">
    4.1. AFU top level module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-afu-interfaces" class="md-nav__link">
    4.2. AFU Interfaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-csr-interface" class="md-nav__link">
    4.3. CSR Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-addressing" class="md-nav__link">
    4.4. Addressing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-replicating-interface-parameters" class="md-nav__link">
    4.5. Replicating Interface Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46-systemverilog-packages" class="md-nav__link">
    4.6. SystemVerilog Packages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-host-software-development" class="md-nav__link">
    5. Host Software Development
  </a>
  
    <nav class="md-nav" aria-label="5. Host Software Development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-host-application-flow" class="md-nav__link">
    5.1. Host Application Flow
  </a>
  
    <nav class="md-nav" aria-label="5.1. Host Application Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-find-and-connect-to-afu" class="md-nav__link">
    5.1.1. Find and connect to AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-map-mmio-optional" class="md-nav__link">
    5.1.2. Map MMIO (optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-allocate-shared-memory-buffers" class="md-nav__link">
    5.1.3. Allocate Shared Memory Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514-perform-acceleration" class="md-nav__link">
    5.1.4. Perform Acceleration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#515-cleanup" class="md-nav__link">
    5.1.5. Cleanup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-building-the-host-application" class="md-nav__link">
    5.2. Building the Host Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-running-the-host-application" class="md-nav__link">
    5.3. Running the Host Application
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-packaging-the-afu" class="md-nav__link">
    6. Packaging the AFU
  </a>
  
    <nav class="md-nav" aria-label="6. Packaging the AFU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-accelerator-description-file" class="md-nav__link">
    6.1. Accelerator Description File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-source-list-file" class="md-nav__link">
    6.2. Source List File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-directory-structure" class="md-nav__link">
    6.3. Directory Structure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug_dev_afu_sim_env/" class="md-nav__link">
        AFU Simulation Environment User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_11" id="__nav_4_11_label" tabindex="0">
          Virtualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_11">
          <span class="md-nav__icon md-icon"></span>
          Virtualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug_docker/" class="md-nav__link">
        Docker User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug_kvm/" class="md-nav__link">
        KVM User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Agilex SoC Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Agilex SoC Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/doc_modules/contents_agx7_soc_attach/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/board_installation/f2000x_board_installation/f2000x_board_installation/" class="md-nav__link">
        Board Installation Guide (Intel® IPU Platform F2000X-PL)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/sw_installation/soc_attach/sw_install_soc_attach/" class="md-nav__link">
        Software Installation Guide for SoC Attach
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/f2000x/user_guides/ug_qs_ofs_f2000x/ug_qs_ofs_f2000x/" class="md-nav__link">
        Getting Started Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/f2000x/user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-nav__link">
        Automated Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/f2000x/reference_manuals/ofs_fim/mnl_fim_ofs/" class="md-nav__link">
        Shell Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs/" class="md-nav__link">
        Shell Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
          Workload Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_8">
          <span class="md-nav__icon md-icon"></span>
          Workload Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/f2000x/dev_guides/afu_dev/ug_dev_afu_ofs_f2000x/" class="md-nav__link">
        Workload Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../f2000x/ug_dev_pim_based_afu/" class="md-nav__link">
        PIM Based AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../f2000x/ug_dev_afu_sim_env/" class="md-nav__link">
        AFU Simulation Environment User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/f2000x/user_guides/ug_sim_ofs/ug_sim_ofs/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="0">
          Virtualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_10">
          <span class="md-nav__icon md-icon"></span>
          Virtualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../f2000x/ug_docker/" class="md-nav__link">
        Docker User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../f2000x/ug_kvm/" class="md-nav__link">
        KVM User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          oneAPI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          oneAPI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/user_guides/oneapi_asp/ug_oneapi_asp/" class="md-nav__link">
        oneAPI ASP Getting Started User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/reference_manual/oneapi_asp/oneapi_asp_ref_mnl/" class="md-nav__link">
        oneAPI Accelerator Support Package(ASP) Reference Manual
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          OFS Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          OFS Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/sw_installation/pcie_attach/sw_install_pcie_attach/" class="md-nav__link">
        Software Installation Guide OFS for PCIe Attach
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/sw_installation/soc_attach/sw_install_soc_attach/" class="md-nav__link">
        Software Installation Guide OFS for SoC Attach
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
          OPAE FPGA Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_4">
          <span class="md-nav__icon md-icon"></span>
          OPAE FPGA Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/fpgainfo/fpgainfo/" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/fpgasupdate/fpgasupdate/" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/mmlink/mmlink/" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/packager/packager/" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/userclk/userclk/" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/hssi/hssi/" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/pci_device/pci_device/" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/opae.io/opae.io/" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/rsu/rsu/" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/host_exerciser/host_exerciser/" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/hssi_ethernet/hssistats/" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/mem_tg/mem_tg/" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/vabtool/vabtool/" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/opaevfio/opaevfio/" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/ofs.uio/ofs.uio/" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/opaeuio/opaeuio/" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/fpgad/fpgad/" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    1. Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-afu-build-environment" class="md-nav__link">
    2. AFU Build Environment
  </a>
  
    <nav class="md-nav" aria-label="2. AFU Build Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-pim-resources" class="md-nav__link">
    2.1. PIM Resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-using-pim-to-interface-with-an-afu" class="md-nav__link">
    3. Using PIM to interface with an AFU
  </a>
  
    <nav class="md-nav" aria-label="3. Using PIM to interface with an AFU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-top-level-module-ofs_plaf_afu" class="md-nav__link">
    3.1. Top Level Module - ofs_plaf_afu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-host-channel" class="md-nav__link">
    3.2. Host Channel
  </a>
  
    <nav class="md-nav" aria-label="3.2. Host Channel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321-create-the-host-channel-interfaces-to-the-afu" class="md-nav__link">
    3.2.1. Create the host channel interfaces to the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#322-connect-the-host-channel-to-the-pim-shim" class="md-nav__link">
    3.2.2. Connect the host channel to the PIM Shim
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#323-avalon-example" class="md-nav__link">
    3.2.3. Avalon Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-local-memory" class="md-nav__link">
    3.3. Local Memory
  </a>
  
    <nav class="md-nav" aria-label="3.3. Local Memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331-create-the-local-memory-interfaces-to-the-afu" class="md-nav__link">
    3.3.1. Create the local memory interfaces to the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#332-connect-local-memory-to-the-pim-shim" class="md-nav__link">
    3.3.2. Connect local memory to the PIM Shim
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#333-avalon-example" class="md-nav__link">
    3.3.3. Avalon Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-high-speed-serial-interface-hssi" class="md-nav__link">
    3.4. High Speed Serial Interface (HSSI)
  </a>
  
    <nav class="md-nav" aria-label="3.4. High Speed Serial Interface (HSSI)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#341-create-the-hssi-interfaces-to-the-afu" class="md-nav__link">
    3.4.1. Create the HSSI interfaces to the AFU
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-tie-off-unused-ports" class="md-nav__link">
    3.5. Tie Off Unused ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-afu-instantiation" class="md-nav__link">
    3.6. AFU Instantiation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-afu" class="md-nav__link">
    4. AFU
  </a>
  
    <nav class="md-nav" aria-label="4. AFU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-afu-top-level-module" class="md-nav__link">
    4.1. AFU top level module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-afu-interfaces" class="md-nav__link">
    4.2. AFU Interfaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-csr-interface" class="md-nav__link">
    4.3. CSR Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-addressing" class="md-nav__link">
    4.4. Addressing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-replicating-interface-parameters" class="md-nav__link">
    4.5. Replicating Interface Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46-systemverilog-packages" class="md-nav__link">
    4.6. SystemVerilog Packages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-host-software-development" class="md-nav__link">
    5. Host Software Development
  </a>
  
    <nav class="md-nav" aria-label="5. Host Software Development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-host-application-flow" class="md-nav__link">
    5.1. Host Application Flow
  </a>
  
    <nav class="md-nav" aria-label="5.1. Host Application Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-find-and-connect-to-afu" class="md-nav__link">
    5.1.1. Find and connect to AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-map-mmio-optional" class="md-nav__link">
    5.1.2. Map MMIO (optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-allocate-shared-memory-buffers" class="md-nav__link">
    5.1.3. Allocate Shared Memory Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514-perform-acceleration" class="md-nav__link">
    5.1.4. Perform Acceleration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#515-cleanup" class="md-nav__link">
    5.1.5. Cleanup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-building-the-host-application" class="md-nav__link">
    5.2. Building the Host Application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-running-the-host-application" class="md-nav__link">
    5.3. Running the Host Application
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-packaging-the-afu" class="md-nav__link">
    6. Packaging the AFU
  </a>
  
    <nav class="md-nav" aria-label="6. Packaging the AFU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-accelerator-description-file" class="md-nav__link">
    6.1. Accelerator Description File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-source-list-file" class="md-nav__link">
    6.2. Source List File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-directory-structure" class="md-nav__link">
    6.3. Directory Structure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="pim-based-afu-developer-guide"><strong><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Based <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Developer Guide</strong><a class="headerlink" href="#pim-based-afu-developer-guide" title="Permanent link">&para;</a></h1>
<p>Last updated: <strong>May 13, 2024</strong> </p>
<h2 id="1-introduction"><strong>1. Introduction</strong><a class="headerlink" href="#1-introduction" title="Permanent link">&para;</a></h2>
<p>When creating an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, a designer needs to decide what type of interfaces the platform (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>) should provide to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.  The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> can provide the native interfaces (i.e. PCIe TLP commands) or standard memory mapped interfaces (i.e. AXI-MM or AVMM) by using the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>.  The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> is an abstraction layer consisting of a collection of SystemVerilog interfaces and shims to enable partial <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> portability across hardware despite variations in hardware topology and native interfaces. The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> adds a level of logic between the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> converting the native interfaces from the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> to match the interfaces provided by the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.
<a class="glightbox" href="/ofs-2024.1-1/hw/common/user_guides/afu_dev/ug_dev_pim_based_afu/images/PIM_top_intro.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="/ofs-2024.1-1/hw/common/user_guides/afu_dev/ug_dev_pim_based_afu/images/PIM_top_intro.png" /></a></p>
<p>This guide will walk you through creating a <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>-Based <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, including:</p>
<ul>
<li><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Build environment</li>
<li>Using the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> to interface with an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></li>
<li><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Design</li>
<li>Software Development</li>
<li>Packaging the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></li>
</ul>
<p>For more information on the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>, refer to <a href="https://github.com/OFS/ofs-platform-afu-bbb/blob/master/plat_if_develop/ofs_plat_if/docs/PIM_core_concepts.md"><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Core Concepts</a>.</p>
<p>For <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> based examples <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>'s to provide templates in designing your own <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, refer to <a href="https://github.com/OFS/examples-afu.git">examples <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></a>.</p>
<p>For steps on compiling your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, please see the associated platform's <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Developer Guide.</p>
<p>For steps on integrating your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> into the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, please see the associated platform's <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Developer Guide.</p>
<h2 id="2-afu-build-environment"><strong>2. <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Build Environment</strong><a class="headerlink" href="#2-afu-build-environment" title="Permanent link">&para;</a></h2>
<p>The Platform Interface Manager (<abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>) acts as a gateway between the board-specific platform and the generic <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. It manages resources, handles communication protocols, and translates platform-specific signals to a format the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> can understand. The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> wraps all <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> devices in a single container as an interface named <code>ofs_plat_if</code>, which is passed to the top-level <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> module <code>ofs_plat_afu</code>.</p>
<p>The below table shows the supported interfaces for each channel type by the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>.  </p>
<table>
<thead>
<tr>
<th>Channel</th>
<th>AXI-MM</th>
<th>AXI-Lite</th>
<th>Avalon MM</th>
<th>Avalon MM Rd/Wr</th>
<th>HSSI Channel</th>
</tr>
</thead>
<tbody>
<tr>
<td><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr></td>
<td></td>
<td>X</td>
<td>X</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Host Memory</td>
<td>X</td>
<td></td>
<td>X</td>
<td>X</td>
<td></td>
</tr>
<tr>
<td>Local Memory</td>
<td>X</td>
<td></td>
<td>X</td>
<td></td>
<td></td>
</tr>
<tr>
<td>HSSI</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>X</td>
</tr>
</tbody>
</table>
<p>A Partial Reconfiguration (<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>) build template is used for configuring a <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> build and is derived from a synthesized <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. The template includes the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> and the <code>afu_synth_setup</code> script, which generates a Quartus build environment for an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The build environment is instantiated from a <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> release and then configured for the specified <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> source files are specified in a text file parsed by the script when creating the Quartus project.</p>
<p>The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> is instantiated in the build environment from an .ini file describing the platform, located at 
<code>&lt;PR build template&gt;/hw/lib/platform/platform_db/&lt;ofs platform&gt;.ini</code></p>
<p>Example N6001 <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> .ini file, <code>&lt;pr_build_template&gt;/hw/lib/platform/platform_db/ofs_agilex.ini</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">;;</span><span class="w"> </span>Platform<span class="w"> </span>Interface<span class="w"> </span>Manager<span class="w"> </span>configuration
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="p">;;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">;;</span><span class="w"> </span>Intel®<span class="w"> </span>Agilex<span class="w"> </span>adp<span class="w"> </span>board
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">;;</span><span class="w"> </span>OFS<span class="w"> </span>FIM
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">;;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">;;</span><span class="w"> </span>Local<span class="w"> </span>memory<span class="w"> </span>with<span class="w"> </span>AXI-MM<span class="w"> </span>interface
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">;;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="o">[</span>define<span class="o">]</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="nv">PLATFORM_FPGA_FAMILY_AGILEX</span><span class="o">=</span><span class="m">1</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nv">PLATFORM_FPGA_FAMILY_AGILEX7</span><span class="o">=</span><span class="m">1</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="p">;;</span><span class="w"> </span>Indicates<span class="w"> </span>that<span class="w"> </span>ASE<span class="w"> </span>emulation<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>afu_main<span class="w"> </span>interface<span class="w"> </span>is<span class="w"> </span>offered
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="nv">ASE_AFU_MAIN_IF_OFFERED</span><span class="o">=</span><span class="m">1</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="nv">native_class</span><span class="o">=</span>none
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="p">;;</span><span class="w"> </span>Early<span class="w"> </span>versions<span class="w"> </span>of<span class="w"> </span>afu_main<span class="w"> </span>checked<span class="w"> </span>INCLUDE_HSSI_AND_NOT_CVL.<span class="w"> </span>When
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="p">;;</span><span class="w"> </span>this<span class="w"> </span>macro<span class="w"> </span>is<span class="w"> </span>set,<span class="w"> </span>the<span class="w"> </span>presence<span class="w"> </span>of<span class="w"> </span>HSSI<span class="w"> </span>ports<span class="w"> </span><span class="k">in</span><span class="w"> </span>afu_main<span class="o">()</span><span class="w"> </span>is
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="p">;;</span><span class="w"> </span>controlled<span class="w"> </span>by<span class="w"> </span>INCLUDE_HSSI.
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="nv">AFU_MAIN_API_USES_INCLUDE_HSSI</span><span class="o">=</span><span class="m">1</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="o">[</span>clocks<span class="o">]</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="nv">pclk_freq</span><span class="o">=</span>int<span class="s1">&#39;(ofs_fim_cfg_pkg::MAIN_CLK_MHZ)</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="s1">;; Newer parameter, more accurate when pclk is not an integer MHz</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="s1">pclk_freq_mhz_real=ofs_fim_cfg_pkg::MAIN_CLK_MHZ</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="s1">native_class=none</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="s1">[host_chan]</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="s1">num_ports=top_cfg_pkg::PG_AFU_NUM_PORTS</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="s1">native_class=native_axis_pcie_tlp</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="s1">gasket=pcie_ss</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="s1">mmio_addr_width=ofs_fim_cfg_pkg::MMIO_ADDR_WIDTH_PG</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="s1">num_intr_vecs=ofs_fim_cfg_pkg::NUM_AFU_INTERRUPTS</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="s1">;; Minimum number of outstanding flits that must be in flight to</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="s1">;; saturate bandwidth. Maximum bandwidth is typically a function</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="s1">;; of the number flits in flight, indepent of burst sizes.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="s1">max_bw_active_flits_rd=1024</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="s1">max_bw_active_flits_wr=128</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="s1">;; Recommended number of times an AFU should register host channel</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="s1">;; signals before use in order to make successful timing closure likely.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="s1">suggested_timing_reg_stages=0</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="s1">[local_mem]</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="s1">native_class=native_axi</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="s1">gasket=fim_emif_axi_mm</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="s1">num_banks=ofs_fim_mem_if_pkg::NUM_MEM_CHANNELS</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="s1">;; Address width (line-based, ignoring the byte offset within a line)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="s1">addr_width=ofs_fim_mem_if_pkg::AXI_MEM_ADDR_WIDTH-$clog2(ofs_fim_mem_if_pkg::AXI_MEM_WDATA_WIDTH/8)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="s1">data_width=ofs_fim_mem_if_pkg::AXI_MEM_WDATA_WIDTH</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="s1">ecc_width=0</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="s1">;; For consistency, the PIM always encodes burst width as if the bus were</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="s1">;; Avalon. Add 1 bit: Avalon burst length is 1-based, AXI is 0-based.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="s1">burst_cnt_width=8+1</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="s1">user_width=ofs_fim_mem_if_pkg::AXI_MEM_USER_WIDTH</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="s1">rid_width=ofs_fim_mem_if_pkg::AXI_MEM_ID_WIDTH</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="s1">wid_width=ofs_fim_mem_if_pkg::AXI_MEM_ID_WIDTH</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="s1">suggested_timing_reg_stages=2</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="s1">[hssi]</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="s1">native_class=native_axis_with_fc</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="s1">num_channels=ofs_fim_eth_plat_if_pkg::MAX_NUM_ETH_CHANNELS</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="s1">;; Sideband interface specific to this platform. It is used for passing</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="s1">;; state through plat_ifc.other.ports[] that the PIM does not manage.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="s1">[other]</span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="s1">;; Use the PIM&#39;</span>s<span class="w"> </span><span class="s2">&quot;generic&quot;</span><span class="w"> </span>extension<span class="w"> </span>class.<span class="w"> </span>The<span class="w"> </span>PIM<span class="w"> </span>provides<span class="w"> </span>the<span class="w"> </span>top-level
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a><span class="p">;;</span><span class="w"> </span>generic<span class="w"> </span>wrapper<span class="w"> </span>around<span class="w"> </span>ports<span class="w"> </span>and<span class="w"> </span>the<span class="w"> </span>implementation<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span><span class="nb">set</span><span class="w"> </span>below.
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="nv">template_class</span><span class="o">=</span>generic_templates
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="nv">native_class</span><span class="o">=</span>ports
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="p">;;</span><span class="w"> </span>All<span class="w"> </span>PIM<span class="w"> </span>wrappers<span class="w"> </span>are<span class="w"> </span>vectors.<span class="w"> </span>Depending<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>data<span class="w"> </span>being<span class="w"> </span>passed<span class="w"> </span>through
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="p">;;</span><span class="w"> </span>the<span class="w"> </span>interface,<span class="w"> </span>FIMs<span class="w"> </span>may<span class="w"> </span>either<span class="w"> </span>use<span class="w"> </span>more<span class="w"> </span>ports<span class="w"> </span>or<span class="w"> </span>put<span class="w"> </span>vectors<span class="w"> </span>inside<span class="w"> </span>the
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="p">;;</span><span class="w"> </span>port<span class="err">&#39;</span>s<span class="w"> </span>type.
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="nv">num_ports</span><span class="o">=</span><span class="m">1</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="p">;;</span><span class="w"> </span>Data<span class="w"> </span><span class="nb">type</span><span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>sideband<span class="w"> </span>interface
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="nv">type</span><span class="o">=</span>ofs_plat_fim_other_if
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="p">;;</span><span class="w"> </span>Import<span class="w"> </span>the<span class="w"> </span><span class="s2">&quot;other&quot;</span><span class="w"> </span>SystemVerilog<span class="w"> </span>definitions<span class="w"> </span>into<span class="w"> </span>the<span class="w"> </span>PIM<span class="w"> </span><span class="o">(</span>relative<span class="w"> </span>path<span class="o">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="nv">import</span><span class="o">=</span>import/extend_pim
</code></pre></div></p>
<p>The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> scripts choose the proper subset of <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> sources to map from standard <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> interfaces to physical hardware. Given an input .ini configuration file, <code>gen_ofs_plat_if</code> constructs an <code>ofs_plat_if</code> interface that is tailored to the target platform. Templates make it possible for the source tree to support multiple devices of similar types, such as both DDR and HBM, on a single board.</p>
<p>Each major section in a platform .ini file corresponds to one or more devices of the same type. Same-sized banks of local memory share a single .ini section, with the number of banks as a parameter in the section. The same is true of HSSI ports and, on some multi-PCIe systems, of host channels. All devices in a section must share the same properties. If there are two types of local memory on a board with different address or data widths, they must have their own local memory sections. Separate sections of the same type must be named with monotonically increasing numeric suffixes, e.g. local_memory.0 and local_memory.1. The trailing .0 is optional. host_channel.0 and host_channel are equivalent.</p>
<p>The <code>gen_ofs_plat_if</code> script, which composes a platform-specific <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> given an .ini file, uses the ofs_plat_if/src/rtl/ tree as a template. The script copies sources into the target <code>ofs_plat_if</code> interface within a release, generates some top-level wrapper files and emits rules that import the generated tree for simulation or synthesis.</p>
<p>For more information, refer to <a href="https://github.com/OFS/ofs-platform-afu-bbb/blob/master/plat_if_develop/ofs_plat_if/docs/PIM_board_vendors.md"><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Board Vendors</a></p>
<h3 id="21-pim-resources"><strong>2.1. <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Resources</strong><a class="headerlink" href="#21-pim-resources" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> provides a collection of RTL interfaces and modules.  These are copied over from ofs-platform-afu-bbb to <code>&lt;afu build dir&gt;/build/platform/ofs_plat_if/rtl/</code>.  The modules brought over are based on the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>'s native interfaces:</p>
<ul>
<li>ofs_plat_if.vh: <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>'s top level wrapper interface for passing all top-level interfaces into an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and is copied over to <code>&lt;afu build dir&gt;/build/platform/ofs_plat_if/rtl/ofs_plat_if.vh</code>. The 'ofs_plat_if' file typically contains the definition of the interface signals and parameters that connect the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>. This includes details about the data and control signals that the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> use to communicate, such as clocks, host channels or local memory.</li>
</ul>
<ul>
<li><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> interfaces are defined in <a href="https://github.com/OFS/ofs-platform-afu-bbb/tree/master/plat_if_develop/ofs_plat_if/src/rtl/base_ifcs">base_ifcs</a> and copied over to <code>&lt;afu build dir&gt;/build/platform/ofs_plat_if/rtl/base_ifcs</code>.  This base interface classes tree is a collection of generic interface definitions (e.g. Avalon and AXI) and helper modules (e.g. clock crossing and pipeline stage insertion).</li>
</ul>
<ul>
<li><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> modules are defined in <a href="https://github.com/OFS/ofs-platform-afu-bbb/tree/master/plat_if_develop/ofs_plat_if/src/rtl/ifc_classes">ifcs_classes</a> and copied over to <code>&lt;afu build dir&gt;/build/platform/ofs_plat_if/rtl/ifc_classes</code>. The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>-provided modules (aka shims) transform <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> interfaces to <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> interfaces.  On the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> side of its shims, all <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> modules share common base AXI and Avalon interfaces.  The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> modules are classified by the channels they support:<ul>
<li>host_chan</li>
<li>local_memory</li>
<li>hssi</li>
<li>Other</li>
</ul>
</li>
</ul>
<ul>
<li><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> utilities are defined in <a href="https://github.com/OFS/ofs-platform-afu-bbb/tree/master/plat_if_develop/ofs_plat_if/src/rtl/utils">utils</a> and copied over to <code>&lt;afu build dir&gt;/build/platform/ofs_plat_if/rtl/utils</code>.  Utilities include primitive shims, such as FIFOs, memories, and reorder buffers.</li>
</ul>
<h2 id="3-using-pim-to-interface-with-an-afu"><strong>3. Using <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> to interface with an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#3-using-pim-to-interface-with-an-afu" title="Permanent link">&para;</a></h2>
<p>To interface the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> with an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>:</p>
<ul>
<li>Create top level module ofs_plat_afu.sv.</li>
<li>For each Subsystem used by your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, create individual channel interfaces using your selected bus protocols and connect the channel <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Shims based on selected bus protocols.<ul>
<li>PCIe - Host Channel </li>
<li>Local Memory</li>
<li>HSSI</li>
</ul>
</li>
<li>Tie off all unused channels/ports.</li>
<li>Connect the channel interfaces to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> module.</li>
</ul>
<h3 id="31-top-level-module-ofs_plaf_afu"><strong>3.1. Top Level Module - ofs_plaf_afu</strong><a class="headerlink" href="#31-top-level-module-ofs_plaf_afu" title="Permanent link">&para;</a></h3>
<p>For a <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> based <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, start with the required top level module, ofs_plat_afu, which has a single interface, ofs_plat_if, containing all the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> connections.   It should include 'ofs_plat_if.vh' to ensure that the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> resources are available.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="sb">`</span>include<span class="w"> </span><span class="s2">&quot;ofs_plat_if.vh&quot;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>//
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>//<span class="w"> </span>Top<span class="w"> </span>level<span class="w"> </span>PIM-based<span class="w"> </span>module.
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>//
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>module<span class="w"> </span>ofs_plat_afu
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">   </span><span class="o">(</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span>//<span class="w"> </span>All<span class="w"> </span>platform<span class="w"> </span>wires,<span class="w"> </span>wrapped<span class="w"> </span><span class="k">in</span><span class="w"> </span>one<span class="w"> </span>interface.
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span>ofs_plat_if<span class="w"> </span>plat_ifc
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="o">)</span><span class="p">;</span>
</code></pre></div>
The SystemVerilog interface <code>ofs_plat_if</code> wraps all connections to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>'s devices. The contents of <code>ofs_plat_if</code> may vary from device to device. Portability is maintained by conforming to standard naming conventions. <code>ofs_plat_if</code> is, itself, a collection of interface wrappers to groups of devices.  Each PCIe virtual or physical function is treated by the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> as a separate channel.</p>
<p>For more information, refer to <a href="https://github.com/OFS/ofs-platform-afu-bbb/blob/master/plat_if_develop/ofs_plat_if/docs/PIM_AFU_interface.md"><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interface</a></p>
<h3 id="32-host-channel"><strong>3.2. Host Channel</strong><a class="headerlink" href="#32-host-channel" title="Permanent link">&para;</a></h3>
<p>The host channel serves as the communication pathway between the host and the FPGA. It facilitates the exchange of commands, data, and control signals, allowing the host to interact with the FPGA and manage accelerated functions. </p>
<p>For more information, refer to <a href="https://github.com/OFS/ofs-platform-afu-bbb/blob/master/plat_if_develop/ofs_plat_if/docs/PIM_ifc_host_channel.md"><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> IFC Host Channel</a></p>
<h4 id="321-create-the-host-channel-interfaces-to-the-afu"><strong>3.2.1. Create the host channel interfaces to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#321-create-the-host-channel-interfaces-to-the-afu" title="Permanent link">&para;</a></h4>
<p>The Host Memory interface is designed to facilitate the communication between the host and the FPGA as it allows the FPGA to access data stored in the host's main memory or to receive data from the host for processing.  </p>
<p>The Host Memory supported interface: </p>
<ul>
<li>AVMM </li>
<li>AVMM-RDWR </li>
<li>AXI-MM</li>
</ul>
<p>AXI-MM example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>ofs_plat_axi_mem_if
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="c1">#(</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="sb">`</span>HOST_CHAN_AXI_MEM_PARAMS,
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span>.LOG_CLASS<span class="o">(</span>ofs_plat_log_pkg::HOST_CHAN<span class="o">)</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="o">)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>host_mem<span class="o">()</span><span class="p">;</span>
</code></pre></div></p>
<p>The Memory-Mapped I/O (<abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>) allows the host to access and control specific registers or memory locations within the FPGA's address space. This interface is commonly used for configuring and interacting with hardware components through memory-mapped addresses.</p>
<p>The <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> supported interface: </p>
<ul>
<li>AVMM </li>
<li>AXI-Lite</li>
</ul>
<p>AXI-Lite example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>ofs_plat_axi_mem_lite_if
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="c1">#(</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="sb">`</span>HOST_CHAN_AXI_MMIO_PARAMS<span class="o">(</span><span class="m">64</span><span class="o">)</span>,
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span>.LOG_CLASS<span class="o">(</span>ofs_plat_log_pkg::HOST_CHAN<span class="o">)</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="o">)</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span>mmio64_to_afu<span class="o">()</span><span class="p">;</span>
</code></pre></div></p>
<h4 id="322-connect-the-host-channel-to-the-pim-shim"><strong>3.2.2. Connect the host channel to the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Shim</strong><a class="headerlink" href="#322-connect-the-host-channel-to-the-pim-shim" title="Permanent link">&para;</a></h4>
<p>Using the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Shim, host channel <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> interface is bridged over to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>'s host memory interface and <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> interface, making it usable for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>AXI example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>ofs_plat_host_chan_as_axi_mem_with_mmio<span class="w"> </span>primary_axi
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">       </span><span class="o">(</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">        </span>.to_fiu<span class="o">(</span>plat_ifc.host_chan.ports<span class="o">[</span><span class="m">0</span><span class="o">])</span>,
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">        </span>.host_mem_to_afu<span class="o">(</span>host_mem<span class="o">)</span>,
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">        </span>.mmio_to_afu<span class="o">(</span>mmio64_to_afu<span class="o">)</span>,
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">        </span>//<span class="w"> </span>These<span class="w"> </span>ports<span class="w"> </span>would<span class="w"> </span>be<span class="w"> </span>used<span class="w"> </span><span class="k">if</span><span class="w"> </span>the<span class="w"> </span>PIM<span class="w"> </span>is<span class="w"> </span>told<span class="w"> </span>to<span class="w"> </span>cross<span class="w"> </span>to
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">        </span>//<span class="w"> </span>a<span class="w"> </span>different<span class="w"> </span>clock.<span class="w"> </span>In<span class="w"> </span>this<span class="w"> </span>example,<span class="w"> </span>native<span class="w"> </span>pClk<span class="w"> </span>is<span class="w"> </span>used.
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">        </span>.afu_clk<span class="o">()</span>,
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">        </span>.afu_reset_n<span class="o">()</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">        </span><span class="o">)</span><span class="p">;</span>
</code></pre></div></p>
<h4 id="323-avalon-example"><strong>3.2.3. Avalon Example</strong><a class="headerlink" href="#323-avalon-example" title="Permanent link">&para;</a></h4>
<p>The following examples show the steps for a Avalon MM interface:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="w">    </span><span class="c1">#Host memory    </span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span>ofs_plat_avalon_mem_rdwr_if
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">      </span><span class="c1">#(</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">        </span><span class="sb">`</span>HOST_CHAN_AVALON_MEM_RDWR_PARAMS,
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">        </span>.LOG_CLASS<span class="o">(</span>ofs_plat_log_pkg::HOST_CHAN<span class="o">)</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">        </span><span class="o">)</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">      </span>host_mem<span class="o">()</span><span class="p">;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="c1">#MMIO</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span>ofs_plat_avalon_mem_if
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">      </span><span class="c1">#(</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">        </span><span class="sb">`</span>HOST_CHAN_AVALON_MMIO_PARAMS<span class="o">(</span><span class="m">64</span><span class="o">)</span>,
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">        </span>.LOG_CLASS<span class="o">(</span>ofs_plat_log_pkg::HOST_CHAN<span class="o">)</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">        </span><span class="o">)</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">        </span>mmio64_to_afu<span class="o">()</span><span class="p">;</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">    </span><span class="c1">#PIM Shim</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">    </span>ofs_plat_host_chan_as_avalon_mem_rdwr_with_mmio<span class="w"> </span>primary_avalon
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">       </span><span class="o">(</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">        </span>.to_fiu<span class="o">(</span>plat_ifc.host_chan.ports<span class="o">[</span><span class="m">0</span><span class="o">])</span>,
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">        </span>.host_mem_to_afu<span class="o">(</span>host_mem<span class="o">)</span>,
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">        </span>.mmio_to_afu<span class="o">(</span>mmio64_to_afu<span class="o">)</span>,
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">        </span>.afu_clk<span class="o">()</span>,
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">        </span>.afu_reset_n<span class="o">()</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">        </span><span class="o">)</span><span class="p">;</span>
</code></pre></div></p>
<h3 id="33-local-memory"><strong>3.3. Local Memory</strong><a class="headerlink" href="#33-local-memory" title="Permanent link">&para;</a></h3>
<p>Local memory is off-chip memory connected to an FPGA but not visible to the host as system memory.  Local memory is organized in groups and banks. Within a group, all banks have the same address and data widths.  </p>
<p>For more information, refer to <a href="https://github.com/OFS/ofs-platform-afu-bbb/blob/master/plat_if_develop/ofs_plat_if/docs/PIM_ifc_local_mem.md"><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> IFC Local Memory</a></p>
<h4 id="331-create-the-local-memory-interfaces-to-the-afu"><strong>3.3.1. Create the local memory interfaces to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#331-create-the-local-memory-interfaces-to-the-afu" title="Permanent link">&para;</a></h4>
<p>The Local Memory supported interfaces: </p>
<ul>
<li>AVMM </li>
<li>AXI-MM</li>
</ul>
<p>AXI-MM example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="w">    </span>ofs_plat_axi_mem_if
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">      </span><span class="c1">#(</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">        </span><span class="sb">`</span>LOCAL_MEM_AXI_MEM_PARAMS_DEFAULT,
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">        </span>.LOG_CLASS<span class="o">(</span>ofs_plat_log_pkg::LOCAL_MEM<span class="o">)</span>,
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">        </span>.BURST_CNT_WIDTH<span class="o">(</span><span class="nv">$clog2</span><span class="o">(</span>MAX_BURST_SIZE/ofs_plat_host_chan_pkg::DATA_WIDTH_BYTES<span class="o">))</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">        </span><span class="o">)</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">      </span>local_mem_to_afu<span class="o">[</span>local_mem_cfg_pkg::LOCAL_MEM_NUM_BANKS<span class="o">]()</span><span class="p">;</span>
</code></pre></div></p>
<h4 id="332-connect-local-memory-to-the-pim-shim"><strong>3.3.2. Connect local memory to the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Shim</strong><a class="headerlink" href="#332-connect-local-memory-to-the-pim-shim" title="Permanent link">&para;</a></h4>
<p>Using the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Shim, the local memory <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> interface is bridged over to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>'s local memory interface, making it usable for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>AXI example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="w">    </span>genvar<span class="w"> </span>b<span class="p">;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span>generate
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="o">(</span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span>b<span class="w"> </span>&lt;<span class="w"> </span>local_mem_cfg_pkg::LOCAL_MEM_NUM_BANKS<span class="p">;</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>b<span class="w"> </span>+<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">        </span>begin<span class="w"> </span>:<span class="w"> </span>mb
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">            </span>ofs_plat_local_mem_as_axi_mem
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">              </span><span class="c1">#(</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">                </span>.ADD_CLOCK_CROSSING<span class="o">(</span><span class="m">1</span><span class="o">)</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">                </span><span class="o">)</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">              </span>shim
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">               </span><span class="o">(</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">                </span>.to_fiu<span class="o">(</span>plat_ifc.local_mem.banks<span class="o">[</span>b<span class="o">])</span>,
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">                </span>.to_afu<span class="o">(</span>local_mem_to_afu<span class="o">[</span>b<span class="o">])</span>,
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">                </span>.afu_clk<span class="o">(</span>host_mem.clk<span class="o">)</span>,
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">                </span>.afu_reset_n<span class="o">(</span>host_mem.reset_n<span class="o">)</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">                </span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">        </span>end
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">    </span>endgenerate
</code></pre></div></p>
<h4 id="333-avalon-example"><strong>3.3.3. Avalon Example</strong><a class="headerlink" href="#333-avalon-example" title="Permanent link">&para;</a></h4>
<p>The following examples show the steps for a Avalon MM interface:
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="w">    </span>ofs_plat_avalon_mem_if
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">      </span><span class="c1">#(</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">        </span><span class="sb">`</span>LOCAL_MEM_AVALON_MEM_PARAMS_DEFAULT,
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">        </span>.LOG_CLASS<span class="o">(</span>ofs_plat_log_pkg::LOCAL_MEM<span class="o">)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">        </span><span class="o">)</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">      </span>local_mem_to_afu<span class="o">[</span>local_mem_cfg_pkg::LOCAL_MEM_NUM_BANKS<span class="o">]()</span><span class="p">;</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span>genvar<span class="w"> </span>b<span class="p">;</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span>generate
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="o">(</span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span>b<span class="w"> </span>&lt;<span class="w"> </span>local_mem_cfg_pkg::LOCAL_MEM_NUM_BANKS<span class="p">;</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>b<span class="w"> </span>+<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">        </span>begin<span class="w"> </span>:<span class="w"> </span>mb
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">            </span>ofs_plat_local_mem_as_avalon_mem
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">              </span><span class="c1">#(</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">                </span>.ADD_CLOCK_CROSSING<span class="o">(</span><span class="m">1</span><span class="o">)</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">                </span><span class="o">)</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">              </span>shim
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">               </span><span class="o">(</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">                </span>.to_fiu<span class="o">(</span>plat_ifc.local_mem.banks<span class="o">[</span>b<span class="o">])</span>,
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">                </span>.to_afu<span class="o">(</span>local_mem_to_afu<span class="o">[</span>b<span class="o">])</span>,
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w">                </span>.afu_clk<span class="o">(</span>mmio64_to_afu.clk<span class="o">)</span>,
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w">                </span>.afu_reset_n<span class="o">(</span>mmio64_to_afu.reset_n<span class="o">)</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">                </span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">        </span>end
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">    </span>endgenerate
</code></pre></div></p>
<h3 id="34-high-speed-serial-interface-hssi"><strong>3.4. High Speed Serial Interface (HSSI)</strong><a class="headerlink" href="#34-high-speed-serial-interface-hssi" title="Permanent link">&para;</a></h3>
<p>The High-Speed Serial Interface enables high-speed serial communication between the FPGA and external devices. It's commonly used for tasks such as high-speed data streaming, interfacing with storage devices, or connecting to network components.</p>
<h4 id="341-create-the-hssi-interfaces-to-the-afu"><strong>3.4.1. Create the HSSI interfaces to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#341-create-the-hssi-interfaces-to-the-afu" title="Permanent link">&para;</a></h4>
<p>The High-Speed Serial Interface enables high-speed serial communication between the FPGA and external devices. It's commonly used for tasks such as high-speed data streaming, interfacing with storage devices, or connecting to network components.</p>
<p>A vector of HSSI channels holds RX and TX AXI-S data interfaces. In addition to the data streams, each channel has a flow control interface on which pause requests are passed. Within a single channel, the RX, TX and pause interfaces share a clock. The clock is not guaranteed to be common across channels. The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> provides only an AXI-S data option.</p>
<p>Note: Clock Crossing not supported, parameter and ports are there for standardization</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="w">     </span>//<span class="w"> </span>HSSI<span class="w"> </span>Channels
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">     </span>ofs_plat_hssi_channel_if
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">     </span><span class="c1">#(</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">        </span>//<span class="w"> </span>Log<span class="w"> </span>AXI<span class="w"> </span>transactions<span class="w"> </span><span class="k">in</span><span class="w"> </span>simulation
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">        </span>.LOG_CLASS<span class="o">(</span>ofs_plat_log_pkg::HSSI<span class="o">)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">      </span><span class="o">)</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">      </span>hssi_to_afu<span class="o">[</span>ofs_fim_eth_if_pkg::NUM_ETH_CHANNELS<span class="o">]()</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span>genvar<span class="w"> </span>c<span class="p">;</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">    </span>generate
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="o">(</span><span class="nv">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span>c<span class="w"> </span>&lt;<span class="w"> </span>ofs_fim_eth_if_pkg::NUM_ETH_CHANNELS<span class="p">;</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>c<span class="w"> </span>+<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">        </span>begin<span class="w"> </span>:<span class="w"> </span>ch
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">            </span>ofs_plat_hssi_as_axi_st<span class="w">  </span>hssi_shim
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">               </span><span class="o">(</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">                </span>.to_fiu<span class="o">(</span>plat_ifc.hssi.channels<span class="o">[</span>c<span class="o">])</span>,
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">                </span>.rx_st<span class="o">(</span>hssi_to_afu<span class="o">[</span>c<span class="o">]</span>.data_rx<span class="o">)</span>,<span class="w"> </span>//<span class="w"> </span>HSSI-&gt;AFU
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">                </span>.tx_st<span class="o">(</span>hssi_to_afu<span class="o">[</span>c<span class="o">]</span>.data_tx<span class="o">)</span>,<span class="w"> </span>//<span class="w"> </span>AFU-&gt;HSSI
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">                </span>.fc<span class="o">(</span>hssi_to_afu<span class="o">[</span>c<span class="o">]</span>.fc<span class="o">)</span>,<span class="w">         </span>//<span class="w"> </span>Flow<span class="w"> </span>Control
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">                </span>//<span class="w"> </span>These<span class="w"> </span>are<span class="w"> </span>present<span class="w"> </span><span class="k">in</span><span class="w"> </span>all<span class="w"> </span>PIM<span class="w"> </span>interfaces,<span class="w"> </span>though<span class="w"> </span>not<span class="w"> </span>available<span class="w"> </span>with<span class="w"> </span>hssi.
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">                </span>.afu_clk<span class="o">()</span>,
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">                </span>.afu_reset_n<span class="o">()</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">                </span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">        </span>end
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">    </span>endgenerate
</code></pre></div>
<h3 id="35-tie-off-unused-ports"><strong>3.5. Tie Off Unused ports</strong><a class="headerlink" href="#35-tie-off-unused-ports" title="Permanent link">&para;</a></h3>
<p>In digital design, unused input ports can lead to unpredictable behavior. To prevent this, unused ports are "tied off" to a known state. Tie-offs are passed to the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> as bit masks in parameters. The mask makes it possible to indicate, for example, that a single local memory bank is being driven.  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>ofs_plat_if_tie_off_unused
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="c1">#(</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span>//<span class="w"> </span>Only<span class="w"> </span>using<span class="w"> </span>channel<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span>.HOST_CHAN_IN_USE_MASK<span class="o">(</span><span class="m">1</span><span class="o">)</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span>//<span class="w"> </span>Use<span class="w"> </span>two<span class="w"> </span>memory<span class="w"> </span>banks
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span>.LOCAL_MEM_IN_USE_MASK<span class="o">(</span><span class="m">3</span><span class="o">)</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span>//<span class="w"> </span>Use<span class="w"> </span><span class="m">4</span><span class="w"> </span>HSSI<span class="w"> </span>channel
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span>.HSSI_IN_USE_MASK<span class="o">(</span><span class="m">15</span><span class="o">)</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="o">)</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span>tie_off<span class="o">(</span>plat_ifc<span class="o">)</span><span class="p">;</span>
</code></pre></div>
<h3 id="36-afu-instantiation"><strong>3.6. <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Instantiation</strong><a class="headerlink" href="#36-afu-instantiation" title="Permanent link">&para;</a></h3>
<p>Instantiate the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in ofs_plat_afu.sv and connect to the channel interfaces.  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="w">    </span>//<span class="w"> </span><span class="o">=========================================================================</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span>//
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span>//<span class="w">   </span>Instantiate<span class="w"> </span>the<span class="w"> </span>AFU.
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span>//
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span>//<span class="w"> </span><span class="o">=========================================================================</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span>example_afu
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">       </span><span class="c1">#(</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">        </span>.NUM_LOCAL_MEM_BANKS<span class="o">(</span>local_mem_cfg_pkg::LOCAL_MEM_NUM_BANKS<span class="o">)</span>,
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">        </span>.NUM_ETHERNET_CHANNELS<span class="o">(</span>ofs_fim_eth_if_pkg::NUM_ETH_CHANNELS<span class="o">)</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">       </span><span class="o">)</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">       </span>afu_inst
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">       </span><span class="o">(</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">        </span>.mmio64_to_afu,
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">        </span>.host_mem,
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">        </span>.local_mem_to_afu,
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">        </span>.hssi_to_afu
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">        </span><span class="o">)</span><span class="p">;</span>
</code></pre></div>
<h2 id="4-afu"><strong>4. <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#4-afu" title="Permanent link">&para;</a></h2>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> requires that each channel uses the interfaces supported by the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>.   The below table shows the supported interfaces for each channel type.  The <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> channel is the only channel required by the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, while all other channels are optional and can be tied off.  </p>
<table>
<thead>
<tr>
<th>Channel</th>
<th>AXI-MM</th>
<th>AXI-Lite</th>
<th>Avalon MM</th>
<th>Avalon MM Rd/Wr</th>
<th>HSSI Channel</th>
</tr>
</thead>
<tbody>
<tr>
<td><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr></td>
<td></td>
<td>X</td>
<td>X</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Host Memory</td>
<td>X</td>
<td></td>
<td>X</td>
<td>X</td>
<td></td>
</tr>
<tr>
<td>Local Memory</td>
<td>X</td>
<td></td>
<td>X</td>
<td></td>
<td></td>
</tr>
<tr>
<td>HSSI</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>X</td>
</tr>
</tbody>
</table>
<h3 id="41-afu-top-level-module"><strong>4.1. <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> top level module</strong><a class="headerlink" href="#41-afu-top-level-module" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> module should match the interfaces provided by the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>. Including ofs_plat_if.vh in your module will bring in the base interface classes and channel interfaces:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="sb">`</span>include<span class="w"> </span><span class="s2">&quot;ofs_plat_if.vh&quot;</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>module<span class="w"> </span>example_afu
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span><span class="c1">#(</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span>parameter<span class="w"> </span><span class="nv">NUM_LOCAL_MEM_BANKS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>,
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">    </span>parameter<span class="w"> </span><span class="nv">NUM_ETHERNET_CHANNELS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">    </span><span class="o">)</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">   </span><span class="o">(</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">    </span>//<span class="w"> </span>CSR<span class="w"> </span>interface<span class="w"> </span><span class="o">(</span>MMIO<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>host<span class="o">)</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">    </span>ofs_plat_axi_mem_lite_if.to_source<span class="w"> </span>mmio64_to_afu,
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">    </span>//<span class="w"> </span>Host<span class="w"> </span>memory<span class="w"> </span><span class="o">(</span>DMA<span class="o">)</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">    </span>ofs_plat_axi_mem_if.to_sink<span class="w"> </span>host_mem_to_afu,
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">    </span>//<span class="w"> </span>Local<span class="w"> </span>memory<span class="w"> </span>interface<span class="w"> </span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="w">    </span>ofs_plat_axi_mem_if.to_sink<span class="w"> </span>local_mem_to_afu<span class="o">[</span>NUM_LOCAL_MEM_BANKS<span class="o">]</span>,
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">    </span>//<span class="w"> </span>High<span class="w"> </span>Speed<span class="w"> </span>Serial<span class="w"> </span>Interface
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="w">   </span>ofs_plat_hssi_channel_if<span class="w"> </span>hssi_to_afu<span class="w"> </span><span class="o">[</span>NUM_ETHERNET_CHANNELS<span class="o">]</span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="w">    </span><span class="o">)</span><span class="p">;</span>
</code></pre></div>
<h3 id="42-afu-interfaces"><strong>4.2. <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interfaces</strong><a class="headerlink" href="#42-afu-interfaces" title="Permanent link">&para;</a></h3>
<p>The AXI-MM and AXI-Lite interfaces are defined in the <code>&lt;afu_build_dir&gt;/build/platform/ofs_plat_if/rtl/base_ifcs/axi</code> directory.   </p>
<p>For AXI-MM and AXI-Lite, the handshaking signals (Ready and Valid) are separated from each of the interfaces (aw, w, b, ar, r). For example, the aw interface is defined as:
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>t_axi_mem_aw<span class="w"> </span>aw<span class="p">;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>logic<span class="w"> </span>awvalid<span class="p">;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>logic<span class="w"> </span>awready<span class="p">;</span>
</code></pre></div></p>
<p>The Avalon MM interfaces are defined in the <code>&lt;afu_build_dir&gt;/build/platform/ofs_plat_if/rtl/base_ifcs/avalon</code> directory.  There are two Avalon MM interfaces, a traditional interface (ofs_plat_avalon_mem_if) with shared read and write operations and a split-bus interface (ofs_plat_avalon_mem_rdwr_if) which separates the read and write channels.</p>
<p>The HSSI Channel interface is defined in the <code>&lt;afu_build_dir&gt;/build/platform/ofs_plat_if/rtl/ifc_classes/hssi</code> directory.   The HSSI channel is comprised of three interfaces, RX AXIS, TX AXIS and flow control.  These interfaces are defined in <code>&lt;afu_build dir&gt;/build/ofs-common/src/fpga_family/&lt;device family&gt;/hssi_ss/inc/ofs_eth_fim_if.sv</code>.</p>
<p>Clock and Resets definition and header files are in the <code>&lt;afu_build_dir&gt;/build/platform/ofs_plat_if/rtl/base_ifcs/clocks</code> directory.  By default, each channel has its own associated clock and reset which is derived from it connected subsystem.  Using the ADD_CROSS_CLOCKING option with the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> shims, allows the channels to all be on the same clock domain. 
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="w">    </span>//<span class="w"> </span>Each<span class="w"> </span>interface<span class="w"> </span>names<span class="w"> </span>its<span class="w"> </span>associated<span class="w"> </span>clock<span class="w"> </span>and<span class="w"> </span>reset.
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span>logic<span class="w"> </span>afu_clk<span class="p">;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span>assign<span class="w"> </span><span class="nv">afu_clk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>mmio64_to_afu.clk<span class="p">;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span>logic<span class="w"> </span>afu_reset_n<span class="p">;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span>assign<span class="w"> </span><span class="nv">afu_reset_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>mmio64_to_afu.reset_n<span class="p">;</span>
</code></pre></div></p>
<h3 id="43-csr-interface"><strong>4.3. CSR Interface</strong><a class="headerlink" href="#43-csr-interface" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> is the only required channel for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.   Besides providing a control and status interface for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> is required to have base registers as described in the <a href="https://github.com/OFS/linux-dfl/blob/fpga-ofs-dev/Documentation/fpga/dfl.rst#device-feature-list-dfl-overview">Device Feature List Overview</a>, which is used by the OPAE SW.    </p>
<p>When using the host channel, the Host creates shared buffers created between the Host CPU and FPGA.  The base address of these buffers should be passed to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> interface.  </p>
<h3 id="44-addressing"><strong>4.4. Addressing</strong><a class="headerlink" href="#44-addressing" title="Permanent link">&para;</a></h3>
<p>The interface addressing depends on the interface's bus protocol, the below table shows the addressing based of interface.</p>
<table>
<thead>
<tr>
<th>Interface</th>
<th>Addressing</th>
</tr>
</thead>
<tbody>
<tr>
<td>AXI</td>
<td>Byte</td>
</tr>
<tr>
<td>Avalon</td>
<td>Word</td>
</tr>
</tbody>
</table>
<h3 id="45-replicating-interface-parameters"><strong>4.5. Replicating Interface Parameters</strong><a class="headerlink" href="#45-replicating-interface-parameters" title="Permanent link">&para;</a></h3>
<p>When creating interfaces in the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, using `OFS_PLAT_AXI_MEM_IF_REPLICATE_PARAMS or `OFS_PLAT_AVALON_MEM_IF_REPLICATE_PARAMS allows the interface to have the same parameters as the channel interface. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>//<span class="w"> </span>The<span class="w"> </span><span class="nb">read</span><span class="w"> </span>ports<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>connected<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span><span class="nb">read</span><span class="w"> </span>engine<span class="w"> </span>and<span class="w"> </span>the<span class="w"> </span>write<span class="w"> </span>ports<span class="w"> </span>unused.
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>//<span class="w"> </span>This<span class="w"> </span>will<span class="w"> </span>split<span class="w"> </span>the<span class="w"> </span><span class="nb">read</span><span class="w"> </span>channels<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>write<span class="w"> </span>channels<span class="w"> </span>but<span class="w"> </span>keep
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>//<span class="w"> </span>a<span class="w"> </span>single<span class="w"> </span>interface<span class="w"> </span>type.
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>ofs_plat_axi_mem_if
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">  </span><span class="c1">#(</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">  </span>//<span class="w"> </span>Copy<span class="w"> </span>the<span class="w"> </span>configuration<span class="w"> </span>from<span class="w"> </span>host_mem
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">     </span><span class="sb">`</span>OFS_PLAT_AXI_MEM_IF_REPLICATE_PARAMS<span class="o">(</span>host_mem<span class="o">)</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">    </span><span class="o">)</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">    </span>host_mem_rd<span class="o">()</span><span class="p">;</span>
</code></pre></div>
<h3 id="46-systemverilog-packages"><strong>4.6. SystemVerilog Packages</strong><a class="headerlink" href="#46-systemverilog-packages" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> project provides System Verilog packages, which provide configuration details for the different channels.</p>
<p>The Host Channel and Local Memory System Verilog packages are included by default in the Quartus Project:</p>
<ul>
<li>Host Channel Package: ofs_plat_host_chan_pkg
    <code>&lt;afu_build_dir&gt;/build/platform/ofs_plat_if/rtl/ifc_classes/host_chan/afu_ifcs/include/ofs_plat_host_chan_pkg.sv</code></li>
<li>Local Memory Package: local_mem_cfg_pkg<br />
<code>&lt;afu_build_dir&gt;/build/platform/ofs_plat_if/rtl/ifc_classes/local_mem/local_mem_cfg_pkg.sv</code></li>
</ul>
<p>The HSSI Channel System Verilog package is not included by default, therefore it needs to be imported:</p>
<ul>
<li>HSSI Channel Package: ofs_fim_eth_if_pkg<br />
<code>&lt;afu_build_dir&gt;/build/ofs-common/src/fpga_family/agilex/hssi_ss/inc/ofs_fim_eth_if_pkg.sv</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>import<span class="w"> </span>ofs_fim_eth_if_pkg::*<span class="p">;</span>
</code></pre></div></li>
</ul>
<h2 id="5-host-software-development"><strong>5. Host Software Development</strong><a class="headerlink" href="#5-host-software-development" title="Permanent link">&para;</a></h2>
<p>The host application is used to control the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and manage data transfer between the host and the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.   The host channel provides two interfaces between the host and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> and Host Memory.   <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> is used to read/write the CSR interface of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, and the Host Memory interface is used to share data between the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and Host user space. 
<a class="glightbox" href="/ofs-2024.1-1/hw/common/user_guides/afu_dev/ug_dev_pim_based_afu/images/SW_Model.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="/ofs-2024.1-1/hw/common/user_guides/afu_dev/ug_dev_pim_based_afu/images/SW_Model.png" /></a></p>
<h3 id="51-host-application-flow"><strong>5.1. Host Application Flow</strong><a class="headerlink" href="#51-host-application-flow" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> provides a library with routines to setup and manage the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.  The basic host application flow is as follows:</p>
<p><a class="glightbox" href="/ofs-2024.1-1/hw/common/user_guides/afu_dev/ug_dev_pim_based_afu/images/SW_Flow.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="/ofs-2024.1-1/hw/common/user_guides/afu_dev/ug_dev_pim_based_afu/images/SW_Flow.png" /></a></p>
<p>When creating the host application, the following OPAE Header Files are required:
- opae/fpga.h  - For the OPAE C API library 
- afu_json_info.h - For <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> information including UUID </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>//<span class="w"> </span>Headers<span class="w"> </span>needed<span class="w"> </span><span class="k">for</span><span class="w"> </span>example<span class="w"> </span>code
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="c1">#include &lt;stdint.h&gt;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1">#include &lt;stdio.h&gt;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1">#include &lt;stdlib.h&gt;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="c1">#include &lt;assert.h&gt;</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>//<span class="w"> </span>For<span class="w"> </span>uuid_parse<span class="o">()</span><span class="w"> </span>to<span class="w"> </span>convert<span class="w"> </span>UUID<span class="w"> </span>string<span class="w"> </span>into<span class="w"> </span>binary
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="c1">#include &lt;uuid/uuid.h&gt;</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>//<span class="w"> </span>OPAE<span class="w"> </span>C<span class="w"> </span>API
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="c1">#include &lt;opae/fpga.h&gt;</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>//<span class="w"> </span>State<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>AFU<span class="s1">&#39;s JSON file, extracted using OPAE&#39;</span>s<span class="w"> </span>afu_json_mgr<span class="w"> </span>script
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="c1">#include &quot;afu_json_info.h&quot;</span>
</code></pre></div>
<h4 id="511-find-and-connect-to-afu"><strong>5.1.1. Find and connect to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#511-find-and-connect-to-afu" title="Permanent link">&para;</a></h4>
<p>Here is an example function which searches for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> based on its UUID.  If there is a match, it will connect to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.   It will also check to see if the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is being run in hardware or simulation (ASE).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>//<span class="w"> </span>Set<span class="w"> </span>as<span class="w"> </span>global,<span class="w"> </span>to<span class="w"> </span>allow<span class="w"> </span>MMIO<span class="w"> </span>routines<span class="w"> </span>to<span class="w"> </span>access<span class="w"> </span><span class="k">in</span><span class="w"> </span>ASE<span class="w"> </span>mode
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>static<span class="w"> </span>fpga_handle<span class="w"> </span>s_accel_handle<span class="p">;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>//
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>//<span class="w"> </span>Search<span class="w"> </span><span class="k">for</span><span class="w"> </span>an<span class="w"> </span>accelerator<span class="w"> </span>matching<span class="w"> </span>the<span class="w"> </span>requested<span class="w"> </span>UUID<span class="w"> </span>and<span class="w"> </span>connect<span class="w"> </span>to<span class="w"> </span>it.
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>//<span class="w"> </span>Check<span class="w"> </span>to<span class="w"> </span>see<span class="w"> </span><span class="k">if</span><span class="w"> </span>running<span class="w"> </span><span class="k">in</span><span class="w"> </span>ASE-Simulation<span class="w"> </span>mode
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>//
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>static<span class="w"> </span>fpga_handle<span class="w"> </span>connect_to_accel<span class="o">(</span>const<span class="w"> </span>char<span class="w"> </span>*accel_uuid,<span class="w"> </span>bool<span class="w"> </span>*is_ase_sim<span class="o">)</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="o">{</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">    </span>fpga_properties<span class="w"> </span><span class="nv">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>NULL<span class="p">;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">    </span>fpga_guid<span class="w"> </span>guid<span class="p">;</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">    </span>fpga_token<span class="w"> </span>accel_token<span class="p">;</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">    </span>uint32_t<span class="w"> </span>num_matches<span class="p">;</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">    </span>fpga_handle<span class="w"> </span>accel_handle<span class="p">;</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">    </span>fpga_result<span class="w"> </span>r<span class="p">;</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">    </span>//<span class="w"> </span>Don<span class="err">&#39;</span>t<span class="w"> </span>print<span class="w"> </span>verbose<span class="w"> </span>messages<span class="w"> </span><span class="k">in</span><span class="w"> </span>ASE<span class="w"> </span>by<span class="w"> </span>default
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">    </span>setenv<span class="o">(</span><span class="s2">&quot;ASE_LOG&quot;</span>,<span class="w"> </span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">    </span>*is_ase_sim<span class="w"> </span><span class="o">=</span><span class="w"> </span>NULL<span class="p">;</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">    </span>//<span class="w"> </span>Set<span class="w"> </span>up<span class="w"> </span>a<span class="w"> </span>filter<span class="w"> </span>that<span class="w"> </span>will<span class="w"> </span>search<span class="w"> </span><span class="k">for</span><span class="w"> </span>an<span class="w"> </span>accelerator
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">    </span>fpgaGetProperties<span class="o">(</span>NULL,<span class="w"> </span><span class="p">&amp;</span>filter<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">    </span>fpgaPropertiesSetObjectType<span class="o">(</span>filter,<span class="w"> </span>FPGA_ACCELERATOR<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="w">    </span>//<span class="w"> </span>Convert<span class="w"> </span>UUID<span class="w"> </span>string<span class="w"> </span>into<span class="w"> </span>binary
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="w">    </span>uuid_parse<span class="o">(</span>accel_uuid,<span class="w"> </span>guid<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="w">    </span>//<span class="w"> </span>Add<span class="w"> </span>the<span class="w"> </span>desired<span class="w"> </span>UUID<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>filter
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="w">    </span>fpgaPropertiesSetGUID<span class="o">(</span>filter,<span class="w"> </span>guid<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="w">    </span>//<span class="w"> </span>Do<span class="w"> </span>the<span class="w"> </span>search<span class="w"> </span>across<span class="w"> </span>the<span class="w"> </span>available<span class="w"> </span>FPGA<span class="w"> </span>contexts
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="w">    </span><span class="nv">num_matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="w">    </span>fpgaEnumerate<span class="o">(</span><span class="p">&amp;</span>filter,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="p">&amp;</span>accel_token,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="p">&amp;</span>num_matches<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="w">    </span>//<span class="w"> </span>Not<span class="w"> </span>needed<span class="w"> </span>anymore
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="w">    </span>fpgaDestroyProperties<span class="o">(</span><span class="p">&amp;</span>filter<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>
<a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>num_matches<span class="w"> </span>&lt;<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="w">        </span>fprintf<span class="o">(</span>stderr,<span class="w"> </span><span class="s2">&quot;Accelerator %s not found!\n&quot;</span>,<span class="w"> </span>accel_uuid<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>
<a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a><span class="w">    </span>//<span class="w"> </span>Acquire<span class="w"> </span>ownership<span class="w"> </span>of<span class="w"> </span>accelerator
<a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a><span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fpgaOpen<span class="o">(</span>accel_token,<span class="w"> </span><span class="p">&amp;</span>accel_handle,<span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a><span class="w">    </span>assert<span class="o">(</span><span class="nv">FPGA_OK</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>r<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a>
<a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a><span class="w">    </span>//<span class="w"> </span>While<span class="w"> </span>the<span class="w"> </span>token<span class="w"> </span>is<span class="w"> </span>available,<span class="w"> </span>check<span class="w"> </span>whether<span class="w"> </span>it<span class="w"> </span>is<span class="w"> </span><span class="k">for</span><span class="w"> </span>HW<span class="w"> </span>or<span class="w"> </span><span class="k">for</span><span class="w"> </span>ASE<span class="w"> </span>simulation.
<a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a><span class="w">    </span>fpga_properties<span class="w"> </span>accel_props<span class="p">;</span>
<a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a><span class="w">    </span>uint16_t<span class="w"> </span>vendor_id,<span class="w"> </span>dev_id<span class="p">;</span>
<a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a><span class="w">    </span>fpgaGetProperties<span class="o">(</span>accel_token,<span class="w"> </span><span class="p">&amp;</span>accel_props<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a><span class="w">    </span>fpgaPropertiesGetVendorID<span class="o">(</span>accel_props,<span class="w"> </span><span class="p">&amp;</span>vendor_id<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a><span class="w">    </span>fpgaPropertiesGetDeviceID<span class="o">(</span>accel_props,<span class="w"> </span><span class="p">&amp;</span>dev_id<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a><span class="w">    </span>*is_ase_sim<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="nv">vendor_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>0x8086<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">dev_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>0xa5e<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a>
<a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a><span class="w">    </span>//<span class="w"> </span>Done<span class="w"> </span>with<span class="w"> </span>token
<a id="__codelineno-18-56" name="__codelineno-18-56" href="#__codelineno-18-56"></a><span class="w">    </span>fpgaDestroyToken<span class="o">(</span><span class="p">&amp;</span>accel_token<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-18-57" name="__codelineno-18-57" href="#__codelineno-18-57"></a>
<a id="__codelineno-18-58" name="__codelineno-18-58" href="#__codelineno-18-58"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>accel_handle<span class="p">;</span>
<a id="__codelineno-18-59" name="__codelineno-18-59" href="#__codelineno-18-59"></a><span class="o">}</span>
</code></pre></div>
<p>In main(), the function is called updating the accel_handle and ASE status.   AFU_ACCEL_UUID is provided by afu_json_info.h created for the Accelerator Descriptor File:
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="w">    </span>bool<span class="w"> </span>is_ase_sim<span class="p">;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span>//<span class="w"> </span>Find<span class="w"> </span>and<span class="w"> </span>connect<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>accelerator<span class="o">(</span>s<span class="o">)</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="nv">s_accel_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>connect_to_accel<span class="o">(</span>AFU_ACCEL_UUID,<span class="w"> </span><span class="p">&amp;</span>is_ase_sim<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">NULL</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>s_accel_handle<span class="o">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
</code></pre></div></p>
<h4 id="512-map-mmio-optional"><strong>5.1.2. Map <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> (optional)</strong><a class="headerlink" href="#512-map-mmio-optional" title="Permanent link">&para;</a></h4>
<p>Mapping the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> provides higher performance on the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> access versus the standard OPAE <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> functions.  fpgaMapMMIO() is used to return a pointer to the specified <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> space of the target <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in process virtual memory.  When running in ASE mode, <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> mapping isn't supported and the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> pointer is set to NULL.   </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>static<span class="w"> </span>volatile<span class="w"> </span>uint64_t<span class="w"> </span>*s_mmio_buf<span class="p">;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>fpga_result<span class="w"> </span>r<span class="p">;</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>is_ase_sim<span class="o">)</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">        </span>printf<span class="o">(</span><span class="s2">&quot;Running in ASE Mode&quot;</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">        </span><span class="nv">s_mmio_buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>NULL<span class="p">;</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">        </span>uint64_t<span class="w"> </span>*tmp_ptr<span class="p">;</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fpgaMapMMIO<span class="o">(</span>s_accel_handle,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="p">&amp;</span>tmp_ptr<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">        </span>assert<span class="o">(</span><span class="nv">FPGA_OK</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>r<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">        </span><span class="nv">s_mmio_buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tmp_ptr<span class="p">;</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">    </span><span class="o">}</span>
</code></pre></div>
<p>The below example functions provide <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Reads/Writes.   When running in hardware the functions will use s_mmio_buf for accessing.  When running in ASE mode, indicated by s_mmio_buf being set to NULL, fpgaReadMMIO64() fpgaWriteMMIO64() will be used.
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>//
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>//<span class="w"> </span>Read<span class="w"> </span>a<span class="w"> </span><span class="m">64</span><span class="w"> </span>bit<span class="w"> </span>CSR.<span class="w"> </span>When<span class="w"> </span>a<span class="w"> </span>pointer<span class="w"> </span>to<span class="w"> </span>CSR<span class="w"> </span>buffer<span class="w"> </span>is<span class="w"> </span>available,<span class="w"> </span><span class="nb">read</span><span class="w"> </span>directly.
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>//<span class="w"> </span>Direct<span class="w"> </span>reads<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>significantly<span class="w"> </span>faster.
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>//<span class="w"> </span>If<span class="w"> </span>s_mmio_buf<span class="w"> </span>is<span class="w"> </span>NULL,<span class="w"> </span><span class="k">in</span><span class="w"> </span>ASE<span class="w"> </span>mode<span class="w"> </span>and<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span>OPAE<span class="w"> </span>MMIO<span class="w"> </span>functions.
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>//
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>static<span class="w"> </span>inline<span class="w"> </span>uint64_t<span class="w"> </span>readMMIO64<span class="o">(</span>uint32_t<span class="w"> </span>idx<span class="o">)</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="o">{</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>s_mmio_buf<span class="o">)</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span>s_mmio_buf<span class="o">[</span>idx<span class="o">]</span><span class="p">;</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">        </span>fpga_result<span class="w"> </span>r<span class="p">;</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">        </span>uint64_t<span class="w"> </span>v<span class="p">;</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fpgaReadMMIO64<span class="o">(</span>s_accel_handle,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">8</span><span class="w"> </span>*<span class="w"> </span>idx,<span class="w"> </span><span class="p">&amp;</span>v<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="w">        </span>assert<span class="o">(</span><span class="nv">FPGA_OK</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>r<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span>v<span class="p">;</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="o">}</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>//
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>//<span class="w"> </span>Write<span class="w"> </span>a<span class="w"> </span><span class="m">64</span><span class="w"> </span>bit<span class="w"> </span>CSR.<span class="w"> </span>When<span class="w"> </span>a<span class="w"> </span>pointer<span class="w"> </span>to<span class="w"> </span>CSR<span class="w"> </span>buffer<span class="w"> </span>is<span class="w"> </span>available,<span class="w"> </span>write<span class="w"> </span>directly.
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>//
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>static<span class="w"> </span>inline<span class="w"> </span>void<span class="w"> </span>writeMMIO64<span class="o">(</span>uint32_t<span class="w"> </span>idx,<span class="w"> </span>uint64_t<span class="w"> </span>v<span class="o">)</span>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="o">{</span>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>s_mmio_buf<span class="o">)</span>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="w">        </span>s_mmio_buf<span class="o">[</span>idx<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>v<span class="p">;</span>
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="w">        </span>fpgaWriteMMIO64<span class="o">(</span>s_accel_handle,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">8</span><span class="w"> </span>*<span class="w"> </span>idx,<span class="w"> </span>v<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a><span class="o">}</span>
</code></pre></div></p>
<h4 id="513-allocate-shared-memory-buffers"><strong>5.1.3. Allocate Shared Memory Buffers</strong><a class="headerlink" href="#513-allocate-shared-memory-buffers" title="Permanent link">&para;</a></h4>
<p>The below example function creates the shared buffers and provides the physical address for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> access.
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>//
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>//<span class="w"> </span>Allocate<span class="w"> </span>a<span class="w"> </span>buffer<span class="w"> </span><span class="k">in</span><span class="w"> </span>I/O<span class="w"> </span>memory,<span class="w"> </span>shared<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>FPGA.
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>//
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>static<span class="w"> </span>volatile<span class="w"> </span>void*<span class="w"> </span>alloc_buffer<span class="o">(</span>fpga_handle<span class="w"> </span>accel_handle,
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">                                   </span>ssize_t<span class="w"> </span>size,
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">                                   </span>uint64_t<span class="w"> </span>*wsid,
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">                                   </span>uint64_t<span class="w"> </span>*io_addr<span class="o">)</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="o">{</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">    </span>fpga_result<span class="w"> </span>r<span class="p">;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">    </span>volatile<span class="w"> </span>void*<span class="w"> </span>buf<span class="p">;</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fpgaPrepareBuffer<span class="o">(</span>accel_handle,<span class="w"> </span>size,<span class="w"> </span><span class="o">(</span>void*<span class="o">)</span><span class="p">&amp;</span>buf,<span class="w"> </span>wsid,<span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>FPGA_OK<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>r<span class="o">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>NULL<span class="p">;</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">    </span>//<span class="w"> </span>Get<span class="w"> </span>the<span class="w"> </span>physical<span class="w"> </span>address<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>buffer<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>accelerator
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fpgaGetIOAddress<span class="o">(</span>accel_handle,<span class="w"> </span>*wsid,<span class="w"> </span>io_addr<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w">    </span>assert<span class="o">(</span><span class="nv">FPGA_OK</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>r<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>buf<span class="p">;</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="o">}</span>
</code></pre></div></p>
<p>In main(), define the buffers and use the above function to allocate the shared buffers.   OPAE supports multiple buffers, and the number of buffers is design dependent.  Buffers over 4KB require hugepage support on the host.   The buffer address needs to be passed to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> over <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>, for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to correctly access the buffer.
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="w">    </span><span class="c1">#define BUF_SIZE_IN_BYTES 16384</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span>volatile<span class="w"> </span>unsigned<span class="w"> </span>char<span class="w"> </span>*src_buf<span class="p">;</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span>uint64_t<span class="w"> </span>src_wsid<span class="p">;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">    </span>uint64_t<span class="w"> </span>src_pa<span class="p">;</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">    </span>volatile<span class="w"> </span>unsigned<span class="w"> </span>char<span class="w"> </span>*dst_buf<span class="p">;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">    </span>uint64_t<span class="w"> </span>dst_wsid<span class="p">;</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">    </span>uint64_t<span class="w"> </span>dst_pa<span class="p">;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">    </span><span class="nv">src_buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>alloc_buffer<span class="o">(</span>s_accel_handle,<span class="w"> </span>BUF_SIZE_IN_BYTES,<span class="w"> </span><span class="p">&amp;</span>src_wsid,<span class="w"> </span><span class="p">&amp;</span>src_pa<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">    </span>assert<span class="o">(</span>NULL<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>src_buf<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">    </span><span class="nv">dst_buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>alloc_buffer<span class="o">(</span>s_accel_handle,<span class="w"> </span>BUF_SIZE_IN_BYTES,<span class="w"> </span><span class="p">&amp;</span>dst_wsid,<span class="w"> </span><span class="p">&amp;</span>dst_pa<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">    </span>assert<span class="o">(</span>NULL<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>dst_buf<span class="o">)</span><span class="p">;</span>
</code></pre></div></p>
<h4 id="514-perform-acceleration"><strong>5.1.4. Perform Acceleration</strong><a class="headerlink" href="#514-perform-acceleration" title="Permanent link">&para;</a></h4>
<p>The host application interaction is <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> dependent.  Generally, the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> interface will be used to setup and control the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.   While the shared buffers are used to pass data between the host and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.   Below is an example of setting up the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, writing the buffer and retrieving the results from the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>//<span class="w"> </span>Loading<span class="w"> </span><span class="nb">source</span><span class="w"> </span>buffer<span class="w"> </span>with<span class="w"> </span>walking<span class="w"> </span>ones
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="k">for</span><span class="o">(</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span>&lt;<span class="w"> </span>BUF_SIZE_IN_BYTES<span class="p">;</span><span class="w"> </span>i++<span class="o">)</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="o">{</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">   </span>src_buf<span class="o">[</span>i<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="o">(</span>i<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>0x7<span class="o">)</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>walking<span class="w"> </span>ones
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="o">}</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>//<span class="w"> </span>Send<span class="w"> </span>AFU<span class="w"> </span>buffer<span class="w"> </span>addresses<span class="w"> </span>and<span class="w"> </span>size<span class="w"> </span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>//<span class="w"> </span>register<span class="w"> </span>addresses<span class="w"> </span>are<span class="w"> </span>based<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>AFU<span class="w"> </span>CSR<span class="w"> </span>interface
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>writeMMIO64<span class="o">(</span><span class="m">8</span>,<span class="w"> </span>src_pa<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>writeMMIO64<span class="o">(</span><span class="m">9</span>,<span class="w"> </span>dst_pa<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>writeMMIO64<span class="o">(</span><span class="m">10</span>,<span class="w"> </span>buf_size<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>//<span class="w"> </span>Start<span class="w"> </span>Acceleration
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>writeMMIO64<span class="o">(</span><span class="m">11</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>//<span class="w"> </span>Wait<span class="w"> </span><span class="k">for</span><span class="w"> </span>AFU<span class="w"> </span>to<span class="w"> </span><span class="nb">complete</span><span class="w"> </span>acceleration
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="k">while</span><span class="o">(</span>!readMMIO64<span class="o">(</span><span class="m">12</span><span class="o">))</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w">   </span><span class="p">;</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>//<span class="w"> </span>Read<span class="w"> </span>destination<span class="w"> </span>buffer<span class="w"> </span>and<span class="w"> </span>print<span class="w"> </span>output
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>printf<span class="o">(</span><span class="s2">&quot;output: &quot;</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="k">for</span><span class="o">(</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span>&lt;<span class="w"> </span>BUF_SIZE_IN_BYTES<span class="p">;</span><span class="w"> </span>i++<span class="o">)</span>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="o">{</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="w">   </span>printf<span class="o">(</span><span class="s2">&quot;%d &quot;</span>,<span class="w"> </span>dst_buf<span class="o">[</span>i<span class="o">])</span><span class="p">;</span>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="o">}</span>
</code></pre></div></p>
<h4 id="515-cleanup"><strong>5.1.5. Cleanup</strong><a class="headerlink" href="#515-cleanup" title="Permanent link">&para;</a></h4>
<p>When the acceleration is complete, the host application should release the shared buffers and release ownership of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="w">    </span>//<span class="w"> </span>Release<span class="w"> </span>shared<span class="w"> </span>buffers
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">    </span>fpgaReleaseBuffer<span class="o">(</span>s_accel_handle,<span class="w"> </span>src_wsid<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span>fpgaReleaseBuffer<span class="o">(</span>s_accel_handle,<span class="w"> </span>dst_wsid<span class="o">)</span><span class="p">;</span><span class="w">   </span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span>//<span class="w"> </span>Release<span class="w"> </span>ownership<span class="w"> </span>of<span class="w"> </span>accelerator
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">    </span>fpgaClose<span class="o">(</span>s_accel_handle<span class="o">)</span><span class="p">;</span>
</code></pre></div></p>
<h3 id="52-building-the-host-application"><strong>5.2. Building the Host Application</strong><a class="headerlink" href="#52-building-the-host-application" title="Permanent link">&para;</a></h3>
<p>A Makefile is used to build the host application.   Below is an example Makefile from the <a href="https://github.com/OFS/examples-afu.git">examples <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></a> repo with the following updated:</p>
<ul>
<li>Path to common_include.mk (from examples-afu)</li>
<li>TEST name</li>
<li>Source files: SRCS</li>
<li>Path to .json file (relative to Makefile directory)</li>
</ul>
<p>Makefile:
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># Path to examples-afu/tutorial/afu_types/01_pim_ifc/common/sw/common_include.mk</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>include<span class="w"> </span>../../common/sw/common_include.mk
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="c1"># Primary test name</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="nv">TEST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>example_afu
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="c1"># Build directory</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="nv">OBJDIR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>obj
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="nv">CFLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-I./<span class="k">$(</span>OBJDIR<span class="k">)</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="nv">CPPFLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-I./<span class="k">$(</span>OBJDIR<span class="k">)</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="c1"># Files and folders</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="nv">SRCS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>TEST<span class="k">)</span>.c
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="nv">OBJS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>addprefix<span class="w"> </span><span class="k">$(</span>OBJDIR<span class="k">)</span>/,<span class="k">$(</span>patsubst<span class="w"> </span>%.c,%.o,<span class="k">$(</span>SRCS<span class="k">)))</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>all:<span class="w"> </span><span class="k">$(</span>TEST<span class="k">)</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="c1"># AFU info from JSON file, including AFU UUID</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="nv">AFU_JSON_INFO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>OBJDIR<span class="k">)</span>/afu_json_info.h
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="k">$(</span>AFU_JSON_INFO<span class="k">)</span>:<span class="w"> </span>../hw/rtl/<span class="k">$(</span>TEST<span class="k">)</span>.json<span class="w"> </span><span class="p">|</span><span class="w"> </span>objdir
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="w">    </span>afu_json_mgr<span class="w"> </span>json-info<span class="w"> </span>--afu-json<span class="o">=</span>$^<span class="w"> </span>--c-hdr<span class="o">=</span><span class="nv">$@</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="k">$(</span>OBJS<span class="k">)</span>:<span class="w"> </span><span class="k">$(</span>AFU_JSON_INFO<span class="k">)</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a><span class="k">$(</span>TEST<span class="k">)</span>:<span class="w"> </span><span class="k">$(</span>OBJS<span class="k">)</span>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a><span class="w">    </span><span class="k">$(</span>CC<span class="k">)</span><span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span><span class="w"> </span>$^<span class="w"> </span><span class="k">$(</span>LDFLAGS<span class="k">)</span><span class="w"> </span><span class="k">$(</span>FPGA_LIBS<span class="k">)</span><span class="w"> </span>-lrt<span class="w"> </span>-pthread
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a><span class="k">$(</span>OBJDIR<span class="k">)</span>/%.o:<span class="w"> </span>%.c<span class="w"> </span><span class="p">|</span><span class="w"> </span>objdir
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a><span class="w">    </span><span class="k">$(</span>CC<span class="k">)</span><span class="w"> </span><span class="k">$(</span>CFLAGS<span class="k">)</span><span class="w"> </span>-c<span class="w"> </span>$&lt;<span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span>
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>clean:
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a><span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="k">$(</span>TEST<span class="k">)</span><span class="w"> </span><span class="k">$(</span>OBJDIR<span class="k">)</span>
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>objdir:
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a><span class="w">    </span>@mkdir<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>OBJDIR<span class="k">)</span>
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a>
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a>.PHONY:<span class="w"> </span>all<span class="w"> </span>clean
</code></pre></div></p>
<h3 id="53-running-the-host-application"><strong>5.3. Running the Host Application</strong><a class="headerlink" href="#53-running-the-host-application" title="Permanent link">&para;</a></h3>
<p>To run the host application, you will need to:</p>
<ul>
<li>Load <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> onto the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></li>
<li>Create VF's</li>
<li>Bind VF's using the OPAE Drivers</li>
<li>Run application</li>
</ul>
<p>See the associated <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Developer Guide for details.</p>
<h2 id="6-packaging-the-afu"><strong>6. Packaging the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#6-packaging-the-afu" title="Permanent link">&para;</a></h2>
<p>Besides the RTL and software files, an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> requires an Accelerator Description File and source list file.  These files are used during the build process.</p>
<h3 id="61-accelerator-description-file"><strong>6.1. Accelerator Description File</strong><a class="headerlink" href="#61-accelerator-description-file" title="Permanent link">&para;</a></h3>
<p>The Accelerator Description File is a JSON file that describes the metadata associated with an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The Open Programmable Accelerator Engine (OPAE) uses this metadata during reconfiguration. </p>
<p>example_afu.json:
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="o">{</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">   </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">   </span><span class="s2">&quot;afu-image&quot;</span>:<span class="w"> </span><span class="o">{</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">      </span><span class="s2">&quot;power&quot;</span>:<span class="w"> </span><span class="m">0</span>,
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">      </span><span class="s2">&quot;clock-frequency-high&quot;</span>:<span class="w"> </span><span class="s2">&quot;auto&quot;</span>,
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">      </span><span class="s2">&quot;clock-frequency-low&quot;</span>:<span class="w"> </span><span class="s2">&quot;auto&quot;</span>,
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">      </span><span class="s2">&quot;afu-top-interface&quot;</span>:
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w">         </span><span class="o">{</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">            </span><span class="s2">&quot;class&quot;</span>:<span class="w"> </span><span class="s2">&quot;ofs_plat_afu&quot;</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">      </span><span class="o">}</span>,
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w">      </span><span class="s2">&quot;accelerator-clusters&quot;</span>:
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="w">         </span><span class="o">[</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">            </span><span class="o">{</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="w">               </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;example_afu&quot;</span>,
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="w">               </span><span class="s2">&quot;total-contexts&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="w">               </span><span class="s2">&quot;accelerator-type-uuid&quot;</span>:<span class="w"> </span><span class="s2">&quot;01234567-89ab-cdef-fedc-ba9876543210&quot;</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="w">            </span><span class="o">}</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="w">         </span><span class="o">]</span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="w">   </span><span class="o">}</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a><span class="o">}</span>
</code></pre></div></p>
<ul>
<li>power - Accelerator Function power consumption, in watts. Set to 0 for Intel ADP platforms.</li>
<li>clock-frequency-high - Clock frequency for uclk_usr in MHz.  (optional)</li>
<li>clock-frequency-low -  Clock frequency for uclk_usr_div2  in MHz. (optional)</li>
<li>afu-top-interface:<ul>
<li>class : Set to "ofs_plat_afu" for <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> based <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, "afu_main" for native/hybrid <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>'s.</li>
</ul>
</li>
<li>accelerator-clusters:<ul>
<li>name : name of <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></li>
<li>total-contexts : Set to '1'</li>
</ul>
</li>
<li>accelerator-type-uuid : 128-bit Universally Unique Identifier (UUID) used to identify the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. </li>
</ul>
<p>The ASE and synthesis setup scripts call afu_json_mgr to create afu_json_info.vh:
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>//
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>//<span class="w"> </span>Generated<span class="w"> </span>by<span class="w"> </span>afu_json_mgr<span class="w"> </span>from<span class="w"> </span>…/hw/rtl/example_afu.json
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>//
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="sb">`</span>ifndef<span class="w"> </span>__AFU_JSON_INFO__
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="sb">`</span>define<span class="w"> </span>__AFU_JSON_INFO__
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="sb">`</span>define<span class="w"> </span>AFU_ACCEL_NAME<span class="w"> </span><span class="s2">&quot;example_afu&quot;</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="sb">`</span>define<span class="w"> </span>AFU_ACCEL_NAME0<span class="w"> </span><span class="s2">&quot;example_afu&quot;</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="sb">`</span>define<span class="w"> </span>AFU_ACCEL_UUID<span class="w"> </span><span class="m">128</span><span class="s1">&#39;h01234567_89ab_cdef_fedc_ba9876543210</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="s1">`define AFU_ACCEL_UUID0 128&#39;</span>h01234567_89ab_cdef_fedc_ba9876543210
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="sb">`</span>define<span class="w"> </span>AFU_IMAGE_POWER<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="sb">`</span>define<span class="w"> </span>AFU_TOP_IFC<span class="w"> </span><span class="s2">&quot;ofs_plat_afu&quot;</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="sb">`</span>endif<span class="w"> </span>//<span class="w"> </span>__AFU_JSON_INFO__
</code></pre></div></p>
<p>The Makefile calls the afu_json_mgr to create afu_json_info.h:
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>//
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>//<span class="w"> </span>Generated<span class="w"> </span>by<span class="w"> </span>afu_json_mgr<span class="w"> </span>from<span class="w"> </span>../hw/rtl/example_afu.json
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>//
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="c1">#ifndef __AFU_JSON_INFO__</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="c1">#define __AFU_JSON_INFO__</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="c1">#define AFU_ACCEL_NAME &quot; example_afu &quot;</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="c1">#define AFU_ACCEL_NAME0 &quot; example_afu &quot;</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="c1">#define AFU_ACCEL_UUID &quot;01234567-89AB-CDEF-FEDC-BA9876543210&quot;</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="c1">#define AFU_ACCEL_UUID0 &quot;01234567-89AB-CDEF-FEDC-BA9876543210&quot;</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="c1">#define AFU_IMAGE_POWER 0</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="c1">#define AFU_TOP_IFC &quot;ofs_plat_afu&quot;</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="c1">#endif // __AFU_JSON_INFO__</span>
</code></pre></div></p>
<h3 id="62-source-list-file"><strong>6.2. Source List File</strong><a class="headerlink" href="#62-source-list-file" title="Permanent link">&para;</a></h3>
<p>The source list file is used by the ASE and synthesis setup scripts to build the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> project.  It should include the accelerator description file and RTL source files.   The file paths are relative to the source list file location.</p>
<p>example sources.txt:
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># Paths are relative to sources.txt file</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="c1"># Accelerator Descriptor File</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>example_afu.json
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="c1"># Top level module</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>ofs_plat_afu.sv
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="c1"># RTL</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>example_afu.sv
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>example_afu_csr.sv
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>accelerator.sv
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>dma_engine.sv
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="c1"># Pointer to software - Information only</span>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="c1"># ../../sw/example_afu.c</span>
</code></pre></div></p>
<h3 id="63-directory-structure"><strong>6.3. Directory Structure</strong><a class="headerlink" href="#63-directory-structure" title="Permanent link">&para;</a></h3>
<p>Below is an example directory structure:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>example_afu
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="p">|</span>--<span class="w"> </span>hw
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="p">|</span><span class="w">   </span><span class="p">|</span>-_<span class="w"> </span>rtl
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>example_afu.json<span class="w"> </span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>sources.txt
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>ofs_plat_afu.sv
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>example_afu.sv<span class="w"> </span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>example_afu_csr.sv<span class="w"> </span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>accelerator.sv<span class="w"> </span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="p">|</span><span class="w">       </span><span class="p">|</span>--<span class="w"> </span>dma_engine.sv
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="p">|</span>--<span class="w">  </span>sw
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="w">    </span><span class="p">|</span>--<span class="w"> </span>example_afu.c
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">    </span><span class="p">|</span>--<span class="w"> </span>Makefile
</code></pre></div>
<!-- include ./docs/hw/n6001/doc_modules/links.md -->

<!-- include ./docs/hw/doc_modules/links.md -->

<h2 id="notices-disclaimers">Notices &amp; Disclaimers<a class="headerlink" href="#notices-disclaimers" title="Permanent link">&para;</a></h2>
<p>Intel<sup>&reg;</sup> technologies may require enabled hardware, software or service activation.
No product or component can be absolutely secure. 
Performance varies by use, configuration and other factors.
Your costs and results may vary. 
You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Intel products described herein. You agree to grant Intel a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.
No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document, with the sole exception that you may publish an unmodified copy. You may create software implementations based on this document and in compliance with the foregoing that are intended to execute on the Intel product(s) referenced in this document. No rights are granted to create modifications or derivatives of this document.
The products described may contain design defects or errors known as errata which may cause the product to deviate from published specifications.  Current characterized errata are available on request.
Intel disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.
You are responsible for safety of the overall system, including compliance with applicable safety-related requirements or standards. 
<sup>&copy;</sup> Intel Corporation.  Intel, the Intel logo, and other Intel marks are trademarks of Intel Corporation or its subsidiaries.  Other names and brands may be claimed as the property of others. </p>
<p>OpenCL and the OpenCL logo are trademarks of Apple Inc. used by permission of the Khronos Group™. </p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.copy", "navigation.indexes", "toc.follow"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "ofs-2023.1", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>