
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../oneapi_asp/oneapi_asp_ref_mnl/">
      
      
        <link rel="next" href="../../../sw_installation/pcie_attach/sw_install_pcie_attach/">
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>Software Reference Manual - OFS</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#software-reference-manual-open-fpga-stack" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="OFS" class="md-header__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OFS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Software Reference Manual
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../user_guides/ug_fpga_developer/ug_fpga_developer/" class="md-tabs__link">
        Start Here
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../doc_modules/contents_s10_pcie_attach/" class="md-tabs__link">
        Stratix® 10 PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../doc_modules/contents_agx7_pcie_attach/" class="md-tabs__link">
        Agilex® 7 PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../doc_modules/contents_agx7_soc_attach/" class="md-tabs__link">
        Agilex SoC Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../user_guides/oneapi_asp/ug_oneapi_asp/" class="md-tabs__link">
        oneAPI
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        OFS Software
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="OFS" class="md-nav__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OFS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Start Here
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Start Here
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_fpga_developer/ug_fpga_developer/" class="md-nav__link">
        FPGA Developer Journey Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Stratix® 10 PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Stratix® 10 PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../doc_modules/contents_s10_pcie_attach/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../d5005/adp_board_installation_guidelines/" class="md-nav__link">
        Board Installation Guide (Intel® FPGA PAC D5005)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sw_installation/pcie_attach/sw_install_pcie_attach/" class="md-nav__link">
        Software Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/" class="md-nav__link">
        Getting Started Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-nav__link">
        Automated Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/" class="md-nav__link">
        Shell Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/dev_guides/fim_dev/ug_dev_fim_ofs_d5005/" class="md-nav__link">
        Shell Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
          Workload Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Workload Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/dev_guides/afu_dev/ug_dev_afu_d5005/" class="md-nav__link">
        Workload Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../d5005/ug_dev_pim_based_afu/" class="md-nav__link">
        PIM Based AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../d5005/ug_dev_afu_sim_env/" class="md-nav__link">
        AFU Simulation Environment User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../d5005/user_guides/ug_sim_ofs_d5005/ug_sim_ofs_d5005/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
          Virtualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_10">
          <span class="md-nav__icon md-icon"></span>
          Virtualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../d5005/ug_docker/" class="md-nav__link">
        Docker User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../d5005/ug_kvm/" class="md-nav__link">
        KVM User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Agilex® 7 PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Agilex® 7 PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../doc_modules/contents_agx7_pcie_attach/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          Board Installation Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Board Installation Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../n6001/adp_board_installation_guidelines/" class="md-nav__link">
        Intel® FPGA SmartNIC N6000/1-PL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../board_installation/devkit_board_installation/devkit_board_installation_guidelines/" class="md-nav__link">
        Agilex® 7 FPGA I-Series and F-Series Development Kits
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sw_installation/pcie_attach/sw_install_pcie_attach/" class="md-nav__link">
        Software Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          Getting Started Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Getting Started Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../iseries_devkit/user_guides/ug_qs_ofs_iseries/ug_qs_ofs_iseries/" class="md-nav__link">
        OFS for Agilex® 7 FPGA I-Series Development Kit (2xR-Tile,1xF-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ftile_devkit/user_guides/ug_qs_ofs_ftile/ug_qs_ofs_ftile/" class="md-nav__link">
        OFS for Agilex® 7 FPGA F-Series Development Kit (2xF-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/" class="md-nav__link">
        OFS for Intel® FPGA SmartNIC N6001-PL
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_eval_script_ofs_agx7_pcie_attach/ug_eval_script_ofs_agx7_pcie_attach/" class="md-nav__link">
        Automated Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/reference_manuals/ofs_fim/mnl_fim_ofs_n6001/" class="md-nav__link">
        Shell Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
          Shell Developer Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_7">
          <span class="md-nav__icon md-icon"></span>
          Shell Developer Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../iseries_devkit/dev_guides/fim_dev/ug_ofs_iseries_dk_fim_dev/" class="md-nav__link">
        PCIe Attach I-Series (2xR-Tile, F-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ftile_devkit/dev_guides/fim_dev/ug_ofs_ftile_dk_fim_dev/" class="md-nav__link">
        PCIe Attach F-Series (2xF-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/" class="md-nav__link">
        PCIe Attach F-Series (P-Tile/E-Tile)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../n6001/dev_guides/hps_dev/hps_developer_ug/" class="md-nav__link">
        HPS Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_sim_ofs_agx7_pcie_attach/ug_sim_ofs_agx7_pcie_attach/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
          Workload Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_10">
          <span class="md-nav__icon md-icon"></span>
          Workload Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/afu_dev/ug_dev_afu_ofs_agx7_pcie_attach/ug_dev_afu_ofs_agx7_pcie_attach/" class="md-nav__link">
        Workload Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../n6001/ug_dev_pim_based_afu/" class="md-nav__link">
        PIM Based AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../n6001/ug_dev_afu_sim_env/" class="md-nav__link">
        AFU Simulation Environment User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_11" id="__nav_4_11_label" tabindex="0">
          Virtualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_11">
          <span class="md-nav__icon md-icon"></span>
          Virtualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../n6001/ug_docker/" class="md-nav__link">
        Docker User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../n6001/ug_kvm/" class="md-nav__link">
        KVM User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Agilex SoC Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Agilex SoC Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../doc_modules/contents_agx7_soc_attach/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../board_installation/f2000x_board_installation/f2000x_board_installation/" class="md-nav__link">
        Board Installation Guide (Intel® IPU Platform F2000X-PL)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sw_installation/soc_attach/sw_install_soc_attach/" class="md-nav__link">
        Software Installation Guide for SoC Attach
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/user_guides/ug_qs_ofs_f2000x/ug_qs_ofs_f2000x/" class="md-nav__link">
        Getting Started Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-nav__link">
        Automated Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/reference_manuals/ofs_fim/mnl_fim_ofs/" class="md-nav__link">
        Shell Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/dev_guides/fim_dev/ug_dev_fim_ofs/" class="md-nav__link">
        Shell Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
          Workload Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_8">
          <span class="md-nav__icon md-icon"></span>
          Workload Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/dev_guides/afu_dev/ug_dev_afu_ofs_f2000x/" class="md-nav__link">
        Workload Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../f2000x/ug_dev_pim_based_afu/" class="md-nav__link">
        PIM Based AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../f2000x/ug_dev_afu_sim_env/" class="md-nav__link">
        AFU Simulation Environment User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../f2000x/user_guides/ug_sim_ofs/ug_sim_ofs/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="0">
          Virtualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_10">
          <span class="md-nav__icon md-icon"></span>
          Virtualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../f2000x/ug_docker/" class="md-nav__link">
        Docker User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../f2000x/ug_kvm/" class="md-nav__link">
        KVM User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          oneAPI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          oneAPI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/oneapi_asp/ug_oneapi_asp/" class="md-nav__link">
        oneAPI ASP Getting Started User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../oneapi_asp/oneapi_asp_ref_mnl/" class="md-nav__link">
        oneAPI Accelerator Support Package(ASP) Reference Manual
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          OFS Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          OFS Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Software Reference Manual
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Software Reference Manual
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#10-introduction" class="md-nav__link">
    1.0 Introduction
  </a>
  
    <nav class="md-nav" aria-label="1.0 Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-audience" class="md-nav__link">
    1.1 Audience
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-terminology" class="md-nav__link">
    1.2 Terminology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-opae-software-development-kit-sdk" class="md-nav__link">
    1.3 OPAE Software Development Kit (SDK)
  </a>
  
    <nav class="md-nav" aria-label="1.3 OPAE Software Development Kit (SDK)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#table-1-additional-websites-and-links" class="md-nav__link">
    Table 1: Additional Websites and Links
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-2-ofs-hardware-terminology" class="md-nav__link">
    Table 2: OFS Hardware Terminology
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20-opae-c-api" class="md-nav__link">
    2.0 OPAE C API
  </a>
  
    <nav class="md-nav" aria-label="2.0 OPAE C API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-libopae-c" class="md-nav__link">
    2.1 libopae-c
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-code" class="md-nav__link">
    Sample Code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#high-level-directory-structure" class="md-nav__link">
    High-Level Directory Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-models" class="md-nav__link">
    Object Models
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fpga-resource-propertie" class="md-nav__link">
    FPGA Resource Propertie
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opae-c-api-return-codes" class="md-nav__link">
    OPAE C API Return Codes
  </a>
  
    <nav class="md-nav" aria-label="OPAE C API Return Codes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-device-abstraction" class="md-nav__link">
    2.1.1 Device Abstraction
  </a>
  
    <nav class="md-nav" aria-label="2.1.1 Device Abstraction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2111-device-types" class="md-nav__link">
    2.1.1.1 Device types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2112-tokens-and-handles" class="md-nav__link">
    2.1.1.2 Tokens and Handles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-enumeration" class="md-nav__link">
    2.1.2 Enumeration
  </a>
  
    <nav class="md-nav" aria-label="2.1.2 Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2121-fpga_properties-and-filtering" class="md-nav__link">
    2.1.2.1 fpga_properties and Filtering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21211-common-properties" class="md-nav__link">
    2.1.2.1.1 Common Properties
  </a>
  
    <nav class="md-nav" aria-label="2.1.2.1.1 Common Properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21212-fpga_device-properties" class="md-nav__link">
    2.1.2.1.2 FPGA_DEVICE Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21213-fpga_accelerator-properties" class="md-nav__link">
    2.1.2.1.3 FPGA_ACCELERATOR Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213-access" class="md-nav__link">
    2.1.3 Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214-events" class="md-nav__link">
    2.1.4 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215-mmio-and-shared-memory" class="md-nav__link">
    2.1.5 MMIO and Shared Memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#216-management" class="md-nav__link">
    2.1.6 Management
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#217-errors" class="md-nav__link">
    2.1.7 Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#218-metrics" class="md-nav__link">
    2.1.8 Metrics
  </a>
  
    <nav class="md-nav" aria-label="2.1.8 Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2181-querying-metric-values-by-index" class="md-nav__link">
    2.1.8.1 Querying Metric Values by Index
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2182-querying-metric-values-by-name" class="md-nav__link">
    2.1.8.2 Querying Metric Values by Name
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#219-sysobject" class="md-nav__link">
    2.1.9 SysObject
  </a>
  
    <nav class="md-nav" aria-label="2.1.9 SysObject">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2191-fpga_object_container-apis" class="md-nav__link">
    2.1.9.1 FPGA_OBJECT_CONTAINER API’s
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2192-fpga_object_attribute-apis" class="md-nav__link">
    2.1.9.2 FPGA_OBJECT_ATTRIBUTE API’s
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2110-utilities" class="md-nav__link">
    2.1.10 Utilities
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-dfl-driver-ioctl-interfaces" class="md-nav__link">
    2.2 DFL Driver IOCTL Interfaces
  </a>
  
    <nav class="md-nav" aria-label="2.2 DFL Driver IOCTL Interfaces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-port-reset" class="md-nav__link">
    2.2.1 Port Reset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-port-information" class="md-nav__link">
    2.2.2 Port Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-mmio-region-information" class="md-nav__link">
    2.2.3 MMIO Region Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-shared-memory-mapping-and-unmapping" class="md-nav__link">
    2.2.4 Shared Memory Mapping and Unmapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#225-number-of-port-error-irqs" class="md-nav__link">
    2.2.5 Number of Port Error IRQs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#226-port-error-interrupt-configuration" class="md-nav__link">
    2.2.6 Port Error Interrupt Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#227-number-of-afu-interrupts" class="md-nav__link">
    2.2.7 Number of AFU Interrupts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#228-user-afu-interrupt-configuration" class="md-nav__link">
    2.2.8 User AFU Interrupt Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#229-partial-reconfiguration" class="md-nav__link">
    2.2.9 Partial Reconfiguration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2210-number-of-fme-error-irqs" class="md-nav__link">
    2.2.10 Number of FME Error IRQs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2211-fme-error-interrupt-configuration" class="md-nav__link">
    2.2.11 FME Error Interrupt Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-plugin-manager" class="md-nav__link">
    2.3 Plugin Manager
  </a>
  
    <nav class="md-nav" aria-label="2.3 Plugin Manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231-plugin-model" class="md-nav__link">
    2.3.1 Plugin Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232-libxfpga-plugin" class="md-nav__link">
    2.3.2 libxfpga Plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#233-libopae-v-plugin" class="md-nav__link">
    2.3.3 libopae-v Plugin
  </a>
  
    <nav class="md-nav" aria-label="2.3.3 libopae-v Plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2331-supporting-libraries" class="md-nav__link">
    2.3.3.1 Supporting Libraries
  </a>
  
    <nav class="md-nav" aria-label="2.3.3.1 Supporting Libraries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#23311-libopaevfio" class="md-nav__link">
    2.3.3.1.1 libopaevfio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23312-libopaemem" class="md-nav__link">
    2.3.3.1.2 libopaemem
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2332-configuring-pcie-virtual-functions" class="md-nav__link">
    2.3.3.2 Configuring PCIe Virtual Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-application-flow" class="md-nav__link">
    2.4 Application Flow
  </a>
  
    <nav class="md-nav" aria-label="2.4 Application Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#241-create-filter-criteria" class="md-nav__link">
    2.4.1 Create Filter Criteria
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#242-enumerate-the-afu" class="md-nav__link">
    2.4.2 Enumerate the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#243-open-the-afu" class="md-nav__link">
    2.4.3 Open the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#244-map-mmio-region" class="md-nav__link">
    2.4.4 Map MMIO Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#245-allocate-dma-buffers" class="md-nav__link">
    2.4.5 Allocate DMA Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#246-make-afu-aware-of-dma-buffers" class="md-nav__link">
    2.4.6 Make AFU Aware of DMA Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#247-initiate-an-acceleration-task" class="md-nav__link">
    2.4.7 Initiate an Acceleration Task
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#248-wait-for-task-completion" class="md-nav__link">
    2.4.8 Wait for Task Completion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#249-free-dma-buffers" class="md-nav__link">
    2.4.9 Free DMA Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2410-unmap-mmio-region" class="md-nav__link">
    2.4.10 Unmap MMIO Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2411-close-the-afu" class="md-nav__link">
    2.4.11 Close the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2412-release-the-tokens-and-properties" class="md-nav__link">
    2.4.12 Release the Tokens and Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#30-opae-c-api" class="md-nav__link">
    3.0 OPAE C++ API
  </a>
  
    <nav class="md-nav" aria-label="3.0 OPAE C++ API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-libopae-cxx-core" class="md-nav__link">
    3.1 libopae-cxx-core
  </a>
  
    <nav class="md-nav" aria-label="3.1 libopae-cxx-core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#311-properties" class="md-nav__link">
    3.1.1 Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#312-tokens" class="md-nav__link">
    3.1.2 Tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#313-handles" class="md-nav__link">
    3.1.3 Handles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#314-shared-memory" class="md-nav__link">
    3.1.4 Shared Memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#315-events" class="md-nav__link">
    3.1.5 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#316-errors" class="md-nav__link">
    3.1.6 Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#317-sysobject" class="md-nav__link">
    3.1.7 SysObject
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#40-opae-python-api" class="md-nav__link">
    4.0 OPAE Python API
  </a>
  
    <nav class="md-nav" aria-label="4.0 OPAE Python API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-opae" class="md-nav__link">
    4.1 opae
  </a>
  
    <nav class="md-nav" aria-label="4.1 opae">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-enumeration" class="md-nav__link">
    4.1.1 Enumeration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412-properties" class="md-nav__link">
    4.1.2 Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#413-tokens" class="md-nav__link">
    4.1.3 Tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#414-handles" class="md-nav__link">
    4.1.4 Handles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#415-shared-memory" class="md-nav__link">
    4.1.5 Shared Memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#416-events" class="md-nav__link">
    4.1.6 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#417-errors" class="md-nav__link">
    4.1.7 Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#418-sysobject" class="md-nav__link">
    4.1.8 SysObject
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#418-python-example-application" class="md-nav__link">
    4.1.8 Python Example Application
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#50-management-interfaces-opaeadmin" class="md-nav__link">
    5.0 Management Interfaces - opae.admin
  </a>
  
    <nav class="md-nav" aria-label="5.0 Management Interfaces - opae.admin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-sysfs" class="md-nav__link">
    5.1 sysfs
  </a>
  
    <nav class="md-nav" aria-label="5.1 sysfs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-sysfs_node" class="md-nav__link">
    5.1.1 sysfs_node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-pci_node" class="md-nav__link">
    5.1.2 pci_node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-sysfs_driver" class="md-nav__link">
    5.1.3 sysfs_driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514-sysfs_device" class="md-nav__link">
    5.1.4 sysfs_device
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#515-pcie_device" class="md-nav__link">
    5.1.5 pcie_device
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-fpga" class="md-nav__link">
    5.2 fpga
  </a>
  
    <nav class="md-nav" aria-label="5.2 fpga">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#521-region" class="md-nav__link">
    5.2.1 region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#522-fme" class="md-nav__link">
    5.2.2 fme
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#523-port" class="md-nav__link">
    5.2.3 port
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#524-fpga_base" class="md-nav__link">
    5.2.4 fpga_base
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#525-fpga" class="md-nav__link">
    5.2.5 fpga
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-opaeadmin-utilities" class="md-nav__link">
    5.3 opae.admin Utilities
  </a>
  
    <nav class="md-nav" aria-label="5.3 opae.admin Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531-fpgasupdate" class="md-nav__link">
    5.3.1 fpgasupdate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#532-pci_device" class="md-nav__link">
    5.3.2 pci_device
  </a>
  
    <nav class="md-nav" aria-label="5.3.2 pci_device">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5321-pci_device-aer-subcommand" class="md-nav__link">
    5.3.2.1 pci_device aer subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5322-pci_device-unbind-subcommand" class="md-nav__link">
    5.3.2.2 pci_device unbind subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5323-pci_device-rescan-subcommand" class="md-nav__link">
    5.3.2.3 pci_device rescan subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5324-pci_device-remove-subcommand" class="md-nav__link">
    5.3.2.4 pci_device remove subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5325-pci_device-topology-subcommand" class="md-nav__link">
    5.3.2.5 pci_device topology subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5326-pci_device-vf-subcommand" class="md-nav__link">
    5.3.2.6 pci_device vf subcommand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#533-rsu" class="md-nav__link">
    5.3.3 rsu
  </a>
  
    <nav class="md-nav" aria-label="5.3.3 rsu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5331-rsu-bmc-subcommand" class="md-nav__link">
    5.3.3.1 rsu bmc subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5332-rsu-retimer-subcommand" class="md-nav__link">
    5.3.3.2 rsu retimer subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5333-rsu-fpga-subcommand" class="md-nav__link">
    5.3.3.3 rsu fpga subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5334-rsu-sdm-subcommand" class="md-nav__link">
    5.3.3.4 rsu sdm subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5335-rsu-fpgadefault-subcommand" class="md-nav__link">
    5.3.3.5 rsu fpgadefault subcommand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#60-sample-applications" class="md-nav__link">
    6.0 Sample Applications
  </a>
  
    <nav class="md-nav" aria-label="6.0 Sample Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-afu-test-framework" class="md-nav__link">
    6.1 afu-test Framework
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-afu-test-based-samples" class="md-nav__link">
    6.2 afu-test Based Samples
  </a>
  
    <nav class="md-nav" aria-label="6.2 afu-test Based Samples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#621-dummy_afu" class="md-nav__link">
    6.2.1 dummy_afu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#622-host_exerciser" class="md-nav__link">
    6.2.2 host_exerciser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#623-hssi" class="md-nav__link">
    6.2.3 hssi
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#70-other-utilities" class="md-nav__link">
    7.0 Other Utilities
  </a>
  
    <nav class="md-nav" aria-label="7.0 Other Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-opaeio" class="md-nav__link">
    7.1 opae.io
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-bitstreaminfo" class="md-nav__link">
    7.2 bitstreaminfo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-fpgareg" class="md-nav__link">
    7.3 fpgareg
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-opaevfio" class="md-nav__link">
    7.4 opaevfio
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#80-opae-build-configurations" class="md-nav__link">
    8.0 OPAE Build Configurations
  </a>
  
    <nav class="md-nav" aria-label="8.0 OPAE Build Configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-cmake-options" class="md-nav__link">
    8.1 CMake Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-building-opae-for-debug" class="md-nav__link">
    8.2 Building OPAE for Debug:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-creating-opae-packages" class="md-nav__link">
    8.3 Creating OPAE Packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-updating-the-rpm-version-information" class="md-nav__link">
    8.4 Updating the RPM Version Information
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#90-debugging-opae" class="md-nav__link">
    9.0 Debugging OPAE
  </a>
  
    <nav class="md-nav" aria-label="9.0 Debugging OPAE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-enabling-debug-logging" class="md-nav__link">
    9.1   Enabling Debug Logging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-gdb" class="md-nav__link">
    9.2 GDB
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#100-adding-new-device-support" class="md-nav__link">
    10.0 Adding New Device Support
  </a>
  
    <nav class="md-nav" aria-label="10.0 Adding New Device Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-configuration-file-search-order" class="md-nav__link">
    10.1 Configuration File Search Order
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-configuration-file-format" class="md-nav__link">
    10.2 Configuration File Format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#110-dfl-linux-kernel-drivers" class="md-nav__link">
    11.0 DFL Linux Kernel Drivers
  </a>
  
    <nav class="md-nav" aria-label="11.0 DFL Linux Kernel Drivers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-hardware-architecture" class="md-nav__link">
    11.1 Hardware Architecture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112-fpga-management-engine-fme" class="md-nav__link">
    11.2 FPGA Management Engine (FME)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113-port" class="md-nav__link">
    11.3 Port
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-accelerator-function-unit-afu" class="md-nav__link">
    11.4 Accelerator Function Unit (AFU)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115-partial-reconfiguration-pr" class="md-nav__link">
    11.5 Partial Reconfiguration (PR)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#116-fpga-virtualization" class="md-nav__link">
    11.6 FPGA Virtualization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#117-driver-organization" class="md-nav__link">
    11.7 Driver Organization
  </a>
  
    <nav class="md-nav" aria-label="11.7 Driver Organization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1171-pcie-module-device-driver" class="md-nav__link">
    11.7.1 PCIe Module Device Driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1172-pcie-module-device-driver-functions" class="md-nav__link">
    11.7.2 PCIe Module Device Driver Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1173-fme-platform-module-device-driver" class="md-nav__link">
    11.7.3 FME Platform Module Device Driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1174-fme-platform-module-device-driver-functions" class="md-nav__link">
    11.7.4 FME Platform Module Device Driver Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1175-port-platform-module-device-driver" class="md-nav__link">
    11.7.5 Port Platform Module Device Driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1176-port-platform-module-device-driver-functions" class="md-nav__link">
    11.7.6 Port Platform Module Device Driver Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1177-opae-fpga-driver-interface" class="md-nav__link">
    11.7.7 OPAE FPGA Driver Interface
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#120-plugin-development" class="md-nav__link">
    12.0 Plugin Development
  </a>
  
    <nav class="md-nav" aria-label="12.0 Plugin Development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-overview" class="md-nav__link">
    12.1 Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-plugin-required-functions" class="md-nav__link">
    12.2 Plugin Required Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#123-opae-api-adapter-table" class="md-nav__link">
    12.3 OPAE API Adapter Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#124-plugin-optional-functions" class="md-nav__link">
    12.4 Plugin Optional Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#125-plugin-construction" class="md-nav__link">
    12.5 Plugin Construction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#130-building-a-sample-application" class="md-nav__link">
    13.0 Building a Sample Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-a-integrating-an-n6001-based-custom-platform-with-dfl-and-opae" class="md-nav__link">
    Appendix A - Integrating an N6001 Based Custom Platform with DFL and OPAE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sw_installation/pcie_attach/sw_install_pcie_attach/" class="md-nav__link">
        Software Installation Guide OFS for PCIe Attach
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sw_installation/soc_attach/sw_install_soc_attach/" class="md-nav__link">
        Software Installation Guide OFS for SoC Attach
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
          OPAE FPGA Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_4">
          <span class="md-nav__icon md-icon"></span>
          OPAE FPGA Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgainfo/fpgainfo/" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgasupdate/fpgasupdate/" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mmlink/mmlink/" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/packager/packager/" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/userclk/userclk/" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi/hssi/" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/pci_device/pci_device/" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opae.io/opae.io/" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/rsu/rsu/" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/host_exerciser/host_exerciser/" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssistats/" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mem_tg/mem_tg/" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/vabtool/vabtool/" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaevfio/opaevfio/" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/ofs.uio/ofs.uio/" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaeuio/opaeuio/" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgad/fpgad/" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#10-introduction" class="md-nav__link">
    1.0 Introduction
  </a>
  
    <nav class="md-nav" aria-label="1.0 Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-audience" class="md-nav__link">
    1.1 Audience
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-terminology" class="md-nav__link">
    1.2 Terminology
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-opae-software-development-kit-sdk" class="md-nav__link">
    1.3 OPAE Software Development Kit (SDK)
  </a>
  
    <nav class="md-nav" aria-label="1.3 OPAE Software Development Kit (SDK)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#table-1-additional-websites-and-links" class="md-nav__link">
    Table 1: Additional Websites and Links
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-2-ofs-hardware-terminology" class="md-nav__link">
    Table 2: OFS Hardware Terminology
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#20-opae-c-api" class="md-nav__link">
    2.0 OPAE C API
  </a>
  
    <nav class="md-nav" aria-label="2.0 OPAE C API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-libopae-c" class="md-nav__link">
    2.1 libopae-c
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-code" class="md-nav__link">
    Sample Code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#high-level-directory-structure" class="md-nav__link">
    High-Level Directory Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-models" class="md-nav__link">
    Object Models
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fpga-resource-propertie" class="md-nav__link">
    FPGA Resource Propertie
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opae-c-api-return-codes" class="md-nav__link">
    OPAE C API Return Codes
  </a>
  
    <nav class="md-nav" aria-label="OPAE C API Return Codes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-device-abstraction" class="md-nav__link">
    2.1.1 Device Abstraction
  </a>
  
    <nav class="md-nav" aria-label="2.1.1 Device Abstraction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2111-device-types" class="md-nav__link">
    2.1.1.1 Device types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2112-tokens-and-handles" class="md-nav__link">
    2.1.1.2 Tokens and Handles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212-enumeration" class="md-nav__link">
    2.1.2 Enumeration
  </a>
  
    <nav class="md-nav" aria-label="2.1.2 Enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2121-fpga_properties-and-filtering" class="md-nav__link">
    2.1.2.1 fpga_properties and Filtering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21211-common-properties" class="md-nav__link">
    2.1.2.1.1 Common Properties
  </a>
  
    <nav class="md-nav" aria-label="2.1.2.1.1 Common Properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21212-fpga_device-properties" class="md-nav__link">
    2.1.2.1.2 FPGA_DEVICE Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21213-fpga_accelerator-properties" class="md-nav__link">
    2.1.2.1.3 FPGA_ACCELERATOR Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213-access" class="md-nav__link">
    2.1.3 Access
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214-events" class="md-nav__link">
    2.1.4 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215-mmio-and-shared-memory" class="md-nav__link">
    2.1.5 MMIO and Shared Memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#216-management" class="md-nav__link">
    2.1.6 Management
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#217-errors" class="md-nav__link">
    2.1.7 Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#218-metrics" class="md-nav__link">
    2.1.8 Metrics
  </a>
  
    <nav class="md-nav" aria-label="2.1.8 Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2181-querying-metric-values-by-index" class="md-nav__link">
    2.1.8.1 Querying Metric Values by Index
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2182-querying-metric-values-by-name" class="md-nav__link">
    2.1.8.2 Querying Metric Values by Name
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#219-sysobject" class="md-nav__link">
    2.1.9 SysObject
  </a>
  
    <nav class="md-nav" aria-label="2.1.9 SysObject">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2191-fpga_object_container-apis" class="md-nav__link">
    2.1.9.1 FPGA_OBJECT_CONTAINER API’s
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2192-fpga_object_attribute-apis" class="md-nav__link">
    2.1.9.2 FPGA_OBJECT_ATTRIBUTE API’s
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2110-utilities" class="md-nav__link">
    2.1.10 Utilities
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-dfl-driver-ioctl-interfaces" class="md-nav__link">
    2.2 DFL Driver IOCTL Interfaces
  </a>
  
    <nav class="md-nav" aria-label="2.2 DFL Driver IOCTL Interfaces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221-port-reset" class="md-nav__link">
    2.2.1 Port Reset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-port-information" class="md-nav__link">
    2.2.2 Port Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223-mmio-region-information" class="md-nav__link">
    2.2.3 MMIO Region Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224-shared-memory-mapping-and-unmapping" class="md-nav__link">
    2.2.4 Shared Memory Mapping and Unmapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#225-number-of-port-error-irqs" class="md-nav__link">
    2.2.5 Number of Port Error IRQs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#226-port-error-interrupt-configuration" class="md-nav__link">
    2.2.6 Port Error Interrupt Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#227-number-of-afu-interrupts" class="md-nav__link">
    2.2.7 Number of AFU Interrupts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#228-user-afu-interrupt-configuration" class="md-nav__link">
    2.2.8 User AFU Interrupt Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#229-partial-reconfiguration" class="md-nav__link">
    2.2.9 Partial Reconfiguration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2210-number-of-fme-error-irqs" class="md-nav__link">
    2.2.10 Number of FME Error IRQs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2211-fme-error-interrupt-configuration" class="md-nav__link">
    2.2.11 FME Error Interrupt Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-plugin-manager" class="md-nav__link">
    2.3 Plugin Manager
  </a>
  
    <nav class="md-nav" aria-label="2.3 Plugin Manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231-plugin-model" class="md-nav__link">
    2.3.1 Plugin Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232-libxfpga-plugin" class="md-nav__link">
    2.3.2 libxfpga Plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#233-libopae-v-plugin" class="md-nav__link">
    2.3.3 libopae-v Plugin
  </a>
  
    <nav class="md-nav" aria-label="2.3.3 libopae-v Plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2331-supporting-libraries" class="md-nav__link">
    2.3.3.1 Supporting Libraries
  </a>
  
    <nav class="md-nav" aria-label="2.3.3.1 Supporting Libraries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#23311-libopaevfio" class="md-nav__link">
    2.3.3.1.1 libopaevfio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23312-libopaemem" class="md-nav__link">
    2.3.3.1.2 libopaemem
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2332-configuring-pcie-virtual-functions" class="md-nav__link">
    2.3.3.2 Configuring PCIe Virtual Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-application-flow" class="md-nav__link">
    2.4 Application Flow
  </a>
  
    <nav class="md-nav" aria-label="2.4 Application Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#241-create-filter-criteria" class="md-nav__link">
    2.4.1 Create Filter Criteria
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#242-enumerate-the-afu" class="md-nav__link">
    2.4.2 Enumerate the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#243-open-the-afu" class="md-nav__link">
    2.4.3 Open the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#244-map-mmio-region" class="md-nav__link">
    2.4.4 Map MMIO Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#245-allocate-dma-buffers" class="md-nav__link">
    2.4.5 Allocate DMA Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#246-make-afu-aware-of-dma-buffers" class="md-nav__link">
    2.4.6 Make AFU Aware of DMA Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#247-initiate-an-acceleration-task" class="md-nav__link">
    2.4.7 Initiate an Acceleration Task
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#248-wait-for-task-completion" class="md-nav__link">
    2.4.8 Wait for Task Completion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#249-free-dma-buffers" class="md-nav__link">
    2.4.9 Free DMA Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2410-unmap-mmio-region" class="md-nav__link">
    2.4.10 Unmap MMIO Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2411-close-the-afu" class="md-nav__link">
    2.4.11 Close the AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2412-release-the-tokens-and-properties" class="md-nav__link">
    2.4.12 Release the Tokens and Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#30-opae-c-api" class="md-nav__link">
    3.0 OPAE C++ API
  </a>
  
    <nav class="md-nav" aria-label="3.0 OPAE C++ API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-libopae-cxx-core" class="md-nav__link">
    3.1 libopae-cxx-core
  </a>
  
    <nav class="md-nav" aria-label="3.1 libopae-cxx-core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#311-properties" class="md-nav__link">
    3.1.1 Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#312-tokens" class="md-nav__link">
    3.1.2 Tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#313-handles" class="md-nav__link">
    3.1.3 Handles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#314-shared-memory" class="md-nav__link">
    3.1.4 Shared Memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#315-events" class="md-nav__link">
    3.1.5 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#316-errors" class="md-nav__link">
    3.1.6 Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#317-sysobject" class="md-nav__link">
    3.1.7 SysObject
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#40-opae-python-api" class="md-nav__link">
    4.0 OPAE Python API
  </a>
  
    <nav class="md-nav" aria-label="4.0 OPAE Python API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-opae" class="md-nav__link">
    4.1 opae
  </a>
  
    <nav class="md-nav" aria-label="4.1 opae">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-enumeration" class="md-nav__link">
    4.1.1 Enumeration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412-properties" class="md-nav__link">
    4.1.2 Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#413-tokens" class="md-nav__link">
    4.1.3 Tokens
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#414-handles" class="md-nav__link">
    4.1.4 Handles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#415-shared-memory" class="md-nav__link">
    4.1.5 Shared Memory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#416-events" class="md-nav__link">
    4.1.6 Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#417-errors" class="md-nav__link">
    4.1.7 Errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#418-sysobject" class="md-nav__link">
    4.1.8 SysObject
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#418-python-example-application" class="md-nav__link">
    4.1.8 Python Example Application
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#50-management-interfaces-opaeadmin" class="md-nav__link">
    5.0 Management Interfaces - opae.admin
  </a>
  
    <nav class="md-nav" aria-label="5.0 Management Interfaces - opae.admin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-sysfs" class="md-nav__link">
    5.1 sysfs
  </a>
  
    <nav class="md-nav" aria-label="5.1 sysfs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-sysfs_node" class="md-nav__link">
    5.1.1 sysfs_node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-pci_node" class="md-nav__link">
    5.1.2 pci_node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513-sysfs_driver" class="md-nav__link">
    5.1.3 sysfs_driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514-sysfs_device" class="md-nav__link">
    5.1.4 sysfs_device
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#515-pcie_device" class="md-nav__link">
    5.1.5 pcie_device
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-fpga" class="md-nav__link">
    5.2 fpga
  </a>
  
    <nav class="md-nav" aria-label="5.2 fpga">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#521-region" class="md-nav__link">
    5.2.1 region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#522-fme" class="md-nav__link">
    5.2.2 fme
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#523-port" class="md-nav__link">
    5.2.3 port
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#524-fpga_base" class="md-nav__link">
    5.2.4 fpga_base
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#525-fpga" class="md-nav__link">
    5.2.5 fpga
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-opaeadmin-utilities" class="md-nav__link">
    5.3 opae.admin Utilities
  </a>
  
    <nav class="md-nav" aria-label="5.3 opae.admin Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531-fpgasupdate" class="md-nav__link">
    5.3.1 fpgasupdate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#532-pci_device" class="md-nav__link">
    5.3.2 pci_device
  </a>
  
    <nav class="md-nav" aria-label="5.3.2 pci_device">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5321-pci_device-aer-subcommand" class="md-nav__link">
    5.3.2.1 pci_device aer subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5322-pci_device-unbind-subcommand" class="md-nav__link">
    5.3.2.2 pci_device unbind subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5323-pci_device-rescan-subcommand" class="md-nav__link">
    5.3.2.3 pci_device rescan subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5324-pci_device-remove-subcommand" class="md-nav__link">
    5.3.2.4 pci_device remove subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5325-pci_device-topology-subcommand" class="md-nav__link">
    5.3.2.5 pci_device topology subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5326-pci_device-vf-subcommand" class="md-nav__link">
    5.3.2.6 pci_device vf subcommand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#533-rsu" class="md-nav__link">
    5.3.3 rsu
  </a>
  
    <nav class="md-nav" aria-label="5.3.3 rsu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5331-rsu-bmc-subcommand" class="md-nav__link">
    5.3.3.1 rsu bmc subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5332-rsu-retimer-subcommand" class="md-nav__link">
    5.3.3.2 rsu retimer subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5333-rsu-fpga-subcommand" class="md-nav__link">
    5.3.3.3 rsu fpga subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5334-rsu-sdm-subcommand" class="md-nav__link">
    5.3.3.4 rsu sdm subcommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5335-rsu-fpgadefault-subcommand" class="md-nav__link">
    5.3.3.5 rsu fpgadefault subcommand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#60-sample-applications" class="md-nav__link">
    6.0 Sample Applications
  </a>
  
    <nav class="md-nav" aria-label="6.0 Sample Applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-afu-test-framework" class="md-nav__link">
    6.1 afu-test Framework
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-afu-test-based-samples" class="md-nav__link">
    6.2 afu-test Based Samples
  </a>
  
    <nav class="md-nav" aria-label="6.2 afu-test Based Samples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#621-dummy_afu" class="md-nav__link">
    6.2.1 dummy_afu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#622-host_exerciser" class="md-nav__link">
    6.2.2 host_exerciser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#623-hssi" class="md-nav__link">
    6.2.3 hssi
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#70-other-utilities" class="md-nav__link">
    7.0 Other Utilities
  </a>
  
    <nav class="md-nav" aria-label="7.0 Other Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-opaeio" class="md-nav__link">
    7.1 opae.io
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-bitstreaminfo" class="md-nav__link">
    7.2 bitstreaminfo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-fpgareg" class="md-nav__link">
    7.3 fpgareg
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-opaevfio" class="md-nav__link">
    7.4 opaevfio
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#80-opae-build-configurations" class="md-nav__link">
    8.0 OPAE Build Configurations
  </a>
  
    <nav class="md-nav" aria-label="8.0 OPAE Build Configurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-cmake-options" class="md-nav__link">
    8.1 CMake Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-building-opae-for-debug" class="md-nav__link">
    8.2 Building OPAE for Debug:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#83-creating-opae-packages" class="md-nav__link">
    8.3 Creating OPAE Packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84-updating-the-rpm-version-information" class="md-nav__link">
    8.4 Updating the RPM Version Information
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#90-debugging-opae" class="md-nav__link">
    9.0 Debugging OPAE
  </a>
  
    <nav class="md-nav" aria-label="9.0 Debugging OPAE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-enabling-debug-logging" class="md-nav__link">
    9.1   Enabling Debug Logging
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-gdb" class="md-nav__link">
    9.2 GDB
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#100-adding-new-device-support" class="md-nav__link">
    10.0 Adding New Device Support
  </a>
  
    <nav class="md-nav" aria-label="10.0 Adding New Device Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-configuration-file-search-order" class="md-nav__link">
    10.1 Configuration File Search Order
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-configuration-file-format" class="md-nav__link">
    10.2 Configuration File Format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#110-dfl-linux-kernel-drivers" class="md-nav__link">
    11.0 DFL Linux Kernel Drivers
  </a>
  
    <nav class="md-nav" aria-label="11.0 DFL Linux Kernel Drivers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-hardware-architecture" class="md-nav__link">
    11.1 Hardware Architecture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112-fpga-management-engine-fme" class="md-nav__link">
    11.2 FPGA Management Engine (FME)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113-port" class="md-nav__link">
    11.3 Port
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-accelerator-function-unit-afu" class="md-nav__link">
    11.4 Accelerator Function Unit (AFU)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115-partial-reconfiguration-pr" class="md-nav__link">
    11.5 Partial Reconfiguration (PR)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#116-fpga-virtualization" class="md-nav__link">
    11.6 FPGA Virtualization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#117-driver-organization" class="md-nav__link">
    11.7 Driver Organization
  </a>
  
    <nav class="md-nav" aria-label="11.7 Driver Organization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1171-pcie-module-device-driver" class="md-nav__link">
    11.7.1 PCIe Module Device Driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1172-pcie-module-device-driver-functions" class="md-nav__link">
    11.7.2 PCIe Module Device Driver Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1173-fme-platform-module-device-driver" class="md-nav__link">
    11.7.3 FME Platform Module Device Driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1174-fme-platform-module-device-driver-functions" class="md-nav__link">
    11.7.4 FME Platform Module Device Driver Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1175-port-platform-module-device-driver" class="md-nav__link">
    11.7.5 Port Platform Module Device Driver
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1176-port-platform-module-device-driver-functions" class="md-nav__link">
    11.7.6 Port Platform Module Device Driver Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1177-opae-fpga-driver-interface" class="md-nav__link">
    11.7.7 OPAE FPGA Driver Interface
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#120-plugin-development" class="md-nav__link">
    12.0 Plugin Development
  </a>
  
    <nav class="md-nav" aria-label="12.0 Plugin Development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121-overview" class="md-nav__link">
    12.1 Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122-plugin-required-functions" class="md-nav__link">
    12.2 Plugin Required Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#123-opae-api-adapter-table" class="md-nav__link">
    12.3 OPAE API Adapter Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#124-plugin-optional-functions" class="md-nav__link">
    12.4 Plugin Optional Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#125-plugin-construction" class="md-nav__link">
    12.5 Plugin Construction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#130-building-a-sample-application" class="md-nav__link">
    13.0 Building a Sample Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendix-a-integrating-an-n6001-based-custom-platform-with-dfl-and-opae" class="md-nav__link">
    Appendix A - Integrating an N6001 Based Custom Platform with DFL and OPAE
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="software-reference-manual-open-fpga-stack">Software Reference Manual: Open FPGA Stack<a class="headerlink" href="#software-reference-manual-open-fpga-stack" title="Permanent link">&para;</a></h1>
<h2 id="10-introduction"><strong>1.0 Introduction</strong><a class="headerlink" href="#10-introduction" title="Permanent link">&para;</a></h2>
<h3 id="11-audience"><strong>1.1 Audience</strong><a class="headerlink" href="#11-audience" title="Permanent link">&para;</a></h3>
<p>The information presented in this document is intended to be used by software developers looking to increase their knowledge of the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> user-space software stack and the kernel-space linux-dfl drivers. This information is intended as a starting point, with links to where users can deep dive on specific topics.</p>
<p>Former OPAE and <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> software documents were combined with the Software Reference Manual to reduce clutter and more cleanly document <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> software capabilities. The following documents are no longer available as standalone as of ofs-2023.3:</p>
<ul>
<li>Quick Start Guide</li>
<li>OPAE Installation Guide</li>
<li>OPAE C API Programming Guide</li>
<li>OPAE Python Bindings</li>
<li>OPAE Plugin Developers Guide</li>
<li>Open Programmable Accelerator Engine (OPAE) Linux Device Driver Architecture</li>
</ul>
<h3 id="12-terminology"><strong>1.2 Terminology</strong><a class="headerlink" href="#12-terminology" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th align="center">Term</th>
<th align="center">Abbreviation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Advanced Error Reporting</td>
<td align="center"><abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr></td>
<td>The PCIe <abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr> driver is the extended PCI Express error reporting capability providing more robust error reporting. <a href="https://docs.kernel.org/PCI/pcieaer-howto.html?highlight=aer">(link)</a></td>
</tr>
<tr>
<td align="center">Accelerator Functional Unit</td>
<td align="center"><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></td>
<td>Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region is the part of the design where an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may reside. This <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may or may not be a partial reconfiguration region.</td>
</tr>
<tr>
<td align="center">Basic Building Block</td>
<td align="center"><abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr></td>
<td>Features within an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>'s <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and host interface requires. All BBBs must have a (globally unique identifier) GUID.</td>
</tr>
<tr>
<td align="center">Best Known Configuration</td>
<td align="center"><abbr title="Best Known Configuration, The exact hardware configuration Intel has optimized and validated the solution against.">BKC</abbr></td>
<td>The software and hardware configuration Intel uses to verify the solution.</td>
</tr>
<tr>
<td align="center">Board Management Controller</td>
<td align="center"><abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr></td>
<td>Supports features such as board power managment, flash management, configuration management, and board telemetry monitoring and protection. The majority of the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> logic is in a separate component, such as an Intel® Max® 10 or Intel Cyclone® 10 device; a small portion of the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> known as the PMCI resides in the main Agilex FPGA.</td>
</tr>
<tr>
<td align="center">Configuration and Status Register</td>
<td align="center">CSR</td>
<td>The generic name for a register space which is accessed in order to interface with the module it resides in (e.g. <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr>, various sub-systems and modules).</td>
</tr>
<tr>
<td align="center">Data Parallel C++</td>
<td align="center">DPC++</td>
<td>DPC++ is Intel’s implementation of the SYCL standard. It supports additional attributes and language extensions which ensure DCP++ (SYCL) is efficiently implanted on Intel hardware.</td>
</tr>
<tr>
<td align="center">Device Feature List</td>
<td align="center"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr></td>
<td>The <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver to automatically load the drivers required for a given FPGA configuration. This concept is the foundation for the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> software framework. <a href="https://docs.kernel.org/fpga/dfl.html">(link)</a></td>
</tr>
<tr>
<td align="center">FPGA Interface Manager</td>
<td align="center"><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></td>
<td>Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> resides in the static region of the FPGA and contains the FPGA Management Engine (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>) and I/O ring.</td>
</tr>
<tr>
<td align="center">FPGA Management Engine</td>
<td align="center"><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td>Performs reconfiguration and other FPGA management functions. Each FPGA device only has one <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> which is accessed through PF0.</td>
</tr>
<tr>
<td align="center">Host Exerciser Module</td>
<td align="center"><abbr title="Host Exerciser Module, Host exercisers are used to exercise and characterize the various host-FPGA interactions, including Memory Mapped Input/Output (MMIO), data transfer from host to FPGA, PR, host to FPGA memory, etc.">HEM</abbr></td>
<td>Host exercisers are used to exercise and characterize the various host-FPGA interactions, including Memory Mapped Input/Output (<abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>), data transfer from host to FPGA, <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>, host to FPGA memory, etc.</td>
</tr>
<tr>
<td align="center">Input/Output Control</td>
<td align="center"><abbr title="Input/Output Control, System calls used to manipulate underlying device parameters of special files.">IOCTL</abbr></td>
<td>System calls used to manipulate underlying device parameters of special files.</td>
</tr>
<tr>
<td align="center">Intel Virtualization Technology for Directed I/O</td>
<td align="center"><abbr title="Intel Virtualization Technology for Directed I/O, Extension of the VT-x and VT-I processor virtualization technologies which adds new support for I/O device virtualization.">Intel VT-d</abbr></td>
<td>Extension of the VT-x and VT-I processor virtualization technologies which adds new support for I/O device virtualization.</td>
</tr>
<tr>
<td align="center">Joint Test Action Group</td>
<td align="center"><abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr></td>
<td>Refers to the IEEE 1149.1 <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> standard; Another FPGA configuration methodology.</td>
</tr>
<tr>
<td align="center">Memory Mapped Input/Output</td>
<td align="center"><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr></td>
<td>The memory space users may map and access both control registers and system memory buffers with accelerators.</td>
</tr>
<tr>
<td align="center">oneAPI Accelerator Support Package</td>
<td align="center">oneAPI-asp</td>
<td>A collection of hardware and software components that enable oneAPI kernel to communicate with oneAPI runtime and <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> shell components. oneAPI ASP hardware components and oneAPI kernel form the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region of a oneAPI system in <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>.</td>
</tr>
<tr>
<td align="center">Open FPGA Stack</td>
<td align="center"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr></td>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> is a software and hardware infrastructure providing an efficient approach to develop a custom FPGA-based platform or workload using an Intel, 3<sup>rd</sup> party, or custom board.</td>
</tr>
<tr>
<td align="center">Open Programmable Acceleration Engine Software Development Kit</td>
<td align="center"><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr></td>
<td>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> is a software framework for managing and accessing programmable accelerators (FPGAs). It consists of a collection of libraries and tools to facilitate the development of software applications and accelerators. The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> resides exclusively in user-space.</td>
</tr>
<tr>
<td align="center">Platform Interface Manager</td>
<td align="center"><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr></td>
<td>An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developers can use to handle clock crossing, response sorting, buffering and different protocols.</td>
</tr>
<tr>
<td align="center">Platform Management Controller Interface</td>
<td align="center">PMCI</td>
<td>The portion of the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> that resides in the Agilex FPGA and allows the FPGA to communicate with the primary <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> component on the board.</td>
</tr>
<tr>
<td align="center">Partial Reconfiguration</td>
<td align="center"><abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr></td>
<td>The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. For <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> designs, the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region is referred to as the pr_slot.</td>
</tr>
<tr>
<td align="center">Port</td>
<td align="center">N/A</td>
<td>When used in the context of the fpgainfo port command it represents the interfaces between the static FPGA fabric and the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region containing the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</td>
</tr>
<tr>
<td align="center">Remote System Update</td>
<td align="center"><abbr title="Remote System Update, A Remote System Update operation sends an instruction to the Intel FPGA PAC D5005 device that triggers a power cycle of the card only, forcing reconfiguration.">RSU</abbr></td>
<td>The process by which the host can remotely update images stored in flash through PCIe. This is done with the OPAE software command "fpgasupdate".</td>
</tr>
<tr>
<td align="center">Secure Device Manager</td>
<td align="center">SDM</td>
<td>The SDM is the point of entry to the FPGA for <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> commands and interfaces, as well as for device configuration data (from flash, SD card, or through PCI Express* hard IP).</td>
</tr>
<tr>
<td align="center">Static Region</td>
<td align="center">SR</td>
<td>The portion of the FPGA design that cannot be dynamically reconfigured during run-time.</td>
</tr>
<tr>
<td align="center">Single-Root Input-Output Virtualization</td>
<td align="center"><abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr></td>
<td>Allows the isolation of PCI Express resources for manageability and performance.</td>
</tr>
<tr>
<td align="center">SYCL</td>
<td align="center">SYCL</td>
<td>SYCL (pronounced "sickle") is a royalty-free, cross-platform abstraction layer that enables code for heterogeneous and offload processors to be written using modern ISO C++ (at least C++ 17). It provides several features that make it well-suited for programming heterogeneous systems, allowing the same code to be used for CPUs, GPUs, FPGAs or any other hardware accelerator. SYCL was developed by the Khronos Group, a non-profit organization that develops open standards (including OpenCL) for graphics, compute, vision, and multimedia. SYCL is being used by a growing number of developers in a variety of industries, including automotive, aerospace, and consumer electronics.</td>
</tr>
<tr>
<td align="center">Test Bench</td>
<td align="center"><abbr title="Testbench, Testbench or Verification Environment is used to check the functional correctness of the Design Under Test (DUT) by generating and driving a predefined input sequence to a design, capturing the design output and comparing with-respect-to expected output.">TB</abbr></td>
<td>Testbench or Verification Environment is used to check the functional correctness of the Design Under Test (DUT) by generating and driving a predefined input sequence to a design, capturing the design output and comparing with-respect-to expected output.</td>
</tr>
<tr>
<td align="center">Universal Verification Methodology</td>
<td align="center"><abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr></td>
<td>A modular, reusable, and scalable testbench structure via an API framework.  In the context of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>, the <abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr> enviroment provides a system level simulation environment for your design.</td>
</tr>
<tr>
<td align="center">Virtual Function Input/Output</td>
<td align="center"><abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr></td>
<td>An Input-Output Memory Management Unit (IOMMU)/device agnostic framework for exposing direct device access to userspace. (link)</td>
</tr>
</tbody>
</table>
<h3 id="13-opae-software-development-kit-sdk"><strong>1.3 OPAE Software Development Kit (SDK)</strong><a class="headerlink" href="#13-opae-software-development-kit-sdk" title="Permanent link">&para;</a></h3>
<p>The OPAE C library is a lightweight user-space library that provides abstraction for FPGA resources in a compute environment. Built on top of the OPAE Intel® FPGA driver stack that supports Intel® FPGA platforms, the library abstracts away hardware specific and OS specific details and exposes the underlying FPGA resources as a set of features accessible from within software programs running on the host. The OPAE source code is available on the <a href="https://github.com/OFS/opae-sdk"><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> repository</a>.</p>
<p>By providing a unified C API, the library supports different FPGA
integration and deployment models, ranging from single-node systems with one or a few FPGA devices to large-scale FPGA deployments in a data center. At one end of the spectrum, the API supports a simple application using a PCIe link to reconfigure the FPGA with different accelerator functions. At the other end of the spectrum, resource
management and orchestration services in a data center can use this API to discover and select FPGA resources and then allocate them for use by acceleration workloads.</p>
<p>The OPAE provides consistent interfaces to crucial components of the platform. OPAE does not constrain frameworks and applications by making optimizations with limited applicability. When the OPAE does
provide convenience functions or optimizations, they are optional. For example, the OPAE provides an interface to allocate physically contiguous buffers in system memory that user-space software and an accelerator can share. This interface enables the most basic feature set of allocating and sharing a large page of memory in one API call. However, it does <em>not</em> provide a <code>malloc()</code>-like interface backed by a memory pool or slab allocator. Higher layers of the software stack can make such domain-specific optimizations.</p>
<p>Most of the information related to OPAE can be found on the official <a href="https://ofs.github.io/latest">Open FPGA Stack (<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>) Collateral Site</a> and in the <a href="https://github.com/OFS/opae-sdk"><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> repository</a>. The following is a summary of the information present on this web page:</p>
<ul>
<li>Configuration options present in the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> build and installation flow</li>
<li>The steps required to build a sample OPAE application</li>
<li>An explanation of the basic application flow</li>
<li>A reference for the C, C++, and Python APIs</li>
<li>An explanation of the OPAE Linux Device Driver Architecture</li>
<li>Definitions for the various user-facing <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> tools</li>
</ul>
<p>The remaining sections on OPAE in this document are unique and build on basic principles explained in opae.github.io.</p>
<h4 id="table-1-additional-websites-and-links">Table 1: Additional Websites and Links<a class="headerlink" href="#table-1-additional-websites-and-links" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Document</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> on github</td>
<td><a href="https://github.com/OFS/opae-sdk"><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> repository</a></td>
</tr>
<tr>
<td>OPAE Documents</td>
<td><a href="https://ofs.github.io/">Open FPGA Stack (<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>) Collateral Site</a></td>
</tr>
<tr>
<td>pybind11</td>
<td>https://pybind11.readthedocs.io/en/stable/</td>
</tr>
<tr>
<td>CLI11</td>
<td>https://github.com/CLIUtils/CLI11</td>
</tr>
<tr>
<td>spdlog</td>
<td>https://github.com/gabime/spdlog</td>
</tr>
</tbody>
</table>
<h4 id="table-2-ofs-hardware-terminology">Table 2: <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Hardware Terminology<a class="headerlink" href="#table-2-ofs-hardware-terminology" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Term</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>FPGA: <a href="https://en.wikipedia.org/wiki/Field-programmable_gate_array">Field Programmable Gate Array</a></strong></td>
<td>a discrete or integrated device connecting to a host CPU via PCIe or other type of interconnects.</td>
</tr>
<tr>
<td><strong>Accelerator Function Unit (<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>)</strong></td>
<td>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is the supplied implementation of an accelerator, typically in HDL. AFUs implement a function such as compression, encryption, or mathematical operations.The Quartus Prime Pro software synthesizes the RTL logic into a bitstream.</td>
</tr>
<tr>
<td><strong>Accelerator Function (AF)</strong></td>
<td>The AF is the compiled binary for an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. An AF is a raw binary file (.rbf) bitstream. A tool (<em>fpgaconf</em>) reconfigures the FPGA using an AF bitstream.</td>
</tr>
<tr>
<td><strong>Reconfiguration</strong></td>
<td>The process of reprogramming the FPGA with a different AF.</td>
</tr>
</tbody>
</table>
<h2 id="20-opae-c-api"><strong>2.0 OPAE C API</strong><a class="headerlink" href="#20-opae-c-api" title="Permanent link">&para;</a></h2>
<p>The following OPAE data structures and functions integrate AFUs into the OPAE environment. 
The OPAE C API models these data structures and functions. For more information on the object 
models refer to the <a href="#object-models">Object model</a> section.</p>
<ul>
<li>Accelerator: An accelerator is an allocable accelerator function implemented in an FPGA. 
An accelerator tracks the  <em>ownership</em> of an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> (or part of it) for a process that uses it.
Multiple processes can share an accelerator.</li>
<li>Device: The OPAE enumerates and models two device types: the FPGA and the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</li>
<li>Events: Events are asynchronous notifications. The FPGA driver
triggers particular events to indicate error conditions. Accelerator logic can also
define its own events. User applications can choose to be
notified when particular events occur and respond appropriately.</li>
<li>Shared memory buffers: Software allocates shared memory buffers in user process memory
on the host. Shared memory buffers facilitate data transfers between the user process and the 
accelerator that it owns.</li>
</ul>
<h3 id="21-libopae-c"><strong>2.1 libopae-c</strong><a class="headerlink" href="#21-libopae-c" title="Permanent link">&para;</a></h3>
<p>Linking with this library is straightforward.
Code using the  OPAE library should include the header file <code>fpga.h</code>. Taking the GCC
compiler on Linux as an example, here is the simplest compile and link command:</p>
<p><code>gcc myprog.c -I&lt;/path/to/fpga.h&gt; -L&lt;/path/to/libopae-c.so&gt; -lopae-c -luuid -ljson-c -lpthread</code></p>
<p>.. note::</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>The OPAE library uses the third-party `libuuid` and `libjson-c` libraries that are not distributed with 
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>the OPAE library. Make sure to install these libraries.
</code></pre></div>
<h3 id="sample-code">Sample Code<a class="headerlink" href="#sample-code" title="Permanent link">&para;</a></h3>
<p>The library source includes two code samples. Use these samples
to learn how to call functions in the library. Build and run these samples
to determine if your installation and environment are set up properly. </p>
<p>Refer to the <a href="https://www.altera.com/content/altera-www/global/en_us/index/documentation/dnv1485190478614.html#vks1498593668425">Running the Hello FPGA Example</a> chapter in the <em>Intel&reg; Acceleration Stack
Quick Start Guide for for Intel Programmable Acceleration Card with Intel Arria&reg; 10 GX FPGA</em> for more information about using the sample code.  </p>
<h3 id="high-level-directory-structure">High-Level Directory Structure<a class="headerlink" href="#high-level-directory-structure" title="Permanent link">&para;</a></h3>
<p>Building and installing the OPAE library results in the following directory structure on the Linux OS.
Windows and MacOS have similar directories and files.</p>
<table>
<thead>
<tr>
<th>Directory &amp; Files</th>
<th>Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td>include/opae</td>
<td>Directory containing all header files</td>
</tr>
<tr>
<td>include/opae/fpga.h</td>
<td>Top-level header for user code to include</td>
</tr>
<tr>
<td>include/opae/access.h</td>
<td>Header file for accelerator acquire/release, <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>, memory management, event handling, and so on</td>
</tr>
<tr>
<td>include/opae/bitstream.h</td>
<td>Header file for bitstream manipulation functions</td>
</tr>
<tr>
<td>include/opae/common.h</td>
<td>Header file for error reporting functions</td>
</tr>
<tr>
<td>include/opae/enum.h</td>
<td>Header file for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> enumeration functions</td>
</tr>
<tr>
<td>include/opae/manage.h</td>
<td>Header file for FPGA management functions</td>
</tr>
<tr>
<td>include/opae/types.h</td>
<td>Various type definitions</td>
</tr>
<tr>
<td>lib</td>
<td>Directory containing shared library files</td>
</tr>
<tr>
<td>lib/libopae-c.so</td>
<td>The shared dynamic library for linking with the user application</td>
</tr>
<tr>
<td>doc</td>
<td>Directory containing API documentation</td>
</tr>
<tr>
<td>doc/html</td>
<td>Directory for documentation of HTML format</td>
</tr>
<tr>
<td>doc/latex</td>
<td>Directory for documentation of LaTex format</td>
</tr>
<tr>
<td>doc/man</td>
<td>Directory for documentation of Unix man page format</td>
</tr>
</tbody>
</table>
<h3 id="object-models">Object Models<a class="headerlink" href="#object-models" title="Permanent link">&para;</a></h3>
<ul>
<li><code>fpga_objtype</code>: An enum type that represents the type of an FPGA resource, either <code>FPGA_DEVICE</code> or <code>FPGA_ACCELERATOR</code>. 
An <code>FPGA_DEVICE</code> object corresponds to a physical FPGA device. Only <code>FPGA_DEVICE</code> objects can invoke management functions.
The <code>FPGA_ACCELERATOR</code> represents an instance of an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. </li>
<li><code>fpga_token</code>: An opaque type that represents a resource known to, but not
necessarily owned by, the calling process. The calling process must own a
resource before it can invoke functions of the resource.</li>
<li><code>fpga_handle</code>: An opaque type that represents a resource owned by the
calling process. The API functions <code>fpgaOpen()</code> and <code>fpgaClose()</code> acquire and release ownership of a resource that an <code>fpga_handle</code> represents. (Refer to the <a href="#functions">Functions</a> section for more information.)</li>
<li><code>fpga_properties</code>: An opaque type for a properties object. Your
applications use these properties to query and search for appropriate resources. The 
<a href="#fpga-resource-properties">FPGA Resource Properties</a> section documents properties visible to your
applications.</li>
<li><code>fpga_event_handle</code>: An opaque handle the FPGA driver uses to notify your
application about an event. </li>
<li><code>fpga_event_type</code>: An enum type that represents the types of events. The following are valid values: 
<code>FPGA_EVENT_INTERRUPT</code>, <code>FPGA_EVENT_ERROR</code>, and <code>FPGA_EVENT_POWER_THERMAL</code>. (The Intel Programmable Acceleration Card (<abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr>) with
Intel Arria 10 GX FPGA does not handle thermal and power events.)</li>
<li><code>fpga_result</code>: An enum type to represent the result of an API function. If the
function returns successfully the result is <code>FPGA_OK</code>. Otherwise, the result is
the appropriate error codes. Function <code>fpgaErrStr()</code> translates an error code
into human-readable strings.</li>
</ul>
<h3 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h3>
<p>The table below groups important API calls by their functionality. For more information about each of the functions, refer to the 
<a href="https://opae.github.io/0.13.0/docs/fpga_api/fpga_api.html">OPAE C API reference manual</a>.</p>
<table>
<thead>
<tr>
<th align="left">Functionality</th>
<th align="left">API Call</th>
<th align="center">FPGA</th>
<th align="center">Accelerator</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Enumeration</td>
<td align="left"><code>fpgaEnumerate()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Query FPGA resources that match certain properties</td>
</tr>
<tr>
<td align="left">Enumeration: Properties</td>
<td align="left"><code>fpga[Get, Update, Clear, Clone, Destroy Properties]()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Manage <code>fpga_properties</code> life cycle</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>fpgaPropertiesGet[Prop]()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Get the specified property <em>Prop</em>, from the <a href="#fpga-resource-properties">FPGA Resource Properties</a> table</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>fpgaPropertiesSet[Prop]()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Set the specified property <em>Prop</em>, from the <a href="#fpga-resource-properties">FPGA Resource Properties</a> table</td>
</tr>
<tr>
<td align="left">Access: Ownership</td>
<td align="left"><code>fpga[Open, Close]()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Acquire/release ownership</td>
</tr>
<tr>
<td align="left">Access: Reset</td>
<td align="left"><code>fpgaReset()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Reset an accelerator</td>
</tr>
<tr>
<td align="left">Access: Event handling</td>
<td align="left"><code>fpga[Register, Unregister]Event()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Register/unregister an event to be notified about</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>fpga[Create, Destroy]EventHandle()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Manage <code>fpga_event_handle</code> life cycle</td>
</tr>
<tr>
<td align="left">Access: <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr></td>
<td align="left"><code>fpgaMapMMIO()</code>, <code>fpgaUnMapMMIO()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Map/unmap <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> space</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>fpgaGetMMIOInfo()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Get information about the specified <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> space</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>fpgaReadMMIO[32, 64]()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Read a 32-bit or 64-bit value from <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> space</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>fpgaWriteMMIO[32, 64]()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Write a 32-bit or 64-bit value to <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> space</td>
</tr>
<tr>
<td align="left">Memory management: Shared memory</td>
<td align="left"><code>fpga[Prepare, Release]Buffer()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Manage memory buffer shared between the calling process and an accelerator</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>fpgaGetIOAddress()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Return the device I/O address of a shared memory buffer</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>fpgaBindSVA()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Bind IOMMU shared virtual addressing</td>
</tr>
<tr>
<td align="left">Management: Reconfiguration</td>
<td align="left"><code>fpgaReconfigureSlot()</code></td>
<td align="center">Yes</td>
<td align="center">No</td>
<td align="left">Replace an existing <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> with a new one</td>
</tr>
<tr>
<td align="left">Error report</td>
<td align="left"><code>fpgaErrStr()</code></td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">Map an error code to a human readable string</td>
</tr>
</tbody>
</table>
<p>.. note::</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>The UMsg APIs are not supported for the Intel(R) PAC cards. They will be deprecated in a future release.
</code></pre></div>
<h3 id="fpga-resource-propertie">FPGA Resource Propertie<a class="headerlink" href="#fpga-resource-propertie" title="Permanent link">&para;</a></h3>
<p>Applications query resource properties by specifying the property name for <code>Prop</code> in the 
<code>fpgaPropertiesGet[Prop]()</code> and <code>fpgaPropertiesSet[Prop]()</code> functions. The FPGA and Accelerator
columns state whether or not the Property is available for the FPGA or Accelerator objects.</p>
<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="center">FPGA</th>
<th align="center">Accelerator</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Parent</td>
<td align="center">No</td>
<td align="center">Yes</td>
<td align="left"><code>fpga_token</code> of the parent object</td>
</tr>
<tr>
<td align="left">ObjectType</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">The type of the resource: either <code>FPGA_DEVICE</code> or <code>FPGA_ACCELERATOR</code></td>
</tr>
<tr>
<td align="left">Bus</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">The bus number</td>
</tr>
<tr>
<td align="left">Device</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">The PCI device number</td>
</tr>
<tr>
<td align="left">Function</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">The PCI function number</td>
</tr>
<tr>
<td align="left">SocketId</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">The socket ID</td>
</tr>
<tr>
<td align="left">DeviceId</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">The device ID</td>
</tr>
<tr>
<td align="left">NumSlots</td>
<td align="center">Yes</td>
<td align="center">No</td>
<td align="left">Number of <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> slots available on an <code>FPGA_DEVICE</code> resource</td>
</tr>
<tr>
<td align="left">BBSID</td>
<td align="center">Yes</td>
<td align="center">No</td>
<td align="left">The FPGA Interface Manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>) ID of an <code>FPGA_DEVICE</code> resource</td>
</tr>
<tr>
<td align="left">BBSVersion</td>
<td align="center">Yes</td>
<td align="center">No</td>
<td align="left">The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> version of an <code>FPGA_DEVICE</code> resource</td>
</tr>
<tr>
<td align="left">VendorId</td>
<td align="center">Yes</td>
<td align="center">No</td>
<td align="left">The vendor ID of an <code>FPGA_DEVICE</code> resource</td>
</tr>
<tr>
<td align="left">GUID</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="left">The GUID of an <code>FPGA_DEVICE</code> or <code>FPGA_ACCELERATOR</code> resource</td>
</tr>
<tr>
<td align="left">NumMMIO</td>
<td align="center">No</td>
<td align="center">Yes</td>
<td align="left">The number of <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> space of an <code>FPGA_ACCELERATOR</code> resource</td>
</tr>
<tr>
<td align="left">NumInterrupts</td>
<td align="center">No</td>
<td align="center">Yes</td>
<td align="left">The number of interrupts of an <code>FPGA_ACCELERATOR</code> resource</td>
</tr>
<tr>
<td align="left">AcceleratorState</td>
<td align="center">No</td>
<td align="center">Yes</td>
<td align="left">The state of an <code>FPGA_ACCELERATOR</code> resource: either <code>FPGA_ACCELERATOR_ASSIGNED</code> or <code>FPGA_ACCELERATOR_UNASSIGNED</code></td>
</tr>
</tbody>
</table>
<h3 id="opae-c-api-return-codes">OPAE C API Return Codes<a class="headerlink" href="#opae-c-api-return-codes" title="Permanent link">&para;</a></h3>
<p>The OPAE C library returns a code for every exported public API function.  <code>FPGA_OK</code> indicates successful completion
of the requested operation. Any return code other than <code>FPGA_OK</code> indicates an error or unexpected
behavior. When using the OPAE C API, always check the API return codes. </p>
<table>
<thead>
<tr>
<th>Error Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FPGA_OK</code></td>
<td>Operation completed successfully</td>
</tr>
<tr>
<td><code>FPGA_INVALID_PARAM</code></td>
<td>Invalid parameter supplied</td>
</tr>
<tr>
<td><code>FPGA_BUSY</code></td>
<td>Resource is busy</td>
</tr>
<tr>
<td><code>FPGA_EXCEPTION</code></td>
<td>An exception occurred</td>
</tr>
<tr>
<td><code>FPGA_NOT_FOUND</code></td>
<td>A required resource was not found</td>
</tr>
<tr>
<td><code>FPGA_NO_MEMORY</code></td>
<td>Not enough memory to complete operation</td>
</tr>
<tr>
<td><code>FPGA_NOT_SUPPORTED</code></td>
<td>Requested operation is not supported</td>
</tr>
<tr>
<td><code>FPGA_NO_DRIVER</code></td>
<td>Driver is not loaded</td>
</tr>
<tr>
<td><code>FPGA_NO_DAEMON</code></td>
<td>FPGA Daemon (<code>fpgad</code>) is not running</td>
</tr>
<tr>
<td><code>FPGA_NO_ACCESS</code></td>
<td>Insufficient privileges or permissions</td>
</tr>
<tr>
<td><code>FPGA_RECONF_ERROR</code></td>
<td>Error while reconfiguring FPGA</td>
</tr>
</tbody>
</table>
<h4 id="211-device-abstraction"><strong>2.1.1 Device Abstraction</strong><a class="headerlink" href="#211-device-abstraction" title="Permanent link">&para;</a></h4>
<p>The OPAE C API relies on two base abstractions concerning how the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>
and accelerator are presented to and manipulated by the user. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> is
concerned with management functionality. Access to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and its
interfaces is typically restricted to privileged (root) users. The
accelerator contains the user-defined logic in its reconfigurable
region. Most OPAE end-user applications are concerned with querying and
opening the accelerator device, then interacting with the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> via <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>
and shared memory.</p>
<h5 id="2111-device-types"><strong>2.1.1.1 Device types</strong><a class="headerlink" href="#2111-device-types" title="Permanent link">&para;</a></h5>
<p>The C enum
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L100-L115">fpga_objtype</a>
defines two variants. The FPGA_DEVICE variant corresponds to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>
portion of the device, and the FPGA_ACCELERATOR refers to the
accelerator, also known as the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>An FPGA_DEVICE refers loosely to the sysfs tree rooted at the dfl-fme.X
directory, for example /sys/class/fpga_region/region0/dfl-fme.0, and
its associated device file /dev/dfl-fme.0.</p>
<p>An FPGA_ACCELERATOR refers loosely to the sysfs tree rooted at the
dfl-port.X directory, for example
/sys/class/fpga_region/region0/dfl-port.0, and its associated device
file /dev/dfl-port.0.</p>
<p>The number X in dfl-fme.X and dfl-port.X refers to a numeric ID that is
assigned by the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> device driver to uniquely identify an instance of
the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>/Accelerator. Systems with multiple FPGA acceleration devices
will have multiple dfl-fme.X’s and matching dfl-port.X’s.</p>
<h5 id="2112-tokens-and-handles"><strong>2.1.1.2 Tokens and Handles</strong><a class="headerlink" href="#2112-tokens-and-handles" title="Permanent link">&para;</a></h5>
<p>An
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L94-L107">fpga_token</a>
is an opaque data structure that uniquely represents an FPGA_DEVICE or
an FPGA_ACCELERATOR. Tokens convey existence, but not ownership. Tokens
are retrieved via the OPAE enumeration process described below using the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L46-L103">fpgaEnumerate()</a>
call.</p>
<p>An
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L109-L120">fpga_handle</a>
is an opaque data structure that corresponds to an opened device
instance, whether FPGA_DEVICE or FPGA_ACCELERATOR. A Handle is
obtained from a token via the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L41-L73">fpgaOpen()</a>
call. A handle conveys that the /dev/dfl-fme.X or /dev/dfl-port.X device
file has been opened and is ready for interaction via its <abbr title="Input/Output Control, System calls used to manipulate underlying device parameters of special files.">IOCTL</abbr>
interface.</p>
<h4 id="212-enumeration"><strong>2.1.2 Enumeration</strong><a class="headerlink" href="#212-enumeration" title="Permanent link">&para;</a></h4>
<p>Enumeration is the process by which an OPAE application becomes aware of
the existence of FPGA_DEVICE’s and FPGA_ACCELERATOR’s. Refer to the
signature of the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L46-L103">fpgaEnumerate()</a>
call:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaEnumerate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">fpga_properties</span><span class="w"> </span><span class="o">*</span><span class="n">filters</span><span class="p">,</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_filters</span><span class="p">,</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">fpaa_token</span><span class="w"> </span><span class="o">*</span><span class="n">tokens</span><span class="p">,</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">max_tokens</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">num_matches</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 1 fpgaEnumerate()</p>

<p>The typical enumeration flow involves an initial call to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L46-L103">fpgaEnumerate()</a>
to discover the number of available tokens.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">fpgaEnumerate</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num_matches</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 2 Discovering Number of Tokens</p>

<p>Once the number of available tokens is known, the application can
allocate the correct amount of space to hold the tokens:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">fpga_token</span><span class="w"> </span><span class="o">*</span><span class="n">tokens</span><span class="p">;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_tokens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_matches</span><span class="p">;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">tokens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">fpga_token</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">calloc</span><span class="p">(</span><span class="n">num_tokens</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">fpga_token</span><span class="p">));</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">fpgaEnumerate</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">tokens</span><span class="p">,</span><span class="w"> </span><span class="n">num_tokens</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num_matches</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 3 Enumerating All Tokens</p>

<p>Note that parameters filters and num_filters were not used in the
preceding example, as they were NULL and 0. When no filtering criteria
are provided,
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L46-L103">fpgaEnumerate()</a>
returns all tokens that can be enumerated.</p>
<p>The function will assert a reset on the currently loaded <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> for a selected device through an <code>ioctl</code> call on its VFIO_GROUP.</p>
<h5 id="2121-fpga_properties-and-filtering"><strong>2.1.2.1 fpga_properties and Filtering</strong><a class="headerlink" href="#2121-fpga_properties-and-filtering" title="Permanent link">&para;</a></h5>
<p>An
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L71-L92">fpga_properties</a>
is an opaque data structure used to retrieve all of the properties
concerning an FPGA_DEVICE or FPGA_ACCELERATOR. These properties can be
included in the filters parameter to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L46-L103">fpgaEnumerate()</a>
to select tokens by specific criteria.</p>
<h5 id="21211-common-properties"><strong>2.1.2.1.1 Common Properties</strong><a class="headerlink" href="#21211-common-properties" title="Permanent link">&para;</a></h5>
<p>Table 3 lists the set of
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/props.h#L82-L133">properties</a>
that are common to FPGA_DEVICE and FPGA_ACCELERATOR:</p>
<table>
<thead>
<tr class="header">
<th> Property</th>
<th> Description</th>
</tr>
</thread>
<tbody>
<tr class="even">
<td>fpga_guid guid;</td>
<td>FPGA_DEVICE: PR Interface ID<br />
FPGA_ACCELERATOR: AFU ID</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>fpga_token parent;</td>
<td>FPGA_DEVICE: always NULL<br />
FPGA_ACCELERATOR: the token of the corresponding FPGA_DEVICE, if any. Otherwise, NULL.</td>
</tr>
<tr class="even">
<td>fpga_objtype objtype;</td>
<td>FPGA_DEVICE or FPGA_ACCELERATOR</td>
</tr>
<tr class="odd">
<td>uint16_t segment;</td>
<td>The segment portion of the PCIe address: ssss:bb:dd.f</td>
</tr>
<tr class="even">
<td>uint8_t bus;</td>
<td><p>The bus portion of the PCIe address:</p>
<p>ssss:bb:dd.f</p></td>
</tr>
<tr class="odd">
<td>uint8_t device;</td>
<td><p>The device portion of the PCIe address:</p>
<p>ssss:bb:dd.f</p></td>
</tr>
<tr class="even">
<td>uint8_t function;</td>
<td>The function portion of the PCIe address: ssss:bb:dd.f</td>
</tr>
<tr class="odd">
<td>uint64_t object_id;</td>
<td>A unique 64-bit value that identifies this token on the system.</td>
</tr>
<tr class="even">
<td>uint16_t vendor_id;</td>
<td>The PCIe Vendor ID</td>
</tr>
<tr class="odd">
<td>uint16_t device_id;</td>
<td>The PCIe Device ID</td>
</tr>
<tr class="even">
<td>uint32_t num_errors;</td>
<td>The number of error sysfs nodes available for this token.</td>
</tr>
<tr class="odd">
<td><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L117-L132">fpga_interface</a> interface;</td>
<td>An identifier for the underlying plugin-based access method.</td>
</tr>
</tbody>
</table>

<p align = "center">Table 3 Common Properties</p>

<h6 id="21212-fpga_device-properties"><strong>2.1.2.1.2 FPGA_DEVICE Properties</strong><a class="headerlink" href="#21212-fpga_device-properties" title="Permanent link">&para;</a></h6>
<p>Table 4 lists the set of properties that are specific to FPGA_DEVICE
token types.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>uint64_t bbs_id;</td>
<td><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>-specific Blue Bitstream ID</td>
</tr>
<tr>
<td><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L135-L146">fpga_version</a> bbs_version;</td>
<td>BBS version</td>
</tr>
</tbody>
</table>
<p align = "center">Table 4 FPGA_DEVICE Properties</p>

<h6 id="21213-fpga_accelerator-properties"><strong>2.1.2.1.3 FPGA_ACCELERATOR Properties</strong><a class="headerlink" href="#21213-fpga_accelerator-properties" title="Permanent link">&para;</a></h6>
<p>Table 5 lists the set of properties that are specific to
FPGA_ACCELERATOR token types.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L92-L98">fpga_accelerator_state</a> state;</td>
<td>Whether the Accelerator is currently open</td>
</tr>
<tr>
<td>uint32_t num_mmio;</td>
<td>The number of <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> regions available</td>
</tr>
<tr>
<td>uint32_t num_interrupts;</td>
<td>The number of interrupts available</td>
</tr>
</tbody>
</table>
<p align = "center">Table 5 FPGA_ACCELERATOR Properties</p>

<p>Following is an example of using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L71-L92">fpga_properties</a>
to enumerate a specific <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="cp">#define NLB0_AFU &quot;D8424DC4-A4A3-C413-F89E-433683F9040B&quot;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">fpga_properties</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">fpga_guid</span><span class="w"> </span><span class="n">afu_id</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">fpgaGetProperties</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">filter</span><span class="p">);</span><span class="w"> </span><span class="c1">// NULL: a new empty properties</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="n">fpgaPropertiesSetObjectType</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="n">FPGA_ACCELERATOR</span><span class="p">);</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="n">uuid_parse</span><span class="p">(</span><span class="n">NLB0_AFU</span><span class="p">,</span><span class="w"> </span><span class="n">afu_id</span><span class="p">);</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="n">fpgaPropertiesSetGuid</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="n">afu_id</span><span class="p">);</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="n">fpgaEnumerate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tokens</span><span class="p">,</span><span class="w"> </span><span class="n">num_tokens</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num_matches</span><span class="p">);</span>
</code></pre></div>
Relevant Links: 
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L122-L133">fpga_guid</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/properties.h#L77-L105">fpgaGetProperties</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/properties.h#L216-L227">fpgaPropertiesSetObjectType</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/properties.h#L591-L605">fpgaPropertiesSetGUID</a></p>
<p align = "center">Figure 4 Filtering During Enumeration</p>

<p>Note that fpga_properties and fpga_token’s are allocated resources
that must be freed by their respective API calls, ie
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/properties.h#L160-L176">fpgaDestroyProperties()</a>
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L120-L133">fpgaDestroyToken()</a>.</p>
<h4 id="213-access"><strong>2.1.3 Access</strong><a class="headerlink" href="#213-access" title="Permanent link">&para;</a></h4>
<p>Once a token is discovered and returned to the caller by
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L46-L103">fpgaEnumerate()</a>,
the token can be converted into a handle by
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L41-L73">fpgaOpen()</a>.
Upon a successful call to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L41-L73">fpgaOpen()</a>,
the associated /dev/dfl-fme.X (FPGA_DEVICE) or /dev/dfl-port.X
(FPGA_ACCELERATOR) is opened and ready for use. Having acquired an
fpga_handle, the application can then use the handle with any of the
OPAE APIs that require an fpga_handle as an input parameter.</p>
<p>Like tokens and properties, handles are allocated resources. When a
handle is no longer needed, it should be closed and released by calling
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L75-L88">fpgaClose()</a>.</p>
<h4 id="214-events"><strong>2.1.4 Events</strong><a class="headerlink" href="#214-events" title="Permanent link">&para;</a></h4>
<p>Event registration in OPAE is a two-step process. First, the type of
event must be identified. The following
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L71-L82">fpga_event_type</a>
variants are defined:</p>
<table>
<thead>
<tr>
<th>Event</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>FPGA_EVENT_INTERRUPT</td>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> interrupt</td>
</tr>
<tr>
<td>FPGA_EVENT_ERROR</td>
<td>Infrastructure error event (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>/Port Error)</td>
</tr>
</tbody>
</table>
<p>Table 6 FPGA Event Types</p>
<p>Once the desired event type is known, an
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L148-L160">fpga_event_handle</a>
is created via
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/event.h#L50-L63">fpgaCreateEventHandle()</a>.
Once the event handle is available, the event notification is registered
using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/event.h#L96-L128">fpgaRegisterEvent()</a>.
In the example below, note the use of the flags field for passing the
desired IRQ vector when the event type is FPGA_EVENT_INTERRUPT. With
the event registered, the application can then use
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/event.h#L82-L94">fpgaGetOSObjectFromEventHandle()</a>
to obtain a file descriptor for use with the poll() system call. When
the interrupt occurs, the file descriptor will be set to the signaled
state by the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">fpga_event_handle</span><span class="w"> </span><span class="n">event_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">fpgaCreateEventHandle</span><span class="p">(</span><span class="o">&amp;</span><span class="n">event_handle</span><span class="p">);</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="n">fpgaRegisterEvent</span><span class="p">(</span><span class="n">fpga_handle</span><span class="p">,</span><span class="w"> </span><span class="n">FPGA_EVENT_INTERRUPT</span><span class="p">,</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="n">event_handle</span><span class="p">,</span><span class="w"> </span><span class="n">irq_vector</span><span class="p">);</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="n">fpgaGetOSObjectFromEventHandle</span><span class="p">(</span><span class="n">event_handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fd</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 5 Creating and Registering Events</p>

<p>When an event notification is no longer needed, it should be released by
calling
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/event.h#L130-L154">fpgaUnregisterEvent()</a>.
Like device handles, event handles are allocated resources that must be
freed when no longer used. To free an event handle, use the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/event.h#L65-L79">fpgaDestroyEventHandle()</a>
call.</p>
<h4 id="215-mmio-and-shared-memory"><strong>2.1.5 <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> and Shared Memory</strong><a class="headerlink" href="#215-mmio-and-shared-memory" title="Permanent link">&para;</a></h4>
<p>Communication with the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is achieved via reading and writing CSRs and
by reading and writing to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>/host shared memory buffers. An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>’s CSRs
are memory-mapped into the application process address space by way of
the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mmio.h#L141-L183">fpgaMapMMIO()</a>
call.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">mmio_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">fpgaMapMMIO</span><span class="p">(</span><span class="n">fpga_handle</span><span class="p">,</span><span class="w"> </span><span class="n">mmio_num</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">fpga_handle</span><span class="p">,</span><span class="w"> </span><span class="n">mmio_num</span><span class="p">,</span><span class="w"> </span><span class="n">MY_CSR</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 6 Mapping and Accessing CSRs</p>

<p>The second parameter, mmio_num, is the zero-based index identifying the
desired <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region. The maximum number of <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> regions for a particular
handle is found by accessing the num_mmio property. Refer to the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/properties.h#L607-L618">fpgaPropertiesGetNumMMIO()</a>
call.</p>
<p>Once the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSRs are mapped into the process address space, the
application can use the fpgaReadMMIO**XX**() and fpgaWriteMMIO**XX**() family of
functions, eg
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mmio.h#L67-L83">fpgaReadMMIO64()</a>
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mmio.h#L49-L65">fpgaWriteMMIO64()</a>.
When an <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region is no longer needed, it should be unmapped from the
process address space using the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mmio.h#L185-L201">fpgaUnmapMMIO()</a>
call.</p>
<p>Shared memory buffers are allocated by way of the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L55-L99">fpgaPrepareBuffer()</a>
call.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaPrepareBuffer</span><span class="p">(</span><span class="n">fpga_handle</span><span class="w"> </span><span class="n">handle</span><span class="p">,</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="n">buf_addr</span><span class="p">,</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">wsid</span><span class="p">,</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 7 fpgaPrepareBuffer()</p>

<p>Three buffer lengths are supported by this allocation method:</p>
<table>
<thead>
<tr>
<th>Length</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>4096 (4KiB)</td>
<td>No memory configuration needed.</td>
</tr>
<tr>
<td>2097152 (2MiB)</td>
<td>Requires 2MiB huge pages to be allocated.</td>
</tr>
<tr>
<td>1073741824 (1GiB)</td>
<td>Requires 1GiB huge pages to be allocated.</td>
</tr>
</tbody>
</table>
<p align = "center">Table 7 fpgaPrepareBuffer() Lengths</p>

<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nb">echo</span><span class="w"> </span><span class="m">8</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nb">echo</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/mm/hugepages/hugepages-1048576kB/nr_hugepages
</code></pre></div>
<p align = "center">Figure 8 Configuring Huge Pages</p>

<p>The buf_addr parameter to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L55-L99">fpgaPrepareBuffer()</a>
is a pointer to a void * that accepts the user virtual base address of
the newly-created buffer. The wsid parameter is a pointer to a uint64_t
that receives a unique workspace ID for the buffer allocation. This
workspace ID is used in subsequent calls to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L101-L115">fpgaReleaseBuffer()</a>,
which should be called when the buffer is no longer needed and in calls
to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L117-L136">fpgaGetIOAddress()</a>
which is used to query the IO base address of the buffer. The IO base
address can be programmed into the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> by means of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSR space.
For example, here is a code snippet from the
<a href="https://github.com/OFS/opae-sdk/blob/master/samples/hello_fpga/hello_fpga.c">hello_fpga</a>
sample that demonstrates programming a shared buffer’s IO base address
into an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSR in <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region 0:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="cp">#define LOG2_CL 6</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="cp">#define CACHELINE_ALIGNED_ADDR(p) ((p) &gt;&gt; LOG2_CL)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">fpgaGetIOAddress</span><span class="p">(</span><span class="n">accelerator_handle</span><span class="p">,</span><span class="w"> </span><span class="n">input_wsid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iova</span><span class="p">);</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">accelerator_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">nlb_base_addr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">CSR_SRC_ADDR</span><span class="p">,</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">CACHELINE_ALIGNED_ADDR</span><span class="p">(</span><span class="n">iova</span><span class="p">));</span>
</code></pre></div>
<p align = "center">Figure 9 Programming Shared Memory</p>

<p>If applications need to map a shared buffer that has been allocated by
some other means than
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L55-L99">fpgaPrepareBuffer()</a>,
then the flags parameter can be set to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L140">FPGA_BUF_PREALLOCATED</a>.
This causes
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L55-L99">fpgaPrepareBuffer()</a>
to skip the allocation portion of the call and to only memory map the
given buf_addr into the application process address space.</p>
<p>Buffers can also be allocated and mapped as read-only by specifying
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L142">FPGA_BUF_READ_ONLY</a>.</p>
<h4 id="216-management"><strong>2.1.6 Management</strong><a class="headerlink" href="#216-management" title="Permanent link">&para;</a></h4>
<p>The management feature in OPAE concerns re-programming the programmable
region of the Port. To program the Port bitstream, pass a handle to the
FPGA_DEVICE associated with the desired Port. The slot parameter
identifies which Port to program in the case of multi-port
implementations. Most designs will only pass zero as the slot parameter.
The bitstream parameter is a buffer that contains the entire bitstream
contents, including the JSON bitstream header information. The
bitstream_len field gives the length of bitstream in bytes.</p>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/manage.h#L109-L141">fpgaReconfigureSlot()</a>
first checks whether the FPGA_ACCELERATOR corresponding to the
FPGA_DEVICE in fme_handle is open. If it is open, then the programming
request is aborted with an error code. The application may pass
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L162">FPGA_RECONF_FORCE</a>
in the flags parameter in order to avoid this open check and forcefully
program the bitstream.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaReconfigureSlot</span><span class="p">(</span><span class="n">fpga_handle</span><span class="w"> </span><span class="n">fme_handle</span><span class="p">,</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">slot</span><span class="p">,</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">bitstream</span><span class="p">,</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kt">size_t</span><span class="w"> </span><span class="n">bitstream_len</span><span class="p">,</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 10 fpgaReconfigureSlot()</p>

<h4 id="217-errors"><strong>2.1.7 Errors</strong><a class="headerlink" href="#217-errors" title="Permanent link">&para;</a></h4>
<p>The OPAE errors API provides a means to query and clear both
FPGA_DEVICE and FPGA_ACCELERATOR errors. Each FPGA device exports a
collection of error registers via the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers’ sysfs tree, for both
the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> and the Port. Each register is typically an unsigned 64-bit mask
of the current errors, where each bit or some collection of bits
specifies an error type. An error is signaled if its bit or collection
of bits is non-zero. Note that the 32-bit error index may vary from one
process execution to the next. Applications should use
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/error.h#L91-L106">fpgaGetErrorInfo</a>()
and examine the error name returned in the struct
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L162-L172">fpga_error_info</a>
to identify the desired 64-bit error mask.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">fpga_error_info</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="kt">char</span><span class="w"> </span><span class="n">name</span><span class="p">[</span><span class="n">FPGA_ERROR_NAME_MAX</span><span class="p">];</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="kt">bool</span><span class="w"> </span><span class="n">can_clear</span><span class="p">;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="p">};</span>
</code></pre></div>
<p align = "center">Figure 11 struct fpga_error_info</p>

<p>Each 64-bit mask of errors is assigned a unique 32-bit integer index and
a unique name. Given an fpga_token and an error index,
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/error.h#L91-L106">fpgaGetErrorInfo</a>()
retrieves the struct
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L162-L172">fpga_error_info</a>
corresponding to the error.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaGetErrorInfo</span><span class="p">(</span><span class="n">fpga_token</span><span class="w"> </span><span class="n">token</span><span class="p">,</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">error_num</span><span class="p">,</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">fpga_error_info</span><span class="w"> </span><span class="o">*</span><span class="n">error_info</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 12 fpgaGetErrorInfo()</p>

<p><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/error.h#L46-L60">fpgaReadError</a>()
provides access to the raw 64-bit error mask, given the unique error
index.
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/error.h#L62-L75">fpgaClearError</a>()
clears the errors for a particular index.
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/error.h#L77-L89">fpgaClearAllErrors</a>()
clears all the errors for the given fpga_token.</p>
<h4 id="218-metrics"><strong>2.1.8 Metrics</strong><a class="headerlink" href="#218-metrics" title="Permanent link">&para;</a></h4>
<p>The OPAE metrics API refers to a group of functions and data structures
that allow querying the various device metrics from the Board Management
Controller component of the FPGA device. A metric is described by an
instance of struct
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L208-L221">fpga_metric_info</a>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">fpga_metric_info</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">metric_num</span><span class="p">;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">fpga_guid</span><span class="w"> </span><span class="n">metric_guid</span><span class="p">;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="kt">char</span><span class="w"> </span><span class="n">qualifier_name</span><span class="p">[</span><span class="n">FPGA_METRIC_STR_SIZE</span><span class="p">];</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="kt">char</span><span class="w"> </span><span class="n">group_name</span><span class="p">[</span><span class="n">FPGA_METRIC_STR_SIZE</span><span class="p">];</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="kt">char</span><span class="w"> </span><span class="n">metric_name</span><span class="p">[</span><span class="n">FPGA_METRIC_STR_SIZE</span><span class="p">];</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="kt">char</span><span class="w"> </span><span class="n">metric_units</span><span class="p">[</span><span class="n">FPGA_METRIC_STR_SIZE</span><span class="p">];</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_metric_datatype</span><span class="w"> </span><span class="n">metric_datatype</span><span class="p">;</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_metric_type</span><span class="w"> </span><span class="n">metric_type</span><span class="p">;</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="p">}</span><span class="w"> </span><span class="n">fpga_metric_info</span><span class="p">;</span>
</code></pre></div>
Relevant Links: 
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L200-L210">fpga_metric_datatype</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L188-L198">fpga_metric_type</a></p>
<p align = "center">Figure 13 fpga_metric_info</p>

<p>The group_name field holds a string describing the broad categorization
of the metric. Some sample values for group_name are “thermal_mgmt”
and “power_mgmt”. The metric_name field contains the metric’s name.
The number and names of metrics may vary from one FPGA platform to the
next. The qualifier_name field is a concatenation of group_name and
metric_name, with a colon character in between. The metric_units field
contains the string name of the unit of measurement for the specific
metric. Some examples for metric_units are “Volts”, “Amps”, and
“Celsius”.</p>
<p>The metric_datatype field uniquely identifies the underlying C data
type for the metric’s value:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_metric_datatype</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">FPGA_METRIC_DATATYPE_INT</span><span class="p">,</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">FPGA_METRIC_DATATYPE_FLOAT</span><span class="p">,</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">FPGA_METRIC_DATATYPE_DOUBLE</span><span class="p">,</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">FPGA_METRIC_DATATYPE_BOOL</span><span class="p">,</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">FPGA_METRIC_DATATYPE_UNKNOWN</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="p">};</span>
</code></pre></div>
<p align = "center">Figure 14 enum fpga_metric_datatype</p>

<p>The metric_type field classifies the metric into a broad category. This
information is redundant with the group_name field.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_metric_type</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">FPGA_METRIC_TYPE_POWER</span><span class="p">,</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">FPGA_METRIC_TYPE_THERMAL</span><span class="p">,</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">FPGA_METRIC_TYPE_PERFORMANCE_CTR</span><span class="p">,</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="n">FPGA_METRIC_TYPE_AFU</span><span class="p">,</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="n">FPGA_METRIC_TYPE_UNKNOWN</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="p">};</span>
</code></pre></div>
<p align = "center">Figure 15 enum fpga_metric_type</p>

<p>In order to enumerate the information for each of the metrics available
from the FPGA device, determine the number of metrics using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/metrics.h#L45-L57">fpgaGetNumMetrics</a>().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">num_metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">fpgaGetNumMetrics</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num_metrics</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 16 Determining Number of Metrics</p>

<p>This call retrieves the number of available metrics for the FPGA_DEVICE
that is opened behind the handle parameter to the call. Refer to 2.1.3
Access for information about the fpgaOpen() call. When the number of
available metrics is known, allocate a buffer large enough to hold that
many
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L208-L221">fpga_metric_info</a>
data structures, and call
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/metrics.h#L59-L75">fpgaGetMetricsInfo</a>()
to populate the entries:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">fpga_metric_info</span><span class="w"> </span><span class="o">*</span><span class="n">metric_info</span><span class="p">;</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">metric_infos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_metrics</span><span class="p">;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">metric_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calloc</span><span class="p">(</span><span class="n">num_metrics</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">fpga_metric_info</span><span class="p">));</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">fpgaGetMetricsInfo</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">metric_info</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">metric_infos</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 17 Querying Metrics Info</p>

<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L223-L231">fpga_metric</a>
structure is the representation of a metric’s value:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">fpga_metric</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">metric_num</span><span class="p">;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">metric_value</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="kt">bool</span><span class="w"> </span><span class="n">isvalid</span><span class="p">;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="p">}</span><span class="w"> </span><span class="n">fpga_metric</span><span class="p">;</span>
</code></pre></div>
Relevant Links:
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L196-L205">metric_value</a></p>
<p align = "center">Figure 18 struct fpga_metric</p>

<p>The metric_num field matches the metric_num field of the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L208-L221">fpga_metric_info</a>
structure. value contains the metric value, which is encoded in the C
data type identified by the metric_datatype field of
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L208-L221">fpga_metric_info</a>.
Finally, the isvalid field denotes whether the metric value is valid.</p>
<p>There are two methods of obtaining a metric’s value, given the
information in the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L208-L221">fpga_metric_info</a>
structure:</p>
<h5 id="2181-querying-metric-values-by-index"><strong>2.1.8.1 Querying Metric Values by Index</strong><a class="headerlink" href="#2181-querying-metric-values-by-index" title="Permanent link">&para;</a></h5>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/metrics.h#L77-L94">fpgaGetMetricsByIndex</a>()
retrieves a metric value using the metric_num field of the metric info:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">metric_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metric_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">metric_num</span><span class="p">;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">fpga_metric</span><span class="w"> </span><span class="n">metric0</span><span class="p">;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">fpgaGetMetricsByIndex</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">metric_num</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">metric0</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 19 Retrieve Metric by Index</p>

<p>This call allows retrieving one or more metric values, each identified
by their unique metric_num. The second and fourth parameters allow
passing arrays so that multiple values can be fetched in a single call.</p>
<h5 id="2182-querying-metric-values-by-name"><strong>2.1.8.2 Querying Metric Values by Name</strong><a class="headerlink" href="#2182-querying-metric-values-by-name" title="Permanent link">&para;</a></h5>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/metrics.h#L96-L112">fpgaGetMetricsByName</a>()
retrieves a metric value using the metric_name field of the metric
info:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">metric_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metric_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">metric_name</span><span class="p">;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">fpga_metric</span><span class="w"> </span><span class="n">metric1</span><span class="p">;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">fpgaGetMetricsByName</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">metric_name</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">metric1</span><span class="p">);</span>
</code></pre></div>
<p>This call also allows retrieving one or more metric values, each
identified by their unique metric_name. The second and fourth
parameters allow passing arrays so that multiple values can be fetched
in a single call.</p>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/metrics.h#L115-L133">fpgaGetMetricsThresholdInfo</a>()
call is provided for legacy implementations only. It should be
considered deprecated for current and future FPGA designs.</p>
<h4 id="219-sysobject"><strong>2.1.9 SysObject</strong><a class="headerlink" href="#219-sysobject" title="Permanent link">&para;</a></h4>
<p>When the hardware access method in use is the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers (see 2.3.2
libxfpga Plugin), the sysfs tree rooted at the struct _fpga_token’s
sysfspath member is accessible via the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> SysObject API. The
SysObject API provides an abstraction to search, traverse, read, and
write sysfs entities. These sysfs entities may take the form of
directories, which are referred to as containers, or files, which are
referred to as attributes. Figure 20 enum fpga_sysobject_type shows
the API’s means of distinguishing between the two types.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_sysobject_type</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">FPGA_OBJECT_CONTAINER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1u</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="n">FPGA_OBJECT_ATTRIBUTE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1u</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="p">};</span>
</code></pre></div>
<p align = "center">Figure 20 enum fpga_sysobject_type</p>

<p>The SysObject API introduces another opaque structure type,
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L174-L189">fpga_object</a>.
An
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L174-L189">fpga_object</a>
can be queried from an fpga_token or an fpga_handle by way of the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L42-L67">fpgaTokenGetObject</a>()
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L69-L94">fpgaHandleGetObject</a>()
API’s.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaTokenGetObject</span><span class="p">(</span><span class="n">fpga_token</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">fpga_object</span><span class="w"> </span><span class="o">*</span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaHandleGetObject</span><span class="p">(</span><span class="n">fpga_handle</span><span class="w"> </span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">fpga_object</span><span class="w"> </span><span class="o">*</span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 21 fpgaTokenGetObject() / fpgaHandleGetObject()</p>

<p>The remainder of the SysObject API is broken into two categories of
calls, depending on the fpga_object’s type. The type of an fpga_object
is learned via
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L145-L155">fpgaObjectGetType</a>().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectGetType</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_sysobject_type</span><span class="w"> </span><span class="o">*</span><span class="n">type</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 22 fpgaObjectGetType()</p>

<p>When an fpga_object is no longer needed, it should be freed via
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L157-L170">fpgaDestroyObject</a>().</p>
<h5 id="2191-fpga_object_container-apis"><strong>2.1.9.1 FPGA_OBJECT_CONTAINER API’s</strong><a class="headerlink" href="#2191-fpga_object_container-apis" title="Permanent link">&para;</a></h5>
<p>For directory sysfs entities, passing a value of
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L172">FPGA_OBJECT_RECURSE_ONE</a>
or
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L175">FPGA_OBJECT_RECURSE_ALL</a>
in the flags parameter to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L42-L67">fpgaTokenGetObject</a>()
or
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L69-L94">fpgaHandleGetObject</a>()
causes these two API’s to treat the target object as either a
single-layer or multi-layer directory structure, making its child
entities available for query via
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L96-L124">fpgaObjectGetObject</a>()
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L126-L144">fpgaObjectGetObjectAt</a>().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectGetObject</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">fpga_object</span><span class="w"> </span><span class="o">*</span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectGetObjectAt</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">idx</span><span class="p">,</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="n">fpga_object</span><span class="w"> </span><span class="o">*</span><span class="n">object</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 23 fpgaObjectGetObject() / fpgaObjectGetObjectAt()</p>

<p>Any child object resulting from
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L96-L124">fpgaObjectGetObject</a>()
or
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L126-L144">fpgaObjectGetObjectAt</a>()
must be freed via
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L157-L170">fpgaDestroyObject</a>()
when it is no longer needed.</p>
<h5 id="2192-fpga_object_attribute-apis"><strong>2.1.9.2 FPGA_OBJECT_ATTRIBUTE API’s</strong><a class="headerlink" href="#2192-fpga_object_attribute-apis" title="Permanent link">&para;</a></h5>
<p>Attribute sysfs entities may be queried for their size and read from or
written to. In order to determine the size of an attribute’s data, use
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L172-L184">fpgaObjectGetSize</a>().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectGetSize</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 24 fpgaObjectGetSize()</p>

<p>Attributes containing arbitrary string data can be read with
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L186-L202">fpgaObjectRead</a>().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectRead</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="kt">size_t</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 25 fpgaObjectRead()</p>

<p>If an attribute contains an unsigned integer value, its value can be
read with
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L204-L219">fpgaObjectRead64</a>()
and written with
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/sysobject.h#L221-L236">fpgaObjectWrite64</a>().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectRead64</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">fpga_result</span><span class="w"> </span><span class="nf">fpgaObjectWrite64</span><span class="p">(</span><span class="n">fpga_object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 26 fpgaObjectRead64() / fpgaObjectWrite64()</p>

<h4 id="2110-utilities"><strong>2.1.10 Utilities</strong><a class="headerlink" href="#2110-utilities" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L38-L69">fpga_result</a>
enumeration defines a set of error codes used throughout OPAE. In order
to convert an
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types_enum.h#L38-L69">fpga_result</a>
error code into a printable string, the application can use the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/utils.h#L42-L51">fpgaErrStr()</a>
call.</p>
<h3 id="22-dfl-driver-ioctl-interfaces"><strong>2.2 <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> Driver <abbr title="Input/Output Control, System calls used to manipulate underlying device parameters of special files.">IOCTL</abbr> Interfaces</strong><a class="headerlink" href="#22-dfl-driver-ioctl-interfaces" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers export an <abbr title="Input/Output Control, System calls used to manipulate underlying device parameters of special files.">IOCTL</abbr> interface which the libxfpga.so plugin
consumes in order to query and configure aspects of the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> and Port.
These interfaces are used only internally by the SDK; they are not
customer-facing. The description here is provided for completeness only.</p>
<h4 id="221-port-reset"><strong>2.2.1 Port Reset</strong><a class="headerlink" href="#221-port-reset" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L70-L80"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_RESET</a>
ioctl is used by the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L90-L102">fpgaReset()</a>
call in order to perform a Port reset. The fpga_handle passed to
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L90-L102">fpgaReset()</a>
must be a valid open handle to an FPGA_ACCELERATOR. The ioctl requires
no input/output parameters.</p>
<p>Note: <code>fpgaReset()</code> will always reset the entire <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region of a device, and will not accept <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr> devices as an input argument. If you wish to issue a reset on the currently loaded <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> only, use the <code>fpgaEnmuerate()</code> function instead.</p>
<h4 id="222-port-information"><strong>2.2.2 Port Information</strong><a class="headerlink" href="#222-port-information" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L82-L99"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_GET_INFO</a>
ioctl is used to query properties of the Port, notably the number of
associated <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> regions. The ioctl requires a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L90-L97">dfl_fpga_port_info</a>.</p>
<h4 id="223-mmio-region-information"><strong>2.2.3 <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Region Information</strong><a class="headerlink" href="#223-mmio-region-information" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L101-L128"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_GET_REGION_INFO</a>
ioctl is used to query the details of an <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region. The ioctl requires
a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L110-L126">dfl_fpga_port_region_info</a>.
The index field of the struct is populated by the caller, and the
padding, size, and offset values are populated by the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver.</p>
<h4 id="224-shared-memory-mapping-and-unmapping"><strong>2.2.4 Shared Memory Mapping and Unmapping</strong><a class="headerlink" href="#224-shared-memory-mapping-and-unmapping" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L130-L149"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_DMA_MAP</a>
ioctl is used to map a memory buffer into the application’s process
address space. The ioctl requires a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L139-L147">dfl_fpga_port_dma_map</a>.</p>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L151-L165"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_DMA_UNMAP</a>
ioctl is used to unmap a memory buffer from the application’s process
address space. The ioctl requires a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L158-L163">dfl_fpga_port_dma_unmap</a>.</p>
<p>These ioctls provide the underpinnings of the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L55-L99">fpgaPrepareBuffer()</a>
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L101-L115">fpgaReleaseBuffer()</a>
calls.</p>
<h4 id="225-number-of-port-error-irqs"><strong>2.2.5 Number of Port Error IRQs</strong><a class="headerlink" href="#225-number-of-port-error-irqs" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L180-L189"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_ERR_GET_IRQ_NUM</a>
ioctl is used to query the number of Port error interrupt vectors
available. The ioctl requires a pointer to a uint32_t that receives the
Port error interrupt count.</p>
<h4 id="226-port-error-interrupt-configuration"><strong>2.2.6 Port Error Interrupt Configuration</strong><a class="headerlink" href="#226-port-error-interrupt-configuration" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L191-L201"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_ERR_SET_IRQ</a>
ioctl is used to configure one or more file descriptors for the Port
Error interrupt. The ioctl requires a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L167-L178">dfl_fpga_irq_set</a>.
The values stored in the evtfds field of this struct should be populated
with the event file descriptors for the interrupt, as returned by the
eventfd() C standard library API.</p>
<h4 id="227-number-of-afu-interrupts"><strong>2.2.7 Number of <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interrupts</strong><a class="headerlink" href="#227-number-of-afu-interrupts" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L203-L212"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_UINT_GET_IRQ_NUM</a>
ioctl is used to query the number of <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> interrupt vectors available.
The ioctl requires a pointer to a uint32_t that receives the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>
interrupt count.</p>
<h4 id="228-user-afu-interrupt-configuration"><strong>2.2.8 User <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interrupt Configuration</strong><a class="headerlink" href="#228-user-afu-interrupt-configuration" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L214-L224"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_PORT_UINT_SET_IRQ</a>
ioctl is used to configure one or more file descriptors for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>
interrupt. The ioctl requires a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L167-L178">dfl_fpga_irq_set</a>.
The values stored in the evtfds field of this struct should be populated
with the event file descriptors for the interrupt, as returned by the
eventfd() C standard library API.</p>
<h4 id="229-partial-reconfiguration"><strong>2.2.9 Partial Reconfiguration</strong><a class="headerlink" href="#229-partial-reconfiguration" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L228-L249"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>_PORT_<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr></a>
ioctl is used to update the logic stored in the Port’s programmable
region. This ioctl must be issued on the device file descriptor
corresponding to the FPGA_DEVICE (/dev/dfl-fme.X). The ioctl requires a
pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L240-L247">dfl_fpga_fme_port_pr</a>
with each of the fields populated.</p>
<h4 id="2210-number-of-fme-error-irqs"><strong>2.2.10 Number of <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Error IRQs</strong><a class="headerlink" href="#2210-number-of-fme-error-irqs" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L269-L278"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>_ERR_GET_IRQ_NUM</a>
ioctl is used to query the number of <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error interrupt vectors
available. The ioctl requires a pointer to a uint32_t that receives the
<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> error interrupt count.</p>
<h4 id="2211-fme-error-interrupt-configuration"><strong>2.2.11 <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Error Interrupt Configuration</strong><a class="headerlink" href="#2211-fme-error-interrupt-configuration" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L280-L290"><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>_FPGA_<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>_ERR_SET_IRQ</a>
ioctl is used to configure one or more file descriptors for the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>
Error interrupt. The ioctl requires a pointer to a struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/fpga-dfl.h#L167-L178">dfl_fpga_irq_set</a>.
The values stored in the evtfds field of this struct should be populated
with the event file descriptors for the interrupt, as returned by the
eventfd() C standard library API.
as returned by the eventfd() C standard library API.</p>
<h3 id="23-plugin-manager"><strong>2.3 Plugin Manager</strong><a class="headerlink" href="#23-plugin-manager" title="Permanent link">&para;</a></h3>
<p>The OPAE Plugin Manager refers to initialization code in libopae-c that
examines an FPGA device’s PCIe Vendor and Device ID and makes an
association between a particular FPGA device and its access method. OPAE
currently supports three device access methods:</p>
<table>
<tbody>
<tr class="odd">
<td><blockquote>
<p><strong>Access Method</strong></p>
</blockquote></td>
<td><blockquote>
<p><strong>Plugin Module</strong></p>
</blockquote></td>
</tr>
<tr class="even">
<td>Device Feature List drivers</td>
<td>libxfpga.so</td>
</tr>
<tr class="odd">
<td>Virtual Function I/O</td>
<td>libopae-v.so</td>
</tr>
<tr class="even">
<td>AFU Simulation Environment</td>
<td>libase.so</td>
</tr>
</tbody>
</table>

<p align = "center">Table 9 Plugin Device Access Methods</p>

<p>The Plugin Manager allows code that is written to a specific API
signature to access FPGA hardware via different mechanisms. In other
words, the end user codes to the OPAE API; and the OPAE API, based on
configuration data, routes the hardware access to the device via
different means.</p>
<p>As an example, consider an API configuration that accesses FPGA
device_A via the Device Feature List drivers and that accesses FPGA
device_B via <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr>. The application is coded against the OPAE API.</p>
<p>As part of its initialization process, the application enumerates and
discovers an fpga_token corresponding to device_A. That fpga_token is
opened and its <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region 0 is mapped via a call to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L577-L589">fpgaMapMMIO</a>().</p>
<p>The API configuration for device_A is such that the fpga_handle
corresponding to device_A routes its hardware access calls through
libxfpga.so. The call to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L577-L589">fpgaMapMMIO</a>()
is redirected to libxfpga.so’s implementation of the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> mapping
function,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/mmio.c#L374-L401">xfpga_fpgaMapMMIO</a>().
As a result, the call to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/mmio.c#L374-L401">xfpga_fpgaMapMMIO</a>()
uses its <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/mmio.c#L71"><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> file
descriptor</a>
to communicate with the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver to map the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region.</p>
<p>Subsequently, the application enumerates and discovers an fpga_token
corresponding to device_B. That fpga_token is opened and its <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>
region 0 is mapped via a call to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L577-L589">fpgaMapMMIO</a>().</p>
<p>The API configuration for device_B is such that the fpga_handle
corresponding to device_B routes its hardware access calls through
libopae-v.so. The call to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L577-L589">fpgaMapMMIO</a>()
is redirected to libopae-v.so’s implementation of the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> mapping
function,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.c#L996-L1014">vfio_fpgaMapMMIO</a>().
As a result, the call to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.c#L996-L1014">vfio_fpgaMapMMIO</a>()
uses the <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.c#L843-L850"><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>
mapping</a>
performed by libopaevfio.so during initialization of the <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr> session.</p>
<h4 id="231-plugin-model"><strong>2.3.1 Plugin Model</strong><a class="headerlink" href="#231-plugin-model" title="Permanent link">&para;</a></h4>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> plugin model is facilitated by its use of opaque C
structures for
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L94-L107">fpga_token</a>
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L109-L120">fpga_handle</a>.
These types are both declared as void *; and this allows the parameters
to the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> functions to take different forms, depending on the
layer of the SDK being used.</p>
<p>At the topmost layer, for example when calling
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L685-L821">fpgaEnumerate</a>(),
the output fpga_token parameter array is actually an array of pointers
to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/opae_int.h#L102-L109">opae_wrapped_token</a>
struct’s.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_wrapped_token</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">magic</span><span class="p">;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">fpga_token</span><span class="w"> </span><span class="n">opae_token</span><span class="p">;</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ref_count</span><span class="p">;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_wrapped_token</span><span class="w"> </span><span class="o">*</span><span class="n">prev</span><span class="p">;</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_wrapped_token</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="p">;</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="n">opae_api_adapter_table</span><span class="w"> </span><span class="o">*</span><span class="n">adapter_table</span><span class="p">;</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="p">}</span><span class="w"> </span><span class="n">opae_wrapped_token</span><span class="p">;</span>
</code></pre></div>
<p align = "center">Figure 27 opae_wrapped_token</p>

<p>An
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/opae_int.h#L102-L109">opae_wrapped_token</a>,
as the name suggests, is a thin wrapper around the lower-layer token
which is stored in struct member opae_token. The
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/adapter.h#L38-L220">adapter_table</a>
struct member is a pointer to a plugin-specific adapter table. The
adapter table provides a mapping between the top-layer
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/opae_int.h#L102-L109">opae_wrapped_token</a>
and its underlying plugin-specific API entry points, which are called
using the opae_token struct member (the lower-level token).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_api_adapter_table</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_api_adapter_table</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="p">;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="n">opae_plugin</span><span class="w"> </span><span class="n">plugin</span><span class="p">;</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="p">...</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="n">fpga_result</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fpgaEnumerate</span><span class="p">)(</span><span class="k">const</span><span class="w"> </span><span class="n">fpga_properties</span><span class="w"> </span><span class="o">*</span><span class="n">filters</span><span class="p">,</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_filters</span><span class="p">,</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="n">fpga_token</span><span class="w"> </span><span class="o">*</span><span class="n">tokens</span><span class="p">,</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">max_tokens</span><span class="p">,</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">num_matches</span><span class="p">);</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="p">...</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">initialize</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">finalize</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="p">}</span><span class="w"> </span><span class="n">opae_api_adapter_table</span><span class="p">;</span>
</code></pre></div>
<p align = "center">Figure 28 opae_api_adapter_table</p>

<p>When libopae-c loads, the plugin manager uses the plugin configuration
data to open and configure a session to each of the required plugin
libraries. During this configuration process, each plugin is passed an
empty adapter table struct. The purpose of the plugin configuration is
to populate this adapter table struct with each of the plugin-specific
API entry points.</p>
<p>When the top-level
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L685-L821">fpgaEnumerate</a>()
is called, each adapter table’s plugin-specific fpgaEnumerate() struct
member is called; and the output fpga_token’s are collected. At this
point, these fpga_token’s are the lower-level token structure types.
Before the top-level
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L685-L821">fpgaEnumerate</a>()
returns, these plugin-specific tokens are wrapped inside
opae_wrapped_token structures, along with a pointer to the respective
adapter table.</p>
<p>After enumeration is complete, the application goes on to call other
top-level <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> functions with the wrapped tokens. Each top-level
entry point which accepts an fpga_token knows that it is actually being
passed an
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/opae_int.h#L102-L109">opae_wrapped_token</a>.
With this knowledge, the entry point peeks inside the wrapped token and
calls through to the plugin-specific API entry point using the adapter
table, passing the lower-level opae_token struct member.</p>
<h4 id="232-libxfpga-plugin"><strong>2.3.2 libxfpga Plugin</strong><a class="headerlink" href="#232-libxfpga-plugin" title="Permanent link">&para;</a></h4>
<p>2.3.1 Plugin Model introduced the concept of an
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/opae_int.h#L102-L109">opae_wrapped_token</a>
and a corresponding plugin-specific token structure. libxfpga.so is the
plugin library that implements the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver hardware access method.
Its plugin-specific token data structure is struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/types_int.h#L101-L108">_fpga_token</a>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_fpga_token</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">fpga_token_header</span><span class="w"> </span><span class="n">hdr</span><span class="p">;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">device_instance</span><span class="p">;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">subdev_instance</span><span class="p">;</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="kt">char</span><span class="w"> </span><span class="n">sysfspath</span><span class="p">[</span><span class="n">SYSFS_PATH_MAX</span><span class="p">];</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="kt">char</span><span class="w"> </span><span class="n">devpath</span><span class="p">[</span><span class="n">DEV_PATH_MAX</span><span class="p">];</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="k">struct</span><span class="w"> </span><span class="nc">error_list</span><span class="w"> </span><span class="o">*</span><span class="n">errors</span><span class="p">;</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="p">};</span>
</code></pre></div>
Relevant Links:
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L255-L276">fpga_token_header</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/error_int.h#L38-L43">error_list</a></p>
<p align = "center">Figure 29 struct _fpga_token</p>

<p>A struct _fpga_token corresponding to the Port will have sysfspath and
devpath members that contain strings like the following example paths:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>sysfspath:<span class="w"> </span>“/sys/class/fpga_region/region0/dfl-port.0”
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>devpath:<span class="w"> </span>“/dev/dfl-port.0”
</code></pre></div>
<p align = "center">Figure 30 libxfpga Port Token</p>

<p>Likewise, a struct _fpga_token corresponding to the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> will have
sysfspath and devpath members that contain strings like the following
example paths:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>sysfspath:<span class="w"> </span>“/sys/class/fpga_region/region0/dfl-fme.0”
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>devpath:<span class="w"> </span>“/dev/dfl-fme.0”
</code></pre></div>
<p align = "center">Figure 31 libxfpga FME Token</p>

<p>When a call to the top-level
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L272-L307">fpgaOpen</a>()
is made, the lower-level token is unwrapped and passed to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/open.c#L41-L172">xfpga_fpgaOpen</a>().
In return,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/open.c#L41-L172">xfpga_fpgaOpen</a>()
opens the character device file identified by the devpath member of the
struct _fpga_token. It then allocates and initializes an instance of
libxfpga.so’s plugin-specific handle data structure, struct
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/types_int.h#L153-L177">_fpga_handle</a>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_fpga_handle</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">pthread_mutex_t</span><span class="w"> </span><span class="n">lock</span><span class="p">;</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">magic</span><span class="p">;</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="n">fpga_token</span><span class="w"> </span><span class="n">token</span><span class="p">;</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">fddev</span><span class="p">;</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="kt">int</span><span class="w"> </span><span class="n">fdfpgad</span><span class="p">;</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_irqs</span><span class="p">;</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">irq_set</span><span class="p">;</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="k">struct</span><span class="w"> </span><span class="nc">wsid_tracker</span><span class="w"> </span><span class="o">*</span><span class="n">wsid_root</span><span class="p">;</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="k">struct</span><span class="w"> </span><span class="nc">wsid_tracker</span><span class="w"> </span><span class="o">*</span><span class="n">mmio_root</span><span class="p">;</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">umsg_virt</span><span class="p">;</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">umsg_size</span><span class="p">;</span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">umsg_iova</span><span class="p">;</span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="kt">bool</span><span class="w"> </span><span class="n">metric_enum_status</span><span class="p">;</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="n">fpga_metric_vector</span><span class="w"> </span><span class="n">fpga_enum_metric_vector</span><span class="p">;</span>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">bmc_handle</span><span class="p">;</span>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_fpga_bmc_metric</span><span class="w"> </span><span class="o">*</span><span class="n">_bmc_metric_cache_value</span><span class="p">;</span>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">num_bmc_metric</span><span class="p">;</span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">flags</span><span class="p">;</span>
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="p">};</span>
</code></pre></div>
Relevant Links:
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/types_int.h#L205-L211">wsid_tracker</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/metrics/vector.h#L45-L49">fpga_metric_vector</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/xfpga/types_int.h#L146-L151">_fpga_bmc_metric</a></p>
<p align = "center">Figure 32 struct _fpga_handle</p>

<h4 id="233-libopae-v-plugin"><strong>2.3.3 libopae-v Plugin</strong><a class="headerlink" href="#233-libopae-v-plugin" title="Permanent link">&para;</a></h4>
<p>libopae-v.so is the plugin library that implements the <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr> hardware
access method. Its plugin-specific token data structure is
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.h#L98-L115">vfio_token</a>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="cp">#define USER_MMIO_MAX 8</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_vfio_token</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="n">fpga_token_header</span><span class="w"> </span><span class="n">hdr</span><span class="p">;</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="n">fpga_guid</span><span class="w"> </span><span class="n">compat_id</span><span class="p">;</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="n">pci_device_t</span><span class="w"> </span><span class="o">*</span><span class="n">device</span><span class="p">;</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">region</span><span class="p">;</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">mmio_size</span><span class="p">;</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">pr_control</span><span class="p">;</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">user_mmio_count</span><span class="p">;</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">user_mmio</span><span class="p">[</span><span class="n">USER_MMIO_MAX</span><span class="p">];</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">bitstream_id</span><span class="p">;</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">bitstream_mdata</span><span class="p">;</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="kt">uint8_t</span><span class="w"> </span><span class="n">num_ports</span><span class="p">;</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_vfio_token</span><span class="w"> </span><span class="o">*</span><span class="n">parent</span><span class="p">;</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_vfio_token</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="p">;</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="n">vfio_ops</span><span class="w"> </span><span class="n">ops</span><span class="p">;</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="p">}</span><span class="w"> </span><span class="n">vfio_token</span><span class="p">;</span>
</code></pre></div>
Relevant Links:
- <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/types.h#L255-L276">fpga_token_header</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.h#L83-L92">pci_device_t</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.h#L94-L96">vfio_ops</a></p>
<p align = "center">Figure 33 vfio_token</p>

<p>When a call to the top-level
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopae-c/api-shell.c#L272-L307">fpgaOpen</a>()
is made, the lower-level token is unwrapped and passed to
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.c#L603-L681">vfio_fpgaOpen</a>().
In return,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.c#L603-L681">vfio_fpgaOpen</a>()
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.c#L645">opens the <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr>
device</a>
matching the device address found in the input vfio_token. It then
allocates and initializes an instance of libopae-v.so’s plugin-specific
handle data structure,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.h#L124-L134">vfio_handle</a>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_vfio_handle</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">magic</span><span class="p">;</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">_vfio_token</span><span class="w"> </span><span class="o">*</span><span class="n">token</span><span class="p">;</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="n">vfio_pair_t</span><span class="w"> </span><span class="o">*</span><span class="n">vfio_pair</span><span class="p">;</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="k">volatile</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">mmio_base</span><span class="p">;</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="kt">size_t</span><span class="w"> </span><span class="n">mmio_size</span><span class="p">;</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="n">pthread_mutex_t</span><span class="w"> </span><span class="n">lock</span><span class="p">;</span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="cp">#define OPAE_FLAG_HAS_AVX512 (1u &lt;&lt; 0)</span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">flags</span><span class="p">;</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="p">}</span><span class="w"> </span><span class="n">vfio_handle</span><span class="p">;</span>
</code></pre></div>
Relevant Links:
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.h#L98-L115">vfio_token</a>
- <a href="https://github.com/OFS/opae-sdk/blob/master/libraries/plugins/vfio/opae_vfio.h#L118-L122">vfio_pair_t</a></p>
<p align = "center">Figure 34 vfio_handle</p>

<h5 id="2331-supporting-libraries"><strong>2.3.3.1 Supporting Libraries</strong><a class="headerlink" href="#2331-supporting-libraries" title="Permanent link">&para;</a></h5>
<h6 id="23311-libopaevfio"><strong>2.3.3.1.1 libopaevfio</strong><a class="headerlink" href="#23311-libopaevfio" title="Permanent link">&para;</a></h6>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/vfio.h">libopaevfio.so</a>
is OPAE’s implementation of the Linux kernel’s Virtual Function I/O
interface. This <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr> interface presents a generic means of configuring
and accessing PCIe endpoints from a user-space process via a supporting
Linux kernel device driver, vfio-pci.</p>
<p>libopaevfio.so provides APIs for opening/closing a <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr> device instance,
for mapping/unmapping <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> spaces, for allocating/freeing DMA buffers,
and for configuring interrupts for the device.</p>
<h6 id="23312-libopaemem"><strong>2.3.3.1.2 libopaemem</strong><a class="headerlink" href="#23312-libopaemem" title="Permanent link">&para;</a></h6>
<p>Each DMA buffer allocation made by libopaevfio.so’s
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/vfio.h#L333-L336">opae_vfio_buffer_allocate</a>()
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/vfio.h#L394-L398">opae_vfio_buffer_allocate_ex</a>()
APIs requires a backing I/O Virtual Address range. These address ranges
are discovered at <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr> device open time by way of the
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/libopaevfio/opaevfio.c#L543"><abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr>_IOMMU_GET_INFO</a>
ioctl.</p>
<p>Each range specifies a large contiguous block of I/O Virtual Address
space. The typical DMA buffer allocation size is significantly less than
one of these IOVA blocks, so the division of each block into allocatable
segments must be managed so that multiple DMA buffer allocations can be
made from a single block. In other words, the IOVA blocks must be
memory-managed in order to make efficient use of them.</p>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mem_alloc.h">libopaemem.so</a>
provides a generic means of managing a large memory space, consisting of
individual large memory blocks of contiguous address space. When a DMA
buffer allocation is requested, libopaevfio.so uses this generic memory
manager to carve out a small chunk of contiguous IOVA address space in
order for the DMA mapping to be made. The IOVA space corresponding to
the allocation is marked as allocated, and the rest of the large block
remains as allocatable space within the memory manager. Subsequent
de-allocation returns a chunk of IOVA space to the free state,
coalescing contiguous chunks as they are freed. The allocations and
de-allocations of the IOVA space can occur in any order with respect to
each other. libopaemem.so tracks both the allocated and free block
space, carving out small chunks from the large IOVA blocks on
allocations, and coalescing small chunks back into larger ones on frees.</p>
<h5 id="2332-configuring-pcie-virtual-functions"><strong>2.3.3.2 Configuring PCIe Virtual Functions</strong><a class="headerlink" href="#2332-configuring-pcie-virtual-functions" title="Permanent link">&para;</a></h5>
<p>Before an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> can be accessed with <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr>, the FPGA Physical Function must
be configured to enable its Virtual Functions. Then, each VF must be
bound to the vfio-pci Linux kernel driver.</p>
<p>As of the Arrow Creek program, the FPGA hardware allows multiple <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>’s
to co-exist by placing each <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in its own PCIe Virtual Function. Upon
system startup, no PCIe VF’s exist. The pci_device command can be used
to enable the VF’s and their <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>’s. First, use the lspci command to
examine the current device topology:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># lspci | grep cel</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>b1:00.0<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>b1:00.1<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>b1:00.2<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>b1:00.3<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>b1:00.4<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
</code></pre></div>
<p align = "center">Figure 35 lspci Device Topology</p>

<p>In this example, VF’s are controlled by PF 0, as highlighted in <a href="#figure-35">Figure
35 lspci Device Topology</a>. In the figure, each PF is shown as having the
Arrow Creek PF PCIe device ID of bcce.</p>
<p>Now, use the pci_device command to enable three VF’s for PF0:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># pci_device 0000:b1:00.0 vf 3</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="c1"># lspci | grep cel</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>b1:00.0<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>b1:00.1<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>b1:00.2<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>b1:00.3<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Red<span class="w"> </span>Hat,<span class="w"> </span>Inc.<span class="w"> </span>Virtio<span class="w"> </span>network<span class="w"> </span>device
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>b1:00.4<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>b1:00.5<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>b1:00.6<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>b1:00.7<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf
</code></pre></div>
<p align = "center">Figure 36 Enable Virtual Functions</p>

<p>Figure 20 Enable Virtual Functions shows that three VF’s were created.
Each VF is shown as having the Arrow Creek VF PCIe device ID of bccf.</p>
<p>Now, each Virtual Function must be bound to the vfio-pci Linux kernel
driver so that it can be accessed via <abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># opaevfio -i -u myuser -g mygroup 0000:b1:00.5</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.5<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.5<span class="w"> </span>is<span class="w"> </span><span class="m">318</span>
</code></pre></div>
<p align = "center">Figure 37 Bind VF's to vfio-pci</p>

<p>Here, myuser and mygroup identify the unprivileged user/group that
requires access to the device. The opaevfio command will change the
ownership of the device per the values given.</p>
<p>Once the VF’s are bound to vfio-pci, the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> will find and
enumerate them with libopae-v.so:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># fpgainfo port</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>Object<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xEF00000
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w"> </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.0
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>Device<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>Socket<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0x00
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>Object<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xE0B1000000000000
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w"> </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.7
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>Device<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>Socket<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0x01
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>Accelerator<span class="w"> </span>GUID<span class="w"> </span>:<span class="w"> </span>4dadea34-2c78-48cb-a3dc-5b831f5cecbb
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a>Object<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xC0B1000000000000
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w"> </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.6
<a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a>Device<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a>Socket<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0x01
<a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a>Accelerator<span class="w"> </span>GUID<span class="w"> </span>:<span class="w"> </span>823c334c-98bf-11ea-bb37-0242ac130002
<a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a>Object<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xA0B1000000000000
<a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w"> </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.5
<a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a>Device<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a>Socket<span class="w"> </span>Id<span class="w"> </span>:<span class="w"> </span>0x01
<a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a>Accelerator<span class="w"> </span>GUID<span class="w"> </span>:<span class="w"> </span>8568ab4e-6ba5-4616-bb65-2a578330a8eb
</code></pre></div>
<p align = "center">Figure 38 List VF's with fpgainfo</p>

<p>When the VF’s are no longer needed, they can be unbound from the
vfio-pci driver:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1"># opaevfio -r 0000:b1:00.5</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>Releasing<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.5<span class="w"> </span>from<span class="w"> </span>vfio-pci
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="c1"># opaevfio -r 0000:b1:00.6</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>Releasing<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.6<span class="w"> </span>from<span class="w"> </span>vfio-pci
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="c1"># opaevfio -r 0000:b1:00.7</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>Releasing<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.7<span class="w"> </span>from<span class="w"> </span>vfio-pci
</code></pre></div>
<p align = "center">Figure 39 Unbind VF's from vfio-pci</p>

<p>Finally, the VF’s can be disabled:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># pci_device 0000:b1:00.0 vf 0</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="c1"># lspci | grep cel</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>b1:00.0<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>b1:00.1<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>b1:00.2<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>b1:00.3<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Red<span class="w"> </span>Hat,<span class="w"> </span>Inc.<span class="w"> </span>Virtio<span class="w"> </span>network<span class="w"> </span>device
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>b1:00.4<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
</code></pre></div>
<p align = "center">Figure 40 Disable Virtual Functions</p>

<h3 id="24-application-flow"><strong>2.4 Application Flow</strong><a class="headerlink" href="#24-application-flow" title="Permanent link">&para;</a></h3>
<p>A typical OPAE application that interacts with an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> via <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> and
shared memory will have a flow similar to the one described in this
section.</p>
<h4 id="241-create-filter-criteria"><strong>2.4.1 Create Filter Criteria</strong><a class="headerlink" href="#241-create-filter-criteria" title="Permanent link">&para;</a></h4>
<p>Refer to 2.1.2 Enumeration. When enumerating <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>’s, if no filtering
criteria is specified, then
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L101-L103">fpgaEnumerate</a>()
returns fpga_token’s for each <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that is present in the system. In
order to limit the enumeration search to a specific <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, create an
fpga_properties object and set its guid to that of the desired <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="cp">#define MY_AFU_GUID “57fa0b03-ab4f-4b02-b4eb-d3fe1ec18518”</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">fpga_properties</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="n">fpga_guid</span><span class="w"> </span><span class="n">guid</span><span class="p">;</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="n">fpgaGetProperties</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">filter</span><span class="p">);</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="n">uuid_parse</span><span class="p">(</span><span class="n">MY_AFU_GUID</span><span class="p">,</span><span class="w"> </span><span class="n">guid</span><span class="p">);</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="n">fpgaPropertiesSetGUID</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="n">guid</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 41 Flow: Create Filter Criteria</p>

<h4 id="242-enumerate-the-afu"><strong>2.4.2 Enumerate the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#242-enumerate-the-afu" title="Permanent link">&para;</a></h4>
<p>With the filtering criteria in place, enumerate to obtain an fpga_token
for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">fpga_token</span><span class="w"> </span><span class="n">afu_token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="n">fpgaEnumerate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">afu_token</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num_matches</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 42 Flow: Enumerate the AFU</p>

<h4 id="243-open-the-afu"><strong>2.4.3 Open the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#243-open-the-afu" title="Permanent link">&para;</a></h4>
<p>After finding an fpga_token for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L101-L103">fpgaEnumerate</a>(),
the token must be opened with
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L72-L73">fpgaOpen</a>()
to establish a session with the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The process of opening an
fpga_token creates an fpga_handle:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">fpga_handle</span><span class="w"> </span><span class="n">afu_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="n">fpgaOpen</span><span class="p">(</span><span class="n">afu_token</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 43 Flow: Open the AFU</p>

<h4 id="244-map-mmio-region"><strong>2.4.4 Map <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Region</strong><a class="headerlink" href="#244-map-mmio-region" title="Permanent link">&para;</a></h4>
<p>In order to access the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to program its CSR’s, the
region must first be mapped into the application’s process address
space. This is accomplished using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mmio.h#L182-L183">fpgaMapMMIO</a>():</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kt">uint32_t</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="n">fpgaMapMMIO</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 44 Flow: Map MMIO Region</p>

<h4 id="245-allocate-dma-buffers"><strong>2.4.5 Allocate DMA Buffers</strong><a class="headerlink" href="#245-allocate-dma-buffers" title="Permanent link">&para;</a></h4>
<p>If the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is DMA-capable, shared memory buffers can be allocated and
mapped into the process address space and the IOMMU with
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L97-L99">fpgaPrepareBuffer</a>().
Refer to Figure 8 Configuring Huge Pages for instructions on configuring
2MiB and 1GiB huge pages.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="cp">#define BUF_SIZE (2 * 1024 * 1024)</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="k">volatile</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">src_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">src_wsid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="k">volatile</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">dest_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">dest_wsid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="n">fpgaPrepareBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">src_ptr</span><span class="p">,</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="o">&amp;</span><span class="n">src_wsid</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="n">fpgaPrepareBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dest_ptr</span><span class="p">,</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="o">&amp;</span><span class="n">dest_wsid</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="n">memset</span><span class="p">(</span><span class="n">src_ptr</span><span class="p">,</span><span class="w"> </span><span class="mh">0xaf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="n">memset</span><span class="p">(</span><span class="n">dest_ptr</span><span class="p">,</span><span class="w"> </span><span class="mh">0xbe</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 45 Flow: Allocate DMA Buffers</p>

<h4 id="246-make-afu-aware-of-dma-buffers"><strong>2.4.6 Make <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Aware of DMA Buffers</strong><a class="headerlink" href="#246-make-afu-aware-of-dma-buffers" title="Permanent link">&para;</a></h4>
<p>The process by which locations of shared memory buffers and their sizes
are made known to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is entirely <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>-specific. This example shows
the method used by the Native Loopback <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. Each buffer I/O virtual
address is cacheline-aligned and programmed into a unique <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSR; then
the buffer size in lines is programmed into a length CSR:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="cp">#define CSR_SRC_ADDR 0x000A </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="cp">#define CSR_DEST_ADDR 0x000B </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="cp">#define CSR_NUM_LINES 0x000C </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">src_iova</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="kt">uint64_t</span><span class="w"> </span><span class="n">dest_iova</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="n">fpgaGetIOAddress</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">src_wsid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">src_iova</span><span class="p">);</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="n">fpgaGetIOAddress</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">dest_wsid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dest_iova</span><span class="p">);</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_SRC_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">src_iova</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_DEST_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">dest_iova</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_NUM_LINES</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">64</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 46 Flow: Make AFU Aware of DMA Buffers</p>

<h4 id="247-initiate-an-acceleration-task"><strong>2.4.7 Initiate an Acceleration Task</strong><a class="headerlink" href="#247-initiate-an-acceleration-task" title="Permanent link">&para;</a></h4>
<p>With the shared buffer configuration complete, the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> can be told to
initiate the acceleration task. This process is <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>-specific. The Native
Loopback <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> starts the acceleration task by writing a value to its
control CSR:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="cp">#define CSR_CTRL 0x000D </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_CTRL</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 47 Initiate an Acceleration Task</p>

<h4 id="248-wait-for-task-completion"><strong>2.4.8 Wait for Task Completion</strong><a class="headerlink" href="#248-wait-for-task-completion" title="Permanent link">&para;</a></h4>
<p>Once the acceleration task is initiated, the application may poll the
<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> for a completion status. This process is <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>-specific. The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may
provide a status CSR for the application to poll; or the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may
communicate status to the application by means of a result code written
to a shared buffer.</p>
<h4 id="249-free-dma-buffers"><strong>2.4.9 Free DMA Buffers</strong><a class="headerlink" href="#249-free-dma-buffers" title="Permanent link">&para;</a></h4>
<p>When the acceleration task completes and the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is quiesced such that
there are no outstanding memory transactions targeted for the shared
memory, the DMA buffers can be unmapped and freed using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/buffer.h#L115">fpgaReleaseBuffer</a>():</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">fpgaReleaseBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">src_wsid</span><span class="p">);</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="n">fpgaReleaseBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">dest_wsid</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 48 Flow: Free DMA Buffers</p>

<h4 id="2410-unmap-mmio-region"><strong>2.4.10 Unmap <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Region</strong><a class="headerlink" href="#2410-unmap-mmio-region" title="Permanent link">&para;</a></h4>
<p>The <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> regions should also be unmapped using
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/mmio.h#L200-L201">fpgaUnmapMMIO</a>():</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="n">fpgaUnmapMMIO</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="p">);</span>
</code></pre></div>
<br></p>
<p align = "center">Figure 49 Flow: Unmap MMIO Region</p>

<h4 id="2411-close-the-afu"><strong>2.4.11 Close the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#2411-close-the-afu" title="Permanent link">&para;</a></h4>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> handle should be closed via
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/access.h#L88">fpgaClose</a>()
to release its resources:</p>
<p><br></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">fpgaClose</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">);</span>
</code></pre></div>
<p><br></p>
<p><br></p>
<h4 id="2412-release-the-tokens-and-properties"><strong>2.4.12 Release the Tokens and Properties</strong><a class="headerlink" href="#2412-release-the-tokens-and-properties" title="Permanent link">&para;</a></h4>
<p>The fpga_token’s returned by
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L101-L103">fpgaEnumerate</a>()
should be destroyed using the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/enum.h#L133">fpgaDestroyToken</a>()
API. The fpga_properties objects should be destroyed using the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/properties.h#L176">fpgaDestroyProperties</a>()
API:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="n">fpgaDestroyToken</span><span class="p">(</span><span class="o">&amp;</span><span class="n">afu_token</span><span class="p">);</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="n">fpgaDestroyProperties</span><span class="p">(</span><span class="o">&amp;</span><span class="n">filter</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 51 Flow: Release the Tokens and Properties</p>

<h3 id="30-opae-c-api"><strong>3.0 OPAE C++ API</strong><a class="headerlink" href="#30-opae-c-api" title="Permanent link">&para;</a></h3>
<p>The OPAE C++ API refers to a C++ layer that sits on top of the OPAE C
API, providing object-oriented implementations of the main OPAE C API
abstractions: properties, tokens, handles, dma buffers, etc. Like the
OPAE C API, the <a href="https://github.com/OFS/opae-sdk/tree/master/include/opae/cxx/core">C++ API
headers</a>
contain Doxygen markup for each of the provided classes.</p>
<h4 id="31-libopae-cxx-core"><strong>3.1 libopae-cxx-core</strong><a class="headerlink" href="#31-libopae-cxx-core" title="Permanent link">&para;</a></h4>
<p>The implementation files for the C++ API are compiled into
libopae-cxx-core.so. A convenience header,
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core.h">core.h</a>,
provides a quick means of including each of the C++ API headers. Each of
the types comprising the C++ API is located within the opae::fpga::types
C++ namespace.</p>
<h5 id="311-properties"><strong>3.1.1 Properties</strong><a class="headerlink" href="#311-properties" title="Permanent link">&para;</a></h5>
<p>Class
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/properties.h#L41-L137">properties</a>
provides the C++ implementation of the fpga_properties type and its
associated APIs.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="n">properties</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">properties</span><span class="o">::</span><span class="n">get</span><span class="p">();</span>
</code></pre></div>
<p align = "center">Figure 52 C++ Create New Empty Properties</p>

<p>Class properties provides <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/properties.h#L114-L136">member
variables</a>
for each fpga_properties item that can be manipulated with
fpgaPropertiesGet…() and fpgaPropertiesSet…(). For example, to set the
<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> ID in a properties instance and to set that instance’s type to
FPGA_ACCELERATOR:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="cp">#define MY_AFU_ID “8ad74241-d13b-48eb-b428-7986dcbcab14”</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="n">filter</span><span class="o">-&gt;</span><span class="n">guid</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">MY_AFU_ID</span><span class="p">);</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="n">filter</span><span class="o">-&gt;</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPGA_ACCELERATOR</span><span class="p">;</span>
</code></pre></div>
<p align = "center">Figure 53 C++ Properties Set GUID and Type</p>

<h5 id="312-tokens"><strong>3.1.2 Tokens</strong><a class="headerlink" href="#312-tokens" title="Permanent link">&para;</a></h5>
<p>Class
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/token.h#L39-L77">token</a>
provides the C++ implementation of the fpga_token type and its
associated APIs. Class token also provides the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/token.h#L48-L54">enumerate</a>()
static member function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">token</span><span class="o">::</span><span class="n">ptr_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tokens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">token</span><span class="o">::</span><span class="n">enumerate</span><span class="p">({</span><span class="n">filter</span><span class="p">});</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tokens</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="c1">// flag error and return</span>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="p">}</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="n">token</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">tok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</code></pre></div>
<p align = "center">Figure 54 C++ Enumeration</p>

<h5 id="313-handles"><strong>3.1.3 Handles</strong><a class="headerlink" href="#313-handles" title="Permanent link">&para;</a></h5>
<p>Class
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/handle.h#L38-L194">handle</a>
provides the C++ implementation of the fpga_handle type and its
associated APIs. The handle class provides member functions for opening
and closing a token, for reading and writing to <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> space, and for
reconfiguring the FPGA’s Programmable Region.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="n">handle</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">accel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handle</span><span class="o">::</span><span class="n">open</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 55 C++ Opening a Handle</p>

<h5 id="314-shared-memory"><strong>3.1.4 Shared Memory</strong><a class="headerlink" href="#314-shared-memory" title="Permanent link">&para;</a></h5>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/shared_buffer.h#L42-L173">shared_buffer</a>
class provides member functions for allocating and releasing DMA
buffers, for querying buffer attributes, and for reading and writing
buffers.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="cp">#define BUF_SIZE (2 * 1024 * 1024)</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="n">shared_buffer</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shared_buffer</span><span class="o">::</span><span class="n">allocate</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="n">shared_buffer</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shared_buffer</span><span class="o">::</span><span class="n">allocate</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="n">std</span><span class="o">::</span><span class="n">fill_n</span><span class="p">(</span><span class="n">input</span><span class="o">-&gt;</span><span class="n">c_type</span><span class="p">(),</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">,</span><span class="w"> </span><span class="mh">0xaf</span><span class="p">);</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="n">std</span><span class="o">::</span><span class="n">fill_n</span><span class="p">(</span><span class="n">output</span><span class="o">-&gt;</span><span class="n">c_type</span><span class="p">(),</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">,</span><span class="w"> </span><span class="mh">0xbe</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 56 C++ Allocate and Init Buffers</p>

<p>Once DMA buffers have been allocated, their IO addresses are programmed
into <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>-specific CSRs to enable the DMA. Here, the IO address of each
buffer is aligned to the nearest cache line before programming it into
the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSR space. The number of cache lines is then programmed into the
appropriate <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> CSR.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="cp">#define CSR_SRC_ADDR 0x000A </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="cp">#define CSR_DEST_ADDR 0x000B </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="cp">#define CSR_NUM_LINES 0x000C </span><span class="c1">// AFU-specific</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="cp">#define LOG2_CL 6</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="n">accel</span><span class="o">-&gt;</span><span class="n">write_csr64</span><span class="p">(</span><span class="n">CSR_SRC_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="o">-&gt;</span><span class="n">io_address</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">LOG2_CL</span><span class="p">);</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="n">accel</span><span class="o">-&gt;</span><span class="n">write_csr64</span><span class="p">(</span><span class="n">CSR_DEST_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="o">-&gt;</span><span class="n">io_address</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">LOG2_CL</span><span class="p">);</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="n">accel</span><span class="o">-&gt;</span><span class="n">write_csr32</span><span class="p">(</span><span class="n">CSR_NUM_LINES</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">64</span><span class="p">);</span>
</code></pre></div>
<p align = "center">Figure 57 C++ Make the AFU Aware of DMA Buffers</p>

<h5 id="315-events"><strong>3.1.5 Events</strong><a class="headerlink" href="#315-events" title="Permanent link">&para;</a></h5>
<p>The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/events.h#L37-L108">event</a>
class provides member functions for event registration. In order to
register an event, provide the handle::ptr_t for the desired device,
along with the event type and optional flags.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">vect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="n">event</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">evt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="o">::</span><span class="n">register_event</span><span class="p">(</span><span class="n">accel</span><span class="p">,</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="n">FPGA_EVENT_INTERRUPT</span><span class="p">,</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="n">vect</span><span class="p">);</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">evt_fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evt</span><span class="p">.</span><span class="n">os_object</span><span class="p">();</span>
</code></pre></div>
<p align = "center">Figure 58 C++ Event Registration</p>

<h5 id="316-errors"><strong>3.1.6 Errors</strong><a class="headerlink" href="#316-errors" title="Permanent link">&para;</a></h5>
<p>Class
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/errors.h#L37-L97">error</a>
provides a means of querying the device errors given a token::ptr_t.
The token and integer ID provided to the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/errors.h#L50-L59">error::get</a>()
static member function uniquely identify one of the 64-bit error masks
associated with the token.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="n">error</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">error</span><span class="o">::</span><span class="n">get</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 59 C++ Query Device Errors</p>

<h5 id="317-sysobject"><strong>3.1.7 SysObject</strong><a class="headerlink" href="#317-sysobject" title="Permanent link">&para;</a></h5>
<p>Class
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/sysobject.h#L38-L196">sysobject</a>
is the C++ implementation of the OPAE SysObject API. sysobject provides
a means of creating class instances via its two
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/sysobject.h#L52-L86">sysobject::get</a>()
static member functions. A third non-static
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/sysobject.h#L88-L103">sysobject::get</a>()
enables creating a sysobject instance given a parent sysobject instance.
The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/sysobject.h#L124-L137">read64</a>()
and
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/sysobject.h#L139-L152">write64</a>()
member functions allow reading and writing the sysobject’s value as a
64-bit unsigned integer. The
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/sysobject.h#L154-L177">bytes</a>()
member functions allow reading a sysobject’s value as a raw byte stream.</p>
<h3 id="40-opae-python-api"><strong>4.0 OPAE Python API</strong><a class="headerlink" href="#40-opae-python-api" title="Permanent link">&para;</a></h3>
<p>The OPAE Python API is built on top of the OPAE C++ Core API and its object model. Because of this, developing OPAE applications in Python is very similar to developing OPAE applications in C++ which significantly reduces the learning curve required to adapt to the Python API. While the object model remains the same, some static factory functions in the OPAE C++ Core API have been moved to module level methods in the OPAE Python API with the exception of the properties class. The goal of the OPAE Python API is to enable fast prototyping, test automation, infrastructure managment, and an easy to use framework for FPGA resource interactions that don’t rely on software algorithms with a high runtime complexity.</p>
<p>The major benefits of using pybind11 for developing the OPAE Python API include, but are not limited to, the following features of pybind11:</p>
<ul>
<li>Uses C++ 11 standard library although it can use C++ 14 or C++17.</li>
<li>Automatic conversions of shared_ptr types</li>
<li>Built-in support for numpy and Eigen numerical libraries</li>
<li>Interoperable with the Python C API</li>
</ul>
<p>Currently, the only Python package that is part of OPAE is <code>opae.fpga</code>. Because <code>opae.fpga</code> is built on top of the <code>opae-cxx-core</code> API, it does require that the runtime libraries for both <code>opae-cxx-core</code> and <code>opae-c</code> be installed on the system (as well as any other libraries they depend on). Those libraries can be installed using the <code>opae-libs</code> package (from either RPM or DEB format - depending on your Linux distribution). Installation for the Python OPAE bindings are included in the Getting Started Guide for your platform. </p>
<h4 id="41-opae"><strong>4.1 opae</strong><a class="headerlink" href="#41-opae" title="Permanent link">&para;</a></h4>
<p>The Python API is coded as a
<a href="https://pybind11.readthedocs.io/en/stable/">pybind11</a> project, which
allows C++ code to directly interface with Python internals. Each C++
API concept is encoded into a Python equivalent. The functionality
exists as a Python extension module, compiled into _opae.so.</p>
<h5 id="411-enumeration"><strong>4.1.1 Enumeration</strong><a class="headerlink" href="#411-enumeration" title="Permanent link">&para;</a></h5>
<p>Enumeration is somewhat simplified as compared to the OPAE C/C++ APIs.
The fpga.enumerate() function accepts keyword arguments for each of the
<a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/properties.h#L115-L136">property
names</a>
that are defined in the C++ API. As an example, to enumerate for an
FPGA_ACCELERATOR by its GUID:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="kn">from</span> <span class="nn">opae</span> <span class="kn">import</span> <span class="n">fpga</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="n">MY_ACCEL</span> <span class="o">=</span> <span class="err">“</span><span class="n">d573b29e</span><span class="o">-</span><span class="mi">176</span><span class="n">f</span><span class="o">-</span><span class="mi">4</span><span class="n">cb7</span><span class="o">-</span><span class="n">b810</span><span class="o">-</span><span class="n">efbf7be34cc9</span><span class="err">”</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="n">tokens</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">enumerate</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">fpga</span><span class="o">.</span><span class="n">ACCELERATOR</span><span class="p">,</span> <span class="n">guid</span><span class="o">=</span><span class="n">MY_ACCEL</span><span class="p">)</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="k">assert</span> <span class="n">tokens</span><span class="p">,</span> <span class="err">“</span><span class="n">No</span> <span class="n">accelerator</span> <span class="n">matches</span> <span class="p">{}</span><span class="err">”</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MY_ACCEL</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 60 Python Enumeration</p>

<p>The return value from the fpga.enumerate() function is a list of all the
token objects matching the search criteria.</p>
<h5 id="412-properties"><strong>4.1.2 Properties</strong><a class="headerlink" href="#412-properties" title="Permanent link">&para;</a></h5>
<p>Querying properties for a token or handle is also a bit different in the
Python API. In order to query properties for one of these objects, pass
the object to the fpga.properties() constructor. The return value is a
properties object with each of the <a href="https://github.com/OFS/opae-sdk/blob/master/include/opae/cxx/core/properties.h#L115-L136">property
names</a>
defined as instance attributes.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="n">prop</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;0x</span><span class="si">{</span><span class="n">prop</span><span class="o">.</span><span class="n">vendor_id</span><span class="si">:</span><span class="s1">04x</span><span class="si">}</span><span class="s1"> 0x</span><span class="si">{</span><span class="n">prop</span><span class="o">.</span><span class="n">device_id</span><span class="si">:</span><span class="s1">04x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 61 Python Get Token Properties</p>

<p>Properties objects may also be created by invoking the fpga.properties()
constructor, passing the same keyword arguments as those to
fpga.enumerate(). Properties objects created in this way are also useful
for enumeration purposes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="n">props</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">fpga</span><span class="o">.</span><span class="n">ACCELERATOR</span><span class="p">)</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="n">tokens</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">enumerate</span><span class="p">([</span><span class="n">props</span><span class="p">])</span>
</code></pre></div>
<p align = "center">Figure 62 Python Properties Constructor</p>

<h5 id="413-tokens"><strong>4.1.3 Tokens</strong><a class="headerlink" href="#413-tokens" title="Permanent link">&para;</a></h5>
<p>Tokens overload both the __getitem__ and __getattr__ methods to
enable the SysObject API. Both of the following are valid forms of
accessing the ‘errors/first_error’ sysfs attribute, given a token
object:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="n">tok</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="n">ferr</span> <span class="o">=</span> <span class="n">tok</span><span class="p">[</span><span class="s1">&#39;errors/first_error&#39;</span><span class="p">]</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;first error: 0x</span><span class="si">{</span><span class="n">ferr</span><span class="o">.</span><span class="n">read64</span><span class="p">()</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;0x</span><span class="si">{:0x}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">first_error</span><span class="o">.</span><span class="n">read64</span><span class="p">()))</span>
</code></pre></div>
<p align = "center">Figure 63 Python Tokens and SysObject API</p>

<p>Tokens also implement a find() method, which accepts a glob expression
in order to search sysfs. The following example finds the “id” sysfs
entry in the given token’s sysfs tree.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="n">my_id</span> <span class="o">=</span> <span class="n">tok</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="err">‘</span><span class="n">i</span><span class="err">?’</span><span class="p">)</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">my_id</span><span class="o">.</span><span class="n">read64</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 64 Python Token Find</p>

<h5 id="414-handles"><strong>4.1.4 Handles</strong><a class="headerlink" href="#414-handles" title="Permanent link">&para;</a></h5>
<p>Tokens are converted to handles by way of the fpga.open() function. The
flags (second) parameter to fpga.open() may be zero or
fpga.OPEN_SHARED.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">with</span> <span class="n">fpga</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">fpga</span><span class="o">.</span><span class="n">OPEN_SHARED</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>    <span class="n">use_the_handle</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 65 Python Open Handle</p>

<p>Like token objects, handle objects overload __getitem__ and
__getattr__ methods to enable the SysObject API. handle also
provides a find() method similar to token’s find().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="n">err</span> <span class="o">=</span> <span class="n">handle</span><span class="p">[</span><span class="s1">&#39;errors/errors&#39;</span><span class="p">]</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;errors: 0x</span><span class="si">{</span><span class="n">err</span><span class="o">.</span><span class="n">read64</span><span class="p">()</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;first error: 0x</span><span class="si">{:0x}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="n">handle</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">first_error</span><span class="o">.</span><span class="n">read64</span><span class="p">()))</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="n">my_id</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;i?&#39;</span><span class="p">)</span>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">my_id</span><span class="o">.</span><span class="n">read64</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 66 Python Handles and SysObject API</p>

<p>Partial reconfiguration is provided by class handle’s reconfigure()
method. The first parameter, slot, will be zero in most designs. The
second parameter is an opened file descriptor to the file containing the
GBS image. The third parameter, flags, defaults to zero.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="err">‘</span><span class="n">my</span><span class="o">.</span><span class="n">gbs</span><span class="err">’</span><span class="p">,</span> <span class="err">‘</span><span class="n">rb</span><span class="err">’</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>    <span class="n">handle</span><span class="o">.</span><span class="n">reconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 67 Python Partial Reconfiguration</p>

<p>Device reset is accomplished by means of handle’s reset() method, which
takes no parameters.</p>
<p>Finally for handles, CSR space reads are accomplished via read_csr32()
and read_csr64(). Both methods accept the register offset as the first
parameter and an optional csr_space index, which defaults to zero, as
the second parameter. CSR space writes are accomplished via
write_csr32() and write_csr64(). Both methods accept the register
offset as the first parameter, the value to write as the second, and an
optional csr_space index, which defaults to zero, as the third.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="nb">print</span><span class="p">(</span><span class="err">’</span><span class="mi">0</span><span class="n">x</span><span class="p">{:</span><span class="mi">0</span><span class="n">x</span><span class="p">}</span><span class="err">’</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">read_csr32</span><span class="p">(</span><span class="mh">0x000a</span><span class="p">)))</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="nb">print</span><span class="p">(</span><span class="err">‘</span><span class="mi">0</span><span class="n">x</span><span class="p">{:</span><span class="mi">0</span><span class="n">x</span><span class="p">}</span><span class="err">’</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">read_csr64</span><span class="p">(</span><span class="mh">0x000c</span><span class="p">)))</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="n">handle</span><span class="o">.</span><span class="n">write_csr32</span><span class="p">(</span><span class="mh">0x000b</span><span class="p">,</span> <span class="mh">0xdecafbad</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="n">handle</span><span class="o">.</span><span class="n">write_csr64</span><span class="p">(</span><span class="mh">0x000e</span><span class="p">,</span> <span class="mh">0xc0cac01adecafbad</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 68 Python Read/Write CSR</p>

<h5 id="415-shared-memory"><strong>4.1.5 Shared Memory</strong><a class="headerlink" href="#415-shared-memory" title="Permanent link">&para;</a></h5>
<p>The fpga.allocate_shared_buffer() function provides access to the OPAE
memory allocator. The allocation sizes and required huge page
configurations are the same as those noted in 2.1.5 <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> and Shared
Memory.</p>
<p>The fpga.allocate_shared_buffer() function returns an object instance
of type shared_buffer. The shared_buffer class implements methods
size(), wsid(), and io_address(), which return the buffer size in
bytes, the unique workspace ID, and the IO address respectively:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="n">buf</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">allocate_shared_buffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="err">’</span><span class="n">size</span><span class="p">:</span> <span class="p">{</span><span class="n">buf</span><span class="o">.</span><span class="n">size</span><span class="p">()}</span><span class="err">’</span><span class="p">)</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="err">’</span><span class="n">wsid</span><span class="p">:</span> <span class="mi">0</span><span class="n">x</span><span class="p">{</span><span class="n">buf</span><span class="o">.</span><span class="n">wsid</span><span class="p">():</span><span class="mi">0</span><span class="n">x</span><span class="p">}</span><span class="err">’</span><span class="p">)</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="err">’</span><span class="n">io_address</span><span class="p">:</span> <span class="mi">0</span><span class="n">x</span><span class="p">{</span><span class="n">buf</span><span class="o">.</span><span class="n">io_address</span><span class="p">():</span><span class="mi">0</span><span class="n">x</span><span class="p">}</span><span class="err">’</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 69 Python Allocate Shared Memory</p>

<p>The shared_buffer class implements a fill() method which takes an
integer parameter which is applied to each byte of the buffer (similar
to C standard library’s memset()). The compare() method compares the
contents of the first size bytes of one buffer to another. The value
returned from compare() is the same as the C standard library’s
memcmp(). The copy() method copies the first size bytes of the calling
buffer into the argument buffer.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="n">b0</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">allocate_shared_buffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="n">b1</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">allocate_shared_buffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="n">b0</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mh">0xa5</span><span class="p">)</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="n">b1</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mh">0xa5</span><span class="p">)</span>
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;compare: </span><span class="si">{</span><span class="n">b0</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">4096</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="n">b1</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mh">0xa0</span><span class="p">)</span>
<a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a><span class="n">b0</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;compare: </span><span class="si">{</span><span class="n">b0</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">4096</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 70 Python Buffer Fill, Copy, Compare</p>

<p>shared_buffer’s read32() and read64() methods read a 32- or 64-bit
value from the given offset. The write32() and write64() methods write a
32- or 64-bit value to the given offset.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;value at 0: 0x</span><span class="si">{</span><span class="n">b0</span><span class="o">.</span><span class="n">read32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;value at 4: 0x</span><span class="si">{</span><span class="n">b0</span><span class="o">.</span><span class="n">read64</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="n">b0</span><span class="o">.</span><span class="n">write32</span><span class="p">(</span><span class="mh">0xabadbeef</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="n">b0</span><span class="o">.</span><span class="n">write64</span><span class="p">(</span><span class="mh">0xdecafbadabadbeef</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;value at 0: 0x</span><span class="si">{</span><span class="n">b0</span><span class="o">.</span><span class="n">read32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;value at 4: 0x</span><span class="si">{</span><span class="n">b0</span><span class="o">.</span><span class="n">read64</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 71 Python Buffer Read and Write</p>

<p>The shared_buffer class provides three polling methods: poll(),
poll32(), and poll64(). Each method takes an offset as its first
parameter. The second parameter is a value and the third is a mask. The
value and mask parameters are 8 bits wide for poll(), 32 bits wide for
poll32(), and 64 bits wide for poll64(). The fourth and last parameter
is a timeout value which defaults to 1000 microseconds.</p>
<p>Each polling method reads the n-bit wide item at offset and applies
(logical AND) the mask to that value. The masked value created in the
previous step is then compared to the second parameter, value. If the
two values are equal, then the method returns true immediately.
Otherwise, the method continues to loop, attempting the same comparison
over and over <strong>without sleeping</strong>. Finally, if the elapsed time from
the beginning of the call to the current time is greater than or equal
to the timeout value, then the method times out and returns false.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="k">if</span> <span class="n">b0</span><span class="o">.</span><span class="n">poll32</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0xbebebebe</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">,</span> <span class="mi">250</span><span class="p">):</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="err">‘</span><span class="n">Got</span> <span class="n">it</span><span class="err">!’</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 72 Python Buffer Poll</p>

<p>The shared_buffer split() method allows creating two or more buffer
objects from one larger buffer object. The return value is a list of
shared_buffer instances whose sizes match the arguments given to
split().</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">2048</span><span class="p">)</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;b1 io_address: 0x</span><span class="si">{</span><span class="n">b1</span><span class="o">.</span><span class="n">io_address</span><span class="p">()</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;b2 io_address: 0x</span><span class="si">{</span><span class="n">b2</span><span class="o">.</span><span class="n">io_address</span><span class="p">()</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 73 Python Splitting Buffer</p>

<p>Finally, the shared_buffer class implements the Python buffer protocol
to support
<a href="https://docs.python.org/dev/library/stdtypes.html#memoryviewhttps://docs.python.org/dev/library/stdtypes.html">memoryview</a>
objects. The Python buffer protocol allows access to an object’s
underlying memory without copying that memory. As a brief example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="n">mv</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="k">assert</span> <span class="n">mv</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="k">assert</span> <span class="n">mv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xbe</span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="n">b1</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">65536</span><span class="p">)</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="k">assert</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;L&#39;</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">b1</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">19</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">65536</span>
</code></pre></div>
<p align = "center">Figure 74 Python memoryview</p>

<h5 id="416-events"><strong>4.1.6 Events</strong><a class="headerlink" href="#416-events" title="Permanent link">&para;</a></h5>
<p>Given a handle and an event type, the fpga.register_event() function
returns an object of type event. The event class implements one method,
os_object(), which returns the underlying file descriptor that can be
used to poll for the event:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="kn">import</span> <span class="nn">select</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="n">evt</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">register_event</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">fpga</span><span class="o">.</span><span class="n">EVENT_ERROR</span><span class="p">)</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="n">os_object</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">os_object</span><span class="p">()</span>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="n">received_event</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="n">epoll</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">epoll</span><span class="p">()</span>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="n">epoll</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">os_object</span><span class="p">,</span> <span class="n">select</span><span class="o">.</span><span class="n">EPOLLIN</span><span class="p">)</span>
<a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="k">for</span> <span class="n">fileno</span><span class="p">,</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">epoll</span><span class="o">.</span><span class="n">poll</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a>    <span class="k">if</span> <span class="n">fileno</span> <span class="o">==</span> <span class="n">os_object</span><span class="p">:</span>
<a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a>        <span class="n">received_event</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;received: </span><span class="si">{</span><span class="n">received_event</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 75 Python Events</p>

<p>In addition to fpga.EVENT_ERROR, fpga.EVENT_INTERRUPT, and
fpga.EVENT_POWER_THERMAL are also supported.</p>
<h5 id="417-errors"><strong>4.1.7 Errors</strong><a class="headerlink" href="#417-errors" title="Permanent link">&para;</a></h5>
<p>Given a token, the fpga.errors() function returns a list of objects of
type error. Each error instance represents a 64-bit mask of error
values. The error bit masks are platform-dependent. Each error instance
has two attributes: name and can_clear and one method: read_value()
which returns the 64-bit error mask.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">fpga</span><span class="o">.</span><span class="n">errors</span><span class="p">(</span><span class="n">tok</span><span class="p">):</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="err">’</span><span class="n">name</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{e.name}</span><span class="s2">&quot;</span><span class="err">’</span><span class="p">)</span>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="err">’</span><span class="n">can_clear</span><span class="p">:</span> <span class="p">{</span><span class="n">e</span><span class="o">.</span><span class="n">can_clear</span><span class="p">}</span><span class="err">’</span><span class="p">)</span>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="err">’</span><span class="n">value</span><span class="p">:</span> <span class="p">{</span><span class="n">e</span><span class="o">.</span><span class="n">read_value</span><span class="p">()}</span><span class="err">’</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 76 Python Get Errors</p>

<h5 id="418-sysobject"><strong>4.1.8 SysObject</strong><a class="headerlink" href="#418-sysobject" title="Permanent link">&para;</a></h5>
<p>The Python API’s SysObject implementation is introduced in 4.1.3 Tokens
and 4.1.4 Handles. When the index operator (__getitem__) or
attribute reference (__getattr__) is used and the referenced string
or attribute name corresponds to a sysfs entry in the sysfs path of
either a token or a handle, then an object of type sysobject is
returned.</p>
<p>The size() method returns the length of the sysfs entry in bytes. Note
that a typical sysfs entry is terminated with a ‘\n’ followed by the
‘\0’ NULL terminator. The bytes() method returns the sysfs entry’s
value as a string.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="n">afu_id</span> <span class="o">=</span> <span class="n">tok</span><span class="p">[</span><span class="s1">&#39;afu_id&#39;</span><span class="p">]</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="k">assert</span> <span class="n">afu_id</span>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;size: </span><span class="si">{</span><span class="n">afu_id</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="si">}</span><span class="s1"> bytes: </span><span class="si">{</span><span class="n">afu_id</span><span class="o">.</span><span class="n">bytes</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 77 Python sysobject as Bytes</p>

<p>The sysobject read64() and write64() methods provide a means to read and
write a sysfs entry’s value as an unsigned 64-bit integer. The sysobject
class itself also implements the __getitem__ and __getattr__
methods so that a sysobject of type FPGA_OBJECT_CONTAINER can retrieve
sysobject instances for child sysfs entries.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="n">errs</span> <span class="o">=</span> <span class="n">tok</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span>
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="n">first</span> <span class="o">=</span> <span class="n">errs</span><span class="p">[</span><span class="s1">&#39;first_error&#39;</span><span class="p">]</span>
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="k">assert</span> <span class="n">first</span>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;first 0x</span><span class="si">{</span><span class="n">first</span><span class="o">.</span><span class="n">read64</span><span class="p">()</span><span class="si">:</span><span class="s1">0x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="418-python-example-application"><strong>4.1.8 Python Example Application</strong><a class="headerlink" href="#418-python-example-application" title="Permanent link">&para;</a></h3>
<p>The following example is an implementation of the sample, hello_fpga.c, which is designed to configure the NLB0 diagnostic accelerator for a simple loopback.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="kn">from</span> <span class="nn">opae</span> <span class="kn">import</span> <span class="n">fpga</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="n">NLB0</span> <span class="o">=</span> <span class="s2">&quot;d8424dc4-a4a3-c413-f89e-433683f9040b&quot;</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="n">CTL</span> <span class="o">=</span> <span class="mh">0x138</span>
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="n">CFG</span> <span class="o">=</span> <span class="mh">0x140</span>
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="n">NUM_LINES</span> <span class="o">=</span> <span class="mh">0x130</span>
<a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="n">SRC_ADDR</span> <span class="o">=</span> <span class="mh">0x0120</span>
<a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="n">DST_ADDR</span> <span class="o">=</span> <span class="mh">0x0128</span>
<a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a><span class="n">DSM_ADDR</span> <span class="o">=</span> <span class="mh">0x0110</span>
<a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a><span class="n">DSM_STATUS</span> <span class="o">=</span> <span class="mh">0x40</span>
<a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a>
<a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a><span class="k">def</span> <span class="nf">cl_align</span><span class="p">(</span><span class="n">addr</span><span class="p">):</span>
<a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a>    <span class="k">return</span> <span class="n">addr</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span>
<a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a>
<a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a><span class="n">tokens</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">enumerate</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">fpga</span><span class="o">.</span><span class="n">ACCELERATOR</span><span class="p">,</span> <span class="n">guid</span><span class="o">=</span><span class="n">NLB0</span><span class="p">)</span>
<a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a><span class="k">assert</span> <span class="n">tokens</span><span class="p">,</span> <span class="s2">&quot;Could not enumerate accelerator: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">NlB0</span><span class="p">)</span>
<a id="__codelineno-81-18" name="__codelineno-81-18" href="#__codelineno-81-18"></a>
<a id="__codelineno-81-19" name="__codelineno-81-19" href="#__codelineno-81-19"></a><span class="k">with</span> <span class="n">fpga</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fpga</span><span class="o">.</span><span class="n">OPEN_SHARED</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
<a id="__codelineno-81-20" name="__codelineno-81-20" href="#__codelineno-81-20"></a>    <span class="n">src</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">allocate_shared_buffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<a id="__codelineno-81-21" name="__codelineno-81-21" href="#__codelineno-81-21"></a>    <span class="n">dst</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">allocate_shared_buffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<a id="__codelineno-81-22" name="__codelineno-81-22" href="#__codelineno-81-22"></a>    <span class="n">dsm</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">allocate_shared_buffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<a id="__codelineno-81-23" name="__codelineno-81-23" href="#__codelineno-81-23"></a>    <span class="n">handle</span><span class="o">.</span><span class="n">write_csr32</span><span class="p">(</span><span class="n">CTL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-81-24" name="__codelineno-81-24" href="#__codelineno-81-24"></a>    <span class="n">handle</span><span class="o">.</span><span class="n">write_csr32</span><span class="p">(</span><span class="n">CTL</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-81-25" name="__codelineno-81-25" href="#__codelineno-81-25"></a>    <span class="n">handle</span><span class="o">.</span><span class="n">write_csr64</span><span class="p">(</span><span class="n">DSM_ADDR</span><span class="p">,</span> <span class="n">dsm</span><span class="o">.</span><span class="n">io_address</span><span class="p">())</span>
<a id="__codelineno-81-26" name="__codelineno-81-26" href="#__codelineno-81-26"></a>    <span class="n">handle</span><span class="o">.</span><span class="n">write_csr64</span><span class="p">(</span><span class="n">SRC_ADDR</span><span class="p">,</span> <span class="n">cl_align</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">io_address</span><span class="p">()))</span> <span class="c1"># cacheline-aligned</span>
<a id="__codelineno-81-27" name="__codelineno-81-27" href="#__codelineno-81-27"></a>    <span class="n">handle</span><span class="o">.</span><span class="n">write_csr64</span><span class="p">(</span><span class="n">DST_ADDR</span><span class="p">,</span> <span class="n">cl_align</span><span class="p">(</span><span class="n">dst</span><span class="o">.</span><span class="n">io_address</span><span class="p">()))</span> <span class="c1"># cacheline-aligned</span>
<a id="__codelineno-81-28" name="__codelineno-81-28" href="#__codelineno-81-28"></a>    <span class="n">handle</span><span class="o">.</span><span class="n">write_csr32</span><span class="p">(</span><span class="n">CFG</span><span class="p">,</span> <span class="mh">0x42000</span><span class="p">)</span>
<a id="__codelineno-81-29" name="__codelineno-81-29" href="#__codelineno-81-29"></a>    <span class="n">handle</span><span class="o">.</span><span class="n">write_csr32</span><span class="p">(</span><span class="n">NUM_LINES</span><span class="p">,</span> <span class="mi">4096</span><span class="o">/</span><span class="mi">64</span><span class="p">)</span>
<a id="__codelineno-81-30" name="__codelineno-81-30" href="#__codelineno-81-30"></a>    <span class="n">handle</span><span class="o">.</span><span class="n">write_csr32</span><span class="p">(</span><span class="n">CTL</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-81-31" name="__codelineno-81-31" href="#__codelineno-81-31"></a>    <span class="k">while</span> <span class="n">dsm</span><span class="p">[</span><span class="n">DSM_STATUS</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-81-32" name="__codelineno-81-32" href="#__codelineno-81-32"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
<a id="__codelineno-81-33" name="__codelineno-81-33" href="#__codelineno-81-33"></a>    <span class="n">handle</span><span class="o">.</span><span class="n">write_csr32</span><span class="p">(</span><span class="n">CTL</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</code></pre></div>
<p>This example shows how one might reprogram (Partial Reconfiguration) an accelerator on a given bus, 0x5e, using a bitstream file, m0.gbs.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="kn">from</span> <span class="nn">opae</span> <span class="kn">import</span> <span class="n">fpga</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="n">BUS</span> <span class="o">=</span> <span class="mh">0x5e</span>
<a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="n">GBS</span> <span class="o">=</span> <span class="s1">&#39;m0.gbs&#39;</span>
<a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="n">tokens</span> <span class="o">=</span> <span class="n">fpga</span><span class="o">.</span><span class="n">enumerate</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">fpga</span><span class="o">.</span><span class="n">DEVICE</span><span class="p">,</span> <span class="n">bus</span><span class="o">=</span><span class="n">BUS</span><span class="p">)</span>
<a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="k">assert</span> <span class="n">tokens</span><span class="p">,</span> <span class="s2">&quot;Could not enumerate device on bus: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">BUS</span><span class="p">)</span>
<a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">GBS</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">,</span> <span class="n">fpga</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">as</span> <span class="n">device</span><span class="p">:</span>
<a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a>    <span class="n">device</span><span class="o">.</span><span class="n">reconfigure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
</code></pre></div>
<p align = "center">Figure 78 Python sysobject Container</p>

<h2 id="50-management-interfaces-opaeadmin"><strong>5.0 Management Interfaces - opae.admin</strong><a class="headerlink" href="#50-management-interfaces-opaeadmin" title="Permanent link">&para;</a></h2>
<p>While the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> C, C++, and Python APIs focus on presenting the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and all its related functionality to the end user, there is also a need for a maintenance functionality to aid in configuring the platform and performing secure firmware updates for the FPGA device and its components.  opae.admin is a Python framework which provides abstractions for performing these types of maintenance tasks on FPGA devices.  opae.admin provides Python classes which model the FPGA and the sysfs interfaces provided by the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers.</p>
<h3 id="51-sysfs"><strong>5.1 sysfs</strong><a class="headerlink" href="#51-sysfs" title="Permanent link">&para;</a></h3>
<p>opae.admin’s sysfs module provides abstractions for interacting with sysfs nodes, which comprise the base entity abstraction of opae.admin.</p>
<h4 id="511-sysfs_node"><strong>5.1.1 sysfs_node</strong><a class="headerlink" href="#511-sysfs_node" title="Permanent link">&para;</a></h4>
<p>A sysfs_node is an object that tracks a unique path within a sysfs directory tree.  sysfs_node provides methods for finding and constructing other sysfs_node objects, based on the root path of the parent sysfs_node object.  sysfs_node also provides a mechanism to read and write sysfs file contents.  sysfs_node serves as the base class for many of the sysfs module’s other classes.</p>
<h4 id="512-pci_node"><strong>5.1.2 pci_node</strong><a class="headerlink" href="#512-pci_node" title="Permanent link">&para;</a></h4>
<p>A pci_node is a sysfs_node that is rooted at /sys/bus/pci/devices.  Each pci_node has a unique PCIe address corresponding to the PCIe device it represents.  Methods for finding the pci_node’s children, for determining the PCIe device tree rooted at the node, for manipulating the node’s PCIe address, for determining the vendor and device ID’s, and for removing, unbinding, and rescanning the device are provided.</p>
<h4 id="513-sysfs_driver"><strong>5.1.3 sysfs_driver</strong><a class="headerlink" href="#513-sysfs_driver" title="Permanent link">&para;</a></h4>
<p>A sysfs_driver is a sysfs_node that provides a method for unbinding a sysfs_device object.</p>
<h4 id="514-sysfs_device"><strong>5.1.4 sysfs_device</strong><a class="headerlink" href="#514-sysfs_device" title="Permanent link">&para;</a></h4>
<p>A sysfs_device is a sysfs_node that is located under /sys/class or /sys/bus.  sysfs_device provides the basis for opae.admin’s FPGA enumeration capability.</p>
<h4 id="515-pcie_device"><strong>5.1.5 pcie_device</strong><a class="headerlink" href="#515-pcie_device" title="Permanent link">&para;</a></h4>
<p>A pcie_device is a sysfs_device that is rooted at /sys/bus/pci/devices.</p>
<h3 id="52-fpga"><strong>5.2 fpga</strong><a class="headerlink" href="#52-fpga" title="Permanent link">&para;</a></h3>
<p>opae.admin’s fpga module provides classes which abstract an FPGA and its components.</p>
<h4 id="521-region"><strong>5.2.1 region</strong><a class="headerlink" href="#521-region" title="Permanent link">&para;</a></h4>
<p>A region is a sysfs_node that has an associated Linux character device, rooted at /dev.  Methods for opening the region’s character device file and for interacting with the character device via its <abbr title="Input/Output Control, System calls used to manipulate underlying device parameters of special files.">IOCTL</abbr> interface are provided.</p>
<h4 id="522-fme"><strong>5.2.2 fme</strong><a class="headerlink" href="#522-fme" title="Permanent link">&para;</a></h4>
<p>An fme is a region that represents an FPGA device’s <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> component.  An fme provides accessors for the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> interface ID, the various bus paths that may exist under an <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>, and the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> firmware revision information.</p>
<h4 id="523-port"><strong>5.2.3 port</strong><a class="headerlink" href="#523-port" title="Permanent link">&para;</a></h4>
<p>A port is a region that represents an FPGA device’s Port component.  A port provides an accessor for the Port <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> ID.</p>
<h4 id="524-fpga_base"><strong>5.2.4 fpga_base</strong><a class="headerlink" href="#524-fpga_base" title="Permanent link">&para;</a></h4>
<p>An fpga_base is a sysfs_device that provides accessors for the FPGA device’s <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>, for the FPGA device’s Port, and for the secure update sysfs controls.  fpga_base provides routines for enabling and disabling <abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr> and for performing device <abbr title="Remote System Update, A Remote System Update operation sends an instruction to the Intel FPGA PAC D5005 device that triggers a power cycle of the card only, forcing reconfiguration.">RSU</abbr>.</p>
<h4 id="525-fpga"><strong>5.2.5 fpga</strong><a class="headerlink" href="#525-fpga" title="Permanent link">&para;</a></h4>
<p>An fpga (derived from fpga_base) is the basis for representing the FPGA device in opae.admin.  Utilities such as fpgasupdate rely on fpga’s enum classmethod to enumerate all of the FPGA devices in the system.  In order for a device to enumerate via this mechanism, it must be bound to the dfl-pci driver at the time of enumeration.</p>
<h3 id="53-opaeadmin-utilities"><strong>5.3 opae.admin Utilities</strong><a class="headerlink" href="#53-opaeadmin-utilities" title="Permanent link">&para;</a></h3>
<p>Several utilities are written on top of opae.admin’s class abstractions.  The following sections highlight some of the most commonly-used utilities.</p>
<h4 id="531-fpgasupdate"><strong>5.3.1 fpgasupdate</strong><a class="headerlink" href="#531-fpgasupdate" title="Permanent link">&para;</a></h4>
<p>fpgasupdate, or FPGA Secure Update, is used to apply firmware updates to the components of the FPGA.  As the name implies, these updates target a secure FPGA device, one that has the ability to implement a secure root of trust.
The command-line interface to fpgasupdate was designed to be as simple as possible for the end user.  The command simply takes a path to the firmware update file to be applied and the PCIe address of the targeted FPGA device.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="c1"># fpgasupdate update-file.bin 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 79 fpgasupdate Interface</p>

<p>fpgasupdate can apply a variety of firmware image updates.
| Image| Description|
| -----| -----|
|Programmable Region Image| .gbs or Green BitStream|
|SR Root Key Hash|  Static Region RKH|
|<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Root Key Hash|  Programmable Region RKH|
|FPGA Firmware Image|   Static Region Device Firmware|
|<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Authentication Certificate| Programmable Region Auth Cert|
|<abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> Firmware Image|    Board Management Controller Firmware|
|SR Thermal Image|  Static Region Thermal Sensor Thresholds|
|<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Thermal Image|  Programmable Region Thermal Sensor Thresholds|
|CSK Cancelation|   Code Signing Key Cancelation Request|
|SDM Image| Secure Device Manager Firmware|</p>
<p align = "center">Table 10 fpgasupdate Image Types</p>

<h4 id="532-pci_device"><strong>5.3.2 pci_device</strong><a class="headerlink" href="#532-pci_device" title="Permanent link">&para;</a></h4>
<p>pci_device is a utility that provides a convenient interface to some of the Linux Kernel’s standard PCIe device capabilities.</p>
<h5 id="5321-pci_device-aer-subcommand"><strong>5.3.2.1 pci_device aer subcommand</strong><a class="headerlink" href="#5321-pci_device-aer-subcommand" title="Permanent link">&para;</a></h5>
<p>The aer dump subcommand displays the Correctable, Fatal, and NonFatal device errors.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="c1"># pci_device 0000:b2:00.0 aer dump</span>
</code></pre></div>
<p align = "center">Figure 80 pci_device aer dump</p>

<p>The aer mask subcommand displays, masks, or unmasks errors using the syntax of the setpci command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="c1"># pci_device 0000:b2:00.0 aer mask show</span>
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a>0x00010000<span class="w"> </span>0x000031c1
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="c1"># pci_device 0000:b2:00.0 aer mask all</span>
<a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="c1"># pci_device 0000:b2:00.0 aer mask off</span>
<a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="c1"># pci_device 0000:b2:00.0 aer mask 0x01010101 0x10101010</span>
</code></pre></div>
<p align = "center">Figure 81 pci_device aer mask</p>

<p>The aer clear subcommand clears the current errors.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="c1"># pci_device 0000:b2:00.0 aer clear</span>
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>aer<span class="w"> </span>clear<span class="w"> </span>errors:<span class="w"> </span><span class="m">00000000</span>
</code></pre></div>
<p align = "center">Figure 82 pci_device aer clear</p>

<h5 id="5322-pci_device-unbind-subcommand"><strong>5.3.2.2 pci_device unbind subcommand</strong><a class="headerlink" href="#5322-pci_device-unbind-subcommand" title="Permanent link">&para;</a></h5>
<p>The unbind subcommand unbinds the target device from the currently-bound device driver.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="c1"># pci_device 0000:b2:00.0 unbind</span>
</code></pre></div>
<p align = "center">Figure 83 pci_device unbind</p>

<p>In order to re-bind the device to a driver, eg dfl-pci, use the following commands:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="c1"># cd /sys/bus/pci/drivers/dfl-pci</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="c1"># echo 0000:b2:00.0 &gt; bind</span>
</code></pre></div>
<p align = "center">Figure 84 Re-binding a Driver</p>

<h5 id="5323-pci_device-rescan-subcommand"><strong>5.3.2.3 pci_device rescan subcommand</strong><a class="headerlink" href="#5323-pci_device-rescan-subcommand" title="Permanent link">&para;</a></h5>
<p>The rescan subcommand triggers a PCIe bus rescan of all PCIe devices.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="c1"># pci_device 0000:b2:00.0 rescan</span>
</code></pre></div>
<p align = "center">Figure 85 pci_device rescan</p>

<h5 id="5324-pci_device-remove-subcommand"><strong>5.3.2.4 pci_device remove subcommand</strong><a class="headerlink" href="#5324-pci_device-remove-subcommand" title="Permanent link">&para;</a></h5>
<p>The remove subcommand removes the target device from Linux kernel management.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="c1"># pci_device 0000:b2:00.0 remove</span>
</code></pre></div>
<p align = "center">Figure 86 pci_device remove</p>

<p>Note: a reboot may be required in order to re-establish the Linux kernel management for the device.</p>
<h5 id="5325-pci_device-topology-subcommand"><strong>5.3.2.5 pci_device topology subcommand</strong><a class="headerlink" href="#5325-pci_device-topology-subcommand" title="Permanent link">&para;</a></h5>
<p>The topology subcommand shows a tab-delimited depiction of the target device as it exists in the PCIe device tree in the Linux kernel.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="c1"># pci_device 0000:b2:00.0 topology</span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3a:00.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x2030<span class="o">)]</span><span class="w"> </span><span class="o">(</span>pcieport<span class="o">)</span>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">    </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3b:00.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x10b5,<span class="w"> </span>0x8747<span class="o">)]</span><span class="w"> </span><span class="o">(</span>pcieport<span class="o">)</span>
<a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="w">        </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3c:09.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x10b5,<span class="w"> </span>0x8747<span class="o">)]</span><span class="w"> </span><span class="o">(</span>pcieport<span class="o">)</span>
<a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="w">            </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:b2:00.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x0b30<span class="o">)]</span><span class="w"> </span><span class="o">(</span>dfl-pci<span class="o">)</span>
<a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="w">        </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3c:11.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x10b5,<span class="w"> </span>0x8747<span class="o">)]</span><span class="w"> </span><span class="o">(</span>pcieport<span class="o">)</span>
<a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="w">            </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:43:00.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x0b32<span class="o">)]</span><span class="w"> </span><span class="o">(</span>no<span class="w"> </span>driver<span class="o">)</span>
<a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="w">        </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3c:08.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x10b5,<span class="w"> </span>0x8747<span class="o">)]</span><span class="w"> </span><span class="o">(</span>pcieport<span class="o">)</span>
<a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="w">            </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3d:00.1<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x0d58<span class="o">)]</span><span class="w"> </span><span class="o">(</span>i40e<span class="o">)</span>
<a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="w">            </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3d:00.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x0d58<span class="o">)]</span><span class="w"> </span><span class="o">(</span>i40e<span class="o">)</span>
<a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="w">        </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:3c:10.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x10b5,<span class="w"> </span>0x8747<span class="o">)]</span><span class="w"> </span><span class="o">(</span>pcieport<span class="o">)</span>
<a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a><span class="w">            </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:41:00.0<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x0d58<span class="o">)]</span><span class="w"> </span><span class="o">(</span>i40e<span class="o">)</span>
<a id="__codelineno-91-13" name="__codelineno-91-13" href="#__codelineno-91-13"></a><span class="w">            </span><span class="o">[</span>pci_address<span class="o">(</span><span class="m">0000</span>:41:00.1<span class="o">)</span>,<span class="w"> </span>pci_id<span class="o">(</span>0x8086,<span class="w"> </span>0x0d58<span class="o">)]</span><span class="w"> </span><span class="o">(</span>i40e<span class="o">)</span>
</code></pre></div>
<p align = "center">Figure 87 pci_device topology</p>

<p>The green output indicates the target device.  The other endpoint devices are shown in blue.</p>
<h5 id="5326-pci_device-vf-subcommand"><strong>5.3.2.6 pci_device vf subcommand</strong><a class="headerlink" href="#5326-pci_device-vf-subcommand" title="Permanent link">&para;</a></h5>
<p>The vf subcommand allows setting the value of the sriov_numvfs sysfs node of the target device.  This is useful in scenarios where device functionality is presented in the form of one or more PCIe Virtual Functions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="c1"># pci_device 0000:b2:00.0 vf 3</span>
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="c1"># pci_device 0000:b2:00.0 vf 0</span>
</code></pre></div>
<p align = "center">Figure 88 pci_device vf</p>

<h4 id="533-rsu"><strong>5.3.3 rsu</strong><a class="headerlink" href="#533-rsu" title="Permanent link">&para;</a></h4>
<p>rsu is a utility that performs Remote System Update.  rsu is used subsequent to programming a firmware update or other supported file type with fpgasupdate, in order to reset the targeted FPGA entity so that a newly-loaded firmware image becomes active.</p>
<h5 id="5331-rsu-bmc-subcommand"><strong>5.3.3.1 rsu bmc subcommand</strong><a class="headerlink" href="#5331-rsu-bmc-subcommand" title="Permanent link">&para;</a></h5>
<p>The bmc subcommand causes a Board Management Controller reset.  This command is used to apply a previous fpgasupdate of a <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> firmware image.  The --page argument selects the desired boot image.  Valid values for --page are ‘user’ and ‘factory’.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="c1"># rsu bmc --page user 0000:b2:00.0</span>
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="c1"># rsu bmc --page factory 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 89 rsu bmc</p>

<h5 id="5332-rsu-retimer-subcommand"><strong>5.3.3.2 rsu retimer subcommand</strong><a class="headerlink" href="#5332-rsu-retimer-subcommand" title="Permanent link">&para;</a></h5>
<p>The retimer subcommand causes a Parkvale reset (specific to Vista Creek).  This command is used to apply a previous fpgasupdate of a <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> firmware image (the Parkvale firmware is contained within the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> firmware image).  The retimer subcommand causes only the Parkvale to reset.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="c1"># rsu retimer 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 90 rsu retimer</p>

<h5 id="5333-rsu-fpga-subcommand"><strong>5.3.3.3 rsu fpga subcommand</strong><a class="headerlink" href="#5333-rsu-fpga-subcommand" title="Permanent link">&para;</a></h5>
<p>The fpga subcommand causes a reconfiguration of the FPGA Static Region.  This command is used to apply a previous fpgasupdate of the Static Region image.  The --page argument selects the desired boot image.  Valid values for --page are ‘user1’, ‘user2’, and ‘factory’.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="c1"># rsu fpga --page user1 0000:b2:00.0</span>
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="c1"># rsu fpga --page user2 0000:b2:00.0</span>
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="c1"># rsu fpga --page factory 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 91 rsu fpga</p>

<h5 id="5334-rsu-sdm-subcommand"><strong>5.3.3.4 rsu sdm subcommand</strong><a class="headerlink" href="#5334-rsu-sdm-subcommand" title="Permanent link">&para;</a></h5>
<p>The sdm subcommand causes a reset of the Secure Device Manager.  This command is used to apply a previous fpgasupdate of the SDM image.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="c1"># rsu sdm 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 92 rsu sdm</p>

<h5 id="5335-rsu-fpgadefault-subcommand"><strong>5.3.3.5 rsu fpgadefault subcommand</strong><a class="headerlink" href="#5335-rsu-fpgadefault-subcommand" title="Permanent link">&para;</a></h5>
<p>The fpgadefault subcommand can be used to display the default FPGA boot sequence; and it can be used to select the image to boot on the next reset of the FPGA.
When given without additional parameters, the fpgadefault subcommand displays the default FPGA boot sequence:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="c1"># rsu fpgadefault 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 93 rsu Displaying FPGA Boot Sequence</p>

<p>The parameters to the fpgadefault subcommand are --page and --fallback.  The --page parameter accepts ‘user1’, ‘user2’, or ‘factory’, specifying the desired page to boot the FPGA from on the next reset.  Note that this subcommand does not actually cause the reset to occur.  Please refer to rsu fpga subcommand for an example of resetting the FPGA using the rsu command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="c1"># rsu fpgadefault --page user1 0000:b2:00.0</span>
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="c1"># rsu fpgadefault --page user2 0000:b2:00.0</span>
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="c1"># rsu fpgadefault --page factory 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 94 rsu Select FPGA Boot Image</p>

<p>The --fallback parameter accepts a comma-separated list of the keywords ‘user1’, ‘user2’, and ‘factory’.  These keywords, in conjunction with the --page value are used to determine a fallback boot sequence for the FPGA.
The fallback boot sequence is used to determine which FPGA image to load in the case of a boot failure.  For example, given the following command, the FPGA would attempt to boot in the order ‘factory’, ‘user1’, ‘user2’.  That is to say, if the ‘factory’ image failed to boot, then the ‘user1’ image would be tried.  Failing to boot ‘user1’, the ‘user2’ image would be tried.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="c1"># rsu fpgadefault --page factory --fallback user1,user2 0000:b2:00.0</span>
</code></pre></div>
<p align = "center">Figure 95 rsu Select FPGA Boot Image and Fallback</p>

<h2 id="60-sample-applications"><strong>6.0 Sample Applications</strong><a class="headerlink" href="#60-sample-applications" title="Permanent link">&para;</a></h2>
<h3 id="61-afu-test-framework"><strong>6.1 afu-test Framework</strong><a class="headerlink" href="#61-afu-test-framework" title="Permanent link">&para;</a></h3>
<p>afu-test refers to a test-writing framework that exists as a set of C++
classes written on top of the OPAE C++ bindings. The first class,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/afu-test/afu_test.h#L151-L341">afu</a>,
serves as the base class for the test application abstraction. Class
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/afu-test/afu_test.h#L151-L341">afu</a>
provides integration with <a href="https://github.com/CLIUtils/CLI11">CLI11</a>, a
C++ ’11 command-line parsing framework, and with
<a href="https://github.com/gabime/spdlog">spdlog</a>, a C++ logging library. The
second class,
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/afu-test/afu_test.h#L113-L132">command</a>
represents a unique test sequence that is called by the afu object.
Instances of the
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/afu-test/afu_test.h#L113-L132">command</a>
class implement the test-specific workload.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">afu</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="n">afu</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">afu_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span>
<a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">log_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">open_handle</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">afu_id</span><span class="p">);</span>
<a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[]);</span>
<a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">CLI</span><span class="o">::</span><span class="n">App</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="n">command</span><span class="o">::</span><span class="n">ptr_t</span><span class="w"> </span><span class="n">test</span><span class="p">);</span>
<a id="__codelineno-100-9" name="__codelineno-100-9" href="#__codelineno-100-9"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-100-10" name="__codelineno-100-10" href="#__codelineno-100-10"></a><span class="n">CLI</span><span class="o">::</span><span class="n">App</span><span class="w"> </span><span class="o">*</span><span class="n">register_command</span><span class="p">();</span>
<a id="__codelineno-100-11" name="__codelineno-100-11" href="#__codelineno-100-11"></a><span class="p">};</span>
</code></pre></div>
<p align = "center">Figure 96 C++ class afu</p>

<p>The afu class constructor initializes the CLI11 command parser with some
general, application-wide parameters.</p>
<table>
<thead>
<tr>
<th>Subcommand</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-g,--guid</td>
<td>Accelerator <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> ID.</td>
</tr>
<tr>
<td>-p,--pci-address</td>
<td>Address of the accelerator device.</td>
</tr>
<tr>
<td>-l,--log-level</td>
<td>Requested spdlog output level.</td>
</tr>
<tr>
<td>-s,--shared</td>
<td>Open the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in shared mode?</td>
</tr>
<tr>
<td>-t,--timeout</td>
<td>Application timeout in milliseconds.</td>
</tr>
</tbody>
</table>
<p align = "center">Figure 97 class afu Application Parameters</p>

<p>The register_command() member function adds a test
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/afu-test/afu_test.h#L113-L132">command</a>
instance to the afu object. Each test command that an afu object is
capable of executing is registered during the test’s startup code. For
instance, here is the
<a href="https://github.com/OFS/opae-sdk/blob/master/samples/hssi/hssi.cpp#L51-L54">hssi</a>
application’s use of register_command():</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="n">hssi_afu</span><span class="w"> </span><span class="n">app</span><span class="p">;</span>
<a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="p">{</span>
<a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="n">app</span><span class="p">.</span><span class="n">register_command</span><span class="o">&lt;</span><span class="n">hssi_10g_cmd</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a><span class="n">app</span><span class="p">.</span><span class="n">register_command</span><span class="o">&lt;</span><span class="n">hssi_100g_cmd</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a><span class="n">app</span><span class="p">.</span><span class="n">register_command</span><span class="o">&lt;</span><span class="n">hssi_pkt_filt_10g_cmd</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a><span class="n">app</span><span class="p">.</span><span class="n">register_command</span><span class="o">&lt;</span><span class="n">hssi_pkt_filt_100g_cmd</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a><span class="err">…</span>
<a id="__codelineno-101-9" name="__codelineno-101-9" href="#__codelineno-101-9"></a><span class="n">app</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<a id="__codelineno-101-10" name="__codelineno-101-10" href="#__codelineno-101-10"></a><span class="p">}</span>
</code></pre></div>
<p align = "center">Figure 98 hssi's app.register_command()</p>

<p>Next, the afu instance’s main() member function is called. main()
initializes the spdlog instance, searches its database of registered
commands to find the command matching the test requested from the
command prompt, uses the open_handle() member function to enumerate for
the requested <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> ID, and calls its run() member function, passing the
CLI::App and the test command variables. The run() member function
initializes a test timeout mechanism, then calls the command parameter’s
run() to invoke the test-specific logic.</p>
<p>With all the boiler-plate of application startup, configuration, and
running handled by the afu class, the test-specific
<a href="https://github.com/OFS/opae-sdk/blob/master/libraries/afu-test/afu_test.h#L113-L132">command</a>
class is left to implement only a minimum number of member functions:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">command</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">description</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">afu</span><span class="w"> </span><span class="o">*</span><span class="n">afu</span><span class="p">,</span><span class="w"> </span><span class="n">CLI</span><span class="o">::</span><span class="n">App</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">add_options</span><span class="p">(</span><span class="n">CLI</span><span class="o">::</span><span class="n">App</span><span class="w"> </span><span class="o">*</span><span class="n">app</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a><span class="k">virtual</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">afu_id</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-102-8" name="__codelineno-102-8" href="#__codelineno-102-8"></a><span class="p">};</span>
</code></pre></div>
<p align = "center">Figure 99 class command</p>

<p>The name() member function gives the unique command name. Some examples
of names from the hssi app are hssi_10g, hssi_100g, pkt_filt_10g,
and pkt_filt_100g. The description() member function gives a brief
description that is included in the command-specific help output.
add_options() adds command-specific command-line options. afu_id()
gives the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> ID for the command, in string form. Finally, run()
implements the command-specific test functionality.</p>
<h3 id="62-afu-test-based-samples"><strong>6.2 afu-test Based Samples</strong><a class="headerlink" href="#62-afu-test-based-samples" title="Permanent link">&para;</a></h3>
<h4 id="621-dummy_afu"><strong>6.2.1 dummy_afu</strong><a class="headerlink" href="#621-dummy_afu" title="Permanent link">&para;</a></h4>
<p>The dummy_afu application is a afu-test based application that
implements three commands: mmio, ddr, and lpbk.</p>
<table>
<thead>
<tr>
<th>Target</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td># dummy_afu <a href="https://github.com/OFS/opae-sdk/blob/master/samples/dummy_afu/mmio.h#L131-L152">mmio</a></td>
<td>Targets special scratchpad area implemented by the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</td>
</tr>
<tr>
<td># dummy_afu <a href="https://github.com/OFS/opae-sdk/blob/master/samples/dummy_afu/ddr.h#L60-L103">ddr</a></td>
<td>Execute dummy_afu-specific DDR test.</td>
</tr>
<tr>
<td># dummy_afu <a href="https://github.com/OFS/opae-sdk/blob/master/samples/dummy_afu/lpbk.h#L50-L65">lpbk</a></td>
<td>Execute a simple loopback test.</td>
</tr>
</tbody>
</table>
<h4 id="622-host_exerciser"><strong>6.2.2 host_exerciser</strong><a class="headerlink" href="#622-host_exerciser" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/doc/src/fpga_tools/host_exerciser/host_exerciser.md">host_exerciser</a>
markdown document.</p>
<h4 id="623-hssi"><strong>6.2.3 hssi</strong><a class="headerlink" href="#623-hssi" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/doc/src/fpga_tools/hssi/hssi.md">hssi</a>
markdown document.</p>
<h2 id="70-other-utilities"><strong>7.0 Other Utilities</strong><a class="headerlink" href="#70-other-utilities" title="Permanent link">&para;</a></h2>
<h3 id="71-opaeio"><strong>7.1 opae.io</strong><a class="headerlink" href="#71-opaeio" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/doc/src/fpga_tools/opae.io/opae.io.md">opae.io</a>
markdown document.</p>
<h3 id="72-bitstreaminfo"><strong>7.2 bitstreaminfo</strong><a class="headerlink" href="#72-bitstreaminfo" title="Permanent link">&para;</a></h3>
<p>The bitstreaminfo command prints diagnostic information about firmware
image files that have been passed through the PACSign utility. PACSign
prepends secure block 0 and secure block 1 data headers to the images
that it processes. These headers contain signature hashes and other
metadata that are consumed by the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> firmware during a secure update.</p>
<p>To run bitstreaminfo, pass the path to the desired firmware image file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="c1"># bitstreaminfo my_file.bin </span>
</code></pre></div>
<p align = "center">Figure 100 Running bitstreaminfo</p>

<h3 id="73-fpgareg"><strong>7.3 fpgareg</strong><a class="headerlink" href="#73-fpgareg" title="Permanent link">&para;</a></h3>
<p>The fpgareg command prints the register spaces for the following fpga
device components:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td># fpgareg 0000:b1:00.0 pcie</td>
<td>Walks and prints the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> for the device.</td>
</tr>
<tr>
<td># fpgareg 0000:b1:00.0 bmc</td>
<td>Prints the <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> registers for the device.</td>
</tr>
<tr>
<td># fpgareg 0000:b1:00.0 hssi</td>
<td>Prints the HSSI registers for the device.</td>
</tr>
<tr>
<td># fpgareg 0000:b1:00.0 acc</td>
<td>Prints the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> register spaces.</td>
</tr>
</tbody>
</table>
<p align = "center">Figure 101 fpgareg Commands</p>

<p>Note that fpgareg is only available as of Arrow Creek ADP and forward.
It will not work with prior platforms, eg N3000.</p>
<h3 id="74-opaevfio"><strong>7.4 opaevfio</strong><a class="headerlink" href="#74-opaevfio" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/OFS/opae-sdk/blob/master/doc/src/fpga_tools/opaevfio/opaevfio.md">opaevfio</a>
markdown document.</p>
<h2 id="80-opae-build-configurations"><strong>8.0 OPAE Build Configurations</strong><a class="headerlink" href="#80-opae-build-configurations" title="Permanent link">&para;</a></h2>
<p>Refer to the software installation guides on this website for detailed instructions and building and installing both the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> and Linux <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver set for any given release. The following section has been included to provide more information on the build targets for the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers.</p>
<h3 id="81-cmake-options"><strong>8.1 CMake Options</strong><a class="headerlink" href="#81-cmake-options" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr class="header">
<th>Option</th>
<th>Description</th>
<th>Values</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-DCMAKE_BUILD_TYPE</td>
<td>Configure debugging info</td>
<td><p>Debug</p>
<p>Release</p>
<p>Coverage</p>
<p>RelWithDebInfo</p></td>
<td>RelWithDebInfo</td>
</tr>
<tr class="even">
<td>-DCMAKE_INSTALL_PREFIX</td>
<td>Root install path</td>
<td><varies></td>
<td>/usr/local</td>
</tr>
<tr class="odd">
<td>-DOPAE_BUILD_SPHINX_DOC</td>
<td>Enable/Disable docs</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="even">
<td>-DOPAE_BUILD_TESTS</td>
<td>Enable/Disable unit tests</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="odd">
<td>-DOPAE_ENABLE_MOCK</td>
<td>Enable/Disable mock driver for unit tests</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="even">
<td>-DOPAE_INSTALL_RPATH</td>
<td>Enable/Disable rpath for install</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="odd">
<td>-DOPAE_VERSION_LOCAL</td>
<td>Local version string</td>
<td><varies></td>
<td><none></td>
</tr>
<tr class="even">
<td>-DOPAE_PRESERVE_REPOS</td>
<td>Preserve local changes to external repos?</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="odd">
<td>-D OPAE_BUILD_LIBOPAE_CXX</td>
<td>Enable C++ bindings</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="even">
<td>-DOPAE_WITH_PYBIND11</td>
<td>Enable pybind11</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="odd">
<td>-D OPAE_BUILD_PYTHON_DIST</td>
<td>Enable Python bindings</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="even">
<td>-DOPAE_BUILD_LIBOPAEVFIO</td>
<td>Build libopaevfio.so</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="odd">
<td>-D OPAE_BUILD_PLUGIN_VFIO</td>
<td>Build libopae-v.so</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="even">
<td>-DOPAE_BUILD_LIBOPAEUIO</td>
<td>Build libopaeuio.so</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="odd">
<td>-DOPAE_BUILD_LIBOFS</td>
<td>Build OFS Copy Engine</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="even">
<td>-DOPAE_BUILD_SAMPLES</td>
<td>Build Samples</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="odd">
<td>-DOPAE_BUILD_LEGACY</td>
<td>Build legacy repo</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
<tr class="even">
<td>-DOPAE_LEGACY_TAG</td>
<td>Specify legacy build tag</td>
<td><varies></td>
<td>master</td>
</tr>
<tr class="odd">
<td>-DOPAE_WITH_CLI11</td>
<td>Enable apps which use CLI11</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="even">
<td>-DOPAE_WITH_SPDLOG</td>
<td>Enable apps which use spdlog</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="odd">
<td>-DOPAE_WITH_LIBEDIT</td>
<td>Enable apps which use libedit</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="even">
<td>-DOPAE_WITH_HWLOC</td>
<td>Enable apps which use hwloc</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="odd">
<td>-DOPAE_WITH_TBB</td>
<td>Enable apps which use Thread Building Blocks</td>
<td>ON/OFF</td>
<td>ON</td>
</tr>
<tr class="even">
<td>-DOPAE_MINIMAL_BUILD</td>
<td>Enable/Disable minimal build. When set to ON, disable CLI11, spdlog, libedit, hwloc, tbb</td>
<td>ON/OFF</td>
<td>OFF</td>
</tr>
</tbody>
</table>

<p align = "center">Table 12 CMake Options</p>

<h3 id="82-building-opae-for-debug"><strong>8.2 Building OPAE for Debug:</strong><a class="headerlink" href="#82-building-opae-for-debug" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>$<span class="w"> </span>cmake<span class="w"> </span>..<span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Debug
</code></pre></div>
<h3 id="83-creating-opae-packages"><strong>8.3 Creating OPAE Packages</strong><a class="headerlink" href="#83-creating-opae-packages" title="Permanent link">&para;</a></h3>
<p>To ease the RPM creation process, the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> provides a simple RPM
creation script. The parameter to the RPM create script for either Fedora or RHEL is <code>unrestricted</code> 
For rhel, the build flag -DOPAE_MINIMAL_BUILD is set to ON, omitting the binaries which
have dependencies on external components that RHEL does not include in
its base repositories.</p>
<p>In order to create RPMs for Fedora, run the create script on a system
loaded with all the Fedora build prerequisites. If prerequisites are
missing, the create script will complain until they are resolved.</p>
<p>In order to create RPMs for RHEL, run the create script on a system
loaded with all the RHEL build prerequisites. If prerequisites are
missing, the create script will complain until they are resolved.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>opae-sdk
<a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a>$<span class="w"> </span>./packaging/opae/rpm/create<span class="w"> </span>unrestriected
</code></pre></div>
<h3 id="84-updating-the-rpm-version-information"><strong>8.4 Updating the RPM Version Information</strong><a class="headerlink" href="#84-updating-the-rpm-version-information" title="Permanent link">&para;</a></h3>
<p>The RPMs will be versioned according to the information found in the
file
<a href="https://github.com/OFS/opae-sdk/blob/master/packaging/opae/version#L27-L28">packaging/opae/version</a>.
If you edit this file to update the version information, then re-run the create script to create the RPMs.</p>
<h2 id="90-debugging-opae"><strong>9.0 Debugging OPAE</strong><a class="headerlink" href="#90-debugging-opae" title="Permanent link">&para;</a></h2>
<h3 id="91-enabling-debug-logging"><strong>9.1   Enabling Debug Logging</strong><a class="headerlink" href="#91-enabling-debug-logging" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> has a built-in debug logging facility.  To enable it, set the cmake flag <code>-DCMAKE_BUILD_TYPE=Debug</code> and then use the following environment variables:
| Variable| Description|
| ----- | ----- |
|LIBOPAE_LOG=1| Enable debug logging output.  When not set, only critical error messages are displayed.|
|LIBOPAE_LOGFILE=file.log|  Capture debug log output to file.log.  When not set, the logging appears on stdout and stderr.  The file must appear in a relative path or it can be rooted at /tmp.|</p>
<p align = "center"> Table 13 Logging Environment Variables</p>

<h3 id="92-gdb"><strong>9.2 GDB</strong><a class="headerlink" href="#92-gdb" title="Permanent link">&para;</a></h3>
<p>To enable gdb-based debugging, the cmake configuration step must specify a value for -DCMAKE_BUILD_TYPE of either Debug or RelWithDebInfo so that debug symbols are included in the output binaries.
The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> makes use of dynamically-loaded library modules.  When debugging with gdb, the best practice is to remove all <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> libraries from the system installation paths to ensure that library modules are only loaded from the local build tree:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>opae-sdk/build
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a>$<span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$PWD</span>/lib<span class="w"> </span>gdb<span class="w"> </span>--args<span class="w"> </span>&lt;some_opae_executable&gt;<span class="w"> </span>&lt;args&gt;
</code></pre></div>
<p align = "center">Figure 103 Debugging with GDB</p>

<h2 id="100-adding-new-device-support"><strong>10.0 Adding New Device Support</strong><a class="headerlink" href="#100-adding-new-device-support" title="Permanent link">&para;</a></h2>
<p>As of OPAE 2.2.0 the SDK has transitioned to a single configuration file model.  The libraries, plugins, and applications obtain their runtime configuration during startup by examining a single JSON configuration file.  In doing so, the original configuration file formats for libopae-c and fpgad have been deprecated in favor of the respective sections in the new configuration file. </p>
<h3 id="101-configuration-file-search-order"><strong>10.1 Configuration File Search Order</strong><a class="headerlink" href="#101-configuration-file-search-order" title="Permanent link">&para;</a></h3>
<p>By default the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> will install its configuration file to /etc/opae/opae.cfg. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">opae</span><span class="o">/</span><span class="n">opae</span><span class="p">.</span><span class="n">cfg</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 104 Default Configuration File</p>

<p>The SDK searches for the configuration file during startup by employing the following search algorithm: </p>
<p>First, the environment variable LIBOPAE_CFGFILE is examined.  If it is set to a path that represents a valid path to a configuration file, then that configuration file path is used, and the search is complete. </p>
<p>Next, the HOME environment variable is examined.  If its value is valid, then it is prepended to the following set of relative paths.  If HOME is not set, then the search continues with the value of the current user’s home path as determined by getpwuid().  The home path, if any, determined by getpwuid() is prepended to the following set of relative paths.  Searching completes successfully if any of these home-relative search paths is valid. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="o">/</span><span class="p">.</span><span class="n">local</span><span class="o">/</span><span class="n">opae</span><span class="p">.</span><span class="n">cfg</span><span class="w"> </span>
<a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a>
<a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="o">/</span><span class="p">.</span><span class="n">local</span><span class="o">/</span><span class="n">opae</span><span class="o">/</span><span class="n">opae</span><span class="p">.</span><span class="n">cfg</span><span class="w"> </span>
<a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a>
<a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a><span class="o">/</span><span class="p">.</span><span class="n">config</span><span class="o">/</span><span class="n">opae</span><span class="o">/</span><span class="n">opae</span><span class="p">.</span><span class="n">cfg</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 105 HOME Relative Search Paths</p>

<p>Finally, the configuration file search continues with the following system-wide paths.  If any of these paths is found to contain a configuration file, then searching completes successfully. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">opae</span><span class="o">/</span><span class="n">opae</span><span class="p">.</span><span class="n">cfg</span><span class="w"> </span>
<a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a>
<a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">opae</span><span class="o">/</span><span class="n">opae</span><span class="p">.</span><span class="n">cfg</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 106 System Search Paths</p>

<p>If the search exhausts all of the possible configuration file locations without finding a configuration file, then an internal default configuration is used.  This internal default configuration matches that of the opae.cfg file shipped with the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr>. </p>
<h3 id="102-configuration-file-format"><strong>10.2 Configuration File Format</strong><a class="headerlink" href="#102-configuration-file-format" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> configuration file is stored in JSON formatted text.  The file has two main sections: “configs” and “configurations”.  The “configs” section is an array of strings.  Each value in the “configs” array is a key into the data stored in the “configurations” section.  If a key is present in “configs”, then that key is searched for and processed in “configurations”.  If the key is not found in “configs”, then that section of “configurations” will not be processed, irrespective of whether it exists in “configurations”. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>
<a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a>
<a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a>
<a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="w">      </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a>
<a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a>
<a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a>
<a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a><span class="w">  </span><span class="err">“</span><span class="n">configs</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a>
<a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="w"> </span>
<a id="__codelineno-110-16" name="__codelineno-110-16" href="#__codelineno-110-16"></a>
<a id="__codelineno-110-17" name="__codelineno-110-17" href="#__codelineno-110-17"></a><span class="w">  </span><span class="p">]</span><span class="w"> </span>
<a id="__codelineno-110-18" name="__codelineno-110-18" href="#__codelineno-110-18"></a>
<a id="__codelineno-110-19" name="__codelineno-110-19" href="#__codelineno-110-19"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 107 Keyed Configurations</p>

<p>Each keyed section in “configurations” has four top-level entries: “enabled”, “platform”, “devices”, “opae”. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a>
<a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a>
<a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a>
<a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a><span class="w">      </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a>
<a id="__codelineno-111-9" name="__codelineno-111-9" href="#__codelineno-111-9"></a><span class="w">      </span><span class="err">“</span><span class="n">platform</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">Intel</span><span class="w"> </span><span class="n">Acceleration</span><span class="w"> </span><span class="n">Development</span><span class="w"> </span><span class="n">Platform</span><span class="w"> </span><span class="n">C6100</span><span class="err">”</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-111-10" name="__codelineno-111-10" href="#__codelineno-111-10"></a>
<a id="__codelineno-111-11" name="__codelineno-111-11" href="#__codelineno-111-11"></a><span class="w">      </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-111-12" name="__codelineno-111-12" href="#__codelineno-111-12"></a>
<a id="__codelineno-111-13" name="__codelineno-111-13" href="#__codelineno-111-13"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="err">“</span><span class="n">name</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="err">“</span><span class="n">id</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-111-14" name="__codelineno-111-14" href="#__codelineno-111-14"></a>
<a id="__codelineno-111-15" name="__codelineno-111-15" href="#__codelineno-111-15"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="err">“</span><span class="n">name</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_vf</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="err">“</span><span class="n">id</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-111-16" name="__codelineno-111-16" href="#__codelineno-111-16"></a>
<a id="__codelineno-111-17" name="__codelineno-111-17" href="#__codelineno-111-17"></a><span class="w">      </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-111-18" name="__codelineno-111-18" href="#__codelineno-111-18"></a>
<a id="__codelineno-111-19" name="__codelineno-111-19" href="#__codelineno-111-19"></a><span class="w">      </span><span class="err">“</span><span class="n">opae</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-111-20" name="__codelineno-111-20" href="#__codelineno-111-20"></a>
<a id="__codelineno-111-21" name="__codelineno-111-21" href="#__codelineno-111-21"></a><span class="w">        </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-111-22" name="__codelineno-111-22" href="#__codelineno-111-22"></a>
<a id="__codelineno-111-23" name="__codelineno-111-23" href="#__codelineno-111-23"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-111-24" name="__codelineno-111-24" href="#__codelineno-111-24"></a>
<a id="__codelineno-111-25" name="__codelineno-111-25" href="#__codelineno-111-25"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-111-26" name="__codelineno-111-26" href="#__codelineno-111-26"></a>
<a id="__codelineno-111-27" name="__codelineno-111-27" href="#__codelineno-111-27"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-111-28" name="__codelineno-111-28" href="#__codelineno-111-28"></a>
<a id="__codelineno-111-29" name="__codelineno-111-29" href="#__codelineno-111-29"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 108 Configurations Format</p>

<p>The “enabled” key holds a Boolean value.  If the value is false or if the “enabled” key is omitted, then that configuration is skipped when parsing the file.  The “platform” key holds a string that identifies the current configuration item as a product family.  The “devices” key contains the device descriptions. </p>
<p>“devices” is an array of objects that contain a “name” and an “id” key.  The “name” is a shorthand descriptor for a device PF or VF.  The value of “name” appears elsewhere in the current “configurations” section in order to uniquely identify the device.  “id” is an array of four strings, corresponding to the PCIe Vendor ID, Device ID, Subsystem Vendor ID, and Subsystem Device ID of the device.  The entries corresponding to Vendor ID and Device ID must contain valid 16-bit hex integers.  The entries corresponding to Subsystem Vendor ID and Subsystem Device ID may be 16-bit hex integers or the special wildcard string “*”, which indicates a don’t care condition. </p>
<p>The remaining sections in this chapter outline the format of the “opae” configurations key. </p>
<p>“plugin”: libopae-c and libopae-v </p>
<p>The “plugin” key in the “opae” section of a configuration is an array of <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> plugin configuration data.  Each item in the array matches one or more PF or VF devices to a plugin library module. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a>
<a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a>
<a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a>
<a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="w">      </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a>
<a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a><span class="w">      </span><span class="err">“</span><span class="n">opae</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a>
<a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a><span class="w">        </span><span class="err">“</span><span class="n">plugin</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-112-12" name="__codelineno-112-12" href="#__codelineno-112-12"></a>
<a id="__codelineno-112-13" name="__codelineno-112-13" href="#__codelineno-112-13"></a><span class="w">          </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-112-14" name="__codelineno-112-14" href="#__codelineno-112-14"></a>
<a id="__codelineno-112-15" name="__codelineno-112-15" href="#__codelineno-112-15"></a><span class="w">            </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-112-16" name="__codelineno-112-16" href="#__codelineno-112-16"></a>
<a id="__codelineno-112-17" name="__codelineno-112-17" href="#__codelineno-112-17"></a><span class="w">            </span><span class="err">“</span><span class="n">module</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">libxfpga</span><span class="p">.</span><span class="n">so</span><span class="err">”</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-112-18" name="__codelineno-112-18" href="#__codelineno-112-18"></a>
<a id="__codelineno-112-19" name="__codelineno-112-19" href="#__codelineno-112-19"></a><span class="w">            </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="w"> </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-112-20" name="__codelineno-112-20" href="#__codelineno-112-20"></a>
<a id="__codelineno-112-21" name="__codelineno-112-21" href="#__codelineno-112-21"></a><span class="w">            </span><span class="err">“</span><span class="n">configuration</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
<a id="__codelineno-112-22" name="__codelineno-112-22" href="#__codelineno-112-22"></a>
<a id="__codelineno-112-23" name="__codelineno-112-23" href="#__codelineno-112-23"></a><span class="w">          </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-112-24" name="__codelineno-112-24" href="#__codelineno-112-24"></a>
<a id="__codelineno-112-25" name="__codelineno-112-25" href="#__codelineno-112-25"></a><span class="w">          </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-112-26" name="__codelineno-112-26" href="#__codelineno-112-26"></a>
<a id="__codelineno-112-27" name="__codelineno-112-27" href="#__codelineno-112-27"></a><span class="w">            </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-112-28" name="__codelineno-112-28" href="#__codelineno-112-28"></a>
<a id="__codelineno-112-29" name="__codelineno-112-29" href="#__codelineno-112-29"></a><span class="w">            </span><span class="err">“</span><span class="n">module</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">libopae</span><span class="o">-</span><span class="n">v</span><span class="p">.</span><span class="n">so</span><span class="err">”</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-112-30" name="__codelineno-112-30" href="#__codelineno-112-30"></a>
<a id="__codelineno-112-31" name="__codelineno-112-31" href="#__codelineno-112-31"></a><span class="w">            </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_vf</span><span class="err">”</span><span class="w"> </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-112-32" name="__codelineno-112-32" href="#__codelineno-112-32"></a>
<a id="__codelineno-112-33" name="__codelineno-112-33" href="#__codelineno-112-33"></a><span class="w">            </span><span class="err">“</span><span class="n">configuration</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
<a id="__codelineno-112-34" name="__codelineno-112-34" href="#__codelineno-112-34"></a>
<a id="__codelineno-112-35" name="__codelineno-112-35" href="#__codelineno-112-35"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-112-36" name="__codelineno-112-36" href="#__codelineno-112-36"></a>
<a id="__codelineno-112-37" name="__codelineno-112-37" href="#__codelineno-112-37"></a><span class="w">        </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-112-38" name="__codelineno-112-38" href="#__codelineno-112-38"></a>
<a id="__codelineno-112-39" name="__codelineno-112-39" href="#__codelineno-112-39"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-112-40" name="__codelineno-112-40" href="#__codelineno-112-40"></a>
<a id="__codelineno-112-41" name="__codelineno-112-41" href="#__codelineno-112-41"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-112-42" name="__codelineno-112-42" href="#__codelineno-112-42"></a>
<a id="__codelineno-112-43" name="__codelineno-112-43" href="#__codelineno-112-43"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-112-44" name="__codelineno-112-44" href="#__codelineno-112-44"></a>
<a id="__codelineno-112-45" name="__codelineno-112-45" href="#__codelineno-112-45"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 109 "opae" / "plugin" key/</p>

<p>If the “enabled” key is false or if it is omitted, then that “plugin” array entry is skipped, and parsing continues.  The “module” key is a string that identifies the desired plugin module library for the entry.  The “devices” array lists one or more PF/VF identifiers.  Each array value must be a string, and it must match a device that is described in the “configurations” “devices” section.  The “configuration” key of the “plugin” section specifies a unique plugin-specific configuration.  Currently, libopae-c and libopae-v use no plugin-specific config, so these keys are left empty. </p>
<p>“fpgainfo”: fpgainfo application </p>
<p>The “fpgainfo” key in the “opae” section of a configuration is an array of fpgainfo plugin configuration data.  Each item in the array matches one or more PF or VF devices to an fpgainfo plugin library module. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a>
<a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a>
<a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a>
<a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="w">      </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a>
<a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a><span class="w">      </span><span class="err">“</span><span class="n">opae</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a>
<a id="__codelineno-113-11" name="__codelineno-113-11" href="#__codelineno-113-11"></a><span class="w">        </span><span class="err">“</span><span class="n">fpgainfo</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-113-12" name="__codelineno-113-12" href="#__codelineno-113-12"></a>
<a id="__codelineno-113-13" name="__codelineno-113-13" href="#__codelineno-113-13"></a><span class="w">          </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-113-14" name="__codelineno-113-14" href="#__codelineno-113-14"></a>
<a id="__codelineno-113-15" name="__codelineno-113-15" href="#__codelineno-113-15"></a><span class="w">            </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-113-16" name="__codelineno-113-16" href="#__codelineno-113-16"></a>
<a id="__codelineno-113-17" name="__codelineno-113-17" href="#__codelineno-113-17"></a><span class="w">            </span><span class="err">“</span><span class="n">module</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">libboard_c6100</span><span class="p">.</span><span class="n">so</span><span class="err">”</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-113-18" name="__codelineno-113-18" href="#__codelineno-113-18"></a>
<a id="__codelineno-113-19" name="__codelineno-113-19" href="#__codelineno-113-19"></a><span class="w">            </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-113-20" name="__codelineno-113-20" href="#__codelineno-113-20"></a>
<a id="__codelineno-113-21" name="__codelineno-113-21" href="#__codelineno-113-21"></a><span class="w">              </span><span class="p">{</span><span class="w"> </span><span class="err">“</span><span class="n">device</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="err">“</span><span class="n">feature_id</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="mh">0x12</span><span class="err">”</span><span class="w"> </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-113-22" name="__codelineno-113-22" href="#__codelineno-113-22"></a>
<a id="__codelineno-113-23" name="__codelineno-113-23" href="#__codelineno-113-23"></a><span class="w">              </span><span class="p">{</span><span class="w"> </span><span class="err">“</span><span class="n">device</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_vf</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="err">“</span><span class="n">feature_id</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="mh">0x12</span><span class="err">”</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-113-24" name="__codelineno-113-24" href="#__codelineno-113-24"></a>
<a id="__codelineno-113-25" name="__codelineno-113-25" href="#__codelineno-113-25"></a><span class="w">            </span><span class="p">]</span><span class="w"> </span>
<a id="__codelineno-113-26" name="__codelineno-113-26" href="#__codelineno-113-26"></a>
<a id="__codelineno-113-27" name="__codelineno-113-27" href="#__codelineno-113-27"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-113-28" name="__codelineno-113-28" href="#__codelineno-113-28"></a>
<a id="__codelineno-113-29" name="__codelineno-113-29" href="#__codelineno-113-29"></a><span class="w">        </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-113-30" name="__codelineno-113-30" href="#__codelineno-113-30"></a>
<a id="__codelineno-113-31" name="__codelineno-113-31" href="#__codelineno-113-31"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-113-32" name="__codelineno-113-32" href="#__codelineno-113-32"></a>
<a id="__codelineno-113-33" name="__codelineno-113-33" href="#__codelineno-113-33"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-113-34" name="__codelineno-113-34" href="#__codelineno-113-34"></a>
<a id="__codelineno-113-35" name="__codelineno-113-35" href="#__codelineno-113-35"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-113-36" name="__codelineno-113-36" href="#__codelineno-113-36"></a>
<a id="__codelineno-113-37" name="__codelineno-113-37" href="#__codelineno-113-37"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 110 "opae" / "fpgainfo" key</p>

<p>If the “enabled” key is false or if it is omitted, then that “fpgainfo” array entry is skipped, and parsing continues.  The “module” key is a string that identifies the desired fpgainfo module library for the entry.  Each “devices” array entry gives a PF/VF identifier in its “device” key and a <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> feature ID in its “feature_id” key. </p>
<p>“fpgad”: fpgad daemon process </p>
<p>The “fpgad” key in the “opae” section of a configuration is an array of fpgad plugin configuration data.  Each item in the array matches one or more PF or VF devices to an fpgad plugin library module. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a>
<a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a>
<a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a>
<a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a><span class="w">      </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a>
<a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="w">      </span><span class="err">“</span><span class="n">opae</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a>
<a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a><span class="w">        </span><span class="err">“</span><span class="n">fpgad</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a>
<a id="__codelineno-114-13" name="__codelineno-114-13" href="#__codelineno-114-13"></a><span class="w">          </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-114-14" name="__codelineno-114-14" href="#__codelineno-114-14"></a>
<a id="__codelineno-114-15" name="__codelineno-114-15" href="#__codelineno-114-15"></a><span class="w">            </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-114-16" name="__codelineno-114-16" href="#__codelineno-114-16"></a>
<a id="__codelineno-114-17" name="__codelineno-114-17" href="#__codelineno-114-17"></a><span class="w">            </span><span class="err">“</span><span class="n">module</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">libfpgad</span><span class="o">-</span><span class="n">vc</span><span class="p">.</span><span class="n">so</span><span class="err">”</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-114-18" name="__codelineno-114-18" href="#__codelineno-114-18"></a>
<a id="__codelineno-114-19" name="__codelineno-114-19" href="#__codelineno-114-19"></a><span class="w">            </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="w"> </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-114-20" name="__codelineno-114-20" href="#__codelineno-114-20"></a>
<a id="__codelineno-114-21" name="__codelineno-114-21" href="#__codelineno-114-21"></a><span class="w">            </span><span class="err">“</span><span class="n">configuration</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-114-22" name="__codelineno-114-22" href="#__codelineno-114-22"></a>
<a id="__codelineno-114-23" name="__codelineno-114-23" href="#__codelineno-114-23"></a><span class="w">              </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-114-24" name="__codelineno-114-24" href="#__codelineno-114-24"></a>
<a id="__codelineno-114-25" name="__codelineno-114-25" href="#__codelineno-114-25"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-114-26" name="__codelineno-114-26" href="#__codelineno-114-26"></a>
<a id="__codelineno-114-27" name="__codelineno-114-27" href="#__codelineno-114-27"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-114-28" name="__codelineno-114-28" href="#__codelineno-114-28"></a>
<a id="__codelineno-114-29" name="__codelineno-114-29" href="#__codelineno-114-29"></a><span class="w">        </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-114-30" name="__codelineno-114-30" href="#__codelineno-114-30"></a>
<a id="__codelineno-114-31" name="__codelineno-114-31" href="#__codelineno-114-31"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-114-32" name="__codelineno-114-32" href="#__codelineno-114-32"></a>
<a id="__codelineno-114-33" name="__codelineno-114-33" href="#__codelineno-114-33"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-114-34" name="__codelineno-114-34" href="#__codelineno-114-34"></a>
<a id="__codelineno-114-35" name="__codelineno-114-35" href="#__codelineno-114-35"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-114-36" name="__codelineno-114-36" href="#__codelineno-114-36"></a>
<a id="__codelineno-114-37" name="__codelineno-114-37" href="#__codelineno-114-37"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 111 "opae" / "fpgad" key </p>

<p>If the “enabled” key is false or if it is omitted, then that “fpgad” array entry is skipped, and parsing continues.  The “module” key is a string that identifies the desired fpgad plugin module library for the entry.  The “devices” array lists one or more PF/VF identifiers.  Each array value must be a string, and it must match a device that is described in the “configurations” “devices” section.  The “configuration” key of the “fpgad” section specifies a unique plugin-specific configuration. </p>
<p>“rsu”: rsu script </p>
<p>The “rsu” key in the “opae” section of a configuration is an array of rsu script configuration data.  Each item in the array matches one or more PF devices to an rsu configuration. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a>
<a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a>
<a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a>
<a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a><span class="w">      </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a>
<a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a><span class="w">      </span><span class="err">“</span><span class="n">opae</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a>
<a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a><span class="w">        </span><span class="err">“</span><span class="n">rsu</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a>
<a id="__codelineno-115-13" name="__codelineno-115-13" href="#__codelineno-115-13"></a><span class="w">          </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-115-14" name="__codelineno-115-14" href="#__codelineno-115-14"></a>
<a id="__codelineno-115-15" name="__codelineno-115-15" href="#__codelineno-115-15"></a><span class="w">            </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-115-16" name="__codelineno-115-16" href="#__codelineno-115-16"></a>
<a id="__codelineno-115-17" name="__codelineno-115-17" href="#__codelineno-115-17"></a><span class="w">            </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="w"> </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-115-18" name="__codelineno-115-18" href="#__codelineno-115-18"></a>
<a id="__codelineno-115-19" name="__codelineno-115-19" href="#__codelineno-115-19"></a><span class="w">            </span><span class="err">“</span><span class="n">fpga_default_sequences</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="err">“</span><span class="n">common_rsu_sequences</span><span class="err">”</span><span class="w"> </span>
<a id="__codelineno-115-20" name="__codelineno-115-20" href="#__codelineno-115-20"></a>
<a id="__codelineno-115-21" name="__codelineno-115-21" href="#__codelineno-115-21"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-115-22" name="__codelineno-115-22" href="#__codelineno-115-22"></a>
<a id="__codelineno-115-23" name="__codelineno-115-23" href="#__codelineno-115-23"></a><span class="w">        </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-115-24" name="__codelineno-115-24" href="#__codelineno-115-24"></a>
<a id="__codelineno-115-25" name="__codelineno-115-25" href="#__codelineno-115-25"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-115-26" name="__codelineno-115-26" href="#__codelineno-115-26"></a>
<a id="__codelineno-115-27" name="__codelineno-115-27" href="#__codelineno-115-27"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-115-28" name="__codelineno-115-28" href="#__codelineno-115-28"></a>
<a id="__codelineno-115-29" name="__codelineno-115-29" href="#__codelineno-115-29"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-115-30" name="__codelineno-115-30" href="#__codelineno-115-30"></a>
<a id="__codelineno-115-31" name="__codelineno-115-31" href="#__codelineno-115-31"></a><span class="w">  </span><span class="err">“</span><span class="n">common_rsu_sequences</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-115-32" name="__codelineno-115-32" href="#__codelineno-115-32"></a>
<a id="__codelineno-115-33" name="__codelineno-115-33" href="#__codelineno-115-33"></a><span class="w">    </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-115-34" name="__codelineno-115-34" href="#__codelineno-115-34"></a>
<a id="__codelineno-115-35" name="__codelineno-115-35" href="#__codelineno-115-35"></a><span class="w">  </span><span class="p">]</span><span class="w"> </span>
<a id="__codelineno-115-36" name="__codelineno-115-36" href="#__codelineno-115-36"></a>
<a id="__codelineno-115-37" name="__codelineno-115-37" href="#__codelineno-115-37"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 112 "opae" / "rsu" key  </p>

<p>If the “enabled” key is false or if it is omitted, then that “rsu” array entry is skipped, and parsing continues.  When disabled, the device(s) mentioned in that array entry will not be available for the rsu command. The “devices” array lists one or more PF identifiers.  Each array value must be a string, and it must match a device that is described in the “configurations” “devices” section.  The “fpga_default_sequences” key of the “rsu” section specifies a JSON key.  The configuration searches for that JSON key at the global level of the configuration file, and when found applies its value as the valid set of fpga boot sequences that can be used with the rsu fpgadefault subcommand. </p>
<p><code>C
“fpgareg”: fpgareg script</code></p>
<p>The “fpgareg” key in the “opae” section of a configuration is an array of fpgareg script configuration data.  Each item in the array matches one or more PF/VF devices to an fpgareg configuration. </p>
<p>```C
{ </p>
<p>“configurations”: { </p>
<div class="highlight"><pre><span></span><code>“c6100”: {

  ...

  “opae”: {

    “fpgareg”: [

      {

        “enabled”: true,

        “devices”: [ “c6100_pf”, “c6100_vf” ]

      }

    ],

  }

}
</code></pre></div>
<p>}, </p>
<p>} 
 ```</p>
<p align = "center">Figure 113 "opae" / "fpgareg" key   </p>

<p>If the “enabled” key is false or if it is omitted, then that “fpgareg” array entry is skipped, and parsing continues.  When disabled, the device(s) mentioned in that array entry will not be available for the fpgareg command. The “devices” array lists one or more PF/VF identifiers.  Each array value must be a string, and it must match a device that is described in the “configurations” “devices” section.   </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="err">“</span><span class="n">opae</span><span class="p">.</span><span class="n">io</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="n">opae</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="n">application</span><span class="w"> </span>
</code></pre></div>
<p>The “opae.io” key in the “opae” section of a configuration is an array of opae.io configuration data.  Each item in the array matches one or more PF/VF devices to an opae.io platform string. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a>
<a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="w">  </span><span class="err">“</span><span class="n">configurations</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a>
<a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a><span class="w">    </span><span class="err">“</span><span class="n">c6100</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a>
<a id="__codelineno-117-7" name="__codelineno-117-7" href="#__codelineno-117-7"></a><span class="w">      </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-117-8" name="__codelineno-117-8" href="#__codelineno-117-8"></a>
<a id="__codelineno-117-9" name="__codelineno-117-9" href="#__codelineno-117-9"></a><span class="w">      </span><span class="err">“</span><span class="n">opae</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-117-10" name="__codelineno-117-10" href="#__codelineno-117-10"></a>
<a id="__codelineno-117-11" name="__codelineno-117-11" href="#__codelineno-117-11"></a><span class="w">        </span><span class="err">“</span><span class="n">opae</span><span class="p">.</span><span class="n">io</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span>
<a id="__codelineno-117-12" name="__codelineno-117-12" href="#__codelineno-117-12"></a>
<a id="__codelineno-117-13" name="__codelineno-117-13" href="#__codelineno-117-13"></a><span class="w">          </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-117-14" name="__codelineno-117-14" href="#__codelineno-117-14"></a>
<a id="__codelineno-117-15" name="__codelineno-117-15" href="#__codelineno-117-15"></a><span class="w">            </span><span class="err">“</span><span class="n">enabled</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-117-16" name="__codelineno-117-16" href="#__codelineno-117-16"></a>
<a id="__codelineno-117-17" name="__codelineno-117-17" href="#__codelineno-117-17"></a><span class="w">            </span><span class="err">“</span><span class="n">devices</span><span class="err">”</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_pf</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="err">“</span><span class="n">c6100_vf</span><span class="err">”</span><span class="w"> </span><span class="p">]</span><span class="w"> </span>
<a id="__codelineno-117-18" name="__codelineno-117-18" href="#__codelineno-117-18"></a>
<a id="__codelineno-117-19" name="__codelineno-117-19" href="#__codelineno-117-19"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-117-20" name="__codelineno-117-20" href="#__codelineno-117-20"></a>
<a id="__codelineno-117-21" name="__codelineno-117-21" href="#__codelineno-117-21"></a><span class="w">        </span><span class="p">],</span><span class="w"> </span>
<a id="__codelineno-117-22" name="__codelineno-117-22" href="#__codelineno-117-22"></a>
<a id="__codelineno-117-23" name="__codelineno-117-23" href="#__codelineno-117-23"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-117-24" name="__codelineno-117-24" href="#__codelineno-117-24"></a>
<a id="__codelineno-117-25" name="__codelineno-117-25" href="#__codelineno-117-25"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-117-26" name="__codelineno-117-26" href="#__codelineno-117-26"></a>
<a id="__codelineno-117-27" name="__codelineno-117-27" href="#__codelineno-117-27"></a><span class="w">  </span><span class="p">},</span><span class="w"> </span>
<a id="__codelineno-117-28" name="__codelineno-117-28" href="#__codelineno-117-28"></a>
<a id="__codelineno-117-29" name="__codelineno-117-29" href="#__codelineno-117-29"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p align = "center">Figure 114 "opae" / "opae.io" key    </p>

<p>If the “enabled” key is false or if it is omitted, then that “opae.io” array entry is skipped, and parsing continues.  When disabled, the device(s) mentioned in that array entry will continue to be available for the opae.io command.  The device(s) platform string will not be shown in the <code>opae.io ls</code> command.  The “devices” array lists one or more PF/VF identifiers.  Each array value must be a string, and it must match a device that is described in the “configurations” “devices” section.   </p>
<p>Libxfpga – Updating the Metrics API </p>
<p>Edit libraries/plugins/xfpga/sysfs.c.  Find the definition of the opae_id_to_hw_type() function.  Update the function to add the new vendor/device ID to hw_type mapping. </p>
<p>This mapping is used by the SDK’s metrics API to determine the method of accessing the board sensor information and is very specific to the underlying <abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr> implementation.  It may be necessary to add a new hw_type value and to update the logic in libraries/plugins/xfpga/metrics. </p>
<h2 id="110-dfl-linux-kernel-drivers"><strong>11.0 <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> Linux Kernel Drivers</strong><a class="headerlink" href="#110-dfl-linux-kernel-drivers" title="Permanent link">&para;</a></h2>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver software provides the bottom-most API to FPGA platforms. Libraries such as OPAE and frameworks such as DPDK are consumers of the APIs provided by <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>. Applications may be built on top of these frameworks and libraries. The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> software does not cover any out-of-band management interfaces. <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> driver software is designed to be extendable, flexible, and provide for bare-metal and virtualized functionality.</p>
<p>The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> driver software can be found in the <a href="https://github.com/OFS/linux-dfl"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repository - linux-dfl</a>, under the linux-dfl specific category. This repository has an associated <a href="https://github.com/OFS/linux-dfl/wiki"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repository - linux-dfl</a> that includes the following information:</p>
<ul>
<li>An description of the three available branch archetypes</li>
<li>Configuration tweaks required while building the kernel</li>
<li>A functional description of the available <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> framework</li>
<li>Descriptions for all currently available driver modules that support FPGA <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> board solutions</li>
<li>Steps to create a new <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver</li>
<li>Steps to port a <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver patch</li>
</ul>
<h3 id="111-hardware-architecture"><strong>11.1 Hardware Architecture</strong><a class="headerlink" href="#111-hardware-architecture" title="Permanent link">&para;</a></h3>
<p>The Linux Operating System treats the FPGA hardware as a PCIe* device. A predefined data structure,
Device Feature List (<abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>), allows for dynamic feature discovery in an Intel
FPGA solution.</p>
<p>The Linux Device Driver implements PCIe Single Root I/O Virtualization (<abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr>) for the creation of
Virtual Functions (VFs). The device driver can release individual accelerators
for assignment to virtual machines (VMs).</p>
<h3 id="112-fpga-management-engine-fme"><strong>11.2 FPGA Management Engine (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>)</strong><a class="headerlink" href="#112-fpga-management-engine-fme" title="Permanent link">&para;</a></h3>
<p>The FPGA Management Engine provides error reporting, reconfiguration, performance reporting, and other
infrastructure functions. Each FPGA has one <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> which is always accessed through the Physical
Function (PF). The Intel Xeon&reg; Processor with Integrated FPGA also performs power and thermal management.
These functions are not available on the Intel Programmable Acceleration Card (<abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr>).</p>
<p>User-space applications can acquire exclusive access to the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> using <code>open()</code>,
and release it using <code>close()</code>. Device access may be managed by standard Linux
interfaces and tools.</p>
<blockquote>
<p>If an application terminates without freeing the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> or Port resources, Linux closes all file descriptors owned by the terminating process, freeing those resources.</p>
</blockquote>
<h3 id="113-port"><strong>11.3 Port</strong><a class="headerlink" href="#113-port" title="Permanent link">&para;</a></h3>
<p>A Port represents the interface between two components:
* The FPGA Interface Manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>) which is part of the static FPGA fabric
* The Accelerator Function Unit (<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>) which is the partially reconfigurable region</p>
<p>The Port controls the communication from software to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and makes features such as reset and debug available.</p>
<h3 id="114-accelerator-function-unit-afu"><strong>11.4 Accelerator Function Unit (<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>)</strong><a class="headerlink" href="#114-accelerator-function-unit-afu" title="Permanent link">&para;</a></h3>
<p>An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> attaches to a Port. The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> provides a 256 KB memory mapped I/O (<abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>) region for accelerator-specific control registers.</p>
<ul>
<li>Use <code>open()</code> on the Port device to acquire access to an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> associated with the Port device.</li>
<li>Use <code>close()</code>on the Port device to release the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> associated with the Port device.</li>
<li>Use <code>mmap()</code> on the Port device to map accelerator <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> regions.</li>
</ul>
<h3 id="115-partial-reconfiguration-pr"><strong>11.5 Partial Reconfiguration (<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>)</strong><a class="headerlink" href="#115-partial-reconfiguration-pr" title="Permanent link">&para;</a></h3>
<p>Use <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> to reconfigure an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> from a bitstream file. Successful reconfiguration has the following requirement:</p>
<ul>
<li>You must generate the reconfiguration <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> for the exact <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> are compatible if their interface IDs match.
You can verify this match by comparing the interface ID in the bitstream header against the interface ID that is
exported by the driver in sysfs.</li>
</ul>
<p>In all other cases <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> fails and may cause system instability.</p>
<blockquote>
<p>Platforms that support 512-bit Partial Reconfiguration require binutils &gt;= version 2.25.</p>
</blockquote>
<p>Close any software programs accessing the FPGA, including those running in a virtualized host before
initiating <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>. For virtualized environments, the recommended sequence is as
follows:</p>
<ol>
<li>Unload the driver from the guest</li>
<li>Release the VF from the guest</li>
</ol>
<blockquote>
<p>Releasing the VF from the guest while an application on the guest is still accessing its resources may lead to VM instabilities. We recommend closing all applications accessing the VF in the guest before releasing the VF.</p>
</blockquote>
<ol>
<li>Disable <abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr></li>
<li>Perform <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr></li>
<li>Enable <abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr></li>
<li>Assign the VF to the guest</li>
<li>Load the driver in the guest</li>
</ol>
<h3 id="116-fpga-virtualization"><strong>11.6 FPGA Virtualization</strong><a class="headerlink" href="#116-fpga-virtualization" title="Permanent link">&para;</a></h3>
<p>To enable accelerator access from applications running on a VM, create a VF for
the port using the following process:</p>
<ol>
<li>
<p>Release the Port from the PF using the associated ioctl on the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> device.</p>
</li>
<li>
<p>Use the following command to enable <abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr> and VFs. Each VF can own a single Port with an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. In the following command,
N is the number of Port released from the PF.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="go">    echo N &gt; $PCI_DEVICE_PATH/sriov_numvfs</span>
</code></pre></div>
<blockquote>
<p>The number, 'N', cannot be greater than the number of supported VFs. This can be read from $PCI_DEVICE_PATH/sriov_totalvfs.</p>
</blockquote>
<ol>
<li>
<p>Pass the VFs through to VMs using hypervisor interfaces.</p>
</li>
<li>
<p>Access the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> on a VF from applications running on the VM using the same driver inside the VM.</p>
</li>
</ol>
<blockquote>
<p>Creating VFs is only supported for port devices. Consequently, <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> and other management functions are only available through the PF.    </p>
</blockquote>
<p><br></p>
<blockquote>
<p>If assigning multiple devices to the same VM on a guest IOMMU, you may need to increase the <a href="https://libvirt.org/formatdomain.html#memory-tuning">hard_limit option</a> in order to avoid hitting a limit of pinned memory. The hard limit should be more than (VM memory size x Number of PCIe devices).</p>
</blockquote>
<h3 id="117-driver-organization"><strong>11.7 Driver Organization</strong><a class="headerlink" href="#117-driver-organization" title="Permanent link">&para;</a></h3>
<h4 id="1171-pcie-module-device-driver"><strong>11.7.1 PCIe Module Device Driver</strong><a class="headerlink" href="#1171-pcie-module-device-driver" title="Permanent link">&para;</a></h4>
<p>FPGA devices appear as a PCIe devices. Once enumeration detects a PCIe PF or VF, the Linux OS loads the FPGA PCIe
device driver. The device driver performs the following functions:</p>
<ol>
<li>Walks through the Device Feature List in PCIe device base address register (BAR) memory to discover features
and their sub-features and creates necessary platform devices.</li>
<li>Enables <abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr>.</li>
<li>Introduces the feature device infrastructure, which abstracts operations for sub-features and provides common functions
to feature device drivers.</li>
</ol>
<h4 id="1172-pcie-module-device-driver-functions"><strong>11.7.2 PCIe Module Device Driver Functions</strong><a class="headerlink" href="#1172-pcie-module-device-driver-functions" title="Permanent link">&para;</a></h4>
<p>The PCIe Module Device Driver performs the following functions:</p>
<ol>
<li>PCIe discovery, device enumeration, and feature discovery.</li>
<li>Creates sysfs directories for the device, <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>, and Port.</li>
<li>Creates the platform driver instances, causing the Linux kernel to load their respective drivers.</li>
</ol>
<h4 id="1173-fme-platform-module-device-driver"><strong>11.7.3 <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Platform Module Device Driver</strong><a class="headerlink" href="#1173-fme-platform-module-device-driver" title="Permanent link">&para;</a></h4>
<p>The <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Platform Module Device Driver loads automatically after the PCIe driver creates the
<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Platform Module. It provides the following features for FPGA management:</p>
<ol>
<li>
<p>Power and thermal management, error reporting, performance reporting, and other infrastructure functions. You can access
these functions via sysfs interfaces the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> driver provides.</p>
</li>
<li>
<p>Partial Reconfiguration. During <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> sub-feature initialization, the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> driver registers the FPGA Manager framework
to support <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>. When the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> receives the relevant ioctl request from user-space, it invokes the common interface
function from the FPGA Manager to reconfigure the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>.</p>
</li>
<li>
<p>Port management for virtualization (releasing/assigning port device).</p>
</li>
</ol>
<p>After a port device is released, you can use the PCIe driver <abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr> interfaces to create/destroy VFs.</p>
<p>For more information, refer to "FPGA Virtualization".</p>
<h4 id="1174-fme-platform-module-device-driver-functions"><strong>11.7.4 <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Platform Module Device Driver Functions</strong><a class="headerlink" href="#1174-fme-platform-module-device-driver-functions" title="Permanent link">&para;</a></h4>
<p>The <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Platform Module Device Driver performs the the following functions:</p>
<ul>
<li>Creates the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> character device node.</li>
<li>Creates the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> sysfs files and implements the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> sysfs file accessors.</li>
<li>Implements the <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> private feature sub-drivers.</li>
<li><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> private feature sub-drivers:
    * <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> Header
    * Partial Reconfiguration
    * Global Error
    * Global Performance</li>
</ul>
<h4 id="1175-port-platform-module-device-driver"><strong>11.7.5 Port Platform Module Device Driver</strong><a class="headerlink" href="#1175-port-platform-module-device-driver" title="Permanent link">&para;</a></h4>
<p>After the PCIe Module Device Driver creates the Port Platform Module device,
the FPGA Port and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> driver are loaded.  This module provides an
interface for user-space applications to access the individual
accelerators, including basic reset control on the Port, <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region
export, DMA buffer mapping service, and remote debug functions.</p>
<h4 id="1176-port-platform-module-device-driver-functions"><strong>11.7.6 Port Platform Module Device Driver Functions</strong><a class="headerlink" href="#1176-port-platform-module-device-driver-functions" title="Permanent link">&para;</a></h4>
<p>The Port Platform Module Device Driver performs the the following functions:</p>
<ul>
<li>Creates the Port character device node.</li>
<li>Creates the Port sysfs files and implements the Port sysfs file accessors.</li>
<li>Implements the following Port private feature sub-drivers.
    * Port Header
    * <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>
    * Port Error
    * Signal Tap</li>
</ul>
<h4 id="1177-opae-fpga-driver-interface"><strong>11.7.7 OPAE FPGA Driver Interface</strong><a class="headerlink" href="#1177-opae-fpga-driver-interface" title="Permanent link">&para;</a></h4>
<p>The user-space interface consists of a sysfs hierarchy and ioctl requests. Most
kernel attributes can be accessed/modified via sysfs nodes in this hierarchy.
More complex I/O operations are controlled via ioctl requests. The OPAE API
implementation, libopae-c, has been designed to use this interface to
interact with the OPAE FPGA kernel drivers.</p>
<h2 id="120-plugin-development"><strong>12.0 Plugin Development</strong><a class="headerlink" href="#120-plugin-development" title="Permanent link">&para;</a></h2>
<h3 id="121-overview"><strong>12.1 Overview</strong><a class="headerlink" href="#121-overview" title="Permanent link">&para;</a></h3>
<p>Beginning with OPAE C library version 1.2.0, OPAE implements a plugin-centric
model. This guide serves as a reference to define the makeup of an OPAE C API
plugin and to describe a sequence of steps that one may follow when constructing
an OPAE C API plugin.</p>
<h3 id="122-plugin-required-functions"><strong>12.2 Plugin Required Functions</strong><a class="headerlink" href="#122-plugin-required-functions" title="Permanent link">&para;</a></h3>
<p>An OPAE C API plugin is a runtime-loadable shared object library, also known as
a module. On Linux systems, the <em>dl</em> family of APIs from libdl are used to
interact with shared objects. Refer to "man dlopen" and "man dlsym" for examples
of using the libdl API.</p>
<p>An OPAE C API plugin implements one required function. This function is required
to have C linkage, so that its name is not mangled.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">opae_plugin_configure</span><span class="p">(</span><span class="n">opae_api_adapter_table</span><span class="w"> </span><span class="o">*</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">);</span>
</code></pre></div>
<p>During initialization, the OPAE plugin manager component loads each plugin,
searching for its <code>opae_plugin_configure</code> function. If none is found, then
the plugin manager rejects that plugin. When it is found, <code>opae_plugin_configure</code>
is called passing a pointer to a freshly-created <code>opae_api_adapter_table</code> and
a buffer consisting of configuration data for the plugin.</p>
<p>The job of the <code>opae_plugin_configure</code> function is to populate the given adapter
table with each of the plugin's API entry points and to consume and comprehend
the given configuration data in preparation for initialization.</p>
<h3 id="123-opae-api-adapter-table"><strong>12.3 OPAE API Adapter Table</strong><a class="headerlink" href="#123-opae-api-adapter-table" title="Permanent link">&para;</a></h3>
<p>The adapter table is a data structure that contains function pointer entry points
for each of the OPAE APIs implemented by a plugin. In this way, it adapts the
plugin-specific behavior to the more general case of a flat C API. Note that
OPAE applications are only required to link with opae-c. In other words, the
name of the plugin library should not appear on the linker command line. In this
way, plugins are truly decoupled from the OPAE C API, and they are required to
adapt to the strict API specification by populating the adapter table only. No
other linkage is required nor recommended.</p>
<p><code>adapter.h</code> contains the definition of the <code>opae_api_adapter_table</code>. An abbreviated
version is depicted below, along with supporting type <code>opae_plugin</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="w">    </span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_plugin</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">path</span><span class="p">;</span>
<a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">dl_handle</span><span class="p">;</span>
<a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">opae_plugin</span><span class="p">;</span>
<a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a>
<a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a><span class="w">    </span><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_api_adapter_table</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-120-7" name="__codelineno-120-7" href="#__codelineno-120-7"></a>
<a id="__codelineno-120-8" name="__codelineno-120-8" href="#__codelineno-120-8"></a><span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">_opae_api_adapater_table</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="p">;</span>
<a id="__codelineno-120-9" name="__codelineno-120-9" href="#__codelineno-120-9"></a><span class="w">        </span><span class="n">opae_plugin</span><span class="w"> </span><span class="n">plugin</span><span class="p">;</span>
<a id="__codelineno-120-10" name="__codelineno-120-10" href="#__codelineno-120-10"></a>
<a id="__codelineno-120-11" name="__codelineno-120-11" href="#__codelineno-120-11"></a><span class="w">        </span><span class="n">fpga_result</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fpgaOpen</span><span class="p">)(</span><span class="n">fpga_token</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="n">fpga_handle</span><span class="w"> </span><span class="o">*</span><span class="n">handle</span><span class="p">,</span>
<a id="__codelineno-120-12" name="__codelineno-120-12" href="#__codelineno-120-12"></a><span class="w">                                </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
<a id="__codelineno-120-13" name="__codelineno-120-13" href="#__codelineno-120-13"></a>
<a id="__codelineno-120-14" name="__codelineno-120-14" href="#__codelineno-120-14"></a><span class="w">        </span><span class="n">fpga_result</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fpgaClose</span><span class="p">)(</span><span class="n">fpga_handle</span><span class="w"> </span><span class="n">handle</span><span class="p">);</span>
<a id="__codelineno-120-15" name="__codelineno-120-15" href="#__codelineno-120-15"></a>
<a id="__codelineno-120-16" name="__codelineno-120-16" href="#__codelineno-120-16"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-120-17" name="__codelineno-120-17" href="#__codelineno-120-17"></a>
<a id="__codelineno-120-18" name="__codelineno-120-18" href="#__codelineno-120-18"></a><span class="w">        </span><span class="n">fpga_result</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fpgaEnumerate</span><span class="p">)(</span><span class="k">const</span><span class="w"> </span><span class="n">fpga_properties</span><span class="w"> </span><span class="o">*</span><span class="n">filters</span><span class="p">,</span>
<a id="__codelineno-120-19" name="__codelineno-120-19" href="#__codelineno-120-19"></a><span class="w">                                     </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_filters</span><span class="p">,</span><span class="w"> </span><span class="n">fpga_token</span><span class="w"> </span><span class="o">*</span><span class="n">tokens</span><span class="p">,</span>
<a id="__codelineno-120-20" name="__codelineno-120-20" href="#__codelineno-120-20"></a><span class="w">                                     </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">max_tokens</span><span class="p">,</span>
<a id="__codelineno-120-21" name="__codelineno-120-21" href="#__codelineno-120-21"></a><span class="w">                                     </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">num_matches</span><span class="p">);</span>
<a id="__codelineno-120-22" name="__codelineno-120-22" href="#__codelineno-120-22"></a>
<a id="__codelineno-120-23" name="__codelineno-120-23" href="#__codelineno-120-23"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-120-24" name="__codelineno-120-24" href="#__codelineno-120-24"></a>
<a id="__codelineno-120-25" name="__codelineno-120-25" href="#__codelineno-120-25"></a><span class="w">        </span><span class="c1">// configuration functions</span>
<a id="__codelineno-120-26" name="__codelineno-120-26" href="#__codelineno-120-26"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">initialize</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<a id="__codelineno-120-27" name="__codelineno-120-27" href="#__codelineno-120-27"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">finalize</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<a id="__codelineno-120-28" name="__codelineno-120-28" href="#__codelineno-120-28"></a>
<a id="__codelineno-120-29" name="__codelineno-120-29" href="#__codelineno-120-29"></a><span class="w">        </span><span class="c1">// first-level query</span>
<a id="__codelineno-120-30" name="__codelineno-120-30" href="#__codelineno-120-30"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">supports_device</span><span class="p">)(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">device_type</span><span class="p">);</span>
<a id="__codelineno-120-31" name="__codelineno-120-31" href="#__codelineno-120-31"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">supports_host</span><span class="p">)(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">hostname</span><span class="p">);</span>
<a id="__codelineno-120-32" name="__codelineno-120-32" href="#__codelineno-120-32"></a>
<a id="__codelineno-120-33" name="__codelineno-120-33" href="#__codelineno-120-33"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">opae_api_adapter_table</span><span class="p">;</span>
</code></pre></div>
<p>Some points worth noting are that the adapter tables are organized in memory by
adding them to a linked list data structure. This is the use of the <code>next</code>
structure member. (The list management is handled by the plugin manager.)
The <code>plugin</code> structure member contains the handle to the shared object instance,
as created by <code>dlopen</code>. This handle is used in the plugin's <code>opae_plugin_configure</code>
to load plugin entry points. A plugin need only implement the portion of the
OPAE C API that a target application needs. Any API entry points that are not
supported should be left as NULL pointers (the default) in the adapter table.
When an OPAE API that has no associated entry point in the adapter table is
called, the result for objects associated with that plugin will be
<code>FPGA_NOT_SUPPORTED</code>.</p>
<p>The following code illustrates a portion of the <code>opae_plugin_configure</code> for
a theoretical OPAE C API plugin libfoo.so:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="w">    </span><span class="cm">/* foo_plugin.c */</span>
<a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a>
<a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">opae_plugin_configure</span><span class="p">(</span><span class="n">opae_api_adapter_table</span><span class="w"> </span><span class="o">*</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a><span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fpgaOpen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dlsym</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">plugin</span><span class="p">.</span><span class="n">dl_handle</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo_fpgaOpen&quot;</span><span class="p">);</span>
<a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a><span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fpgaClose</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="w">                </span><span class="n">dlsym</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">plugin</span><span class="p">.</span><span class="n">dl_handle</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo_fpgaClose&quot;</span><span class="p">);</span>
<a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a>
<a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-121-10" name="__codelineno-121-10" href="#__codelineno-121-10"></a>
<a id="__codelineno-121-11" name="__codelineno-121-11" href="#__codelineno-121-11"></a><span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fpgaEnumerate</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-121-12" name="__codelineno-121-12" href="#__codelineno-121-12"></a><span class="w">                </span><span class="n">dlsym</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">plugin</span><span class="p">.</span><span class="n">dl_handle</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo_fpgaEnumerate&quot;</span><span class="p">);</span>
<a id="__codelineno-121-13" name="__codelineno-121-13" href="#__codelineno-121-13"></a>
<a id="__codelineno-121-14" name="__codelineno-121-14" href="#__codelineno-121-14"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-121-15" name="__codelineno-121-15" href="#__codelineno-121-15"></a>
<a id="__codelineno-121-16" name="__codelineno-121-16" href="#__codelineno-121-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-121-17" name="__codelineno-121-17" href="#__codelineno-121-17"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>Notice that the implementations of the API entry points for plugin libfoo.so
are prefixed with <code>foo_</code>. This is the recommended practice to avoid name
collisions and to enhance the debugability of the application. Upon successful
configuration, <code>opae_plugin_configure</code> returns 0 to indicate success. A
non-zero return value indicates failure and causes the plugin manager to
reject the plugin from futher consideration.</p>
<h3 id="124-plugin-optional-functions"><strong>12.4 Plugin Optional Functions</strong><a class="headerlink" href="#124-plugin-optional-functions" title="Permanent link">&para;</a></h3>
<p>Once the plugin manager loads and configures each plugin, it uses the adapter
table to call back into the plugin so that it can be made ready for runtime.
This is the job of the <code>opae_plugin_initialize</code> entry point, whose signature
is defined as:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">opae_plugin_initialize</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</code></pre></div>
<p>The function takes no parameters, as the configuration data was already given
to the plugin by <code>opae_plugin_configure</code>. <code>opae_plugin_initialize</code> returns 0
if no errors were encountered during initialization. A non-zero return code
indicates that plugin initialization failed. A plugin makes its
<code>opae_plugin_initialize</code> available to the plugin manager by populating the
adapter table's <code>initialize</code> entry point as shown:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="w">    </span><span class="cm">/* foo_plugin.c */</span>
<a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a>
<a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">foo_plugin_initialize</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-123-6" name="__codelineno-123-6" href="#__codelineno-123-6"></a>
<a id="__codelineno-123-7" name="__codelineno-123-7" href="#__codelineno-123-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="cm">/* success */</span>
<a id="__codelineno-123-8" name="__codelineno-123-8" href="#__codelineno-123-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-123-9" name="__codelineno-123-9" href="#__codelineno-123-9"></a>
<a id="__codelineno-123-10" name="__codelineno-123-10" href="#__codelineno-123-10"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">opae_plugin_configure</span><span class="p">(</span><span class="n">opae_api_adapter_table</span><span class="w"> </span><span class="o">*</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-123-11" name="__codelineno-123-11" href="#__codelineno-123-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-123-12" name="__codelineno-123-12" href="#__codelineno-123-12"></a><span class="w">        </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-123-13" name="__codelineno-123-13" href="#__codelineno-123-13"></a>
<a id="__codelineno-123-14" name="__codelineno-123-14" href="#__codelineno-123-14"></a><span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">initialize</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-123-15" name="__codelineno-123-15" href="#__codelineno-123-15"></a><span class="w">                </span><span class="n">dlsym</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">plugin</span><span class="p">.</span><span class="n">dl_handle</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo_plugin_initialize&quot;</span><span class="p">);</span>
<a id="__codelineno-123-16" name="__codelineno-123-16" href="#__codelineno-123-16"></a>
<a id="__codelineno-123-17" name="__codelineno-123-17" href="#__codelineno-123-17"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-123-18" name="__codelineno-123-18" href="#__codelineno-123-18"></a>
<a id="__codelineno-123-19" name="__codelineno-123-19" href="#__codelineno-123-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-123-20" name="__codelineno-123-20" href="#__codelineno-123-20"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>If a plugin does not implement an <code>opae_plugin_initialize</code> entry point, then
the <code>initialize</code> member of the adapter table should be left uninitialized.
During plugin initialization, if a plugin has no <code>opae_plugin_initialize</code>
entry in its adapter table, the plugin initialization step will be skipped,
and the plugin will be considered to have initialized successfully.</p>
<p>Once plugin initialization is complete for all loaded plugins, the system
is considered to be running and fully functional.</p>
<p>During teardown, the plugin manager uses the adapter table to call into each
plugin's <code>opae_plugin_finalize</code> entry point, whose signature is defined as:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">opae_plugin_finalize</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</code></pre></div>
<p><code>opae_plugin_finalize</code> returns 0 if no errors were encountered during teardown.
A non-zero return code indicates that plugin teardown failed. A plugin makes
its <code>opae_plugin_finalize</code> available to the plugin manager by populating the
adapter table's <code>finalize</code> entry point as shown:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="w">    </span><span class="cm">/* foo_plugin.c */</span>
<a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a>
<a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">foo_plugin_finalize</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a>
<a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="cm">/* success */</span>
<a id="__codelineno-125-8" name="__codelineno-125-8" href="#__codelineno-125-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-125-9" name="__codelineno-125-9" href="#__codelineno-125-9"></a>
<a id="__codelineno-125-10" name="__codelineno-125-10" href="#__codelineno-125-10"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">opae_plugin_configure</span><span class="p">(</span><span class="n">opae_api_adapter_table</span><span class="w"> </span><span class="o">*</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-125-11" name="__codelineno-125-11" href="#__codelineno-125-11"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-125-12" name="__codelineno-125-12" href="#__codelineno-125-12"></a><span class="w">        </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-125-13" name="__codelineno-125-13" href="#__codelineno-125-13"></a>
<a id="__codelineno-125-14" name="__codelineno-125-14" href="#__codelineno-125-14"></a><span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">finalize</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-125-15" name="__codelineno-125-15" href="#__codelineno-125-15"></a><span class="w">                </span><span class="n">dlsym</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">plugin</span><span class="p">.</span><span class="n">dl_handle</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo_plugin_finalize&quot;</span><span class="p">);</span>
<a id="__codelineno-125-16" name="__codelineno-125-16" href="#__codelineno-125-16"></a>
<a id="__codelineno-125-17" name="__codelineno-125-17" href="#__codelineno-125-17"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-125-18" name="__codelineno-125-18" href="#__codelineno-125-18"></a>
<a id="__codelineno-125-19" name="__codelineno-125-19" href="#__codelineno-125-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-125-20" name="__codelineno-125-20" href="#__codelineno-125-20"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>If a plugin does not implement an <code>opae_plugin_finalize</code> entry point, then
the <code>finalize</code> member of the adapter table should be left uninitialized.
During plugin cleanup, if a plugin has no <code>opae_plugin_finalize</code> entry
point in its adapter table, the plugin finalize step will be skipped, and
the plugin will be considered to have finalized successfully.</p>
<p>In addition to <code>initialize</code> and <code>finalize</code>, an OPAE C API plugin has two
further optional entry points that relate to device enumeration. During
enumeration, when a plugin is being considered for a type of device, the
plugin may provide input on that decision by exporting an
<code>opae_plugin_supports_device</code> entry point in the adapter table:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">opae_plugin_supports_device</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">device_type</span><span class="p">);</span>
</code></pre></div>
<p><code>opae_plugin_supports_device</code> returns true if the given device type is
supported and false if it is not. A false return value from
<code>opae_plugin_supports_device</code> causes device enumeration to skip the
plugin.</p>
<p>Populating the <code>opae_plugin_supports_device</code> is done as:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="w">    </span><span class="cm">/* foo_plugin.c */</span>
<a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a>
<a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">foo_plugin_supports_device</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">device_type</span><span class="p">)</span>
<a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="cm">/* device_type is supported */</span><span class="p">)</span>
<a id="__codelineno-127-6" name="__codelineno-127-6" href="#__codelineno-127-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-127-7" name="__codelineno-127-7" href="#__codelineno-127-7"></a>
<a id="__codelineno-127-8" name="__codelineno-127-8" href="#__codelineno-127-8"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-127-9" name="__codelineno-127-9" href="#__codelineno-127-9"></a>
<a id="__codelineno-127-10" name="__codelineno-127-10" href="#__codelineno-127-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-127-11" name="__codelineno-127-11" href="#__codelineno-127-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-127-12" name="__codelineno-127-12" href="#__codelineno-127-12"></a>
<a id="__codelineno-127-13" name="__codelineno-127-13" href="#__codelineno-127-13"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">opae_plugin_configure</span><span class="p">(</span><span class="n">opae_api_adapter_table</span><span class="w"> </span><span class="o">*</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-127-14" name="__codelineno-127-14" href="#__codelineno-127-14"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-127-15" name="__codelineno-127-15" href="#__codelineno-127-15"></a><span class="w">        </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-127-16" name="__codelineno-127-16" href="#__codelineno-127-16"></a>
<a id="__codelineno-127-17" name="__codelineno-127-17" href="#__codelineno-127-17"></a><span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">supports_device</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-127-18" name="__codelineno-127-18" href="#__codelineno-127-18"></a><span class="w">                </span><span class="n">dlsym</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">plugin</span><span class="p">.</span><span class="n">dl_handle</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo_plugin_supports_device&quot;</span><span class="p">);</span>
<a id="__codelineno-127-19" name="__codelineno-127-19" href="#__codelineno-127-19"></a>
<a id="__codelineno-127-20" name="__codelineno-127-20" href="#__codelineno-127-20"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-127-21" name="__codelineno-127-21" href="#__codelineno-127-21"></a>
<a id="__codelineno-127-22" name="__codelineno-127-22" href="#__codelineno-127-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-127-23" name="__codelineno-127-23" href="#__codelineno-127-23"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a>.. note::
<a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a>    The `opae_plugin_supports_device` mechanism serves as a placeholder only.
<a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a>    It is not implemented in the current version of the OPAE C API.
</code></pre></div>
<p>Similarly to determining whether a plugin supports a type of device, a plugin
may also answer questions about network host support by populating an
<code>opae_plugin_supports_host</code> entry point in the adapter table:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">opae_plugin_supports_host</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">hostname</span><span class="p">);</span>
</code></pre></div>
<p><code>opae_plugin_supports_host</code> returns true if the given hostname is supported
and false if it is not. A false return value from <code>opae_plugin_supports_host</code>
causes device enumeration to skip the plugin.</p>
<p>Populating the <code>opae_plugin_supports_host</code> is done as:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="w">    </span><span class="cm">/* foo_plugin.c */</span>
<a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a>
<a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">foo_plugin_supports_host</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">hostname</span><span class="p">)</span>
<a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="cm">/* hostname is supported */</span><span class="p">)</span>
<a id="__codelineno-130-6" name="__codelineno-130-6" href="#__codelineno-130-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-130-7" name="__codelineno-130-7" href="#__codelineno-130-7"></a>
<a id="__codelineno-130-8" name="__codelineno-130-8" href="#__codelineno-130-8"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-130-9" name="__codelineno-130-9" href="#__codelineno-130-9"></a>
<a id="__codelineno-130-10" name="__codelineno-130-10" href="#__codelineno-130-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-130-11" name="__codelineno-130-11" href="#__codelineno-130-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-130-12" name="__codelineno-130-12" href="#__codelineno-130-12"></a>
<a id="__codelineno-130-13" name="__codelineno-130-13" href="#__codelineno-130-13"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">opae_plugin_configure</span><span class="p">(</span><span class="n">opae_api_adapter_table</span><span class="w"> </span><span class="o">*</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-130-14" name="__codelineno-130-14" href="#__codelineno-130-14"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-130-15" name="__codelineno-130-15" href="#__codelineno-130-15"></a><span class="w">        </span><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-130-16" name="__codelineno-130-16" href="#__codelineno-130-16"></a>
<a id="__codelineno-130-17" name="__codelineno-130-17" href="#__codelineno-130-17"></a><span class="w">        </span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">supports_host</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-130-18" name="__codelineno-130-18" href="#__codelineno-130-18"></a><span class="w">                </span><span class="n">dlsym</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">plugin</span><span class="p">.</span><span class="n">dl_handle</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo_plugin_supports_host&quot;</span><span class="p">);</span>
<a id="__codelineno-130-19" name="__codelineno-130-19" href="#__codelineno-130-19"></a>
<a id="__codelineno-130-20" name="__codelineno-130-20" href="#__codelineno-130-20"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-130-21" name="__codelineno-130-21" href="#__codelineno-130-21"></a>
<a id="__codelineno-130-22" name="__codelineno-130-22" href="#__codelineno-130-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-130-23" name="__codelineno-130-23" href="#__codelineno-130-23"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a>.. note::
<a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a>    The `opae_plugin_supports_host` mechanism serves as a placeholder only.
<a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a>    It is not implemented in the current version of the OPAE C API.
</code></pre></div>
<h3 id="125-plugin-construction"><strong>12.5 Plugin Construction</strong><a class="headerlink" href="#125-plugin-construction" title="Permanent link">&para;</a></h3>
<p>The steps required to implement an OPAE C API plugin, libfoo.so, are:</p>
<ul>
<li>Create foo_plugin.c: implements <code>opae_plugin_configure</code>,
<code>opae_plugin_initialize</code>, <code>opae_plugin_finalize</code>, <code>opae_plugin_supports_device</code>,
and <code>opae_plugin_supports_host</code> as described in the previous sections.</li>
<li>Create foo_plugin.h: implements function prototypes for each of the
plugin-specific OPAE C APIs.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="w">    </span><span class="cm">/* foo_plugin.h */</span>
<a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a>
<a id="__codelineno-132-3" name="__codelineno-132-3" href="#__codelineno-132-3"></a><span class="w">    </span><span class="n">fpga_result</span><span class="w"> </span><span class="nf">foo_fpgaOpen</span><span class="p">(</span><span class="n">fpga_token</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="n">fpga_handle</span><span class="w"> </span><span class="o">*</span><span class="n">handle</span><span class="p">,</span>
<a id="__codelineno-132-4" name="__codelineno-132-4" href="#__codelineno-132-4"></a><span class="w">                             </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
<a id="__codelineno-132-5" name="__codelineno-132-5" href="#__codelineno-132-5"></a>
<a id="__codelineno-132-6" name="__codelineno-132-6" href="#__codelineno-132-6"></a><span class="w">    </span><span class="n">fpga_result</span><span class="w"> </span><span class="nf">foo_fpgaClose</span><span class="p">(</span><span class="n">fpga_handle</span><span class="w"> </span><span class="n">handle</span><span class="p">);</span>
<a id="__codelineno-132-7" name="__codelineno-132-7" href="#__codelineno-132-7"></a>
<a id="__codelineno-132-8" name="__codelineno-132-8" href="#__codelineno-132-8"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-132-9" name="__codelineno-132-9" href="#__codelineno-132-9"></a>
<a id="__codelineno-132-10" name="__codelineno-132-10" href="#__codelineno-132-10"></a><span class="w">    </span><span class="n">fpga_result</span><span class="w"> </span><span class="n">foo_fpgaEnumerate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">fpga_properties</span><span class="w"> </span><span class="o">*</span><span class="n">filters</span><span class="p">,</span>
<a id="__codelineno-132-11" name="__codelineno-132-11" href="#__codelineno-132-11"></a><span class="w">                                  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_filters</span><span class="p">,</span><span class="w"> </span><span class="n">fpga_token</span><span class="w"> </span><span class="o">*</span><span class="n">tokens</span><span class="p">,</span>
<a id="__codelineno-132-12" name="__codelineno-132-12" href="#__codelineno-132-12"></a><span class="w">                                  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">max_tokens</span><span class="p">,</span>
<a id="__codelineno-132-13" name="__codelineno-132-13" href="#__codelineno-132-13"></a><span class="w">                                  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">num_matches</span><span class="p">);</span>
<a id="__codelineno-132-14" name="__codelineno-132-14" href="#__codelineno-132-14"></a><span class="w">    </span><span class="p">...</span>
</code></pre></div>
<ul>
<li>Create foo_types.h: implements plugin-specific types for opaque data
structures.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="w">    </span><span class="cm">/* foo_types.h */</span>
<a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a>
<a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">_foo_token</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a>
<a id="__codelineno-133-7" name="__codelineno-133-7" href="#__codelineno-133-7"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">_foo_handle</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-133-8" name="__codelineno-133-8" href="#__codelineno-133-8"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-133-9" name="__codelineno-133-9" href="#__codelineno-133-9"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-133-10" name="__codelineno-133-10" href="#__codelineno-133-10"></a>
<a id="__codelineno-133-11" name="__codelineno-133-11" href="#__codelineno-133-11"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">_foo_event_handle</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-133-12" name="__codelineno-133-12" href="#__codelineno-133-12"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-133-13" name="__codelineno-133-13" href="#__codelineno-133-13"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-133-14" name="__codelineno-133-14" href="#__codelineno-133-14"></a>
<a id="__codelineno-133-15" name="__codelineno-133-15" href="#__codelineno-133-15"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">_foo_object</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-133-16" name="__codelineno-133-16" href="#__codelineno-133-16"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-133-17" name="__codelineno-133-17" href="#__codelineno-133-17"></a><span class="w">    </span><span class="p">};</span>
</code></pre></div>
<ul>
<li>Create foo_enum.c: implements <code>foo_fpgaEnumerate</code>,
<code>foo_fpgaCloneToken</code>, and <code>foo_fpgaDestroyToken</code>.</li>
<li>Create foo_open.c: implements <code>foo_fpgaOpen</code>.</li>
<li>Create foo_close.c: implements <code>foo_fpgaClose</code>.</li>
<li>Create foo_props.c: implements <code>foo_fpgaGetProperties</code>,
<code>foo_fpgaGetPropertiesFromHandle</code>, <code>foo_fpgaUpdateProperties</code></li>
<li>Create foo_mmio.c: implements <code>foo_fpgaMapMMIO</code>, <code>foo_fpgaUnmapMMIO</code>
<code>foo_fpgaWriteMMIO64</code>, <code>foo_fpgaReadMMIO64</code>, <code>foo_fpgaWriteMMIO32</code>,
<code>foo_fpgaReadMMIO32</code>.</li>
<li>Create foo_buff.c: implements <code>foo_fpgaPrepareBuffer</code>,
<code>foo_fpgaReleaseBuffer</code>, <code>foo_fpgaGetIOAddress</code>.</li>
<li>Create foo_error.c: implements <code>foo_fpgaReadError</code>, <code>foo_fpgaClearError</code>,
<code>foo_fpgaClearAllErrors</code>, <code>foo_fpgaGetErrorInfo</code>.</li>
<li>Create foo_event.c: implements <code>foo_fpgaCreateEventHandle</code>,
<code>foo_fpgaDestroyEventHandle</code>, <code>foo_fpgaGetOSObjectFromEventHandle</code>,
<code>foo_fpgaRegisterEvent</code>, <code>foo_fpgaUnregisterEvent</code>.</li>
<li>Create foo_reconf.c: implements <code>foo_fpgaReconfigureSlot</code>.</li>
<li>Create foo_obj.c: implements <code>foo_fpgaTokenGetObject</code>,
<code>foo_fpgaHandleGetObject</code>, <code>foo_fpgaObjectGetObject</code>,
<code>foo_fpgaDestroyObject</code>, <code>foo_fpgaObjectGetSize</code>, <code>foo_fpgaObjectRead</code>,
<code>foo_fpgaObjectRead64</code>, <code>foo_fpgaObjectWrite64</code>.</li>
<li>Create foo_clk.c: implements <code>foo_fpgaSetUserClock</code>,
<code>foo_fpgaGetUserClock</code>.</li>
</ul>
<h2 id="130-building-a-sample-application"><strong>13.0 Building a Sample Application</strong><a class="headerlink" href="#130-building-a-sample-application" title="Permanent link">&para;</a></h2>
<p>Building a sample application
The library source includes code samples. Use these samples to learn how to call functions in the library. Build and run these samples as quick sanity checks to determine if your installation and environment are set up properly.</p>
<p>In this guide, we will build <code>hello_fpga.c</code>. This is the "Hello World!" example of using the library. This code searches for a predefined and known <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> called "Native Loopback Adapter" on the FPGA. If found, it acquires ownership and then interacts with the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> by sending it a 2MB message and waiting for the message to be echoed back. This code exercises all major components of the API except for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> reconfiguration: <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> search, enumeration, access, <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>, and memory management.</p>
<p>You can also find the source for <code>hello_fpga</code> in the <strong>samples</strong> directory of the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> repository on GitHub.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a><span class="w">        </span><span class="n">fpga_properties</span><span class="w">    </span><span class="n">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-134-4" name="__codelineno-134-4" href="#__codelineno-134-4"></a><span class="w">        </span><span class="n">fpga_token</span><span class="w">         </span><span class="n">afu_token</span><span class="p">;</span>
<a id="__codelineno-134-5" name="__codelineno-134-5" href="#__codelineno-134-5"></a><span class="w">        </span><span class="n">fpga_handle</span><span class="w">        </span><span class="n">afu_handle</span><span class="p">;</span>
<a id="__codelineno-134-6" name="__codelineno-134-6" href="#__codelineno-134-6"></a><span class="w">        </span><span class="n">fpga_guid</span><span class="w">          </span><span class="n">guid</span><span class="p">;</span>
<a id="__codelineno-134-7" name="__codelineno-134-7" href="#__codelineno-134-7"></a><span class="w">        </span><span class="kt">uint32_t</span><span class="w">           </span><span class="n">num_matches</span><span class="p">;</span>
<a id="__codelineno-134-8" name="__codelineno-134-8" href="#__codelineno-134-8"></a>
<a id="__codelineno-134-9" name="__codelineno-134-9" href="#__codelineno-134-9"></a><span class="w">        </span><span class="k">volatile</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">dsm_ptr</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-134-10" name="__codelineno-134-10" href="#__codelineno-134-10"></a><span class="w">        </span><span class="k">volatile</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">status_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-134-11" name="__codelineno-134-11" href="#__codelineno-134-11"></a><span class="w">        </span><span class="k">volatile</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">input_ptr</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-134-12" name="__codelineno-134-12" href="#__codelineno-134-12"></a><span class="w">        </span><span class="k">volatile</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="o">*</span><span class="n">output_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-134-13" name="__codelineno-134-13" href="#__codelineno-134-13"></a>
<a id="__codelineno-134-14" name="__codelineno-134-14" href="#__codelineno-134-14"></a><span class="w">        </span><span class="kt">uint64_t</span><span class="w">        </span><span class="n">dsm_wsid</span><span class="p">;</span>
<a id="__codelineno-134-15" name="__codelineno-134-15" href="#__codelineno-134-15"></a><span class="w">        </span><span class="kt">uint64_t</span><span class="w">        </span><span class="n">input_wsid</span><span class="p">;</span>
<a id="__codelineno-134-16" name="__codelineno-134-16" href="#__codelineno-134-16"></a><span class="w">        </span><span class="kt">uint64_t</span><span class="w">        </span><span class="n">output_wsid</span><span class="p">;</span>
<a id="__codelineno-134-17" name="__codelineno-134-17" href="#__codelineno-134-17"></a><span class="w">        </span><span class="n">fpga_result</span><span class="w">     </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPGA_OK</span><span class="p">;</span>
<a id="__codelineno-134-18" name="__codelineno-134-18" href="#__codelineno-134-18"></a>
<a id="__codelineno-134-19" name="__codelineno-134-19" href="#__codelineno-134-19"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">uuid_parse</span><span class="p">(</span><span class="n">NLB0_AFUID</span><span class="p">,</span><span class="w"> </span><span class="n">guid</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-134-20" name="__codelineno-134-20" href="#__codelineno-134-20"></a><span class="w">            </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error parsing guid &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">NLB0_AFUID</span><span class="p">);</span>
<a id="__codelineno-134-21" name="__codelineno-134-21" href="#__codelineno-134-21"></a><span class="w">            </span><span class="k">goto</span><span class="w"> </span><span class="n">out_exit</span><span class="p">;</span>
<a id="__codelineno-134-22" name="__codelineno-134-22" href="#__codelineno-134-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-134-23" name="__codelineno-134-23" href="#__codelineno-134-23"></a>
<a id="__codelineno-134-24" name="__codelineno-134-24" href="#__codelineno-134-24"></a><span class="w">        </span><span class="cm">/* Look for accelerator by its &quot;afu_id&quot; */</span>
<a id="__codelineno-134-25" name="__codelineno-134-25" href="#__codelineno-134-25"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaGetProperties</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">filter</span><span class="p">);</span>
<a id="__codelineno-134-26" name="__codelineno-134-26" href="#__codelineno-134-26"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_exit</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;creating properties object&quot;</span><span class="p">);</span>
<a id="__codelineno-134-27" name="__codelineno-134-27" href="#__codelineno-134-27"></a>
<a id="__codelineno-134-28" name="__codelineno-134-28" href="#__codelineno-134-28"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaPropertiesSetObjectType</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="n">FPGA_ACCELERATOR</span><span class="p">);</span>
<a id="__codelineno-134-29" name="__codelineno-134-29" href="#__codelineno-134-29"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_destroy_prop</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;setting object type&quot;</span><span class="p">);</span>
<a id="__codelineno-134-30" name="__codelineno-134-30" href="#__codelineno-134-30"></a>
<a id="__codelineno-134-31" name="__codelineno-134-31" href="#__codelineno-134-31"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaPropertiesSetGuid</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="n">guid</span><span class="p">);</span>
<a id="__codelineno-134-32" name="__codelineno-134-32" href="#__codelineno-134-32"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_destroy_prop</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;setting GUID&quot;</span><span class="p">);</span>
<a id="__codelineno-134-33" name="__codelineno-134-33" href="#__codelineno-134-33"></a>
<a id="__codelineno-134-34" name="__codelineno-134-34" href="#__codelineno-134-34"></a><span class="w">        </span><span class="cm">/* TODO: Add selection via BDF / device ID */</span>
<a id="__codelineno-134-35" name="__codelineno-134-35" href="#__codelineno-134-35"></a>
<a id="__codelineno-134-36" name="__codelineno-134-36" href="#__codelineno-134-36"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaEnumerate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">afu_token</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num_matches</span><span class="p">);</span>
<a id="__codelineno-134-37" name="__codelineno-134-37" href="#__codelineno-134-37"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_destroy_prop</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;enumerating accelerators&quot;</span><span class="p">);</span>
<a id="__codelineno-134-38" name="__codelineno-134-38" href="#__codelineno-134-38"></a>
<a id="__codelineno-134-39" name="__codelineno-134-39" href="#__codelineno-134-39"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">num_matches</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-134-40" name="__codelineno-134-40" href="#__codelineno-134-40"></a><span class="w">            </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;accelerator not found.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-134-41" name="__codelineno-134-41" href="#__codelineno-134-41"></a><span class="w">            </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaDestroyProperties</span><span class="p">(</span><span class="o">&amp;</span><span class="n">filter</span><span class="p">);</span>
<a id="__codelineno-134-42" name="__codelineno-134-42" href="#__codelineno-134-42"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">FPGA_INVALID_PARAM</span><span class="p">;</span>
<a id="__codelineno-134-43" name="__codelineno-134-43" href="#__codelineno-134-43"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-134-44" name="__codelineno-134-44" href="#__codelineno-134-44"></a>
<a id="__codelineno-134-45" name="__codelineno-134-45" href="#__codelineno-134-45"></a><span class="w">        </span><span class="cm">/* Open accelerator and map MMIO */</span>
<a id="__codelineno-134-46" name="__codelineno-134-46" href="#__codelineno-134-46"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaOpen</span><span class="p">(</span><span class="n">afu_token</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-134-47" name="__codelineno-134-47" href="#__codelineno-134-47"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_destroy_tok</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;opening accelerator&quot;</span><span class="p">);</span>
<a id="__codelineno-134-48" name="__codelineno-134-48" href="#__codelineno-134-48"></a>
<a id="__codelineno-134-49" name="__codelineno-134-49" href="#__codelineno-134-49"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaMapMMIO</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<a id="__codelineno-134-50" name="__codelineno-134-50" href="#__codelineno-134-50"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_close</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mapping MMIO space&quot;</span><span class="p">);</span>
<a id="__codelineno-134-51" name="__codelineno-134-51" href="#__codelineno-134-51"></a>
<a id="__codelineno-134-52" name="__codelineno-134-52" href="#__codelineno-134-52"></a><span class="w">        </span><span class="cm">/* Allocate buffers */</span>
<a id="__codelineno-134-53" name="__codelineno-134-53" href="#__codelineno-134-53"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaPrepareBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">LPBK1_DSM_SIZE</span><span class="p">,</span>
<a id="__codelineno-134-54" name="__codelineno-134-54" href="#__codelineno-134-54"></a><span class="w">                    </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dsm_ptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dsm_wsid</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-134-55" name="__codelineno-134-55" href="#__codelineno-134-55"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_close</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;allocating DSM buffer&quot;</span><span class="p">);</span>
<a id="__codelineno-134-56" name="__codelineno-134-56" href="#__codelineno-134-56"></a>
<a id="__codelineno-134-57" name="__codelineno-134-57" href="#__codelineno-134-57"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaPrepareBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">LPBK1_BUFFER_ALLOCATION_SIZE</span><span class="p">,</span>
<a id="__codelineno-134-58" name="__codelineno-134-58" href="#__codelineno-134-58"></a><span class="w">                   </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">input_ptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">input_wsid</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-134-59" name="__codelineno-134-59" href="#__codelineno-134-59"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_dsm</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;allocating input buffer&quot;</span><span class="p">);</span>
<a id="__codelineno-134-60" name="__codelineno-134-60" href="#__codelineno-134-60"></a>
<a id="__codelineno-134-61" name="__codelineno-134-61" href="#__codelineno-134-61"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaPrepareBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">LPBK1_BUFFER_ALLOCATION_SIZE</span><span class="p">,</span>
<a id="__codelineno-134-62" name="__codelineno-134-62" href="#__codelineno-134-62"></a><span class="w">                   </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">output_ptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">output_wsid</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-134-63" name="__codelineno-134-63" href="#__codelineno-134-63"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_input</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;allocating output buffer&quot;</span><span class="p">);</span>
<a id="__codelineno-134-64" name="__codelineno-134-64" href="#__codelineno-134-64"></a>
<a id="__codelineno-134-65" name="__codelineno-134-65" href="#__codelineno-134-65"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Running Test</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-134-66" name="__codelineno-134-66" href="#__codelineno-134-66"></a>
<a id="__codelineno-134-67" name="__codelineno-134-67" href="#__codelineno-134-67"></a><span class="w">        </span><span class="cm">/* Initialize buffers */</span>
<a id="__codelineno-134-68" name="__codelineno-134-68" href="#__codelineno-134-68"></a><span class="w">        </span><span class="n">memset</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">dsm_ptr</span><span class="p">,</span><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w">    </span><span class="n">LPBK1_DSM_SIZE</span><span class="p">);</span>
<a id="__codelineno-134-69" name="__codelineno-134-69" href="#__codelineno-134-69"></a><span class="w">        </span><span class="n">memset</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">input_ptr</span><span class="p">,</span><span class="w">  </span><span class="mh">0xAF</span><span class="p">,</span><span class="w"> </span><span class="n">LPBK1_BUFFER_SIZE</span><span class="p">);</span>
<a id="__codelineno-134-70" name="__codelineno-134-70" href="#__codelineno-134-70"></a><span class="w">        </span><span class="n">memset</span><span class="p">((</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">output_ptr</span><span class="p">,</span><span class="w"> </span><span class="mh">0xBE</span><span class="p">,</span><span class="w"> </span><span class="n">LPBK1_BUFFER_SIZE</span><span class="p">);</span>
<a id="__codelineno-134-71" name="__codelineno-134-71" href="#__codelineno-134-71"></a>
<a id="__codelineno-134-72" name="__codelineno-134-72" href="#__codelineno-134-72"></a><span class="w">        </span><span class="n">cache_line</span><span class="w"> </span><span class="o">*</span><span class="n">cl_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">cache_line</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">input_ptr</span><span class="p">;</span>
<a id="__codelineno-134-73" name="__codelineno-134-73" href="#__codelineno-134-73"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LPBK1_BUFFER_SIZE</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CL</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-134-74" name="__codelineno-134-74" href="#__codelineno-134-74"></a><span class="w">            </span><span class="n">cl_ptr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">uint</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="cm">/* set the last uint in every cacheline */</span>
<a id="__codelineno-134-75" name="__codelineno-134-75" href="#__codelineno-134-75"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-134-76" name="__codelineno-134-76" href="#__codelineno-134-76"></a>
<a id="__codelineno-134-77" name="__codelineno-134-77" href="#__codelineno-134-77"></a><span class="w">        </span><span class="cm">/* Reset accelerator */</span>
<a id="__codelineno-134-78" name="__codelineno-134-78" href="#__codelineno-134-78"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaReset</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">);</span>
<a id="__codelineno-134-79" name="__codelineno-134-79" href="#__codelineno-134-79"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;resetting accelerator&quot;</span><span class="p">);</span>
<a id="__codelineno-134-80" name="__codelineno-134-80" href="#__codelineno-134-80"></a>
<a id="__codelineno-134-81" name="__codelineno-134-81" href="#__codelineno-134-81"></a><span class="w">        </span><span class="cm">/* Program DMA addresses */</span>
<a id="__codelineno-134-82" name="__codelineno-134-82" href="#__codelineno-134-82"></a><span class="w">        </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">iova</span><span class="p">;</span>
<a id="__codelineno-134-83" name="__codelineno-134-83" href="#__codelineno-134-83"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaGetIOAddress</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">dsm_wsid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iova</span><span class="p">);</span>
<a id="__codelineno-134-84" name="__codelineno-134-84" href="#__codelineno-134-84"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;getting DSM IOVA&quot;</span><span class="p">);</span>
<a id="__codelineno-134-85" name="__codelineno-134-85" href="#__codelineno-134-85"></a>
<a id="__codelineno-134-86" name="__codelineno-134-86" href="#__codelineno-134-86"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_AFU_DSM_BASEL</span><span class="p">,</span><span class="w"> </span><span class="n">iova</span><span class="p">);</span>
<a id="__codelineno-134-87" name="__codelineno-134-87" href="#__codelineno-134-87"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;writing CSR_AFU_DSM_BASEL&quot;</span><span class="p">);</span>
<a id="__codelineno-134-88" name="__codelineno-134-88" href="#__codelineno-134-88"></a>
<a id="__codelineno-134-89" name="__codelineno-134-89" href="#__codelineno-134-89"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_CTL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-134-90" name="__codelineno-134-90" href="#__codelineno-134-90"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;writing CSR_CFG&quot;</span><span class="p">);</span>
<a id="__codelineno-134-91" name="__codelineno-134-91" href="#__codelineno-134-91"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_CTL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-134-92" name="__codelineno-134-92" href="#__codelineno-134-92"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;writing CSR_CFG&quot;</span><span class="p">);</span>
<a id="__codelineno-134-93" name="__codelineno-134-93" href="#__codelineno-134-93"></a>
<a id="__codelineno-134-94" name="__codelineno-134-94" href="#__codelineno-134-94"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaGetIOAddress</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">input_wsid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iova</span><span class="p">);</span>
<a id="__codelineno-134-95" name="__codelineno-134-95" href="#__codelineno-134-95"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;getting input IOVA&quot;</span><span class="p">);</span>
<a id="__codelineno-134-96" name="__codelineno-134-96" href="#__codelineno-134-96"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_SRC_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">CACHELINE_ALIGNED_ADDR</span><span class="p">(</span><span class="n">iova</span><span class="p">));</span>
<a id="__codelineno-134-97" name="__codelineno-134-97" href="#__codelineno-134-97"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;writing CSR_SRC_ADDR&quot;</span><span class="p">);</span>
<a id="__codelineno-134-98" name="__codelineno-134-98" href="#__codelineno-134-98"></a>
<a id="__codelineno-134-99" name="__codelineno-134-99" href="#__codelineno-134-99"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaGetIOAddress</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">output_wsid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">iova</span><span class="p">);</span>
<a id="__codelineno-134-100" name="__codelineno-134-100" href="#__codelineno-134-100"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;getting output IOVA&quot;</span><span class="p">);</span>
<a id="__codelineno-134-101" name="__codelineno-134-101" href="#__codelineno-134-101"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaWriteMMIO64</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_DST_ADDR</span><span class="p">,</span><span class="w"> </span><span class="n">CACHELINE_ALIGNED_ADDR</span><span class="p">(</span><span class="n">iova</span><span class="p">));</span>
<a id="__codelineno-134-102" name="__codelineno-134-102" href="#__codelineno-134-102"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;writing CSR_DST_ADDR&quot;</span><span class="p">);</span>
<a id="__codelineno-134-103" name="__codelineno-134-103" href="#__codelineno-134-103"></a>
<a id="__codelineno-134-104" name="__codelineno-134-104" href="#__codelineno-134-104"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_NUM_LINES</span><span class="p">,</span><span class="w"> </span><span class="n">LPBK1_BUFFER_SIZE</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CL</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-134-105" name="__codelineno-134-105" href="#__codelineno-134-105"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;writing CSR_NUM_LINES&quot;</span><span class="p">);</span>
<a id="__codelineno-134-106" name="__codelineno-134-106" href="#__codelineno-134-106"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_CFG</span><span class="p">,</span><span class="w"> </span><span class="mh">0x42000</span><span class="p">);</span>
<a id="__codelineno-134-107" name="__codelineno-134-107" href="#__codelineno-134-107"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;writing CSR_CFG&quot;</span><span class="p">);</span>
<a id="__codelineno-134-108" name="__codelineno-134-108" href="#__codelineno-134-108"></a>
<a id="__codelineno-134-109" name="__codelineno-134-109" href="#__codelineno-134-109"></a><span class="w">        </span><span class="n">status_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsm_ptr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">DSM_STATUS_TEST_COMPLETE</span><span class="o">/</span><span class="mi">8</span><span class="p">;</span>
<a id="__codelineno-134-110" name="__codelineno-134-110" href="#__codelineno-134-110"></a>
<a id="__codelineno-134-111" name="__codelineno-134-111" href="#__codelineno-134-111"></a><span class="w">        </span><span class="cm">/* Start the test */</span>
<a id="__codelineno-134-112" name="__codelineno-134-112" href="#__codelineno-134-112"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_CTL</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<a id="__codelineno-134-113" name="__codelineno-134-113" href="#__codelineno-134-113"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;writing CSR_CFG&quot;</span><span class="p">);</span>
<a id="__codelineno-134-114" name="__codelineno-134-114" href="#__codelineno-134-114"></a>
<a id="__codelineno-134-115" name="__codelineno-134-115" href="#__codelineno-134-115"></a><span class="w">        </span><span class="cm">/* Wait for test completion */</span>
<a id="__codelineno-134-116" name="__codelineno-134-116" href="#__codelineno-134-116"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">((</span><span class="o">*</span><span class="n">status_ptr</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-134-117" name="__codelineno-134-117" href="#__codelineno-134-117"></a><span class="w">            </span><span class="n">usleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<a id="__codelineno-134-118" name="__codelineno-134-118" href="#__codelineno-134-118"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-134-119" name="__codelineno-134-119" href="#__codelineno-134-119"></a>
<a id="__codelineno-134-120" name="__codelineno-134-120" href="#__codelineno-134-120"></a><span class="w">        </span><span class="cm">/* Stop the device */</span>
<a id="__codelineno-134-121" name="__codelineno-134-121" href="#__codelineno-134-121"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaWriteMMIO32</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">CSR_CTL</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">);</span>
<a id="__codelineno-134-122" name="__codelineno-134-122" href="#__codelineno-134-122"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_output</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;writing CSR_CFG&quot;</span><span class="p">);</span>
<a id="__codelineno-134-123" name="__codelineno-134-123" href="#__codelineno-134-123"></a>
<a id="__codelineno-134-124" name="__codelineno-134-124" href="#__codelineno-134-124"></a><span class="w">        </span><span class="cm">/* Check output buffer contents */</span>
<a id="__codelineno-134-125" name="__codelineno-134-125" href="#__codelineno-134-125"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LPBK1_BUFFER_SIZE</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-134-126" name="__codelineno-134-126" href="#__codelineno-134-126"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">output_ptr</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">input_ptr</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-134-127" name="__codelineno-134-127" href="#__codelineno-134-127"></a><span class="w">                </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Output does NOT match input &quot;</span>
<a id="__codelineno-134-128" name="__codelineno-134-128" href="#__codelineno-134-128"></a><span class="w">                    </span><span class="s">&quot;at offset %i!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-134-129" name="__codelineno-134-129" href="#__codelineno-134-129"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-134-130" name="__codelineno-134-130" href="#__codelineno-134-130"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-134-131" name="__codelineno-134-131" href="#__codelineno-134-131"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-134-132" name="__codelineno-134-132" href="#__codelineno-134-132"></a>
<a id="__codelineno-134-133" name="__codelineno-134-133" href="#__codelineno-134-133"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Done Running Test</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-134-134" name="__codelineno-134-134" href="#__codelineno-134-134"></a>
<a id="__codelineno-134-135" name="__codelineno-134-135" href="#__codelineno-134-135"></a><span class="w">        </span><span class="cm">/* Release buffers */</span>
<a id="__codelineno-134-136" name="__codelineno-134-136" href="#__codelineno-134-136"></a><span class="w">    </span><span class="nl">out_free_output</span><span class="p">:</span>
<a id="__codelineno-134-137" name="__codelineno-134-137" href="#__codelineno-134-137"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaReleaseBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">output_wsid</span><span class="p">);</span>
<a id="__codelineno-134-138" name="__codelineno-134-138" href="#__codelineno-134-138"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_input</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;releasing output buffer&quot;</span><span class="p">);</span>
<a id="__codelineno-134-139" name="__codelineno-134-139" href="#__codelineno-134-139"></a><span class="w">    </span><span class="nl">out_free_input</span><span class="p">:</span>
<a id="__codelineno-134-140" name="__codelineno-134-140" href="#__codelineno-134-140"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaReleaseBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">input_wsid</span><span class="p">);</span>
<a id="__codelineno-134-141" name="__codelineno-134-141" href="#__codelineno-134-141"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_free_dsm</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;releasing input buffer&quot;</span><span class="p">);</span>
<a id="__codelineno-134-142" name="__codelineno-134-142" href="#__codelineno-134-142"></a><span class="w">    </span><span class="nl">out_free_dsm</span><span class="p">:</span>
<a id="__codelineno-134-143" name="__codelineno-134-143" href="#__codelineno-134-143"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaReleaseBuffer</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="n">dsm_wsid</span><span class="p">);</span>
<a id="__codelineno-134-144" name="__codelineno-134-144" href="#__codelineno-134-144"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_unmap</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;releasing DSM buffer&quot;</span><span class="p">);</span>
<a id="__codelineno-134-145" name="__codelineno-134-145" href="#__codelineno-134-145"></a>
<a id="__codelineno-134-146" name="__codelineno-134-146" href="#__codelineno-134-146"></a><span class="w">        </span><span class="cm">/* Unmap MMIO space */</span>
<a id="__codelineno-134-147" name="__codelineno-134-147" href="#__codelineno-134-147"></a><span class="w">    </span><span class="nl">out_unmap</span><span class="p">:</span>
<a id="__codelineno-134-148" name="__codelineno-134-148" href="#__codelineno-134-148"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaUnmapMMIO</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-134-149" name="__codelineno-134-149" href="#__codelineno-134-149"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_close</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;unmapping MMIO space&quot;</span><span class="p">);</span>
<a id="__codelineno-134-150" name="__codelineno-134-150" href="#__codelineno-134-150"></a>
<a id="__codelineno-134-151" name="__codelineno-134-151" href="#__codelineno-134-151"></a><span class="w">        </span><span class="cm">/* Release accelerator */</span>
<a id="__codelineno-134-152" name="__codelineno-134-152" href="#__codelineno-134-152"></a><span class="w">    </span><span class="nl">out_close</span><span class="p">:</span>
<a id="__codelineno-134-153" name="__codelineno-134-153" href="#__codelineno-134-153"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaClose</span><span class="p">(</span><span class="n">afu_handle</span><span class="p">);</span>
<a id="__codelineno-134-154" name="__codelineno-134-154" href="#__codelineno-134-154"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_destroy_tok</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;closing accelerator&quot;</span><span class="p">);</span>
<a id="__codelineno-134-155" name="__codelineno-134-155" href="#__codelineno-134-155"></a>
<a id="__codelineno-134-156" name="__codelineno-134-156" href="#__codelineno-134-156"></a><span class="w">        </span><span class="cm">/* Destroy token */</span>
<a id="__codelineno-134-157" name="__codelineno-134-157" href="#__codelineno-134-157"></a><span class="w">    </span><span class="nl">out_destroy_tok</span><span class="p">:</span>
<a id="__codelineno-134-158" name="__codelineno-134-158" href="#__codelineno-134-158"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaDestroyToken</span><span class="p">(</span><span class="o">&amp;</span><span class="n">afu_token</span><span class="p">);</span>
<a id="__codelineno-134-159" name="__codelineno-134-159" href="#__codelineno-134-159"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_destroy_prop</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;destroying token&quot;</span><span class="p">);</span>
<a id="__codelineno-134-160" name="__codelineno-134-160" href="#__codelineno-134-160"></a>
<a id="__codelineno-134-161" name="__codelineno-134-161" href="#__codelineno-134-161"></a><span class="w">        </span><span class="cm">/* Destroy properties object */</span>
<a id="__codelineno-134-162" name="__codelineno-134-162" href="#__codelineno-134-162"></a><span class="w">    </span><span class="nl">out_destroy_prop</span><span class="p">:</span>
<a id="__codelineno-134-163" name="__codelineno-134-163" href="#__codelineno-134-163"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fpgaDestroyProperties</span><span class="p">(</span><span class="o">&amp;</span><span class="n">filter</span><span class="p">);</span>
<a id="__codelineno-134-164" name="__codelineno-134-164" href="#__codelineno-134-164"></a><span class="w">        </span><span class="n">ON_ERR_GOTO</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">out_exit</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;destroying properties object&quot;</span><span class="p">);</span>
<a id="__codelineno-134-165" name="__codelineno-134-165" href="#__codelineno-134-165"></a>
<a id="__codelineno-134-166" name="__codelineno-134-166" href="#__codelineno-134-166"></a><span class="w">    </span><span class="nl">out_exit</span><span class="p">:</span>
<a id="__codelineno-134-167" name="__codelineno-134-167" href="#__codelineno-134-167"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-134-168" name="__codelineno-134-168" href="#__codelineno-134-168"></a>
<a id="__codelineno-134-169" name="__codelineno-134-169" href="#__codelineno-134-169"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>Linking with the OPAE library is straightforward. Code using this library should include the header file fpga.h. Taking the GCC compiler on Linux as an example, the minimalist compile and link line should look like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a>gcc<span class="w"> </span>-std<span class="o">=</span>c99<span class="w"> </span>hello_fpga.c<span class="w"> </span>-I/usr/local/include<span class="w"> </span>-L/usr/local/lib<span class="w"> </span>-lopae-c<span class="w"> </span>-luuid<span class="w"> </span>-ljson-c<span class="w"> </span>-lpthread<span class="w"> </span>-o<span class="w"> </span>hello_fpga
</code></pre></div>
<p>The API uses some features from the C99 language standard. The
<code>-std=c99</code> switch is required if the compiler does not support C99 by
default.</p>
<p>Third-party library dependency: The library internally uses
<code>libuuid</code> and <code>libjson-c</code>. But they are not distributed as part of the
library. Make sure you have these libraries properly installed. The <code>-c</code> flag may not be necessary depending on 
the platform being used. </p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a>sudo<span class="w"> </span>./hello_fpga<span class="w"> </span>-c
<a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a>Running<span class="w"> </span>Test
<a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a>Running<span class="w"> </span>on<span class="w"> </span>bus<span class="w"> </span>0x08.
<a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a>AFU<span class="w"> </span>NLB0<span class="w"> </span>found<span class="w"> </span>@<span class="w"> </span><span class="m">28000</span>
<a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a>Done<span class="w"> </span>Running<span class="w"> </span>Test
</code></pre></div>
To run the hello_fpga application:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a>sudo<span class="w"> </span>./hello_fpga
<a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a>Running<span class="w"> </span>Test
<a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a>Done
</code></pre></div>
<h2 id="appendix-a-integrating-an-n6001-based-custom-platform-with-dfl-and-opae"><strong>Appendix A - Integrating an N6001 Based Custom Platform with <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> and OPAE</strong><a class="headerlink" href="#appendix-a-integrating-an-n6001-based-custom-platform-with-dfl-and-opae" title="Permanent link">&para;</a></h2>
<p>The process of adding a custom device to the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> framework and <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> requires changes to files 
in several locations. In this section we will walk through the additions necessary to instruct the kernel's probe and match function
to associate your new device with OPAE, choose the correct OPAE plugin to associate with your board, and change basic descriptors to properly
display the name of your new custom platform when using OPAE's management interfaces. </p>
<p>This section does not require useage of an entirely new platform - we will use the Intel N6001's <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design as our base, and alter only those
settings in the PCIe IP necessary to change the following PCIe IDs for both the PF and VF:</p>
<ul>
<li>Vendor ID</li>
<li>Device ID</li>
<li>Subsystem Vendor ID</li>
<li>Subsystem Device ID</li>
</ul>
<p>This document will not cover the process by which a <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> can be modified to support these new IDs. Refer to section <strong>5.7 How to 
change the PCIe device ID and Vendor ID</strong> in  <a href="../../../../f2000x/dev_guides/fim_dev/ug_dev_fim_ofs/">F2000x</a> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Developer guide or section <strong>10.0 How to 
change the PCIe device ID and Vendor ID</strong> in the <a href="../../../../n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/">N6001</a> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Developer guide
for an overview of this process. The following sections assume you have a <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> that has been configured with new IDs. This <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> can be loaded
onto your N6001 board using either the SOF via a USB-BlasterII cable and the Quartus Programmer, or by using the OPAE command <code>fpgasupdate</code> consuming a compatible binary programming
file. The following values will be used as our new device IDs.</p>
<table>
<thead>
<tr>
<th>ID Type</th>
<th>PF0</th>
<th>PF0-VF</th>
</tr>
</thead>
<tbody>
<tr>
<td>Vendor ID</td>
<td>0xff00</td>
<td>0xff00</td>
</tr>
<tr>
<td>Device ID</td>
<td>0x1234</td>
<td>0x5555</td>
</tr>
<tr>
<td>Subsystem Vendor ID</td>
<td>0xff00</td>
<td>0xff00</td>
</tr>
<tr>
<td>Subsystem Device ID</td>
<td>0x0x5678</td>
<td>0x5678</td>
</tr>
</tbody>
</table>
<p>The only value that differs between PF0 and PF0-VF in this example is the Device ID, and all other values do not currently exist in either the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr>
or linux-dfl drivers. You will need to download the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> and linux-dfl sources from GitHub and modify their contents. We will be using a validated Agilex <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> release to pair
our <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> and linux-dfl versions together. Refer to the below table for a list of the exact version we will use for each software component and where you can 
learn how to build and install. Your versions may not match those in the document.</p>
<table>
<thead>
<tr>
<th>Software</th>
<th>Version</th>
<th>Build Instructions</th>
</tr>
</thead>
<tbody>
<tr>
<td><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr></td>
<td>2.3.0-1</td>
<td><a href="../../../sw_installation/pcie_attach/sw_install_pcie_attach/"><strong>4.0 OPAE Software Development Kit</strong></a></td>
</tr>
<tr>
<td>linux-dfl</td>
<td>ofs-2022.3-2</td>
<td><a href="../../../sw_installation/pcie_attach/sw_install_pcie_attach/"><strong>3.0 Intel <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> Kernel Drivers</strong></a></td>
</tr>
</tbody>
</table>
<p>The following steps will enable your device to use the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr>. We will call our new device the "Intel FPGA Programmable Acceleration Card N6002".
This device is identical to the Intel FPGA Programmable Acceleration Card N6001, and will use the pre-existing plugins and feature ID associated with that device. We will also use the enum value <code>FPGA_HW_DCP_N6002</code> to describe our new board
in the code. These plugins can be customized as you become more familiar with the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> software. </p>
<ol>
<li>Download the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> from GitHub. File paths assume the user is in the directory <code>opae-sdk</code>.</li>
<li>Open the file <code>binaries/opae.io/opae/io/config.py</code>. Add a new configuration entry under <code>DEFAULT_OPAE_IO_CONFIG</code>. Save and exit.</li>
</ol>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="p">(</span><span class="mh">0xff00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1234</span><span class="p">,</span><span class="w"> </span><span class="mh">0xff00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5678</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="w">        </span><span class="err">&#39;</span><span class="n">platform</span><span class="err">&#39;</span><span class="o">:</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Intel</span><span class="w"> </span><span class="n">FPGA</span><span class="w"> </span><span class="n">Programmable</span><span class="w"> </span><span class="n">Acceleration</span><span class="w"> </span><span class="n">Card</span><span class="w"> </span><span class="n">N6002</span><span class="err">&#39;</span>
<a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a><span class="w">    </span><span class="p">},</span>
</code></pre></div>
<ol>
<li>Open the file <code>libraries/libopae-c/cfg-file.c</code>. Add two new entries (one for PF0 and PF0-VF) under <code>STATIC libopae_config_data default_libopae_config_table[]</code>. Add  two new entries under <code>STATIC fpgainfo_config_data default_fpgainfo_config_table[]</code>. Save and exit.</li>
</ol>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="n">STATIC</span><span class="w"> </span><span class="n">fpgainfo_config_data</span><span class="w"> </span><span class="n">default_fpgainfo_config_table</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="p">...</span>
<a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="p">{</span><span class="w"> </span><span class="mh">0xff00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1234</span><span class="p">,</span><span class="w"> </span><span class="mh">0xff00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5678</span><span class="p">,</span><span class="w"> </span><span class="mh">0x12</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;libboard_n6000.so&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span>
<a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a><span class="s">&quot;Intel FPGA Programmable Acceleration Card N6002&quot;</span><span class="w"> </span><span class="p">},</span><span class="w">                  </span><span class="c1">// N6002 PF0</span>
<a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a><span class="p">{</span><span class="w"> </span><span class="mh">0xff00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5555</span><span class="p">,</span><span class="w"> </span><span class="mh">0xff00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5678</span><span class="p">,</span><span class="w"> </span><span class="mh">0x12</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;libboard_n6000.so&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span>
<a id="__codelineno-139-6" name="__codelineno-139-6" href="#__codelineno-139-6"></a><span class="s">&quot;Intel FPGA Programmable Acceleration Card N6002&quot;</span><span class="w"> </span><span class="p">},</span><span class="w">                  </span><span class="c1">// N6002 PF0-VF</span>
</code></pre></div>
<p><strong>Example:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="n">STATIC</span><span class="w"> </span><span class="n">libopae_config_data</span><span class="w"> </span><span class="n">default_libopae_config_table</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a><span class="p">...</span>
<a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a><span class="p">{</span><span class="w"> </span><span class="mh">0xff00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1234</span><span class="p">,</span><span class="w"> </span><span class="mh">0xff00</span><span class="p">,</span><span class="w">          </span><span class="mh">0x5678</span><span class="p">,</span><span class="w">          </span><span class="s">&quot;libxfpga.so&quot;</span><span class="p">,</span><span class="w">  </span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="c1">// N6002 PF0</span>
<a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a><span class="p">{</span><span class="w"> </span><span class="mh">0xff00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5555</span><span class="p">,</span><span class="w"> </span><span class="mh">0xff00</span><span class="p">,</span><span class="w">          </span><span class="mh">0x5678</span><span class="p">,</span><span class="w">          </span><span class="s">&quot;libxfpga.so&quot;</span><span class="p">,</span><span class="w">  </span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="c1">// N6002 PF0-VF</span>
</code></pre></div>
4. Open the file <code>libraries/plugins/xfpga/metrics/metric_utils.c</code>. Add one entry to the switch case under <code>enum_fpga_metrics(fpga_handle handle)</code>. The enum value used should match the enum set in step 6. 
Add a new condition to the if statement beginning <code>if (((_fpga_enum_metric-&gt;hw_type == FPGA_HW_DCP_N3000)</code>. Save and exit.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="w">                 </span><span class="c1">// DCP VC DC</span>
<a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a><span class="w">                 </span><span class="k">case</span><span class="w"> </span><span class="no">FPGA_HW_DCP_N3000</span><span class="p">:</span>
<a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a><span class="w">                 </span><span class="k">case</span><span class="w"> </span><span class="no">FPGA_HW_DCP_D5005</span><span class="p">:</span>
<a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a><span class="w">                 </span><span class="k">case</span><span class="w"> </span><span class="no">FPGA_HW_DCP_N6002</span><span class="p">:</span>
<a id="__codelineno-141-5" name="__codelineno-141-5" href="#__codelineno-141-5"></a><span class="w">                 </span><span class="k">case</span><span class="w"> </span><span class="no">FPGA_HW_DCP_N5010</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-141-6" name="__codelineno-141-6" href="#__codelineno-141-6"></a><span class="w">                 </span><span class="p">...</span>
</code></pre></div>
<p><strong>Example:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(((</span><span class="n">_fpga_enum_metric</span><span class="o">-&gt;</span><span class="n">hw_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FPGA_HW_DCP_N3000</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a><span class="w">                                 </span><span class="p">(</span><span class="n">_fpga_enum_metric</span><span class="o">-&gt;</span><span class="n">hw_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FPGA_HW_DCP_D5005</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a><span class="w">                                 </span><span class="p">(</span><span class="n">_fpga_enum_metric</span><span class="o">-&gt;</span><span class="n">hw_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FPGA_HW_DCP_N6002</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a><span class="w">                                 </span><span class="p">(</span><span class="n">_fpga_enum_metric</span><span class="o">-&gt;</span><span class="n">hw_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">FPGA_HW_DCP_N5010</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span>
</code></pre></div>
5. Open the file <code>libraries/plugins/xfpga/sysfs.c</code>. Add a new set of switch cases under <code>enum fpga_hw_type opae_id_to_hw_type(uint16_t vendor_id, uint16_t device_id)</code>. The enum value
used should match the enum value set in step 6. Save and exit.</p>
<p><strong>Example:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vendor_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xff00</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">        </span>
<a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a><span class="w">                 </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a><span class="w">                         </span><span class="k">case</span><span class="w"> </span><span class="mh">0x1234</span><span class="p">:</span>
<a id="__codelineno-143-4" name="__codelineno-143-4" href="#__codelineno-143-4"></a><span class="w">                         </span><span class="k">case</span><span class="w"> </span><span class="mh">0x5555</span><span class="p">:</span>
<a id="__codelineno-143-5" name="__codelineno-143-5" href="#__codelineno-143-5"></a><span class="w">                                 </span><span class="n">hw_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FPGA_HW_DCP_N6002</span><span class="p">;</span>
<a id="__codelineno-143-6" name="__codelineno-143-6" href="#__codelineno-143-6"></a><span class="w">                         </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-143-7" name="__codelineno-143-7" href="#__codelineno-143-7"></a><span class="w">                 </span><span class="k">default</span><span class="o">:</span>
<a id="__codelineno-143-8" name="__codelineno-143-8" href="#__codelineno-143-8"></a><span class="w">                         </span><span class="n">OPAE_ERR</span><span class="p">(</span><span class="s">&quot;unknown device id: 0x%04x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">device_id</span><span class="p">);</span>
</code></pre></div>
6. Open the file <code>libraries/plugins/xfpga/types_int.h</code>. Add your new enum value under <code>enum fpga_hw_type</code>. Save and exit.</p>
<p><strong>Example:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="k">enum</span><span class="w"> </span><span class="n">fpga_hw_type</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a><span class="w">         </span><span class="n">FPGA_HW_MCP</span><span class="p">,</span>
<a id="__codelineno-144-3" name="__codelineno-144-3" href="#__codelineno-144-3"></a><span class="w">         </span><span class="n">FPGA_HW_DCP_RC</span><span class="p">,</span>
<a id="__codelineno-144-4" name="__codelineno-144-4" href="#__codelineno-144-4"></a><span class="w">         </span><span class="n">FPGA_HW_DCP_D5005</span><span class="p">,</span>
<a id="__codelineno-144-5" name="__codelineno-144-5" href="#__codelineno-144-5"></a><span class="w">         </span><span class="n">FPGA_HW_DCP_N3000</span><span class="p">,</span>
<a id="__codelineno-144-6" name="__codelineno-144-6" href="#__codelineno-144-6"></a><span class="w">         </span><span class="n">FPGA_HW_DCP_N5010</span><span class="p">,</span>
<a id="__codelineno-144-7" name="__codelineno-144-7" href="#__codelineno-144-7"></a><span class="w">         </span><span class="n">FPGA_HW_DCP_N6002</span><span class="p">,</span>
<a id="__codelineno-144-8" name="__codelineno-144-8" href="#__codelineno-144-8"></a><span class="w">         </span><span class="n">FPGA_HW_UNKNOWN</span>
<a id="__codelineno-144-9" name="__codelineno-144-9" href="#__codelineno-144-9"></a><span class="p">};</span>
</code></pre></div>
7. Open the file <code>opae.cfg</code>. Create a new entry for device "n6002" by copying the entry for "n6001,"" substituting our new values. Add one new entry under "configs" for the name "n6002." Save and exit.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a><span class="w">    </span><span class="s">&quot;n6002&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a><span class="w">      </span><span class="s">&quot;enabled&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<a id="__codelineno-145-3" name="__codelineno-145-3" href="#__codelineno-145-3"></a><span class="w">      </span><span class="s">&quot;platform&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Intel Acceleration Development Platform N6002&quot;</span><span class="p">,</span>
<a id="__codelineno-145-4" name="__codelineno-145-4" href="#__codelineno-145-4"></a><span class="w">      </span><span class="s">&quot;devices&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-145-5" name="__codelineno-145-5" href="#__codelineno-145-5"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;n6002_pf&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;0xff00&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0x1234&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0xff00&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0x5678&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-145-6" name="__codelineno-145-6" href="#__codelineno-145-6"></a><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;n6002_vf&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;0xff00&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0x5555&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0xff00&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0x5678&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-145-7" name="__codelineno-145-7" href="#__codelineno-145-7"></a><span class="w">      </span><span class="p">],</span>
<a id="__codelineno-145-8" name="__codelineno-145-8" href="#__codelineno-145-8"></a><span class="w">      </span><span class="s">&quot;opae&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-145-9" name="__codelineno-145-9" href="#__codelineno-145-9"></a><span class="w">        </span><span class="s">&quot;plugin&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-145-10" name="__codelineno-145-10" href="#__codelineno-145-10"></a><span class="w">          </span><span class="p">{</span>
<a id="__codelineno-145-11" name="__codelineno-145-11" href="#__codelineno-145-11"></a><span class="w">            </span><span class="s">&quot;enabled&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<a id="__codelineno-145-12" name="__codelineno-145-12" href="#__codelineno-145-12"></a><span class="w">            </span><span class="s">&quot;module&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;libxfpga.so&quot;</span><span class="p">,</span>
<a id="__codelineno-145-13" name="__codelineno-145-13" href="#__codelineno-145-13"></a><span class="w">            </span><span class="s">&quot;devices&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;n6002_pf&quot;</span><span class="w"> </span><span class="p">],</span>
<a id="__codelineno-145-14" name="__codelineno-145-14" href="#__codelineno-145-14"></a><span class="w">            </span><span class="s">&quot;configuration&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-145-15" name="__codelineno-145-15" href="#__codelineno-145-15"></a><span class="w">          </span><span class="p">},</span>
<a id="__codelineno-145-16" name="__codelineno-145-16" href="#__codelineno-145-16"></a><span class="w">          </span><span class="p">{</span>
<a id="__codelineno-145-17" name="__codelineno-145-17" href="#__codelineno-145-17"></a><span class="w">            </span><span class="s">&quot;enabled&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<a id="__codelineno-145-18" name="__codelineno-145-18" href="#__codelineno-145-18"></a><span class="w">            </span><span class="s">&quot;module&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;libopae-v.so&quot;</span><span class="p">,</span>
<a id="__codelineno-145-19" name="__codelineno-145-19" href="#__codelineno-145-19"></a><span class="w">            </span><span class="s">&quot;devices&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;n6002_pf&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;n6002_vf&quot;</span><span class="w"> </span><span class="p">],</span>
<a id="__codelineno-145-20" name="__codelineno-145-20" href="#__codelineno-145-20"></a><span class="w">            </span><span class="s">&quot;configuration&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-145-21" name="__codelineno-145-21" href="#__codelineno-145-21"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-145-22" name="__codelineno-145-22" href="#__codelineno-145-22"></a><span class="w">        </span><span class="p">],</span>
<a id="__codelineno-145-23" name="__codelineno-145-23" href="#__codelineno-145-23"></a><span class="w">        </span><span class="s">&quot;fpgainfo&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-145-24" name="__codelineno-145-24" href="#__codelineno-145-24"></a><span class="w">          </span><span class="p">{</span>
<a id="__codelineno-145-25" name="__codelineno-145-25" href="#__codelineno-145-25"></a><span class="w">            </span><span class="s">&quot;enabled&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<a id="__codelineno-145-26" name="__codelineno-145-26" href="#__codelineno-145-26"></a><span class="w">            </span><span class="s">&quot;module&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;libboard_n6000.so&quot;</span><span class="p">,</span>
<a id="__codelineno-145-27" name="__codelineno-145-27" href="#__codelineno-145-27"></a><span class="w">            </span><span class="s">&quot;devices&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-145-28" name="__codelineno-145-28" href="#__codelineno-145-28"></a><span class="w">              </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;device&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;n6002_pf&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;feature_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;0x12&quot;</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-145-29" name="__codelineno-145-29" href="#__codelineno-145-29"></a><span class="w">              </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;device&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;n6002_vf&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;feature_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;0x12&quot;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-145-30" name="__codelineno-145-30" href="#__codelineno-145-30"></a><span class="w">            </span><span class="p">]</span>
<a id="__codelineno-145-31" name="__codelineno-145-31" href="#__codelineno-145-31"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-145-32" name="__codelineno-145-32" href="#__codelineno-145-32"></a><span class="w">        </span><span class="p">],</span>
<a id="__codelineno-145-33" name="__codelineno-145-33" href="#__codelineno-145-33"></a><span class="w">        </span><span class="s">&quot;fpgad&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-145-34" name="__codelineno-145-34" href="#__codelineno-145-34"></a><span class="w">         </span><span class="p">{</span>
<a id="__codelineno-145-35" name="__codelineno-145-35" href="#__codelineno-145-35"></a><span class="w">            </span><span class="s">&quot;enabled&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<a id="__codelineno-145-36" name="__codelineno-145-36" href="#__codelineno-145-36"></a><span class="w">            </span><span class="s">&quot;module&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;libfpgad-vc.so&quot;</span><span class="p">,</span>
<a id="__codelineno-145-37" name="__codelineno-145-37" href="#__codelineno-145-37"></a><span class="w">            </span><span class="s">&quot;devices&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;n6002_pf&quot;</span><span class="w"> </span><span class="p">],</span>
<a id="__codelineno-145-38" name="__codelineno-145-38" href="#__codelineno-145-38"></a><span class="w">            </span><span class="s">&quot;configuration&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-145-39" name="__codelineno-145-39" href="#__codelineno-145-39"></a><span class="w">              </span><span class="s">&quot;cool-down&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-145-40" name="__codelineno-145-40" href="#__codelineno-145-40"></a><span class="w">              </span><span class="s">&quot;get-aer&quot;</span><span class="o">:</span><span class="w">     </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;setpci -s %s ECAP_AER+0x08.L&quot;</span><span class="p">,</span>
<a id="__codelineno-145-41" name="__codelineno-145-41" href="#__codelineno-145-41"></a><span class="w">                               </span><span class="s">&quot;setpci -s %s ECAP_AER+0x14.L&quot;</span><span class="w"> </span><span class="p">],</span>
<a id="__codelineno-145-42" name="__codelineno-145-42" href="#__codelineno-145-42"></a><span class="w">              </span><span class="s">&quot;disable-aer&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;setpci -s %s ECAP_AER+0x08.L=0xffffffff&quot;</span><span class="p">,</span>
<a id="__codelineno-145-43" name="__codelineno-145-43" href="#__codelineno-145-43"></a><span class="w">                               </span><span class="s">&quot;setpci -s %s ECAP_AER+0x14.L=0xffffffff&quot;</span><span class="w"> </span><span class="p">],</span>
<a id="__codelineno-145-44" name="__codelineno-145-44" href="#__codelineno-145-44"></a><span class="w">              </span><span class="s">&quot;set-aer&quot;</span><span class="o">:</span><span class="w">     </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;setpci -s %s ECAP_AER+0x08.L=0x%08x&quot;</span><span class="p">,</span>
<a id="__codelineno-145-45" name="__codelineno-145-45" href="#__codelineno-145-45"></a><span class="w">                               </span><span class="s">&quot;setpci -s %s ECAP_AER+0x14.L=0x%08x&quot;</span><span class="w"> </span><span class="p">],</span>
<a id="__codelineno-145-46" name="__codelineno-145-46" href="#__codelineno-145-46"></a><span class="w">              </span><span class="s">&quot;sensor-overrides&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
<a id="__codelineno-145-47" name="__codelineno-145-47" href="#__codelineno-145-47"></a><span class="w">              </span><span class="s">&quot;monitor-seu&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">false</span>
<a id="__codelineno-145-48" name="__codelineno-145-48" href="#__codelineno-145-48"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-145-49" name="__codelineno-145-49" href="#__codelineno-145-49"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-145-50" name="__codelineno-145-50" href="#__codelineno-145-50"></a><span class="w">        </span><span class="p">],</span>
<a id="__codelineno-145-51" name="__codelineno-145-51" href="#__codelineno-145-51"></a><span class="w">        </span><span class="s">&quot;rsu&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-145-52" name="__codelineno-145-52" href="#__codelineno-145-52"></a><span class="w">          </span><span class="p">{</span>
<a id="__codelineno-145-53" name="__codelineno-145-53" href="#__codelineno-145-53"></a><span class="w">            </span><span class="s">&quot;enabled&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<a id="__codelineno-145-54" name="__codelineno-145-54" href="#__codelineno-145-54"></a><span class="w">            </span><span class="s">&quot;devices&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;n6002_pf&quot;</span><span class="w"> </span><span class="p">],</span>
<a id="__codelineno-145-55" name="__codelineno-145-55" href="#__codelineno-145-55"></a><span class="w">            </span><span class="s">&quot;fpga_default_sequences&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;common_rsu_sequences&quot;</span>
<a id="__codelineno-145-56" name="__codelineno-145-56" href="#__codelineno-145-56"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-145-57" name="__codelineno-145-57" href="#__codelineno-145-57"></a><span class="w">        </span><span class="p">],</span>
<a id="__codelineno-145-58" name="__codelineno-145-58" href="#__codelineno-145-58"></a><span class="w">        </span><span class="s">&quot;fpgareg&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-145-59" name="__codelineno-145-59" href="#__codelineno-145-59"></a><span class="w">          </span><span class="p">{</span>
<a id="__codelineno-145-60" name="__codelineno-145-60" href="#__codelineno-145-60"></a><span class="w">            </span><span class="s">&quot;enabled&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<a id="__codelineno-145-61" name="__codelineno-145-61" href="#__codelineno-145-61"></a><span class="w">            </span><span class="s">&quot;devices&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;n6002_pf&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;n6002_vf&quot;</span><span class="w"> </span><span class="p">]</span>
<a id="__codelineno-145-62" name="__codelineno-145-62" href="#__codelineno-145-62"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-145-63" name="__codelineno-145-63" href="#__codelineno-145-63"></a><span class="w">        </span><span class="p">],</span>
<a id="__codelineno-145-64" name="__codelineno-145-64" href="#__codelineno-145-64"></a><span class="w">        </span><span class="s">&quot;opae.io&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-145-65" name="__codelineno-145-65" href="#__codelineno-145-65"></a><span class="w">          </span><span class="p">{</span>
<a id="__codelineno-145-66" name="__codelineno-145-66" href="#__codelineno-145-66"></a><span class="w">            </span><span class="s">&quot;enabled&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span>
<a id="__codelineno-145-67" name="__codelineno-145-67" href="#__codelineno-145-67"></a><span class="w">            </span><span class="s">&quot;devices&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s">&quot;n6002_pf&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;n6002_vf&quot;</span><span class="w"> </span><span class="p">]</span>
<a id="__codelineno-145-68" name="__codelineno-145-68" href="#__codelineno-145-68"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-145-69" name="__codelineno-145-69" href="#__codelineno-145-69"></a><span class="w">        </span><span class="p">]</span>
<a id="__codelineno-145-70" name="__codelineno-145-70" href="#__codelineno-145-70"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-145-71" name="__codelineno-145-71" href="#__codelineno-145-71"></a><span class="w">    </span><span class="p">},</span>
</code></pre></div>
<p><strong>Example:</strong></p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="s">&quot;configs&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-146-2" name="__codelineno-146-2" href="#__codelineno-146-2"></a><span class="w">     </span><span class="s">&quot;mcp&quot;</span><span class="p">,</span>
<a id="__codelineno-146-3" name="__codelineno-146-3" href="#__codelineno-146-3"></a><span class="w">     </span><span class="s">&quot;a10gx&quot;</span><span class="p">,</span>
<a id="__codelineno-146-4" name="__codelineno-146-4" href="#__codelineno-146-4"></a><span class="w">     </span><span class="s">&quot;d5005&quot;</span><span class="p">,</span>
<a id="__codelineno-146-5" name="__codelineno-146-5" href="#__codelineno-146-5"></a><span class="w">     </span><span class="s">&quot;n3000&quot;</span><span class="p">,</span>
<a id="__codelineno-146-6" name="__codelineno-146-6" href="#__codelineno-146-6"></a><span class="w">     </span><span class="s">&quot;n5010&quot;</span><span class="p">,</span>
<a id="__codelineno-146-7" name="__codelineno-146-7" href="#__codelineno-146-7"></a><span class="w">     </span><span class="s">&quot;n5013&quot;</span><span class="p">,</span>
<a id="__codelineno-146-8" name="__codelineno-146-8" href="#__codelineno-146-8"></a><span class="w">     </span><span class="s">&quot;n5014&quot;</span><span class="p">,</span>
<a id="__codelineno-146-9" name="__codelineno-146-9" href="#__codelineno-146-9"></a><span class="w">     </span><span class="s">&quot;n6000&quot;</span><span class="p">,</span>
<a id="__codelineno-146-10" name="__codelineno-146-10" href="#__codelineno-146-10"></a><span class="w">     </span><span class="s">&quot;n6001&quot;</span><span class="p">,</span>
<a id="__codelineno-146-11" name="__codelineno-146-11" href="#__codelineno-146-11"></a><span class="w">     </span><span class="s">&quot;n6002&quot;</span><span class="p">,</span>
<a id="__codelineno-146-12" name="__codelineno-146-12" href="#__codelineno-146-12"></a><span class="w">     </span><span class="p">...</span>
</code></pre></div>
These conclude our integration of our new platform with the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr>. The next step is to download the source for linux-dfl (as shown above) 
and configure our new kernel's match and probe function to associate the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers
with our new custom platform. The following file path assumes the user is in the directory <code>linux-dfl</code>
1. Open the file <code>drivers/fpga/dfl-pci.c</code>. Define a list of necessary ID values at the top of the file. Use these values to add two new entries under <code>pci_device_id cci_pcie_id_tbl[]</code>,
one for PF0 and the other for PF0-VF. Save and exit.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="cm">/* N6002 IDS */</span>
<a id="__codelineno-147-2" name="__codelineno-147-2" href="#__codelineno-147-2"></a><span class="cp">#define PCIE_DEVICE_ID_PF_N6002                 0x1234</span>
<a id="__codelineno-147-3" name="__codelineno-147-3" href="#__codelineno-147-3"></a><span class="cp">#define PCIE_VENDOR_ID_PF_N6002                 0xff00</span>
<a id="__codelineno-147-4" name="__codelineno-147-4" href="#__codelineno-147-4"></a><span class="cp">#define PCIE_SUBDEVICE_ID_PF_N6002              0x5678</span>
<a id="__codelineno-147-5" name="__codelineno-147-5" href="#__codelineno-147-5"></a><span class="cp">#define PCIE_DEVICE_ID_VF_N6002                 0x5555</span>
</code></pre></div>
<p><strong>Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">pci_device_id</span><span class="w"> </span><span class="n">cci_pcie_id_tbl</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a><span class="w">        </span><span class="p">...</span>
<a id="__codelineno-148-3" name="__codelineno-148-3" href="#__codelineno-148-3"></a><span class="w">        </span><span class="p">{</span><span class="n">PCI_DEVICE_SUB</span><span class="p">(</span><span class="n">PCIE_VENDOR_ID_PF_N6002</span><span class="p">,</span><span class="w"> </span><span class="n">PCIE_DEVICE_ID_PF_N6002</span><span class="p">,</span>
<a id="__codelineno-148-4" name="__codelineno-148-4" href="#__codelineno-148-4"></a><span class="w">                    </span><span class="n">PCIE_VENDOR_ID_PF_N6002</span><span class="p">,</span><span class="w"> </span><span class="n">PCIE_SUBDEVICE_ID_PF_N6002</span><span class="p">),},</span><span class="w"> </span><span class="c1">//N6002 PF0</span>
<a id="__codelineno-148-5" name="__codelineno-148-5" href="#__codelineno-148-5"></a><span class="w">        </span><span class="p">{</span><span class="n">PCI_DEVICE_SUB</span><span class="p">(</span><span class="n">PCIE_VENDOR_ID_PF_N6002</span><span class="p">,</span><span class="w"> </span><span class="n">PCIE_DEVICE_ID_VF_N6002</span><span class="p">,</span>
<a id="__codelineno-148-6" name="__codelineno-148-6" href="#__codelineno-148-6"></a><span class="w">                    </span><span class="n">PCIE_VENDOR_ID_PF_N6002</span><span class="p">,</span><span class="w"> </span><span class="n">PCIE_SUBDEVICE_ID_PF_N6002</span><span class="p">),},</span><span class="w"> </span><span class="c1">//N6002 PF0-VF</span>
<a id="__codelineno-148-7" name="__codelineno-148-7" href="#__codelineno-148-7"></a><span class="w">                    </span><span class="p">...</span>
</code></pre></div>
<p>This concludes our integration our new platform with the linux-dfl driver set. Build and install the linux-dfl enabled kernel and the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> userspace libraries as discussed in their relevant
sections in the user guide linked above. If the above conditions have been met, and your N6001 board has been configured with this new "N6002" <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, you should see the following output when running the command "fpgainfo fme" (your Bitstream ID,
<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Interface ID, and Image Info entries may differ). Check that the board's display name at the top and values for Vendor/Device/SubVendor/Subdevice IDs are correct.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="n">Intel</span><span class="w"> </span><span class="n">Acceleration</span><span class="w"> </span><span class="n">Development</span><span class="w"> </span><span class="n">Platform</span><span class="w"> </span><span class="n">N6002</span>
<a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a><span class="n">Board</span><span class="w"> </span><span class="n">Management</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="n">NIOS</span><span class="w"> </span><span class="n">FW</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w"> </span><span class="mf">3.11.0</span>
<a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a><span class="n">Board</span><span class="w"> </span><span class="n">Management</span><span class="w"> </span><span class="n">Controller</span><span class="w"> </span><span class="n">Build</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w"> </span><span class="mf">3.11.0</span>
<a id="__codelineno-149-4" name="__codelineno-149-4" href="#__codelineno-149-4"></a><span class="c1">//****** FME ******//</span>
<a id="__codelineno-149-5" name="__codelineno-149-5" href="#__codelineno-149-5"></a><span class="n">Object</span><span class="w"> </span><span class="n">Id</span><span class="w">                        </span><span class="o">:</span><span class="w"> </span><span class="mh">0xED00001</span>
<a id="__codelineno-149-6" name="__codelineno-149-6" href="#__codelineno-149-6"></a><span class="n">PCIe</span><span class="w"> </span><span class="n">s</span><span class="o">:</span><span class="n">b</span><span class="o">:</span><span class="n">d</span><span class="p">.</span><span class="n">f</span><span class="w">                     </span><span class="o">:</span><span class="w"> </span><span class="mo">0000</span><span class="o">:</span><span class="n">B1</span><span class="o">:</span><span class="mf">00.0</span>
<a id="__codelineno-149-7" name="__codelineno-149-7" href="#__codelineno-149-7"></a><span class="n">Vendor</span><span class="w"> </span><span class="n">Id</span><span class="w">                        </span><span class="o">:</span><span class="w"> </span><span class="mh">0xFF00</span>
<a id="__codelineno-149-8" name="__codelineno-149-8" href="#__codelineno-149-8"></a><span class="n">Device</span><span class="w"> </span><span class="n">Id</span><span class="w">                        </span><span class="o">:</span><span class="w"> </span><span class="mh">0x1234</span>
<a id="__codelineno-149-9" name="__codelineno-149-9" href="#__codelineno-149-9"></a><span class="n">SubVendor</span><span class="w"> </span><span class="n">Id</span><span class="w">                     </span><span class="o">:</span><span class="w"> </span><span class="mh">0xFF00</span>
<a id="__codelineno-149-10" name="__codelineno-149-10" href="#__codelineno-149-10"></a><span class="n">SubDevice</span><span class="w"> </span><span class="n">Id</span><span class="w">                     </span><span class="o">:</span><span class="w"> </span><span class="mh">0x5678</span>
<a id="__codelineno-149-11" name="__codelineno-149-11" href="#__codelineno-149-11"></a><span class="n">Socket</span><span class="w"> </span><span class="n">Id</span><span class="w">                        </span><span class="o">:</span><span class="w"> </span><span class="mh">0x00</span>
<a id="__codelineno-149-12" name="__codelineno-149-12" href="#__codelineno-149-12"></a><span class="n">Ports</span><span class="w"> </span><span class="n">Num</span><span class="w">                        </span><span class="o">:</span><span class="w"> </span><span class="mo">01</span>
<a id="__codelineno-149-13" name="__codelineno-149-13" href="#__codelineno-149-13"></a><span class="n">Bitstream</span><span class="w"> </span><span class="n">Id</span><span class="w">                     </span><span class="o">:</span><span class="w"> </span><span class="mh">0x5010202C8AD72D7</span>
<a id="__codelineno-149-14" name="__codelineno-149-14" href="#__codelineno-149-14"></a><span class="n">Bitstream</span><span class="w"> </span><span class="n">Version</span><span class="w">                </span><span class="o">:</span><span class="w"> </span><span class="mf">5.0.1</span>
<a id="__codelineno-149-15" name="__codelineno-149-15" href="#__codelineno-149-15"></a><span class="n">Pr</span><span class="w"> </span><span class="n">Interface</span><span class="w"> </span><span class="n">Id</span><span class="w">                  </span><span class="o">:</span><span class="w"> </span><span class="mi">8</span><span class="n">df219e3</span><span class="o">-</span><span class="n">cf25</span><span class="mf">-5e77</span><span class="mi">-8689</span><span class="o">-</span><span class="n">f57102d54435</span>
<a id="__codelineno-149-16" name="__codelineno-149-16" href="#__codelineno-149-16"></a><span class="n">Boot</span><span class="w"> </span><span class="n">Page</span><span class="w">                        </span><span class="o">:</span><span class="w"> </span><span class="n">user1</span>
<a id="__codelineno-149-17" name="__codelineno-149-17" href="#__codelineno-149-17"></a><span class="n">Factory</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="n">Info</span><span class="w">               </span><span class="o">:</span><span class="w"> </span><span class="n">a2b5fd0e7afca4ee6d7048f926e75ac2</span>
<a id="__codelineno-149-18" name="__codelineno-149-18" href="#__codelineno-149-18"></a><span class="n">User1</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="n">Info</span><span class="w">                 </span><span class="o">:</span><span class="w"> </span><span class="mi">9804075</span><span class="n">d2e8a71a192ec89602f2f5544</span>
<a id="__codelineno-149-19" name="__codelineno-149-19" href="#__codelineno-149-19"></a><span class="n">User2</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="n">Info</span><span class="w">                 </span><span class="o">:</span><span class="w"> </span><span class="mi">9804075</span><span class="n">d2e8a71a192ec89602f2f5544</span>
</code></pre></div>
<p><br></p>
<h2 id="notices-disclaimers">Notices &amp; Disclaimers<a class="headerlink" href="#notices-disclaimers" title="Permanent link">&para;</a></h2>
<p>Intel<sup>&reg;</sup> technologies may require enabled hardware, software or service activation.
No product or component can be absolutely secure. 
Performance varies by use, configuration and other factors.
Your costs and results may vary. 
You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Intel products described herein. You agree to grant Intel a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.
No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document, with the sole exception that you may publish an unmodified copy. You may create software implementations based on this document and in compliance with the foregoing that are intended to execute on the Intel product(s) referenced in this document. No rights are granted to create modifications or derivatives of this document.
The products described may contain design defects or errors known as errata which may cause the product to deviate from published specifications.  Current characterized errata are available on request.
Intel disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.
You are responsible for safety of the overall system, including compliance with applicable safety-related requirements or standards. 
<sup>&copy;</sup> Intel Corporation.  Intel, the Intel logo, and other Intel marks are trademarks of Intel Corporation or its subsidiaries.  Other names and brands may be claimed as the property of others. </p>
<p>OpenCL and the OpenCL logo are trademarks of Apple Inc. used by permission of the Khronos Group™. </p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.copy", "navigation.indexes", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "ofs-2023.1", "provider": "mike"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>