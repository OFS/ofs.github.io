
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ug_dev_pim_based_afu/">
      
      
        <link rel="next" href="../ug_dev_afu_sim_env/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>AFU Host Software Developer Guide - OFS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#afu-host-software-developer-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="OFS" class="md-header__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OFS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AFU Host Software Developer Guide
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hw/common/user_guides/ug_fpga_developer/ug_fpga_developer/" class="md-tabs__link">
        Start Here
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hw/doc_modules/contents_s10_pcie_attach/" class="md-tabs__link md-tabs__link--active">
        Stratix® 10 PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hw/doc_modules/contents_agx7_pcie_attach/" class="md-tabs__link">
        Agilex™ 7 PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hw/doc_modules/contents_agx7_soc_attach/" class="md-tabs__link">
        Agilex SoC Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hw/common/user_guides/oneapi_asp/ug_oneapi_asp/" class="md-tabs__link">
        oneAPI
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hw/common/sw_installation/pcie_attach/sw_install_pcie_attach/" class="md-tabs__link">
        OFS Software
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="OFS" class="md-nav__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OFS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Start Here
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Start Here
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/user_guides/ug_fpga_developer/ug_fpga_developer/" class="md-nav__link">
        FPGA Developer Journey Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/user_guides/ug_sw_developer/ug_sw_developer/" class="md-nav__link">
        Software Developer Journey Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Stratix® 10 PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Stratix® 10 PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/doc_modules/contents_s10_pcie_attach/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../adp_board_installation_guidelines/" class="md-nav__link">
        Board Installation Guide (Intel® FPGA PAC D5005)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/sw_installation/pcie_attach/sw_install_pcie_attach/" class="md-nav__link">
        Software Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/" class="md-nav__link">
        Getting Started Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-nav__link">
        Automated Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/" class="md-nav__link">
        Shell Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/d5005/dev_guides/fim_dev/ug_dev_fim_ofs_d5005/" class="md-nav__link">
        Shell Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" checked>
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
          Workload Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Workload Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/d5005/dev_guides/afu_dev/ug_dev_afu_d5005/" class="md-nav__link">
        Workload Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug_dev_pim_based_afu/" class="md-nav__link">
        PIM Based AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          AFU Host Software Developer Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        AFU Host Software Developer Guide
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-host-application-flow" class="md-nav__link">
    1. Host Application Flow
  </a>
  
    <nav class="md-nav" aria-label="1. Host Application Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-find-and-connect-to-afu" class="md-nav__link">
    1.1. Find and connect to AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-map-mmio-optional" class="md-nav__link">
    1.2. Map MMIO (optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-allocate-shared-memory-buffers" class="md-nav__link">
    1.3. Allocate Shared Memory Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-perform-acceleration" class="md-nav__link">
    1.4. Perform Acceleration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-cleanup" class="md-nav__link">
    1.5. Cleanup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-building-the-host-application" class="md-nav__link">
    2. Building the Host Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-running-the-host-application" class="md-nav__link">
    3. Running the Host Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug_dev_afu_sim_env/" class="md-nav__link">
        AFU Simulation Environment User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/d5005/user_guides/ug_sim_ofs_d5005/ug_sim_ofs_d5005/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
          Virtualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_10">
          <span class="md-nav__icon md-icon"></span>
          Virtualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug_docker/" class="md-nav__link">
        Docker User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug_kvm/" class="md-nav__link">
        KVM User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Agilex™ 7 PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Agilex™ 7 PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/doc_modules/contents_agx7_pcie_attach/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          Board Installation Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Board Installation Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../n6001/adp_board_installation_guidelines/" class="md-nav__link">
        Intel® FPGA SmartNIC N6000/1-PL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/board_installation/devkit_board_installation/devkit_board_installation_guidelines/" class="md-nav__link">
        Agilex™ 7 FPGA I-Series and F-Series Development Kits
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/sw_installation/pcie_attach/sw_install_pcie_attach/" class="md-nav__link">
        Software Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          Getting Started Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Getting Started Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/iseries_devkit/user_guides/ug_qs_ofs_iseries/ug_qs_ofs_iseries/" class="md-nav__link">
        OFS for Agilex™ 7 FPGA I-Series Development Kit (2xR-Tile,1xF-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/ftile_devkit/user_guides/ug_qs_ofs_ftile/ug_qs_ofs_ftile/" class="md-nav__link">
        OFS for Agilex™ 7 FPGA F-Series Development Kit (2xF-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/" class="md-nav__link">
        OFS for Intel® FPGA SmartNIC N6001-PL
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/user_guides/ug_eval_script_ofs_agx7_pcie_attach/ug_eval_script_ofs_agx7_pcie_attach/" class="md-nav__link">
        Automated Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/n6001/reference_manuals/ofs_fim/mnl_fim_ofs_n6001/" class="md-nav__link">
        Shell Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
          Shell Developer Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_7">
          <span class="md-nav__icon md-icon"></span>
          Shell Developer Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/iseries_devkit/dev_guides/fim_dev/ug_ofs_iseries_dk_fim_dev/" class="md-nav__link">
        PCIe Attach I-Series (2xR-Tile, F-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/ftile_devkit/dev_guides/fim_dev/ug_ofs_ftile_dk_fim_dev/" class="md-nav__link">
        PCIe Attach F-Series (2xF-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/" class="md-nav__link">
        PCIe Attach F-Series (P-Tile/E-Tile)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/n6001/dev_guides/hps_dev/hps_developer_ug/" class="md-nav__link">
        HPS Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/user_guides/ug_sim_ofs_agx7_pcie_attach/ug_sim_ofs_agx7_pcie_attach/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_10" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
          Workload Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_10">
          <span class="md-nav__icon md-icon"></span>
          Workload Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/user_guides/afu_dev/ug_dev_afu_ofs_agx7_pcie_attach/ug_dev_afu_ofs_agx7_pcie_attach/" class="md-nav__link">
        Workload Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../n6001/ug_dev_pim_based_afu/" class="md-nav__link">
        PIM Based AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../n6001/ug_dev_afu_host_software/" class="md-nav__link">
        AFU Host Software Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../n6001/ug_dev_afu_sim_env/" class="md-nav__link">
        AFU Simulation Environment User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_11" id="__nav_4_11_label" tabindex="0">
          Virtualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_11">
          <span class="md-nav__icon md-icon"></span>
          Virtualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../n6001/ug_docker/" class="md-nav__link">
        Docker User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../n6001/ug_kvm/" class="md-nav__link">
        KVM User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/user_guides/ug_troubleshoot/ug_agx7_troubleshoot/" class="md-nav__link">
        Troubleshooting Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Agilex SoC Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Agilex SoC Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/doc_modules/contents_agx7_soc_attach/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/board_installation/f2000x_board_installation/f2000x_board_installation/" class="md-nav__link">
        Board Installation Guide (Intel® IPU Platform F2000X-PL)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/sw_installation/soc_attach/sw_install_soc_attach/" class="md-nav__link">
        Software Installation Guide for SoC Attach
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/f2000x/user_guides/ug_qs_ofs_f2000x/ug_qs_ofs_f2000x/" class="md-nav__link">
        Getting Started Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/f2000x/user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-nav__link">
        Automated Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/f2000x/reference_manuals/ofs_fim/mnl_fim_ofs/" class="md-nav__link">
        Shell Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/f2000x/dev_guides/fim_dev/ug_dev_fim_ofs/" class="md-nav__link">
        Shell Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
          Workload Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_8">
          <span class="md-nav__icon md-icon"></span>
          Workload Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/f2000x/dev_guides/afu_dev/ug_dev_afu_ofs_f2000x/" class="md-nav__link">
        Workload Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../f2000x/ug_dev_pim_based_afu/" class="md-nav__link">
        PIM Based AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../f2000x/ug_dev_afu_host_software/" class="md-nav__link">
        AFU Host Software Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../f2000x/ug_dev_afu_sim_env/" class="md-nav__link">
        AFU Simulation Environment User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/f2000x/user_guides/ug_sim_ofs/ug_sim_ofs/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="0">
          Virtualization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_10">
          <span class="md-nav__icon md-icon"></span>
          Virtualization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../f2000x/ug_docker/" class="md-nav__link">
        Docker User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../f2000x/ug_kvm/" class="md-nav__link">
        KVM User Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          oneAPI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          oneAPI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/user_guides/oneapi_asp/ug_oneapi_asp/" class="md-nav__link">
        oneAPI ASP Getting Started User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/reference_manual/oneapi_asp/oneapi_asp_ref_mnl/" class="md-nav__link">
        oneAPI Accelerator Support Package(ASP) Reference Manual
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          OFS Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          OFS Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/sw_installation/pcie_attach/sw_install_pcie_attach/" class="md-nav__link">
        Software Installation Guide OFS for PCIe Attach
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/sw_installation/soc_attach/sw_install_soc_attach/" class="md-nav__link">
        Software Installation Guide OFS for SoC Attach
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hw/common/reference_manual/driver_dev_qs/driver_dev_qs/" class="md-nav__link">
        Driver Development Quick Start Guidelines for Linux DFL
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
          OPAE FPGA Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_5">
          <span class="md-nav__icon md-icon"></span>
          OPAE FPGA Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/fpgainfo/fpgainfo/" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/fpgasupdate/fpgasupdate/" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/mmlink/mmlink/" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/packager/packager/" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/userclk/userclk/" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/hssi/hssi/" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/pci_device/pci_device/" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/opae.io/opae.io/" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/rsu/rsu/" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/host_exerciser/host_exerciser/" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/hssi_ethernet/hssistats/" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/mem_tg/mem_tg/" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/vabtool/vabtool/" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/opaevfio/opaevfio/" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/ofs.uio/ofs.uio/" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/opaeuio/opaeuio/" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sw/fpga_tools/fpgad/fpgad/" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-host-application-flow" class="md-nav__link">
    1. Host Application Flow
  </a>
  
    <nav class="md-nav" aria-label="1. Host Application Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-find-and-connect-to-afu" class="md-nav__link">
    1.1. Find and connect to AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-map-mmio-optional" class="md-nav__link">
    1.2. Map MMIO (optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-allocate-shared-memory-buffers" class="md-nav__link">
    1.3. Allocate Shared Memory Buffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-perform-acceleration" class="md-nav__link">
    1.4. Perform Acceleration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-cleanup" class="md-nav__link">
    1.5. Cleanup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-building-the-host-application" class="md-nav__link">
    2. Building the Host Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-running-the-host-application" class="md-nav__link">
    3. Running the Host Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="afu-host-software-developer-guide"><strong><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Host Software Developer Guide</strong><a class="headerlink" href="#afu-host-software-developer-guide" title="Permanent link">&para;</a></h1>
<p>Last updated: <strong>March 28, 2025</strong> </p>
<p>The host application is used to control the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and manage data transfer between the host and the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.   The host channel provides two interfaces between the host and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> and Host Memory.   <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> is used to read/write the CSR interface of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, and the Host Memory interface is used to share data between the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and Host user space. 
<a class="glightbox" href="/ofs-2024.3-1/hw/common/user_guides/afu_dev/ug_dev_pim_based_afu/images/SW_Model.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="/ofs-2024.3-1/hw/common/user_guides/afu_dev/ug_dev_pim_based_afu/images/SW_Model.png" /></a></p>
<h2 id="1-host-application-flow"><strong>1. Host Application Flow</strong><a class="headerlink" href="#1-host-application-flow" title="Permanent link">&para;</a></h2>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> provides a library with routines to setup and manage the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.  The basic host application flow is as follows:</p>
<p><a class="glightbox" href="/ofs-2024.3-1/hw/common/user_guides/afu_dev/ug_dev_pim_based_afu/images/SW_Flow.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="/ofs-2024.3-1/hw/common/user_guides/afu_dev/ug_dev_pim_based_afu/images/SW_Flow.png" /></a></p>
<p>When creating the host application, the following OPAE Header Files are required:
- opae/fpga.h  - For the OPAE C API library 
- afu_json_info.h - For <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> information including UUID </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>//<span class="w"> </span>Headers<span class="w"> </span>needed<span class="w"> </span><span class="k">for</span><span class="w"> </span>example<span class="w"> </span>code
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="c1">#include &lt;stdint.h&gt;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="c1">#include &lt;stdio.h&gt;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1">#include &lt;stdlib.h&gt;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1">#include &lt;assert.h&gt;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>//<span class="w"> </span>For<span class="w"> </span>uuid_parse<span class="o">()</span><span class="w"> </span>to<span class="w"> </span>convert<span class="w"> </span>UUID<span class="w"> </span>string<span class="w"> </span>into<span class="w"> </span>binary
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c1">#include &lt;uuid/uuid.h&gt;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>//<span class="w"> </span>OPAE<span class="w"> </span>C<span class="w"> </span>API
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="c1">#include &lt;opae/fpga.h&gt;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>//<span class="w"> </span>State<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>AFU<span class="s1">&#39;s JSON file, extracted using OPAE&#39;</span>s<span class="w"> </span>afu_json_mgr<span class="w"> </span>script
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="c1">#include &quot;afu_json_info.h&quot;</span>
</code></pre></div>
<h3 id="11-find-and-connect-to-afu"><strong>1.1. Find and connect to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#11-find-and-connect-to-afu" title="Permanent link">&para;</a></h3>
<p>Here is an example function which searches for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> based on its UUID.  If there is a match, it will connect to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.   It will also check to see if the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is being run in hardware or simulation (ASE).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>//<span class="w"> </span>Set<span class="w"> </span>as<span class="w"> </span>global,<span class="w"> </span>to<span class="w"> </span>allow<span class="w"> </span>MMIO<span class="w"> </span>routines<span class="w"> </span>to<span class="w"> </span>access<span class="w"> </span><span class="k">in</span><span class="w"> </span>ASE<span class="w"> </span>mode
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>static<span class="w"> </span>fpga_handle<span class="w"> </span>s_accel_handle<span class="p">;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>//
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>//<span class="w"> </span>Search<span class="w"> </span><span class="k">for</span><span class="w"> </span>an<span class="w"> </span>accelerator<span class="w"> </span>matching<span class="w"> </span>the<span class="w"> </span>requested<span class="w"> </span>UUID<span class="w"> </span>and<span class="w"> </span>connect<span class="w"> </span>to<span class="w"> </span>it.
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>//<span class="w"> </span>Check<span class="w"> </span>to<span class="w"> </span>see<span class="w"> </span><span class="k">if</span><span class="w"> </span>running<span class="w"> </span><span class="k">in</span><span class="w"> </span>ASE-Simulation<span class="w"> </span>mode
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>//
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>static<span class="w"> </span>fpga_handle<span class="w"> </span>connect_to_accel<span class="o">(</span>const<span class="w"> </span>char<span class="w"> </span>*accel_uuid,<span class="w"> </span>bool<span class="w"> </span>*is_ase_sim<span class="o">)</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="o">{</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span>fpga_properties<span class="w"> </span><span class="nv">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>NULL<span class="p">;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span>fpga_guid<span class="w"> </span>guid<span class="p">;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span>fpga_token<span class="w"> </span>accel_token<span class="p">;</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span>uint32_t<span class="w"> </span>num_matches<span class="p">;</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">    </span>fpga_handle<span class="w"> </span>accel_handle<span class="p">;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">    </span>fpga_result<span class="w"> </span>r<span class="p">;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">    </span>//<span class="w"> </span>Don<span class="err">&#39;</span>t<span class="w"> </span>print<span class="w"> </span>verbose<span class="w"> </span>messages<span class="w"> </span><span class="k">in</span><span class="w"> </span>ASE<span class="w"> </span>by<span class="w"> </span>default
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">    </span>setenv<span class="o">(</span><span class="s2">&quot;ASE_LOG&quot;</span>,<span class="w"> </span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">    </span>*is_ase_sim<span class="w"> </span><span class="o">=</span><span class="w"> </span>NULL<span class="p">;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">    </span>//<span class="w"> </span>Set<span class="w"> </span>up<span class="w"> </span>a<span class="w"> </span>filter<span class="w"> </span>that<span class="w"> </span>will<span class="w"> </span>search<span class="w"> </span><span class="k">for</span><span class="w"> </span>an<span class="w"> </span>accelerator
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">    </span>fpgaGetProperties<span class="o">(</span>NULL,<span class="w"> </span><span class="p">&amp;</span>filter<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">    </span>fpgaPropertiesSetObjectType<span class="o">(</span>filter,<span class="w"> </span>FPGA_ACCELERATOR<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">    </span>//<span class="w"> </span>Convert<span class="w"> </span>UUID<span class="w"> </span>string<span class="w"> </span>into<span class="w"> </span>binary
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">    </span>uuid_parse<span class="o">(</span>accel_uuid,<span class="w"> </span>guid<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">    </span>//<span class="w"> </span>Add<span class="w"> </span>the<span class="w"> </span>desired<span class="w"> </span>UUID<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>filter
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">    </span>fpgaPropertiesSetGUID<span class="o">(</span>filter,<span class="w"> </span>guid<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">    </span>//<span class="w"> </span>Do<span class="w"> </span>the<span class="w"> </span>search<span class="w"> </span>across<span class="w"> </span>the<span class="w"> </span>available<span class="w"> </span>FPGA<span class="w"> </span>contexts
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">    </span><span class="nv">num_matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">    </span>fpgaEnumerate<span class="o">(</span><span class="p">&amp;</span>filter,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="p">&amp;</span>accel_token,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span><span class="p">&amp;</span>num_matches<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">    </span>//<span class="w"> </span>Not<span class="w"> </span>needed<span class="w"> </span>anymore
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">    </span>fpgaDestroyProperties<span class="o">(</span><span class="p">&amp;</span>filter<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>num_matches<span class="w"> </span>&lt;<span class="w"> </span><span class="m">1</span><span class="o">)</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="w">        </span>fprintf<span class="o">(</span>stderr,<span class="w"> </span><span class="s2">&quot;Accelerator %s not found!\n&quot;</span>,<span class="w"> </span>accel_uuid<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="w">    </span>//<span class="w"> </span>Acquire<span class="w"> </span>ownership<span class="w"> </span>of<span class="w"> </span>accelerator
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fpgaOpen<span class="o">(</span>accel_token,<span class="w"> </span><span class="p">&amp;</span>accel_handle,<span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="w">    </span>assert<span class="o">(</span><span class="nv">FPGA_OK</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>r<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="w">    </span>//<span class="w"> </span>While<span class="w"> </span>the<span class="w"> </span>token<span class="w"> </span>is<span class="w"> </span>available,<span class="w"> </span>check<span class="w"> </span>whether<span class="w"> </span>it<span class="w"> </span>is<span class="w"> </span><span class="k">for</span><span class="w"> </span>HW<span class="w"> </span>or<span class="w"> </span><span class="k">for</span><span class="w"> </span>ASE<span class="w"> </span>simulation.
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="w">    </span>fpga_properties<span class="w"> </span>accel_props<span class="p">;</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="w">    </span>uint16_t<span class="w"> </span>vendor_id,<span class="w"> </span>dev_id<span class="p">;</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a><span class="w">    </span>fpgaGetProperties<span class="o">(</span>accel_token,<span class="w"> </span><span class="p">&amp;</span>accel_props<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a><span class="w">    </span>fpgaPropertiesGetVendorID<span class="o">(</span>accel_props,<span class="w"> </span><span class="p">&amp;</span>vendor_id<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a><span class="w">    </span>fpgaPropertiesGetDeviceID<span class="o">(</span>accel_props,<span class="w"> </span><span class="p">&amp;</span>dev_id<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a><span class="w">    </span>*is_ase_sim<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="nv">vendor_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>0x8086<span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">(</span><span class="nv">dev_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>0xa5e<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a><span class="w">    </span>//<span class="w"> </span>Done<span class="w"> </span>with<span class="w"> </span>token
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a><span class="w">    </span>fpgaDestroyToken<span class="o">(</span><span class="p">&amp;</span>accel_token<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>accel_handle<span class="p">;</span>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a><span class="o">}</span>
</code></pre></div>
<p>In main(), the function is called updating the accel_handle and ASE status.   AFU_ACCEL_UUID is provided by afu_json_info.h created for the Accelerator Descriptor File:
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="w">    </span>bool<span class="w"> </span>is_ase_sim<span class="p">;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span>//<span class="w"> </span>Find<span class="w"> </span>and<span class="w"> </span>connect<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>accelerator<span class="o">(</span>s<span class="o">)</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="nv">s_accel_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>connect_to_accel<span class="o">(</span>AFU_ACCEL_UUID,<span class="w"> </span><span class="p">&amp;</span>is_ase_sim<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">NULL</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>s_accel_handle<span class="o">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
</code></pre></div></p>
<h3 id="12-map-mmio-optional"><strong>1.2. Map <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> (optional)</strong><a class="headerlink" href="#12-map-mmio-optional" title="Permanent link">&para;</a></h3>
<p>Mapping the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> provides higher performance on the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> access versus the standard OPAE <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> functions.  fpgaMapMMIO() is used to return a pointer to the specified <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> space of the target <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in process virtual memory.  When running in ASE mode, <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> mapping isn't supported and the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> pointer is set to NULL.   </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>static<span class="w"> </span>volatile<span class="w"> </span>uint64_t<span class="w"> </span>*s_mmio_buf<span class="p">;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>fpga_result<span class="w"> </span>r<span class="p">;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>is_ase_sim<span class="o">)</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">        </span>printf<span class="o">(</span><span class="s2">&quot;Running in ASE Mode&quot;</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">        </span><span class="nv">s_mmio_buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>NULL<span class="p">;</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">        </span>uint64_t<span class="w"> </span>*tmp_ptr<span class="p">;</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fpgaMapMMIO<span class="o">(</span>s_accel_handle,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="p">&amp;</span>tmp_ptr<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">        </span>assert<span class="o">(</span><span class="nv">FPGA_OK</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>r<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">        </span><span class="nv">s_mmio_buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tmp_ptr<span class="p">;</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">    </span><span class="o">}</span>
</code></pre></div>
<p>The below example functions provide <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Reads/Writes.   When running in hardware the functions will use s_mmio_buf for accessing.  When running in ASE mode, indicated by s_mmio_buf being set to NULL, fpgaReadMMIO64() fpgaWriteMMIO64() will be used.
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>//
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>//<span class="w"> </span>Read<span class="w"> </span>a<span class="w"> </span><span class="m">64</span><span class="w"> </span>bit<span class="w"> </span>CSR.<span class="w"> </span>When<span class="w"> </span>a<span class="w"> </span>pointer<span class="w"> </span>to<span class="w"> </span>CSR<span class="w"> </span>buffer<span class="w"> </span>is<span class="w"> </span>available,<span class="w"> </span><span class="nb">read</span><span class="w"> </span>directly.
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>//<span class="w"> </span>Direct<span class="w"> </span>reads<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>significantly<span class="w"> </span>faster.
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>//<span class="w"> </span>If<span class="w"> </span>s_mmio_buf<span class="w"> </span>is<span class="w"> </span>NULL,<span class="w"> </span><span class="k">in</span><span class="w"> </span>ASE<span class="w"> </span>mode<span class="w"> </span>and<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span>OPAE<span class="w"> </span>MMIO<span class="w"> </span>functions.
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>//
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>static<span class="w"> </span>inline<span class="w"> </span>uint64_t<span class="w"> </span>readMMIO64<span class="o">(</span>uint32_t<span class="w"> </span>idx<span class="o">)</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="o">{</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>s_mmio_buf<span class="o">)</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span>s_mmio_buf<span class="o">[</span>idx<span class="o">]</span><span class="p">;</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">        </span>fpga_result<span class="w"> </span>r<span class="p">;</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">        </span>uint64_t<span class="w"> </span>v<span class="p">;</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">        </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fpgaReadMMIO64<span class="o">(</span>s_accel_handle,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">8</span><span class="w"> </span>*<span class="w"> </span>idx,<span class="w"> </span><span class="p">&amp;</span>v<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">        </span>assert<span class="o">(</span><span class="nv">FPGA_OK</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>r<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span>v<span class="p">;</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="o">}</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>//
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>//<span class="w"> </span>Write<span class="w"> </span>a<span class="w"> </span><span class="m">64</span><span class="w"> </span>bit<span class="w"> </span>CSR.<span class="w"> </span>When<span class="w"> </span>a<span class="w"> </span>pointer<span class="w"> </span>to<span class="w"> </span>CSR<span class="w"> </span>buffer<span class="w"> </span>is<span class="w"> </span>available,<span class="w"> </span>write<span class="w"> </span>directly.
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>//
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>static<span class="w"> </span>inline<span class="w"> </span>void<span class="w"> </span>writeMMIO64<span class="o">(</span>uint32_t<span class="w"> </span>idx,<span class="w"> </span>uint64_t<span class="w"> </span>v<span class="o">)</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="o">{</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>s_mmio_buf<span class="o">)</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">        </span>s_mmio_buf<span class="o">[</span>idx<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>v<span class="p">;</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">        </span>fpgaWriteMMIO64<span class="o">(</span>s_accel_handle,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">8</span><span class="w"> </span>*<span class="w"> </span>idx,<span class="w"> </span>v<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="o">}</span>
</code></pre></div></p>
<h3 id="13-allocate-shared-memory-buffers"><strong>1.3. Allocate Shared Memory Buffers</strong><a class="headerlink" href="#13-allocate-shared-memory-buffers" title="Permanent link">&para;</a></h3>
<p>The below example function creates the shared buffers and provides the physical address for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> access.
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>//
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>//<span class="w"> </span>Allocate<span class="w"> </span>a<span class="w"> </span>buffer<span class="w"> </span><span class="k">in</span><span class="w"> </span>I/O<span class="w"> </span>memory,<span class="w"> </span>shared<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>FPGA.
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>//
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>static<span class="w"> </span>volatile<span class="w"> </span>void*<span class="w"> </span>alloc_buffer<span class="o">(</span>fpga_handle<span class="w"> </span>accel_handle,
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">                                   </span>ssize_t<span class="w"> </span>size,
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">                                   </span>uint64_t<span class="w"> </span>*wsid,
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">                                   </span>uint64_t<span class="w"> </span>*io_addr<span class="o">)</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="o">{</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span>fpga_result<span class="w"> </span>r<span class="p">;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span>volatile<span class="w"> </span>void*<span class="w"> </span>buf<span class="p">;</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fpgaPrepareBuffer<span class="o">(</span>accel_handle,<span class="w"> </span>size,<span class="w"> </span><span class="o">(</span>void*<span class="o">)</span><span class="p">&amp;</span>buf,<span class="w"> </span>wsid,<span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>FPGA_OK<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>r<span class="o">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>NULL<span class="p">;</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span>//<span class="w"> </span>Get<span class="w"> </span>the<span class="w"> </span>physical<span class="w"> </span>address<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>buffer<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>accelerator
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">    </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fpgaGetIOAddress<span class="o">(</span>accel_handle,<span class="w"> </span>*wsid,<span class="w"> </span>io_addr<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">    </span>assert<span class="o">(</span><span class="nv">FPGA_OK</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>r<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>buf<span class="p">;</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="o">}</span>
</code></pre></div></p>
<p>In main(), define the buffers and use the above function to allocate the shared buffers.   OPAE supports multiple buffers, and the number of buffers is design dependent.  Buffers over 4KB require hugepage support on the host.   The buffer address needs to be passed to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> over <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>, for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to correctly access the buffer.
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="w">    </span><span class="c1">#define BUF_SIZE_IN_BYTES 16384</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span>volatile<span class="w"> </span>unsigned<span class="w"> </span>char<span class="w"> </span>*src_buf<span class="p">;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span>uint64_t<span class="w"> </span>src_wsid<span class="p">;</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span>uint64_t<span class="w"> </span>src_pa<span class="p">;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span>volatile<span class="w"> </span>unsigned<span class="w"> </span>char<span class="w"> </span>*dst_buf<span class="p">;</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span>uint64_t<span class="w"> </span>dst_wsid<span class="p">;</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span>uint64_t<span class="w"> </span>dst_pa<span class="p">;</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="nv">src_buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>alloc_buffer<span class="o">(</span>s_accel_handle,<span class="w"> </span>BUF_SIZE_IN_BYTES,<span class="w"> </span><span class="p">&amp;</span>src_wsid,<span class="w"> </span><span class="p">&amp;</span>src_pa<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">    </span>assert<span class="o">(</span>NULL<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>src_buf<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">    </span><span class="nv">dst_buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>alloc_buffer<span class="o">(</span>s_accel_handle,<span class="w"> </span>BUF_SIZE_IN_BYTES,<span class="w"> </span><span class="p">&amp;</span>dst_wsid,<span class="w"> </span><span class="p">&amp;</span>dst_pa<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">    </span>assert<span class="o">(</span>NULL<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>dst_buf<span class="o">)</span><span class="p">;</span>
</code></pre></div></p>
<h3 id="14-perform-acceleration"><strong>1.4. Perform Acceleration</strong><a class="headerlink" href="#14-perform-acceleration" title="Permanent link">&para;</a></h3>
<p>The host application interaction is <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> dependent.  Generally, the <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> interface will be used to setup and control the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.   While the shared buffers are used to pass data between the host and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.   Below is an example of setting up the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, writing the buffer and retrieving the results from the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>//<span class="w"> </span>Loading<span class="w"> </span><span class="nb">source</span><span class="w"> </span>buffer<span class="w"> </span>with<span class="w"> </span>walking<span class="w"> </span>ones
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">for</span><span class="o">(</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span>&lt;<span class="w"> </span>BUF_SIZE_IN_BYTES<span class="p">;</span><span class="w"> </span>i++<span class="o">)</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="o">{</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">   </span>src_buf<span class="o">[</span>i<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&lt;&lt;<span class="w"> </span><span class="o">(</span>i<span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>0x7<span class="o">)</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>walking<span class="w"> </span>ones
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="o">}</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>//<span class="w"> </span>Send<span class="w"> </span>AFU<span class="w"> </span>buffer<span class="w"> </span>addresses<span class="w"> </span>and<span class="w"> </span>size<span class="w"> </span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>//<span class="w"> </span>register<span class="w"> </span>addresses<span class="w"> </span>are<span class="w"> </span>based<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>AFU<span class="w"> </span>CSR<span class="w"> </span>interface
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>writeMMIO64<span class="o">(</span><span class="m">8</span>,<span class="w"> </span>src_pa<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>writeMMIO64<span class="o">(</span><span class="m">9</span>,<span class="w"> </span>dst_pa<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>writeMMIO64<span class="o">(</span><span class="m">10</span>,<span class="w"> </span>buf_size<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>//<span class="w"> </span>Start<span class="w"> </span>Acceleration
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>writeMMIO64<span class="o">(</span><span class="m">11</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>//<span class="w"> </span>Wait<span class="w"> </span><span class="k">for</span><span class="w"> </span>AFU<span class="w"> </span>to<span class="w"> </span><span class="nb">complete</span><span class="w"> </span>acceleration
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="k">while</span><span class="o">(</span>!readMMIO64<span class="o">(</span><span class="m">12</span><span class="o">))</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">   </span><span class="p">;</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>//<span class="w"> </span>Read<span class="w"> </span>destination<span class="w"> </span>buffer<span class="w"> </span>and<span class="w"> </span>print<span class="w"> </span>output
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>printf<span class="o">(</span><span class="s2">&quot;output: &quot;</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="k">for</span><span class="o">(</span><span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span>&lt;<span class="w"> </span>BUF_SIZE_IN_BYTES<span class="p">;</span><span class="w"> </span>i++<span class="o">)</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="o">{</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="w">   </span>printf<span class="o">(</span><span class="s2">&quot;%d &quot;</span>,<span class="w"> </span>dst_buf<span class="o">[</span>i<span class="o">])</span><span class="p">;</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="o">}</span>
</code></pre></div></p>
<h3 id="15-cleanup"><strong>1.5. Cleanup</strong><a class="headerlink" href="#15-cleanup" title="Permanent link">&para;</a></h3>
<p>When the acceleration is complete, the host application should release the shared buffers and release ownership of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="w">    </span>//<span class="w"> </span>Release<span class="w"> </span>shared<span class="w"> </span>buffers
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span>fpgaReleaseBuffer<span class="o">(</span>s_accel_handle,<span class="w"> </span>src_wsid<span class="o">)</span><span class="p">;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span>fpgaReleaseBuffer<span class="o">(</span>s_accel_handle,<span class="w"> </span>dst_wsid<span class="o">)</span><span class="p">;</span><span class="w">   </span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span>//<span class="w"> </span>Release<span class="w"> </span>ownership<span class="w"> </span>of<span class="w"> </span>accelerator
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span>fpgaClose<span class="o">(</span>s_accel_handle<span class="o">)</span><span class="p">;</span>
</code></pre></div></p>
<h2 id="2-building-the-host-application"><strong>2. Building the Host Application</strong><a class="headerlink" href="#2-building-the-host-application" title="Permanent link">&para;</a></h2>
<p>A Makefile is used to build the host application.   Below is an example Makefile from the [examples <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>] repo with the following updated:</p>
<ul>
<li>Path to common_include.mk (from examples-afu)</li>
<li>TEST name</li>
<li>Source files: SRCS</li>
<li>Path to .json file (relative to Makefile directory)</li>
</ul>
<p>Makefile:
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Path to examples-afu/tutorial/afu_types/01_pim_ifc/common/sw/common_include.mk</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>include<span class="w"> </span>../../common/sw/common_include.mk
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="c1"># Primary test name</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="nv">TEST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>example_afu
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="c1"># Build directory</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="nv">OBJDIR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>obj
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="nv">CFLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-I./<span class="k">$(</span>OBJDIR<span class="k">)</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="nv">CPPFLAGS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-I./<span class="k">$(</span>OBJDIR<span class="k">)</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="c1"># Files and folders</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="nv">SRCS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>TEST<span class="k">)</span>.c
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="nv">OBJS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>addprefix<span class="w"> </span><span class="k">$(</span>OBJDIR<span class="k">)</span>/,<span class="k">$(</span>patsubst<span class="w"> </span>%.c,%.o,<span class="k">$(</span>SRCS<span class="k">)))</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>all:<span class="w"> </span><span class="k">$(</span>TEST<span class="k">)</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="c1"># AFU info from JSON file, including AFU UUID</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="nv">AFU_JSON_INFO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>OBJDIR<span class="k">)</span>/afu_json_info.h
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="k">$(</span>AFU_JSON_INFO<span class="k">)</span>:<span class="w"> </span>../hw/rtl/<span class="k">$(</span>TEST<span class="k">)</span>.json<span class="w"> </span><span class="p">|</span><span class="w"> </span>objdir
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">    </span>afu_json_mgr<span class="w"> </span>json-info<span class="w"> </span>--afu-json<span class="o">=</span>$^<span class="w"> </span>--c-hdr<span class="o">=</span><span class="nv">$@</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="k">$(</span>OBJS<span class="k">)</span>:<span class="w"> </span><span class="k">$(</span>AFU_JSON_INFO<span class="k">)</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="k">$(</span>TEST<span class="k">)</span>:<span class="w"> </span><span class="k">$(</span>OBJS<span class="k">)</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">    </span><span class="k">$(</span>CC<span class="k">)</span><span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span><span class="w"> </span>$^<span class="w"> </span><span class="k">$(</span>LDFLAGS<span class="k">)</span><span class="w"> </span><span class="k">$(</span>FPGA_LIBS<span class="k">)</span><span class="w"> </span>-lrt<span class="w"> </span>-pthread
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="k">$(</span>OBJDIR<span class="k">)</span>/%.o:<span class="w"> </span>%.c<span class="w"> </span><span class="p">|</span><span class="w"> </span>objdir
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">    </span><span class="k">$(</span>CC<span class="k">)</span><span class="w"> </span><span class="k">$(</span>CFLAGS<span class="k">)</span><span class="w"> </span>-c<span class="w"> </span>$&lt;<span class="w"> </span>-o<span class="w"> </span><span class="nv">$@</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>clean:
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="k">$(</span>TEST<span class="k">)</span><span class="w"> </span><span class="k">$(</span>OBJDIR<span class="k">)</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>objdir:
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="w">    </span>@mkdir<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>OBJDIR<span class="k">)</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>.PHONY:<span class="w"> </span>all<span class="w"> </span>clean
</code></pre></div></p>
<h2 id="3-running-the-host-application"><strong>3. Running the Host Application</strong><a class="headerlink" href="#3-running-the-host-application" title="Permanent link">&para;</a></h2>
<p>To run the host application, you will need to:</p>
<ul>
<li>Load <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> onto the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></li>
<li>Create VF's</li>
<li>Bind VF's using the OPAE Drivers</li>
<li>Run application</li>
</ul>
<p>See the associated <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Developer Guide for details.</p>
<h2 id="notices-disclaimers">Notices &amp; Disclaimers<a class="headerlink" href="#notices-disclaimers" title="Permanent link">&para;</a></h2>
<p>Altera® Corporation technologies may require enabled hardware, software or service activation. No product or component can be absolutely secure. Performance varies by use, configuration and other factors. Your costs and results may vary. You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Altera or Intel products described herein. You agree to grant Altera Corporation a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein. No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document, with the sole exception that you may publish an unmodified copy. You may create software implementations based on this document and in compliance with the foregoing that are intended to execute on the Altera or Intel product(s) referenced in this document. No rights are granted to create modifications or derivatives of this document. The products described may contain design defects or errors known as errata which may cause the product to deviate from published specifications. Current characterized errata are available on request. Altera disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade. You are responsible for safety of the overall system, including compliance with applicable safety-related requirements or standards. © Altera Corporation. Altera, the Altera logo, and other Altera marks are trademarks of Altera Corporation. Other names and brands may be claimed as the property of others.</p>
<p>OpenCL* and the OpenCL* logo are trademarks of Apple Inc. used by permission of the Khronos Group™.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.copy", "navigation.indexes", "toc.follow"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "ofs-2023.1", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>