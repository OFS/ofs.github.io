
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../../../ftile_devkit/dev_guides/fim_dev/ug_ofs_ftile_dk_fim_dev/">
      
      
        <link rel="next" href="../../../../../n6001/dev_guides/hps_dev/hps_developer_ug/">
      
      <link rel="icon" href="../../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>AFU Developer Guide - OFS</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#afu-development-guide-ofs-for-intel-agilex-7-pcie-attach-fpgas" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../../.." title="OFS" class="md-header__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OFS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AFU Developer Guide
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../ug_fpga_developer/ug_fpga_developer/" class="md-tabs__link">
        Start Here
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-tabs__link">
        Stratix 10 PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../ug_eval_script_ofs_agx7_pcie_attach/ug_eval_script_ofs_agx7_pcie_attach/" class="md-tabs__link md-tabs__link--active">
        Agilex PCIe Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../f2000x/user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-tabs__link">
        Agilex SoC Attach OFS
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../oneapi_asp/ug_oneapi_asp/" class="md-tabs__link">
        oneAPI
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../sw/fpga_api/quick_start/readme/" class="md-tabs__link">
        OFS Software
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="OFS" class="md-nav__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OFS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Start Here
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Start Here
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ug_fpga_developer/ug_fpga_developer/" class="md-nav__link">
        FPGA Developer Journey Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../doc_modules/Glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Stratix 10 PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Stratix 10 PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../d5005/user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../d5005/dev_guides/fim_dev/ug_dev_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../d5005/dev_guides/afu_dev/ug_dev_afu_d5005/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../d5005/user_guides/ug_sim_ofs_d5005/ug_sim_ofs_d5005/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Agilex PCIe Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Agilex PCIe Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ug_eval_script_ofs_agx7_pcie_attach/ug_eval_script_ofs_agx7_pcie_attach/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/" class="md-nav__link">
        Getting Started (Intel FPGA SmartNIC N6001-PL)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../ftile_devkit/user_guides/ug_qs_ofs_ftile/ug_qs_ofs_ftile/" class="md-nav__link">
        Getting Started (Intel Agilex 7 FPGA F-Series Development Kit 2xF-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../n6001/reference_manuals/ofs_fim/mnl_fim_ofs_n6001/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/" class="md-nav__link">
        FPGA Interface Manager Developer Guide for PCIe Attach (P-Tile/E-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../ftile_devkit/dev_guides/fim_dev/ug_ofs_ftile_dk_fim_dev/" class="md-nav__link">
        FPGA Interface Manager Developer Guide for PCIe Attach (2xF-Tile)
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          AFU Developer Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        AFU Developer Guide
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    1. Introduction
  </a>
  
    <nav class="md-nav" aria-label="1. Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-document-organization" class="md-nav__link">
    1.1. Document Organization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-prerequisite" class="md-nav__link">
    1.2. Prerequisite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-acceleration-functional-unit-afu-development-flow" class="md-nav__link">
    1.3. Acceleration Functional Unit (AFU) Development Flow
  </a>
  
    <nav class="md-nav" aria-label="1.3. Acceleration Functional Unit (AFU) Development Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131-understanding-platform-capabilities" class="md-nav__link">
    1.3.1. Understanding Platform Capabilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-high-level-data-flow" class="md-nav__link">
    1.3.2. High Level Data Flow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-considerations-for-pim-usage" class="md-nav__link">
    1.3.3. Considerations for PIM Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#134-afu-interfaces-included-with-intel-fpga-smartnic-n6001-pl" class="md-nav__link">
    1.3.4. AFU Interfaces Included with Intel® FPGA SmartNIC N6001-PL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-set-up-afu-development-environment" class="md-nav__link">
    2. Set Up AFU Development Environment
  </a>
  
    <nav class="md-nav" aria-label="2. Set Up AFU Development Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-afu-development-environment-overview" class="md-nav__link">
    2.1. AFU development environment overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-installation-of-quartus-and-required-patches" class="md-nav__link">
    2.2. Installation of Quartus and required patches
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-installation-of-support-tools" class="md-nav__link">
    2.3. Installation of Support Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-installation-of-opae-sdk" class="md-nav__link">
    2.4. Installation of OPAE SDK
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-download-the-basic-building-blocks-repositories" class="md-nav__link">
    2.5. Download the Basic Building Blocks repositories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-build-or-download-the-relocatable-pr-build-tree" class="md-nav__link">
    2.6. Build or download the relocatable PR build tree
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27-download-fim-to-fpga" class="md-nav__link">
    2.7. Download FIM to FPGA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#28-set-up-required-environment-variables" class="md-nav__link">
    2.8. Set up required Environment Variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-compiling-an-afu" class="md-nav__link">
    3. Compiling an AFU
  </a>
  
    <nav class="md-nav" aria-label="3. Compiling an AFU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-creating-the-afu-synthesis-environment" class="md-nav__link">
    3.1. Creating the AFU Synthesis Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-building-and-running-host_chan_mmio-example-afu" class="md-nav__link">
    3.2. Building and Running host_chan_mmio example AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-building-and-running-the-hello_world-example-afu" class="md-nav__link">
    3.3. Building and running the hello_world example AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-modify-the-afu-user-clocks-frequency" class="md-nav__link">
    3.4. Modify the AFU user clocks frequency
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-simulating-an-afu-using-ase" class="md-nav__link">
    4. Simulating an AFU using ASE
  </a>
  
    <nav class="md-nav" aria-label="4. Simulating an AFU using ASE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-set-up-steps-to-run-ase" class="md-nav__link">
    4.1. Set Up Steps to Run ASE
  </a>
  
    <nav class="md-nav" aria-label="4.1. Set Up Steps to Run ASE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-install-opae-sdk" class="md-nav__link">
    4.1.1. Install OPAE SDK
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412-install-ase-tools" class="md-nav__link">
    4.1.2 Install ASE Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#413-setup-required-ase-environment-variables" class="md-nav__link">
    4.1.3. Setup Required ASE Environment Variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-simulating-the-host_chan_mmio-afu" class="md-nav__link">
    4.2. Simulating the host_chan_mmio AFU
  </a>
  
    <nav class="md-nav" aria-label="4.2. Simulating the host_chan_mmio AFU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-set-up-and-run-the-hw-simulation-process" class="md-nav__link">
    4.2.1 Set Up and Run the HW Simulation Process
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422-set-up-and-run-the-sw-process" class="md-nav__link">
    4.2.2 Set Up and Run the SW Process
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-simulating-the-hello_world-afu" class="md-nav__link">
    4.3 Simulating the hello_world AFU
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-adding-remote-signal-tap-logic-analyzer-to-debug-the-afu" class="md-nav__link">
    5. Adding Remote Signal Tap Logic Analyzer to debug the AFU
  </a>
  
    <nav class="md-nav" aria-label="5. Adding Remote Signal Tap Logic Analyzer to debug the AFU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-adding-rstp-to-the-host_chan_mmio-afu" class="md-nav__link">
    5.1. Adding RSTP to the host_chan_mmio AFU
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-how-to-modify-the-pfvf-mux-configuration" class="md-nav__link">
    6. How to modify the PF/VF MUX configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../n6001/dev_guides/hps_dev/hps_developer_ug/" class="md-nav__link">
        HPS Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ug_sim_ofs_agx7_pcie_attach/ug_sim_ofs_agx7_pcie_attach/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Agilex SoC Attach OFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Agilex SoC Attach OFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../f2000x/user_guides/ug_eval_ofs/ug_eval_script_ofs_f2000x/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../f2000x/user_guides/ug_qs_ofs_f2000x/ug_qs_ofs_f2000x/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../f2000x/reference_manuals/ofs_fim/mnl_fim_ofs/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../f2000x/dev_guides/fim_dev/ug_dev_fim_ofs/" class="md-nav__link">
        FPGA Interface Manager Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../f2000x/dev_guides/afu_dev/ug_dev_afu_ofs_f2000x/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../f2000x/user_guides/ug_sim_ofs/ug_sim_ofs/" class="md-nav__link">
        Simulation User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ug_docker/ug_docker/" class="md-nav__link">
        Docker User guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ug_kvm/ug_kvm/" class="md-nav__link">
        KVM User guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          oneAPI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          oneAPI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../oneapi_asp/ug_oneapi_asp/" class="md-nav__link">
        oneAPI ASP Getting Started User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference_manual/oneapi_asp/oneapi_asp_ref_mnl/" class="md-nav__link">
        oneAPI Accelerator Support Package(ASP) Reference Manual
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          OFS Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          OFS Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
          OPAE USER GUIDES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          OPAE USER GUIDES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_api/quick_start/readme/" class="md-nav__link">
        Quick Start Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/install_guide/installation_guide/" class="md-nav__link">
        OPAE Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_api/prog_guide/readme/" class="md-nav__link">
        OPAE C API Programming Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/pyopae/python_bindings/" class="md-nav__link">
        OPAE Python Bindings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_api/plug_guide/readme/" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
          OPAE LIBRARIES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          OPAE LIBRARIES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_api/fpga_api/" class="md-nav__link">
        OPAE C API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_api/fpga_cxx_api/" class="md-nav__link">
        OPAE C++ Core API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_api/fpga_python_api/" class="md-nav__link">
        OPAE Python API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_api/plug_guide/readme/" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
          OPAE LINUX KERNEL DRIVERS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          OPAE LINUX KERNEL DRIVERS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/drv_arch/drv_arch/" class="md-nav__link">
        Open Programmable Accelerator Engine (OPAE) Linux Device Driver Architecture
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../../../sw/fpga_tools/fpgadiag/">OPAE FPGA TOOLS</a>
          
            <label for="__nav_7_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_4">
          <span class="md-nav__icon md-icon"></span>
          OPAE FPGA TOOLS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/fpgaconf/fpgaconf/" class="md-nav__link">
        fpgaconf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/fpgainfo/fpgainfo/" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/fpgasupdate/fpgasupdate/" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/mmlink/mmlink/" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/packager/packager/" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/userclk/userclk/" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/hssi/hssi/" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/pci_device/pci_device/" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/opae.io/opae.io/" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/rsu/rsu/" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/host_exerciser/host_exerciser/" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/hssi_ethernet/hssistats/" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/hssi_ethernet/hssiloopback/" class="md-nav__link">
        HSSI ethernet loopback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/mem_tg/mem_tg/" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/vabtool/vabtool/" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/opaevfio/opaevfio/" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/ofs.uio/ofs.uio/" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/opaeuio/opaeuio/" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../sw/fpga_tools/fpgad/fpgad/" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    1. Introduction
  </a>
  
    <nav class="md-nav" aria-label="1. Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-document-organization" class="md-nav__link">
    1.1. Document Organization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-prerequisite" class="md-nav__link">
    1.2. Prerequisite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-acceleration-functional-unit-afu-development-flow" class="md-nav__link">
    1.3. Acceleration Functional Unit (AFU) Development Flow
  </a>
  
    <nav class="md-nav" aria-label="1.3. Acceleration Functional Unit (AFU) Development Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131-understanding-platform-capabilities" class="md-nav__link">
    1.3.1. Understanding Platform Capabilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-high-level-data-flow" class="md-nav__link">
    1.3.2. High Level Data Flow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#133-considerations-for-pim-usage" class="md-nav__link">
    1.3.3. Considerations for PIM Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#134-afu-interfaces-included-with-intel-fpga-smartnic-n6001-pl" class="md-nav__link">
    1.3.4. AFU Interfaces Included with Intel® FPGA SmartNIC N6001-PL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-set-up-afu-development-environment" class="md-nav__link">
    2. Set Up AFU Development Environment
  </a>
  
    <nav class="md-nav" aria-label="2. Set Up AFU Development Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-afu-development-environment-overview" class="md-nav__link">
    2.1. AFU development environment overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-installation-of-quartus-and-required-patches" class="md-nav__link">
    2.2. Installation of Quartus and required patches
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-installation-of-support-tools" class="md-nav__link">
    2.3. Installation of Support Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-installation-of-opae-sdk" class="md-nav__link">
    2.4. Installation of OPAE SDK
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-download-the-basic-building-blocks-repositories" class="md-nav__link">
    2.5. Download the Basic Building Blocks repositories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-build-or-download-the-relocatable-pr-build-tree" class="md-nav__link">
    2.6. Build or download the relocatable PR build tree
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27-download-fim-to-fpga" class="md-nav__link">
    2.7. Download FIM to FPGA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#28-set-up-required-environment-variables" class="md-nav__link">
    2.8. Set up required Environment Variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-compiling-an-afu" class="md-nav__link">
    3. Compiling an AFU
  </a>
  
    <nav class="md-nav" aria-label="3. Compiling an AFU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-creating-the-afu-synthesis-environment" class="md-nav__link">
    3.1. Creating the AFU Synthesis Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-building-and-running-host_chan_mmio-example-afu" class="md-nav__link">
    3.2. Building and Running host_chan_mmio example AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-building-and-running-the-hello_world-example-afu" class="md-nav__link">
    3.3. Building and running the hello_world example AFU
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-modify-the-afu-user-clocks-frequency" class="md-nav__link">
    3.4. Modify the AFU user clocks frequency
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-simulating-an-afu-using-ase" class="md-nav__link">
    4. Simulating an AFU using ASE
  </a>
  
    <nav class="md-nav" aria-label="4. Simulating an AFU using ASE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-set-up-steps-to-run-ase" class="md-nav__link">
    4.1. Set Up Steps to Run ASE
  </a>
  
    <nav class="md-nav" aria-label="4.1. Set Up Steps to Run ASE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#411-install-opae-sdk" class="md-nav__link">
    4.1.1. Install OPAE SDK
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#412-install-ase-tools" class="md-nav__link">
    4.1.2 Install ASE Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#413-setup-required-ase-environment-variables" class="md-nav__link">
    4.1.3. Setup Required ASE Environment Variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-simulating-the-host_chan_mmio-afu" class="md-nav__link">
    4.2. Simulating the host_chan_mmio AFU
  </a>
  
    <nav class="md-nav" aria-label="4.2. Simulating the host_chan_mmio AFU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-set-up-and-run-the-hw-simulation-process" class="md-nav__link">
    4.2.1 Set Up and Run the HW Simulation Process
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422-set-up-and-run-the-sw-process" class="md-nav__link">
    4.2.2 Set Up and Run the SW Process
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-simulating-the-hello_world-afu" class="md-nav__link">
    4.3 Simulating the hello_world AFU
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-adding-remote-signal-tap-logic-analyzer-to-debug-the-afu" class="md-nav__link">
    5. Adding Remote Signal Tap Logic Analyzer to debug the AFU
  </a>
  
    <nav class="md-nav" aria-label="5. Adding Remote Signal Tap Logic Analyzer to debug the AFU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-adding-rstp-to-the-host_chan_mmio-afu" class="md-nav__link">
    5.1. Adding RSTP to the host_chan_mmio AFU
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-how-to-modify-the-pfvf-mux-configuration" class="md-nav__link">
    6. How to modify the PF/VF MUX configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notices-disclaimers" class="md-nav__link">
    Notices &amp; Disclaimers
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="afu-development-guide-ofs-for-intel-agilex-7-pcie-attach-fpgas"><strong><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Development Guide: <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel® Agilex® 7 PCIe Attach FPGAs</strong><a class="headerlink" href="#afu-development-guide-ofs-for-intel-agilex-7-pcie-attach-fpgas" title="Permanent link">&para;</a></h1>
<p>Last updated: <strong>May 07, 2024</strong> </p>
<h2 id="1-introduction"><strong>1. Introduction</strong><a class="headerlink" href="#1-introduction" title="Permanent link">&para;</a></h2>
<p>This document is a design guide for the creation of an Accelerator Functional Unit (<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>) using Open FPGA Stack (<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>) for Intel® Agilex® 7 FPGAs PCIe Attach. The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> concept consists of separating out the FPGA design development process into two parts, the construction of the foundational FPGA Interface Manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>), and the development of the Acceleration Function Unit (<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>), as shown in the diagram below.</p>
<p><a class="glightbox" href="../images/FIM_top_intro.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/FIM_top_intro.png" /></a></p>
<p>This diagram shows the separation of FPGA board interface development from the internal FPGA workload creation.  This separation starts with the FPGA Interface Manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>) which consists of the external interfaces and board management functions.  The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> is the base system layer and is typically provided by board vendors. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> interface is specific to a particular physical platform.  The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> makes use of the external interfaces with user defined logic to perform a specific application.  By separating out the lengthy and complicated process of developing and integrating external interfaces for an FPGA into a board allows the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developer to focus on the needs of their workload.  <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel® Agilex® 7 FPGAs PCIe Attach provides the following tools for rapid <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development:</p>
<ul>
<li>Scripts for both compilation and simulation setup</li>
<li>Optional Platform Interface Manager (<abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>) which is a set of SystemVerilog shims and scripts for flexible <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> interfacing</li>
<li>Acceleration Simulation Environment (ASE) which is a hardware/software co-simulation environment scripts for compilation and Acceleration</li>
<li>Integration with Open Programmable Acceleration Engine (OPAE) SDK for rapid software development for your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> application</li>
</ul>
<p>Please notice in the above block diagram that the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region consists of static and partial reconfiguration (<abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>) regions where the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region can be dynamically reconfigured while the remaining FPGA design continues to function.  Creating <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> logic for the static region is described in <a href="https://ofs.github.io/ofs-2023.2/hw/n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/">FPGA Interface Manager Developer Guide for Intel® Agilex® 7 PCIe Attach</a>.  This guide covers logic in the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Main region.</p>
<h3 id="11-document-organization"><strong>1.1. Document Organization</strong><a class="headerlink" href="#11-document-organization" title="Permanent link">&para;</a></h3>
<p>This document is organized as follows:</p>
<ul>
<li>Description of design flow</li>
<li>Interfaces and functionality provided in the Intel® Agilex® 7 FPGAs PCIe Attach <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></li>
<li>Setup of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Development environment</li>
<li>Synthesize the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> example</li>
<li>Testing the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> example on the Intel® FPGA SmartNIC N6001-PL card</li>
<li>Hardware/Software co-simulation using ASE</li>
<li>Debugging an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> with Remote Signal Tap</li>
</ul>
<p>This guide provides theory followed by tutorial steps to solidify your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development knowledge.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong>  </p>
<p><strong>This guide uses the Intel® FPGA SmartNIC N6001-PL as the platform for all tutorial steps. Additionally, this guide and the tutorial steps can be used with other platforms, such as the Intel Agilex® 7 FPGA F-Series Development Kit (2x F-Tile).</strong></p>
<p><strong>Some of the document links in this guide are specific to the  Intel® FPGA SmartNIC N6001-PL.   If using a different platform, please use the associated documentation for your platform as there could be differences in building the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and downloading <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> images.</strong><br />
</p>
</blockquote>
<p>If you have worked with previous Intel Programmable Acceleration products, you will find out that <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel® Agilex® 7 FPGAs PCIe Attach is similar. However, there are differences and you are advised to carefully read and follow the tutorial steps to fully understand the design tools and flow.</p>
<h3 id="12-prerequisite"><strong>1.2. Prerequisite</strong><a class="headerlink" href="#12-prerequisite" title="Permanent link">&para;</a></h3>
<p>This guide assumes you have the following FPGA logic design-related knowledge and skills:</p>
<ul>
<li>FPGA compilation flows including the Intel® Quartus® Prime Pro Edition design flow</li>
<li>Static Timing closure, including familiarity with the Timing Analyzer tool in Intel® Quartus® Prime Pro Edition software, applying timing constraints, Synopsys* Design Constraints (.sdc) language and Tcl scripting, and design methods to close on timing critical paths.</li>
<li>RTL and coding practices to create synthesizable logic.</li>
<li>Understanding of AXI and Avalon memory mapped and streaming interfaces.</li>
<li>Simulation of complex RTL using industry standard simulators (Synopsys® VCS® or Siemens® QuestaSim®).</li>
<li>Signal Tap Logic Analyzer tool in the Intel® Quartus® Prime Pro Edition software.</li>
</ul>
<p>You are strongly encouraged to review the <a href="https://ofs.github.io/ofs-2023.2/hw/n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/">FPGA Interface Manager Developer Guide for Intel® Agilex® 7 PCIe Attach</a>.</p>
<h3 id="13-acceleration-functional-unit-afu-development-flow"><strong>1.3. Acceleration Functional Unit (<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>) Development Flow</strong><a class="headerlink" href="#13-acceleration-functional-unit-afu-development-flow" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development flow is shown below:
<a class="glightbox" href="../images/AFU_Dev_Flow.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/AFU_Dev_Flow.png" /></a></p>
<h4 id="131-understanding-platform-capabilities"><strong>1.3.1. Understanding Platform Capabilities</strong><a class="headerlink" href="#131-understanding-platform-capabilities" title="Permanent link">&para;</a></h4>
<p>The block diagram of the N6001 Board is shown below:</p>
<p><a class="glightbox" href="../images/N6000_Block.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/N6000_Block.png" /></a></p>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> provided with this release is shown below:</p>
<p><a class="glightbox" href="../images/N6000_Base_x16_BlockDia.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/N6000_Base_x16_BlockDia.png" /></a></p>
<p>This release <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> provides the following features:</p>
<ul>
<li>Host interface<ul>
<li>PCIe Gen4 x 16</li>
<li>5 - PF, 4 - VF, AXI-S TLP packets</li>
<li>MSI-X interrupts</li>
<li>Logic to demonstrate simple PCIe loopback</li>
</ul>
</li>
<li>Network interface<ul>
<li>2 - QSFP28/56 cages</li>
<li>2 x 4 x 25 GbE with exerciser logic demonstrating traffic generation/monitoring</li>
</ul>
</li>
<li>External Memory - DDR4 - 2400<ul>
<li>HPS - 1GB organized as 256 Mb x 32 with 256 Mb x 8 ECC</li>
<li>Channel 0, 1  -  4 GB organized as 1 Gb x 32</li>
<li>Channel 2, 3 - 4 GB organized as 1 Gb x 32 with 1 Gb x 8 ECC (ECC is not implemented in this release)</li>
<li>Memory exerciser logic demonstrating external memory operation</li>
</ul>
</li>
<li>Board Management<ul>
<li>SPI interface</li>
<li>FPGA configuration</li>
<li>Example logic showing DFH operation</li>
</ul>
</li>
<li>Remote Signal Tap logic</li>
<li>Partial reconfiguration control logic</li>
<li>ARM HPS subsystem with embedded Linux<ul>
<li>HPS Copy engine</li>
</ul>
</li>
</ul>
<h4 id="132-high-level-data-flow"><strong>1.3.2. High Level Data Flow</strong><a class="headerlink" href="#132-high-level-data-flow" title="Permanent link">&para;</a></h4>
<p>The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> high level data flow is shown below:</p>
<p><a class="glightbox" href="../images/OFS_DataFlow.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/OFS_DataFlow.png" /></a></p>
<h4 id="133-considerations-for-pim-usage"><strong>1.3.3. Considerations for <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Usage</strong><a class="headerlink" href="#133-considerations-for-pim-usage" title="Permanent link">&para;</a></h4>
<p>An early decision for your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development is determining if the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> will be included in your design flow. The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> is an abstraction layer consisting of a collection of SystemVerilog interfaces and shims to enable partial <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> portability across hardware despite variations in hardware topology and native interfaces. The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> adds a level of logic between an accelerator (an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>) and the platform (the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>). The use of the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> is optional for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development.  Please see <a href="https://github.com/OFS/ofs-platform-afu-bbb/blob/master/plat_if_develop/ofs_plat_if/docs/PIM_AFU_interface.md">Connecting an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to a Platform using <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr></a> for details on using the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> and its capabilities. Please see <a href="https://github.com/OFS/examples-afu/tree/main/tutorial"><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Tutorial</a> for a detailed tutorial on using the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>. The learning steps in the tutorial can be run with the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Agilex <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> package.   </p>
<p>If you choose not to use the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>, please see the hybrid and afu_main examples in the <a href="https://github.com/OFS/examples-afu/tree/main/tutorial"><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> Tutorial</a> for instruction on using a traditional RTL design flow. Note, the example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> provided in <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> does not include <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>.</p>
<h4 id="134-afu-interfaces-included-with-intel-fpga-smartnic-n6001-pl"><strong>1.3.4. <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Interfaces Included with Intel® FPGA SmartNIC N6001-PL</strong><a class="headerlink" href="#134-afu-interfaces-included-with-intel-fpga-smartnic-n6001-pl" title="Permanent link">&para;</a></h4>
<p>The figure below shows the interfaces available to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in this architecture. It also shows the design hierarchy with module names from the fim (top.sv) to the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> (afu_main.sv).
One of the main differences from the Stratix 10 <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> architecture to this one is the presence of the static port gasket region (port_gasket.sv) that has components to facilitate the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and also consists of the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region (afu_main.sv) via the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> slot. The Port Gasket contains all the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> specific modules and logic, e.g., <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> slot reset/freeze control, user clock, remote STP etc. Architecturally, a Port Gasket can have multiple <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> slots where user workload can be programmed into. However, only one <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> slot is supported for <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Release for Intel Agilex. Everything in the Port Gasket until the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> slot should be provided by the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> developer. The task of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developer is to add their desired application in the afu_main.sv module by stripping out unwanted logic and instantiating the target accelerator.
As shown in the figure below, here are the interfaces connected to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> (highlighted in green) via the PCIe Attach <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>:</p>
<ol>
<li>AXI Streaming (AXI-S) interface to the Host via PCIe Gen4x16</li>
<li>AXI Memory Mapped Channels (4) to the DDR4 EMIF interface</li>
<li>AXI Streaming (AXI-S) interface to the HSSI 25 Gb Ethernet</li>
</ol>
<p><a class="glightbox" href="../images/N6000_AFU_IF.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/N6000_AFU_IF.png" /></a></p>
<h2 id="2-set-up-afu-development-environment"><strong>2. Set Up <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Development Environment</strong><a class="headerlink" href="#2-set-up-afu-development-environment" title="Permanent link">&para;</a></h2>
<p>This section covers the setup of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development environment.</p>
<h3 id="21-afu-development-environment-overview"><strong>2.1. <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development environment overview</strong><a class="headerlink" href="#21-afu-development-environment-overview" title="Permanent link">&para;</a></h3>
<p>A typical development and hardware test environment consists of a development server or workstation with FPGA development tools installed and a separate server with the target <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> compatible FPGA PCIe card installed.  The typical usage and flow of data between these two servers is shown below:</p>
<p><a class="glightbox" href="../images/AFU_Dev_Deploy.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/AFU_Dev_Deploy.png" /></a></p>
<p>Note: both development and hardware testing can be performed on the same server if desired.</p>
<p>This guide uses Intel® FPGA SmartNIC N6001-PL as the target <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> compatible FPGA PCIe card for demonstration steps.  The Intel® FPGA SmartNIC N6001-PL must be fully installed following the <a href="https://ofs.github.io/ofs-2023.2/hw/n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/">Getting Started User Guide: <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Intel® Agilex® 7 PCIe Attach FPGAs</a>. If using a different <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> FPGA PCIe card, contact your supplier for instructions on how to install and operate user developed AFUs.</p>
<p>The following is a summary of the steps to set up for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development:</p>
<ol>
<li>Install Quartus Prime Pro Version 23.2 for Linux with Agilex device support and required Quartus patches.</li>
<li>Make sure support tools are installed and meet version requirements.</li>
<li>Install <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr>.</li>
<li>Download the Basic Building Blocks repository.</li>
<li>Build or download the relocatable <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>-able build tree based on your Intel® Agilex FPGA PCIe Attach <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.</li>
<li>Download <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> to the Intel® Agilex FPGA PCIe Attach platform.</li>
</ol>
<p>Building AFUs with <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> for Agilex requires the build machine to have at least 64 GB of RAM. </p>
<h3 id="22-installation-of-quartus-and-required-patches"><strong>2.2. Installation of Quartus and required patches</strong><a class="headerlink" href="#22-installation-of-quartus-and-required-patches" title="Permanent link">&para;</a></h3>
<p><strong>Intel Quartus Prime Pro Version 23.2</strong> is verified to work with the latest <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> release 2023.2.  However, you have the option to port and verify the release on newer versions of Intel Quartus Prime Pro software.</p>
<p>Use RedHatEnterprise Linux® (RHEL) 8.6 for compatibility with your development flow and also testing your <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design in your platform. </p>
<p>Prior to installing Quartus:</p>
<ol>
<li>
<p>Ensure you have at least 64 GB of free space for Quartus Prime Pro installation and your development work.</p>
<ul>
<li>Intel® recommends that your system be configured to provide virtual memory equal in size or larger than the recommended physical RAM size that is required to process your design.</li>
<li>The disk space may be significantly more based on the device families included in the install. Prior to installation, the disk space should be enough to hold both zipped tar files and uncompressed installation files. After successful installation, delete the downloaded zipped files and uncompressed zip files to release the disk space.</li>
</ul>
</li>
<li>
<p>Perform the following steps to satisfy the required dependencies.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>gcc<span class="w"> </span>gcc-c++<span class="w"> </span>make<span class="w"> </span>cmake<span class="w"> </span>libuuid-devel<span class="w"> </span>rpm-build<span class="w"> </span>autoconf<span class="w"> </span>automake<span class="w"> </span>bison<span class="w"> </span>boost<span class="w"> </span>boost-devel<span class="w"> </span>libxml2<span class="w"> </span>libxml2-devel<span class="w"> </span>make<span class="w"> </span>ncurses<span class="w"> </span>grub2<span class="w"> </span>bc<span class="w"> </span>csh<span class="w"> </span>flex<span class="w"> </span>glibc-locale-source<span class="w"> </span>libnsl<span class="w"> </span>ncurses-compat-libs<span class="w"> </span>
</code></pre></div>
<p>Apply the following configurations.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>localedef<span class="w"> </span>-f<span class="w"> </span>UTF-8<span class="w"> </span>-i<span class="w"> </span>en_US<span class="w"> </span>en_US.UTF-8<span class="w"> </span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>$<span class="w"> </span>sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/usr/lib64/libncurses.so.6<span class="w"> </span>/usr/lib64/libncurses.so.5<span class="w"> </span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>$<span class="w"> </span>sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/usr/bin/python3<span class="w"> </span>/usr/bin/python
</code></pre></div>
</li>
<li>
<p>Create the default installation path: <home directory>/intelFPGA_pro/<version number>, where <home directory> is the default path of the Linux workstation, or as set by the system administrator and <version> is your Quartus version number.</p>
<p>The installation path must satisfy the following requirements:</p>
<ul>
<li>Contain only alphanumeric characters</li>
<li>No special characters or symbols, such as !$%@^&amp;*&lt;&gt;,</li>
<li>Only English characters</li>
<li>No spaces</li>
</ul>
</li>
<li>
<p>Download your required Quartus Prime Pro Linux version <a href="https://www.intel.com/content/www/us/en/products/details/fpga/development-tools/quartus-prime/resource.html">here</a>.</p>
</li>
<li>
<p>After running the Quartus Prime Pro installer, set the PATH environment variable to make utilities <code>quartus</code>, <code>jtagconfig</code>, and <code>quartus_pgm</code> discoverable. Edit your bashrc file <code>~/.bashrc</code> to add the following line:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>&lt;Quartus<span class="w"> </span>install<span class="w"> </span>directory&gt;/quartus/bin:<span class="nv">$PATH</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>&lt;Quartus<span class="w"> </span>install<span class="w"> </span>directory&gt;/qsys/bin:<span class="nv">$PATH</span>
</code></pre></div>
<p>For example, if the Quartus install directory is /home/intelFPGA_pro/23.2 then the new line is:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/home/intelFPGA_pro/23.2/quartus/bin:<span class="nv">$PATH</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/home/intelFPGA_pro/23.2/qsys/bin:<span class="nv">$PATH</span>
</code></pre></div>
</li>
<li>
<p>Verify, Quartus is discoverable by opening a new shell:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>$ which quartus
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>/home/intelFPGA_pro/23.2/quartus/bin/quartus
</code></pre></div>
</li>
</ol>
<h3 id="23-installation-of-support-tools"><strong>2.3. Installation of Support Tools</strong><a class="headerlink" href="#23-installation-of-support-tools" title="Permanent link">&para;</a></h3>
<p>Make sure support tools are installed and meet version requirements.</p>
<p>The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> provided Quartus build scripts require the following tools. Verify these are installed in your development environment.</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>Python</td>
<td>3.6.8</td>
</tr>
<tr>
<td>GCC</td>
<td>7.4.0</td>
</tr>
<tr>
<td>cmake</td>
<td>3.15</td>
</tr>
<tr>
<td>git</td>
<td>1.8.3.1</td>
</tr>
<tr>
<td>perl</td>
<td>5.8.8</td>
</tr>
</tbody>
</table>
<h3 id="24-installation-of-opae-sdk"><strong>2.4. Installation of <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr></strong><a class="headerlink" href="#24-installation-of-opae-sdk" title="Permanent link">&para;</a></h3>
<p>Follow the instructions in the Getting Started Guide: Open FPGA Stack for Intel® FPGA SmartNIC N6001-PL, section <a href="https://ofs.github.io/ofs-2023.2/hw/n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/#40-opae-software-development-kit">4.0 OPAE Software Development Kit</a> to build and install the required <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> for the Intel® FPGA SmartNIC N6001-PL.</p>
<p>Working with the Intel® Intel® FPGA SmartNIC N6001-PL card requires <strong>opae-2.8.0-1</strong>. Follow the instructions in the Getting Started Guide: Intel® Open FPGA Stack for Intel® FPGA SmartNIC N6001-PL section <a href="https://ofs.github.io/ofs-2023.2/hw/n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/#40-opae-software-development-kit">4.0 OPAE Software Development Kit</a>. Make sure to check out the cloned repository to tag <strong>2.8.0-1</strong> and branch <strong>release/2.8.0</strong>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>tags/2.8.0-1<span class="w"> </span>-b<span class="w"> </span>release/2.8.0
</code></pre></div>
<blockquote>
<p>Note: The tutorial steps provided in the next sections assume the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> is installed in default system locations, under the directory, <code>/usr</code>. In most system configurations, this will allow the OS and tools to automatically locate the OPAE binaries, scripts, libraries and include files required for the compilation and simulation of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and AFUs.</p>
</blockquote>
<h3 id="25-download-the-basic-building-blocks-repositories"><strong>2.5. Download the Basic Building Blocks repositories</strong><a class="headerlink" href="#25-download-the-basic-building-blocks-repositories" title="Permanent link">&para;</a></h3>
<p>The <code>ofs-platform-afu-bbb</code> repository contains the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> files as well as example <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>-based AFUs that can be used for testing and demonstration purposes. This guide will use the <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> example in the <a href="https://github.com/OFS/ofs-platform-afu-bbb">ofs-platform-afu-bbb</a> repository and the <code>hello_world</code> sample accompanying the <a href="https://github.com/OFS/examples-afu.git">examples <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></a> repository to demonstrate how to synthesize, load, simulate, and test a <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>-based <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using the Intel® FPGA SmartNIC N6001-PL card with the PCIe Attach <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.</p>
<p>Execute the next commands to clone the <abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr> repository.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="w">  </span><span class="c1"># Create top level directory for AFU development</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>$<span class="w"> </span>mkdir<span class="w"> </span>OFS_BUILD_ROOT
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>OFS_BUILD_ROOT
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_BUILD_ROOT</span><span class="o">=</span><span class="nv">$PWD</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">  </span><span class="c1"># Clone the ofs-platform-afu-bbb repository.</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/OFS/ofs-platform-afu-bbb.git
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">  </span><span class="c1"># Verify retrieval</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/ofs-platform-afu-bbb
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>$<span class="w"> </span>ls
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>LICENSE<span class="w">  </span>plat_if_develop<span class="w">  </span>plat_if_release<span class="w">  </span>plat_if_tests<span class="w">  </span>README.md
</code></pre></div>
<p>The documentation in the <a href="https://github.com/OFS/ofs-platform-afu-bbb">ofs-platform-afu-bbb</a> repository further addresses
  - The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> concept.
  - The structure of the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>-based <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> examples.
  - How to generate a release and configure the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>.
  - How to connect an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to an <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.</p>
<h3 id="26-build-or-download-the-relocatable-pr-build-tree"><strong>2.6. Build or download the relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> build tree</strong><a class="headerlink" href="#26-build-or-download-the-relocatable-pr-build-tree" title="Permanent link">&para;</a></h3>
<p>A relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> build tree is needed to build the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> partial reconfiguration area for the intended <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. The tree is relocatable and may be copied to a new location. It does not depend on files in the original <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> build.</p>
<p>You can use the  Intel® FPGA SmartNIC N6001-PL release package and download the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> build tree and <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> images, to develop your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.  These are located at <a href="https://github.com/OFS/ofs-n6001/releases"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>-N6001 release</a>  </p>
<p>Or you can build your own <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and generated the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> build tree during the process.</p>
<p>To download and untar the pr_build_template:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>$<span class="w"> </span>mkdir<span class="w"> </span>pr_build_template
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>pr_build_template
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>$<span class="w"> </span>wget<span class="w"> </span>https://github.com/OFS/ofs-agx7-pcie-attach/releases/download/ofs-2023.2-1/pr_template-n6001.tar.gz
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>$<span class="w"> </span>tar<span class="w"> </span>-zxvf<span class="w"> </span>pr_template-n6001.tar.gz
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_PLATFORM_ROOT</span><span class="o">=</span><span class="nv">$PWD</span>
</code></pre></div>
<p>To build your own <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and generate the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> build tree for the Intel® FPGA SmartNIC N6001-PL platform, refer the <a href="https://ofs.github.io/ofs-2023.2/hw/n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/">FPGA Interface Manager Developer Guide for Intel® Agilex® 7 PCIe Attach</a> and follow the Out-of-Tree <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> build flow.  If you are using a different platform, refer to the FPGA Interface Manager Developer Guide for your platform and follow the Out-of-Tree <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> build flow.</p>
<h3 id="27-download-fim-to-fpga"><strong>2.7. Download <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> to FPGA</strong><a class="headerlink" href="#27-download-fim-to-fpga" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> requires that the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> from which the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is derived be loaded onto the FPGA.   </p>
<p>If you are using the Intel® FPGA SmartNIC N6001-PL release package, download the associated <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> files:
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>$<span class="w"> </span>wget<span class="w"> </span>https://github.com/OFS/ofs-agx7-pcie-attach/releases/download/ofs-2023.2-1/n6001-images.tar.gz
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>$<span class="w"> </span>tar<span class="w"> </span>-zxvf<span class="w"> </span>n6001-images.tar.gz
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>n6001-images
</code></pre></div></p>
<p>If you are generating your own <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, use the unsigned FPGA binary images from your <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> build. </p>
<p>To downlaod the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> to the Intel® FPGA SmartNIC N6001-PL platform:
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>fpgasupdate<span class="w"> </span>ofs_top_page1_unsigned_user1.bin<span class="w"> </span>&lt;N6001<span class="w"> </span>SKU2<span class="w"> </span>PCIe<span class="w"> </span>b:d.f&gt;
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>$<span class="w"> </span>sudo<span class="w"> </span>fpgasupdate<span class="w"> </span>ofs_top_page2_unsigned_user2.bin<span class="w"> </span>&lt;N6001<span class="w"> </span>SKU2<span class="w"> </span>PCIe<span class="w"> </span>b:d.f&gt;
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>$<span class="w"> </span>sudo<span class="w"> </span>rsu<span class="w"> </span>fpga<span class="w"> </span>--page<span class="o">=</span>user1<span class="w"> </span>&lt;N6001<span class="w"> </span>SKU2<span class="w"> </span>PCIe<span class="w"> </span>b:d.f&gt;
</code></pre></div></p>
<p>If you are using a different platform, refer to the documentation for your platform to download the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> images onto your Intel® Agilex® PCIe Attach Platform.</p>
<h3 id="28-set-up-required-environment-variables"><strong>2.8. Set up required Environment Variables</strong><a class="headerlink" href="#28-set-up-required-environment-variables" title="Permanent link">&para;</a></h3>
<p>Set the required environment variables as shown below. These environment variables must be set prior to simulation or compilation tasks. You can create a simple script to set these variables and save time going forward.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># If not already done, export OFS_BUILD_ROOT to the top level directory for AFU development</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_BUILD_ROOT</span><span class="o">=</span>&lt;path<span class="w"> </span>to<span class="w"> </span>ofs<span class="w"> </span>build<span class="w"> </span>directory&gt;
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="c1"># If not already done, export OPAE_PLATFORM_ROOT to the PR build tree directory</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_PLATFORM_ROOT</span><span class="o">=</span>&lt;path<span class="w"> </span>to<span class="w"> </span>pr<span class="w"> </span>build<span class="w"> </span>tree&gt;
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="c1"># Quartus Tools</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="c1"># Note, QUARTUS_HOME is your Quartus installation directory, e.g. $QUARTUS_HOME/bin contains Quartus executable.</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_HOME</span><span class="o">=</span>&lt;user_path&gt;/intelFPGA_pro/23.2/quartus
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_HOME</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_INSTALL_DIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">QUARTUS_ROOTDIR_OVERRIDE</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">IMPORT_IP_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/../ip
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">IP_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/../ip
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">QSYS_ROOTDIR</span><span class="o">=</span><span class="nv">$QUARTUS_ROOTDIR</span>/../qsys
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$QUARTUS_HOME</span>/bin:<span class="nv">$QSYS_ROOTDIR</span>/bin:<span class="nv">$QUARTUS_HOME</span>/../sopc_builder/bin/:<span class="nv">$PATH</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="c1"># Synopsys Verification Tools</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">DESIGNWARE_HOME</span><span class="o">=</span>&lt;user_path&gt;/synopsys/vip_common/vip_Q-2020.03A
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$DESIGNWARE_HOME</span>/bin:<span class="nv">$PATH</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">VCS_HOME</span><span class="o">=</span>&lt;user_path&gt;/synopsys/vcsmx/S-2021.09-SP1/linux64/rhel
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$VCS_HOME</span>/bin:<span class="nv">$PATH</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="c1"># OPAE SDK release</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_SDK_REPO_BRANCH</span><span class="o">=</span>release/2.8.0
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="c1"># The following environment variables are required for compiling the AFU examples. </span>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="c1"># Location to clone the ofs-platform-afu-bbb repository which contains PIM files and AFU examples.</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_PLATFORM_AFU_BBB</span><span class="o">=</span><span class="nv">$OFS_BUILD_ROOT</span>/ofs-platform-afu-bbb<span class="w"> </span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a><span class="c1"># OPAE and MPF libraries must either be on the default linker search paths or on both LIBRARY_PATH and LD_LIBRARY_PATH.  </span>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_LOC</span><span class="o">=</span>/usr
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">LIBRARY_PATH</span><span class="o">=</span><span class="nv">$OPAE_LOC</span>/lib:<span class="nv">$LIBRARY_PATH</span>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$OPAE_LOC</span>/lib64:<span class="nv">$LD_LIBRARY_PATH</span>
</code></pre></div>
<h2 id="3-compiling-an-afu"><strong>3. Compiling an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#3-compiling-an-afu" title="Permanent link">&para;</a></h2>
<p>In this section, you will use the relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> build tree created in the previous steps from the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> to compile an example <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>-based <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. This section will be developed around the <code>host_chan_mmio</code> and <code>hello_world</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> examples to showcase the synthesis of a <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>-based <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>The build steps presented below demonstrate the ease in building and running an actual <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> on the board. To successfully execute the instructions in this section, you must have set up your development environment and have a relocateable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> Build tree as instructed in section 2 of this document.</p>
<h3 id="31-creating-the-afu-synthesis-environment"><strong>3.1. Creating the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Synthesis Environment</strong><a class="headerlink" href="#31-creating-the-afu-synthesis-environment" title="Permanent link">&para;</a></h3>
<p>The <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> flow provides the script <code>afu_synth_setup</code> to create the synthesis environment to build the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> examples. See how to use it below.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>usage: afu_synth_setup [-h] -s SOURCES [-p PLATFORM] [-l LIB] [-f] dst
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>Generate a Quartus build environment for an AFU. A build environment is
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>instantiated from a release and then configured for the specified AFU. AFU
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>source files are specified in a text file that is parsed by rtl_src_config,
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>which is part of the OPAE base environment.
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>positional arguments:
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>  dst                   Target directory path (directory must not exist).
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>optional arguments:
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>  -h, --help            show this help message and exit
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>  -s SOURCES, --sources SOURCES
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>                        AFU source specification file that will be passed to
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>                        rtl_src_config. See &quot;rtl_src_config --help&quot; for the
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>                        file&#39;s syntax. rtl_src_config translates the source
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>                        list into either Quartus or RTL simulator syntax.
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>  -p PLATFORM, --platform PLATFORM
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>                        FPGA platform name.
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>  -l LIB, --lib LIB     FPGA platform release hw/lib directory. If not
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>                        specified, the environment variables OPAE_FPGA_HW_LIB
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>                        and then BBS_LIB_PATH are checked.
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>  -f, --force           Overwrite target directory if it exists.
</code></pre></div>
<h3 id="32-building-and-running-host_chan_mmio-example-afu"><strong>3.2. Building and Running host_chan_mmio example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#32-building-and-running-host_chan_mmio-example-afu" title="Permanent link">&para;</a></h3>
<p>The <code>$OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio</code> is a simple example demonstrating both hardware and software access to an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The <code>host_chan_mmio</code> example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> consists of the following files.  The hw directory contains the RTL to implement the hardware functionality using Avalon and AXI interfaces. However, this guide will use the AXI version of the <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to go through the compilation steps. The sw directory of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> contains the source code of the host application that communicates with the actual <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>host_chan_mmio
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>├──<span class="w"> </span>hw
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>│<span class="w">   </span>└──<span class="w"> </span>rtl
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>│<span class="w">       </span>├──<span class="w"> </span>avalon
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>afu_avalon512.sv
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>afu_avalon.sv
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_plat_afu_avalon512.sv
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_plat_afu_avalon_from_ccip.sv
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>│<span class="w">       </span>│<span class="w">   </span>└──<span class="w"> </span>ofs_plat_afu_avalon.sv
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>│<span class="w">       </span>├──<span class="w"> </span>axi
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>afu_axi512.sv
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>afu_axi.sv
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_plat_afu_axi512.sv
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_plat_afu_axi_from_ccip.sv
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>│<span class="w">       </span>│<span class="w">   </span>└──<span class="w"> </span>ofs_plat_afu_axi.sv
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>│<span class="w">       </span>├──<span class="w"> </span>host_chan_mmio.json
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>│<span class="w">       </span>├──<span class="w"> </span>test_mmio_avalon0_from_ccip.txt
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>│<span class="w">       </span>├──<span class="w"> </span>test_mmio_avalon1.txt
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>│<span class="w">       </span>├──<span class="w"> </span>test_mmio_avalon2_512rw.txt
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>│<span class="w">       </span>├──<span class="w"> </span>test_mmio_axi0_from_ccip.txt
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>│<span class="w">       </span>├──<span class="w"> </span>test_mmio_axi1.txt
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>│<span class="w">       </span>└──<span class="w"> </span>test_mmio_axi2_512rw.txt
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>└──<span class="w"> </span>sw
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="w">    </span>├──<span class="w"> </span>main.c
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="w">    </span>├──<span class="w"> </span>Makefile
</code></pre></div>
<p>Execute <code>afu_synth_setup</code> as follows to create the synthesis environment for a <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that fits the PCIe Attach <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> previously constructed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/n6001
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/n6001
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>$<span class="w"> </span>afu_synth_setup<span class="w"> </span>-s<span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/hw/rtl/test_mmio_axi1.txt<span class="w"> </span>hardware
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>Now,<span class="w"> </span>move<span class="w"> </span>into<span class="w"> </span>the<span class="w"> </span>synthesis<span class="w"> </span>environment<span class="w"> </span><span class="sb">```</span>hardware<span class="sb">```</span><span class="w"> </span>directory<span class="w"> </span>just<span class="w"> </span>created.<span class="w"> </span>From<span class="w"> </span>there,<span class="w"> </span>execute<span class="w"> </span>the<span class="w"> </span><span class="sb">```</span>afu_synth<span class="sb">```</span><span class="w"> </span>command.<span class="w"> </span>The<span class="w"> </span>successful<span class="w"> </span>completion<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span><span class="nb">command</span><span class="w"> </span>will<span class="w"> </span>produce<span class="w"> </span>the<span class="w"> </span><span class="sb">```</span>host_chan_mmio.gbs<span class="sb">```</span><span class="w"> </span>file<span class="w"> </span>under<span class="w"> </span>the<span class="w"> </span>synthesis<span class="w"> </span>environment<span class="w"> </span>directory,<span class="w"> </span><span class="sb">```</span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/n6001/hardware<span class="sb">```</span>.
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>hardware
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>$<span class="w"> </span><span class="nv">$OPAE_PLATFORM_ROOT</span>/bin/afu_synth
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>Compiling<span class="w"> </span>ofs_top<span class="w"> </span>ofs_pr_afu
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>Generating<span class="w"> </span>host_chan_mmio.gbs
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="o">==================================</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>...
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>...
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="o">===========================================================================</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="w"> </span>PR<span class="w"> </span>AFU<span class="w"> </span>compilation<span class="w"> </span><span class="nb">complete</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="w"> </span>AFU<span class="w"> </span>gbs<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span><span class="s1">&#39;host_chan_mmio.gbs&#39;</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="w"> </span>Design<span class="w"> </span>meets<span class="w"> </span><span class="nv">timing</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="o">===========================================================================</span>
</code></pre></div>
<p>The previous output indicates the successful compilation of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and the compliance with the timing requirements. Analyze the reports generated in case the design does not meet timing. The timing reports are stored in the directory, <code>$OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/n6001/hardware/build/syn/board/n6001/syn_top/output_files/timing_report</code>.</p>
<p>Once the compilation finishes successfully, load the new <code>host_chan_mmio.gbs</code> bitstream file into the partial reconfiguration region of the target Intel® FPGA SmartNIC N6001-PL board. Keep in mind, that the loaded image is dynamic - this image is not stored in flash and if the card is power cycled, then the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> region is re-loaded with the default <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>To load the image, perform the following steps:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="w"> </span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/n6001/hardware
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>fpgasupdate<span class="w"> </span>host_chan_mmio.gbs<span class="w"> </span>&lt;N6001<span class="w"> </span>SKU2<span class="w"> </span>PCIe<span class="w"> </span>b:d.f&gt;
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="o">[</span>sudo<span class="o">]</span><span class="w"> </span>password<span class="w"> </span><span class="k">for</span><span class="w"> </span>&lt;&lt;Your<span class="w"> </span>username&gt;&gt;:<span class="w"> </span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="o">[</span><span class="m">2022</span>-04-15<span class="w"> </span><span class="m">20</span>:22:18.85<span class="o">]</span><span class="w"> </span><span class="o">[</span>WARNING<span class="w"> </span><span class="o">]</span><span class="w"> </span>Update<span class="w"> </span>starting.<span class="w"> </span>Please<span class="w"> </span><span class="k">do</span><span class="w"> </span>not<span class="w"> </span>interrupt.
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="o">[</span><span class="m">2022</span>-04-15<span class="w"> </span><span class="m">20</span>:22:19.75<span class="o">]</span><span class="w"> </span><span class="o">[</span>INFO<span class="w">    </span><span class="o">]</span><span class="w"> </span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>Partial<span class="w"> </span>Reconfiguration<span class="w"> </span>OK
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="o">[</span><span class="m">2022</span>-04-15<span class="w"> </span><span class="m">20</span>:22:19.75<span class="o">]</span><span class="w"> </span><span class="o">[</span>INFO<span class="w">    </span><span class="o">]</span><span class="w"> </span>Total<span class="w"> </span>time:<span class="w"> </span><span class="m">0</span>:00:00.90
</code></pre></div>
<p>Set up your board to work with the newly loaded <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># For the following example, the N6001 SKU2 PCIe b:d.f is assumed to be B1:00.0,</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="c1"># however this may be different in your system</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1"># Create the Virtual Functions (VFs):</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>$<span class="w"> </span>sudo<span class="w"> </span>pci_device<span class="w"> </span>b1:00.0<span class="w"> </span>vf<span class="w"> </span><span class="m">3</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="c1"># Verify:</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w"> </span>$<span class="w"> </span>lspci<span class="w"> </span>-s<span class="w"> </span>b1:00
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w"> </span>b1:00.0<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w"> </span>b1:00.1<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w"> </span>b1:00.2<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w"> </span>b1:00.3<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w"> </span>b1:00.4<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w"> </span>b1:00.5<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w"> </span>b1:00.6<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w"> </span>b1:00.7<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="c1"># Bind VFs to VFIO driver.  Enter your username </span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.1<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w"> </span>Unbinding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.1<span class="w"> </span>from<span class="w"> </span>dfl-pci
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.1<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.1<span class="w"> </span>is<span class="w"> </span><span class="m">183</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/183<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/183<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.2<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w"> </span>Unbinding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.2<span class="w"> </span>from<span class="w"> </span>dfl-pci
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.2<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.2<span class="w"> </span>is<span class="w"> </span><span class="m">184</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/184<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/184<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.3<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="w"> </span>Unbinding<span class="w"> </span><span class="o">(</span>0x1af4,0x1000<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.3<span class="w"> </span>from<span class="w"> </span>virtio-pci
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x1af4,0x1000<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.3<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x1af4,0x1000<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.3<span class="w"> </span>is<span class="w"> </span><span class="m">185</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/185<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/185<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.4<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:<span class="w"> </span>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a><span class="w"> </span>Unbinding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.4<span class="w"> </span>from<span class="w"> </span>dfl-pci
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.4<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.4<span class="w"> </span>is<span class="w"> </span><span class="m">186</span>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/186<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/186<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.5<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:
<a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.5<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-15-55" name="__codelineno-15-55" href="#__codelineno-15-55"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.5<span class="w"> </span>is<span class="w"> </span><span class="m">315</span>
<a id="__codelineno-15-56" name="__codelineno-15-56" href="#__codelineno-15-56"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/315<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-15-57" name="__codelineno-15-57" href="#__codelineno-15-57"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/315<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-15-58" name="__codelineno-15-58" href="#__codelineno-15-58"></a>
<a id="__codelineno-15-59" name="__codelineno-15-59" href="#__codelineno-15-59"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.6<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-15-60" name="__codelineno-15-60" href="#__codelineno-15-60"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:
<a id="__codelineno-15-61" name="__codelineno-15-61" href="#__codelineno-15-61"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.6<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-15-62" name="__codelineno-15-62" href="#__codelineno-15-62"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.6<span class="w"> </span>is<span class="w"> </span><span class="m">316</span>
<a id="__codelineno-15-63" name="__codelineno-15-63" href="#__codelineno-15-63"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/316<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-15-64" name="__codelineno-15-64" href="#__codelineno-15-64"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/316<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-15-65" name="__codelineno-15-65" href="#__codelineno-15-65"></a>
<a id="__codelineno-15-66" name="__codelineno-15-66" href="#__codelineno-15-66"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.7<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-15-67" name="__codelineno-15-67" href="#__codelineno-15-67"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:
<a id="__codelineno-15-68" name="__codelineno-15-68" href="#__codelineno-15-68"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.7<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-15-69" name="__codelineno-15-69" href="#__codelineno-15-69"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.7<span class="w"> </span>is<span class="w"> </span><span class="m">317</span>
<a id="__codelineno-15-70" name="__codelineno-15-70" href="#__codelineno-15-70"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/317<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-15-71" name="__codelineno-15-71" href="#__codelineno-15-71"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/317<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-15-72" name="__codelineno-15-72" href="#__codelineno-15-72"></a>
<a id="__codelineno-15-73" name="__codelineno-15-73" href="#__codelineno-15-73"></a>
<a id="__codelineno-15-74" name="__codelineno-15-74" href="#__codelineno-15-74"></a><span class="c1"># Verify the new AFU is loaded.  The host_chan_mmio AFU GUID is &quot;76d7ae9c-f66b-461f-816a-5428bcebdbc5&quot;.</span>
<a id="__codelineno-15-75" name="__codelineno-15-75" href="#__codelineno-15-75"></a>
<a id="__codelineno-15-76" name="__codelineno-15-76" href="#__codelineno-15-76"></a>$<span class="w"> </span>fpgainfo<span class="w"> </span>port
<a id="__codelineno-15-77" name="__codelineno-15-77" href="#__codelineno-15-77"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-15-78" name="__codelineno-15-78" href="#__codelineno-15-78"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xEC00001
<a id="__codelineno-15-79" name="__codelineno-15-79" href="#__codelineno-15-79"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.0
<a id="__codelineno-15-80" name="__codelineno-15-80" href="#__codelineno-15-80"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-81" name="__codelineno-15-81" href="#__codelineno-15-81"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-15-82" name="__codelineno-15-82" href="#__codelineno-15-82"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-83" name="__codelineno-15-83" href="#__codelineno-15-83"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-15-84" name="__codelineno-15-84" href="#__codelineno-15-84"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-15-85" name="__codelineno-15-85" href="#__codelineno-15-85"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-15-86" name="__codelineno-15-86" href="#__codelineno-15-86"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xE0B1000000000000
<a id="__codelineno-15-87" name="__codelineno-15-87" href="#__codelineno-15-87"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.7
<a id="__codelineno-15-88" name="__codelineno-15-88" href="#__codelineno-15-88"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-89" name="__codelineno-15-89" href="#__codelineno-15-89"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-15-90" name="__codelineno-15-90" href="#__codelineno-15-90"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-91" name="__codelineno-15-91" href="#__codelineno-15-91"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-15-92" name="__codelineno-15-92" href="#__codelineno-15-92"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-15-93" name="__codelineno-15-93" href="#__codelineno-15-93"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>d15ab1ed-0000-0000-0210-000000000000
<a id="__codelineno-15-94" name="__codelineno-15-94" href="#__codelineno-15-94"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-15-95" name="__codelineno-15-95" href="#__codelineno-15-95"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xC0B1000000000000
<a id="__codelineno-15-96" name="__codelineno-15-96" href="#__codelineno-15-96"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.6
<a id="__codelineno-15-97" name="__codelineno-15-97" href="#__codelineno-15-97"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-98" name="__codelineno-15-98" href="#__codelineno-15-98"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-15-99" name="__codelineno-15-99" href="#__codelineno-15-99"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-100" name="__codelineno-15-100" href="#__codelineno-15-100"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-15-101" name="__codelineno-15-101" href="#__codelineno-15-101"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-15-102" name="__codelineno-15-102" href="#__codelineno-15-102"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>d15ab1ed-0000-0000-0110-000000000000
<a id="__codelineno-15-103" name="__codelineno-15-103" href="#__codelineno-15-103"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-15-104" name="__codelineno-15-104" href="#__codelineno-15-104"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xA0B1000000000000
<a id="__codelineno-15-105" name="__codelineno-15-105" href="#__codelineno-15-105"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.5
<a id="__codelineno-15-106" name="__codelineno-15-106" href="#__codelineno-15-106"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-107" name="__codelineno-15-107" href="#__codelineno-15-107"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-15-108" name="__codelineno-15-108" href="#__codelineno-15-108"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-109" name="__codelineno-15-109" href="#__codelineno-15-109"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-15-110" name="__codelineno-15-110" href="#__codelineno-15-110"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-15-111" name="__codelineno-15-111" href="#__codelineno-15-111"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>76d7ae9c-f66b-461f-816a-5428bcebdbc5
<a id="__codelineno-15-112" name="__codelineno-15-112" href="#__codelineno-15-112"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-15-113" name="__codelineno-15-113" href="#__codelineno-15-113"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x80B1000000000000
<a id="__codelineno-15-114" name="__codelineno-15-114" href="#__codelineno-15-114"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.4
<a id="__codelineno-15-115" name="__codelineno-15-115" href="#__codelineno-15-115"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-116" name="__codelineno-15-116" href="#__codelineno-15-116"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-15-117" name="__codelineno-15-117" href="#__codelineno-15-117"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-118" name="__codelineno-15-118" href="#__codelineno-15-118"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-15-119" name="__codelineno-15-119" href="#__codelineno-15-119"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-15-120" name="__codelineno-15-120" href="#__codelineno-15-120"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>44bfc10d-b42a-44e5-bd42-57dc93ea7f91
<a id="__codelineno-15-121" name="__codelineno-15-121" href="#__codelineno-15-121"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-15-122" name="__codelineno-15-122" href="#__codelineno-15-122"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x6098000000000000
<a id="__codelineno-15-123" name="__codelineno-15-123" href="#__codelineno-15-123"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.3
<a id="__codelineno-15-124" name="__codelineno-15-124" href="#__codelineno-15-124"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-125" name="__codelineno-15-125" href="#__codelineno-15-125"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-15-126" name="__codelineno-15-126" href="#__codelineno-15-126"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-127" name="__codelineno-15-127" href="#__codelineno-15-127"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-15-128" name="__codelineno-15-128" href="#__codelineno-15-128"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-15-129" name="__codelineno-15-129" href="#__codelineno-15-129"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>1aae155c-acc5-4210-b9ab-efbd90b970c4
<a id="__codelineno-15-130" name="__codelineno-15-130" href="#__codelineno-15-130"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-15-131" name="__codelineno-15-131" href="#__codelineno-15-131"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x40B1000000000000
<a id="__codelineno-15-132" name="__codelineno-15-132" href="#__codelineno-15-132"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.2
<a id="__codelineno-15-133" name="__codelineno-15-133" href="#__codelineno-15-133"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-134" name="__codelineno-15-134" href="#__codelineno-15-134"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-15-135" name="__codelineno-15-135" href="#__codelineno-15-135"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-136" name="__codelineno-15-136" href="#__codelineno-15-136"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-15-137" name="__codelineno-15-137" href="#__codelineno-15-137"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-15-138" name="__codelineno-15-138" href="#__codelineno-15-138"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>56e203e9-864f-49a7-b94b-12284c31e02b
<a id="__codelineno-15-139" name="__codelineno-15-139" href="#__codelineno-15-139"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-15-140" name="__codelineno-15-140" href="#__codelineno-15-140"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x20B1000000000000
<a id="__codelineno-15-141" name="__codelineno-15-141" href="#__codelineno-15-141"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.1
<a id="__codelineno-15-142" name="__codelineno-15-142" href="#__codelineno-15-142"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-143" name="__codelineno-15-143" href="#__codelineno-15-143"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-15-144" name="__codelineno-15-144" href="#__codelineno-15-144"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-15-145" name="__codelineno-15-145" href="#__codelineno-15-145"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-15-146" name="__codelineno-15-146" href="#__codelineno-15-146"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-15-147" name="__codelineno-15-147" href="#__codelineno-15-147"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>3e7b60a0-df2d-4850-aa31-f54a3e403501
</code></pre></div>
<p>Now, navigate to the directory of the <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> containing the host application's source code, <code>$OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/sw</code>. Once there, compile the <code>host_chan_mmio</code> host application and execute it on the host server to excercise the functionality of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<blockquote>
<p>Note: If <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> libraries were not installed in the default systems directories under <code>/usr</code>, you need to set the <code>OPAE_LOC</code>, <code>LIBRARY_PATH</code>, and <code>LD_LIBRARY_PATH</code> environment variables to the custom locations where the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> libraries were installed.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># Move to the sw directory of the the host_chan_mmio AFU. This directory holds the source for the host application.</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/sw
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_LOC</span><span class="o">=</span>/usr
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">LIBRARY_PATH</span><span class="o">=</span><span class="nv">$OPAE_LOC</span>/lib:<span class="nv">$LIBRARY_PATH</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$OPAE_LOC</span>/lib64:<span class="nv">$LD_LIBRARY_PATH</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>$<span class="w"> </span>make
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="c1"># Run the application</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>$<span class="w">  </span>./host_chan_mmio
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>AFU<span class="w"> </span>ID:<span class="w">  </span>76d7ae9cf66b461f<span class="w"> </span>816a5428bcebdbc5
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>AFU<span class="w"> </span>MMIO<span class="w"> </span>interface:<span class="w"> </span>AXI<span class="w"> </span>Lite
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>AFU<span class="w"> </span>MMIO<span class="w"> </span><span class="nb">read</span><span class="w"> </span>bus<span class="w"> </span>width:<span class="w"> </span><span class="m">64</span><span class="w"> </span>bits
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="m">512</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>write<span class="w"> </span>supported:<span class="w"> </span>yes
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>AFU<span class="w"> </span>pClk<span class="w"> </span>frequency:<span class="w"> </span><span class="m">470</span><span class="w"> </span>MHz
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>Testing<span class="w"> </span><span class="m">32</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>reads:
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">  </span>PASS<span class="w"> </span>-<span class="w"> </span><span class="m">4</span><span class="w"> </span>tests
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>Testing<span class="w"> </span><span class="m">32</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>writes:
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="w">  </span>PASS<span class="w"> </span>-<span class="w"> </span><span class="m">5</span><span class="w"> </span>tests
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>Testing<span class="w"> </span><span class="m">64</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>writes:
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">  </span>PASS<span class="w"> </span>-<span class="w"> </span><span class="m">5</span><span class="w"> </span>tests
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>Testing<span class="w"> </span><span class="m">512</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>writes:
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">  </span>PASS
</code></pre></div>
<h3 id="33-building-and-running-the-hello_world-example-afu"><strong>3.3. Building and running the hello_world example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#33-building-and-running-the-hello_world-example-afu" title="Permanent link">&para;</a></h3>
<p>The platform-independent <a href="https://github.com/OFS/examples-afu.git">examples <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></a> repository also provides some interesting example AFUs. In this section, you will compile and execute the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr> based <code>hello_world</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The RTL of the <code>hello_world</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> receives from the host application an address via memory mapped I/O (<abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>) write and generates a DMA write to the memory line at that address. The content written to memory is the string "Hello world!". The host application spins, waiting for the memory line to be updated. Once available, the software prints out the string.</p>
<p>The <code>hello_world</code> example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> consists of the following files. The <strong>hw</strong> directory contains the RTL to implement the hardware functionality using CCIP, Avalon, and AXI interfaces. However, this guide will use the AXI version of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to go through the compilation steps. The <strong>sw</strong> directory of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> contains the source code of the host application that communicates with the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>hello_world
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>├──<span class="w"> </span>hw
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>│<span class="w">   </span>└──<span class="w"> </span>rtl
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>│<span class="w">       </span>├──<span class="w"> </span>avalon
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>hello_world_avalon.sv
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_plat_afu.sv
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>│<span class="w">       </span>│<span class="w">   </span>└──<span class="w"> </span>sources.txt
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>│<span class="w">       </span>├──<span class="w"> </span>axi
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>hello_world_axi.sv
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_plat_afu.sv
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>│<span class="w">       </span>│<span class="w">   </span>└──<span class="w"> </span>sources.txt
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>│<span class="w">       </span>├──<span class="w"> </span>ccip
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>hello_world_ccip.sv
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>│<span class="w">       </span>│<span class="w">   </span>├──<span class="w"> </span>ofs_plat_afu.sv
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>│<span class="w">       </span>│<span class="w">   </span>└──<span class="w"> </span>sources.txt
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>│<span class="w">       </span>└──<span class="w"> </span>hello_world.json
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>├──<span class="w"> </span>README.md
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>└──<span class="w"> </span>sw
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">    </span>├──<span class="w"> </span>hello_world
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">    </span>├──<span class="w"> </span>hello_world.c
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">    </span>├──<span class="w"> </span>Makefile
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="w">    </span>└──<span class="w"> </span>obj
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">        </span>├──<span class="w"> </span>afu_json_info.h
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">        </span>└──<span class="w"> </span>hello_world.o
</code></pre></div>
<p>The following instructions can be used to compile other <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> samples accompanying this repository.</p>
<ol>
<li>
<p>If not done already, download and clone the <a href="https://github.com/OFS/examples-afu.git">examples <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></a> repository.
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span><span class="w"> </span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/OFS/examples-afu.git
</code></pre></div></p>
</li>
<li>
<p>Compile the <code>hello_word</code> sample <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. 
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/examples-afu/tutorial/afu_types/01_pim_ifc/hello_world
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>$<span class="w"> </span>afu_synth_setup<span class="w"> </span>--source<span class="w"> </span>hw/rtl/axi/sources.txt<span class="w"> </span>build
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>$<span class="w"> </span><span class="si">${</span><span class="nv">OPAE_PLATFORM_ROOT</span><span class="si">}</span>/bin/afu_synth
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>Compiling<span class="w"> </span>ofs_top<span class="w"> </span>ofs_pr_afu
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>Generating<span class="w"> </span>hello_world.gbs
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="o">==================================</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>.
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>.
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>.
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="o">===========================================================================</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w"> </span>PR<span class="w"> </span>AFU<span class="w"> </span>compilation<span class="w"> </span><span class="nb">complete</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w"> </span>AFU<span class="w"> </span>gbs<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span><span class="s1">&#39;hello_world.gbs&#39;</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w"> </span>Design<span class="w"> </span>meets<span class="w"> </span><span class="nv">timing</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="o">===========================================================================</span>
</code></pre></div></p>
</li>
<li>
<p>To test the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> in actual hardware, load the <code>hello_world.gbs</code> to the Intel® FPGA SmartNIC N6001-PL card. For this step to be successful, the PCIe Attach <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> must have already been loaded to the Intel® FPGA SmartNIC N6001-PL card following the steps described in Section 2 of this document.
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/examples-afu/tutorial/afu_types/01_pim_ifc/hello_world/build
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>$<span class="w"> </span>sudo<span class="w"> </span>fpgasupdate<span class="w"> </span>hello_world.gbs<span class="w"> </span>&lt;N6001<span class="w"> </span>SKU2<span class="w"> </span>PCIe<span class="w"> </span>b:d.f&gt;
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">  </span><span class="o">[</span>sudo<span class="o">]</span><span class="w"> </span>password<span class="w"> </span><span class="k">for</span><span class="w"> </span>&lt;&lt;Your<span class="w"> </span>username&gt;&gt;:<span class="w"> </span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="o">[</span><span class="m">2022</span>-04-15<span class="w"> </span><span class="m">20</span>:22:18.85<span class="o">]</span><span class="w"> </span><span class="o">[</span>WARNING<span class="w"> </span><span class="o">]</span><span class="w"> </span>Update<span class="w"> </span>starting.<span class="w"> </span>Please<span class="w"> </span><span class="k">do</span><span class="w"> </span>not<span class="w"> </span>interrupt.
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="o">[</span><span class="m">2022</span>-04-15<span class="w"> </span><span class="m">20</span>:22:19.75<span class="o">]</span><span class="w"> </span><span class="o">[</span>INFO<span class="w">    </span><span class="o">]</span><span class="w"> </span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>Partial<span class="w"> </span>Reconfiguration<span class="w"> </span>OK
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="o">[</span><span class="m">2022</span>-04-15<span class="w"> </span><span class="m">20</span>:22:19.75<span class="o">]</span><span class="w"> </span><span class="o">[</span>INFO<span class="w">    </span><span class="o">]</span><span class="w"> </span>Total<span class="w"> </span>time:<span class="w"> </span><span class="m">0</span>:00:00.90
</code></pre></div></p>
</li>
</ol>
<p>Set up your Intel® FPGA SmartNIC N6001-PL board to work with the newly loaded <code>hello_world.gbs</code> file.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="w"> </span><span class="c1"># For the following example, the Intel® FPGA SmartNIC N6001-PL PCIe b:d.f is assumed to be B1:00.0,</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w"> </span><span class="c1"># however this may be different in your system</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w"> </span><span class="c1"># Create the Virtual Functions (VFs):</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>pci_device<span class="w"> </span>b1:00.0<span class="w"> </span>vf<span class="w"> </span><span class="m">3</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w"> </span><span class="c1"># Verify:</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w"> </span>$<span class="w"> </span>lspci<span class="w"> </span>-s<span class="w"> </span>b1:00
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w"> </span>b1:00.0<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce<span class="w"> </span><span class="o">(</span>rev<span class="w"> </span><span class="m">01</span><span class="o">)</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w"> </span>b1:00.1<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w"> </span>b1:00.2<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w"> </span>b1:00.3<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w"> </span>b1:00.4<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bcce
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w"> </span>b1:00.5<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w"> </span>b1:00.6<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w"> </span>b1:00.7<span class="w"> </span>Processing<span class="w"> </span>accelerators:<span class="w"> </span>Intel<span class="w"> </span>Corporation<span class="w"> </span>Device<span class="w"> </span>bccf
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w"> </span><span class="c1"># Bind VFs to VFIO driver.  Enter &lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.1<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w"> </span>Unbinding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.1<span class="w"> </span>from<span class="w"> </span>dfl-pci
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.1<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.1<span class="w"> </span>is<span class="w"> </span><span class="m">183</span>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/183<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/183<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.2<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="w"> </span>Unbinding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.2<span class="w"> </span>from<span class="w"> </span>dfl-pci
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.2<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.2<span class="w"> </span>is<span class="w"> </span><span class="m">184</span>
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/184<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/184<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a>
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.3<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a><span class="w"> </span>Unbinding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w">  </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.3<span class="w"> </span>from<span class="w"> </span>virtio-pci
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w">  </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.3<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w">  </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.3<span class="w"> </span>is<span class="w"> </span><span class="m">185</span>
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/185<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/185<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a>
<a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.4<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:<span class="w"> </span>
<a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a><span class="w"> </span>Unbinding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:v1:00.4<span class="w"> </span>from<span class="w"> </span>dfl-pci
<a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.4<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbcce<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.4<span class="w"> </span>is<span class="w"> </span><span class="m">186</span>
<a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/186<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/186<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-21-51" name="__codelineno-21-51" href="#__codelineno-21-51"></a>
<a id="__codelineno-21-52" name="__codelineno-21-52" href="#__codelineno-21-52"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.5<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-21-53" name="__codelineno-21-53" href="#__codelineno-21-53"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:
<a id="__codelineno-21-54" name="__codelineno-21-54" href="#__codelineno-21-54"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.5<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-21-55" name="__codelineno-21-55" href="#__codelineno-21-55"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.5<span class="w"> </span>is<span class="w"> </span><span class="m">315</span>
<a id="__codelineno-21-56" name="__codelineno-21-56" href="#__codelineno-21-56"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/315<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-21-57" name="__codelineno-21-57" href="#__codelineno-21-57"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/315<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-21-58" name="__codelineno-21-58" href="#__codelineno-21-58"></a>
<a id="__codelineno-21-59" name="__codelineno-21-59" href="#__codelineno-21-59"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.6<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-21-60" name="__codelineno-21-60" href="#__codelineno-21-60"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:
<a id="__codelineno-21-61" name="__codelineno-21-61" href="#__codelineno-21-61"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.6<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-21-62" name="__codelineno-21-62" href="#__codelineno-21-62"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.6<span class="w"> </span>is<span class="w"> </span><span class="m">316</span>
<a id="__codelineno-21-63" name="__codelineno-21-63" href="#__codelineno-21-63"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/316<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-21-64" name="__codelineno-21-64" href="#__codelineno-21-64"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/316<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-21-65" name="__codelineno-21-65" href="#__codelineno-21-65"></a>
<a id="__codelineno-21-66" name="__codelineno-21-66" href="#__codelineno-21-66"></a><span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>opae.io<span class="w"> </span>init<span class="w"> </span>-d<span class="w"> </span><span class="m">0000</span>:b1:00.7<span class="w"> </span><span class="s">&lt;&lt;Your username&gt;&gt;</span>
<a id="__codelineno-21-67" name="__codelineno-21-67" href="#__codelineno-21-67"></a><span class="s"> [sudo] password for &lt;&lt;Your</span><span class="w"> </span>username&gt;&gt;:
<a id="__codelineno-21-68" name="__codelineno-21-68" href="#__codelineno-21-68"></a><span class="w"> </span>Binding<span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.7<span class="w"> </span>to<span class="w"> </span>vfio-pci
<a id="__codelineno-21-69" name="__codelineno-21-69" href="#__codelineno-21-69"></a><span class="w"> </span>iommu<span class="w"> </span>group<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>0x8086,0xbccf<span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">0000</span>:b1:00.7<span class="w"> </span>is<span class="w"> </span><span class="m">317</span>
<a id="__codelineno-21-70" name="__codelineno-21-70" href="#__codelineno-21-70"></a><span class="w"> </span>Assigning<span class="w"> </span>/dev/vfio/317<span class="w"> </span>to<span class="w"> </span>ceg
<a id="__codelineno-21-71" name="__codelineno-21-71" href="#__codelineno-21-71"></a><span class="w"> </span>Changing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>/dev/vfio/317<span class="w"> </span>to<span class="w"> </span>rw-rw----
<a id="__codelineno-21-72" name="__codelineno-21-72" href="#__codelineno-21-72"></a>
<a id="__codelineno-21-73" name="__codelineno-21-73" href="#__codelineno-21-73"></a><span class="c1"># &lt; Verify the new AFU is loaded.  The hello_world AFU GUID is &quot;c6aa954a-9b91-4a37-abc1-1d9f0709dcc3&quot;.</span>
<a id="__codelineno-21-74" name="__codelineno-21-74" href="#__codelineno-21-74"></a>
<a id="__codelineno-21-75" name="__codelineno-21-75" href="#__codelineno-21-75"></a>$<span class="w"> </span>fpgainfo<span class="w"> </span>port
<a id="__codelineno-21-76" name="__codelineno-21-76" href="#__codelineno-21-76"></a>
<a id="__codelineno-21-77" name="__codelineno-21-77" href="#__codelineno-21-77"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-21-78" name="__codelineno-21-78" href="#__codelineno-21-78"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xEE00000
<a id="__codelineno-21-79" name="__codelineno-21-79" href="#__codelineno-21-79"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.0
<a id="__codelineno-21-80" name="__codelineno-21-80" href="#__codelineno-21-80"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-81" name="__codelineno-21-81" href="#__codelineno-21-81"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-21-82" name="__codelineno-21-82" href="#__codelineno-21-82"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-83" name="__codelineno-21-83" href="#__codelineno-21-83"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-21-84" name="__codelineno-21-84" href="#__codelineno-21-84"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x00
<a id="__codelineno-21-85" name="__codelineno-21-85" href="#__codelineno-21-85"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-21-86" name="__codelineno-21-86" href="#__codelineno-21-86"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xE098000000000000
<a id="__codelineno-21-87" name="__codelineno-21-87" href="#__codelineno-21-87"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.7
<a id="__codelineno-21-88" name="__codelineno-21-88" href="#__codelineno-21-88"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-89" name="__codelineno-21-89" href="#__codelineno-21-89"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-21-90" name="__codelineno-21-90" href="#__codelineno-21-90"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-91" name="__codelineno-21-91" href="#__codelineno-21-91"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-21-92" name="__codelineno-21-92" href="#__codelineno-21-92"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-21-93" name="__codelineno-21-93" href="#__codelineno-21-93"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>d15ab1ed-0000-0000-0210-000000000000
<a id="__codelineno-21-94" name="__codelineno-21-94" href="#__codelineno-21-94"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-21-95" name="__codelineno-21-95" href="#__codelineno-21-95"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xC098000000000000
<a id="__codelineno-21-96" name="__codelineno-21-96" href="#__codelineno-21-96"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.6
<a id="__codelineno-21-97" name="__codelineno-21-97" href="#__codelineno-21-97"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-98" name="__codelineno-21-98" href="#__codelineno-21-98"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-21-99" name="__codelineno-21-99" href="#__codelineno-21-99"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-100" name="__codelineno-21-100" href="#__codelineno-21-100"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-21-101" name="__codelineno-21-101" href="#__codelineno-21-101"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-21-102" name="__codelineno-21-102" href="#__codelineno-21-102"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>d15ab1ed-0000-0000-0110-000000000000
<a id="__codelineno-21-103" name="__codelineno-21-103" href="#__codelineno-21-103"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-21-104" name="__codelineno-21-104" href="#__codelineno-21-104"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xA098000000000000
<a id="__codelineno-21-105" name="__codelineno-21-105" href="#__codelineno-21-105"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.5
<a id="__codelineno-21-106" name="__codelineno-21-106" href="#__codelineno-21-106"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-107" name="__codelineno-21-107" href="#__codelineno-21-107"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCF
<a id="__codelineno-21-108" name="__codelineno-21-108" href="#__codelineno-21-108"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-109" name="__codelineno-21-109" href="#__codelineno-21-109"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-21-110" name="__codelineno-21-110" href="#__codelineno-21-110"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-21-111" name="__codelineno-21-111" href="#__codelineno-21-111"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>c6aa954a-9b91-4a37-abc1-1d9f0709dcc3
<a id="__codelineno-21-112" name="__codelineno-21-112" href="#__codelineno-21-112"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-21-113" name="__codelineno-21-113" href="#__codelineno-21-113"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8098000000000000
<a id="__codelineno-21-114" name="__codelineno-21-114" href="#__codelineno-21-114"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.4
<a id="__codelineno-21-115" name="__codelineno-21-115" href="#__codelineno-21-115"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-116" name="__codelineno-21-116" href="#__codelineno-21-116"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-21-117" name="__codelineno-21-117" href="#__codelineno-21-117"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-118" name="__codelineno-21-118" href="#__codelineno-21-118"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-21-119" name="__codelineno-21-119" href="#__codelineno-21-119"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-21-120" name="__codelineno-21-120" href="#__codelineno-21-120"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>44bfc10d-b42a-44e5-bd42-57dc93ea7f91
<a id="__codelineno-21-121" name="__codelineno-21-121" href="#__codelineno-21-121"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-21-122" name="__codelineno-21-122" href="#__codelineno-21-122"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x6098000000000000
<a id="__codelineno-21-123" name="__codelineno-21-123" href="#__codelineno-21-123"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.3
<a id="__codelineno-21-124" name="__codelineno-21-124" href="#__codelineno-21-124"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-125" name="__codelineno-21-125" href="#__codelineno-21-125"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-21-126" name="__codelineno-21-126" href="#__codelineno-21-126"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-127" name="__codelineno-21-127" href="#__codelineno-21-127"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-21-128" name="__codelineno-21-128" href="#__codelineno-21-128"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-21-129" name="__codelineno-21-129" href="#__codelineno-21-129"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>1aae155c-acc5-4210-b9ab-efbd90b970c4
<a id="__codelineno-21-130" name="__codelineno-21-130" href="#__codelineno-21-130"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-21-131" name="__codelineno-21-131" href="#__codelineno-21-131"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x4098000000000000
<a id="__codelineno-21-132" name="__codelineno-21-132" href="#__codelineno-21-132"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.2
<a id="__codelineno-21-133" name="__codelineno-21-133" href="#__codelineno-21-133"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-134" name="__codelineno-21-134" href="#__codelineno-21-134"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-21-135" name="__codelineno-21-135" href="#__codelineno-21-135"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-136" name="__codelineno-21-136" href="#__codelineno-21-136"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-21-137" name="__codelineno-21-137" href="#__codelineno-21-137"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-21-138" name="__codelineno-21-138" href="#__codelineno-21-138"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>56e203e9-864f-49a7-b94b-12284c31e02b
<a id="__codelineno-21-139" name="__codelineno-21-139" href="#__codelineno-21-139"></a>//******<span class="w"> </span>PORT<span class="w"> </span>******//
<a id="__codelineno-21-140" name="__codelineno-21-140" href="#__codelineno-21-140"></a>Object<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x2098000000000000
<a id="__codelineno-21-141" name="__codelineno-21-141" href="#__codelineno-21-141"></a>PCIe<span class="w"> </span>s:b:d.f<span class="w">                     </span>:<span class="w"> </span><span class="m">0000</span>:B1:00.1
<a id="__codelineno-21-142" name="__codelineno-21-142" href="#__codelineno-21-142"></a>Vendor<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-143" name="__codelineno-21-143" href="#__codelineno-21-143"></a>Device<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0xBCCE
<a id="__codelineno-21-144" name="__codelineno-21-144" href="#__codelineno-21-144"></a>SubVendor<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x8086
<a id="__codelineno-21-145" name="__codelineno-21-145" href="#__codelineno-21-145"></a>SubDevice<span class="w"> </span>Id<span class="w">                     </span>:<span class="w"> </span>0x1771
<a id="__codelineno-21-146" name="__codelineno-21-146" href="#__codelineno-21-146"></a>Socket<span class="w"> </span>Id<span class="w">                        </span>:<span class="w"> </span>0x01
<a id="__codelineno-21-147" name="__codelineno-21-147" href="#__codelineno-21-147"></a>Accelerator<span class="w"> </span>GUID<span class="w">                 </span>:<span class="w"> </span>3e7b60a0-df2d-4850-aa31-f54a3e403501
</code></pre></div>
<ol>
<li>Compile and execute the host application of the <code>hello_world</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. You should see the application outputs the "Hello world!" message in the terminal.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># Move to the sw directory of the hello_world AFU</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/examples-afu/tutorial/afu_types/01_pim_ifc/hello_world/sw
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>$<span class="w"> </span>make
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="c1"># Launch the host application</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>$<span class="w"> </span>./hello_world
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">  </span>Hello<span class="w"> </span>world!
</code></pre></div>
<h3 id="34-modify-the-afu-user-clocks-frequency"><strong>3.4. Modify the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> user clocks frequency</strong><a class="headerlink" href="#34-modify-the-afu-user-clocks-frequency" title="Permanent link">&para;</a></h3>
<p>An OPAE compliant <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> specifies the frequency of the <code>uclk_usr</code> and <code>uclk_usr_div2</code> clocks through the JSON file for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> configuration located under the <code>&lt;afu_example&gt;/hw/rtl</code> directory of an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> design. For instance, the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> configuration file of the <code>host_chan_mmio</code> example is <code>$OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/hw/rtl/host_chan_mmio.json</code>.</p>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> specifies the frequency for uClk_usr in its platform configuration file using the following key:value pairs:</p>
<div class="highlight"><pre><span></span><code>  &quot;clock-frequency-high&quot;: [&lt;float-value&gt;|”auto”|”auto-&lt;float-value&gt;”]
  &quot;clock-frequency-low&quot;: [&lt;float-value&gt;|”auto”|”auto-&lt;float-value&gt;”]
</code></pre></div>
<p>These <code>key:value</code> tuples are used to configure the PLL of the target platform that provides the user clocks through the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> clocks interface. In addition, the specified frequency affects the timing closure process on the user clocks during <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> compilation. </p>
<p>Setting the value field to a float number (e.g., 315.0 to specify 315 MHz) drives the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> generation process to close timing within the bounds set by the low and high values and sets the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>'s JSON metadata to specify the user clock PLL  frequency values.</p>
<p>The following example shows the JSON file of the <code>host_chan_mmio</code> to set the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> uClk to 500 MHz and uClk_div2 to 250 MHz.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>{
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>   &quot;version&quot;: 1,
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>   &quot;afu-image&quot;: {
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>      &quot;power&quot;: 0,
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>      &quot;clock-frequency-high&quot;: 500,
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>      &quot;clock-frequency-low&quot;: 250,
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>      &quot;afu-top-interface&quot;:
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>         {
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>            &quot;class&quot;: &quot;ofs_plat_afu&quot;
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>         },
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>      &quot;accelerator-clusters&quot;:
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>         [
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>            {
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>               &quot;name&quot;: &quot;host_chan_mmio&quot;,
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>               &quot;total-contexts&quot;: 1,
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>               &quot;accelerator-type-uuid&quot;: &quot;76d7ae9c-f66b-461f-816a-5428bcebdbc5&quot;
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>            }
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>         ]
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>   }
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>}
</code></pre></div>
<p>Save the changes to <code>host_chan_mmio.json</code> file, then execute the <code>afu_synth_setup</code> script to create a new copy of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> files with the modified user clock settigns.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/n6001
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/n6001
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>$<span class="w"> </span>afu_synth_setup<span class="w"> </span>-s<span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/hw/rtl/test_mmio_axi1.txt<span class="w"> </span>build_n6001_afu_clks
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>Copying<span class="w"> </span>build<span class="w"> </span>from<span class="w"> </span>/home/&lt;user_area&gt;/ofs-agx7-pcie-attach/work_pr/pr_build_template/hw/lib/build...
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>Configuring<span class="w"> </span>Quartus<span class="w"> </span>build<span class="w"> </span>directory:<span class="w"> </span>build_n6001_afu_clks/build
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>Loading<span class="w"> </span>platform<span class="w"> </span>database:<span class="w"> </span>/home/&lt;user_area&gt;/ofs-agx7-pcie-attach/work_pr/pr_build_template/hw/lib/platform/platform_db/ofs_agilex_adp.json
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>Loading<span class="w"> </span>platform-params<span class="w"> </span>database:<span class="w"> </span>/usr/share/opae/platform/platform_db/platform_defaults.json
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>Loading<span class="w"> </span>AFU<span class="w"> </span>database:<span class="w"> </span>/usr/share/opae/platform/afu_top_ifc_db/ofs_plat_afu.json
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>Writing<span class="w"> </span>platform/platform_afu_top_config.vh
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>Writing<span class="w"> </span>platform/platform_if_addenda.qsf
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>Writing<span class="w"> </span>../hw/afu_json_info.vh
</code></pre></div>
Compile the <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> with the new frequency values.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build_n6001_afu_clks
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>$<span class="w"> </span><span class="nv">$OPAE_PLATFORM_ROOT</span>/bin/afu_synth
</code></pre></div>
<p>During the compilation phase, you will observe the Timing Analyzer uses the specified user clock frequency values as the target to close timing.</p>
<p><a class="glightbox" href="../images/AFU_Dev_Flow.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/AFU_Dev_Flow.png" /></a></p>
<p><a class="glightbox" href="../images/usrclk_timing.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/usrclk_timing.png" /></a></p>
<p><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developers must ensure the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware design meets timing. The compilation of an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that fails timing shows a message similar to the following.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>.
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>.
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>.
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>Wrote<span class="w"> </span>host_chan_mmio.gbs
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="o">===========================================================================</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w"> </span>PR<span class="w"> </span>AFU<span class="w"> </span>compilation<span class="w"> </span><span class="nb">complete</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w"> </span>AFU<span class="w"> </span>gbs<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span><span class="s1">&#39;host_chan_mmio.gbs&#39;</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">  </span>***<span class="w"> </span>Design<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>meet<span class="w"> </span>timing
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">  </span>***<span class="w"> </span>See<span class="w"> </span>build/syn/board/n6001/syn_top/output_files/timing_report
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="o">===========================================================================</span>
</code></pre></div>
<p>The previous output indicates the location of the timing reports for the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> designer to identify the failing paths and perform the necessary design changes. Next, is a listing of the timing report files from a <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> that fails to meet timing after modifying the user clock frequency values.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/n6001/build_n6001_afu_clks
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>$<span class="w"> </span>ls<span class="w"> </span>build/syn/board/n6001/syn_top/output_files/timing_report
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>clocks.rpt<span class="w">  </span>clocks.sta.fail.summary<span class="w">  </span>clocks.sta.pass.summary
</code></pre></div>
<blockquote>
<p><strong>Warning:</strong> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developers must inform software developers of the maximum operating frequency (Fmax) of the user clocks to avoid any unexpected behavior of the accelerator and potentially of the overall system.</p>
</blockquote>
<h2 id="4-simulating-an-afu-using-ase"><strong>4. Simulating an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using ASE</strong><a class="headerlink" href="#4-simulating-an-afu-using-ase" title="Permanent link">&para;</a></h2>
<p>The Application Simulation Environment (ASE) is a hardware/software co-simulation environment for your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. See diagram below illustrating ASE operation:</p>
<p><a class="glightbox" href="../images/ASE_HighLevel.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_HighLevel.png" /></a></p>
<p>ASE uses the simulator Direct Programming Interface (DPI) to provide HW/SW connectivity.  The PCIe connection to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> under testing is emulated with a transactional model.</p>
<p>The following list describes ASE operation:</p>
<ul>
<li>Attempts to replicate the transactions that will be seen in real system.</li>
<li>Provides a memory model to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>, so illegal memory accesses can be identified early.</li>
<li>Not a cache simulator.</li>
<li>Does not guarantee synthesizability or timing closure.</li>
<li>Does not model system latency.</li>
<li>No administrator privileges are needed to run ASE.  All code is user level.</li>
</ul>
<p>The remainder of this section is a tutorial providing the steps on how to run ASE with either Synopsys® VCS® or Siemens® QuestaSim® using an example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> build tree previously created in this guide.</p>
<h3 id="41-set-up-steps-to-run-ase"><strong>4.1. Set Up Steps to Run ASE</strong><a class="headerlink" href="#41-set-up-steps-to-run-ase" title="Permanent link">&para;</a></h3>
<p>In this section you will set up your server to support ASE by independently downloading and installing <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> and ASE. Then, set up the required environment variables.</p>
<h4 id="411-install-opae-sdk"><strong>4.1.1. Install <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr></strong><a class="headerlink" href="#411-install-opae-sdk" title="Permanent link">&para;</a></h4>
<p>Follow the instructions documented in the Getting Started Guide: Open FPGA Stack for Intel® Agilex® 7 FPGAs Targeting the Intel® FPGA SmartNIC N6001-PL, section <a href="https://ofs.github.io/ofs-2023.2/hw/n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/#40-opae-software-development-kit">4.0 OPAE Software Development Kit</a> to build and install the required <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> for the Intel® FPGA SmartNIC N6001-PL card.</p>
<p>The N6001 SKU2 card requires <strong>2.8.0-1</strong>. Follow the instructions provided in the Getting Started Guide: Open FPGA Stack for Intel® Agilex® 7 FPGAs Targeting the Intel® FPGA SmartNIC N6001-PL, section <a href="https://ofs.github.io/ofs-2023.2/hw/n6001/user_guides/ug_qs_ofs_n6001/ug_qs_ofs_n6001/#40-opae-software-development-kit">4.0 OPAE Software Development Kit</a>. However, just make sure to check out the cloned repository to tag <strong>2.8.0-1</strong> and branch <strong>release/2.8.0</strong>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>tags/2.8.0-1<span class="w"> </span>-b<span class="w"> </span>release/2.8.0
</code></pre></div>
<h4 id="412-install-ase-tools"><strong>4.1.2 Install ASE Tools</strong><a class="headerlink" href="#412-install-ase-tools" title="Permanent link">&para;</a></h4>
<p>ASE is an RTL simulator for OPAE-based AFUs. The simulator emulates both the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> software user space API and the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> RTL interface. The majority of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> as well as devices such as PCIe and local memory are emulated with simple functional models.</p>
<p>ASE must be installed separatedly from the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr>. However, the recommendation is to install it in the same target directory as <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr>.</p>
<ol>
<li>
<p>If not done already, set the environment variables as described in section, <a href="#2-set-up-afu-development-environment">Set Up <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Development Environment</a>.</p>
</li>
<li>
<p>Clone the <code>opae-sim</code> repository.
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/OFS/opae-sim.git
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>opae-sim<span class="w">  </span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>tags/2.8.0-1<span class="w"> </span>-b<span class="w"> </span>release/2.8.0
</code></pre></div></p>
</li>
<li>
<p>Create a build directory and build ASE to be installed under the default system directories along with <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr>.
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>$<span class="w"> </span>mkdir<span class="w"> </span>build
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>$<span class="w"> </span>cmake<span class="w">  </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>/usr<span class="w"> </span>..
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>$<span class="w"> </span>make
</code></pre></div></p>
</li>
</ol>
<p>Optionally, if the desire is to install ASE binaries in a different location to the system's default, provide the path to CMAKE through the CMAKE_INSTALL_PREFIX switch, as follows.
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>$<span class="w"> </span>cmake<span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>&lt;&lt;/some/arbitrary/path&gt;&gt;<span class="w"> </span>..<span class="w">  </span>
</code></pre></div></p>
<ol>
<li>Install ASE binaries and libraries under the system directory <code>/usr</code>.
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>$<span class="w"> </span>sudo<span class="w"> </span>make<span class="w"> </span>install<span class="w">  </span>
</code></pre></div></li>
</ol>
<h4 id="413-setup-required-ase-environment-variables"><strong>4.1.3. Setup Required ASE Environment Variables</strong><a class="headerlink" href="#413-setup-required-ase-environment-variables" title="Permanent link">&para;</a></h4>
<p>The values set to the following environment variables assume the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> and ASE were installed in the default system directories below <code>/usr</code>. Setup these variables in the shell where ASE will be executed. You may wish to add these variables to the script you created to facilitate configuring your environment.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OPAE_PLATFORM_ROOT</span><span class="o">=</span>&lt;path<span class="w"> </span>to<span class="w"> </span>PR<span class="w"> </span>build<span class="w"> </span>tree&gt;
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/usr/bin
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PWD</span>:<span class="nv">$PATH</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/usr/lib/python*/site-packages
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$PWD</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/usr/lib
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">LIBRARY_PATH</span><span class="o">=</span><span class="nv">$PWD</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/usr/lib64
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$PWD</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/ofs-platform-afu-bbb
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">OFS_PLATFORM_AFU_BBB</span><span class="o">=</span><span class="nv">$PWD</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">  </span><span class="c1">## For VCS, set the following:</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">VCS_HOME</span><span class="o">=</span>&lt;Set<span class="w"> </span>the<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>VCS<span class="w"> </span>installation<span class="w"> </span>directory&gt;
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$VCS_HOME</span>/bin:<span class="nv">$PATH</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="w">  </span><span class="c1">## For QuestaSIM, set the following:</span>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">MTI_HOME</span><span class="o">=</span>&lt;path<span class="w"> </span>to<span class="w"> </span>Modelsim<span class="w"> </span>installation<span class="w"> </span>directory&gt;
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$MTI_HOME</span>/linux_x86_64/:<span class="nv">$MTI_HOME</span>/bin/:<span class="nv">$PATH</span>
</code></pre></div>
<h3 id="42-simulating-the-host_chan_mmio-afu"><strong>4.2. Simulating the host_chan_mmio <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#42-simulating-the-host_chan_mmio-afu" title="Permanent link">&para;</a></h3>
<p>The <code>$OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio</code> is a simple example demonstrating both hardware and software access to an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The <code>host_chan_mmio</code> example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> consists of the following files:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>host_chan_mmio
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>├── hw
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>│   └── rtl
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>│       ├── avalon
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>│       │   ├── afu_avalon512.sv
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>│       │   ├── afu_avalon.sv
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>│       │   ├── ofs_plat_afu_avalon512.sv
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>│       │   ├── ofs_plat_afu_avalon_from_ccip.sv
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>│       │   └── ofs_plat_afu_avalon.sv
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>│       ├── axi
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>│       │   ├── afu_axi512.sv
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>│       │   ├── afu_axi.sv
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>│       │   ├── ofs_plat_afu_axi512.sv
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>│       │   ├── ofs_plat_afu_axi_from_ccip.sv
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>│       │   └── ofs_plat_afu_axi.sv
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>│       ├── host_chan_mmio.json
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>│       ├── test_mmio_avalon0_from_ccip.txt
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>│       ├── test_mmio_avalon1.txt
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>│       ├── test_mmio_avalon2_512rw.txt
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>│       ├── test_mmio_axi0_from_ccip.txt
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>│       ├── test_mmio_axi1.txt
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a>│       └── test_mmio_axi2_512rw.txt
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>└── sw
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a>    ├── main.c
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a>    ├── Makefile
</code></pre></div>
<p>This example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> contains examples using both Avalon and AXI interface buses. This guide will use the AXI version of the <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>ASE uses client-server application architecture to deliver hardware/software co-simulation.  You require one shell for the hardware based simulation and another shell where the software application is running. The hardware is started first with a simulation compilation and simulator startup script, once the simulator has loaded the design, it will wait until the software process starts. Once the software process starts, the simulator proceeds.  Transaction logging and waveform capture is performed.</p>
<h4 id="421-set-up-and-run-the-hw-simulation-process"><strong>4.2.1 Set Up and Run the HW Simulation Process</strong><a class="headerlink" href="#421-set-up-and-run-the-hw-simulation-process" title="Permanent link">&para;</a></h4>
<p>You will run the <code>afu_sim_setup</code> script to create the scripts for running the ASE environment.  The <code>afu_sim_setup</code> script has the following usage:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>usage: afu_sim_setup [-h] -s SOURCES [-p PLATFORM] [-t {VCS,QUESTA,MODELSIM}]
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>                     [-f] [--ase-mode ASE_MODE] [--ase-verbose]
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>                     dst
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>Generate an ASE simulation environment for an AFU. An ASE environment is
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>instantiated from the OPAE installation and then configured for the specified
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>AFU. AFU source files are specified in a text file that is parsed by
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>rtl_src_config, which is also part of the OPAE base environment.
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>positional arguments:
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>  dst                   Target directory path (directory must not exist).
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>optional arguments:
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>  -h, --help            show this help message and exit
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>  -s SOURCES, --sources SOURCES
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>                        AFU source specification file that will be passed to
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>                        rtl_src_config. See &quot;rtl_src_config --help&quot; for the
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>                        file&#39;s syntax. rtl_src_config translates the source
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>                        list into either Quartus or RTL simulator syntax.
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a>  -p PLATFORM, --platform PLATFORM
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a>                        FPGA Platform to simulate.
<a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>  -t {VCS,QUESTA,MODELSIM}, --tool {VCS,QUESTA,MODELSIM}
<a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a>                        Default simulator.
<a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a>  -f, --force           Overwrite target directory if it exists.
<a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a>  --ase-mode ASE_MODE   ASE execution mode (default, mode 3, exits on
<a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a>                        completion). See ase.cfg in the target directory.
<a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a>  --ase-verbose         When set, ASE prints each CCI-P transaction to the
<a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a>                        command line. Transactions are always logged to
<a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a>                        work/ccip_transactions.tsv, even when not set. This
<a id="__codelineno-35-30" name="__codelineno-35-30" href="#__codelineno-35-30"></a>                        switch sets ENABLE_CL_VIEW in ase.cfg.
</code></pre></div>
<p>Run <code>afu_sim_setup</code> to create the ASE simulation environment for the <code>host_chan_mmio</code> example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The <code>'-t VCS'</code> option indicates to prepare the ASE simulation environment for Synopsys® VCS®.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>$ mkdir -p $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/n6001
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>$ cd $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/n6001
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>$ afu_sim_setup -s $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/hw/rtl/test_mmio_axi1.txt -t VCS simulation
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>Copying ASE from /opae-sdk/install-opae-sdk/share/opae/ase...
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>#################################################################
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>#                                                               #
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>#             OPAE Intel(R) Xeon(R) + FPGA Library              #
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>#               AFU Simulation Environment (ASE)                #
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>#                                                               #
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>#################################################################
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>Tool Brand: VCS
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>Loading platform database: /ofs-agx7-pcie-attach/work_pr/build_tree/hw/lib/platform/platform_db/ofs_agilex_adp.json
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>Loading platform-params database: /usr/share/opae/platform/platform_db/platform_defaults.json
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>Loading AFU database: /usr/share/opae/platform/afu_top_ifc_db/ofs_plat_afu.json
<a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a>Writing rtl/platform_afu_top_config.vh
<a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a>Writing rtl/platform_if_addenda.txt
<a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a>Writing rtl/platform_if_includes.txt
<a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a>Writing rtl/ase_platform_name.txt
<a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a>Writing rtl/ase_platform_config.mk and rtl/ase_platform_config.cmake
<a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a>ASE Platform: discrete (FPGA_PLATFORM_DISCRETE)
</code></pre></div>
<p>The <code>afu_sim_setup</code> creates the ASE scripts in the directory <code>host_chan_mmio_sim</code> where the <code>afu_sim_setup</code> script was run.  Start the simulator as shown below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>simulation
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>$<span class="w"> </span>make
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>$<span class="w"> </span>make<span class="w"> </span>sim
</code></pre></div>
<p>This process launches the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware simulator. Before moving to the next section, pay attention to the simulator output highlighted in the image below.</p>
<p><a class="glightbox" href="../images/ASE_HW.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_HW.png" /></a></p>
<p>The simulation artifacts are stored in host_chan_mmio/work and consist of:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>log_ase_events.tsv
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>log_ofs_plat_host_chan.tsv 
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>log_ofs_plat_local_mem.tsv 
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>log_pf_vf_mux_A.tsv 
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>log_pf_vf_mux_B.tsv 
</code></pre></div>
<h4 id="422-set-up-and-run-the-sw-process"><strong>4.2.2 Set Up and Run the SW Process</strong><a class="headerlink" href="#422-set-up-and-run-the-sw-process" title="Permanent link">&para;</a></h4>
<p>Open an additional shell to build and run the host application that communicates with the actual <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware. Set up the same environment variable you have set up in the shell you have been working on until this point. </p>
<p>Additionally, as indicated by the hardware simulator output that is currently executing in the "simulator shell", copy and paste the line <code>"export ASE_WORKDIR=..."</code>, into the new "software shell". See the last image of the previous section.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">ASE_WORKDIR</span><span class="o">=</span><span class="w"> </span><span class="s">&lt;&lt;as directed in HW simula</span>tion<span class="w"> </span>shell&gt;&gt;
</code></pre></div>
Then, go to the sw directory of the <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> example to compile the host application.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_PLATFORM_AFU_BBB</span>/plat_if_tests/host_chan_mmio/sw<span class="w">  </span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>$<span class="w"> </span>make
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>afu_json_mgr<span class="w"> </span>json-info<span class="w"> </span>--afu-json<span class="o">=</span>../hw/rtl/host_chan_mmio.json<span class="w"> </span>--c-hdr<span class="o">=</span>obj/afu_json_info.h
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>Writing<span class="w"> </span>obj/afu_json_info.h
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>cc<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-std<span class="o">=</span>gnu99<span class="w"> </span>-fstack-protector<span class="w"> </span>-fPIE<span class="w"> </span>-fPIC<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat<span class="w"> </span>-Wformat-security<span class="w"> </span>-I../../common/sw<span class="w"> </span>-I./obj<span class="w"> </span>-c<span class="w"> </span>main.c<span class="w"> </span>-o<span class="w"> </span>obj/main.o
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>cc<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-std<span class="o">=</span>gnu99<span class="w"> </span>-fstack-protector<span class="w"> </span>-fPIE<span class="w"> </span>-fPIC<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat<span class="w"> </span>-Wformat-security<span class="w"> </span>-I../../common/sw<span class="w"> </span>-I./obj<span class="w"> </span>-c<span class="w"> </span>test_host_chan_mmio.c<span class="w"> </span>-o<span class="w"> </span>obj/test_host_chan_mmio.o
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>cc<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-std<span class="o">=</span>gnu99<span class="w"> </span>-fstack-protector<span class="w"> </span>-fPIE<span class="w"> </span>-fPIC<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat<span class="w"> </span>-Wformat-security<span class="w"> </span>-I../../common/sw<span class="w"> </span>-I./obj<span class="w"> </span>-c<span class="w"> </span>../../common/sw/connect.c<span class="w"> </span>-o<span class="w"> </span>obj/connect.o
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>cc<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-std<span class="o">=</span>gnu99<span class="w"> </span>-fstack-protector<span class="w"> </span>-fPIE<span class="w"> </span>-fPIC<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat<span class="w"> </span>-Wformat-security<span class="w"> </span>-I../../common/sw<span class="w"> </span>-I./obj<span class="w"> </span>-c<span class="w"> </span>../../common/sw/csr_mgr.c<span class="w"> </span>-o<span class="w"> </span>obj/csr_mgr.o
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>cc<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-std<span class="o">=</span>gnu99<span class="w"> </span>-fstack-protector<span class="w"> </span>-fPIE<span class="w"> </span>-fPIC<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat<span class="w"> </span>-Wformat-security<span class="w"> </span>-I../../common/sw<span class="w"> </span>-I./obj<span class="w"> </span>-c<span class="w"> </span>../../common/sw/hash32.c<span class="w"> </span>-o<span class="w"> </span>obj/hash32.o
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>cc<span class="w"> </span>-g<span class="w"> </span>-O2<span class="w"> </span>-std<span class="o">=</span>gnu99<span class="w"> </span>-fstack-protector<span class="w"> </span>-fPIE<span class="w"> </span>-fPIC<span class="w"> </span>-D_FORTIFY_SOURCE<span class="o">=</span><span class="m">2</span><span class="w"> </span>-Wformat<span class="w"> </span>-Wformat-security<span class="w"> </span>-I../../common/sw<span class="w"> </span>-I./obj<span class="w"> </span>-c<span class="w"> </span>../../common/sw/test_data.c<span class="w"> </span>-o<span class="w"> </span>obj/test_data.o
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>cc<span class="w"> </span>-o<span class="w"> </span>host_chan_mmio<span class="w"> </span>obj/main.o<span class="w"> </span>obj/test_host_chan_mmio.o<span class="w"> </span>obj/connect.o<span class="w"> </span>obj/csr_mgr.o<span class="w"> </span>obj/hash32.o<span class="w"> </span>obj/test_data.o<span class="w">  </span>-z<span class="w"> </span>noexecstack<span class="w"> </span>-z<span class="w"> </span>relro<span class="w"> </span>-z<span class="w"> </span>now<span class="w"> </span>-pie<span class="w"> </span>-luuid<span class="w"> </span>-lopae-c-ase
</code></pre></div>
<p>Now, launch the host application to exercise the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware running on the simulator shell. The next image shows the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware simulation process on the left side shell. The right hand shell shows the host application's output of a successful simulation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>$<span class="w"> </span>with_ase<span class="w"> </span>./host_chan_mmio
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">  </span><span class="o">[</span>APP<span class="o">]</span><span class="w">  </span>Initializing<span class="w"> </span>simulation<span class="w"> </span>session<span class="w"> </span>...
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>Running<span class="w"> </span><span class="k">in</span><span class="w"> </span>ASE<span class="w"> </span>mode
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>AFU<span class="w"> </span>ID:<span class="w">  </span>76d7ae9cf66b461f<span class="w"> </span>816a5428bcebdbc5
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>AFU<span class="w"> </span>MMIO<span class="w"> </span>interface:<span class="w"> </span>AXI<span class="w"> </span>Lite
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>AFU<span class="w"> </span>MMIO<span class="w"> </span><span class="nb">read</span><span class="w"> </span>bus<span class="w"> </span>width:<span class="w"> </span><span class="m">64</span><span class="w"> </span>bits
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="m">512</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>write<span class="w"> </span>supported:<span class="w"> </span>yes
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>AFU<span class="w"> </span>pClk<span class="w"> </span>frequency:<span class="w"> </span><span class="m">470</span><span class="w"> </span>MHz
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>Testing<span class="w"> </span><span class="m">32</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>reads:
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">  </span>PASS<span class="w"> </span>-<span class="w"> </span><span class="m">4</span><span class="w"> </span>tests
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a>Testing<span class="w"> </span><span class="m">32</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>writes:
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">  </span>PASS<span class="w"> </span>-<span class="w"> </span><span class="m">5</span><span class="w"> </span>tests
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a>
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a>Testing<span class="w"> </span><span class="m">64</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>writes:
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="w">  </span>PASS<span class="w"> </span>-<span class="w"> </span><span class="m">5</span><span class="w"> </span>tests
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a>
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a>Testing<span class="w"> </span><span class="m">512</span><span class="w"> </span>bit<span class="w"> </span>MMIO<span class="w"> </span>writes:
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="w">  </span>PASS
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="w">  </span><span class="o">[</span>APP<span class="o">]</span><span class="w">  </span>Deinitializing<span class="w"> </span>simulation<span class="w"> </span>session
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w">  </span><span class="o">[</span>APP<span class="o">]</span><span class="w">         </span>Took<span class="w"> </span><span class="m">1</span>,003,771,568<span class="w"> </span>nsec
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="w">  </span><span class="o">[</span>APP<span class="o">]</span><span class="w">  </span>Session<span class="w"> </span>ended
</code></pre></div>
<p><a class="glightbox" href="../images/ASE_Run.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_Run.png" /></a>
<br/><br/></p>
<p>Finally, on the hardware simulation shell, you can view the wave forms by invoking the following command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>$<span class="w"> </span>make<span class="w"> </span>wave
</code></pre></div>
<p>This brings up the VCS® simulator GUI and loads the simulation waveform files. Use the Hierarchy window to navigate to the <strong>afu</strong> instance located under, <code>ase_top | ase_top_plat | ase_afu_main_pcie_ss | ase_afu_main_emul | afu_main | port_afu_instances | ofs_plat_afu | afu</code> , as shown below.</p>
<p><a class="glightbox" href="../images/ASE_VCS_hier_2023_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_VCS_hier_2023_2.png" /></a></p>
<p>Right click on the <code>afu (afu)</code> entry to display the drop-down menu. Then, click on <code>Add to Waves | New Wave View</code> to display the following waveforms window.</p>
<p><a class="glightbox" href="../images/ASE_VCS_AFU_Waveforms_2023_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_VCS_AFU_Waveforms_2023_2.png" /></a></p>
<p></br></br></p>
<h3 id="43-simulating-the-hello_world-afu"><strong>4.3 Simulating the hello_world <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#43-simulating-the-hello_world-afu" title="Permanent link">&para;</a></h3>
<p>In this section you will quickly simulate the <abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr>-based <code>hello_world</code> sample <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> accompanying the examples-afu repository.</p>
<ol>
<li>
<p>Set the environment variables as described in section <a href="#41-set-up-steps-to-run-ase">4.1. Set Up Steps to Run ASE</a>.</p>
</li>
<li>
<p>Prepare an RTL simulation environment for the AXI version of the <code>hello_world</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<p>Simulation with ASE requires two software processes, one to simulate the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> RTL and the other to run the host software that excercises the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. To construct an RTL simulation environment under the directory <code>simulation</code>, execute the following.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/examples-afu/tutorial/afu_types/01_pim_ifc/hello_world
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/examples-afu/tutorial/afu_types/01_pim_ifc/hello_world/n6001
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/examples-afu/tutorial/afu_types/01_pim_ifc/hello_world/n6001
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>$<span class="w"> </span>afu_sim_setup<span class="w"> </span>-s<span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/examples-afu/tutorial/afu_types/01_pim_ifc/hello_world/hw/rtl/axi/sources.txt<span class="w"> </span>simulation
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>Copying<span class="w"> </span>ASE<span class="w"> </span>from<span class="w"> </span>/usr/local/share/opae/ase...
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="c1">#################################################################</span>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="c1">#                                                               #</span>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="c1">#             OPAE Intel(R) Xeon(R) + FPGA Library              #</span>
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="c1">#               AFU Simulation Environment (ASE)                #</span>
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="c1">#                                                               #</span>
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="c1">#################################################################</span>
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a>
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a>Tool<span class="w"> </span>Brand:<span class="w"> </span>VCS
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a>Loading<span class="w"> </span>platform<span class="w"> </span>database:<span class="w"> </span>/home/&lt;user_area&gt;/ofs-agx7-pcie-attach/work_pr/pr_build_template/hw/lib/platform/platform_db/ofs_agilex_adp.json
<a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a>Loading<span class="w"> </span>platform-params<span class="w"> </span>database:<span class="w"> </span>/usr/share/opae/platform/platform_db/platform_defaults.json
<a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a>Loading<span class="w"> </span>AFU<span class="w"> </span>database:<span class="w"> </span>/usr/share/opae/platform/afu_top_ifc_db/ofs_plat_afu.json
<a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a>Writing<span class="w"> </span>rtl/platform_afu_top_config.vh
<a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a>Writing<span class="w"> </span>rtl/platform_if_addenda.txt
<a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a>Writing<span class="w"> </span>rtl/platform_if_includes.txt
<a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a>Writing<span class="w"> </span>rtl/ase_platform_name.txt
<a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a>Writing<span class="w"> </span>rtl/ase_platform_config.mk<span class="w"> </span>and<span class="w"> </span>rtl/ase_platform_config.cmake
<a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a>ASE<span class="w"> </span>Platform:<span class="w"> </span>discrete<span class="w"> </span><span class="o">(</span>FPGA_PLATFORM_DISCRETE<span class="o">)</span>
</code></pre></div>
<p>The <code>afu_sim_setup</code> script constructs an ASE environment in the <code>hello_world_sim</code> subdirectory. If the command fails, confirm that the path to the afu_sim_setup is on your PATH environment variable (in the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> bin directory) and that your Python version is at least 2.7.</p>
</li>
<li>
<p>Build and execute the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> RTL simulator.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/examples-afu/tutorial/afu_types/01_pim_ifc/hello_world/n6001/simulation
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>$<span class="w"> </span>make
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>$<span class="w"> </span>make<span class="w"> </span>sim<span class="w">  </span>
</code></pre></div>
<p>The previous commands will build and run the Synopsys® VCS® RTL simulator, which prints a message saying it is ready for simulation. The simulation process also prints a message instructing you to set the ASE_WORKDIR environment variable in a second shell.</p>
</li>
<li>
<p>Open a second shell where you will build and execute the host software. In this new "software shell", set up the environment variables you have set up so far in the "hardware simulation" shell.</p>
</li>
<li>
<p>Also, set the ASE_WORKDIR environment variable following the instructions given in the "hardware simulation" shell.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">ASE_WORKDIR</span><span class="o">=</span><span class="nv">$OFS_BUILD_ROOT</span>/examples-afu/tutorial/afu_types/01_pim_ifc/hello_world/n6001/simulation/work
</code></pre></div>
6. Then, move to the <strong>sw</strong> directory of the <code>hello_world</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> sample to build the host software.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$OFS_BUILD_ROOT</span>/examples-afu/tutorial/afu_types/01_pim_ifc/hello_world/sw
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>$<span class="w"> </span>make<span class="w">      </span>
</code></pre></div>
</li>
<li>
<p>Run the <code>hello_world</code> host application to resume the work of the RTL simulation. The host software process and the RTL simulation execute in lockstep. If successful, you should see the <strong>Hello world!</strong> output.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>$<span class="w"> </span>with_ase<span class="w"> </span>./hello_world
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">  </span><span class="o">[</span>APP<span class="o">]</span><span class="w">  </span>Initializing<span class="w"> </span>simulation<span class="w"> </span>session<span class="w"> </span>...
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>Hello<span class="w"> </span>world!
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">  </span><span class="o">[</span>APP<span class="o">]</span><span class="w">  </span>Deinitializing<span class="w"> </span>simulation<span class="w"> </span>session
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">  </span><span class="o">[</span>APP<span class="o">]</span><span class="w">         </span>Took<span class="w"> </span><span class="m">43</span>,978,424<span class="w"> </span>nsec
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">  </span><span class="o">[</span>APP<span class="o">]</span><span class="w">  </span>Session<span class="w"> </span>ended
</code></pre></div>
<p>The image below shows the simulation of the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> hardware and the execution of the host application side-by-side.</p>
<p></br></p>
</li>
</ol>
<p><a class="glightbox" href="../images/ASE_Run_hello_world.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_Run_hello_world.png" /></a></p>
<p></br></p>
<ol>
<li>
<p>Finally, on the hardware simulation shell, you can view the wave forms by invoking the following command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>make<span class="w"> </span>wave
</code></pre></div>
<p>This brings up the DVE GUI and loads the simulation waveform files. Use the Hierarchy window to navigate to the <strong>afu</strong> instance located under, <code>ase_top | ase_top_plat | ase_afu_main_pcie_ss | ase_afu_main_emul | afu_main | port_afu_instances | ofs_plat_afu | hello_afu</code>, as shown below.</p>
</li>
</ol>
<p><a class="glightbox" href="../images/ASE_VCS_hier_hello_world_2023_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_VCS_hier_hello_world_2023_2.png" /></a></p>
<p>Right click on the <code>hello_afu</code> entry to display the drop-down menu. Then, click on <code>Add to Waves | New Wave View</code> to display the following waveforms window.</p>
<p><a class="glightbox" href="../images/ASE_VCS_AFU_Hello_World_Waveforms_2023_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ASE_VCS_AFU_Hello_World_Waveforms_2023_2.png" /></a></p>
<p></br></br></p>
<h2 id="5-adding-remote-signal-tap-logic-analyzer-to-debug-the-afu"><strong>5. Adding Remote Signal Tap Logic Analyzer to debug the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#5-adding-remote-signal-tap-logic-analyzer-to-debug-the-afu" title="Permanent link">&para;</a></h2>
<p>The <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> provides a remote Signal Tap facility. It also supports the following in system debug tools included with the Intel Quartus Prime Pro Edition:</p>
<ul>
<li>In-system Sources and Probes</li>
<li>In-system Memory Content Editor</li>
<li>Signal Probe</li>
<li>System Console</li>
</ul>
<p>This section is a short guide on adding remote Signal Tap instances to an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> for in system debugging. You can follow the steps in the following sections, in order of execution to create an instrumented <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. The <code>host_chan_mmio</code> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> is used in this guide as the target <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to be instrumented.</p>
<p>You need a basic understanding of Signal Tap. Please see the <a href="https://www.intel.com/content/www/us/en/programmable/support/training/course/odsw1164.html">Signal Tap Logic Analyzer: Introduction &amp; Getting Started</a> Web Based Training for more information.</p>
<p>You will run with a Signal Tap GUI running locally on the server with the Intel® FPGA SmartNIC N6001-PL as shown below:</p>
<p><a class="glightbox" href="../images/RSTP_local.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/RSTP_local.png" /></a></p>
<h3 id="51-adding-rstp-to-the-host_chan_mmio-afu"><strong>5.1. Adding RSTP to the host_chan_mmio <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></strong><a class="headerlink" href="#51-adding-rstp-to-the-host_chan_mmio-afu" title="Permanent link">&para;</a></h3>
<p>RSTP is added to an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> by:</p>
<ol>
<li>Defining signals to be instrumented in Signal Tap.  This creates a new *.stp file.</li>
<li>Modify ofs_top.qpf to include the new *.stp file</li>
<li>Modify ofs_top.qsf</li>
<li>Modify ofs_pr_afu.qsf </li>
<li>Run $OPAE_PLATFORM_ROOT/bin/afu_synth to build the <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>-able image containing the RSTP instance</li>
</ol>
<p>You can use these detailed steps to add Signal Tap to your <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>.</p>
<ol>
<li>
<p>Set path to platform root directory and create the host_chan_mmio <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Quartus project for adding Signal Tap.:
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>$ export OPAE_PLATFORM_ROOT=&lt;path to PR build tree&gt;
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a> # we will now build a new host_chahnel_mmio example based on Signal Tap
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>$ cd $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a>$ mkdir -p $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/n6001
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>$ cd $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/n6001
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>$ afu_synth_setup -s $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/hw/rtl/test_mmio_axi1.txt hardware_stp
</code></pre></div></p>
</li>
<li>
<p>Navigate to host_chan_mmio <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Quartus project and open the project using Quartus GUI.
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>$ cd $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/n6001/hardware_stp/build/syn/board/n6001/syn_top
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>$ quartus ofs_top.qpf &amp;
</code></pre></div></p>
</li>
<li>
<p>Once the project is loaded in Quartus, run Analysis &amp; Synthesis <code>Processing | Start | Start Analysis &amp; Synthesis</code>. When complete, review the project hierarchy as shown in the Project Navigator.  This example will add Signal Tap probe points to the <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region.  Reviewing the code will give insight into the function of this block.  You can bring up the code in the Project Navigator by expanding afu_top - port_gasket - pr_slot - afu_main - port_afu_instances - ofs_plat_afu, then select instance afu, right click, select Locacte Node - Locate in Design File as shown below.
<a class="glightbox" href="../images/stp_proj_nav_2023_1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_proj_nav_2023_1.png" /></a></p>
</li>
<li>
<p>Bring up Signal Tap to create the *.stp file.  In the Quartus GUI, go to Tools - Signal Tap Logic Analyzer.  In the New File from Template pop up, click <code>Create</code> to accept the default template.  The Signal Tap Logic Analyzer window comes up.</p>
</li>
<li>
<p>Set up the clock for the Signal Tap logic instance by clicking <code>...</code> button as shown below:
<a class="glightbox" href="../images/stp_clock.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_clock.png" /></a></p>
</li>
<li>
<p>The Node Finder comes up and you will click <code>...</code> as shown below to bring up the hierarchy navigator:
<a class="glightbox" href="../images/stp_clk_bringup_hier_nav.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_clk_bringup_hier_nav.png" /></a></p>
</li>
<li>
<p>In the Select Hierarchy Level, navigate to top - afu_top - port_gasket - pr_slot - afu_main - port_afu_instances - ofs_plat_afu, then select instance afu and click <code>Ok</code>.</p>
</li>
<li>
<p>Enter <code>*clk*</code> in the <code>Named:</code> box and click <code>Search</code>.  This brings up matching terms.  Click <code>mmio64_if.clk</code> and <code>&gt;</code>.  Verify your Node Finder is as shown below and then click <code>Ok</code>:
<a class="glightbox" href="../images/stp_set_up_clk_2023_1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_set_up_clk_2023_1.png" /></a></p>
</li>
<li>
<p>Double click the <code>Double-click to add nodes</code> and once again, click <code>...</code> and navigate to top - afu_top - port_gasket - pr_slot - afu_main - port_afu_instances - ofs_plat_afu, then select instance afu and click <code>Ok</code>.  Enter <code>mmio64_reg*</code> and click <code>Search</code>. Then click <code>&gt;&gt;</code> to add these signals to the STP instance as shown below:
<a class="glightbox" href="../images/stp_sig_select_2023_1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_sig_select_2023_1.png" /></a></p>
<p>Then click <code>Insert</code> and <code>Close</code>.
<a class="glightbox" href="../images/stp_final_setup_2023_1.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_final_setup_2023_1.png" /></a></p>
</li>
<li>
<p>Save the newly created STP by clicking <code>File - Save As</code> and in the save as navigate to $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/n6001/hardware_stp/build/syn/board/n6001/syn_top and save the STP file as <code>host_chan_mmio.stp</code> as shown below:</p>
</li>
</ol>
<p><a class="glightbox" href="../images/stp_save_stp_2023_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_save_stp_2023_2.png" /></a></p>
<p>Select <code>Yes</code> when asked to add host_chan_mmio.stp to current project.  Close Signal Tap window.</p>
<ol>
<li>Edit <code>ofs_top.qsf</code> to add host_chan_mmio.stp file and enable STP.  Open $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/n6001/hardware_stp/build/syn/board/n6001/syn_top/ofs_top.qsf in an editor and add the lines shown below:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>set_global_assignment -name ENABLE_SIGNALTAP ON
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>set_global_assignment -name USE_SIGNALTAP_FILE host_chan_mmio.stp
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>set_global_assignment -name SIGNALTAP_FILE host_chan_mmio.stp
</code></pre></div>
<p>And also ensure "INCLUDE_REMOTE_STP" is enabled in <code>ofs_top.qsf</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a># At most one of INCLUDE_REMOTE_STP and INCLUDE_JTAG_PR_STP should be
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a># set. If both are defined, JTAG-based SignalTap takes precedence.
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a># Remote STP uses mmlink. JTAG_PR_STP is on node 0 of the FPGA chain.
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>set_global_assignment -name VERILOG_MACRO &quot;INCLUDE_REMOTE_STP&quot;       # Includes Remote SignalTap support in PR Region
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>#set_global_assignment -name VERILOG_MACRO &quot;INCLUDE_JTAG_PR_STP&quot;      # Includes JTAG-based SignalTap via programming cable in the PR region
</code></pre></div>
<p>Save the ofs_top.qsf.</p>
<ol>
<li>Edit <code>ofs_pr_afu.qsf</code> to add host_chan_mmio.stp file and enable STP.  Open $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/n6001/hardware_stp/build/syn/board/n6001/syn_top/ofs_pr_afu.qsf in an editor and add the lines shown below:</li>
</ol>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>set_global_assignment -name VERILOG_MACRO &quot;INCLUDE_REMOTE_STP&quot;
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>set_global_assignment -name ENABLE_SIGNALTAP ON
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>set_global_assignment -name USE_SIGNALTAP_FILE host_chan_mmio.stp
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>set_global_assignment -name SIGNALTAP_FILE host_chan_mmio.stp
</code></pre></div>
Save the ofs_pr_afu.qsf and close Quartus.</p>
<ol>
<li>The host_chan_mmio <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Quartus project is ready to be built.  In your original build shell enter the following commands:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>$ cd $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/n6001/hardware_stp
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>$ $OPAE_PLATFORM_ROOT/bin/afu_synth
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>...
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>...
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>Wrote host_chan_mmio.gbs
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a>===========================================================================
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a> PR AFU compilation complete
<a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a> AFU gbs file is &#39;host_chan_mmio.gbs&#39;
<a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a>  Design meets timing
<a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a>===========================================================================
</code></pre></div>
<ol>
<li>Once compilation completes, the new host_chan_mmio.gbs file that contains the Signal Tap instance can be loaded.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a> # For the following example, the N6001 SKU2 PCIe b:d.f is assumed to be b1:00.0,
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a> # however this may be different in your system
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a># Enusre FIM is loading prior to loading AFU
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a># Load AFU
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>$ sudo fpgasupdate host_chan_mmio.gbs b1:00.0
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a>[2021-12-04 07:16:59,101] [WARNING ] Update starting. Please do not interrupt.
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>[2021-12-04 07:16:59,740] [INFO    ] 
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a>Partial Reconfiguration OK
</code></pre></div>
<ol>
<li>Use the <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> mmlink tool to create a TCP/IP connection to your Intel Agilex card under test.  The mmlink command has the following format:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>Usage:
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>mmlink
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>&lt;Segment&gt;             --segment=&lt;SEGMENT NUMBER&gt;
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>&lt;Bus&gt;                 --bus=&lt;BUS NUMBER&gt;           OR  -B &lt;BUS NUMBER&gt;
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>&lt;Device&gt;              --device=&lt;DEVICE NUMBER&gt;     OR  -D &lt;DEVICE NUMBER&gt;
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>&lt;Function&gt;            --function=&lt;FUNCTION NUMBER&gt; OR  -F &lt;FUNCTION NUMBER&gt;
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>&lt;Socket-id&gt;           --socket-id=&lt;SOCKET NUMBER&gt;  OR  -S &lt;SOCKET NUMBER&gt;
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>&lt;TCP PORT&gt;            --port=&lt;PORT&gt;                OR  -P &lt;PORT&gt;
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>&lt;IP ADDRESS&gt;          --ip=&lt;IP ADDRESS&gt;            OR  -I &lt;IP ADDRESS&gt;
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>&lt;Version&gt;             -v,--version Print version and exit
</code></pre></div>
<p>Enter the command below to create a connection using port 3333:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>$ sudo mmlink -P 3333 -B 0xb1
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a> ------- Command line Input START ----
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a> Socket-id             : -1
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a> Port                  : 3333
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a> IP address            : 0.0.0.0
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a> ------- Command line Input END   ----
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>PORT Resource found.
<a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>Server socket is listening on port: 3333
</code></pre></div>
<p>Leave this shell open with the mmlink connection.</p>
<ol>
<li>In this step you will open a new shell and enable <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> over protocol.  You must have Quartus 23.2 Programmer loaded on the N6001 server for local debugging.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>$ jtagconfig --add JTAG-over-protocol sti://localhost:0/intel/remote-debug/127.0.0.1:3333/0
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a># Verify connectivity with jtagconfig --debug
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>$ jtagconfig --debug
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>1) JTAG-over-protocol [sti://localhost:0/intel/remote-debug/127.0.0.1:3333/0]
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>   (JTAG Server Version 21.4.0 Build 67 12/06/2021 SC Pro Edition)
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>    020D10DD   VTAP10 (IR=10)
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a>    Design hash    86099113E08364C07CC4
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a>    + Node 00406E00  Virtual JTAG #0
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a>
<a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a>  Captured DR after reset = (020D10DD) [32]
<a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a>  Captured IR after reset = (155) [10]
<a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a>  Captured Bypass after reset = (0) [1]
<a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a>  Captured Bypass chain = (0) [1]
</code></pre></div>
<ol>
<li>Start Quartus Signal Tap GUI, connect to target, load stp file by navigating to $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/n6001/hardware_stp/build/syn/board/n6001/syn_top. The Quartus Signal Tap must be the same version of Quartus used to compile the host_chan_mmio.gbs. Quartus Prime Pro Version 23.2 is used in the steps below:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>$ cd $OFS_PLATFORM_AFU_BBB/plat_if_tests/host_chan_mmio/n6001/hardware_stp/build/syn/board/n6001/syn_top
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>$ quartus_stpw host_chan_mmio.stp &amp;
</code></pre></div>
<p>This command brings up Signal Tap GUI. Connect to the Signal Tap over protocol by selecting the <code>Hardware</code> button on the right side of the GUI and click the "Please Select" pull down as shown below:</p>
<p><a class="glightbox" href="../images/ST_HW_Select.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ST_HW_Select.png" /></a></p>
<p><abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> over protocol selected:</p>
<p><a class="glightbox" href="../images/ST_JTAG_Selected.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/ST_JTAG_Selected.png" /></a></p>
<p>This connection process will take approximately 2-3 minutes for the Signal Tap instance to indicate "Ready to acquire".</p>
<ol>
<li>
<p>Set the trigger condition for a rising edge on signal <code>awvalid</code> signal.</p>
</li>
<li>
<p>In the Signal Tap window, enable acquisition by pressing key <code>F5</code>, the Signal Tap GUI will indicate "Acquisition in progress". Create and bind the VFs, then run the host_chan_mmio application following <a href="#32-loading-and-running-hostchanmmio-example-afu">3.2. Loading and Running host_chan_mmio example <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></a>, and observe that the Signal Tap instance has triggered. You should see signals being captured in the Signaltap GUI.</p>
</li>
</ol>
<p>See captured image below:</p>
<p><a class="glightbox" href="../images/stp_data_2023_2.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="../images/stp_data_2023_2.png" /></a></p>
<p>To end your Signal Tap session, close the Signal Tap GUI, then in the mmlink shell, enter <code>ctrl c</code> to kill the mmlink process.<br />
To remove the <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> over protocol connection:
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a># This is assuming the JTAG over protocol is instance &#39;1&#39;, as shown during jtagconfig --debug
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>$ jtagconfig --remove 1
</code></pre></div></p>
<h2 id="6-how-to-modify-the-pfvf-mux-configuration"><strong>6. How to modify the PF/VF MUX configuration</strong><a class="headerlink" href="#6-how-to-modify-the-pfvf-mux-configuration" title="Permanent link">&para;</a></h2>
<p>For information on how to modify the PF/VF mapping for your own design, refer to the <a href="https://ofs.github.io/ofs-2023.2/hw/n6001/dev_guides/fim_dev/ug_dev_fim_ofs_n6001/">FPGA Interface Manager Developer Guide for Intel® Agilex® 7 PCIe Attach</a>.</p>
<!-- include ./docs/hw/n6001/doc_modules/links.md -->

<h2 id="notices-disclaimers">Notices &amp; Disclaimers<a class="headerlink" href="#notices-disclaimers" title="Permanent link">&para;</a></h2>
<p>Intel<sup>&reg;</sup> technologies may require enabled hardware, software or service activation.
No product or component can be absolutely secure. 
Performance varies by use, configuration and other factors.
Your costs and results may vary. 
You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Intel products described herein. You agree to grant Intel a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.
No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document, with the sole exception that you may publish an unmodified copy. You may create software implementations based on this document and in compliance with the foregoing that are intended to execute on the Intel product(s) referenced in this document. No rights are granted to create modifications or derivatives of this document.
The products described may contain design defects or errors known as errata which may cause the product to deviate from published specifications.  Current characterized errata are available on request.
Intel disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.
You are responsible for safety of the overall system, including compliance with applicable safety-related requirements or standards. 
<sup>&copy;</sup> Intel Corporation.  Intel, the Intel logo, and other Intel marks are trademarks of Intel Corporation or its subsidiaries.  Other names and brands may be claimed as the property of others. </p>
<p>OpenCL and the OpenCL logo are trademarks of Apple Inc. used by permission of the Khronos Group™. </p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.copy", "navigation.indexes", "toc.follow"], "search": "../../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "ofs-2023.1", "provider": "mike"}}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>