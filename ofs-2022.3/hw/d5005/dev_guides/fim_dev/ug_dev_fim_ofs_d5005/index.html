
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../reference_manuals/ofs_fim/mnl_fim_ofs_d5005/">
      
      
        <link rel="next" href="../../afu_dev/ug_dev_afu_d5005/">
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.9">
    
    
      
        <title>FPGA Interface Manager Developer Guide - OFS</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intel-fpga-interface-manager-developer-guide-open-fpga-stack-for-intel-stratix-10-fpga" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="OFS" class="md-header__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OFS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FPGA Interface Manager Developer Guide
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../.." class="md-tabs__link">
      Welcome
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-tabs__link md-tabs__link--active">
        Stratix 10 OFS Hardware Docs
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../sw/fpga_api/quick_start/readme/" class="md-tabs__link">
        OFS Software
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="OFS" class="md-nav__button md-logo" aria-label="OFS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OFS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ofs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Stratix 10 OFS Hardware Docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Stratix 10 OFS Hardware Docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_eval_ofs_d5005/ug_eval_script_ofs_d5005/" class="md-nav__link">
        Quick Start Evaluation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../common/reference_manual/ofs_sw/mnl_sw_ofs/" class="md-nav__link">
        Software Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference_manuals/ofs_fim/mnl_fim_ofs_d5005/" class="md-nav__link">
        FPGA Interface Manager Technical Reference Manual
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        FPGA Interface Manager Developer Guide
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../afu_dev/ug_dev_afu_d5005/" class="md-nav__link">
        AFU Developer Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          OFS Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          OFS Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          OPAE USER GUIDES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          OPAE USER GUIDES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/quick_start/readme/" class="md-nav__link">
        Quick Start Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/install_guide/installation_guide/" class="md-nav__link">
        OPAE Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/prog_guide/readme/" class="md-nav__link">
        OPAE C API Programming Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://opae.github.io/latest/docs/pyopae/README.html" class="md-nav__link">
        OPAE Python Bindings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/plug_guide/readme/" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          OPAE LIBRARIES
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          OPAE LIBRARIES
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://opae.github.io/latest/docs/fpga_api/fpga_api.html" class="md-nav__link">
        OPAE C API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://opae.github.io/latest/docs/fpga_api/fpga_cxx_api.html" class="md-nav__link">
        OPAE C++ Core API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://opae.github.io/latest/docs/fpga_api/fpga_python_api.html" class="md-nav__link">
        OPAE Python API Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_api/plug_guide/readme/" class="md-nav__link">
        OPAE Plugin Developers Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          OPAE LINUX KERNEL DRIVERS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          OPAE LINUX KERNEL DRIVERS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/drv_arch/drv_arch/" class="md-nav__link">
        Open Programmable Accelerator Engine (OPAE) Linux Device Driver Architecture
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          OPAE FPGA TOOLS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          OPAE FPGA TOOLS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgaconf/fpgaconf/" class="md-nav__link">
        fpgaconf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgainfo/fpgainfo/" class="md-nav__link">
        fpgainfo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgasupdate/fpgasupdate/" class="md-nav__link">
        fpgasupdate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mmlink/mmlink/" class="md-nav__link">
        mmlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/packager/packager/" class="md-nav__link">
        packager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/userclk/userclk/" class="md-nav__link">
        userclk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi/hssi/" class="md-nav__link">
        hssi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/pci_device/pci_device/" class="md-nav__link">
        pci_device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opae.io/opae.io/" class="md-nav__link">
        opae.io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/rsu/rsu/" class="md-nav__link">
        rsu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/host_exerciser/host_exerciser/" class="md-nav__link">
        host_exerciser
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssistats/" class="md-nav__link">
        HSSI ethernet statistics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssimac/" class="md-nav__link">
        HSSI ethernet mac
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/hssi_ethernet/hssiloopback/" class="md-nav__link">
        HSSI ethernet loopback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/mem_tg/mem_tg/" class="md-nav__link">
        mem_tg
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/vabtool/vabtool/" class="md-nav__link">
        vabtool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaevfio/opaevfio/" class="md-nav__link">
        opaevfio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/ofs.uio/ofs.uio/" class="md-nav__link">
        ofs.uio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/opaeuio/opaeuio/" class="md-nav__link">
        opaeuio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgad/fpgad/" class="md-nav__link">
        fpgad
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../sw/fpga_tools/fpgadiag/" class="md-nav__link">
        fpgadiag
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="intel-fpga-interface-manager-developer-guide-open-fpga-stack-for-intel-stratix-10-fpga">Intel® FPGA Interface Manager Developer Guide: Open FPGA Stack for Intel® Stratix 10® FPGA</h1>
<h1 id="1-introduction">1. Introduction</h1>
<h2 id="11-about-this-document">1.1. About This Document</h2>
<p>This document serves as a design guide for FPGA developers, system architects and hardware developers using <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> as a starting point for the creating the FPGA Interface Manager (<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>) for a custom FPGA acceleration board or Platform with Intel FPGAs.</p>
<p>This development guide is organized as follows: </p>
<ul>
<li>Introduction</li>
<li>Top Level Block Diagram description</li>
<li>Control and data flow</li>
<li>Description of Subsystems</li>
<li>Command/status registers (CSR) and software interface</li>
<li>Clocking, resets and interfaces</li>
<li>High speed interface (HSSI)</li>
<li>External attached memory</li>
<li>High Level development flow description</li>
<li>Installation of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> RTL and development packages</li>
<li>Compiling <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></li>
<li>Simulation  </li>
<li>Demonstration steps illustrating how to change areas of the design</li>
<li>Debugging using <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr></li>
</ul>
<p>This document uses the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 as an example platform to illustrate key points and demonstrate how to extend the capabilities provided in <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> (Open FPGA Stack) to custom platforms. The demonstration steps serves as a tutorial for the development of your <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> knowledge.</p>
<p>This document covers <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> architecture lightly.  For more details on the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> architecture, please see <a href="https://ofs.github.io/hw/d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/">Open FPGA Stack Technical Reference Manual</a>.</p>
<p>You are encouraged to read <a href="https://ofs.github.io/hw/d5005/dev_guides/afu_dev/ug_dev_afu_d5005/"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Development Guide</a> to fully understand how <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Developers will use your newly developed <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.</p>
<h1 id="glossary">Glossary</h1>
<table>
<thead>
<tr>
<th>Term</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr></td>
<td>Advanced Error Reporting, The PCIe <abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr> driver is the extended PCI Express error reporting capability providing more robust error reporting.</td>
</tr>
<tr>
<td><abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></td>
<td>Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region is the part of the design where an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may reside. This <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> may or may not be a partial reconfiguration region</td>
</tr>
<tr>
<td><abbr title="Basic Building Block, Features within an AFU or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the FIM's AFU and host interface requires. All BBBs must have a (globally unique identifier) GUID.">BBB</abbr></td>
<td>Basic Building Block, Features within an <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> or part of an FPGA interface that can be reused across designs. These building blocks do not have stringent interface requirements like the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>'s <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and host interface requires. All BBBs must have a (globally unique identifier) GUID.</td>
</tr>
<tr>
<td><abbr title="Best Known Configuration, The exact hardware configuration Intel has optimized and validated the solution against.">BKC</abbr></td>
<td>Best Known Configuration, The exact hardware configuration Intel has optimized and validated the solution against.</td>
</tr>
<tr>
<td><abbr title="Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA PAC platform. Supports features such as power sequence management and board monitoring through on-board sensors.">BMC</abbr></td>
<td>Board Management Controller, Acts as the Root of Trust (RoT) on the Intel FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> platform. Supports features such as power sequence management and board monitoring through on-board sensors.</td>
</tr>
<tr>
<td>CSR</td>
<td>Command/status registers (CSR) and software interface, <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> uses a defined set of CSR's to expose the functionality of the FPGA to the host software.</td>
</tr>
<tr>
<td><abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr></td>
<td>Device Feature List, A concept inherited from <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>. The <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> drivers provide support for FPGA devices that are designed to support the Device Feature List. The <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr> driver to automatically load the drivers required for a given FPGA configuration.</td>
</tr>
<tr>
<td><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></td>
<td>FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> resides in the static region of the FPGA and contains the FPGA Management Engine (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>) and I/O ring.</td>
</tr>
<tr>
<td><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr></td>
<td>FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.</td>
</tr>
<tr>
<td><abbr title="Host Exerciser Module, Host exercisers are used to exercise and characterize the various host-FPGA interactions, including Memory Mapped Input/Output (MMIO), data transfer from host to FPGA, PR, host to FPGA memory, etc.">HEM</abbr></td>
<td>Host Exerciser Module, Host exercisers are used to exercise and characterize the various host-FPGA interactions, including Memory Mapped Input/Output (<abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr>), data transfer from host to FPGA, <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr>, host to FPGA memory, etc.</td>
</tr>
<tr>
<td>Intel FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005</td>
<td>Intel FPGA Programmable Acceleration Card D5005, A high performance PCI Express (PCIe)-based FPGA acceleration card for data centers. This card is the target platform for the initial <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> release.</td>
</tr>
<tr>
<td><abbr title="Intel Virtualization Technology for Directed I/O, Extension of the VT-x and VT-I processor virtualization technologies which adds new support for I/O device virtualization.">Intel VT-d</abbr></td>
<td>Intel Virtualization Technology for Directed I/O, Extension of the VT-x and VT-I processor virtualization technologies which adds new support for I/O device virtualization.</td>
</tr>
<tr>
<td><abbr title="Input/Output Control, System calls used to manipulate underlying device parameters of special files.">IOCTL</abbr></td>
<td>Input/Output Control, System calls used to manipulate underlying device parameters of special files.</td>
</tr>
<tr>
<td><abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr></td>
<td>Joint Test Action Group, Refers to the IEEE 1149.1 <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> standard; Another FPGA configuration methodology.</td>
</tr>
<tr>
<td><abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr></td>
<td>Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.</td>
</tr>
<tr>
<td><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr></td>
<td>Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> and software developers to optimize and reuse their designs.</td>
</tr>
<tr>
<td><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr></td>
<td>Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.</td>
</tr>
<tr>
<td><abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr></td>
<td>Programmable Acceleration Card: FPGA based Accelerator card</td>
</tr>
<tr>
<td><abbr title="Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that AFU developers can use to handle clock crossing, response sorting, buffering and different protocols.">PIM</abbr></td>
<td>Platform Interface Manager, An interface manager that comprises two components: a configurable platform specific interface for board developers and a collection of shims that <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> developers can use to handle clock crossing, response sorting, buffering and different protocols.</td>
</tr>
<tr>
<td><abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr></td>
<td>Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr>, a <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> bitstream refers to an Intel FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>. Refer to <a href="https://www.intel.com/content/www/us/en/programmable/products/design-software/fpga-design/quartus-prime/features/partial-reconfiguration.html">Partial Reconfiguration</a> support page.</td>
</tr>
<tr>
<td><abbr title="Remote System Update, A Remote System Update operation sends an instruction to the Intel FPGA PAC D5005 device that triggers a power cycle of the card only, forcing reconfiguration.">RSU</abbr></td>
<td>Remote System Update, A Remote System Update operation sends an instruction to the Intel FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 device that triggers a power cycle of the card only, forcing reconfiguration.</td>
</tr>
<tr>
<td><abbr title="Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.">SR-IOV</abbr></td>
<td>Single-Root Input-Output Virtualization, Allows the isolation of PCI Express resources for manageability and performance.</td>
</tr>
<tr>
<td><abbr title="Testbench, Testbench or Verification Environment is used to check the functional correctness of the Design Under Test (DUT) by generating and driving a predefined input sequence to a design, capturing the design output and comparing with-respect-to expected output.">TB</abbr></td>
<td>Testbench, Testbench or Verification Environment is used to check the functional correctness of the Design Under Test (DUT) by generating and driving a predefined input sequence to a design, capturing the design output and comparing with-respect-to expected output.</td>
</tr>
<tr>
<td><abbr title="Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.">UVM</abbr></td>
<td>Universal Verification Methodology, A modular, reusable, and scalable testbench structure via an API framework.</td>
</tr>
<tr>
<td><abbr title="Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.">VFIO</abbr></td>
<td>Virtual Function Input/Output, An IOMMU/device agnostic framework for exposing direct device access to userspace.</td>
</tr>
</tbody>
</table>
<h2 id="12-introduction">1.2. Introduction</h2>
<p>Open FPGA Stack (<abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>) addresses the scalability for FPGA acceleration boards and workloads by providing a powerful and systematic methodology for the rapid development of FPGA-based Acceleration systems.  This methodology addresses the key challenges of hardware, software and workload developers by providing a complete FPGA project consisting of RTL and simulation code, build scripts and software. The FPGA project released in <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> can be rapidly customized to meet new market requirements by adding new features, custom IPs and Intel interface subsystems IPs. </p>
<p>A high-level overview of the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Intel® Stratix 10® FPGA hardware architecture on the Intel® Stratix 10® FPGA reference platform, Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 is shown in the below figure. The provided FPGA architecture is divided into two main components 
   - The outer area in white, the FPGA Interface manager (or <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>)
   - The inner area in green, the Acceleration Function Unit or <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Region. </p>
<p>The outer area, the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, provides the core infrastructure and interfaces within the FPGA. The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region is where a user’s custom logic would reside for their specific workload. 
  * FPGA external interfaces and IP cores (e.g. Ethernet, DDR-4, PCIe, etc)
  * PLLs/resets
  * FPGA - Board management infrastructure
  * Interface to Acceleration Function Unit (<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>)</p>
<p>The <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> region has both static and dynamic partial reconfiguration regions enabling a lot of customization. 
  * Uses the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> interfaces to perform useful work inside the FPGA
  * Contains logic supporting partial reconfiguration
  * Remote Signal Tap core for remote debugging of workload</p>
<p>Outside of the FPGA is the Board Management Controller which provides board management, root of trust, board monitoring, and remote system updates. </p>
<p>The overall architecture is built to be very composable and modular in blocks that can be modified while leaving the rest of the infrastructure intact so you may only need to modify a few of these blocks. </p>
<p><img alt="s10-arch" src="../images/s10_arch.png" /></p>
<h2 id="12-release-capabilities">1.2. Release Capabilities</h2>
<p>This release of <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> supports the following key features:</p>
<ul>
<li>1 - Host channel interface via PCIe Gen 3 x 16 SRIOV (1PF, 3 VF, AXI-S TLP packets)</li>
<li>DDR4 SDRAM External memory interface (AXI-M)</li>
<li>1 - 10G Ethernet interfaces (1x10G)</li>
<li>MSI-X Interrupts (PF, VF)</li>
<li>1 - <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></li>
<li>Exercisers demonstrating PCIe, external memory and Ethernet interfaces</li>
<li>Port, <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> CSR</li>
<li>Remote Signal Tap</li>
</ul>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> is extensible to meet the needs of a broad set of customer applications, however not all use cases are easily served.  The general uses cases listed below are examples where the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> base design can be easily re-used to build a custom <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>:
1. Use <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> reference design as-is
    - Porting the code to another platform that is identical to the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> reference platform only changing target FPGA device and pinout
    - Change I/O assignments without changing design
2. Update the configuration of peripheral IP in <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> reference design, not affecting <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> architecture
    - External memory settings
    - HSSI analog settings
3. Remove/update peripheral feature in <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> reference design, not affecting <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> architecture
    - External memory speed/width change
    - Change 10G Ethernet to 25 or 100G Ethernet IP
    - Change number of VFs supported
4. Add new features as an extension to <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> reference design, not affecting <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> architecture
    - Add/remove external memory interface to the design
    - Add/remove user clocks for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr>
    - Add/remove IP to the design with connection to <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr></p>
<p>More advanced use cases requiring changes or additions to the host PCIe channel are not easily supported with this release of the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.</p>
<p>Reuse of the provided host management FPGA logic and software is the fastest and most simple approach to <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> customization.</p>
<h2 id="13-prerequisites">1.3. Prerequisites</h2>
<h3 id="131-base-knowledge-and-skills-prerequisites">1.3.1. Base Knowledge and Skills Prerequisites</h3>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> is an advanced application of FPGA technology. This guide assumes you have the following FPGA logic design-related knowledge and skills:</p>
<ul>
<li>FPGA compilation flows using Intel<sup>&reg;</sup> Quartus<sup>&reg;</sup> Prime Pro Edition design flow.</li>
<li>Static Timing closure, including familiarity with the Timing Analyzer tool in Intel<sup>&reg;</sup> Quartus<sup>&reg;</sup> Prime Pro Edition, applying timing constraints, Synopsys* Design Constraints (.sdc) language and Tcl scripting, and design methods to close on timing critical paths.</li>
<li>RTL and coding practices for FPGA implementation.</li>
<li>RTL simulation tools.</li>
<li>Intel<sup>&reg;</sup> Quartus<sup>&reg;</sup> Prime Pro Edition Signal Tap Logic Analyzer tool software.</li>
</ul>
<h3 id="132-development-environment">1.3.2. Development Environment</h3>
<p>To run the tutorial steps in this guide requires this development environment:</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>Intel Quartus Prime Pro</td>
<td>Intel Quartus Prime Pro 22.3 (with license patch)</td>
</tr>
<tr>
<td>Target D5005 Sever Operating System</td>
<td>RHEL 8.2</td>
</tr>
<tr>
<td><abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr></td>
<td><a href="https://github.com/OFS/opae-sdk/releases/tag/2.3.0-1">2.3.0-1 </a></td>
</tr>
<tr>
<td>Linux <abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr></td>
<td><a href="https://github.com/OFS/linux-dfl/releases/tag/ofs-2022.3-2">ofs-2022.3-2</a></td>
</tr>
<tr>
<td>Python</td>
<td>3.7.7</td>
</tr>
<tr>
<td>cmake</td>
<td>3.11.4</td>
</tr>
<tr>
<td>GCC</td>
<td>7.2.0</td>
</tr>
<tr>
<td>perl</td>
<td>5.8.8</td>
</tr>
</tbody>
</table>
<p>The following server and Intel <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> card are required to run the examples in this guide:</p>
<ol>
<li>Qualified Intel Xeon <sup>&reg;</sup> server see <a href="https://www.intel.com/content/www/us/en/products/details/fpga/platforms/pac/d5005/view.html">Qualified Servers</a>.</li>
<li>Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 with root entry hash erased (Please contact Intel for root entry hash erase instructions).  The standard Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 card is programmed to only allow the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> binary files signed by Intel to be loaded.  The root entry hash erase process will allow newly created, unsigned <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> binary files to be loaded.</li>
<li>Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 installed in the qualified server following instructions in <a href="https://ofs.github.io/hw/d5005/user_guides/ug_qs_ofs_d5005/ug_qs_ofs_d5005/"><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Getting Started User Guide</a>.</li>
</ol>
<p>The steps included in this guide have been verified in the Dell R740 and HPE ProLiant DL380 Gen10 servers.</p>
<h1 id="2-high-level-description">2. High Level Description</h1>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> targets operation in the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 card.  The block diagram of the D5005 is shown below:</p>
<p><img alt="Intel® FPGA PAC D5005" src="../images/d5005_Top_block_diagram.PNG" /></p>
<p>The key D5005 FPGA interfaces are:</p>
<ul>
<li>Host interface <ul>
<li>PCIe Gen3 x 16</li>
</ul>
</li>
<li>Network interface</li>
<li>2 - QSFP28 cages</li>
<li>Current <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> supports 1 x 10 GbE, other interfaces can be created  </li>
<li>External Memory</li>
<li>2 or 4 channels of DDR4-2400 to RDIMM modules</li>
<li>RDIMM modules =  8GB organized as 1 Gb X 72</li>
<li>Board Management</li>
<li>SPI interface</li>
<li>FPGA configuration</li>
</ul>
<h2 id="21-fpga-interface-manager-overview">2.1. FPGA Interface Manager Overview</h2>
<p>The FPGA Interface Manager architecture is shown in the below diagram:</p>
<p><img alt="OFS FIM Top Level Block Diagram" src="../images/Top_Rel1.png" /></p>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> consists of the following components
   - PCIe Subsystem
   - Memory Subsystem
   - HSSI Subsystem
   - Platform Management Component Intercommunications (PMCI) 
   - Board Peripheral Fabric (BPF) 
   - <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> Peripheral Fabric (APF)
   - Port Gasket
   - AXI-S PF/VF Demux/Mux
   - Host Exerciser Modules - HE-MEM, HE-LB, HE-HSSI
   - FPGA Management Engine (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>)</p>
<h2 id="22-fim-fpga-resource-usage">2.2. <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> FPGA Resource Usage</h2>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> uses a small portion of the available FPGA resources.  The table below shows resource usage for a base <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> built with 2 channels of external memory, a small <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> instantiated that has host CSR read/write, external memory test and Ethernet test functionality.</p>
<p><br></p>
<table>
<thead>
<tr>
<th>Entity</th>
<th>ALMs Used</th>
<th>% ALMS Used</th>
<th>M20Ks</th>
<th>% M20Ks used</th>
<th>DSP Blocks</th>
<th>Pins</th>
<th>IOPLLs</th>
</tr>
</thead>
<tbody>
<tr>
<td>OFS_top</td>
<td>125009.4</td>
<td>13.0%</td>
<td>661</td>
<td>5.4%</td>
<td>0</td>
<td>630</td>
<td>15</td>
</tr>
<tr>
<td>afu_top</td>
<td>70522.7</td>
<td>7.0%</td>
<td>228</td>
<td>2.4%</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>auto_fab_0</td>
<td>1305.7</td>
<td>0.0%</td>
<td>9</td>
<td>0.1%</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>bpf_rsv_5_slv</td>
<td>0.6</td>
<td>0.0%</td>
<td>0</td>
<td>0.0%</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>bpf_rsv_6_slv</td>
<td>0.6</td>
<td>0.0%</td>
<td>0</td>
<td>0.0%</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>bpf_rsv_7_slv</td>
<td>0.4</td>
<td>0.0%</td>
<td>0</td>
<td>0.0%</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>bpf</td>
<td>241.9</td>
<td>0.0%</td>
<td>0</td>
<td>0.0%</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>emif_top_inst</td>
<td>10508.6</td>
<td>1.0%</td>
<td>0</td>
<td>0.0%</td>
<td>0</td>
<td>0</td>
<td>12</td>
</tr>
<tr>
<td>eth_ac_wrapper</td>
<td>6024.8</td>
<td>0.5%</td>
<td>9</td>
<td>0.1%</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>fme_top</td>
<td>615.5</td>
<td>0.2%</td>
<td>7</td>
<td>0.1%</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>pcie_wrapper</td>
<td>35424.7</td>
<td>3.5%</td>
<td>348</td>
<td>2.9%</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>pmci_top</td>
<td>318.5</td>
<td>0.1%</td>
<td>0</td>
<td>0.0%</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>rst_ctrl</td>
<td>40.2</td>
<td>0.0%</td>
<td>0</td>
<td>0.0%</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>sys_pll</td>
<td>0.5</td>
<td>0.0%</td>
<td>0</td>
<td>0.0%</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Total ALMS</td>
<td>933,120</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Total M20Ks</td>
<td>11,721</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Summary</th>
<th>FPGA Resource Utilization</th>
</tr>
</thead>
<tbody>
<tr>
<td>Logic utilization (in ALMs)</td>
<td>124,092 / 933,120 ( 13 % )</td>
</tr>
<tr>
<td>Total dedicated logic registers</td>
<td>282822</td>
</tr>
<tr>
<td>Total pins</td>
<td>630 / 912 ( 69 % )</td>
</tr>
<tr>
<td>Total block memory bits</td>
<td>3,425,120 / 240,046,080 ( 1 % )</td>
</tr>
<tr>
<td>Total RAM Blocks</td>
<td>661 / 11,721 ( 6 % )</td>
</tr>
<tr>
<td>Total DSP Blocks</td>
<td>0 / 5,760 ( 0 % )</td>
</tr>
<tr>
<td>Total eSRAMs</td>
<td>0 / 75 ( 0 % )</td>
</tr>
<tr>
<td>Total HSSI P-Tiles</td>
<td>17 / 48 ( 35 % )</td>
</tr>
<tr>
<td>Total HSSI E-Tile Channels</td>
<td>17 / 48 ( 35 % )</td>
</tr>
<tr>
<td>Total HSSI HPS</td>
<td>0 / 1 ( 0 % )</td>
</tr>
<tr>
<td>Total HSSI EHIPs</td>
<td>0 / 2 ( 0 % )</td>
</tr>
<tr>
<td>Total PLLs</td>
<td>36 / 104 ( 35 % )</td>
</tr>
</tbody>
</table>
<h2 id="23-ofs-directory-structure">2.3. <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Directory Structure</h2>
<p>The <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Git <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> repository ofs-d5005 directory structure is shown below:</p>
<p><br></p>
<p>```bash session
├── eval_script
|   ├── ofs_d5005_eval.sh
|   └── README_ofs_d5005_eval.txt
├── ipss
│   ├── hssi
|   ├── mem
|   ├── pcie
|   ├── pmci
|   ├── spi
|   └── README.md
├── license
│   └── quartus-0.0-0.01Intel <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>-linux.run
├── ofs-common
|   ├── scripts
|   ├── src
|   ├── verification
|   ├── LICENSE.txt
|   └── README.md
├── sim
|   ├── bfm
|   ├── rp_bfm
│   ├── scripts
|   ├── unit_test 
│   └── readme.txt
├── src
│   ├── afu_top
│   ├── includes
│   ├── pd_qsys
│   ├── README.md
│   └── top
├── syn
│   ├── scripts
│   ├── setup
│   ├── syn_top
│   ├── readme.txt
│   └── README
├── LICENSE.txt
└── README.md
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>The contents of each directory are described below:
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>**Eval Script** - Contains scripts for evaluation of OFS for D5005 including compiling FIM/AFU from source, unit level test. Also includes resources to report and setup D5005 development environment
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>**ipss** - Contains the code and supporting files that define or set up the IP subsystems (HSSI, PCIe, memory, PMCI, SPI, etc...) contained in the D5005 FPGA Interface Manager (FIM).   
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>**license** - License file for the Low Latency 10Gbps Ethernet MAC (6AF7 0119) IP core.
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>**ofs-common** - This directory contains resources that may be used across the board-specific repositories. This directory is referenced via a link within each of the FPGA-specific repositories.
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>**sim** - Contains the testbenches and supporting code for all the unit test simulations. 
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>   - Bus Functional Model code is contained here.
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>   - Scripts are included for automating a myriad of tasks.
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>   - All of the individual unit tests and their supporting code is also located here.
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>**src** - SystemVerilog source and script files  
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>   - Contains all of the structural and behavioral code for the FIM.
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>   - Scripts for generating the AXI buses for module interconnect.
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>   - Top-level RTL for synthesis is located in this directory.
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>   - Accelerated Functional Unit (AFU) infrastructure code is contained in this directory.
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>**syn** - This directory contains all of the scripts, settings, and setup files for running synthesis on the FIM.
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a># 3. Description of Sub-Systems
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>## 3.1. Host Control and Data Flow
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>The host control and data flow are shown in the diagram below:
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>![OFS FIM Top Level Block Diagram](images/FIM_data_flow.png)
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>The control and data flow is composed of the following:
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>* Host Interface Adapter (PCIe)
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>* Low Performance Peripherals
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>  * Slow speed peripherals (I2C, Smbus, etc)
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>  * Management peripherals (FME)
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>* High Performance Peripherals
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>  * Memory peripherals
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>  * Acceleration Function peripherals
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>  * HPS Peripheral
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>* Fabrics
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>   * Peripheral Fabric (multi drop)
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>   * AFU Streaming fabric (point to point)
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>Peripherals are connected to one another using AXI:
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>* Via the peripheral fabric (AXI4-Lite, multi drop)
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>* Via the AFU streaming fabric (AXI-S, point to point)
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>Peripherals are presented to software as:
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>* OFS managed peripherals that implement DFH CSR structure.  
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a>* Native driver managed peripherals (i.e. Exposed via an independent PF, VF)
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a>The peripherals connected to the peripheral fabric are primarily Intel OPAE managed resources, whereas the peripherals connected to the AFU are “primarily” managed by native OS drivers. The word “primarily” is used since the AFU is not mandated to expose all its peripherals to Intel OPAE. It can be connected to the peripheral fabric, but can choose to expose only a subset of its capability to Intel OPAE.
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a>OFS uses a defined set of CSRs to expose the functionality of the FPGA to the host software.  These registers are described in [Open FPGA Stack Reference Manual - MMIO Regions section].
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a>If you make changes to the FIM that affect the software operation, then OFS provides a mechanism to communicate that information to the proper software driver.  The [Device Feature Header (DFH) structure] provides a mechanism to maintain compatibility with OPAE software.  Please see [FPGA Device Feature List (DFL) Framework Overview] for an excellent description of DFL operation from the driver perspective.
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>When you are planning your address space for your FIM updates, please be aware that the OFS FIM targeting Intel® FPGA PAC D5005, 256KB of MMIO region is allocated for external FME features and 128kB of MMIO region is allocated for external port features. Each external feature must implement a feature DFH, and the DFH needs to be placed at 4KB boundary. The last feature in the external feature list must have the EOL bit in its DFH set to 1 to mark the end of external feature list.  Since the FPGA address space is limited, consider using an indirect addressing scheme to conserve address space.
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a># 4. FIM Development Flow
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a>OFS provides a framework of FPGA synthesizable code, simulation environment, and synthesis/simulation scripts.  FIM designers can take the provided code and scripts and modify existing code or add new code to meet their specific product requirements.
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a>FIM development for a new acceleration card consists of the following steps:
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a>1. Installation of OFS and familiarization with scripts and source code
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a>1. Development of high-level block diagram with your specific functionality
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a>    1. Determination of requirements and key performance metrics
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a>    1. Selection of IP cores
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a>    1. Selection of FPGA device
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a>    2. Software memory map
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a>2. Selection and implementation of FIM Physical interfaces including:
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a>    1. External clock sources and creation of internal PLL clocks
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a>    2. General I/O
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a>    3. Transceivers
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a>    4. External memories
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a>    5. FPGA programming methodology
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a>3. Device physical implementation
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a>    1. FPGA device pin assignment
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a>    2. Inclusion of logic lock regions
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a>    3. Creation of timing constraints
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a>    4. Create Quartus FIM test project and validate:
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a>        1. Placement
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a>        2. Timing constraints
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a>        3. Build script process
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a>        4. Review test FIM FPGA resource usage
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a>4. Select FIM to AFU interfaces and development of PIM
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a>5. FIM design implementation
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a>    1. RTL coding
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a>    2. IP instantiation
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a>    3. Development of test AFU to validate FIM
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a>    4. Unit and device level simulation
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a>    5. Timing constraints and build scripts
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a>    6. Timing closure and build validation
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a>6. Creation of FIM documentation to support AFU development and synthesis
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a>7. Software Device Feature discovery
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a>8. Hardware/software integration, validation and debugging
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a>9.  High volume production preparation
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a>The FIM developer works closely with the hardware design of the target board, software development and system validation.
<a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a>Understanding how the AFU developer utilizes the FIM is important for FIM development success.  Please read [OFS AFU Development Guide] for a detailed description of AFU development.
<a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a>## 4.1. Installation of OFS
<a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a>In this section you set up a development machine for compiling the OFS FIM. These steps are separate from the setup for a deployment machine where the FPGA acceleration card is installed.  Typically, FPGA development and deployment work is performed on separate machines, however, both development and deployment can be performed on the same server if desired.  Please see [OFS Getting Started User Guide] for instructions on installing software for deployment of your FPGA FIM, AFU and software application on a server.  
<a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a>Building the OFS FIM requires the development machine to have at least 64 GB of RAM.
<a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a>The following is a summary of the steps to set up for FIM development:
<a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a>1. Install Quartus Prime Pro 22.3 Linux and setup environment
<a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a>2. Clone the github `ofs-d5005` repository
<a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a>3. Test installation by building the provided FIM
<a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a>Intel Quartus Prime Pro version 22.3 is the currently verified version of Quartus used for building the FIM and AFU images for this release.  Porting to newer versions of Quartus may be performed by developers.  Download Quartus Prime Pro Linux version 22.3 from [Intel® Quartus® Prime Pro Edition Linux].
<a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a>After running the Quartus Prime Pro installer, set the PATH environment variable to make utilities `quartus`, `jtagconfig`, and `quartus_pgm` discoverable. Edit your bashrc file `~/.bashrc` to add the following line:
<a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a>```bash session
<a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a>export PATH=$PATH:&lt;Quartus install directory&gt;/quartus/bin
</code></pre></div></p>
<p>For example, if the Quartus install directory is /home/intelFPGA_pro/22.3 then the new line is:</p>
<p><code>bash session
export PATH=$PATH:/home/intelFPGA_pro/22.3/quartus/bin
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Verify, Quartus is discoverable by opening a new shell:
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>```bash session
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>which quartus
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>## Output
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>/home/intelFPGA_pro/22.3/quartus/bin/quartus
</code></pre></div>
Note, for some Linux distributions such as RHEL 8.2, Quartus requires installation of the following libraries:</code>bash session
sudo dnf install libnsl
sudo dnf install ncurses-compat-libs
sudo ln -s /usr/bin/python3 /usr/bin/python
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>You will need to obtain a license for Intel Quartus Prime Pro version 22.3 to compile the design.  This license is obtained from Intel.  Additionally, OFS for Intel® Stratix 10® FPGA requires a license for the Low Latency 10Gbps Ethernet MAC (6AF7 0119) IP core.  This license is required to generate a programming file using the provided OFS source code.  The Low Latency 10Gbps Ethernet MAC (6AF7 0119) IP core license patch installer is provided in the ofs-d5005 git repository in the /license directory.  After cloning the OFS release in step 4 below, you can install this IP license.  
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>3. Install git and install git lfs to extract large files within the repository that are compressed with git lfs.  Please note, for proper operation of files retrieved from OFS repository, you will require git lfs. 
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>```bash session
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>sudo dnf install git
</code></pre></div>
   ## Install git lfs:
```bash session
curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.rpm.sh | sudo bash
sudo dnf install git-lfs
git lfs install
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>4. Retrieve OFS repositories:
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>The OFS FIM source code is included in the GitHub repository. Create a new directory to use as a clean starting point to store the retrieved files.  
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>1. Navigate to location for storage of OFS source, create the top-level source directory and clone OFS repositories.
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>```bash session
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>mkdir OFS_fim_build_root
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>cd OFS_fim_build_root
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>export OFS_BUILD_ROOT=$PWD
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>git clone --recurse-submodules  https://github.com/OFS/ofs-d5005.git
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>cd ofs-d5005
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>git checkout tags/ofs-d5005-1.0.1
</code></pre></div>
Verify proper tag is selected:</p>
<p>```bash session <br />
git describe --tags
ofs-d5005-1.0.1
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>2. Install the Low Latency 10Gbps Ethernet MAC (6AF7 0119) IP license by running provided license installer.
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>```bash session
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>cd license
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>chmod +x quartus-0.0-0.01Intel OFS-linux.run
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>sudo ./quartus-0.0-0.01Intel OFS-linux.run
</code></pre></div></p>
<ol>
<li>Verify patch installed
```bash session
quartus_sh --version</li>
</ol>
<h2 id="output">Output</h2>
<p>Quartus Prime Shell
Version 22.3 Pro Edition
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>## 4.2. Compiling OFS FIM
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>OFS provides a build script with the following FPGA image creation options:
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>* Flat compile which combines the FIM and AFU into one FPGA image that is loaded into the entire FPGA device
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>* A PR compile which creates a FPGA image consisting of the FIM that is loaded into the static region of the FPGA and a default AFU that is loaded into dynamic region. Additional AFUs maybe loaded into the dynamic region using partial reconfiguration.
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>The build scripts included with OFS are verified to run in a bash shell. Other shells have not been tested. Each build script step will take several hours to completes, Please note, building directly in Quartus GUI is not supported - you must build with the provided scripts.
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>The following sections describe how to set up the environment and build the provided FIM and AFU. Follow these steps as a tutorial to learn the build flow. You will use this environment and build scripts for the creation of your specialized FIM.
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>### 4.2.1. Setting Up Required Environment Variables
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>Set required environment variables as shown below. These environment variables must be set prior to simulation or compilation tasks so creating a simple script to set these variables saves time.
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>```bash session
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>cd $OFS_BUILD_ROOT/ofs-d5005
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>export OFS_ROOTDIR=$PWD
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>##   *Note, OFS_ROOTDIR is the directory where you cloned the repo, e.g. /home/MyProject/ofs-d5005 *
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>export WORKDIR=$OFS_ROOTDIR
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>export VERDIR=$OFS_ROOTDIR/verification
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>export QUARTUS_HOME=$QUARTUS_ROOTDIR
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>##   *Note, QUARTUS_ROOTDIR is your Quartus installation directory, e.g. $QUARTUS_ROOTDIR/bin contains Quartus executuable*
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>export QUARTUS_INSTALL_DIR=$QUARTUS_ROOTDIR
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>export IMPORT_IP_ROOTDIR=$QUARTUS_ROOTDIR/../ip
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>export IP_ROOTDIR=$QUARTUS_ROOTDIR/../ip
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>export OPAE_SDK_REPO_BRANCH=release/2.3.0
</code></pre></div></p>
<h3 id="422-compiling">4.2.2. Compiling</h3>
<p>The usage of the compile build script is shown below:
```bash session
ofs-common/scripts/common/syn/build_top.sh [-p] target_configuration work_dir 
Usage: ofs-common/scripts/common/syn/build_top.sh [-k] [-p] <build target> [<work dir name>]</p>
<p>Build a <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> instance specified by <build target>. The target names an FPGA architecture, board and configuration.</p>
<p>The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> is built in <work dir name>. If not specified, the target is ${OFS_ROOTDIR}/work.</p>
<p>The -k option preserves and rebuilds within an existing work tree instead of overwriting it.</p>
<p>When -p is set, if the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> is able then a partial reconfiguration template tree is generated at the end of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> build. The <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> template tree is located in the top of the work directory but is relocatable
  and uses only relative paths. See syn/common/scripts/generate_pr_release.sh for details.</p>
<p>The -e option runs only Quartus analysis and elaboration.</p>
<div class="highlight"><pre><span></span><code>  * target_configuration - Specifies the project  
     For example: d5005

  * work_dir - Work Directory for this build in the form a directory name. It is created in the &lt;local repo directory&gt;/ofs-d5005/&lt;work_dir&gt; 
      - NOTE: The directory name must start with &quot;work&quot;.  If the work directory exists, then the script stops and asks if you want to overwrite the directory.
        - e.g.
            - ofs-common/scripts/common/syn/build_top.sh d5005 work_d5005

            work directory as a name will be created in &lt;local repo directory&gt;/ofs-d5005/work_d5005


            The obmission of &lt;work_dir&gt; results in a default work directory (&lt;local repo  directory&gt;/ofs-d5005/work)

    - compile reports and artifacts (.rpt, .sof, etc) are stored in &lt;work_dir&gt;/syn/syn_top/output_files

    - There is a log file created in ofs-d5005 directory.  
    - [-p]  Optional switch for creation of a relocatable PR build tree supporting the creation of a PR-able AFU workload.   
    The &quot;-p&quot; switch invokes generate_pr_release.sh at the end of the FIM build and writes the PR build tree to the top of the work directory.  More information on this option is provided below.
</code></pre></div>
<p><code>In the next example, you will build the provided example design using a flat, non-PR build flow.


 Build the provided base example design:</code>bash session
cd $OFS_BUILD_ROOT/ofs-d5005

ofs-common/scripts/common/syn/build_top.sh d5005 work_d5005
 <code></code>bash session
    ... build takes ~5 hours to complete

Compile work directory:     &lt;$OFS_BUILD_ROOT&gt;/work_d5005/syn/syn_top
Compile artifact directory: &lt;$OFS_BUILD_ROOT&gt;/work_d5005/syn/syn_top/output_files</p>
<hr />
<hr />
<p><strong><em>        OFS_PROJECT: d5005
</em></strong>        Q_PROJECT:  d5005
<strong><em>        Q_REVISION: d5005
</em></strong>        SEED: 03
<strong><em>        Build Complete
</em></strong>        Timing Passed!</p>
<hr />
<hr />
<p>```
The build script copies the ipss, sim, src and syn directories to the specified work directory and then these copied files are used in the Quartus compilation process.  Do not edit the files in the work directory, these files are copies of source files.</p>
<p>Some of the key files are described below:</p>
<p><work_dir>/syn/syn_top == 
```bash session
├── syn_top                    // D5005 Quartus build area with Quartus files used this build
│  ├── d5005.ipregen.rpt       // IP regeneration report states the output of IP upgrade
│  ├── d5005.qpf               // Quartus Project File (qpf) mentions about Quartus version and project revision
│  ├── d5005.qsf               // Quartus Settings File (qsf) lists current project settings and entity level assignments
│  ├── d5005.stp               // Signal Tap file included in the d5005.qsf. This file can be modified as required if you need to add an Signal Tap instance
│  ├── fme_id.mif              // the fme id hex value is stored in a mif file format
│  ├── Intel OFS_pr_afu.json        // <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> JSON file
│  ├── Intel OFS_pr_afu.qsf                // <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> qsf file
│  ├── Intel OFS_pr_afu_sources.tcl        // <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> source file list
│  ├── ip_upgrade_port_diff_reports   // IP upgrade report files for reference
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>&lt;work_dir&gt;/syn/syn_top/output_files == Directory with build reports and FPGA programming files. 
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>The programming files consist of the Quartus generated d5005.sof and d5005.pof.  The D5005 board hardware provides a 2 Gb flash device to store the FPGA programming files and a MAX10 BMC that reads this flash and programs the D5005 Intel® Stratix 10® FPGA FPGA. The syn/build_top.sh script runs script file syn/syn_top/build_flash/build_flash.s which takes the Quartus generated d5005.sof and creates binary files in the proper format to be loaded into the 2 Gb flash device.  You can also run build_flash.sh by yourself if needed.  The build_flash  script runs PACSign (if installed) to create an unsigned FPGA programming file that can be stored in the D5005 FPGA flash. Please note, if the D5005 has the root entry hash key loaded, then PACsign must be run with d5005_page1.bin as the input with the proper key to create an authenticated FPGA binary file.  Please see [Security User Guide: Intel® Open FPGA Stack for Intel® Stratix 10® FPGA] for details on the security aspects of Intel® Open FPGA Stack.
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>The following table provides further detail on the generated bin files.
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>| File            | Description                        |
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>|-----------------|------------------------------------|
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>| d5005.sof | This is the Quartus generated programming file created by Quartus synthesis and place and route.  This file can be used to programming the FPGA using a JTAG programmer.  This file is used as the source file for the binary files used to program the FPGA flash. |
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>| d5005.bin |  This is an intermediate raw binary image of the FPGA  |
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>| d5005_page1.bin | This is the binary file created from input file, d5005.sof.  This file is used as the input file to the PACSign utility to generate **d5005_page1_unsigned.bin** binary image file. |
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>| d5005_page1_unsigned.bin | This is the unsigned PACSign output which can be programmed into the FPGA flash of an unsigned D5005 usign the OPAE SDK utility **fpgasupdate**  |
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>| mfg_d5005_reversed.bin | A special programming file for a third party programming device used in board manufacturing.  This file is typically not used.|
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>build/output_files/timing_report == Directory containing clocks report, failing paths and passing margin reports
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>### 4.2.3. Relocatable PR Directory Tree
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>If you are developing a FIM to be used by another team developing the AFU workload, scripts are provided that create a relocatable PR directory tree. ODM and board developers will make use of this capability to enable a broad set of AFUs to be loaded on a board using PR.  The relocatable PR directory contains the Quartus *.qdb file that goes the FIM.
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>The creation of the relocatable PR directory tree requires a clone of the Intel Basic Building Blocks (BBB) repository. The OFS_PLATFORM_AFU_BBB environment variable must point to the repository, for example.
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>```bash session
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>cd $OFS_BUILD_ROOT
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>git clone https://github.com/OPAE/ofs-platform-afu-bbb
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>cd ofs-platform-afu-bbb
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>export OFS_PLATFORM_AFU_BBB=$PWD
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>cd $OFS_ROOTDIR
</code></pre></div></p>
<p>You can create this relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> directory tree by either:</p>
<ul>
<li>Build <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using /syn/build_top.sh followed by running /syn/common/scripts/generate_pr_release.sh</li>
<li>Build <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> and <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> using /syn/build_top.sh with optional -p switch included</li>
</ul>
<p>The generate_pr_release.sh has the following command structure:</p>
<p>```bash session
./syn/common/scripts/generate_pr_release.sh -t <path to generated release tree> <em>Board Build Target</em> <work dir from build_top.sh></p>
<p>Where:</p>
<p>-t <path to generated release tree> = location for your relocatable <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> directory tree
<em>Board Build Target</em> is the name of the board target/<abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> e.g. d5005
<work dir from build_top.sh> 
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>Here is an example of running the generate_pr_release.sh script:
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>```bash session
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>syn/common/scripts/generate_pr_release.sh -t work_d5005/build_tree d5005  work_d5005
</code></pre></div>
```bash session</p>
<hr />
<p><strong><em>*</em></strong><strong> ENV SETUP </strong><strong><em>*</em></strong><strong>*</strong></p>
<p><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Project:
  OFS_PROJECT = d5005
  OFS_FIM     = .
  OFS_BOARD   = .
  Q_PROJECT   = d5005
  Q_REVISION  = d5005
  Fitter SEED = 03
<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> id
  BITSTREAM_ID = 04010002c7cab852
  BITSTREAM_MD = 0000000002204283</p>
<p>...
...
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>The resulting relocatable build tree has the following structure:
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>```bash session
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>.
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>├── bin
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>│   ├── afu_synth
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>│   ├── build_env_config
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>│   ├── run.sh -&gt; afu_synth
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>│   └── update_pim
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>├── hw
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>│   ├── blue_bits
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>│   │   ├── d5005_page1_unsigned.bin
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>│   │   └── d5005.sof -&gt; ../lib/build/syn/syn_top/output_files/d5005.sof
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>│   └── lib
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>│       ├── build
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>│       ├── fme-ifc-id.txt
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>│       ├── fme-platform-class.txt
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>│       └── platform
</code></pre></div></p>
<p>This build tree can be moved to a different location and used for <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> development of a <abbr title="Partial Reconfiguration, The ability to dynamically reconfigure a portion of an FPGA while the remaining FPGA design continues to function. In the context of Intel FPGA PAC, a PR bitstream refers to an Intel FPGA PAC AFU. Refer to Partial Reconfiguration support page.">PR</abbr> capable <abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> to be used with this board.</p>
<h3 id="424-unit-level-simulation">4.2.4. Unit Level Simulation</h3>
<p>Unit level simulation of key components is provided. These simulations provide verification of the following areas:</p>
<ul>
<li>HSSI</li>
<li>PCIe</li>
<li>External Memory</li>
<li><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> management</li>
</ul>
<p>These simulations use the Synopsys VCS simulator. Each simulation contains a readme file explaining how to run the simulation. Refer to <a href="https://github.com/OFS/otcshare/blob/main/hw/docs/d5005/user_guides/ug_sim_ofs_d5005/ug_sim_ofs_d5005.md">Simulation User Guide: Open FPGA Stack for Intel Intel® Stratix 10® FPGA</a>  for details of simulation examples. Your simulation shell requires Python, Quartus, and VCS to run.  To run a simulation of the dfh_walker that simulates host access to the internal DFH registers, perform the following steps:</p>
<p>```bash session
Before running unit simulation, you must set environment variables as described below:
cd $OFS_BUILD_ROOT/ofs-d5005
export OFS_ROOTDIR=$PWD</p>
<h2 id="note-ofs_rootdir-is-the-directory-where-you-cloned-the-repo-eg-homemyprojectofs-d5005">*Note, OFS_ROOTDIR is the directory where you cloned the repo, e.g. /home/MyProject/ofs-d5005 *</h2>
<p>export WORKDIR=$OFS_ROOTDIR
export VERDIR=$OFS_ROOTDIR/verification
export QUARTUS_HOME=$QUARTUS_ROOTDIR</p>
<h2 id="note-quartus_rootdir-is-your-quartus-installation-directory-eg-quartus_rootdirbin-contains-quartus-executuable"><em>Note, QUARTUS_ROOTDIR is your Quartus installation directory, e.g. $QUARTUS_ROOTDIR/bin contains Quartus executuable</em></h2>
<p>export QUARTUS_INSTALL_DIR=$QUARTUS_ROOTDIR
export IMPORT_IP_ROOTDIR=$QUARTUS_ROOTDIR/../ip
export IP_ROOTDIR=$QUARTUS_ROOTDIR/../ip
export OPAE_SDK_REPO_BRANCH=release/2.3.0
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>To compile all IPs:
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>To Generate Simulation Files &amp; compile all IPs, run the following command:
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>```bash session     
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>cd $OFS_ROOTDIR/ofs-common/scripts/common/sim
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>sh gen_sim_files.sh d5005
</code></pre></div>
The RTL file list for unit_test is located here: $OFS_ROOTDIR/sim/scripts/rtl_comb.f</p>
<p>The IPs are generated here: 
```bash session
$OFS_ROOTDIR/sim/scripts/qip_gen
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>The IP simulation filelist is generated here: 
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>```bash session
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>$OFS_ROOTDIR/sim/scripts/ip_flist.f
</code></pre></div>
Once the IPs are generated, they can be used for any unit test.</p>
<p>To run the simulation, run the following command:</p>
<p><code>bash session
cd $OFS_ROOTDIR/sim/unit_test/&lt;Unit Test Name&gt;/scripts
sh run_sim.sh VCS=1
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>Simulation files are located in the sim/unit_test/&lt;test_name&gt;/sim directory.
</code></pre></div>
To view simulation waveform:</code>bash session
cd $OFS_ROOTDIR/sim/unit_test/<test_name>/script/sim/unit_test/<test_name>/scripts/sim_vcs
dve -full64 -vpd vcdplus.vpd &amp;
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>#### 4.2.4.1. DFH Walking Unit Simulation Output
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>```bash session
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>********************************************
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a> Running TEST(0) : test_fme_dfh_walking
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>********************************************
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>READ64: address=0x00000000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>   READDATA: 0x4000000010000000
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>FME_DFH
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>   Address   (0x0)
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>   DFH value (0x4000000010000000)
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>READ64: address=0x00001000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>   READDATA: 0x3000000020000001
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>THERM_MNGM_DFH
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>   Address   (0x1000)
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>   DFH value (0x3000000020000001)
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>READ64: address=0x00003000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>   READDATA: 0x3000000010000007
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>GLBL_PERF_DFH
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>   Address   (0x3000)
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>   DFH value (0x3000000010000007)
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>READ64: address=0x00004000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>   READDATA: 0x30000000c0001004
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>GLBL_ERROR_DFH
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>   Address   (0x4000)
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>   DFH value (0x30000000c0001004)
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a>READ64: address=0x00010000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a>
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a>   READDATA: 0x300000010000000e
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a>
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a>SPI_DFH
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a>   Address   (0x10000)
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a>   DFH value (0x300000010000000e)
<a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a>READ64: address=0x00020000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a>
<a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a>   READDATA: 0x3000000100000020
<a id="__codelineno-13-45" name="__codelineno-13-45" href="#__codelineno-13-45"></a>
<a id="__codelineno-13-46" name="__codelineno-13-46" href="#__codelineno-13-46"></a>PCIE_DFH
<a id="__codelineno-13-47" name="__codelineno-13-47" href="#__codelineno-13-47"></a>   Address   (0x20000)
<a id="__codelineno-13-48" name="__codelineno-13-48" href="#__codelineno-13-48"></a>   DFH value (0x3000000100000020)
<a id="__codelineno-13-49" name="__codelineno-13-49" href="#__codelineno-13-49"></a>READ64: address=0x00030000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-50" name="__codelineno-13-50" href="#__codelineno-13-50"></a>
<a id="__codelineno-13-51" name="__codelineno-13-51" href="#__codelineno-13-51"></a>   READDATA: 0x300000010000100f
<a id="__codelineno-13-52" name="__codelineno-13-52" href="#__codelineno-13-52"></a>
<a id="__codelineno-13-53" name="__codelineno-13-53" href="#__codelineno-13-53"></a>HSSI_DFH
<a id="__codelineno-13-54" name="__codelineno-13-54" href="#__codelineno-13-54"></a>   Address   (0x30000)
<a id="__codelineno-13-55" name="__codelineno-13-55" href="#__codelineno-13-55"></a>   DFH value (0x300000010000100f)
<a id="__codelineno-13-56" name="__codelineno-13-56" href="#__codelineno-13-56"></a>READ64: address=0x00040000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-57" name="__codelineno-13-57" href="#__codelineno-13-57"></a>
<a id="__codelineno-13-58" name="__codelineno-13-58" href="#__codelineno-13-58"></a>   READDATA: 0x3000000500000009
<a id="__codelineno-13-59" name="__codelineno-13-59" href="#__codelineno-13-59"></a>
<a id="__codelineno-13-60" name="__codelineno-13-60" href="#__codelineno-13-60"></a>EMIF_DFH
<a id="__codelineno-13-61" name="__codelineno-13-61" href="#__codelineno-13-61"></a>   Address   (0x40000)
<a id="__codelineno-13-62" name="__codelineno-13-62" href="#__codelineno-13-62"></a>   DFH value (0x3000000500000009)
<a id="__codelineno-13-63" name="__codelineno-13-63" href="#__codelineno-13-63"></a>READ64: address=0x00090000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-64" name="__codelineno-13-64" href="#__codelineno-13-64"></a>
<a id="__codelineno-13-65" name="__codelineno-13-65" href="#__codelineno-13-65"></a>   READDATA: 0x3000000010001005
<a id="__codelineno-13-66" name="__codelineno-13-66" href="#__codelineno-13-66"></a>
<a id="__codelineno-13-67" name="__codelineno-13-67" href="#__codelineno-13-67"></a>FME_PR_DFH
<a id="__codelineno-13-68" name="__codelineno-13-68" href="#__codelineno-13-68"></a>   Address   (0x90000)
<a id="__codelineno-13-69" name="__codelineno-13-69" href="#__codelineno-13-69"></a>   DFH value (0x3000000010001005)
<a id="__codelineno-13-70" name="__codelineno-13-70" href="#__codelineno-13-70"></a>READ64: address=0x00091000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-71" name="__codelineno-13-71" href="#__codelineno-13-71"></a>
<a id="__codelineno-13-72" name="__codelineno-13-72" href="#__codelineno-13-72"></a>   READDATA: 0x4000000010001001
<a id="__codelineno-13-73" name="__codelineno-13-73" href="#__codelineno-13-73"></a>
<a id="__codelineno-13-74" name="__codelineno-13-74" href="#__codelineno-13-74"></a>PORT_DFH
<a id="__codelineno-13-75" name="__codelineno-13-75" href="#__codelineno-13-75"></a>   Address   (0x91000)
<a id="__codelineno-13-76" name="__codelineno-13-76" href="#__codelineno-13-76"></a>   DFH value (0x4000000010001001)
<a id="__codelineno-13-77" name="__codelineno-13-77" href="#__codelineno-13-77"></a>READ64: address=0x00092000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-78" name="__codelineno-13-78" href="#__codelineno-13-78"></a>
<a id="__codelineno-13-79" name="__codelineno-13-79" href="#__codelineno-13-79"></a>   READDATA: 0x3000000010000014
<a id="__codelineno-13-80" name="__codelineno-13-80" href="#__codelineno-13-80"></a>
<a id="__codelineno-13-81" name="__codelineno-13-81" href="#__codelineno-13-81"></a>USER_CLOCK_DFH
<a id="__codelineno-13-82" name="__codelineno-13-82" href="#__codelineno-13-82"></a>   Address   (0x92000)
<a id="__codelineno-13-83" name="__codelineno-13-83" href="#__codelineno-13-83"></a>   DFH value (0x3000000010000014)
<a id="__codelineno-13-84" name="__codelineno-13-84" href="#__codelineno-13-84"></a>READ64: address=0x00093000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-85" name="__codelineno-13-85" href="#__codelineno-13-85"></a>
<a id="__codelineno-13-86" name="__codelineno-13-86" href="#__codelineno-13-86"></a>   READDATA: 0x30000000d0002013
<a id="__codelineno-13-87" name="__codelineno-13-87" href="#__codelineno-13-87"></a>
<a id="__codelineno-13-88" name="__codelineno-13-88" href="#__codelineno-13-88"></a>PORT_STP_DFH
<a id="__codelineno-13-89" name="__codelineno-13-89" href="#__codelineno-13-89"></a>   Address   (0x93000)
<a id="__codelineno-13-90" name="__codelineno-13-90" href="#__codelineno-13-90"></a>   DFH value (0x30000000d0002013)
<a id="__codelineno-13-91" name="__codelineno-13-91" href="#__codelineno-13-91"></a>READ64: address=0x000a0000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-13-92" name="__codelineno-13-92" href="#__codelineno-13-92"></a>
<a id="__codelineno-13-93" name="__codelineno-13-93" href="#__codelineno-13-93"></a>   READDATA: 0x3000010000002010
<a id="__codelineno-13-94" name="__codelineno-13-94" href="#__codelineno-13-94"></a>
<a id="__codelineno-13-95" name="__codelineno-13-95" href="#__codelineno-13-95"></a>AFU_INTF_DFH
<a id="__codelineno-13-96" name="__codelineno-13-96" href="#__codelineno-13-96"></a>   Address   (0xa0000)
<a id="__codelineno-13-97" name="__codelineno-13-97" href="#__codelineno-13-97"></a>   DFH value (0x3000010000002010)
<a id="__codelineno-13-98" name="__codelineno-13-98" href="#__codelineno-13-98"></a>MMIO error count matches: x
<a id="__codelineno-13-99" name="__codelineno-13-99" href="#__codelineno-13-99"></a>
<a id="__codelineno-13-100" name="__codelineno-13-100" href="#__codelineno-13-100"></a>Test status: OK
<a id="__codelineno-13-101" name="__codelineno-13-101" href="#__codelineno-13-101"></a>
<a id="__codelineno-13-102" name="__codelineno-13-102" href="#__codelineno-13-102"></a>********************
<a id="__codelineno-13-103" name="__codelineno-13-103" href="#__codelineno-13-103"></a>  Test summary
<a id="__codelineno-13-104" name="__codelineno-13-104" href="#__codelineno-13-104"></a>********************
<a id="__codelineno-13-105" name="__codelineno-13-105" href="#__codelineno-13-105"></a>   test_fme_dfh_walking (id=0) - pass
<a id="__codelineno-13-106" name="__codelineno-13-106" href="#__codelineno-13-106"></a>Test passed!
<a id="__codelineno-13-107" name="__codelineno-13-107" href="#__codelineno-13-107"></a>Assertion count: 0
</code></pre></div>
The simulation transcript is displayed while the simulation runs.  The transcript is saved to the file transcript.out for review after the simulation completes.  The simulation waveform database is saved as vcdplus.vpd for post simulation review. You are encouraged to run the additional simulation examples to learn about each key area of the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> shell.</p>
<h2 id="43-compiling-the-ofs-fim-using-eval-script">4.3. Compiling the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> using Eval Script</h2>
<p>The Evaluation Script provides resources to setup and report D5005 development environment. You can use the evaluation script to compile and simulate the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. Refer to <a href="https://github.com/OFS/ofs-d5005/blob/release/1.0.x/eval_scripts/README_ofs_d5005_eval.txt)">README_ofs_d5005_eval.txt</a> for details of using the evaluation script.</p>
<h2 id="44-debugging">4.4. Debugging</h2>
<p>For debugging issues within the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>, Signal Tap can be used to gain internal visibility into your design.  This section describes the process of adding a Signal Tap instance to your <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> design</p>
<h3 id="441-signal-tap-prerequisites">4.4.1. Signal Tap Prerequisites</h3>
<p>To use Signal Tap with <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr>, you will need the following:</p>
<ul>
<li>
<p>Understanding of Signal Tap fundamentals - please review <a href="https://www.intel.com/content/www/us/en/programmable/documentation/nfc1513989909783.html"><em>Quartus Prime Pro Edition User Guide: Debug Tools</em></a>.<br />
section 2. Design Debugging with the Signal Tap Logic Analyzer.</p>
</li>
<li>
<p>The Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005 has a built in Intel FPGA Download Cable II allowing <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> access to the S10 FPGA. You can access the D5005 built in Intel FPGA Download Cable II by connecting your server to the Micro USB connector as shown below:</p>
</li>
</ul>
<p><img alt="Microbus" src="../images/D5005_MicroUSB.png" /></p>
<ul>
<li>If you are using a custom board without a built-in Intel FPGA Download Cable then an external Intel FPGA Download Cable II (see <a href="https://www.intel.com/content/www/us/en/programmable/products/boards_and_kits/download-cables.html">Download Cables</a> for more information) can be used for Signal Tap access.  The custom board must have <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> access to the target FPGA for the Intel FPGA Download Cable II.</li>
</ul>
<h3 id="442-adding-signal-tap">4.4.2. Adding Signal Tap</h3>
<p>The following steps guide you through the process of adding a Signal Tap instance to your design.  The added Signal Tap instance provides hardware to capture the desired internal signals and connect the stored trace information via <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr>.  Please be aware, the added Signal Tap hardware will consume FPGA resources and may require additional floorplanning steps to accommodate these resources.  Some areas of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> use logic lock regions and these regions may need to be re-sized. These steps assume the use of the Intel® FPGA <abbr title="Programmable Acceleration Card: FPGA based Accelerator card">PAC</abbr> D5005.</p>
<ol>
<li>Perform a full compile using the script build_top.sh.</li>
<li>Once the compile completes open the Quartus GUI using the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> project.  The Quartus project is named d5005 and is located in the work directory syn/syn_top/d5005.qpf.  Once the project is loaded, go to Tools &gt; Signal Tap Logic Analyzer to bring up the Signal Tap GUI.</li>
</ol>
<p><img alt="Quartus Signal Tap" src="../images/QuartusSignalTap.png" /></p>
<ol>
<li>Accept the "Default" selection and click "Create".</li>
</ol>
<p><img alt="Default Signal Tap" src="../images/Default_SignalTap.png" /></p>
<ol>
<li>This brings up Signal Tap Logic Analyzer window as shown below:</li>
</ol>
<p><img alt="Signal Tap GUI" src="../images/STP_GUI.png" /></p>
<ol>
<li>Set up clock for STP instance.  In this example, the EMIF CSR module is being instrumented.  If unfamiliar with code, it is helpful to use the Quartus Project Navigator to find the specific block of interest and open the design instance for review.  For example, see snip below using Project Navigator to open emif_csr block:</li>
</ol>
<p><img alt="Project Navigator" src="../images/STP_ProjNav.png" />    </p>
<ol>
<li>After reviewing code, assign clock for sampling Signal Tap instrumented signals of interest.  Note, the clock selected and the signals you want to view should be the same for best trace fidelity.  Different clocks can be used however there maybe issues with trace inaccuracy due sampling time differences.  In the middle right of the Signal Tap window under Signal Configuration, Clock:  select "…" as shown below: </li>
</ol>
<p><img alt="STP Clock" src="../images/STP_Clock.png" /></p>
<ol>
<li>After reviewing code, assign clock for sampling Signal Tap instrumented signals of interest.  In the middle right of the Signal Tap window under Signal Configuration, Clock:  select "…" as shown below:   This brings up the Node Finder tool.  Input "<em>emif_csr</em>" into Named and select "Search".  This brings up all nodes from the pre-synthesis view.  Expand, "mem" and "emif_csr" and scroll through this list to become familiar with nodes, and then select csr_if.clk and click "&gt;"  to select this clock as shown below and click "OK": </li>
</ol>
<p><img alt="Node Finder" src="../images/STP_nodefinder.png" /></p>
<ol>
<li>Update the sample depth and other Signal Tap settings as needed for your debugging criteria.</li>
</ol>
<p><img alt="STP Settings" src="../images/STP_settings.PNG" /></p>
<ol>
<li>In the Signal Tap GUI add nodes to be instrumented by double clicking on "Double-click to add nodes".</li>
</ol>
<p><img alt="STP Settings" src="../images/STP_addNodes.PNG" /></p>
<ol>
<li>This brings up the Node Finder.  Add signals to be traced by the Signal Tap instance.  Click "Insert" to add the signals.</li>
<li>To provide a unique name for your Signal Tap instance, select "auto signaltap_0", right click and select rename instance and provide a descriptive name for your instance.</li>
<li>Save the newly created Signal Tap file and click "Yes" to add the new Signal Tap file to the project.</li>
<li>Compile the project with the Signal Tap file added to the project.</li>
<li>Once the compile successfully completes with proper timing, you can load the generated d5005.sof using the Intel FPGA Downloader cable.</li>
</ol>
<h3 id="443-signal-tap-trace-acquisition">4.4.3. Signal Tap trace acquisition</h3>
<p>To acquire signals using SignalTap, first load the Signal Tap instrumented SOF file into your target board, open the STP file in the Signal Tap GUI and start the signal acquisition. </p>
<p>Avoid system hang during programming the sof file, mask <abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr> regsiter using below steps </p>
<p>Find Root complex - End Point mapping using the below command</p>
<p>```bash session
lspci -vt
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>```bash session
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>+-[0000:3a]-+-00.0-[3b-3c]----00.0  Intel Corporation Device bcce
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a> |           +-05.0  Intel Corporation Sky Lake-E VT-d
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a> |           +-05.2  Intel Corporation Sky Lake-E RAS Configuration Registers
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a> |           +-05.4  Intel Corporation Sky Lake-E IOxAPIC Configuration Registers
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a> |           +-08.0  Intel Corporation Sky Lake-E Integrated Memory Controller
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a> |           +-09.0  Intel Corporation Sky Lake-E Integrated Memory Controller
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a> |           +-0a.0  Intel Corporation Sky Lake-E Integrated Memory Controller
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a> |           +-0a.1  Intel Corporation Sky Lake-E Integrated Memory Controller
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a> |           +-0a.2  Intel Corporation Sky Lake-E Integrated Memory Controller
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a> |           +-0a.3  Intel Corporation Sky Lake-E Integrated Memory Controller
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a> |           +-0a.4  Intel Corporation Sky Lake-E Integrated Memory Controller
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a> |           +-0a.5  Intel Corporation Sky Lake-E LM Channel 1
</code></pre></div></p>
<p>Use the bus information from the lspci logs to mask the <abbr title="Advanced Error Reporting, The PCIe AER driver is the extended PCI Express error reporting capability providing more robust error reporting.">AER</abbr> (Advanced Error Reporting) register</p>
<p>```bash session
sudo su</p>
<p>setpci -s 0000:3b:00.0 ECAP_AER+0x08.L=0xFFFFFFFF 
setpci -s 0000:3b:00.0 ECAP_AER+0x14.L=0xFFFFFFFF
setpci -s 0000:3a:00.0 ECAP_AER+0x08.L=0xFFFFFFFF
setpci -s 0000:3a:00.0 ECAP_AER+0x14.L=0xFFFFFFFF
echo "1" &gt; /sys/bus/pci/devices/0000:3b:00.0/remove</p>
<p>exit
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>1. The SOF file is located in the work directory work_d5005/syn/syn_top/output_files/d5005.sof.  If the target FPGA is on a different server, then transfer d5005.sof and STP files to the server with the target FPGA. Load the SOF using the Intel® FPGA PAC D5005 built-in Intel FPGA Download Cable II. 
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>```bash session
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>sudo su
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>echo &quot;1&quot; &gt; /sys/bus/pci/rescan
</code></pre></div></p>
<ol>
<li>Make sure D5005 is present by checking expected bitstream ID using command:</li>
</ol>
<p>```bash session
sudo fpgainfo fme
Intel FPGA Programmable Acceleration Card D5005
Board Management Controller, MAX10 NIOS FW version: 2.0.13 
Board Management Controller, MAX10 Build version: 2.0.8 
//<strong><em>*</em>* <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> </strong>****//
Object Id                        : 0xF000000
PCIe s:b:d.f                     : 0000:3B:00.0
Vendor Id                        : 0x8086
Device Id                        : 0xBCCE
SubVendor Id                     : 0x8086
SubDevice Id                     : 0x138D
Socket Id                        : 0x00
Ports Num                        : 01
Bitstream Id                     : 0x40100022C164DB1
Bitstream Version                : 4.0.1
Pr Interface Id                  : 210a4631-18bb-57d1-879f-2c3d59b26e37
Boot Page                        : user
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>3. Once the SOF file is loaded, start the Quartus Signal Tap GUI.
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>```bash session
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>quartus_stpw
</code></pre></div>
The Signal Tap GUI comes up.</p>
<ol>
<li>In the Signal Tap GUI, <code>Hardware:</code> selection box select the cable "Stratix10 Darby Creek [ <abbr title="Joint Test Action Group, Refers to the IEEE 1149.1 JTAG standard; Another FPGA configuration methodology.">JTAG</abbr> cable number ]" as shown below:</li>
</ol>
<p><img alt="STP HW" src="../images/STP_HW.png" /></p>
<ol>
<li>In <code>File</code> open your STP file.  Your STP file settings will load.  If not already set, you can create the trigger conditions, then start analysis with <code>F5</code>.</li>
</ol>
<p><img alt="STP-cap" src="../images/stp_capture.png" /></p>
<h1 id="5-fim-modification-example">5. <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> Modification Example</h1>
<p>An example of <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> modification is provided in this section.  This example can be used in your specific application as a starting point.  This example shows the basic flow and listing of files that are to be changed.</p>
<h2 id="51-hello-fim-example">5.1. Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> example</h2>
<p>If you intend to add a new module to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> area, then you will need to inform the host software of the new module.  The <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> exposes its functionalities to host software through a set of CSR registers that are mapped to an <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> region (Memory Mapped IO).  This set of CSR registers and their operation is described in <a href="https://ofs.github.io/hw/d5005/reference_manuals/ofs_fim/mnl_fim_ofs_d5005/#mmio_regions"><abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Regions</a>.</p>
<p>See <a href="https://github.com/ofs/linux-dfl/blob/fpga-ofs-dev/Documentation/fpga/dfl.rst#fpga-device-feature-list-dfl-framework-overview">FPGA Device Feature List (<abbr title="Device Feature List, A concept inherited from OFS. The DFL drivers provide support for FPGA devices that are designed to support the Device Feature List. The DFL, which is implemented in RTL, consists of a self-describing data structure in PCI BAR space that allows the DFL driver to automatically load the drivers required for a given FPGA configuration.">DFL</abbr>) Framework Overview</a> for a description of the software process to read and process the linked list of Device Feature Header (DFH) CSRs within a FPGA.</p>
<p>This example adds a simple DFH register set to the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. You can use this example as the basis for adding a new feature to your <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>.  </p>
<p>The steps to add this simple DFH register are described below.</p>
<ol>
<li>Review current design documentation: <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> Tech Ref <abbr title="Memory Mapped Input/Output, Users may map and access both control registers and system memory buffers with accelerators.">MMIO</abbr> Regions</li>
<li>Understand <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> and Port regions, DFH walking, DFH register structure </li>
<li>Run unit level simulations and review output:
            i.  sim/unit_test/dfh_walker</li>
<li>Note DFH link list order, see <a href="#dfh-walking-unit-simulation-output">DFH Walker Unit Level Simulation Output</a></li>
<li>Make code changes to top level <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> file to instantiate new DFH register</li>
<li>The DFH registers follow a link list.  This example inserts the hello_fim DFH register after the EMIF DFH register, so the emif_csr.sv parameters are updated to insert the hello_fim DFH register as next register in the link list.</li>
<li>Create the new hello_fim SystemVerilog files.</li>
<li>Update and run the dfh_walker unit simulation files</li>
<li>Update synthesis files to include the new hello_fim source files</li>
<li>Build and test the new <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr></li>
</ol>
<p>The following sections describe changes to add the hello_fim DFH example to the Intel provided FPGA design.</p>
<h2 id="511-srctopiofs_topsv">5.1.1. src/top/iofs_top.sv</h2>
<ol>
<li>Edit top level design module: src/top/iofs_top.sv</li>
<li>Instantiate new hello_fim module in OFS_top.sv at line 294</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1">//*******************************</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="c1">// FME</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1">//*******************************</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">  </span><span class="n">fme_top</span><span class="w"> </span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">  </span><span class="n">fme_top</span><span class="p">(</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">          </span><span class="p">.</span><span class="n">clk</span><span class="w">               </span><span class="p">(</span><span class="n">clk_1x</span><span class="w">                    </span><span class="p">),</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">          </span><span class="p">.</span><span class="n">rst_n</span><span class="w">             </span><span class="p">(</span><span class="n">rst_n_d_1x</span><span class="w">       </span><span class="p">),</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">          </span><span class="p">.</span><span class="n">pwr_good_n</span><span class="w">        </span><span class="p">(</span><span class="n">ninit_done</span><span class="w">                </span><span class="p">),</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">          </span><span class="p">.</span><span class="n">i_pcie_error</span><span class="w">      </span><span class="p">(</span><span class="m">&#39;0</span><span class="w">                        </span><span class="p">),</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">          </span><span class="p">.</span><span class="n">axi_lite_m_if</span><span class="w">     </span><span class="p">(</span><span class="n">bpf_fme_mst_if</span><span class="w">            </span><span class="p">),</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">          </span><span class="p">.</span><span class="n">axi_lite_s_if</span><span class="w">     </span><span class="p">(</span><span class="n">bpf_fme_slv_if</span><span class="w">            </span><span class="p">)</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">         </span><span class="p">);</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="no">`ifdef</span><span class="w"> </span><span class="n">INCLUDE_HELLO_FIM</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">        </span><span class="n">hello_fim_top</span><span class="w"> </span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">           </span><span class="n">hello_fim_top</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">        </span><span class="p">.</span><span class="n">clk</span><span class="w">   </span><span class="p">(</span><span class="n">clk_1x</span><span class="p">),</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">       </span><span class="p">.</span><span class="n">rst_n</span><span class="w">                      </span><span class="p">(</span><span class="n">rst_n_d_1x</span><span class="p">),</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">       </span><span class="p">.</span><span class="n">csr_lite_if</span><span class="w">             </span><span class="p">(</span><span class="n">bpf_rsv_5_slv_if</span><span class="p">)</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="w">        </span><span class="p">);</span>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="no">`endif</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="c1">//*******************************</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="c1">// AFU</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="c1">//*******************************</span>
</code></pre></div>
<p>You will connect the Hello_FIM DFH register to the existing BPF reserved link 5.  The provided <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> reference design includes 3 reserved BPF interfaces available for custom usage such as new OPAE controlled modules.  The address map of BPF is shown below:</p>
<table>
<thead>
<tr>
<th><strong>Address</strong></th>
<th><strong>Size (Byte)</strong></th>
<th><strong>Feature</strong></th>
<th><strong>Master</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00000 – 0x0FFFF</td>
<td>64K</td>
<td><abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> (<abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr>, Error, etc)</td>
<td>Yes</td>
</tr>
<tr>
<td>0x10000 – 0x1FFFF</td>
<td>64K</td>
<td>PMCI Proxy (SPI Controller)</td>
<td>Yes</td>
</tr>
<tr>
<td>0x20000 – 0x2FFFF</td>
<td>64K</td>
<td>PCIe CSR</td>
<td></td>
</tr>
<tr>
<td>0x30000 – 0x3FFFF</td>
<td>64K</td>
<td>HSSI CSR</td>
<td></td>
</tr>
<tr>
<td>0x40000 – 0x4FFFF</td>
<td>64K</td>
<td>EMIF CSR</td>
<td></td>
</tr>
<tr>
<td>0x50000 – 0x5FFFF</td>
<td>64K</td>
<td>Reserved</td>
<td></td>
</tr>
<tr>
<td>0x60000 – 0x6FFFF</td>
<td>64K</td>
<td>Reserved</td>
<td></td>
</tr>
<tr>
<td>0x70000 – 0x7FFFF</td>
<td>64K</td>
<td>Reserved</td>
<td></td>
</tr>
</tbody>
</table>
<p>The BPF reserved link 5 is connected to a dummy connection to prevent this link from being optimized out the design during synthesis.  You will add a compiler `define that will cause this dummy connection to be removed when the variable INCLUDE_HELLO_FIM is defined by editing line 575 if iofs_top.sv as shown below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="w">    </span><span class="c1">// Reserved address response</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">   </span><span class="no">`ifndef</span><span class="w"> </span><span class="n">INCLUDE_HELLO_FIM</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="n">bpf_dummy_slv</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">    </span><span class="n">bpf_rsv_5_slv</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">        </span><span class="p">.</span><span class="n">clk</span><span class="w">            </span><span class="p">(</span><span class="n">clk_1x</span><span class="p">),</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">        </span><span class="p">.</span><span class="n">dummy_slv_if</span><span class="w">   </span><span class="p">(</span><span class="n">bpf_rsv_5_slv_if</span><span class="p">)</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">    </span><span class="p">);</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">    </span><span class="no">`endif</span>
</code></pre></div>
<h2 id="512-ipssmememif_csrsv">5.1.2. ipss/mem/emif_csr.sv</h2>
<p>The Hello_FIM DFH is inserted in the DFH link list after the EMIF CSR DFH and before the FME_PR DFH.  The file ipss/d5005/emif/emif_csr.sv contains a parameter defining the next address for the next DFH in in the link list chain.  You will change the next address offset to be 0x10000 so the reveserved BPF AXI lite link connected to the Hello_FIM DFH register is next in the DFH link list.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">module</span><span class="w"> </span><span class="n">emif_csr</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="n">NUM_LOCAL_MEM_BANKS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">,</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="n">END_OF_LIST</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">,</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">  </span><span class="no">`ifndef</span><span class="w"> </span><span class="n">INCLUDE_HELLO_FIM</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="n">NEXT_DFH_OFFSET</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mh">24&#39;h05</span><span class="n">_0000</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">  </span><span class="no">`else</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="n">NEXT_DFH_OFFSET</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mh">24&#39;h01</span><span class="n">_0000</span><span class="c1">//New for Hello_FIM, next offset now at 0x50000</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">  </span><span class="no">`endif</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="p">)</span>
</code></pre></div>
<h3 id="513-srchello_fimhello_fim_topsv">5.1.3. src/hello_fim/hello_fim_top.sv</h3>
<p>Create hello_fim_top.sv, and store it in src/hello_fim directory. The main purpose of this RTL is to convert AXI4-Lite interface to a simple interface to interface with the registers in hello_fim_com.sv.  This register sets the DFH feature ID to 0xfff which is undefined.  Since this for test purposes, using an undefined feature ID will result in no driver being used.  Normally, a defined feature ID will be used to associate a specific driver with the FPGA module.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">// ***************************************************************************</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="c1">//                               INTEL CONFIDENTIAL</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="c1">//</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="c1">//        Copyright (C) 2021 Intel Corporation All Rights Reserved.</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="c1">//</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="c1">// The source code contained or described herein and all  documents related to</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="c1">// the  source  code  (&quot;Material&quot;)  are  owned  by  Intel  Corporation  or its</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="c1">// suppliers  or  licensors.    Title  to  the  Material  remains  with  Intel</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="c1">// Corporation or  its suppliers  and licensors.  The Material  contains trade</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="c1">// secrets  and  proprietary  and  confidential  information  of  Intel or its</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="c1">// suppliers and licensors.  The Material is protected  by worldwide copyright</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="c1">// and trade secret laws and treaty provisions. No part of the Material may be</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="c1">// used,   copied,   reproduced,   modified,   published,   uploaded,  posted,</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="c1">// transmitted,  distributed,  or  disclosed  in any way without Intel&#39;s prior</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="c1">// express written permission.</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="c1">//</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="c1">// No license under any patent,  copyright, trade secret or other intellectual</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="c1">// property  right  is  granted  to  or  conferred  upon  you by disclosure or</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="c1">// delivery  of  the  Materials, either expressly, by implication, inducement,</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="c1">// estoppel or otherwise.  Any license under such intellectual property rights</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="c1">// must be express and approved by Intel in writing.</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="c1">//</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="c1">// You will not, and will not allow any third party to modify, adapt, enhance, </span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="c1">// disassemble, decompile, reverse engineer, change or create derivative works </span>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="c1">// from the Software except and only to the extent as specifically required by </span>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="c1">// mandatory applicable laws or any applicable third party license terms </span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="c1">// accompanying the Software.</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="c1">//</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="c1">// -----------------------------------------------------------------------------</span>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="c1">// Engineer     : </span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="c1">// Create Date  : Nov 2021</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="c1">// Module Name  : hello_fim_top.sv</span>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a><span class="c1">// Project      : OFS</span>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="c1">// -----------------------------------------------------------------------------</span>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a><span class="c1">//</span>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="c1">// Description: </span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="c1">// This is a simple module that implements DFH registers and </span>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="c1">// AVMM address decoding logic.</span>
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a>
<a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>
<a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a><span class="k">module</span><span class="w"> </span><span class="n">hello_fim_top</span><span class="w">  </span><span class="p">#(</span>
<a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="n">ADDR_WIDTH</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mh">12</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="n">DATA_WIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="p">[</span><span class="mh">11</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">FEAT_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">12&#39;hfff</span><span class="p">,</span>
<a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">FEAT_VER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4&#39;h0</span><span class="p">,</span>
<a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="p">[</span><span class="mh">23</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">NEXT_DFH_OFFSET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">24&#39;h04</span><span class="n">_0000</span><span class="p">,</span>
<a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a><span class="w">   </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="n">END_OF_LIST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span>
<a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a><span class="p">)(</span>
<a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a><span class="w">   </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">    </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a><span class="w">   </span><span class="k">input</span><span class="w">  </span><span class="kt">logic</span><span class="w">    </span><span class="n">rst_n</span><span class="p">,</span>
<a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a><span class="c1">// -----------------------------------------------------------</span>
<a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a><span class="c1">//  AXI4LITE Interface</span>
<a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a><span class="c1">// -----------------------------------------------------------</span>
<a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a><span class="w">   </span><span class="n">ofs_fim_axi_lite_if</span><span class="p">.</span><span class="n">slave</span><span class="w">   </span><span class="n">csr_lite_if</span>
<a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a><span class="p">);</span>
<a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a>
<a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a><span class="kn">import</span> <span class="nn">ofs_fim_cfg_pkg::*</span><span class="p">;</span>
<a id="__codelineno-20-58" name="__codelineno-20-58" href="#__codelineno-20-58"></a><span class="kn">import</span> <span class="nn">ofs_csr_pkg::*</span><span class="p">;</span>
<a id="__codelineno-20-59" name="__codelineno-20-59" href="#__codelineno-20-59"></a>
<a id="__codelineno-20-60" name="__codelineno-20-60" href="#__codelineno-20-60"></a><span class="c1">//-------------------------------------</span>
<a id="__codelineno-20-61" name="__codelineno-20-61" href="#__codelineno-20-61"></a><span class="c1">// Signals</span>
<a id="__codelineno-20-62" name="__codelineno-20-62" href="#__codelineno-20-62"></a><span class="c1">//-------------------------------------</span>
<a id="__codelineno-20-63" name="__codelineno-20-63" href="#__codelineno-20-63"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">csr_waddr</span><span class="p">;</span>
<a id="__codelineno-20-64" name="__codelineno-20-64" href="#__codelineno-20-64"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DATA_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">csr_wdata</span><span class="p">;</span>
<a id="__codelineno-20-65" name="__codelineno-20-65" href="#__codelineno-20-65"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DATA_WIDTH</span><span class="o">/</span><span class="mh">8</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">            </span><span class="n">csr_wstrb</span><span class="p">;</span>
<a id="__codelineno-20-66" name="__codelineno-20-66" href="#__codelineno-20-66"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">csr_write</span><span class="p">;</span>
<a id="__codelineno-20-67" name="__codelineno-20-67" href="#__codelineno-20-67"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">csr_slv_wready</span><span class="p">;</span>
<a id="__codelineno-20-68" name="__codelineno-20-68" href="#__codelineno-20-68"></a><span class="w">   </span><span class="n">csr_access_type_t</span><span class="w">                   </span><span class="n">csr_write_type</span><span class="p">;</span>
<a id="__codelineno-20-69" name="__codelineno-20-69" href="#__codelineno-20-69"></a>
<a id="__codelineno-20-70" name="__codelineno-20-70" href="#__codelineno-20-70"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">csr_raddr</span><span class="p">;</span>
<a id="__codelineno-20-71" name="__codelineno-20-71" href="#__codelineno-20-71"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">csr_read</span><span class="p">;</span>
<a id="__codelineno-20-72" name="__codelineno-20-72" href="#__codelineno-20-72"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">csr_read_32b</span><span class="p">;</span>
<a id="__codelineno-20-73" name="__codelineno-20-73" href="#__codelineno-20-73"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">DATA_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">csr_readdata</span><span class="p">;</span>
<a id="__codelineno-20-74" name="__codelineno-20-74" href="#__codelineno-20-74"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">csr_readdata_valid</span><span class="p">;</span>
<a id="__codelineno-20-75" name="__codelineno-20-75" href="#__codelineno-20-75"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="n">ADDR_WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">              </span><span class="n">csr_addr</span><span class="p">;</span>
<a id="__codelineno-20-76" name="__codelineno-20-76" href="#__codelineno-20-76"></a>
<a id="__codelineno-20-77" name="__codelineno-20-77" href="#__codelineno-20-77"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">                        </span><span class="n">com_csr_writedata</span><span class="p">;</span>
<a id="__codelineno-20-78" name="__codelineno-20-78" href="#__codelineno-20-78"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">com_csr_read</span><span class="p">;</span>
<a id="__codelineno-20-79" name="__codelineno-20-79" href="#__codelineno-20-79"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">com_csr_write</span><span class="p">;</span>
<a id="__codelineno-20-80" name="__codelineno-20-80" href="#__codelineno-20-80"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">                        </span><span class="n">com_csr_readdata</span><span class="p">;</span>
<a id="__codelineno-20-81" name="__codelineno-20-81" href="#__codelineno-20-81"></a><span class="w">   </span><span class="kt">logic</span><span class="w">                               </span><span class="n">com_csr_readdatavalid</span><span class="p">;</span>
<a id="__codelineno-20-82" name="__codelineno-20-82" href="#__codelineno-20-82"></a><span class="w">   </span><span class="kt">logic</span><span class="w"> </span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">                         </span><span class="n">com_csr_address</span><span class="p">;</span>
<a id="__codelineno-20-83" name="__codelineno-20-83" href="#__codelineno-20-83"></a>
<a id="__codelineno-20-84" name="__codelineno-20-84" href="#__codelineno-20-84"></a><span class="c1">// AXI-M CSR interfaces</span>
<a id="__codelineno-20-85" name="__codelineno-20-85" href="#__codelineno-20-85"></a><span class="n">ofs_fim_axi_mmio_if</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-20-86" name="__codelineno-20-86" href="#__codelineno-20-86"></a><span class="w">   </span><span class="p">.</span><span class="n">AWID_WIDTH</span><span class="w">   </span><span class="p">(</span><span class="n">ofs_fim_cfg_pkg</span><span class="o">::</span><span class="n">MMIO_TID_WIDTH</span><span class="p">),</span>
<a id="__codelineno-20-87" name="__codelineno-20-87" href="#__codelineno-20-87"></a><span class="w">   </span><span class="p">.</span><span class="n">AWADDR_WIDTH</span><span class="w"> </span><span class="p">(</span><span class="n">ADDR_WIDTH</span><span class="p">),</span>
<a id="__codelineno-20-88" name="__codelineno-20-88" href="#__codelineno-20-88"></a><span class="w">   </span><span class="p">.</span><span class="n">WDATA_WIDTH</span><span class="w">  </span><span class="p">(</span><span class="n">ofs_fim_cfg_pkg</span><span class="o">::</span><span class="n">MMIO_DATA_WIDTH</span><span class="p">),</span>
<a id="__codelineno-20-89" name="__codelineno-20-89" href="#__codelineno-20-89"></a><span class="w">   </span><span class="p">.</span><span class="n">ARID_WIDTH</span><span class="w">   </span><span class="p">(</span><span class="n">ofs_fim_cfg_pkg</span><span class="o">::</span><span class="n">MMIO_TID_WIDTH</span><span class="p">),</span>
<a id="__codelineno-20-90" name="__codelineno-20-90" href="#__codelineno-20-90"></a><span class="w">   </span><span class="p">.</span><span class="n">ARADDR_WIDTH</span><span class="w"> </span><span class="p">(</span><span class="n">ADDR_WIDTH</span><span class="p">),</span>
<a id="__codelineno-20-91" name="__codelineno-20-91" href="#__codelineno-20-91"></a><span class="w">   </span><span class="p">.</span><span class="n">RDATA_WIDTH</span><span class="w">  </span><span class="p">(</span><span class="n">ofs_fim_cfg_pkg</span><span class="o">::</span><span class="n">MMIO_DATA_WIDTH</span><span class="p">)</span>
<a id="__codelineno-20-92" name="__codelineno-20-92" href="#__codelineno-20-92"></a><span class="p">)</span><span class="w"> </span><span class="n">csr_if</span><span class="p">();</span>
<a id="__codelineno-20-93" name="__codelineno-20-93" href="#__codelineno-20-93"></a>
<a id="__codelineno-20-94" name="__codelineno-20-94" href="#__codelineno-20-94"></a><span class="c1">// AXI4-lite to AXI-M adapter</span>
<a id="__codelineno-20-95" name="__codelineno-20-95" href="#__codelineno-20-95"></a><span class="n">axi_lite2mmio</span><span class="w"> </span><span class="n">axi_lite2mmio</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-20-96" name="__codelineno-20-96" href="#__codelineno-20-96"></a><span class="w">   </span><span class="p">.</span><span class="n">clk</span><span class="w">       </span><span class="p">(</span><span class="n">clk</span><span class="p">),</span>
<a id="__codelineno-20-97" name="__codelineno-20-97" href="#__codelineno-20-97"></a><span class="w">   </span><span class="p">.</span><span class="n">rst_n</span><span class="w">     </span><span class="p">(</span><span class="n">rst_n</span><span class="p">),</span>
<a id="__codelineno-20-98" name="__codelineno-20-98" href="#__codelineno-20-98"></a><span class="w">   </span><span class="p">.</span><span class="n">lite_if</span><span class="w">   </span><span class="p">(</span><span class="n">csr_lite_if</span><span class="p">),</span>
<a id="__codelineno-20-99" name="__codelineno-20-99" href="#__codelineno-20-99"></a><span class="w">   </span><span class="p">.</span><span class="n">mmio_if</span><span class="w">   </span><span class="p">(</span><span class="n">csr_if</span><span class="p">)</span>
<a id="__codelineno-20-100" name="__codelineno-20-100" href="#__codelineno-20-100"></a><span class="p">);</span>
<a id="__codelineno-20-101" name="__codelineno-20-101" href="#__codelineno-20-101"></a>
<a id="__codelineno-20-102" name="__codelineno-20-102" href="#__codelineno-20-102"></a><span class="c1">//---------------------------------</span>
<a id="__codelineno-20-103" name="__codelineno-20-103" href="#__codelineno-20-103"></a><span class="c1">// Map AXI write/read request to CSR write/read,</span>
<a id="__codelineno-20-104" name="__codelineno-20-104" href="#__codelineno-20-104"></a><span class="c1">// and send the write/read response back</span>
<a id="__codelineno-20-105" name="__codelineno-20-105" href="#__codelineno-20-105"></a><span class="c1">//---------------------------------</span>
<a id="__codelineno-20-106" name="__codelineno-20-106" href="#__codelineno-20-106"></a><span class="n">ofs_fim_axi_csr_slave</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-20-107" name="__codelineno-20-107" href="#__codelineno-20-107"></a><span class="w">   </span><span class="p">.</span><span class="n">ADDR_WIDTH</span><span class="w"> </span><span class="p">(</span><span class="n">ADDR_WIDTH</span><span class="p">),</span>
<a id="__codelineno-20-108" name="__codelineno-20-108" href="#__codelineno-20-108"></a><span class="w">   </span><span class="p">.</span><span class="n">USE_SLV_READY</span><span class="w"> </span><span class="p">(</span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">)</span>
<a id="__codelineno-20-109" name="__codelineno-20-109" href="#__codelineno-20-109"></a>
<a id="__codelineno-20-110" name="__codelineno-20-110" href="#__codelineno-20-110"></a><span class="w">   </span><span class="p">)</span><span class="w"> </span><span class="n">csr_slave</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-20-111" name="__codelineno-20-111" href="#__codelineno-20-111"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_if</span><span class="w">             </span><span class="p">(</span><span class="n">csr_if</span><span class="p">),</span>
<a id="__codelineno-20-112" name="__codelineno-20-112" href="#__codelineno-20-112"></a>
<a id="__codelineno-20-113" name="__codelineno-20-113" href="#__codelineno-20-113"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_write</span><span class="w">          </span><span class="p">(</span><span class="n">csr_write</span><span class="p">),</span>
<a id="__codelineno-20-114" name="__codelineno-20-114" href="#__codelineno-20-114"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_waddr</span><span class="w">          </span><span class="p">(</span><span class="n">csr_waddr</span><span class="p">),</span>
<a id="__codelineno-20-115" name="__codelineno-20-115" href="#__codelineno-20-115"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_write_type</span><span class="w">     </span><span class="p">(</span><span class="n">csr_write_type</span><span class="p">),</span>
<a id="__codelineno-20-116" name="__codelineno-20-116" href="#__codelineno-20-116"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_wdata</span><span class="w">          </span><span class="p">(</span><span class="n">csr_wdata</span><span class="p">),</span>
<a id="__codelineno-20-117" name="__codelineno-20-117" href="#__codelineno-20-117"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_wstrb</span><span class="w">          </span><span class="p">(</span><span class="n">csr_wstrb</span><span class="p">),</span>
<a id="__codelineno-20-118" name="__codelineno-20-118" href="#__codelineno-20-118"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_slv_wready</span><span class="w">     </span><span class="p">(</span><span class="n">csr_slv_wready</span><span class="p">),</span>
<a id="__codelineno-20-119" name="__codelineno-20-119" href="#__codelineno-20-119"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_read</span><span class="w">           </span><span class="p">(</span><span class="n">csr_read</span><span class="p">),</span>
<a id="__codelineno-20-120" name="__codelineno-20-120" href="#__codelineno-20-120"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_raddr</span><span class="w">          </span><span class="p">(</span><span class="n">csr_raddr</span><span class="p">),</span>
<a id="__codelineno-20-121" name="__codelineno-20-121" href="#__codelineno-20-121"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_read_32b</span><span class="w">       </span><span class="p">(</span><span class="n">csr_read_32b</span><span class="p">),</span>
<a id="__codelineno-20-122" name="__codelineno-20-122" href="#__codelineno-20-122"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_readdata</span><span class="w">       </span><span class="p">(</span><span class="n">csr_readdata</span><span class="p">),</span>
<a id="__codelineno-20-123" name="__codelineno-20-123" href="#__codelineno-20-123"></a><span class="w">   </span><span class="p">.</span><span class="n">csr_readdata_valid</span><span class="w"> </span><span class="p">(</span><span class="n">csr_readdata_valid</span><span class="p">)</span>
<a id="__codelineno-20-124" name="__codelineno-20-124" href="#__codelineno-20-124"></a><span class="p">);</span>
<a id="__codelineno-20-125" name="__codelineno-20-125" href="#__codelineno-20-125"></a>
<a id="__codelineno-20-126" name="__codelineno-20-126" href="#__codelineno-20-126"></a><span class="c1">// Address mapping</span>
<a id="__codelineno-20-127" name="__codelineno-20-127" href="#__codelineno-20-127"></a><span class="k">assign</span><span class="w"> </span><span class="n">csr_addr</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">csr_write</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">csr_waddr</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">csr_raddr</span><span class="p">;</span>
<a id="__codelineno-20-128" name="__codelineno-20-128" href="#__codelineno-20-128"></a><span class="k">assign</span><span class="w"> </span><span class="n">com_csr_address</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">csr_addr</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span><span class="w">  </span><span class="c1">// byte address</span>
<a id="__codelineno-20-129" name="__codelineno-20-129" href="#__codelineno-20-129"></a><span class="k">assign</span><span class="w"> </span><span class="n">csr_slv_wready</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-20-130" name="__codelineno-20-130" href="#__codelineno-20-130"></a><span class="c1">// Write data mapping</span>
<a id="__codelineno-20-131" name="__codelineno-20-131" href="#__codelineno-20-131"></a><span class="k">assign</span><span class="w"> </span><span class="n">com_csr_writedata</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">csr_wdata</span><span class="p">;</span>
<a id="__codelineno-20-132" name="__codelineno-20-132" href="#__codelineno-20-132"></a>
<a id="__codelineno-20-133" name="__codelineno-20-133" href="#__codelineno-20-133"></a><span class="c1">// Read-Write mapping</span>
<a id="__codelineno-20-134" name="__codelineno-20-134" href="#__codelineno-20-134"></a><span class="k">always_comb</span>
<a id="__codelineno-20-135" name="__codelineno-20-135" href="#__codelineno-20-135"></a><span class="k">begin</span>
<a id="__codelineno-20-136" name="__codelineno-20-136" href="#__codelineno-20-136"></a><span class="w">   </span><span class="n">com_csr_read</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-20-137" name="__codelineno-20-137" href="#__codelineno-20-137"></a><span class="w">   </span><span class="n">com_csr_write</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-20-138" name="__codelineno-20-138" href="#__codelineno-20-138"></a><span class="w">   </span><span class="k">casez</span><span class="w"> </span><span class="p">(</span><span class="n">csr_addr</span><span class="p">[</span><span class="mh">11</span><span class="o">:</span><span class="mh">6</span><span class="p">])</span>
<a id="__codelineno-20-139" name="__codelineno-20-139" href="#__codelineno-20-139"></a><span class="w">      </span><span class="mh">6&#39;h00</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">begin</span><span class="w"> </span><span class="c1">// Common CSR</span>
<a id="__codelineno-20-140" name="__codelineno-20-140" href="#__codelineno-20-140"></a><span class="w">         </span><span class="n">com_csr_read</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">csr_read</span><span class="p">;</span>
<a id="__codelineno-20-141" name="__codelineno-20-141" href="#__codelineno-20-141"></a><span class="w">         </span><span class="n">com_csr_write</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">csr_write</span><span class="p">;</span>
<a id="__codelineno-20-142" name="__codelineno-20-142" href="#__codelineno-20-142"></a><span class="w">      </span><span class="k">end</span><span class="w">   </span>
<a id="__codelineno-20-143" name="__codelineno-20-143" href="#__codelineno-20-143"></a><span class="w">      </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-20-144" name="__codelineno-20-144" href="#__codelineno-20-144"></a><span class="w">         </span><span class="n">com_csr_read</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-20-145" name="__codelineno-20-145" href="#__codelineno-20-145"></a><span class="w">         </span><span class="n">com_csr_write</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-20-146" name="__codelineno-20-146" href="#__codelineno-20-146"></a><span class="w">      </span><span class="k">end</span>
<a id="__codelineno-20-147" name="__codelineno-20-147" href="#__codelineno-20-147"></a><span class="w">   </span><span class="k">endcase</span>
<a id="__codelineno-20-148" name="__codelineno-20-148" href="#__codelineno-20-148"></a><span class="k">end</span>
<a id="__codelineno-20-149" name="__codelineno-20-149" href="#__codelineno-20-149"></a>
<a id="__codelineno-20-150" name="__codelineno-20-150" href="#__codelineno-20-150"></a><span class="c1">// Read data mapping</span>
<a id="__codelineno-20-151" name="__codelineno-20-151" href="#__codelineno-20-151"></a><span class="w">   </span><span class="k">always_comb</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-20-152" name="__codelineno-20-152" href="#__codelineno-20-152"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">com_csr_readdatavalid</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-20-153" name="__codelineno-20-153" href="#__codelineno-20-153"></a><span class="w">         </span><span class="n">csr_readdata</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">com_csr_readdata</span><span class="p">;</span>
<a id="__codelineno-20-154" name="__codelineno-20-154" href="#__codelineno-20-154"></a><span class="w">         </span><span class="n">csr_readdata_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
<a id="__codelineno-20-155" name="__codelineno-20-155" href="#__codelineno-20-155"></a><span class="w">      </span><span class="k">end</span>
<a id="__codelineno-20-156" name="__codelineno-20-156" href="#__codelineno-20-156"></a><span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-20-157" name="__codelineno-20-157" href="#__codelineno-20-157"></a><span class="w">         </span><span class="n">csr_readdata</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="m">&#39;0</span><span class="p">;</span>
<a id="__codelineno-20-158" name="__codelineno-20-158" href="#__codelineno-20-158"></a><span class="w">         </span><span class="n">csr_readdata_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-20-159" name="__codelineno-20-159" href="#__codelineno-20-159"></a><span class="w">      </span><span class="k">end</span>
<a id="__codelineno-20-160" name="__codelineno-20-160" href="#__codelineno-20-160"></a><span class="w">   </span><span class="k">end</span>
<a id="__codelineno-20-161" name="__codelineno-20-161" href="#__codelineno-20-161"></a>
<a id="__codelineno-20-162" name="__codelineno-20-162" href="#__codelineno-20-162"></a><span class="w">   </span><span class="n">hello_fim_com</span><span class="w">  </span><span class="p">#(</span>
<a id="__codelineno-20-163" name="__codelineno-20-163" href="#__codelineno-20-163"></a><span class="w">   </span><span class="p">.</span><span class="n">FEAT_ID</span><span class="w">          </span><span class="p">(</span><span class="n">FEAT_ID</span><span class="p">),</span>
<a id="__codelineno-20-164" name="__codelineno-20-164" href="#__codelineno-20-164"></a><span class="w">   </span><span class="p">.</span><span class="n">FEAT_VER</span><span class="w">         </span><span class="p">(</span><span class="n">FEAT_VER</span><span class="p">),</span>
<a id="__codelineno-20-165" name="__codelineno-20-165" href="#__codelineno-20-165"></a><span class="w">   </span><span class="p">.</span><span class="n">NEXT_DFH_OFFSET</span><span class="w">  </span><span class="p">(</span><span class="n">NEXT_DFH_OFFSET</span><span class="p">),</span>
<a id="__codelineno-20-166" name="__codelineno-20-166" href="#__codelineno-20-166"></a><span class="w">   </span><span class="p">.</span><span class="n">END_OF_LIST</span><span class="w">      </span><span class="p">(</span><span class="n">END_OF_LIST</span><span class="p">)</span>
<a id="__codelineno-20-167" name="__codelineno-20-167" href="#__codelineno-20-167"></a><span class="p">)</span><span class="w"> </span><span class="n">hello_fim_com_inst</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-20-168" name="__codelineno-20-168" href="#__codelineno-20-168"></a><span class="w">   </span><span class="p">.</span><span class="n">clk</span><span class="w">                   </span><span class="p">(</span><span class="n">clk</span><span class="w">                     </span><span class="p">),</span>
<a id="__codelineno-20-169" name="__codelineno-20-169" href="#__codelineno-20-169"></a><span class="w">   </span><span class="p">.</span><span class="n">rst_n</span><span class="w">                 </span><span class="p">(</span><span class="n">rst_n</span><span class="w">                  </span><span class="p">),</span>
<a id="__codelineno-20-170" name="__codelineno-20-170" href="#__codelineno-20-170"></a><span class="w">   </span><span class="p">.</span><span class="n">writedata</span><span class="w">             </span><span class="p">(</span><span class="n">com_csr_writedata</span><span class="w">       </span><span class="p">),</span>
<a id="__codelineno-20-171" name="__codelineno-20-171" href="#__codelineno-20-171"></a><span class="w">   </span><span class="p">.</span><span class="n">read</span><span class="w">                  </span><span class="p">(</span><span class="n">com_csr_read</span><span class="w">            </span><span class="p">),</span>
<a id="__codelineno-20-172" name="__codelineno-20-172" href="#__codelineno-20-172"></a><span class="w">   </span><span class="p">.</span><span class="n">write</span><span class="w">                 </span><span class="p">(</span><span class="n">com_csr_write</span><span class="w">           </span><span class="p">),</span>
<a id="__codelineno-20-173" name="__codelineno-20-173" href="#__codelineno-20-173"></a><span class="w">   </span><span class="p">.</span><span class="n">byteenable</span><span class="w">            </span><span class="p">(</span><span class="mh">4&#39;hF</span><span class="w">                    </span><span class="p">),</span>
<a id="__codelineno-20-174" name="__codelineno-20-174" href="#__codelineno-20-174"></a><span class="w">   </span><span class="p">.</span><span class="n">readdata</span><span class="w">              </span><span class="p">(</span><span class="n">com_csr_readdata</span><span class="w">        </span><span class="p">),</span>
<a id="__codelineno-20-175" name="__codelineno-20-175" href="#__codelineno-20-175"></a><span class="w">   </span><span class="p">.</span><span class="n">readdatavalid</span><span class="w">         </span><span class="p">(</span><span class="n">com_csr_readdatavalid</span><span class="w">   </span><span class="p">),</span>
<a id="__codelineno-20-176" name="__codelineno-20-176" href="#__codelineno-20-176"></a><span class="w">   </span><span class="p">.</span><span class="n">address</span><span class="w">               </span><span class="p">(</span><span class="n">com_csr_address</span><span class="w">         </span><span class="p">)</span>
<a id="__codelineno-20-177" name="__codelineno-20-177" href="#__codelineno-20-177"></a><span class="w">   </span><span class="p">);</span>
<a id="__codelineno-20-178" name="__codelineno-20-178" href="#__codelineno-20-178"></a>
<a id="__codelineno-20-179" name="__codelineno-20-179" href="#__codelineno-20-179"></a>
<a id="__codelineno-20-180" name="__codelineno-20-180" href="#__codelineno-20-180"></a><span class="k">endmodule</span>
</code></pre></div>
<h3 id="514-srchello_fimhello_fim_comsv">5.1.4. src/hello_fim/hello_fim_com.sv</h3>
<p>Create hello_fim_com.sv, and store it in src/hello_fim directory. This is the simple RTL to implement the Hello <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> registers. You may use this set of registers as the basis for your custom implementation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">// ***************************************************************************</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="c1">//                               INTEL CONFIDENTIAL</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="c1">//</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="c1">//        Copyright (C) 2021 Intel Corporation All Rights Reserved.</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="c1">//</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="c1">// The source code contained or described herein and all  documents related to</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="c1">// the  source  code  (&quot;Material&quot;)  are  owned  by  Intel  Corporation  or its</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="c1">// suppliers  or  licensors.    Title  to  the  Material  remains  with  Intel</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="c1">// Corporation or  its suppliers  and licensors.  The Material  contains trade</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="c1">// secrets  and  proprietary  and  confidential  information  of  Intel or its</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="c1">// suppliers and licensors.  The Material is protected  by worldwide copyright</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="c1">// and trade secret laws and treaty provisions. No part of the Material may be</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="c1">// used,   copied,   reproduced,   modified,   published,   uploaded,  posted,</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="c1">// transmitted,  distributed,  or  disclosed  in any way without Intel&#39;s prior</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="c1">// express written permission.</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="c1">//</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="c1">// No license under any patent,  copyright, trade secret or other intellectual</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="c1">// property  right  is  granted  to  or  conferred  upon  you by disclosure or</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="c1">// delivery  of  the  Materials, either expressly, by implication, inducement,</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="c1">// estoppel or otherwise.  Any license under such intellectual property rights</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="c1">// must be express and approved by Intel in writing.</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="c1">//</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="c1">// You will not, and will not allow any third party to modify, adapt, enhance, </span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="c1">// disassemble, decompile, reverse engineer, change or create derivative works </span>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="c1">// from the Software except and only to the extent as specifically required by </span>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="c1">// mandatory applicable laws or any applicable third party license terms </span>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="c1">// accompanying the Software.</span>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="c1">//</span>
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="c1">// -----------------------------------------------------------------------------</span>
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="c1">// Engineer     : </span>
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a><span class="c1">// Create Date  : Nov 2021</span>
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="c1">// Module Name  : hello_fim_com.sv</span>
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="c1">// Project      : IOFS</span>
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="c1">// -----------------------------------------------------------------------------</span>
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a><span class="c1">//</span>
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a><span class="c1">// Description: </span>
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a><span class="c1">// This is a simple module that implements DFH registers and </span>
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a><span class="c1">// AVMM address decoding logic.</span>
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a>
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a>
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a><span class="k">module</span><span class="w"> </span><span class="n">hello_fim_com</span><span class="w"> </span><span class="p">#(</span>
<a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a><span class="w">    </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="p">[</span><span class="mh">11</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">FEAT_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">12&#39;h001</span><span class="p">,</span>
<a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a><span class="w">    </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="n">FEAT_VER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">4&#39;h1</span><span class="p">,</span>
<a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a><span class="w">    </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="p">[</span><span class="mh">23</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">NEXT_DFH_OFFSET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">24&#39;h1000</span><span class="p">,</span>
<a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a><span class="w">    </span><span class="k">parameter</span><span class="w"> </span><span class="kt">bit</span><span class="w"> </span><span class="n">END_OF_LIST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span>
<a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a><span class="w"> </span><span class="p">)(</span>
<a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span>
<a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">rst_n</span><span class="p">,</span>
<a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">writedata</span><span class="p">,</span>
<a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">read</span><span class="p">,</span>
<a id="__codelineno-21-51" name="__codelineno-21-51" href="#__codelineno-21-51"></a><span class="k">input</span><span class="w"> </span><span class="n">write</span><span class="p">,</span>
<a id="__codelineno-21-52" name="__codelineno-21-52" href="#__codelineno-21-52"></a><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">byteenable</span><span class="p">,</span>
<a id="__codelineno-21-53" name="__codelineno-21-53" href="#__codelineno-21-53"></a><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">readdata</span><span class="p">,</span>
<a id="__codelineno-21-54" name="__codelineno-21-54" href="#__codelineno-21-54"></a><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">readdatavalid</span><span class="p">,</span>
<a id="__codelineno-21-55" name="__codelineno-21-55" href="#__codelineno-21-55"></a><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">address</span>
<a id="__codelineno-21-56" name="__codelineno-21-56" href="#__codelineno-21-56"></a><span class="p">);</span>
<a id="__codelineno-21-57" name="__codelineno-21-57" href="#__codelineno-21-57"></a>
<a id="__codelineno-21-58" name="__codelineno-21-58" href="#__codelineno-21-58"></a>
<a id="__codelineno-21-59" name="__codelineno-21-59" href="#__codelineno-21-59"></a><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">rdata_comb</span><span class="p">;</span>
<a id="__codelineno-21-60" name="__codelineno-21-60" href="#__codelineno-21-60"></a><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">scratch_reg</span><span class="p">;</span>
<a id="__codelineno-21-61" name="__codelineno-21-61" href="#__codelineno-21-61"></a>
<a id="__codelineno-21-62" name="__codelineno-21-62" href="#__codelineno-21-62"></a><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span><span class="w">  </span>
<a id="__codelineno-21-63" name="__codelineno-21-63" href="#__codelineno-21-63"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span><span class="w"> </span><span class="n">readdata</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="p">;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">readdata</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">rdata_comb</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<a id="__codelineno-21-64" name="__codelineno-21-64" href="#__codelineno-21-64"></a>
<a id="__codelineno-21-65" name="__codelineno-21-65" href="#__codelineno-21-65"></a><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span>
<a id="__codelineno-21-66" name="__codelineno-21-66" href="#__codelineno-21-66"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span><span class="w"> </span><span class="n">readdatavalid</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">readdatavalid</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">read</span><span class="p">;</span>
<a id="__codelineno-21-67" name="__codelineno-21-67" href="#__codelineno-21-67"></a>
<a id="__codelineno-21-68" name="__codelineno-21-68" href="#__codelineno-21-68"></a><span class="kt">wire</span><span class="w"> </span><span class="n">wr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">write</span><span class="p">;</span>
<a id="__codelineno-21-69" name="__codelineno-21-69" href="#__codelineno-21-69"></a><span class="kt">wire</span><span class="w"> </span><span class="n">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read</span><span class="p">;</span>
<a id="__codelineno-21-70" name="__codelineno-21-70" href="#__codelineno-21-70"></a><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">address</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<a id="__codelineno-21-71" name="__codelineno-21-71" href="#__codelineno-21-71"></a><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">din</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">writedata</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<a id="__codelineno-21-72" name="__codelineno-21-72" href="#__codelineno-21-72"></a><span class="kt">wire</span><span class="w"> </span><span class="n">wr_scratch_reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wr</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">  </span><span class="o">==</span><span class="w"> </span><span class="mh">6&#39;h30</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="n">byteenable</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="o">:</span><span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<a id="__codelineno-21-73" name="__codelineno-21-73" href="#__codelineno-21-73"></a>
<a id="__codelineno-21-74" name="__codelineno-21-74" href="#__codelineno-21-74"></a><span class="c1">// 64 bit scratch register</span>
<a id="__codelineno-21-75" name="__codelineno-21-75" href="#__codelineno-21-75"></a><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="w"> </span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span>
<a id="__codelineno-21-76" name="__codelineno-21-76" href="#__codelineno-21-76"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span><span class="w">  </span><span class="k">begin</span>
<a id="__codelineno-21-77" name="__codelineno-21-77" href="#__codelineno-21-77"></a><span class="w">      </span><span class="n">scratch_reg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">64&#39;h0</span><span class="p">;</span>
<a id="__codelineno-21-78" name="__codelineno-21-78" href="#__codelineno-21-78"></a><span class="w">   </span><span class="k">end</span>
<a id="__codelineno-21-79" name="__codelineno-21-79" href="#__codelineno-21-79"></a><span class="w">   </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-21-80" name="__codelineno-21-80" href="#__codelineno-21-80"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wr_scratch_reg</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"> </span>
<a id="__codelineno-21-81" name="__codelineno-21-81" href="#__codelineno-21-81"></a><span class="w">      </span><span class="n">scratch_reg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w">  </span><span class="n">din</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-21-82" name="__codelineno-21-82" href="#__codelineno-21-82"></a><span class="w">   </span><span class="k">end</span>
<a id="__codelineno-21-83" name="__codelineno-21-83" href="#__codelineno-21-83"></a><span class="k">end</span>
<a id="__codelineno-21-84" name="__codelineno-21-84" href="#__codelineno-21-84"></a>
<a id="__codelineno-21-85" name="__codelineno-21-85" href="#__codelineno-21-85"></a><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<a id="__codelineno-21-86" name="__codelineno-21-86" href="#__codelineno-21-86"></a><span class="k">begin</span>
<a id="__codelineno-21-87" name="__codelineno-21-87" href="#__codelineno-21-87"></a><span class="n">rdata_comb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h0000000000000000</span><span class="p">;</span>
<a id="__codelineno-21-88" name="__codelineno-21-88" href="#__codelineno-21-88"></a><span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">re</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-21-89" name="__codelineno-21-89" href="#__codelineno-21-89"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="p">(</span><span class="n">addr</span><span class="p">)</span><span class="w">  </span>
<a id="__codelineno-21-90" name="__codelineno-21-90" href="#__codelineno-21-90"></a><span class="w">    </span><span class="mh">6&#39;h00</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-21-91" name="__codelineno-21-91" href="#__codelineno-21-91"></a><span class="w">        </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">11</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">FEAT_ID</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="c1">// dfh_feature_id  is reserved or a constant value, a read access gives the reset value</span>
<a id="__codelineno-21-92" name="__codelineno-21-92" href="#__codelineno-21-92"></a><span class="w">        </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">12</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">FEAT_VER</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="c1">// dfh_feature_rev    is reserved or a constant value, a read access gives the reset value</span>
<a id="__codelineno-21-93" name="__codelineno-21-93" href="#__codelineno-21-93"></a><span class="w">        </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">39</span><span class="o">:</span><span class="mh">16</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">NEXT_DFH_OFFSET</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="c1">// dfh_dfh_ofst is reserved or a constant value, a read access gives the reset value</span>
<a id="__codelineno-21-94" name="__codelineno-21-94" href="#__codelineno-21-94"></a><span class="w">        </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">40</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">END_OF_LIST</span><span class="w"> </span><span class="p">;</span><span class="w">        </span><span class="c1">//dfh_end_of_list</span>
<a id="__codelineno-21-95" name="__codelineno-21-95" href="#__codelineno-21-95"></a><span class="w">        </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">59</span><span class="o">:</span><span class="mh">40</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mh">20&#39;h00000</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="c1">// dfh_rsvd1     is reserved or a constant value, a read access gives the reset value</span>
<a id="__codelineno-21-96" name="__codelineno-21-96" href="#__codelineno-21-96"></a><span class="w">        </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">60</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mh">4&#39;h3</span><span class="w"> </span><span class="p">;</span><span class="w">  </span><span class="c1">// dfh_feat_type  is reserved or a constant value, a read access gives the reset value</span>
<a id="__codelineno-21-97" name="__codelineno-21-97" href="#__codelineno-21-97"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-21-98" name="__codelineno-21-98" href="#__codelineno-21-98"></a><span class="w">    </span><span class="mh">6&#39;h30</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-21-99" name="__codelineno-21-99" href="#__codelineno-21-99"></a><span class="w">        </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">scratch_reg</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-21-100" name="__codelineno-21-100" href="#__codelineno-21-100"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-21-101" name="__codelineno-21-101" href="#__codelineno-21-101"></a><span class="w">        </span><span class="mh">6&#39;h38</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-21-102" name="__codelineno-21-102" href="#__codelineno-21-102"></a><span class="w">                </span><span class="n">rdata_comb</span><span class="w"> </span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h6626</span><span class="n">_0701_5000_0034</span><span class="p">;</span>
<a id="__codelineno-21-103" name="__codelineno-21-103" href="#__codelineno-21-103"></a><span class="w">        </span><span class="k">end</span>
<a id="__codelineno-21-104" name="__codelineno-21-104" href="#__codelineno-21-104"></a><span class="w">    </span><span class="k">default</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">begin</span>
<a id="__codelineno-21-105" name="__codelineno-21-105" href="#__codelineno-21-105"></a><span class="w">        </span><span class="n">rdata_comb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h0000000000000000</span><span class="p">;</span>
<a id="__codelineno-21-106" name="__codelineno-21-106" href="#__codelineno-21-106"></a><span class="w">    </span><span class="k">end</span>
<a id="__codelineno-21-107" name="__codelineno-21-107" href="#__codelineno-21-107"></a><span class="w">      </span><span class="k">endcase</span>
<a id="__codelineno-21-108" name="__codelineno-21-108" href="#__codelineno-21-108"></a><span class="w">   </span><span class="k">end</span>
<a id="__codelineno-21-109" name="__codelineno-21-109" href="#__codelineno-21-109"></a><span class="k">end</span>
<a id="__codelineno-21-110" name="__codelineno-21-110" href="#__codelineno-21-110"></a>
<a id="__codelineno-21-111" name="__codelineno-21-111" href="#__codelineno-21-111"></a><span class="k">endmodule</span>
</code></pre></div>
<h3 id="515-unit-level-simulations">5.1.5. Unit Level Simulations</h3>
<p>To run a unit level simulation test for the updated RTL files, make modifications to your cloned /my_ofs_project/ofs-d5005/sim/d5005/unit_test/dfh_walker files.  The following simulation files are updated to test the new hello_fim.</p>
<ol>
<li>
<p>Edit sim/unit_test/dfh_walker/testbench/test_csr_defs.sv</p>
</li>
<li>
<p>Update enum line 38</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="w">       </span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">      </span><span class="n">FME_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">      </span><span class="n">THERM_MNGM_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">      </span><span class="n">GLBL_PERF_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">      </span><span class="n">GLBL_ERROR_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">      </span><span class="n">SPI_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">      </span><span class="n">PCIE_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">      </span><span class="n">HSSI_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">      </span><span class="n">EMIF_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">      </span><span class="n">HELLO_FIM_DFH_IDX</span><span class="p">,</span><span class="c1">//New for HELLO_FIM</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">      </span><span class="n">FME_PR_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">      </span><span class="n">PORT_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">      </span><span class="n">USER_CLOCK_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">      </span><span class="n">PORT_STP_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">      </span><span class="n">AFU_INTF_DFH_IDX</span><span class="p">,</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w">      </span><span class="n">MAX_FME_DFH_IDX</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="n">t_fme_dfh_idx</span><span class="p">;</span>
</code></pre></div>
<ol>
<li>Edit function dfh_name line 78</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">function</span><span class="w"> </span><span class="k">automatic</span><span class="w"> </span><span class="n">dfh_name</span><span class="p">[</span><span class="n">MAX_FME_DFH_IDX</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">get_fme_dfh_names</span><span class="p">();</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">      </span><span class="n">dfh_name</span><span class="p">[</span><span class="n">MAX_FME_DFH_IDX</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">fme_dfh_names</span><span class="p">;</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">FME_DFH_IDX</span><span class="p">]</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;FME_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">THERM_MNGM_DFH_IDX</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;THERM_MNGM_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">GLBL_PERF_DFH_IDX</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;GLBL_PERF_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">GLBL_ERROR_DFH_IDX</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;GLBL_ERROR_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">SPI_DFH_IDX</span><span class="p">]</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SPI_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">PCIE_DFH_IDX</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PCIE_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">HSSI_DFH_IDX</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HSSI_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">EMIF_DFH_IDX</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EMIF_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">HELLO_FIM_DFH_IDX</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;HELLO_FIM_DFH&quot;</span><span class="p">;</span><span class="c1">//New for HELLO_FIM</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">FME_PR_DFH_IDX</span><span class="p">]</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;FME_PR_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">PORT_DFH_IDX</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PORT_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">USER_CLOCK_DFH_IDX</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;USER_CLOCK_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">PORT_STP_DFH_IDX</span><span class="p">]</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PORT_STP_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">      </span><span class="n">fme_dfh_names</span><span class="p">[</span><span class="n">AFU_INTF_DFH_IDX</span><span class="p">]</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;AFU_INTF_DFH&quot;</span><span class="p">;</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">fme_dfh_names</span><span class="p">;</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="w">   </span><span class="k">endfunction</span>
</code></pre></div>
<ol>
<li>Update get_fme_dfh_values</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="w">  </span><span class="k">function</span><span class="w"> </span><span class="k">automatic</span><span class="w"> </span><span class="p">[</span><span class="n">MAX_FME_DFH_IDX</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">get_fme_dfh_values</span><span class="p">();</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">      </span><span class="kt">logic</span><span class="p">[</span><span class="n">MAX_FME_DFH_IDX</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">fme_dfh_values</span><span class="p">;</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">FME_DFH_IDX</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h4000</span><span class="n">_0000_1000_0000</span><span class="p">;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">THERM_MNGM_DFH_IDX</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_002000_0001</span><span class="p">;</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">GLBL_PERF_DFH_IDX</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_001000_0007</span><span class="p">;</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">GLBL_ERROR_DFH_IDX</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_00C000_1004</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">SPI_DFH_IDX</span><span class="p">]</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_010000_000e</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">PCIE_DFH_IDX</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_010000_0020</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">HSSI_DFH_IDX</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_010000_100f</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">EMIF_DFH_IDX</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_010000_0009</span><span class="p">;</span><span class="w"> </span><span class="c1">//Update to link to Hello_FIM </span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">HELLO_FIM_DFH_IDX</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_040000_0FFF</span><span class="p">;</span><span class="w">  </span><span class="c1">//New for Hello_FIM</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">FME_PR_DFH_IDX</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_001000_1005</span><span class="p">;</span><span class="w">  </span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">PORT_DFH_IDX</span><span class="p">]</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h4000</span><span class="n">_0000_1000_1001</span><span class="p">;</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">USER_CLOCK_DFH_IDX</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_001000_0014</span><span class="p">;</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">PORT_STP_DFH_IDX</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00000_00D000_2013</span><span class="p">;</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w">      </span><span class="n">fme_dfh_values</span><span class="p">[</span><span class="n">AFU_INTF_DFH_IDX</span><span class="p">]</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mh">64&#39;h3</span><span class="n">_00001_000000_2010</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">fme_dfh_values</span><span class="p">;</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="w">   </span><span class="k">endfunction</span>
</code></pre></div>
<ol>
<li>Update verification/scripts/Makefile_VCS.mk to set macro for INCLUDE_HELLO_FIM starting at line 56 to add +define+INCLUDE_HELLO_FIM
```bash session
VLOG_OPT += +define+SIM_MODE +define+VCS_S10 +define+RP_MAX_TAGS=64 +define+INCLUDE_DDR4 +define+INCLUDE_SPI_BRIDGE +define+INCLUDE_USER_CLOCK +define+INCLUDE_HSSI +define+SIM_USE_PCIE_DUMMY_CSR +define+INCLUDE_HELLO_FIM
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>1. Update sim/scripts/rtl_comb.f to add the path to your new hello_fim_top and hello_top_com SystemVerilog files.  The update is shown below as the new line - 329 below:
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>```bash session
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>$WORKDIR/src/hello_fim/hello_fim_com.sv
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>$WORKDIR/src/hello_fim/hello_fim_top.sv
</code></pre></div></li>
</ol>
<p>After making these changes, run the unit level simulation using sim/unit_test/dfh_walker test.  Before running, ensure your shell has the environment variables set properly as defined in <a href="#setting-up-required-environment-variables">Setting Up Required Environment Variables</a>.</p>
<p>```bash session
cd verification/scripts
gmake -f Makefile_VCS.mk cmplib
gmake -f Makefile_VCS.mk build run [DUMP=1]
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>Expected output:
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>```bash session
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a> ********************************************
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a> Running TEST(0) : test_fme_dfh_walking
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>********************************************
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>READ64: address=0x00000000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>   READDATA: 0x4000000010000000
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>FME_DFH
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>   Address   (0x0)
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>   DFH value (0x4000000010000000)
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>READ64: address=0x00001000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>   READDATA: 0x3000000020000001
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>THERM_MNGM_DFH
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>   Address   (0x1000)
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>   DFH value (0x3000000020000001)
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>READ64: address=0x00003000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>   READDATA: 0x3000000010000007
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>GLBL_PERF_DFH
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>   Address   (0x3000)
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>   DFH value (0x3000000010000007)
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>READ64: address=0x00004000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>   READDATA: 0x30000000c0001004
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>GLBL_ERROR_DFH
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>   Address   (0x4000)
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>   DFH value (0x30000000c0001004)
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>READ64: address=0x00010000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a>
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a>   READDATA: 0x300000010000000e
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a>
<a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a>SPI_DFH
<a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a>   Address   (0x10000)
<a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a>   DFH value (0x300000010000000e)
<a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a>READ64: address=0x00020000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a>
<a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a>   READDATA: 0x3000000100000020
<a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a>
<a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a>PCIE_DFH
<a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a>   Address   (0x20000)
<a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a>   DFH value (0x3000000100000020)
<a id="__codelineno-26-48" name="__codelineno-26-48" href="#__codelineno-26-48"></a>READ64: address=0x00030000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-49" name="__codelineno-26-49" href="#__codelineno-26-49"></a>
<a id="__codelineno-26-50" name="__codelineno-26-50" href="#__codelineno-26-50"></a>   READDATA: 0x300000010000100f
<a id="__codelineno-26-51" name="__codelineno-26-51" href="#__codelineno-26-51"></a>
<a id="__codelineno-26-52" name="__codelineno-26-52" href="#__codelineno-26-52"></a>HSSI_DFH
<a id="__codelineno-26-53" name="__codelineno-26-53" href="#__codelineno-26-53"></a>   Address   (0x30000)
<a id="__codelineno-26-54" name="__codelineno-26-54" href="#__codelineno-26-54"></a>   DFH value (0x300000010000100f)
<a id="__codelineno-26-55" name="__codelineno-26-55" href="#__codelineno-26-55"></a>READ64: address=0x00040000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-56" name="__codelineno-26-56" href="#__codelineno-26-56"></a>
<a id="__codelineno-26-57" name="__codelineno-26-57" href="#__codelineno-26-57"></a>   READDATA: 0x3000000100000009
<a id="__codelineno-26-58" name="__codelineno-26-58" href="#__codelineno-26-58"></a>
<a id="__codelineno-26-59" name="__codelineno-26-59" href="#__codelineno-26-59"></a>EMIF_DFH
<a id="__codelineno-26-60" name="__codelineno-26-60" href="#__codelineno-26-60"></a>   Address   (0x40000)
<a id="__codelineno-26-61" name="__codelineno-26-61" href="#__codelineno-26-61"></a>   DFH value (0x3000000100000009)
<a id="__codelineno-26-62" name="__codelineno-26-62" href="#__codelineno-26-62"></a>READ64: address=0x00050000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-63" name="__codelineno-26-63" href="#__codelineno-26-63"></a>
<a id="__codelineno-26-64" name="__codelineno-26-64" href="#__codelineno-26-64"></a>   READDATA: 0x3000000400000fff
<a id="__codelineno-26-65" name="__codelineno-26-65" href="#__codelineno-26-65"></a>
<a id="__codelineno-26-66" name="__codelineno-26-66" href="#__codelineno-26-66"></a>HELLO_FIM_DFH
<a id="__codelineno-26-67" name="__codelineno-26-67" href="#__codelineno-26-67"></a>   Address   (0x50000)
<a id="__codelineno-26-68" name="__codelineno-26-68" href="#__codelineno-26-68"></a>   DFH value (0x3000000400000fff)
<a id="__codelineno-26-69" name="__codelineno-26-69" href="#__codelineno-26-69"></a>READ64: address=0x00090000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-70" name="__codelineno-26-70" href="#__codelineno-26-70"></a>
<a id="__codelineno-26-71" name="__codelineno-26-71" href="#__codelineno-26-71"></a>   READDATA: 0x3000000010001005
<a id="__codelineno-26-72" name="__codelineno-26-72" href="#__codelineno-26-72"></a>
<a id="__codelineno-26-73" name="__codelineno-26-73" href="#__codelineno-26-73"></a>FME_PR_DFH
<a id="__codelineno-26-74" name="__codelineno-26-74" href="#__codelineno-26-74"></a>   Address   (0x90000)
<a id="__codelineno-26-75" name="__codelineno-26-75" href="#__codelineno-26-75"></a>   DFH value (0x3000000010001005)
<a id="__codelineno-26-76" name="__codelineno-26-76" href="#__codelineno-26-76"></a>READ64: address=0x00091000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-77" name="__codelineno-26-77" href="#__codelineno-26-77"></a>
<a id="__codelineno-26-78" name="__codelineno-26-78" href="#__codelineno-26-78"></a>   READDATA: 0x4000000010001001
<a id="__codelineno-26-79" name="__codelineno-26-79" href="#__codelineno-26-79"></a>
<a id="__codelineno-26-80" name="__codelineno-26-80" href="#__codelineno-26-80"></a>PORT_DFH
<a id="__codelineno-26-81" name="__codelineno-26-81" href="#__codelineno-26-81"></a>   Address   (0x91000)
<a id="__codelineno-26-82" name="__codelineno-26-82" href="#__codelineno-26-82"></a>   DFH value (0x4000000010001001)
<a id="__codelineno-26-83" name="__codelineno-26-83" href="#__codelineno-26-83"></a>READ64: address=0x00092000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-84" name="__codelineno-26-84" href="#__codelineno-26-84"></a>
<a id="__codelineno-26-85" name="__codelineno-26-85" href="#__codelineno-26-85"></a>   READDATA: 0x3000000010000014
<a id="__codelineno-26-86" name="__codelineno-26-86" href="#__codelineno-26-86"></a>
<a id="__codelineno-26-87" name="__codelineno-26-87" href="#__codelineno-26-87"></a>USER_CLOCK_DFH
<a id="__codelineno-26-88" name="__codelineno-26-88" href="#__codelineno-26-88"></a>   Address   (0x92000)
<a id="__codelineno-26-89" name="__codelineno-26-89" href="#__codelineno-26-89"></a>   DFH value (0x3000000010000014)
<a id="__codelineno-26-90" name="__codelineno-26-90" href="#__codelineno-26-90"></a>READ64: address=0x00093000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-91" name="__codelineno-26-91" href="#__codelineno-26-91"></a>
<a id="__codelineno-26-92" name="__codelineno-26-92" href="#__codelineno-26-92"></a>   READDATA: 0x30000000d0002013
<a id="__codelineno-26-93" name="__codelineno-26-93" href="#__codelineno-26-93"></a>
<a id="__codelineno-26-94" name="__codelineno-26-94" href="#__codelineno-26-94"></a>PORT_STP_DFH
<a id="__codelineno-26-95" name="__codelineno-26-95" href="#__codelineno-26-95"></a>   Address   (0x93000)
<a id="__codelineno-26-96" name="__codelineno-26-96" href="#__codelineno-26-96"></a>   DFH value (0x30000000d0002013)
<a id="__codelineno-26-97" name="__codelineno-26-97" href="#__codelineno-26-97"></a>READ64: address=0x000a0000 bar=0 vf_active=0 pfn=0 vfn=0
<a id="__codelineno-26-98" name="__codelineno-26-98" href="#__codelineno-26-98"></a>
<a id="__codelineno-26-99" name="__codelineno-26-99" href="#__codelineno-26-99"></a>   READDATA: 0x3000010000002010
<a id="__codelineno-26-100" name="__codelineno-26-100" href="#__codelineno-26-100"></a>
<a id="__codelineno-26-101" name="__codelineno-26-101" href="#__codelineno-26-101"></a>AFU_INTF_DFH
<a id="__codelineno-26-102" name="__codelineno-26-102" href="#__codelineno-26-102"></a>   Address   (0xa0000)
<a id="__codelineno-26-103" name="__codelineno-26-103" href="#__codelineno-26-103"></a>   DFH value (0x3000010000002010)
<a id="__codelineno-26-104" name="__codelineno-26-104" href="#__codelineno-26-104"></a>MMIO error count matches: x
<a id="__codelineno-26-105" name="__codelineno-26-105" href="#__codelineno-26-105"></a>
<a id="__codelineno-26-106" name="__codelineno-26-106" href="#__codelineno-26-106"></a>Test status: OK
<a id="__codelineno-26-107" name="__codelineno-26-107" href="#__codelineno-26-107"></a>
<a id="__codelineno-26-108" name="__codelineno-26-108" href="#__codelineno-26-108"></a>********************
<a id="__codelineno-26-109" name="__codelineno-26-109" href="#__codelineno-26-109"></a>  Test summary
<a id="__codelineno-26-110" name="__codelineno-26-110" href="#__codelineno-26-110"></a>********************
<a id="__codelineno-26-111" name="__codelineno-26-111" href="#__codelineno-26-111"></a>   test_fme_dfh_walking (id=0) - pass
<a id="__codelineno-26-112" name="__codelineno-26-112" href="#__codelineno-26-112"></a>Test passed!
<a id="__codelineno-26-113" name="__codelineno-26-113" href="#__codelineno-26-113"></a>Assertion count: 0
</code></pre></div></p>
<h3 id="516-synsyn_topd5005qsf">5.1.6. syn/syn_top/d5005.qsf</h3>
<ol>
<li>Edit syn/syn_top/d5005.qsf      </li>
<li>Add new macro "INCLUDE_HELLO_FIM" line 107
```bash session
        set_global_assignment -name VERILOG_MACRO "INCLUDE_HELLO_FIM"
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>  2. Add new line 211 to source TCL script with new hello_fim files
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>```bash session
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>        set_global_assignment -name SOURCE_TCL_SCRIPT_FILE ../../../syn/setup/hello_fim_design_files.tcl
</code></pre></div></li>
</ol>
<h3 id="517-synsetuphello_fim_design_filestcl">5.1.7. syn/setup/hello_fim_design_files.tcl</h3>
<p>Create "hello_fim_design_files.tcl" file and store in the syn/setup directory. This tcl file is called from d5005.qsf.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c"># Copyright 2021 Intel Corporation.</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="c">#</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="c"># THIS SOFTWARE MAY CONTAIN PREPRODUCTION CODE AND IS PROVIDED BY THE</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="c"># COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="c"># WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="c"># MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="c"># DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="c"># LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="c"># CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="c"># SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="c"># BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="c"># WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="c"># OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="c"># EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="c">#</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="c"># Hello FIM Files</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="c">#--------------------</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>SYSTEMVERILOG_FILE<span class="w"> </span>src<span class="o">/</span>hello_fim<span class="o">/</span>hello_fim_com.sv
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="nv">set_global_assignment</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>SYSTEMVERILOG_FILE<span class="w"> </span>src<span class="o">/</span>hello_fim<span class="o">/</span>hello_fim_top.sv
</code></pre></div>
<h4 id="518-build-hello_fim-example">5.1.8. Build hello_fim example</h4>
<p>With the preceding changes complete, build the new hello_fim example using the following steps:</p>
<p>```bash session
cd $OFS_ROOTDIR
ofs-common/scripts/common/syn/build_top.sh d5005 work_d5005_hello_fim</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>Verify the design successfully compiled and timing closure is achieved by checking work_d5005_hello_fim/syn/syn_top/output_files/timing_report/clocks.sta.fail.summary - this file should be empty.  If there are timing failures, then this file will list the failing clock domain(s).
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>### 5.1.9. Test the hello_fim on a D5005
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>Load the built FPGA binary file using an unsigned image.  The FPGA image will be in work_d5005_hello_fim/syn/syn_top/output_files/d5005_page1_unsigned.bin
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>Provide the file d5005_page1_unsigned.bin on the server with the Intel® FPGA PAC D5005.
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>```bash session
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>sudo fpgasupdate d5005_page1_unsigned.bin &lt;D5005 PCIe B:D.F&gt;
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>sudo rsu bmcimg &lt;D5005 PCIe B:D.F&gt;
</code></pre></div>
Verify FPGA image is loaded.
```bash session
sudo fpgainfo fme</p>
<h2 id="output_1">Output</h2>
<p>Intel FPGA Programmable Acceleration Card D5005
Board Management Controller, MAX10 NIOS FW version: 2.0.13 
Board Management Controller, MAX10 Build version: 2.0.8 
//<strong><em>*</em>* <abbr title="FPGA Management Engine, Provides a way to manage the platform and enable acceleration functions on the platform.">FME</abbr> </strong>****//
Object Id                        : 0xF000000
PCIe s:b:d.f                     : 0000:3B:00.0
Vendor Id                        : 0x8086
Device Id                        : 0xBCCE
SubVendor Id                     : 0x8086
SubDevice Id                     : 0x138D
Socket Id                        : 0x00
Ports Num                        : 01
Bitstream Id                     : 0x40100022C164DB1
Bitstream Version                : 4.0.1
Pr Interface Id                  : 7d91e0d0-4dcd-58c3-a93d-b9295e6e29b0
Boot Page                        : user</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>Use the OPAE SDK tool opae.io to check default driver binding using your card under test PCIe B:D.F.  The steps below will use 0000:12:00.0 as the card under test PCIe B:D.F.
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>```bash session
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a> sudo opae.io init -d 0000:12:00.0 $USER
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a> ##Output
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a> [0000:12:00.0] (0x8086, 0xbcce) Intel D5005 ADP (Driver: dfl-pci)
</code></pre></div>
The dfl-pci driver is used by <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> fpgainfo commands.  The next steps will bind the card under test to the vfio driver to enable access to the registers.</p>
<p>```bash session
 sudo opae.io init -d 0000:12:00.0 $USER
 ##Output
 opae.io 0.2.3
Unbinding (0x8086,0xbcce) at 0000:12:00.0 from dfl-pci
Binding (0x8086,0xbcce) at 0000:12:00.0 to vfio-pci
iommu group for (0x8086,0xbcce) at 0000:12:00.0 is 35
Assigning /dev/vfio/35 to $USER
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>Confirm the vfio driver is bound to the card under test.
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>```bash session
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>opae.io ls
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>## Output
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>opae.io 0.2.3
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>[0000:12:00.0] (0x8086, 0xbcce) Intel D5005 ADP (Driver: vfio-pci)
</code></pre></div>
Run the following command to walk DFH link list.  The new hello_fim register is located at offset 0x50000.</p>
<p>```bash session
opae.io walk -d 0000:12:00.0</p>
<h2 id="output_2">Output</h2>
<p>opae.io 0.2.3
offset: 0x0000, value: 0x4000000010000000
    dfh: id = 0x0, rev = 0x0, next = 0x1000, eol = 0x0, reserved = 0x0, feature_type = 0x4
offset: 0x1000, value: 0x3000000020000001
    dfh: id = 0x1, rev = 0x0, next = 0x2000, eol = 0x0, reserved = 0x0, feature_type = 0x3
offset: 0x3000, value: 0x3000000010000007
    dfh: id = 0x7, rev = 0x0, next = 0x1000, eol = 0x0, reserved = 0x0, feature_type = 0x3
offset: 0x4000, value: 0x30000000c0001004
    dfh: id = 0x4, rev = 0x1, next = 0xc000, eol = 0x0, reserved = 0x0, feature_type = 0x3
offset: 0x10000, value: 0x300000010000000e
    dfh: id = 0xe, rev = 0x0, next = 0x10000, eol = 0x0, reserved = 0x0, feature_type = 0x3
offset: 0x20000, value: 0x3000000100000020
    dfh: id = 0x20, rev = 0x0, next = 0x10000, eol = 0x0, reserved = 0x0, feature_type = 0x3
offset: 0x30000, value: 0x300000010000100f
    dfh: id = 0xf, rev = 0x1, next = 0x10000, eol = 0x0, reserved = 0x0, feature_type = 0x3
offset: 0x40000, value: 0x3000000100000009
    dfh: id = 0x9, rev = 0x0, next = 0x10000, eol = 0x0, reserved = 0x0, feature_type = 0x3
offset: 0x50000, value: 0x3000000400000fff
    dfh: id = 0xfff, rev = 0x0, next = 0x40000, eol = 0x0, reserved = 0x0, feature_type = 0x3
offset: 0x90000, value: 0x3000000010001005
    dfh: id = 0x5, rev = 0x1, next = 0x1000, eol = 0x0, reserved = 0x0, feature_type = 0x3
offset: 0x91000, value: 0x4000000010001001
    dfh: id = 0x1, rev = 0x1, next = 0x1000, eol = 0x0, reserved = 0x0, feature_type = 0x4
offset: 0x92000, value: 0x3000000010000014
    dfh: id = 0x14, rev = 0x0, next = 0x1000, eol = 0x0, reserved = 0x0, feature_type = 0x3
offset: 0x93000, value: 0x30000000d0002013
    dfh: id = 0x13, rev = 0x2, next = 0xd000, eol = 0x0, reserved = 0x0, feature_type = 0x3
offset: 0xa0000, value: 0x3000010000002010
    dfh: id = 0x10, rev = 0x2, next = 0x0, eol = 0x1, reserved = 0x0, feature_type = 0x3</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>Read the default values from the hello_fim registers:
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>```bash session
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>$ opae.io -d 0000:12:00.0 -r 0 peek 0x50000
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>opae.io 0.2.3
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>0x3000000400000fff
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>$ opae.io -d 0000:12:00.0 -r 0 peek 0x50030
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>opae.io 0.2.3
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>0x0
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>$ opae.io -d 0000:12:00.0 -r 0 peek 0x50038
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>opae.io 0.2.3
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>0x6626070150000034
</code></pre></div>
Write the scratchpad register at 0x50030</p>
<p>```bash session
$ opae.io -d 0000:12:00.0 -r 0 poke 0x50038 0x123456789abcdef
opae.io 0.2.3
$ opae.io -d 0000:12:00.0 -r 0 peek 0x50038
opae.io 0.2.3
0x6626070150000034
$ opae.io -d 0000:12:00.0 -r 0 poke 0x50030 0x123456789abcdef
opae.io 0.2.3
$ opae.io -d 0000:12:00.0 -r 0 peek 0x50030
opae.io 0.2.3
0x123456789abcdef
$ opae.io -d 0000:12:00.0 -r 0 poke 0x50030 0xfedcba9876543210
opae.io 0.2.3
$ opae.io -d 0000:12:00.0 -r 0 peek 0x50030
opae.io 0.2.3
0xfedcba9876543210
$ opae.io -d 0000:12:00.0 -r 0 poke 0x50030 0x55550000aaaaffff
opae.io 0.2.3
$ opae.io -d 0000:12:00.0 -r 0 peek 0x50030
opae.io 0.2.3
0x55550000aaaaffff
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>Release the card under test from the vfio driver to re-bind to the dfl-pci driver:
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>```bash session
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>sudo opae.io release -d 0000:12:00.0
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>## Output
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>opae.io 0.2.3
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>Releasing (0x8086,0xbcce) at 0000:12:00.0 from vfio-pci
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>Rebinding (0x8086,0xbcce) at 0000:12:00.0 to dfl-pci
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>$ sudo opae.io ls
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>opae.io 0.2.3
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>[0000:12:00.0] (0x8086, 0xbcce) Intel D5005 ADP (Driver: dfl-pci)
</code></pre></div></p>
<h2 id="52-memory-subsystem-modification">5.2. Memory Subsystem Modification</h2>
<p><abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> enables modifications on the different subsystems that encompass the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr>. To customize the Memory Subsystem follow these instructions.</p>
<ol>
<li>
<p>Set up the environment variables as described in section <a href="#421-setting-up-required-environment-variables">4.2.1. Setting Up Required Environment Variables</a></p>
</li>
<li>
<p>Modify the NUM_MEM_CH parameter in src/afu_top/mux/top_cfg_pkg.sv
Change NUM_MEM_CH from 4 to 2 as shown in below code </p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1">//=========================================================================================================================</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="c1">//                         OFS Configuration Parameters                                                                 </span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="c1">//=========================================================================================================================</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">     </span><span class="k">parameter</span><span class="w"> </span><span class="n">NUM_MEM_CH</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mh">2</span><span class="w">                                                 </span><span class="p">,</span><span class="c1">// Number of Memory/DDR Channel         </span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="w">               </span><span class="n">NUM_HOST</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="w">                                                 </span><span class="p">,</span><span class="c1">// Number of Host/Upstream Ports        </span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="w">               </span><span class="n">NUM_PORT</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mh">4</span><span class="w">                                                 </span><span class="p">,</span><span class="c1">// Number of Functions/Downstream Ports </span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">               </span><span class="n">DATA_WIDTH</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mh">512</span><span class="w">                                               </span><span class="p">,</span><span class="c1">// Data Width of Interface              </span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">               </span><span class="n">TOTAL_BAR_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">20</span><span class="w">                                                </span><span class="p">,</span><span class="c1">// Total Space for APF/BPF BARs (2^N) </span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">           </span><span class="c1">//------------+-------------+-------------+-----------------+           //--------------------------------------</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">           </span><span class="c1">// VF Active  |     PF #    |     VF #    |  Mux Port Map   |           //  PF/VF Mapping Parameters            </span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">           </span><span class="c1">//------------+-------------+-------------+-----------------+           //--------------------------------------</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">             </span><span class="n">CFG_VA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">CFG_PF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">CFG_VF</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mh">0</span><span class="w"> </span><span class="p">,</span><span class="w">  </span><span class="n">CFG_PID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">3</span><span class="w">    </span><span class="p">,</span><span class="w">           </span><span class="c1">//  Configuration Register Block        </span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">             </span><span class="n">HLB_VA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">HLB_PF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">HLB_VF</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mh">0</span><span class="w"> </span><span class="p">,</span><span class="w">  </span><span class="n">HLB_PID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="w">    </span><span class="p">,</span><span class="w">           </span><span class="c1">//  HE Loopback Engine                  </span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">             </span><span class="n">PRG_VA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">PRG_PF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">PRG_VF</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mh">1</span><span class="w"> </span><span class="p">,</span><span class="w">  </span><span class="n">PRG_PID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="w">    </span><span class="p">,</span><span class="w">           </span><span class="c1">//  Partial Reconfiguration Gasket      </span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="w">             </span><span class="n">HSI_VA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">HSI_PF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">HSI_VF</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mh">2</span><span class="w"> </span><span class="p">,</span><span class="w">  </span><span class="n">HSI_PID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">2</span><span class="w">    </span><span class="p">;</span><span class="w">           </span><span class="c1">//  HSSI interface </span>
</code></pre></div>
<p>Compile a new <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> that incorporates the newly configured Memory Subsystem. </p>
<p>```bash session
cd $OFS_BUILD_ROOT/ofs-d5005
ofs-common/scripts/common/syn/build_top.sh d5005 work_d5005_mem_2channel
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>
</code></pre></div></p>
<hr />
<hr />
<p><strong><em>        OFS_PROJECT: d5005
</em></strong>        Q_PROJECT:  d5005
<strong><em>        Q_REVISION: d5005
</em></strong>        SEED: 03
<strong><em>        Build Complete
</em></strong>        Timing Passed!</p>
<hr />
<hr />
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>Program d5005_page1_unsigned.bin file using below command
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>```bash session
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>sudo fpgasupdate d5005_page1_unsigned.bin 3b:00.0
</code></pre></div>
<p>Run rsu command
```bash session
sudo rsu bmcimg 3b:00.0
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>Check if binary was loaded correctly
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>```bash session
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>fpgainfo fme
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>## Output
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>Intel FPGA Programmable Acceleration Card D5005
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>Board Management Controller, MAX10 NIOS FW version: 2.0.13
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>Board Management Controller, MAX10 Build version: 2.0.13
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>//****** FME ******//
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>Object Id                        : 0xF000000
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>PCIe s:b:d.f                     : 0000:3B:00.0
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>Vendor Id                        : 0x8086
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>Device Id                        : 0xBCCE
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>SubVendor Id                     : 0x8086
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>SubDevice Id                     : 0x138D
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a>Socket Id                        : 0x00
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a>Ports Num                        : 01
<a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a>Bitstream Id                     : 288511861987640872
<a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a>Bitstream Version                : 4.0.1
<a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a>Pr Interface Id                  : d51533ad-aee6-5dab-80fb-a44bbf579b68
<a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a>Boot Page                        : user
</code></pre></div></p>
<p>Run Host Excersiser to check Memory Subsystem performance</p>
<p>```bash session
sudo host_exerciser mem</p>
<h2 id="output_3">Output</h2>
<div class="highlight"><pre><span></span><code>starting test run, count of 1
</code></pre></div>
<p>API version: 1
<abbr title="Accelerator Functional Unit, Hardware Accelerator implemented in FPGA logic which offloads a computational operation for an application from the CPU to improve performance. Note: An AFU region is the part of the design where an AFU may reside. This AFU may or may not be a partial reconfiguration region">AFU</abbr> clock: 250 MHz
Allocate SRC Buffer
Allocate DST Buffer
Allocate DSM Buffer
    Host Exerciser Performance Counter:
    Host Exerciser numReads: 1024
    Host Exerciser numWrites: 1025
    Host Exerciser numPendReads: 0
    Host Exerciser numPendWrites: 0
    Host Exerciser numPendEmifReads: 0
    Host Exerciser numPendEmifWrites: 0
    Number of clocks: 5365
    Total number of Reads sent: 1024
    Total number of Writes sent: 1024
    Bandwidth: 3.054 GB/s
    Test mem(1): PASS
<code>Verify Memory controller placement in syn/syn_top/output_files/d5005.fit.place.rpt file. Open fitter place stage report in any text editor of your choice, find keyword *emif* in the file. You should see emif[0] &amp; emif[1] for Memory channel 0 &amp; 1 respectively.</code>verilog
|emif[0].ddr4_pr_freeze_sync|                ; 0.4 (0.0)            ; 0.5 (0.0)                        ; 0.1 (0.0)                            ;
|resync_chains[0].synchronizer_nocut|        ; 0.4 (0.4)            ; 0.5 (0.5)                        ; 0.1 (0.1)                            ;
|emif[0].ddr4_softreset_sync|                ; 0.5 (0.0)            ; 0.7 (0.0)                        ; 0.2 (0.0)                            ;
|resync_chains[0].synchronizer_nocut|        ; 0.5 (0.5)            ; 0.7 (0.7)                        ; 0.2 (0.2)                            ;
|emif[0].pr_frz_afu_avmm_if|                 ; 647.5 (647.5)        ; 917.3 (917.3)                    ; 272.8 (272.8)                        ;
|emif[1].ddr4_pr_freeze_sync|                ; 0.4 (0.0)            ; 0.8 (0.0)                        ; 0.4 (0.0)                            ;
|resync_chains[0].synchronizer_nocut|        ; 0.4 (0.4)            ; 0.8 (0.8)                        ; 0.4 (0.4)                            ;
|emif[1].ddr4_softreset_sync|                ; 0.4 (0.0)            ; 1.0 (0.0)                        ; 0.6 (0.0)                            ;
|resync_chains[0].synchronizer_nocut|        ; 0.4 (0.4)            ; 1.0 (1.0)                        ; 0.6 (0.6)                            ;
|emif[1].pr_frz_afu_avmm_if|                 ; 641.1 (641.1)        ; 914.0 (914.0)                    ; 272.9 (272.9)                        ;
|p[0].pr_frz_fn2mx_a_port|                   ; 435.4 (0.0)          ; 476.2 (0.0)                      ; 40.8 (0.0)                           ;
|r.axis_pl_stage[0].axis_reg_inst|           ; 435.4 (435.4)        ; 476.2 (476.2)                    ; 40.8 (40.8)                          ;
|p[0].pr_frz_fn2mx_b_port|                   ; 434.6 (0.0)          ; 494.3 (0.0)                      ; 59.6 (0.0)                           ;

```</p>
<h1 id="6-conclusion">6. Conclusion</h1>
<p>Using the <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> reference design and <abbr title="Open Programmable Acceleration Engine Software Development Kit, A collection of libraries and tools to facilitate the development of software applications and accelerators using OPAE.">OPAE SDK</abbr> enables the rapid creation of market leading FPGA based Acceleration systems. <abbr title="Open FPGA Stack, A modular collection of hardware platform components, open source software, and broad ecosystem support that provides a standard and scalable model for AFU and software developers to optimize and reuse their designs.">OFS</abbr> facilitates customization of the <abbr title="FPGA Interface Manager, Provides platform management, functionality, clocks, resets and standard interfaces to host and AFUs. The FIM resides in the static region of the FPGA and contains the FPGA Management Engine (FME) and I/O ring.">FIM</abbr> area for your custom board or platforms. </p>
<h2 id="notices-disclaimers">Notices &amp; Disclaimers</h2>
<p>Intel<sup>&reg;</sup> technologies may require enabled hardware, software or service activation.
No product or component can be absolutely secure. 
Performance varies by use, configuration and other factors.
Your costs and results may vary. 
You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Intel products described herein. You agree to grant Intel a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.
No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document, with the sole exception that you may publish an unmodified copy. You may create software implementations based on this document and in compliance with the foregoing that are intended to execute on the Intel product(s) referenced in this document. No rights are granted to create modifications or derivatives of this document.
The products described may contain design defects or errors known as errata which may cause the product to deviate from published specifications.  Current characterized errata are available on request.
Intel disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.
You are responsible for safety of the overall system, including compliance with applicable safety-related requirements or standards. 
<sup>&copy;</sup> Intel Corporation.  Intel, the Intel logo, and other Intel marks are trademarks of Intel Corporation or its subsidiaries.  Other names and brands may be claimed as the property of others.   </p>
<p><a href="https://github.com/OFS/examples-afu.git">example AFUs</a></p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.top", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  </body>
</html>